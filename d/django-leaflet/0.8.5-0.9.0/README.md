# Comparing `tmp/django-leaflet-0.8.5.zip` & `tmp/django-leaflet-0.9.0.zip`

## zipinfo {}

```diff
@@ -1,60 +1,62 @@
-Zip file size: 208194 bytes, number of entries: 58
--rw-rw-r--  2.0 unx       59 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/setup.cfg
--rw-rw-r--  2.0 unx    22074 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/PKG-INFO
--rw-rw-r--  2.0 unx     1162 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/setup.py
--rw-rw-r--  2.0 unx    11274 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/README.rst
--rw-rw-r--  2.0 unx      237 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/MANIFEST.in
--rw-rw-r--  2.0 unx     7651 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/LICENSE
--rw-rw-r--  2.0 unx     4905 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/CHANGES
--rw-rw-r--  2.0 unx     7189 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/tests.py
--rw-rw-r--  2.0 unx        0 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/models.py
--rw-rw-r--  2.0 unx     1497 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/admin.py
--rw-rw-r--  2.0 unx     6728 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/__init__.py
--rw-rw-r--  2.0 unx     3611 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/templatetags/leaflet_tags.py
--rw-rw-r--  2.0 unx        0 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/templatetags/__init__.py
--rw-rw-r--  2.0 unx     1084 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/templates/leaflet/widget.html
--rw-rw-r--  2.0 unx      935 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/templates/leaflet/js.html
--rw-rw-r--  2.0 unx      406 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/templates/leaflet/css.html
--rw-rw-r--  2.0 unx     1016 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/templates/leaflet/_leaflet_map.html
--rw-rw-r--  2.0 unx     2885 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/templates/leaflet/_leaflet_draw_i18n.js
--rw-rw-r--  2.0 unx      673 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/templates/leaflet/admin/widget.html
--rw-rw-r--  2.0 unx     4523 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/proj4leaflet.js
--rw-rw-r--  2.0 unx    68695 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/proj4js.js
--rw-rw-r--  2.0 unx   120487 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.js
--rw-rw-r--  2.0 unx     1105 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.ie.css
--rw-rw-r--  2.0 unx     6084 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.forms.js
--rw-rw-r--  2.0 unx     7141 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.extras.js
--rw-rw-r--  2.0 unx    10241 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.css
--rw-rw-r--  2.0 unx   215141 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/leaflet-src.js
--rw-rw-r--  2.0 unx     4099 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/eventlistener.ie8.js
--rw-rw-r--  2.0 unx     3532 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/eventlistener.ie6-7.js
--rw-rw-r--  2.0 unx     7083 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/Control.MiniMap.js
--rw-rw-r--  2.0 unx      722 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/Control.MiniMap.css
--rw-rw-r--  2.0 unx      956 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/images/zoom-out.png
--rw-rw-r--  2.0 unx      960 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/images/zoom-in.png
--rw-rw-r--  2.0 unx      560 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/images/toggle.png
--rw-rw-r--  2.0 unx      159 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/images/reset-view.png
--rw-rw-r--  2.0 unx      797 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-shadow.png
--rw-rw-r--  2.0 unx     4033 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-icon@2x.png
--rw-rw-r--  2.0 unx     1747 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-icon.png
--rw-rw-r--  2.0 unx     4033 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-icon-2x.png
--rw-rw-r--  2.0 unx     1502 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/images/layers.png
--rw-rw-r--  2.0 unx     2898 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/images/layers-2x.png
--rw-rw-r--  2.0 unx    40987 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw.js
--rw-rw-r--  2.0 unx      659 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw.ie.css
--rw-rw-r--  2.0 unx     4437 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw.css
--rw-rw-r--  2.0 unx    66111 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw-src.js
--rw-rw-r--  2.0 unx     2777 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/draw/images/spritesheet.png
--rw-rw-r--  2.0 unx     1467 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/static/leaflet/draw/images/spritesheet-2x.png
--rw-rw-r--  2.0 unx      552 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/locale/it/LC_MESSAGES/django.mo
--rw-rw-r--  2.0 unx     2842 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/locale/fr/LC_MESSAGES/django.mo
--rw-rw-r--  2.0 unx     1998 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/forms/widgets.py
--rw-rw-r--  2.0 unx     1235 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/forms/fields.py
--rw-rw-r--  2.0 unx        0 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/leaflet/forms/__init__.py
--rw-rw-r--  2.0 unx        8 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/django_leaflet.egg-info/top_level.txt
--rw-rw-r--  2.0 unx        6 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/django_leaflet.egg-info/requires.txt
--rw-rw-r--  2.0 unx        1 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/django_leaflet.egg-info/not-zip-safe
--rw-rw-r--  2.0 unx        1 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/django_leaflet.egg-info/dependency_links.txt
--rw-rw-r--  2.0 unx     2025 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/django_leaflet.egg-info/SOURCES.txt
--rw-rw-r--  2.0 unx    22074 b- defN 13-Nov-05 11:21 django-leaflet-0.8.5/django_leaflet.egg-info/PKG-INFO
-58 files, 687064 bytes uncompressed, 197354 bytes compressed:  71.3%
+Zip file size: 213815 bytes, number of entries: 60
+-rw-rw-r--  2.0 unx       59 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/setup.cfg
+-rw-rw-r--  2.0 unx    23012 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/PKG-INFO
+-rw-rw-r--  2.0 unx     1256 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/setup.py
+-rw-rw-r--  2.0 unx    11799 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/README.rst
+-rw-rw-r--  2.0 unx      237 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/MANIFEST.in
+-rw-rw-r--  2.0 unx     7651 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/LICENSE
+-rw-rw-r--  2.0 unx     5126 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/CHANGES
+-rw-rw-r--  2.0 unx        0 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/models.py
+-rw-rw-r--  2.0 unx     1497 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/admin.py
+-rw-rw-r--  2.0 unx     6868 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/__init__.py
+-rw-rw-r--  2.0 unx     7194 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/tests/tests.py
+-rw-rw-r--  2.0 unx       28 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/tests/__init__.py
+-rw-rw-r--  2.0 unx     3611 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/templatetags/leaflet_tags.py
+-rw-rw-r--  2.0 unx        0 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/templatetags/__init__.py
+-rw-rw-r--  2.0 unx     1084 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/templates/leaflet/widget.html
+-rw-rw-r--  2.0 unx      935 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/templates/leaflet/js.html
+-rw-rw-r--  2.0 unx      406 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/templates/leaflet/css.html
+-rw-rw-r--  2.0 unx     1016 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/templates/leaflet/_leaflet_map.html
+-rw-rw-r--  2.0 unx     2885 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/templates/leaflet/_leaflet_draw_i18n.js
+-rw-rw-r--  2.0 unx      673 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/templates/leaflet/admin/widget.html
+-rw-rw-r--  2.0 unx     4523 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/proj4leaflet.js
+-rw-rw-r--  2.0 unx    68695 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/proj4js.js
+-rw-rw-r--  2.0 unx   125494 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.js
+-rw-rw-r--  2.0 unx     1105 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.ie.css
+-rw-rw-r--  2.0 unx     6059 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.forms.js
+-rw-rw-r--  2.0 unx     7141 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.extras.js
+-rw-rw-r--  2.0 unx    10161 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.css
+-rw-rw-r--  2.0 unx   223044 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/leaflet-src.js
+-rw-rw-r--  2.0 unx     4099 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/eventlistener.ie8.js
+-rw-rw-r--  2.0 unx     3532 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/eventlistener.ie6-7.js
+-rw-rw-r--  2.0 unx     8591 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/Control.MiniMap.js
+-rw-rw-r--  2.0 unx      707 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/Control.MiniMap.css
+-rw-rw-r--  2.0 unx      956 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/images/zoom-out.png
+-rw-rw-r--  2.0 unx      960 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/images/zoom-in.png
+-rw-rw-r--  2.0 unx      345 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/images/toggle.png
+-rw-rw-r--  2.0 unx      159 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/images/reset-view.png
+-rw-rw-r--  2.0 unx      797 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-shadow.png
+-rw-rw-r--  2.0 unx     4033 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-icon@2x.png
+-rw-rw-r--  2.0 unx     1747 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-icon.png
+-rw-rw-r--  2.0 unx     4033 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-icon-2x.png
+-rw-rw-r--  2.0 unx     1502 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/images/layers.png
+-rw-rw-r--  2.0 unx     2898 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/images/layers-2x.png
+-rw-rw-r--  2.0 unx    42643 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw.js
+-rw-rw-r--  2.0 unx      717 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw.ie.css
+-rw-rw-r--  2.0 unx     5168 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw.css
+-rw-rw-r--  2.0 unx    68491 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw-src.js
+-rw-rw-r--  2.0 unx     1056 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/draw/images/spritesheet.png
+-rw-rw-r--  2.0 unx     2078 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/static/leaflet/draw/images/spritesheet-2x.png
+-rw-rw-r--  2.0 unx      552 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/locale/it/LC_MESSAGES/django.mo
+-rw-rw-r--  2.0 unx     2842 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/locale/fr/LC_MESSAGES/django.mo
+-rw-rw-r--  2.0 unx     2605 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/locale/de/LC_MESSAGES/django.mo
+-rw-rw-r--  2.0 unx     1998 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/forms/widgets.py
+-rw-rw-r--  2.0 unx     1235 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/forms/fields.py
+-rw-rw-r--  2.0 unx        0 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/leaflet/forms/__init__.py
+-rw-rw-r--  2.0 unx        8 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/django_leaflet.egg-info/top_level.txt
+-rw-rw-r--  2.0 unx        6 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/django_leaflet.egg-info/requires.txt
+-rw-rw-r--  2.0 unx        1 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/django_leaflet.egg-info/not-zip-safe
+-rw-rw-r--  2.0 unx        1 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/django_leaflet.egg-info/dependency_links.txt
+-rw-rw-r--  2.0 unx     2097 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/django_leaflet.egg-info/SOURCES.txt
+-rw-rw-r--  2.0 unx    23012 b- defN 13-Dec-11 00:07 django-leaflet-0.9.0/django_leaflet.egg-info/PKG-INFO
+60 files, 710428 bytes uncompressed, 202599 bytes compressed:  71.5%
```

## zipnote {}

```diff
@@ -1,175 +1,181 @@
-Filename: django-leaflet-0.8.5/setup.cfg
+Filename: django-leaflet-0.9.0/setup.cfg
 Comment: 
 
-Filename: django-leaflet-0.8.5/PKG-INFO
+Filename: django-leaflet-0.9.0/PKG-INFO
 Comment: 
 
-Filename: django-leaflet-0.8.5/setup.py
+Filename: django-leaflet-0.9.0/setup.py
 Comment: 
 
-Filename: django-leaflet-0.8.5/README.rst
+Filename: django-leaflet-0.9.0/README.rst
 Comment: 
 
-Filename: django-leaflet-0.8.5/MANIFEST.in
+Filename: django-leaflet-0.9.0/MANIFEST.in
 Comment: 
 
-Filename: django-leaflet-0.8.5/LICENSE
+Filename: django-leaflet-0.9.0/LICENSE
 Comment: 
 
-Filename: django-leaflet-0.8.5/CHANGES
+Filename: django-leaflet-0.9.0/CHANGES
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/tests.py
+Filename: django-leaflet-0.9.0/leaflet/models.py
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/models.py
+Filename: django-leaflet-0.9.0/leaflet/admin.py
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/admin.py
+Filename: django-leaflet-0.9.0/leaflet/__init__.py
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/__init__.py
+Filename: django-leaflet-0.9.0/leaflet/tests/tests.py
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/templatetags/leaflet_tags.py
+Filename: django-leaflet-0.9.0/leaflet/tests/__init__.py
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/templatetags/__init__.py
+Filename: django-leaflet-0.9.0/leaflet/templatetags/leaflet_tags.py
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/templates/leaflet/widget.html
+Filename: django-leaflet-0.9.0/leaflet/templatetags/__init__.py
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/templates/leaflet/js.html
+Filename: django-leaflet-0.9.0/leaflet/templates/leaflet/widget.html
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/templates/leaflet/css.html
+Filename: django-leaflet-0.9.0/leaflet/templates/leaflet/js.html
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/templates/leaflet/_leaflet_map.html
+Filename: django-leaflet-0.9.0/leaflet/templates/leaflet/css.html
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/templates/leaflet/_leaflet_draw_i18n.js
+Filename: django-leaflet-0.9.0/leaflet/templates/leaflet/_leaflet_map.html
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/templates/leaflet/admin/widget.html
+Filename: django-leaflet-0.9.0/leaflet/templates/leaflet/_leaflet_draw_i18n.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/proj4leaflet.js
+Filename: django-leaflet-0.9.0/leaflet/templates/leaflet/admin/widget.html
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/proj4js.js
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/proj4leaflet.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.js
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/proj4js.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.ie.css
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.forms.js
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.ie.css
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.extras.js
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.forms.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.css
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.extras.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/leaflet-src.js
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.css
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/eventlistener.ie8.js
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/leaflet-src.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/eventlistener.ie6-7.js
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/eventlistener.ie8.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/Control.MiniMap.js
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/eventlistener.ie6-7.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/Control.MiniMap.css
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/Control.MiniMap.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/images/zoom-out.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/Control.MiniMap.css
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/images/zoom-in.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/images/zoom-out.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/images/toggle.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/images/zoom-in.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/images/reset-view.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/images/toggle.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-shadow.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/images/reset-view.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-icon@2x.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-shadow.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-icon.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-icon@2x.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-icon-2x.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-icon.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/images/layers.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-icon-2x.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/images/layers-2x.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/images/layers.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw.js
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/images/layers-2x.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw.ie.css
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw.css
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw.ie.css
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw-src.js
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw.css
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/draw/images/spritesheet.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw-src.js
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/static/leaflet/draw/images/spritesheet-2x.png
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/draw/images/spritesheet.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/locale/it/LC_MESSAGES/django.mo
+Filename: django-leaflet-0.9.0/leaflet/static/leaflet/draw/images/spritesheet-2x.png
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/locale/fr/LC_MESSAGES/django.mo
+Filename: django-leaflet-0.9.0/leaflet/locale/it/LC_MESSAGES/django.mo
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/forms/widgets.py
+Filename: django-leaflet-0.9.0/leaflet/locale/fr/LC_MESSAGES/django.mo
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/forms/fields.py
+Filename: django-leaflet-0.9.0/leaflet/locale/de/LC_MESSAGES/django.mo
 Comment: 
 
-Filename: django-leaflet-0.8.5/leaflet/forms/__init__.py
+Filename: django-leaflet-0.9.0/leaflet/forms/widgets.py
 Comment: 
 
-Filename: django-leaflet-0.8.5/django_leaflet.egg-info/top_level.txt
+Filename: django-leaflet-0.9.0/leaflet/forms/fields.py
 Comment: 
 
-Filename: django-leaflet-0.8.5/django_leaflet.egg-info/requires.txt
+Filename: django-leaflet-0.9.0/leaflet/forms/__init__.py
 Comment: 
 
-Filename: django-leaflet-0.8.5/django_leaflet.egg-info/not-zip-safe
+Filename: django-leaflet-0.9.0/django_leaflet.egg-info/top_level.txt
 Comment: 
 
-Filename: django-leaflet-0.8.5/django_leaflet.egg-info/dependency_links.txt
+Filename: django-leaflet-0.9.0/django_leaflet.egg-info/requires.txt
 Comment: 
 
-Filename: django-leaflet-0.8.5/django_leaflet.egg-info/SOURCES.txt
+Filename: django-leaflet-0.9.0/django_leaflet.egg-info/not-zip-safe
 Comment: 
 
-Filename: django-leaflet-0.8.5/django_leaflet.egg-info/PKG-INFO
+Filename: django-leaflet-0.9.0/django_leaflet.egg-info/dependency_links.txt
+Comment: 
+
+Filename: django-leaflet-0.9.0/django_leaflet.egg-info/SOURCES.txt
+Comment: 
+
+Filename: django-leaflet-0.9.0/django_leaflet.egg-info/PKG-INFO
 Comment: 
 
 Zip file comment:
```

## Comparing `django-leaflet-0.8.5/PKG-INFO` & `django-leaflet-0.9.0/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,20 +1,20 @@
 Metadata-Version: 1.1
 Name: django-leaflet
-Version: 0.8.5
+Version: 0.9.0
 Summary: Use Leaflet in your django projects
 Home-page: https://github.com/makinacorpus/django-leaflet
 Author: Mathieu Leplatre
 Author-email: mathieu.leplatre@makina-corpus.com
 License: LPGL, see LICENSE file.
 Download-URL: http://pypi.python.org/pypi/django-leaflet/
 Description: *django-leaflet* allows you to use `Leaflet <http://leafletjs.com>`_
         in your `Django <https://www.djangoproject.com>`_ projects.
         
-        It embeds Leaflet in version *0.6.4*.
+        It embeds Leaflet in version *0.7.1*.
         
         .. image:: https://pypip.in/v/django-leaflet/badge.png
                 :target: https://pypi.python.org/pypi/django-leaflet
         
         .. image:: https://pypip.in/d/django-leaflet/badge.png
                 :target: https://pypi.python.org/pypi/django-leaflet
         
@@ -238,14 +238,29 @@
         
             'MINIMAP': True
         
         By default it shows the tiles of the first layer in the list.
         
         (`More info... <https://github.com/Norkart/Leaflet-MiniMap>`_)
         
+        Reset view button
+        ~~~~~~~~~~~~~~~~~
+        By default, a button appears below the zoom controls and, when clicked, shows the entire map.
+        To remove this button, set::
+        
+            'RESET_VIEW': False
+        
+        
+        Global initialization functions and ``window.maps``
+        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+        Since 0.7.0, the ``leaflet_map`` template tag no longer registers initialization functions in global scope,
+        and no longer adds map objects into ``window.maps`` array by default. To restore these features, use::
+        
+            'NO_GLOBALS' = False
+        
         
         Plugins
         ~~~~~~~
         
         To ease the usage of plugins, django-leaflet allows specifying a set of plugins, that can
         later be referred to from the template tags by name::
         
@@ -291,15 +306,15 @@
         
         Leaflet map forms widgets
         -------------------------
         
         With *Django* >= 1.6, a Leaflet widget is provided to edit geometry fields.
         In previous versions, it falls back to simple text areas.
         
-        It embeds *Leaflet.draw* in version *0.2.1dev*.
+        It embeds *Leaflet.draw* in version *0.2.2*.
         
         
         .. image :: https://f.cloud.github.com/assets/546692/1048836/78b6ad94-1094-11e3-86d8-c3e88626a31d.png
         
         
         In Adminsite
         ~~~~~~~~~~~~
@@ -472,14 +487,23 @@
         * Leaflet Copyright - 2010-2011 CloudMade, Vladimir Agafonkin
         
         
         =========
         CHANGELOG
         =========
         
+        0.9.0 (2013-12-11)
+        ------------------
+        
+        * Upgrade to Leaflet 0.7.1
+        * Fix unsaved warning being always triggered on Internet Explorer.
+        * Added DE locale (thanks @rosscdh)
+        * Fix installation with python 2.6 (thanks @ollb)
+        
+        
         0.8.5 (2013-11-05)
         ------------------
         
         * Fix name collision.
         
         
         0.8.4 (2013-11-05)
```

### html2text {}

```diff
@@ -1,15 +1,15 @@
-Metadata-Version: 1.1 Name: django-leaflet Version: 0.8.5 Summary: Use Leaflet
+Metadata-Version: 1.1 Name: django-leaflet Version: 0.9.0 Summary: Use Leaflet
 in your django projects Home-page: https://github.com/makinacorpus/django-
 leaflet Author: Mathieu Leplatre Author-email: mathieu.leplatre@makina-
 corpus.com License: LPGL, see LICENSE file. Download-URL: http://
 pypi.python.org/pypi/django-leaflet/ Description: *django-leaflet* allows you
 to use `Leaflet
 leafletjs.com>`_ in your `Django
-www.djangoproject.com>`_ projects. It embeds Leaflet in version *0.6.4*. ..
+www.djangoproject.com>`_ projects. It embeds Leaflet in version *0.7.1*. ..
 image:: https://pypip.in/v/django-leaflet/badge.png :target: https://
 pypi.python.org/pypi/django-leaflet .. image:: https://pypip.in/d/django-
 leaflet/badge.png :target: https://pypi.python.org/pypi/django-leaflet ..
 image:: https://travis-ci.org/makinacorpus/django-leaflet.png :target: https://
 travis-ci.org/makinacorpus/django-leaflet .. image:: https://coveralls.io/
 repos/makinacorpus/django-leaflet/badge.png :target: https://coveralls.io/r/
 makinacorpus/django-leaflet Main purposes of having a python package for the
@@ -57,39 +57,46 @@
 likely an empty string) :: 'ATTRIBUTION_PREFIX': 'Powered by django-leaflet'
 Default is ``None``, which leaves the value to `Leaflet's default
 leafletjs.com/reference.html#control-attribution>`_. Scale control
 ~~~~~~~~~~~~~ Disable scale control with km and miles:: 'SCALE': False Minimap
 control ~~~~~~~~~~~~~~~ Shows a small map in the corner which shows the same as
 the main map with a set zoom offset:: 'MINIMAP': True By default it shows the
 tiles of the first layer in the list. (`More info...
-github.com/Norkart/Leaflet-MiniMap>`_) Plugins ~~~~~~~ To ease the usage of
-plugins, django-leaflet allows specifying a set of plugins, that can later be
-referred to from the template tags by name:: 'PLUGINS': { 'name-of-plugin':
-{ 'css': ['relative/path/to/stylesheet.css', '/root/path/to/stylesheet.css'],
-'js': 'http://absolute-url.example.com/path/to/script.js', 'auto-include':
-True, }, . . . } Both 'css' and 'js' support identical features for specifying
-resource URLs: * can be either a plain string or a list of URLs * each string
-can be: * absolute URL - will be included as-is; **example**: ``http://
-absolute-url.example.com/path/to/script.js`` * a URL beginning from the root -
-will be included as-is; **example**: ``/root/path/to/stylesheet.css`` * a
-relative URL - settings.STATIC_URL will be prepended; **example**: ``relative/
-path/to/stylesheet.css`` will be included as **/static/relative/path/to/
-stylesheet.css** (depending on your setting for STATIC_URL) Now, use
-``leaflet_js`` and ``leaflet_css`` tags to load CSS and JS resources of
-configured Leaflet plugins. By default only plugins with ``'auto-include'`` as
-True will be included. To include specific plugins in the page, specify plugin
-names, comma separated:: {% load leaflet_tags %}
+github.com/Norkart/Leaflet-MiniMap>`_) Reset view button ~~~~~~~~~~~~~~~~~ By
+default, a button appears below the zoom controls and, when clicked, shows the
+entire map. To remove this button, set:: 'RESET_VIEW': False Global
+initialization functions and ``window.maps``
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Since 0.7.0, the
+``leaflet_map`` template tag no longer registers initialization functions in
+global scope, and no longer adds map objects into ``window.maps`` array by
+default. To restore these features, use:: 'NO_GLOBALS' = False Plugins ~~~~~~~
+To ease the usage of plugins, django-leaflet allows specifying a set of
+plugins, that can later be referred to from the template tags by name::
+'PLUGINS': { 'name-of-plugin': { 'css': ['relative/path/to/stylesheet.css', '/
+root/path/to/stylesheet.css'], 'js': 'http://absolute-url.example.com/path/to/
+script.js', 'auto-include': True, }, . . . } Both 'css' and 'js' support
+identical features for specifying resource URLs: * can be either a plain string
+or a list of URLs * each string can be: * absolute URL - will be included as-
+is; **example**: ``http://absolute-url.example.com/path/to/script.js`` * a URL
+beginning from the root - will be included as-is; **example**: ``/root/path/to/
+stylesheet.css`` * a relative URL - settings.STATIC_URL will be prepended;
+**example**: ``relative/path/to/stylesheet.css`` will be included as **/static/
+relative/path/to/stylesheet.css** (depending on your setting for STATIC_URL)
+Now, use ``leaflet_js`` and ``leaflet_css`` tags to load CSS and JS resources
+of configured Leaflet plugins. By default only plugins with ``'auto-include'``
+as True will be included. To include specific plugins in the page, specify
+plugin names, comma separated:: {% load leaflet_tags %}
 ... {% leaflet_js plugins="bouncemarker,draw" %} {% leaflet_css
 plugins="bouncemarker,draw" %}
 To include all plugins configured in ``LEAFLET_CONFIG['PLUGINS']``, use:: {%
 leaflet_js plugins="ALL" %} {% leaflet_css plugins="ALL" %} Leaflet map forms
 widgets ------------------------- With *Django* >= 1.6, a Leaflet widget is
 provided to edit geometry fields. In previous versions, it falls back to simple
-text areas. It embeds *Leaflet.draw* in version *0.2.1dev*. .. image :: https:/
-/f.cloud.github.com/assets/546692/1048836/78b6ad94-1094-11e3-86d8-
+text areas. It embeds *Leaflet.draw* in version *0.2.2*. .. image :: https://
+f.cloud.github.com/assets/546692/1048836/78b6ad94-1094-11e3-86d8-
 c3e88626a31d.png In Adminsite ~~~~~~~~~~~~ :: from django.contrib import admin
 from leaflet.admin import LeafletGeoAdmin from .models import WeatherStation
 admin.site.register(WeatherStation, LeafletGeoAdmin) In forms ~~~~~~~~ :: from
 django import forms from leaflet.forms.widgets import LeafletWidget class
 WeatherStationForm(forms.ModelForm): class Meta: model = WeatherStation fields
 = ('name', 'geom') widgets = {'geom': LeafletWidget()} The related template
 would look like this: :: {% load leaflet_tags %}
@@ -133,21 +140,24 @@
 ======= * Mathieu Leplatre
 makina-corpus.com> * Ariel NÃºÃ±ez
 ingenieroariel.com> * Boris Chervenkov
 github.com/boris-chervenkov> |makinacom|_ .. |makinacom| image:: http://
 depot.makina-corpus.org/public/logo.gif .. _makinacom: http://www.makina-
 corpus.com ======= LICENSE ======= * Lesser GNU Public License * Leaflet
 Copyright - 2010-2011 CloudMade, Vladimir Agafonkin ========= CHANGELOG
-========= 0.8.5 (2013-11-05) ------------------ * Fix name collision. 0.8.4
-(2013-11-05) ------------------ * Fix regression in Django leaflet options
-serialization. 0.8.3 (2013-11-05) ------------------ * Switch to lazy gettext
-in leaflet module init. 0.8.2 (2013-10-31) ------------------ * Fix drawing of
-multi-polygon (fixes #37) * Fix attached data for events with jQuery fallback
-(fixes #38) * Fix Javascript syntax errors when using form prefixes (fixes #40)
-0.8.1 (2013-09-30) ------------------ * Fix Leaflet library inclusion with
+========= 0.9.0 (2013-12-11) ------------------ * Upgrade to Leaflet 0.7.1 *
+Fix unsaved warning being always triggered on Internet Explorer. * Added DE
+locale (thanks @rosscdh) * Fix installation with python 2.6 (thanks @ollb)
+0.8.5 (2013-11-05) ------------------ * Fix name collision. 0.8.4 (2013-11-05)
+------------------ * Fix regression in Django leaflet options serialization.
+0.8.3 (2013-11-05) ------------------ * Switch to lazy gettext in leaflet
+module init. 0.8.2 (2013-10-31) ------------------ * Fix drawing of multi-
+polygon (fixes #37) * Fix attached data for events with jQuery fallback (fixes
+#38) * Fix Javascript syntax errors when using form prefixes (fixes #40) 0.8.1
+(2013-09-30) ------------------ * Fix Leaflet library inclusion with
 "plugins=ALL" outside Admin. * Do not include translations in every widgets
 outside Admin. * Fix syntax error if form widget translations contains quotes.
 * Fix dependency error if Leaflet is loaded after the form widget in the DOM. *
 Respect plugins declaration order using OrderedDicts * Prepend forms assets
 (instead of extend) if PLUGINS['forms'] already exists. 0.8.0 (2013-09-18) ----
 -------------- * Renamed Leaflet map fragment template * Leaflet map geometry
 widgets for adminsite and forms (requires Django 1.6) * Fix geometry type
```

## Comparing `django-leaflet-0.8.5/setup.py` & `django-leaflet-0.9.0/setup.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,24 +1,29 @@
 import os
 from setuptools import setup, find_packages
+import sys
 
 here = os.path.abspath(os.path.dirname(__file__))
 
+requires = ['Django']
+if sys.version_info < (2, 7):
+    requires += ['ordereddict']
+
 setup(
     name='django-leaflet',
-    version='0.8.5',
+    version='0.9.0',
     author='Mathieu Leplatre',
     author_email='mathieu.leplatre@makina-corpus.com',
     url='https://github.com/makinacorpus/django-leaflet',
     download_url = "http://pypi.python.org/pypi/django-leaflet/",
     description="Use Leaflet in your django projects",
     long_description=open(os.path.join(here, 'README.rst')).read() + '\n\n' + 
                      open(os.path.join(here, 'CHANGES')).read(),
     license='LPGL, see LICENSE file.',
-    install_requires=['Django'],
+    install_requires=requires,
     packages=find_packages(),
     include_package_data = True,
     zip_safe = False,
     classifiers  = ['Topic :: Utilities', 
                     'Natural Language :: English',
                     'Operating System :: OS Independent',
                     'Intended Audience :: Developers',
```

## Comparing `django-leaflet-0.8.5/README.rst` & `django-leaflet-0.9.0/README.rst`

 * *Files 3% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 *django-leaflet* allows you to use `Leaflet <http://leafletjs.com>`_
 in your `Django <https://www.djangoproject.com>`_ projects.
 
-It embeds Leaflet in version *0.6.4*.
+It embeds Leaflet in version *0.7.1*.
 
 .. image:: https://pypip.in/v/django-leaflet/badge.png
         :target: https://pypi.python.org/pypi/django-leaflet
 
 .. image:: https://pypip.in/d/django-leaflet/badge.png
         :target: https://pypi.python.org/pypi/django-leaflet
 
@@ -229,14 +229,29 @@
 
     'MINIMAP': True
 
 By default it shows the tiles of the first layer in the list.
 
 (`More info... <https://github.com/Norkart/Leaflet-MiniMap>`_)
 
+Reset view button
+~~~~~~~~~~~~~~~~~
+By default, a button appears below the zoom controls and, when clicked, shows the entire map.
+To remove this button, set::
+
+    'RESET_VIEW': False
+
+
+Global initialization functions and ``window.maps``
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+Since 0.7.0, the ``leaflet_map`` template tag no longer registers initialization functions in global scope,
+and no longer adds map objects into ``window.maps`` array by default. To restore these features, use::
+
+    'NO_GLOBALS' = False
+
 
 Plugins
 ~~~~~~~
 
 To ease the usage of plugins, django-leaflet allows specifying a set of plugins, that can
 later be referred to from the template tags by name::
 
@@ -282,15 +297,15 @@
 
 Leaflet map forms widgets
 -------------------------
 
 With *Django* >= 1.6, a Leaflet widget is provided to edit geometry fields.
 In previous versions, it falls back to simple text areas.
 
-It embeds *Leaflet.draw* in version *0.2.1dev*.
+It embeds *Leaflet.draw* in version *0.2.2*.
 
 
 .. image :: https://f.cloud.github.com/assets/546692/1048836/78b6ad94-1094-11e3-86d8-c3e88626a31d.png
 
 
 In Adminsite
 ~~~~~~~~~~~~
```

### html2text {}

```diff
@@ -1,10 +1,10 @@
 *django-leaflet* allows you to use `Leaflet
 leafletjs.com>`_ in your `Django
-www.djangoproject.com>`_ projects. It embeds Leaflet in version *0.6.4*. ..
+www.djangoproject.com>`_ projects. It embeds Leaflet in version *0.7.1*. ..
 image:: https://pypip.in/v/django-leaflet/badge.png :target: https://
 pypi.python.org/pypi/django-leaflet .. image:: https://pypip.in/d/django-
 leaflet/badge.png :target: https://pypi.python.org/pypi/django-leaflet ..
 image:: https://travis-ci.org/makinacorpus/django-leaflet.png :target: https://
 travis-ci.org/makinacorpus/django-leaflet .. image:: https://coveralls.io/
 repos/makinacorpus/django-leaflet/badge.png :target: https://coveralls.io/r/
 makinacorpus/django-leaflet Main purposes of having a python package for the
@@ -52,39 +52,46 @@
 likely an empty string) :: 'ATTRIBUTION_PREFIX': 'Powered by django-leaflet'
 Default is ``None``, which leaves the value to `Leaflet's default
 leafletjs.com/reference.html#control-attribution>`_. Scale control
 ~~~~~~~~~~~~~ Disable scale control with km and miles:: 'SCALE': False Minimap
 control ~~~~~~~~~~~~~~~ Shows a small map in the corner which shows the same as
 the main map with a set zoom offset:: 'MINIMAP': True By default it shows the
 tiles of the first layer in the list. (`More info...
-github.com/Norkart/Leaflet-MiniMap>`_) Plugins ~~~~~~~ To ease the usage of
-plugins, django-leaflet allows specifying a set of plugins, that can later be
-referred to from the template tags by name:: 'PLUGINS': { 'name-of-plugin':
-{ 'css': ['relative/path/to/stylesheet.css', '/root/path/to/stylesheet.css'],
-'js': 'http://absolute-url.example.com/path/to/script.js', 'auto-include':
-True, }, . . . } Both 'css' and 'js' support identical features for specifying
-resource URLs: * can be either a plain string or a list of URLs * each string
-can be: * absolute URL - will be included as-is; **example**: ``http://
-absolute-url.example.com/path/to/script.js`` * a URL beginning from the root -
-will be included as-is; **example**: ``/root/path/to/stylesheet.css`` * a
-relative URL - settings.STATIC_URL will be prepended; **example**: ``relative/
-path/to/stylesheet.css`` will be included as **/static/relative/path/to/
-stylesheet.css** (depending on your setting for STATIC_URL) Now, use
-``leaflet_js`` and ``leaflet_css`` tags to load CSS and JS resources of
-configured Leaflet plugins. By default only plugins with ``'auto-include'`` as
-True will be included. To include specific plugins in the page, specify plugin
-names, comma separated:: {% load leaflet_tags %}
+github.com/Norkart/Leaflet-MiniMap>`_) Reset view button ~~~~~~~~~~~~~~~~~ By
+default, a button appears below the zoom controls and, when clicked, shows the
+entire map. To remove this button, set:: 'RESET_VIEW': False Global
+initialization functions and ``window.maps``
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Since 0.7.0, the
+``leaflet_map`` template tag no longer registers initialization functions in
+global scope, and no longer adds map objects into ``window.maps`` array by
+default. To restore these features, use:: 'NO_GLOBALS' = False Plugins ~~~~~~~
+To ease the usage of plugins, django-leaflet allows specifying a set of
+plugins, that can later be referred to from the template tags by name::
+'PLUGINS': { 'name-of-plugin': { 'css': ['relative/path/to/stylesheet.css', '/
+root/path/to/stylesheet.css'], 'js': 'http://absolute-url.example.com/path/to/
+script.js', 'auto-include': True, }, . . . } Both 'css' and 'js' support
+identical features for specifying resource URLs: * can be either a plain string
+or a list of URLs * each string can be: * absolute URL - will be included as-
+is; **example**: ``http://absolute-url.example.com/path/to/script.js`` * a URL
+beginning from the root - will be included as-is; **example**: ``/root/path/to/
+stylesheet.css`` * a relative URL - settings.STATIC_URL will be prepended;
+**example**: ``relative/path/to/stylesheet.css`` will be included as **/static/
+relative/path/to/stylesheet.css** (depending on your setting for STATIC_URL)
+Now, use ``leaflet_js`` and ``leaflet_css`` tags to load CSS and JS resources
+of configured Leaflet plugins. By default only plugins with ``'auto-include'``
+as True will be included. To include specific plugins in the page, specify
+plugin names, comma separated:: {% load leaflet_tags %}
 ... {% leaflet_js plugins="bouncemarker,draw" %} {% leaflet_css
 plugins="bouncemarker,draw" %}
 To include all plugins configured in ``LEAFLET_CONFIG['PLUGINS']``, use:: {%
 leaflet_js plugins="ALL" %} {% leaflet_css plugins="ALL" %} Leaflet map forms
 widgets ------------------------- With *Django* >= 1.6, a Leaflet widget is
 provided to edit geometry fields. In previous versions, it falls back to simple
-text areas. It embeds *Leaflet.draw* in version *0.2.1dev*. .. image :: https:/
-/f.cloud.github.com/assets/546692/1048836/78b6ad94-1094-11e3-86d8-
+text areas. It embeds *Leaflet.draw* in version *0.2.2*. .. image :: https://
+f.cloud.github.com/assets/546692/1048836/78b6ad94-1094-11e3-86d8-
 c3e88626a31d.png In Adminsite ~~~~~~~~~~~~ :: from django.contrib import admin
 from leaflet.admin import LeafletGeoAdmin from .models import WeatherStation
 admin.site.register(WeatherStation, LeafletGeoAdmin) In forms ~~~~~~~~ :: from
 django import forms from leaflet.forms.widgets import LeafletWidget class
 WeatherStationForm(forms.ModelForm): class Meta: model = WeatherStation fields
 = ('name', 'geom') widgets = {'geom': LeafletWidget()} The related template
 would look like this: :: {% load leaflet_tags %}
```

## Comparing `django-leaflet-0.8.5/LICENSE` & `django-leaflet-0.9.0/LICENSE`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/CHANGES` & `django-leaflet-0.9.0/CHANGES`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,20 @@
 =========
 CHANGELOG
 =========
 
+0.9.0 (2013-12-11)
+------------------
+
+* Upgrade to Leaflet 0.7.1
+* Fix unsaved warning being always triggered on Internet Explorer.
+* Added DE locale (thanks @rosscdh)
+* Fix installation with python 2.6 (thanks @ollb)
+
+
 0.8.5 (2013-11-05)
 ------------------
 
 * Fix name collision.
 
 
 0.8.4 (2013-11-05)
```

## Comparing `django-leaflet-0.8.5/leaflet/tests.py` & `django-leaflet-0.9.0/leaflet/tests/tests.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 import django
 from django.test import SimpleTestCase
 from django.contrib.gis.db import models as gismodels
 
-from . import PLUGINS, PLUGIN_FORMS, _normalize_plugins_config
-from .templatetags import leaflet_tags
-from .admin import LeafletGeoAdmin
-from .forms.widgets import LeafletWidget
-from .forms import fields
+from .. import PLUGINS, PLUGIN_FORMS, _normalize_plugins_config
+from ..templatetags import leaflet_tags
+from ..admin import LeafletGeoAdmin
+from ..forms.widgets import LeafletWidget
+from ..forms import fields
 
 
 class PluginListingTest(SimpleTestCase):
 
     def test_default_resources(self):
         PLUGINS.update({
             'a': {'css': 'a'},
```

## Comparing `django-leaflet-0.8.5/leaflet/admin.py` & `django-leaflet-0.9.0/leaflet/admin.py`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/__init__.py` & `django-leaflet-0.9.0/leaflet/__init__.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,11 +1,16 @@
 # -*- coding: utf8 -*-
 import urlparse
 import warnings
-from collections import OrderedDict
+
+try:
+    from collections import OrderedDict
+except ImportError:
+    # python 2.6 compatibility (need to install ordereddict package).
+    from ordereddict import OrderedDict
 
 from django.conf import settings
 from django.core.exceptions import ImproperlyConfigured
 from django.utils.translation import ugettext_lazy as _
 
 
 DEFAULT_TILES = [(_('OSM'), 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
```

## Comparing `django-leaflet-0.8.5/leaflet/templatetags/leaflet_tags.py` & `django-leaflet-0.9.0/leaflet/templatetags/leaflet_tags.py`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/templates/leaflet/widget.html` & `django-leaflet-0.9.0/leaflet/templates/leaflet/widget.html`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/templates/leaflet/js.html` & `django-leaflet-0.9.0/leaflet/templates/leaflet/js.html`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/templates/leaflet/_leaflet_map.html` & `django-leaflet-0.9.0/leaflet/templates/leaflet/_leaflet_map.html`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/templates/leaflet/_leaflet_draw_i18n.js` & `django-leaflet-0.9.0/leaflet/templates/leaflet/_leaflet_draw_i18n.js`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/templates/leaflet/admin/widget.html` & `django-leaflet-0.9.0/leaflet/templates/leaflet/admin/widget.html`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/proj4leaflet.js` & `django-leaflet-0.9.0/leaflet/static/leaflet/proj4leaflet.js`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/proj4js.js` & `django-leaflet-0.9.0/leaflet/static/leaflet/proj4js.js`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.js` & `django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.js`

 * *Files 2% similar despite different names*

### js-beautify {}

```diff
@@ -2,15 +2,15 @@
  Leaflet, a JavaScript library for mobile-friendly interactive maps. http://leafletjs.com
  (c) 2010-2013, Vladimir Agafonkin
  (c) 2010-2011, CloudMade
 */
 ! function(t, e, i) {
     var n = t.L,
         o = {};
-    o.version = "0.6.4", "object" == typeof module && "object" == typeof module.exports ? module.exports = o : "function" == typeof define && define.amd && define(o), o.noConflict = function() {
+    o.version = "0.7.1", "object" == typeof module && "object" == typeof module.exports ? module.exports = o : "function" == typeof define && define.amd && define(o), o.noConflict = function() {
             return t.L = n, this
         }, t.L = o, o.Util = {
             extend: function(t) {
                 var e, i, n, o, s = Array.prototype.slice.call(arguments, 1);
                 for (i = 0, n = s.length; n > i; i++) {
                     o = s[i] || {};
                     for (e in o) o.hasOwnProperty(e) && (t[e] = o[e])
@@ -72,15 +72,15 @@
             template: function(t, e) {
                 return t.replace(/\{ *([\w_]+) *\}/g, function(t, n) {
                     var o = e[n];
                     if (o === i) throw new Error("No value provided for variable " + t);
                     return "function" == typeof o && (o = o(e)), o
                 })
             },
-            isArray: function(t) {
+            isArray: Array.isArray || function(t) {
                 return "[object Array]" === Object.prototype.toString.call(t)
             },
             emptyImageUrl: "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="
         },
         function() {
             function e(e) {
                 var i, n, o = ["webkit", "moz", "o", "ms"];
@@ -132,113 +132,113 @@
             this.prototype._initHooks = this.prototype._initHooks || [], this.prototype._initHooks.push(i)
         };
     var s = "_leaflet_events";
     o.Mixin = {}, o.Mixin.Events = {
             addEventListener: function(t, e, i) {
                 if (o.Util.invokeEach(t, this.addEventListener, this, e, i)) return this;
                 var n, a, r, h, l, u, c, d = this[s] = this[s] || {},
-                    p = i && o.stamp(i);
+                    p = i && i !== this && o.stamp(i);
                 for (t = o.Util.splitWords(t), n = 0, a = t.length; a > n; n++) r = {
                     action: e,
                     context: i || this
-                }, h = t[n], i ? (l = h + "_idx", u = l + "_len", c = d[l] = d[l] || {}, c[p] || (c[p] = [], d[u] = (d[u] || 0) + 1), c[p].push(r)) : (d[h] = d[h] || [], d[h].push(r));
+                }, h = t[n], p ? (l = h + "_idx", u = l + "_len", c = d[l] = d[l] || {}, c[p] || (c[p] = [], d[u] = (d[u] || 0) + 1), c[p].push(r)) : (d[h] = d[h] || [], d[h].push(r));
                 return this
             },
             hasEventListeners: function(t) {
                 var e = this[s];
                 return !!e && (t in e && e[t].length > 0 || t + "_idx" in e && e[t + "_idx_len"] > 0)
             },
             removeEventListener: function(t, e, i) {
                 if (!this[s]) return this;
                 if (!t) return this.clearAllEventListeners();
                 if (o.Util.invokeEach(t, this.removeEventListener, this, e, i)) return this;
                 var n, a, r, h, l, u, c, d, p, _ = this[s],
-                    m = i && o.stamp(i);
+                    m = i && i !== this && o.stamp(i);
                 for (t = o.Util.splitWords(t), n = 0, a = t.length; a > n; n++)
                     if (r = t[n], u = r + "_idx", c = u + "_len", d = _[u], e) {
-                        if (h = i && d ? d[m] : _[r]) {
+                        if (h = m && d ? d[m] : _[r]) {
                             for (l = h.length - 1; l >= 0; l--) h[l].action !== e || i && h[l].context !== i || (p = h.splice(l, 1), p[0].action = o.Util.falseFn);
                             i && d && 0 === h.length && (delete d[m], _[c]--)
                         }
-                    } else delete _[r], delete _[u];
+                    } else delete _[r], delete _[u], delete _[c];
                 return this
             },
             clearAllEventListeners: function() {
                 return delete this[s], this
             },
             fireEvent: function(t, e) {
                 if (!this.hasEventListeners(t)) return this;
                 var i, n, a, r, h, l = o.Util.extend({}, e, {
                         type: t,
                         target: this
                     }),
                     u = this[s];
                 if (u[t])
-                    for (i = u[t].slice(), n = 0, a = i.length; a > n; n++) i[n].action.call(i[n].context || this, l);
+                    for (i = u[t].slice(), n = 0, a = i.length; a > n; n++) i[n].action.call(i[n].context, l);
                 r = u[t + "_idx"];
                 for (h in r)
                     if (i = r[h].slice())
-                        for (n = 0, a = i.length; a > n; n++) i[n].action.call(i[n].context || this, l);
+                        for (n = 0, a = i.length; a > n; n++) i[n].action.call(i[n].context, l);
                 return this
             },
             addOneTimeEventListener: function(t, e, i) {
                 if (o.Util.invokeEach(t, this.addOneTimeEventListener, this, e, i)) return this;
                 var n = o.bind(function() {
                     this.removeEventListener(t, e, i).removeEventListener(t, n, i)
                 }, this);
                 return this.addEventListener(t, e, i).addEventListener(t, n, i)
             }
         }, o.Mixin.Events.on = o.Mixin.Events.addEventListener, o.Mixin.Events.off = o.Mixin.Events.removeEventListener, o.Mixin.Events.once = o.Mixin.Events.addOneTimeEventListener, o.Mixin.Events.fire = o.Mixin.Events.fireEvent,
         function() {
-            var n = !!t.ActiveXObject,
-                s = n && !t.XMLHttpRequest,
-                a = n && !e.querySelector,
-                r = n && !e.addEventListener,
-                h = navigator.userAgent.toLowerCase(),
-                l = -1 !== h.indexOf("webkit"),
-                u = -1 !== h.indexOf("chrome"),
-                c = -1 !== h.indexOf("phantom"),
-                d = -1 !== h.indexOf("android"),
-                p = -1 !== h.search("android [23]"),
-                _ = typeof orientation != i + "",
-                m = t.navigator && t.navigator.msPointerEnabled && t.navigator.msMaxTouchPoints,
+            var n = "ActiveXObject" in t,
+                s = n && !e.addEventListener,
+                a = navigator.userAgent.toLowerCase(),
+                r = -1 !== a.indexOf("webkit"),
+                h = -1 !== a.indexOf("chrome"),
+                l = -1 !== a.indexOf("phantom"),
+                u = -1 !== a.indexOf("android"),
+                c = -1 !== a.search("android [23]"),
+                d = -1 !== a.indexOf("gecko"),
+                p = typeof orientation != i + "",
+                _ = t.navigator && t.navigator.msPointerEnabled && t.navigator.msMaxTouchPoints && !t.PointerEvent,
+                m = t.PointerEvent && t.navigator.pointerEnabled && t.navigator.maxTouchPoints || _,
                 f = "devicePixelRatio" in t && t.devicePixelRatio > 1 || "matchMedia" in t && t.matchMedia("(min-resolution:144dpi)") && t.matchMedia("(min-resolution:144dpi)").matches,
                 g = e.documentElement,
                 v = n && "transition" in g.style,
-                y = "WebKitCSSMatrix" in t && "m11" in new t.WebKitCSSMatrix,
-                L = "MozPerspective" in g.style,
-                P = "OTransition" in g.style,
-                x = !t.L_DISABLE_3D && (v || y || L || P) && !c,
-                w = !t.L_NO_TOUCH && !c && function() {
+                y = "WebKitCSSMatrix" in t && "m11" in new t.WebKitCSSMatrix && !c,
+                P = "MozPerspective" in g.style,
+                L = "OTransition" in g.style,
+                x = !t.L_DISABLE_3D && (v || y || P || L) && !l,
+                w = !t.L_NO_TOUCH && !l && function() {
                     var t = "ontouchstart";
                     if (m || t in g) return !0;
                     var i = e.createElement("div"),
                         n = !1;
                     return i.setAttribute ? (i.setAttribute(t, "return;"), "function" == typeof i[t] && (n = !0), i.removeAttribute(t), i = null, n) : !1
                 }();
             o.Browser = {
                 ie: n,
-                ie6: s,
-                ie7: a,
-                ielt9: r,
-                webkit: l,
-                android: d,
-                android23: p,
-                chrome: u,
+                ielt9: s,
+                webkit: r,
+                gecko: d && !r && !t.opera && !n,
+                android: u,
+                android23: c,
+                chrome: h,
                 ie3d: v,
                 webkit3d: y,
-                gecko3d: L,
-                opera3d: P,
+                gecko3d: P,
+                opera3d: L,
                 any3d: x,
-                mobile: _,
-                mobileWebkit: _ && l,
-                mobileWebkit3d: _ && y,
-                mobileOpera: _ && t.opera,
+                mobile: p,
+                mobileWebkit: p && r,
+                mobileWebkit3d: p && y,
+                mobileOpera: p && t.opera,
                 touch: w,
-                msTouch: m,
+                msPointer: _,
+                pointer: m,
                 retina: f
             }
         }(), o.Point = function(t, e, i) {
             this.x = i ? Math.round(t) : t, this.y = i ? Math.round(e) : e
         }, o.Point.prototype = {
             clone: function() {
                 return new o.Point(this.x, this.y)
@@ -359,53 +359,65 @@
                 return "auto" === n ? null : n
             },
             getViewportOffset: function(t) {
                 var i, n = 0,
                     s = 0,
                     a = t,
                     r = e.body,
-                    h = e.documentElement,
-                    l = o.Browser.ie7;
+                    h = e.documentElement;
                 do {
                     if (n += a.offsetTop || 0, s += a.offsetLeft || 0, n += parseInt(o.DomUtil.getStyle(a, "borderTopWidth"), 10) || 0, s += parseInt(o.DomUtil.getStyle(a, "borderLeftWidth"), 10) || 0, i = o.DomUtil.getStyle(a, "position"), a.offsetParent === r && "absolute" === i) break;
                     if ("fixed" === i) {
                         n += r.scrollTop || h.scrollTop || 0, s += r.scrollLeft || h.scrollLeft || 0;
                         break
                     }
                     if ("relative" === i && !a.offsetLeft) {
-                        var u = o.DomUtil.getStyle(a, "width"),
-                            c = o.DomUtil.getStyle(a, "max-width"),
-                            d = a.getBoundingClientRect();
-                        ("none" !== u || "none" !== c) && (s += d.left + a.clientLeft), n += d.top + (r.scrollTop || h.scrollTop || 0);
+                        var l = o.DomUtil.getStyle(a, "width"),
+                            u = o.DomUtil.getStyle(a, "max-width"),
+                            c = a.getBoundingClientRect();
+                        ("none" !== l || "none" !== u) && (s += c.left + a.clientLeft), n += c.top + (r.scrollTop || h.scrollTop || 0);
                         break
                     }
                     a = a.offsetParent
                 } while (a);
                 a = t;
                 do {
                     if (a === r) break;
-                    n -= a.scrollTop || 0, s -= a.scrollLeft || 0, o.DomUtil.documentIsLtr() || !o.Browser.webkit && !l || (s += a.scrollWidth - a.clientWidth, l && "hidden" !== o.DomUtil.getStyle(a, "overflow-y") && "hidden" !== o.DomUtil.getStyle(a, "overflow") && (s += 17)), a = a.parentNode
+                    n -= a.scrollTop || 0, s -= a.scrollLeft || 0, a = a.parentNode
                 } while (a);
                 return new o.Point(s, n)
             },
             documentIsLtr: function() {
                 return o.DomUtil._docIsLtrCached || (o.DomUtil._docIsLtrCached = !0, o.DomUtil._docIsLtr = "ltr" === o.DomUtil.getStyle(e.body, "direction")), o.DomUtil._docIsLtr
             },
             create: function(t, i, n) {
                 var o = e.createElement(t);
                 return o.className = i, n && n.appendChild(o), o
             },
             hasClass: function(t, e) {
-                return t.className.length > 0 && new RegExp("(^|\\s)" + e + "(\\s|$)").test(t.className)
+                if (t.classList !== i) return t.classList.contains(e);
+                var n = o.DomUtil._getClass(t);
+                return n.length > 0 && new RegExp("(^|\\s)" + e + "(\\s|$)").test(n)
             },
             addClass: function(t, e) {
-                o.DomUtil.hasClass(t, e) || (t.className += (t.className ? " " : "") + e)
+                if (t.classList !== i)
+                    for (var n = o.Util.splitWords(e), s = 0, a = n.length; a > s; s++) t.classList.add(n[s]);
+                else if (!o.DomUtil.hasClass(t, e)) {
+                    var r = o.DomUtil._getClass(t);
+                    o.DomUtil._setClass(t, (r ? r + " " : "") + e)
+                }
             },
             removeClass: function(t, e) {
-                t.className = o.Util.trim((" " + t.className + " ").replace(" " + e + " ", " "))
+                t.classList !== i ? t.classList.remove(e) : o.DomUtil._setClass(t, o.Util.trim((" " + o.DomUtil._getClass(t) + " ").replace(" " + e + " ", " ")))
+            },
+            _setClass: function(t, e) {
+                t.className.baseVal === i ? t.className = e : t.className.baseVal = e
+            },
+            _getClass: function(t) {
+                return t.className.baseVal === i ? t.className : t.className.baseVal
             },
             setOpacity: function(t, e) {
                 if ("opacity" in t.style) t.style.opacity = e;
                 else if ("filter" in t.style) {
                     var i = !1,
                         n = "DXImageTransform.Microsoft.Alpha";
                     try {
@@ -429,44 +441,54 @@
             },
             getScaleString: function(t, e) {
                 var i = o.DomUtil.getTranslateString(e.add(e.multiplyBy(-1 * t))),
                     n = " scale(" + t + ") ";
                 return i + n
             },
             setPosition: function(t, e, i) {
-                t._leaflet_pos = e, !i && o.Browser.any3d ? (t.style[o.DomUtil.TRANSFORM] = o.DomUtil.getTranslateString(e), o.Browser.mobileWebkit3d && (t.style.WebkitBackfaceVisibility = "hidden")) : (t.style.left = e.x + "px", t.style.top = e.y + "px")
+                t._leaflet_pos = e, !i && o.Browser.any3d ? t.style[o.DomUtil.TRANSFORM] = o.DomUtil.getTranslateString(e) : (t.style.left = e.x + "px", t.style.top = e.y + "px")
             },
             getPosition: function(t) {
                 return t._leaflet_pos
             }
         }, o.DomUtil.TRANSFORM = o.DomUtil.testProp(["transform", "WebkitTransform", "OTransform", "MozTransform", "msTransform"]), o.DomUtil.TRANSITION = o.DomUtil.testProp(["webkitTransition", "transition", "OTransition", "MozTransition", "msTransition"]), o.DomUtil.TRANSITION_END = "webkitTransition" === o.DomUtil.TRANSITION || "OTransition" === o.DomUtil.TRANSITION ? o.DomUtil.TRANSITION + "End" : "transitionend",
         function() {
-            var i = o.DomUtil.testProp(["userSelect", "WebkitUserSelect", "OUserSelect", "MozUserSelect", "msUserSelect"]);
-            o.extend(o.DomUtil, {
+            if ("onselectstart" in e) o.extend(o.DomUtil, {
                 disableTextSelection: function() {
-                    if (o.DomEvent.on(t, "selectstart", o.DomEvent.preventDefault), i) {
-                        var n = e.documentElement.style;
-                        this._userSelect = n[i], n[i] = "none"
-                    }
+                    o.DomEvent.on(t, "selectstart", o.DomEvent.preventDefault)
                 },
                 enableTextSelection: function() {
-                    o.DomEvent.off(t, "selectstart", o.DomEvent.preventDefault), i && (e.documentElement.style[i] = this._userSelect, delete this._userSelect)
-                },
+                    o.DomEvent.off(t, "selectstart", o.DomEvent.preventDefault)
+                }
+            });
+            else {
+                var i = o.DomUtil.testProp(["userSelect", "WebkitUserSelect", "OUserSelect", "MozUserSelect", "msUserSelect"]);
+                o.extend(o.DomUtil, {
+                    disableTextSelection: function() {
+                        if (i) {
+                            var t = e.documentElement.style;
+                            this._userSelect = t[i], t[i] = "none"
+                        }
+                    },
+                    enableTextSelection: function() {
+                        i && (e.documentElement.style[i] = this._userSelect, delete this._userSelect)
+                    }
+                })
+            }
+            o.extend(o.DomUtil, {
                 disableImageDrag: function() {
                     o.DomEvent.on(t, "dragstart", o.DomEvent.preventDefault)
                 },
                 enableImageDrag: function() {
                     o.DomEvent.off(t, "dragstart", o.DomEvent.preventDefault)
                 }
             })
-        }(), o.LatLng = function(t, e) {
-            var i = parseFloat(t),
-                n = parseFloat(e);
-            if (isNaN(i) || isNaN(n)) throw new Error("Invalid LatLng object: (" + t + ", " + e + ")");
-            this.lat = i, this.lng = n
+        }(), o.LatLng = function(t, e, n) {
+            if (t = parseFloat(t), e = parseFloat(e), isNaN(t) || isNaN(e)) throw new Error("Invalid LatLng object: (" + t + ", " + e + ")");
+            this.lat = t, this.lng = e, n !== i && (this.alt = parseFloat(n))
         }, o.extend(o.LatLng, {
             DEG_TO_RAD: Math.PI / 180,
             RAD_TO_DEG: 180 / Math.PI,
             MAX_MARGIN: 1e-9
         }), o.LatLng.prototype = {
             equals: function(t) {
                 if (!t) return !1;
@@ -491,21 +513,23 @@
                 return 2 * e * Math.atan2(Math.sqrt(u), Math.sqrt(1 - u))
             },
             wrap: function(t, e) {
                 var i = this.lng;
                 return t = t || -180, e = e || 180, i = (i + e) % (e - t) + (t > i || i === e ? e : t), new o.LatLng(this.lat, i)
             }
         }, o.latLng = function(t, e) {
-            return t instanceof o.LatLng ? t : o.Util.isArray(t) ? new o.LatLng(t[0], t[1]) : t === i || null === t ? t : "object" == typeof t && "lat" in t ? new o.LatLng(t.lat, "lng" in t ? t.lng : t.lon) : new o.LatLng(t, e)
+            return t instanceof o.LatLng ? t : o.Util.isArray(t) ? "number" == typeof t[0] || "string" == typeof t[0] ? new o.LatLng(t[0], t[1], t[2]) : null : t === i || null === t ? t : "object" == typeof t && "lat" in t ? new o.LatLng(t.lat, "lng" in t ? t.lng : t.lon) : e === i ? null : new o.LatLng(t, e)
         }, o.LatLngBounds = function(t, e) {
             if (t)
                 for (var i = e ? [t, e] : t, n = 0, o = i.length; o > n; n++) this.extend(i[n])
         }, o.LatLngBounds.prototype = {
             extend: function(t) {
-                return t ? (t = "number" == typeof t[0] || "string" == typeof t[0] || t instanceof o.LatLng ? o.latLng(t) : o.latLngBounds(t), t instanceof o.LatLng ? this._southWest || this._northEast ? (this._southWest.lat = Math.min(t.lat, this._southWest.lat), this._southWest.lng = Math.min(t.lng, this._southWest.lng), this._northEast.lat = Math.max(t.lat, this._northEast.lat), this._northEast.lng = Math.max(t.lng, this._northEast.lng)) : (this._southWest = new o.LatLng(t.lat, t.lng), this._northEast = new o.LatLng(t.lat, t.lng)) : t instanceof o.LatLngBounds && (this.extend(t._southWest), this.extend(t._northEast)), this) : this
+                if (!t) return this;
+                var e = o.latLng(t);
+                return t = null !== e ? e : o.latLngBounds(t), t instanceof o.LatLng ? this._southWest || this._northEast ? (this._southWest.lat = Math.min(t.lat, this._southWest.lat), this._southWest.lng = Math.min(t.lng, this._southWest.lng), this._northEast.lat = Math.max(t.lat, this._northEast.lat), this._northEast.lng = Math.max(t.lng, this._northEast.lng)) : (this._southWest = new o.LatLng(t.lat, t.lng), this._northEast = new o.LatLng(t.lat, t.lng)) : t instanceof o.LatLngBounds && (this.extend(t._southWest), this.extend(t._northEast)), this
             },
             pad: function(t) {
                 var e = this._southWest,
                     i = this._northEast,
                     n = Math.abs(e.lat - i.lat) * t,
                     s = Math.abs(e.lng - i.lng) * t;
                 return new o.LatLngBounds(new o.LatLng(e.lat - n, e.lng - s), new o.LatLng(i.lat + n, i.lng + s))
@@ -599,14 +623,18 @@
                 return this.projection.unproject(n)
             },
             project: function(t) {
                 return this.projection.project(t)
             },
             scale: function(t) {
                 return 256 * Math.pow(2, t)
+            },
+            getSize: function(t) {
+                var e = this.scale(t);
+                return o.point(e, e)
             }
         }, o.CRS.Simple = o.extend({}, o.CRS, {
             projection: o.Projection.LonLat,
             transformation: new o.Transformation(1, 0, -1, 0),
             scale: function(t) {
                 return Math.pow(2, t)
             }
@@ -630,25 +658,25 @@
             options: {
                 crs: o.CRS.EPSG3857,
                 fadeAnimation: o.DomUtil.TRANSITION && !o.Browser.android23,
                 trackResize: !0,
                 markerZoomAnimation: o.DomUtil.TRANSITION && o.Browser.any3d
             },
             initialize: function(t, e) {
-                e = o.setOptions(this, e), this._initContainer(t), this._initLayout(), this._initEvents(), e.maxBounds && this.setMaxBounds(e.maxBounds), e.center && e.zoom !== i && this.setView(o.latLng(e.center), e.zoom, {
+                e = o.setOptions(this, e), this._initContainer(t), this._initLayout(), this._onResize = o.bind(this._onResize, this), this._initEvents(), e.maxBounds && this.setMaxBounds(e.maxBounds), e.center && e.zoom !== i && this.setView(o.latLng(e.center), e.zoom, {
                     reset: !0
                 }), this._handlers = [], this._layers = {}, this._zoomBoundLayers = {}, this._tileLayersNum = 0, this.callInitHooks(), this._addLayers(e.layers)
             },
             setView: function(t, e) {
-                return this._resetView(o.latLng(t), this._limitZoom(e)), this
+                return e = e === i ? this.getZoom() : e, this._resetView(o.latLng(t), this._limitZoom(e)), this
             },
             setZoom: function(t, e) {
-                return this.setView(this.getCenter(), t, {
+                return this._loaded ? this.setView(this.getCenter(), t, {
                     zoom: e
-                })
+                }) : (this._zoom = this._limitZoom(t), this)
             },
             zoomIn: function(t, e) {
                 return this.setZoom(this._zoom + (t || 1), e)
             },
             zoomOut: function(t, e) {
                 return this.setZoom(this._zoom - (t || 1), e)
             },
@@ -667,15 +695,15 @@
                 var i = o.point(e.paddingTopLeft || e.padding || [0, 0]),
                     n = o.point(e.paddingBottomRight || e.padding || [0, 0]),
                     s = this.getBoundsZoom(t, !1, i.add(n)),
                     a = n.subtract(i).divideBy(2),
                     r = this.project(t.getSouthWest(), s),
                     h = this.project(t.getNorthEast(), s),
                     l = this.unproject(r.add(h).divideBy(2).add(a), s);
-                return this.setView(l, s, e)
+                return s = e && e.maxZoom ? Math.min(e.maxZoom, s) : s, this.setView(l, s, e)
             },
             fitWorld: function(t) {
                 return this.fitBounds([
                     [-90, -180],
                     [90, 180]
                 ], t)
             },
@@ -683,88 +711,86 @@
                 return this.setView(t, this._zoom, {
                     pan: e
                 })
             },
             panBy: function(t) {
                 return this.fire("movestart"), this._rawPanBy(o.point(t)), this.fire("move"), this.fire("moveend")
             },
-            setMaxBounds: function(t, e) {
-                if (t = o.latLngBounds(t), this.options.maxBounds = t, !t) return this._boundsMinZoom = null, this.off("moveend", this._panInsideMaxBounds, this), this;
-                var i = this.getBoundsZoom(t, !0);
-                return this._boundsMinZoom = i, this._loaded && (this._zoom < i ? this.setView(t.getCenter(), i, e) : this.panInsideBounds(t)), this.on("moveend", this._panInsideMaxBounds, this), this
+            setMaxBounds: function(t) {
+                return t = o.latLngBounds(t), this.options.maxBounds = t, t ? (this._loaded && this._panInsideMaxBounds(), this.on("moveend", this._panInsideMaxBounds, this)) : this.off("moveend", this._panInsideMaxBounds, this)
             },
-            panInsideBounds: function(t) {
-                t = o.latLngBounds(t);
-                var e = this.getPixelBounds(),
-                    i = e.getBottomLeft(),
-                    n = e.getTopRight(),
-                    s = this.project(t.getSouthWest()),
-                    a = this.project(t.getNorthEast()),
-                    r = 0,
-                    h = 0;
-                return n.y < a.y && (h = Math.ceil(a.y - n.y)), n.x > a.x && (r = Math.floor(a.x - n.x)), i.y > s.y && (h = Math.floor(s.y - i.y)), i.x < s.x && (r = Math.ceil(s.x - i.x)), r || h ? this.panBy([r, h]) : this
+            panInsideBounds: function(t, e) {
+                var i = this.getCenter(),
+                    n = this._limitCenter(i, this._zoom, t);
+                return i.equals(n) ? this : this.panTo(n, e)
             },
             addLayer: function(t) {
                 var e = o.stamp(t);
                 return this._layers[e] ? this : (this._layers[e] = t, !t.options || isNaN(t.options.maxZoom) && isNaN(t.options.minZoom) || (this._zoomBoundLayers[e] = t, this._updateZoomLevels()), this.options.zoomAnimation && o.TileLayer && t instanceof o.TileLayer && (this._tileLayersNum++, this._tileLayersToLoad++, t.on("load", this._onTileLayerLoad, this)), this._loaded && this._layerAdd(t), this)
             },
             removeLayer: function(t) {
                 var e = o.stamp(t);
-                if (this._layers[e]) return this._loaded && t.onRemove(this), delete this._layers[e], this._loaded && this.fire("layerremove", {
+                return this._layers[e] ? (this._loaded && t.onRemove(this), delete this._layers[e], this._loaded && this.fire("layerremove", {
                     layer: t
-                }), this._zoomBoundLayers[e] && (delete this._zoomBoundLayers[e], this._updateZoomLevels()), this.options.zoomAnimation && o.TileLayer && t instanceof o.TileLayer && (this._tileLayersNum--, this._tileLayersToLoad--, t.off("load", this._onTileLayerLoad, this)), this
+                }), this._zoomBoundLayers[e] && (delete this._zoomBoundLayers[e], this._updateZoomLevels()), this.options.zoomAnimation && o.TileLayer && t instanceof o.TileLayer && (this._tileLayersNum--, this._tileLayersToLoad--, t.off("load", this._onTileLayerLoad, this)), this) : this
             },
             hasLayer: function(t) {
                 return t ? o.stamp(t) in this._layers : !1
             },
             eachLayer: function(t, e) {
                 for (var i in this._layers) t.call(e, this._layers[i]);
                 return this
             },
             invalidateSize: function(t) {
+                if (!this._loaded) return this;
                 t = o.extend({
                     animate: !1,
                     pan: !0
                 }, t === !0 ? {
                     animate: !0
                 } : t);
                 var e = this.getSize();
-                if (this._sizeChanged = !0, this.options.maxBounds && this.setMaxBounds(this.options.maxBounds), !this._loaded) return this;
+                this._sizeChanged = !0, this._initialCenter = null;
                 var i = this.getSize(),
-                    n = e.subtract(i).divideBy(2).round();
-                return n.x || n.y ? (t.animate && t.pan ? this.panBy(n) : (t.pan && this._rawPanBy(n), this.fire("move"), clearTimeout(this._sizeTimer), this._sizeTimer = setTimeout(o.bind(this.fire, this, "moveend"), 200)), this.fire("resize", {
+                    n = e.divideBy(2).round(),
+                    s = i.divideBy(2).round(),
+                    a = n.subtract(s);
+                return a.x || a.y ? (t.animate && t.pan ? this.panBy(a) : (t.pan && this._rawPanBy(a), this.fire("move"), t.debounceMoveend ? (clearTimeout(this._sizeTimer), this._sizeTimer = setTimeout(o.bind(this.fire, this, "moveend"), 200)) : this.fire("moveend")), this.fire("resize", {
                     oldSize: e,
                     newSize: i
                 })) : this
             },
             addHandler: function(t, e) {
-                if (e) {
-                    var i = this[t] = new e(this);
-                    return this._handlers.push(i), this.options[t] && i.enable(), this
-                }
+                if (!e) return this;
+                var i = this[t] = new e(this);
+                return this._handlers.push(i), this.options[t] && i.enable(), this
             },
             remove: function() {
-                return this._loaded && this.fire("unload"), this._initEvents("off"), delete this._container._leaflet, this._clearPanes(), this._clearControlPos && this._clearControlPos(), this._clearHandlers(), this
+                this._loaded && this.fire("unload"), this._initEvents("off");
+                try {
+                    delete this._container._leaflet
+                } catch (t) {
+                    this._container._leaflet = i
+                }
+                return this._clearPanes(), this._clearControlPos && this._clearControlPos(), this._clearHandlers(), this
             },
             getCenter: function() {
-                return this._checkIfLoaded(), this._moved() ? this.layerPointToLatLng(this._getCenterLayerPoint()) : this._initialCenter
+                return this._checkIfLoaded(), this._initialCenter && !this._moved() ? this._initialCenter : this.layerPointToLatLng(this._getCenterLayerPoint())
             },
             getZoom: function() {
                 return this._zoom
             },
             getBounds: function() {
                 var t = this.getPixelBounds(),
                     e = this.unproject(t.getBottomLeft()),
                     i = this.unproject(t.getTopRight());
                 return new o.LatLngBounds(e, i)
             },
             getMinZoom: function() {
-                var t = this._layersMinZoom === i ? 0 : this._layersMinZoom,
-                    e = this._boundsMinZoom === i ? 0 : this._boundsMinZoom;
-                return this.options.minZoom === i ? Math.max(t, e) : this.options.minZoom
+                return this.options.minZoom === i ? this._layersMinZoom === i ? 0 : this._layersMinZoom : this.options.minZoom
             },
             getMaxZoom: function() {
                 return this.options.maxZoom === i ? this._layersMaxZoom === i ? 1 / 0 : this._layersMaxZoom : this.options.maxZoom
             },
             getBoundsZoom: function(t, e, i) {
                 t = o.latLngBounds(t);
                 var n, s = this.getMinZoom() - (e ? 1 : 0),
@@ -840,15 +866,15 @@
                 var e = this._container = o.DomUtil.get(t);
                 if (!e) throw new Error("Map container not found.");
                 if (e._leaflet) throw new Error("Map container is already initialized.");
                 e._leaflet = !0
             },
             _initLayout: function() {
                 var t = this._container;
-                o.DomUtil.addClass(t, "leaflet-container" + (o.Browser.touch ? " leaflet-touch" : "") + (o.Browser.retina ? " leaflet-retina" : "") + (this.options.fadeAnimation ? " leaflet-fade-anim" : ""));
+                o.DomUtil.addClass(t, "leaflet-container" + (o.Browser.touch ? " leaflet-touch" : "") + (o.Browser.retina ? " leaflet-retina" : "") + (o.Browser.ielt9 ? " leaflet-oldie" : "") + (this.options.fadeAnimation ? " leaflet-fade-anim" : ""));
                 var e = o.DomUtil.getStyle(t, "position");
                 "absolute" !== e && "relative" !== e && "fixed" !== e && (t.style.position = "relative"), this._initPanes(), this._initControlPos && this._initControlPos()
             },
             _initPanes: function() {
                 var t = this._panes = {};
                 this._mapPane = t.mapPane = this._createPane("leaflet-map-pane", this._container), this._tilePane = t.tilePane = this._createPane("leaflet-tile-pane", this._mapPane), t.objectsPane = this._createPane("leaflet-objects-pane", this._mapPane), t.shadowPane = this._createPane("leaflet-shadow-pane"), t.overlayPane = this._createPane("leaflet-overlay-pane"), t.markerPane = this._createPane("leaflet-marker-pane"), t.popupPane = this._createPane("leaflet-popup-pane");
                 var e = " leaflet-zoom-hide";
@@ -901,18 +927,22 @@
                     e = e || "on", o.DomEvent[e](this._container, "click", this._onMouseClick, this);
                     var i, n, s = ["dblclick", "mousedown", "mouseup", "mouseenter", "mouseleave", "mousemove", "contextmenu"];
                     for (i = 0, n = s.length; n > i; i++) o.DomEvent[e](this._container, s[i], this._fireMouseEvent, this);
                     this.options.trackResize && o.DomEvent[e](t, "resize", this._onResize, this)
                 }
             },
             _onResize: function() {
-                o.Util.cancelAnimFrame(this._resizeRequest), this._resizeRequest = o.Util.requestAnimFrame(this.invalidateSize, this, !1, this._container)
+                o.Util.cancelAnimFrame(this._resizeRequest), this._resizeRequest = o.Util.requestAnimFrame(function() {
+                    this.invalidateSize({
+                        debounceMoveend: !0
+                    })
+                }, this, !1, this._container)
             },
             _onMouseClick: function(t) {
-                !this._loaded || !t._simulated && this.dragging && this.dragging.moved() || o.DomEvent._skipped(t) || (this.fire("preclick"), this._fireMouseEvent(t))
+                !this._loaded || !t._simulated && (this.dragging && this.dragging.moved() || this.boxZoom && this.boxZoom.moved()) || o.DomEvent._skipped(t) || (this.fire("preclick"), this._fireMouseEvent(t))
             },
             _fireMouseEvent: function(t) {
                 if (this._loaded && !o.DomEvent._skipped(t)) {
                     var e = t.type;
                     if (e = "mouseenter" === e ? "mouseover" : "mouseleave" === e ? "mouseout" : e, this.hasEventListeners(e)) {
                         "contextmenu" === e && o.DomEvent.preventDefault(t);
                         var i = this.mouseEventToContainerPoint(t),
@@ -961,14 +991,38 @@
             },
             _getCenterLayerPoint: function() {
                 return this.containerPointToLayerPoint(this.getSize()._divideBy(2))
             },
             _getCenterOffset: function(t) {
                 return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())
             },
+            _limitCenter: function(t, e, i) {
+                if (!i) return t;
+                var n = this.project(t, e),
+                    s = this.getSize().divideBy(2),
+                    a = new o.Bounds(n.subtract(s), n.add(s)),
+                    r = this._getBoundsOffset(a, i, e);
+                return this.unproject(n.add(r), e)
+            },
+            _limitOffset: function(t, e) {
+                if (!e) return t;
+                var i = this.getPixelBounds(),
+                    n = new o.Bounds(i.min.add(t), i.max.add(t));
+                return t.add(this._getBoundsOffset(n, e))
+            },
+            _getBoundsOffset: function(t, e, i) {
+                var n = this.project(e.getNorthWest(), i).subtract(t.min),
+                    s = this.project(e.getSouthEast(), i).subtract(t.max),
+                    a = this._rebound(n.x, -s.x),
+                    r = this._rebound(n.y, -s.y);
+                return new o.Point(a, r)
+            },
+            _rebound: function(t, e) {
+                return t + e > 0 ? Math.round(t - e) / 2 : Math.max(0, Math.ceil(t)) - Math.max(0, Math.floor(e))
+            },
             _limitZoom: function(t) {
                 var e = this.getMinZoom(),
                     i = this.getMaxZoom();
                 return Math.max(e, Math.min(i, t))
             }
         }), o.map = function(t, e) {
             return new o.Map(t, e)
@@ -997,16 +1051,16 @@
             }
         }, o.CRS.EPSG3395 = o.extend({}, o.CRS, {
             code: "EPSG:3395",
             projection: o.Projection.Mercator,
             transformation: function() {
                 var t = o.Projection.Mercator,
                     e = t.R_MAJOR,
-                    i = t.R_MINOR;
-                return new o.Transformation(.5 / (Math.PI * e), .5, -.5 / (Math.PI * i), .5)
+                    i = .5 / (Math.PI * e);
+                return new o.Transformation(i, .5, -i, .5)
             }()
         }), o.TileLayer = o.Class.extend({
             includes: o.Mixin.Events,
             options: {
                 minZoom: 0,
                 maxZoom: 18,
                 tileSize: 256,
@@ -1020,15 +1074,15 @@
             },
             initialize: function(t, e) {
                 e = o.setOptions(this, e), e.detectRetina && o.Browser.retina && e.maxZoom > 0 && (e.tileSize = Math.floor(e.tileSize / 2), e.zoomOffset++, e.minZoom > 0 && e.minZoom--, this.options.maxZoom--), e.bounds && (e.bounds = o.latLngBounds(e.bounds)), this._url = t;
                 var i = this.options.subdomains;
                 "string" == typeof i && (this.options.subdomains = i.split(""))
             },
             onAdd: function(t) {
-                this._map = t, this._animated = t._zoomAnimated, this._initContainer(), this._createTileProto(), t.on({
+                this._map = t, this._animated = t._zoomAnimated, this._initContainer(), t.on({
                     viewreset: this._reset,
                     moveend: this._update
                 }, this), this._animated && t.on({
                     zoomanim: this._animateZoom,
                     zoomend: this._endZoomAnim
                 }, this), this.options.updateWhenIdle || (this._limitedUpdate = o.Util.limitExecByInterval(this._update, 150, this), t.on("move", this._limitedUpdate, this)), this._reset(), this._update()
             },
@@ -1087,34 +1141,42 @@
                     for (t in e) o.DomUtil.setOpacity(e[t], this.options.opacity);
                 else o.DomUtil.setOpacity(this._container, this.options.opacity)
             },
             _initContainer: function() {
                 var t = this._map._panes.tilePane;
                 if (!this._container) {
                     if (this._container = o.DomUtil.create("div", "leaflet-layer"), this._updateZIndex(), this._animated) {
-                        var e = "leaflet-tile-container leaflet-zoom-animated";
+                        var e = "leaflet-tile-container";
                         this._bgBuffer = o.DomUtil.create("div", e, this._container), this._tileContainer = o.DomUtil.create("div", e, this._container)
                     } else this._tileContainer = this._container;
                     t.appendChild(this._container), this.options.opacity < 1 && this._updateOpacity()
                 }
             },
             _reset: function(t) {
                 for (var e in this._tiles) this.fire("tileunload", {
                     tile: this._tiles[e]
                 });
                 this._tiles = {}, this._tilesToLoad = 0, this.options.reuseTiles && (this._unusedTiles = []), this._tileContainer.innerHTML = "", this._animated && t && t.hard && this._clearBgBuffer(), this._initContainer()
             },
+            _getTileSize: function() {
+                var t = this._map,
+                    e = t.getZoom() + this.options.zoomOffset,
+                    i = this.options.maxNativeZoom,
+                    n = this.options.tileSize;
+                return i && e > i && (n = Math.round(t.getZoomScale(e) / t.getZoomScale(i) * n)), n
+            },
             _update: function() {
                 if (this._map) {
-                    var t = this._map.getPixelBounds(),
-                        e = this._map.getZoom(),
-                        i = this.options.tileSize;
-                    if (!(e > this.options.maxZoom || e < this.options.minZoom)) {
-                        var n = o.bounds(t.min.divideBy(i)._floor(), t.max.divideBy(i)._floor());
-                        this._addTilesFromCenterOut(n), (this.options.unloadInvisibleTiles || this.options.reuseTiles) && this._removeOtherTiles(n)
+                    var t = this._map,
+                        e = t.getPixelBounds(),
+                        i = t.getZoom(),
+                        n = this._getTileSize();
+                    if (!(i > this.options.maxZoom || i < this.options.minZoom)) {
+                        var s = o.bounds(e.min.divideBy(n)._floor(), e.max.divideBy(n)._floor());
+                        this._addTilesFromCenterOut(s), (this.options.unloadInvisibleTiles || this.options.reuseTiles) && this._removeOtherTiles(s)
                     }
                 }
             },
             _addTilesFromCenterOut: function(t) {
                 var i, n, s, a = [],
                     r = t.getCenter();
                 for (i = t.min.y; i <= t.max.y; i++)
@@ -1130,15 +1192,15 @@
                 }
             },
             _tileShouldBeLoaded: function(t) {
                 if (t.x + ":" + t.y in this._tiles) return !1;
                 var e = this.options;
                 if (!e.continuousWorld) {
                     var i = this._getWrapTileNum();
-                    if (e.noWrap && (t.x < 0 || t.x >= i) || t.y < 0 || t.y >= i) return !1
+                    if (e.noWrap && (t.x < 0 || t.x >= i.x) || t.y < 0 || t.y >= i.y) return !1
                 }
                 if (e.bounds) {
                     var n = e.tileSize,
                         o = t.multiplyBy(n),
                         s = o.add([n, n]),
                         a = this._map.unproject(o),
                         r = this._map.unproject(s);
@@ -1156,66 +1218,67 @@
                     tile: e,
                     url: e.src
                 }), this.options.reuseTiles ? (o.DomUtil.removeClass(e, "leaflet-tile-loaded"), this._unusedTiles.push(e)) : e.parentNode === this._tileContainer && this._tileContainer.removeChild(e), o.Browser.android || (e.onload = null, e.src = o.Util.emptyImageUrl), delete this._tiles[t]
             },
             _addTile: function(t, e) {
                 var i = this._getTilePos(t),
                     n = this._getTile();
-                o.DomUtil.setPosition(n, i, o.Browser.chrome || o.Browser.android23), this._tiles[t.x + ":" + t.y] = n, this._loadTile(n, t), n.parentNode !== this._tileContainer && e.appendChild(n)
+                o.DomUtil.setPosition(n, i, o.Browser.chrome), this._tiles[t.x + ":" + t.y] = n, this._loadTile(n, t), n.parentNode !== this._tileContainer && e.appendChild(n)
             },
             _getZoomForUrl: function() {
                 var t = this.options,
                     e = this._map.getZoom();
-                return t.zoomReverse && (e = t.maxZoom - e), e + t.zoomOffset
+                return t.zoomReverse && (e = t.maxZoom - e), e += t.zoomOffset, t.maxNativeZoom ? Math.min(e, t.maxNativeZoom) : e
             },
             _getTilePos: function(t) {
                 var e = this._map.getPixelOrigin(),
-                    i = this.options.tileSize;
+                    i = this._getTileSize();
                 return t.multiplyBy(i).subtract(e)
             },
             getTileUrl: function(t) {
                 return o.Util.template(this._url, o.extend({
                     s: this._getSubdomain(t),
                     z: t.z,
                     x: t.x,
                     y: t.y
                 }, this.options))
             },
             _getWrapTileNum: function() {
-                return Math.pow(2, this._getZoomForUrl())
+                var t = this._map.options.crs,
+                    e = t.getSize(this._map.getZoom());
+                return e.divideBy(this.options.tileSize)
             },
             _adjustTilePoint: function(t) {
                 var e = this._getWrapTileNum();
-                this.options.continuousWorld || this.options.noWrap || (t.x = (t.x % e + e) % e), this.options.tms && (t.y = e - t.y - 1), t.z = this._getZoomForUrl()
+                this.options.continuousWorld || this.options.noWrap || (t.x = (t.x % e.x + e.x) % e.x), this.options.tms && (t.y = e.y - t.y - 1), t.z = this._getZoomForUrl()
             },
             _getSubdomain: function(t) {
                 var e = Math.abs(t.x + t.y) % this.options.subdomains.length;
                 return this.options.subdomains[e]
             },
-            _createTileProto: function() {
-                var t = this._tileImg = o.DomUtil.create("img", "leaflet-tile");
-                t.style.width = t.style.height = this.options.tileSize + "px", t.galleryimg = "no"
-            },
             _getTile: function() {
                 if (this.options.reuseTiles && this._unusedTiles.length > 0) {
                     var t = this._unusedTiles.pop();
                     return this._resetTile(t), t
                 }
                 return this._createTile()
             },
             _resetTile: function() {},
             _createTile: function() {
-                var t = this._tileImg.cloneNode(!1);
-                return t.onselectstart = t.onmousemove = o.Util.falseFn, o.Browser.ielt9 && this.options.opacity !== i && o.DomUtil.setOpacity(t, this.options.opacity), t
+                var t = o.DomUtil.create("img", "leaflet-tile");
+                return t.style.width = t.style.height = this._getTileSize() + "px", t.galleryimg = "no", t.onselectstart = t.onmousemove = o.Util.falseFn, o.Browser.ielt9 && this.options.opacity !== i && o.DomUtil.setOpacity(t, this.options.opacity), o.Browser.mobileWebkit3d && (t.style.WebkitBackfaceVisibility = "hidden"), t
             },
             _loadTile: function(t, e) {
-                t._layer = this, t.onload = this._tileOnLoad, t.onerror = this._tileOnError, this._adjustTilePoint(e), t.src = this.getTileUrl(e)
+                t._layer = this, t.onload = this._tileOnLoad, t.onerror = this._tileOnError, this._adjustTilePoint(e), t.src = this.getTileUrl(e), this.fire("tileloadstart", {
+                    tile: t,
+                    url: t.src
+                })
             },
             _tileLoaded: function() {
-                this._tilesToLoad--, this._tilesToLoad || (this.fire("load"), this._animated && (clearTimeout(this._clearBgBufferTimer), this._clearBgBufferTimer = setTimeout(o.bind(this._clearBgBuffer, this), 500)))
+                this._tilesToLoad--, this._animated && o.DomUtil.addClass(this._tileContainer, "leaflet-zoom-animated"), this._tilesToLoad || (this.fire("load"), this._animated && (clearTimeout(this._clearBgBufferTimer), this._clearBgBufferTimer = setTimeout(o.bind(this._clearBgBuffer, this), 500)))
             },
             _tileOnLoad: function() {
                 var t = this._layer;
                 this.src !== o.Util.emptyImageUrl && (o.DomUtil.addClass(this, "leaflet-tile-loaded"), t.fire("tileload", {
                     tile: this,
                     url: this.src
                 })), t._tileLoaded()
@@ -1246,30 +1309,30 @@
                 var i = o.extend({}, this.defaultWmsParams),
                     n = e.tileSize || this.options.tileSize;
                 i.width = i.height = e.detectRetina && o.Browser.retina ? 2 * n : n;
                 for (var s in e) this.options.hasOwnProperty(s) || "crs" === s || (i[s] = e[s]);
                 this.wmsParams = i, o.setOptions(this, e)
             },
             onAdd: function(t) {
-                this._crs = this.options.crs || t.options.crs;
-                var e = parseFloat(this.wmsParams.version) >= 1.3 ? "crs" : "srs";
+                this._crs = this.options.crs || t.options.crs, this._wmsVersion = parseFloat(this.wmsParams.version);
+                var e = this._wmsVersion >= 1.3 ? "crs" : "srs";
                 this.wmsParams[e] = this._crs.code, o.TileLayer.prototype.onAdd.call(this, t)
             },
-            getTileUrl: function(t, e) {
-                var i = this._map,
-                    n = this.options.tileSize,
-                    s = t.multiplyBy(n),
-                    a = s.add([n, n]),
-                    r = this._crs.project(i.unproject(s, e)),
-                    h = this._crs.project(i.unproject(a, e)),
-                    l = [r.x, h.y, h.x, r.y].join(","),
-                    u = o.Util.template(this._url, {
+            getTileUrl: function(t) {
+                var e = this._map,
+                    i = this.options.tileSize,
+                    n = t.multiplyBy(i),
+                    s = n.add([i, i]),
+                    a = this._crs.project(e.unproject(n, t.z)),
+                    r = this._crs.project(e.unproject(s, t.z)),
+                    h = this._wmsVersion >= 1.3 && this._crs === o.CRS.EPSG4326 ? [r.y, a.x, a.y, r.x].join(",") : [a.x, r.y, r.x, a.y].join(","),
+                    l = o.Util.template(this._url, {
                         s: this._getSubdomain(t)
                     });
-                return u + o.Util.getParamString(this.wmsParams, u, !0) + "&BBOX=" + l
+                return l + o.Util.getParamString(this.wmsParams, l, !0) + "&BBOX=" + h
             },
             setParams: function(t, e) {
                 return o.extend(this.wmsParams, t), e || this.redraw(), this
             }
         }), o.tileLayer.wms = function(t, e) {
             return new o.TileLayer.WMS(t, e)
         }, o.TileLayer.Canvas = o.TileLayer.extend({
@@ -1285,21 +1348,17 @@
                 }), this._update());
                 for (var t in this._tiles) this._redrawTile(this._tiles[t]);
                 return this
             },
             _redrawTile: function(t) {
                 this.drawTile(t, t._tilePoint, this._map._zoom)
             },
-            _createTileProto: function() {
-                var t = this._canvasProto = o.DomUtil.create("canvas", "leaflet-tile");
-                t.width = t.height = this.options.tileSize
-            },
             _createTile: function() {
-                var t = this._canvasProto.cloneNode(!1);
-                return t.onselectstart = t.onmousemove = o.Util.falseFn, t
+                var t = o.DomUtil.create("canvas", "leaflet-tile");
+                return t.width = t.height = this.options.tileSize, t.onselectstart = t.onmousemove = o.Util.falseFn, t
             },
             _loadTile: function(t, e) {
                 t._layer = this, t._tilePoint = e, this._redrawTile(t), this.options.async || this.tileDrawn(t)
             },
             drawTile: function() {},
             tileDrawn: function(t) {
                 this._tileOnLoad.call(t)
@@ -1329,14 +1388,20 @@
             bringToFront: function() {
                 return this._image && this._map._panes.overlayPane.appendChild(this._image), this
             },
             bringToBack: function() {
                 var t = this._map._panes.overlayPane;
                 return this._image && t.insertBefore(this._image, t.firstChild), this
             },
+            setUrl: function(t) {
+                this._url = t, this._image.src = this._url
+            },
+            getAttribution: function() {
+                return this.options.attribution
+            },
             _initImage: function() {
                 this._image = o.DomUtil.create("img", "leaflet-image-layer"), this._map.options.zoomAnimation && o.Browser.any3d ? o.DomUtil.addClass(this._image, "leaflet-zoom-animated") : o.DomUtil.addClass(this._image, "leaflet-zoom-hide"), this._updateOpacity(), o.extend(this._image, {
                     galleryimg: "no",
                     onselectstart: o.Util.falseFn,
                     onmousemove: o.Util.falseFn,
                     onload: o.bind(this._onImageLoad, this),
                     src: this._url
@@ -1391,15 +1456,15 @@
             },
             _setIconStyles: function(t, e) {
                 var i, n = this.options,
                     s = o.point(n[e + "Size"]);
                 i = "shadow" === e ? o.point(n.shadowAnchor || n.iconAnchor) : o.point(n.iconAnchor), !i && s && (i = s.divideBy(2, !0)), t.className = "leaflet-marker-" + e + " " + n.className, i && (t.style.marginLeft = -i.x + "px", t.style.marginTop = -i.y + "px"), s && (t.style.width = s.x + "px", t.style.height = s.y + "px")
             },
             _createImg: function(t, i) {
-                return o.Browser.ie6 ? (i || (i = e.createElement("div")), i.style.filter = 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="' + t + '")') : (i || (i = e.createElement("img")), i.src = t), i
+                return i = i || e.createElement("img"), i.src = t, i
             },
             _getIconUrl: function(t) {
                 return o.Browser.retina && this.options[t + "RetinaUrl"] ? this.options[t + "RetinaUrl"] : this.options[t + "Url"]
             }
         }), o.icon = function(t) {
             return new o.Icon(t)
         }, o.Icon.Default = o.Icon.extend({
@@ -1423,27 +1488,28 @@
             for (t = 0, i = a.length; i > t; t++)
                 if (n = a[t].src, o = n.match(r)) return s = n.split(r)[0], (s ? s + "/" : "") + "images"
         }(), o.Marker = o.Class.extend({
             includes: o.Mixin.Events,
             options: {
                 icon: new o.Icon.Default,
                 title: "",
+                alt: "",
                 clickable: !0,
                 draggable: !1,
                 keyboard: !0,
                 zIndexOffset: 0,
                 opacity: 1,
                 riseOnHover: !1,
                 riseOffset: 250
             },
             initialize: function(t, e) {
                 o.setOptions(this, e), this._latlng = o.latLng(t)
             },
             onAdd: function(t) {
-                this._map = t, t.on("viewreset", this.update, this), this._initIcon(), this.update(), t.options.zoomAnimation && t.options.markerZoomAnimation && t.on("zoomanim", this._animateZoom, this)
+                this._map = t, t.on("viewreset", this.update, this), this._initIcon(), this.update(), this.fire("add"), t.options.zoomAnimation && t.options.markerZoomAnimation && t.on("zoomanim", this._animateZoom, this)
             },
             addTo: function(t) {
                 return t.addLayer(this), this
             },
             onRemove: function(t) {
                 this.dragging && this.dragging.disable(), this._removeIcon(), this._removeShadow(), this.fire("remove"), t.off({
                     viewreset: this.update,
@@ -1458,15 +1524,15 @@
                     latlng: this._latlng
                 })
             },
             setZIndexOffset: function(t) {
                 return this.options.zIndexOffset = t, this.update(), this
             },
             setIcon: function(t) {
-                return this.options.icon = t, this._map && (this._initIcon(), this.update()), this
+                return this.options.icon = t, this._map && (this._initIcon(), this.update()), this._popup && this.bindPopup(this._popup), this
             },
             update: function() {
                 if (this._icon) {
                     var t = this._map.latLngToLayerPoint(this._latlng).round();
                     this._setPos(t)
                 }
                 return this
@@ -1474,15 +1540,15 @@
             _initIcon: function() {
                 var t = this.options,
                     e = this._map,
                     i = e.options.zoomAnimation && e.options.markerZoomAnimation,
                     n = i ? "leaflet-zoom-animated" : "leaflet-zoom-hide",
                     s = t.icon.createIcon(this._icon),
                     a = !1;
-                s !== this._icon && (this._icon && this._removeIcon(), a = !0, t.title && (s.title = t.title)), o.DomUtil.addClass(s, n), t.keyboard && (s.tabIndex = "0"), this._icon = s, this._initInteraction(), t.riseOnHover && o.DomEvent.on(s, "mouseover", this._bringToFront, this).on(s, "mouseout", this._resetZIndex, this);
+                s !== this._icon && (this._icon && this._removeIcon(), a = !0, t.title && (s.title = t.title), t.alt && (s.alt = t.alt)), o.DomUtil.addClass(s, n), t.keyboard && (s.tabIndex = "0"), this._icon = s, this._initInteraction(), t.riseOnHover && o.DomEvent.on(s, "mouseover", this._bringToFront, this).on(s, "mouseout", this._resetZIndex, this);
                 var r = t.icon.createShadow(this._shadow),
                     h = !1;
                 r !== this._shadow && (this._removeShadow(), h = !0), r && o.DomUtil.addClass(r, n), this._shadow = r, t.opacity < 1 && this._updateOpacity();
                 var l = this._map._panes;
                 a && l.markerPane.appendChild(this._icon), r && h && l.shadowPane.appendChild(this._shadow)
             },
             _removeIcon: function() {
@@ -1494,15 +1560,15 @@
             _setPos: function(t) {
                 o.DomUtil.setPosition(this._icon, t), this._shadow && o.DomUtil.setPosition(this._shadow, t), this._zIndex = t.y + this.options.zIndexOffset, this._resetZIndex()
             },
             _updateZIndex: function(t) {
                 this._icon.style.zIndex = this._zIndex + t
             },
             _animateZoom: function(t) {
-                var e = this._map._latLngToNewLayerPoint(this._latlng, t.zoom, t.center);
+                var e = this._map._latLngToNewLayerPoint(this._latlng, t.zoom, t.center).round();
                 this._setPos(e)
             },
             _initInteraction: function() {
                 if (this.options.clickable) {
                     var t = this._icon,
                         e = ["dblclick", "mousedown", "mouseover", "mouseout", "contextmenu"];
                     o.DomUtil.addClass(t, "leaflet-clickable"), o.DomEvent.on(t, "click", this._onMouseClick, this), o.DomEvent.on(t, "keypress", this._onKeyPress, this);
@@ -1562,30 +1628,29 @@
         }, o.Map.mergeOptions({
             closePopupOnClick: !0
         }), o.Popup = o.Class.extend({
             includes: o.Mixin.Events,
             options: {
                 minWidth: 50,
                 maxWidth: 300,
-                maxHeight: null,
                 autoPan: !0,
                 closeButton: !0,
                 offset: [0, 7],
                 autoPanPadding: [5, 5],
                 keepInView: !1,
                 className: "",
                 zoomAnimation: !0
             },
             initialize: function(t, e) {
                 o.setOptions(this, t), this._source = e, this._animated = o.Browser.any3d && this.options.zoomAnimation, this._isOpen = !1
             },
             onAdd: function(t) {
-                this._map = t, this._container || this._initLayout(), this._updateContent();
+                this._map = t, this._container || this._initLayout();
                 var e = t.options.fadeAnimation;
-                e && o.DomUtil.setOpacity(this._container, 0), t._panes.popupPane.appendChild(this._container), t.on(this._getEvents(), this), this._update(), e && o.DomUtil.setOpacity(this._container, 1), this.fire("open"), t.fire("popupopen", {
+                e && o.DomUtil.setOpacity(this._container, 0), t._panes.popupPane.appendChild(this._container), t.on(this._getEvents(), this), this.update(), e && o.DomUtil.setOpacity(this._container, 1), this.fire("open"), t.fire("popupopen", {
                     popup: this
                 }), this._source && this._source.fire("popupopen", {
                     popup: this
                 })
             },
             addTo: function(t) {
                 return t.addLayer(this), this
@@ -1596,19 +1661,28 @@
             onRemove: function(t) {
                 t._panes.popupPane.removeChild(this._container), o.Util.falseFn(this._container.offsetWidth), t.off(this._getEvents(), this), t.options.fadeAnimation && o.DomUtil.setOpacity(this._container, 0), this._map = null, this.fire("close"), t.fire("popupclose", {
                     popup: this
                 }), this._source && this._source.fire("popupclose", {
                     popup: this
                 })
             },
+            getLatLng: function() {
+                return this._latlng
+            },
             setLatLng: function(t) {
-                return this._latlng = o.latLng(t), this._update(), this
+                return this._latlng = o.latLng(t), this._map && (this._updatePosition(), this._adjustPan()), this
+            },
+            getContent: function() {
+                return this._content
             },
             setContent: function(t) {
-                return this._content = t, this._update(), this
+                return this._content = t, this.update(), this
+            },
+            update: function() {
+                this._map && (this._container.style.visibility = "hidden", this._updateContent(), this._updateLayout(), this._updatePosition(), this._container.style.visibility = "", this._adjustPan())
             },
             _getEvents: function() {
                 var t = {
                     viewreset: this._updatePosition
                 };
                 return this._animated && (t.zoomanim = this._zoomAnimation), ("closeOnClick" in this.options ? this.options.closeOnClick : this._map.options.closePopupOnClick) && (t.preclick = this._close), this.options.keepInView && (t.moveend = this._adjustPan), t
             },
@@ -1617,18 +1691,15 @@
             },
             _initLayout: function() {
                 var t, e = "leaflet-popup",
                     i = e + " " + this.options.className + " leaflet-zoom-" + (this._animated ? "animated" : "hide"),
                     n = this._container = o.DomUtil.create("div", i);
                 this.options.closeButton && (t = this._closeButton = o.DomUtil.create("a", e + "-close-button", n), t.href = "#close", t.innerHTML = "&#215;", o.DomEvent.disableClickPropagation(t), o.DomEvent.on(t, "click", this._onCloseButtonClick, this));
                 var s = this._wrapper = o.DomUtil.create("div", e + "-content-wrapper", n);
-                o.DomEvent.disableClickPropagation(s), this._contentNode = o.DomUtil.create("div", e + "-content", s), o.DomEvent.on(this._contentNode, "mousewheel", o.DomEvent.stopPropagation), o.DomEvent.on(this._contentNode, "MozMousePixelScroll", o.DomEvent.stopPropagation), o.DomEvent.on(s, "contextmenu", o.DomEvent.stopPropagation), this._tipContainer = o.DomUtil.create("div", e + "-tip-container", n), this._tip = o.DomUtil.create("div", e + "-tip", this._tipContainer)
-            },
-            _update: function() {
-                this._map && (this._container.style.visibility = "hidden", this._updateContent(), this._updateLayout(), this._updatePosition(), this._container.style.visibility = "", this._adjustPan())
+                o.DomEvent.disableClickPropagation(s), this._contentNode = o.DomUtil.create("div", e + "-content", s), o.DomEvent.disableScrollPropagation(this._contentNode), o.DomEvent.on(s, "contextmenu", o.DomEvent.stopPropagation), this._tipContainer = o.DomUtil.create("div", e + "-tip-container", n), this._tip = o.DomUtil.create("div", e + "-tip", this._tipContainer)
             },
             _updateContent: function() {
                 if (this._content) {
                     if ("string" == typeof this._content) this._contentNode.innerHTML = this._content;
                     else {
                         for (; this._contentNode.hasChildNodes();) this._contentNode.removeChild(this._contentNode.firstChild);
                         this._contentNode.appendChild(this._content)
@@ -1664,18 +1735,20 @@
                     var t = this._map,
                         e = this._container.offsetHeight,
                         i = this._containerWidth,
                         n = new o.Point(this._containerLeft, -e - this._containerBottom);
                     this._animated && n._add(o.DomUtil.getPosition(this._container));
                     var s = t.layerPointToContainerPoint(n),
                         a = o.point(this.options.autoPanPadding),
-                        r = t.getSize(),
-                        h = 0,
-                        l = 0;
-                    s.x + i > r.x && (h = s.x + i - r.x + a.x), s.x - h < 0 && (h = s.x - a.x), s.y + e > r.y && (l = s.y + e - r.y + a.y), s.y - l < 0 && (l = s.y - a.y), (h || l) && t.fire("autopanstart").panBy([h, l])
+                        r = o.point(this.options.autoPanPaddingTopLeft || a),
+                        h = o.point(this.options.autoPanPaddingBottomRight || a),
+                        l = t.getSize(),
+                        u = 0,
+                        c = 0;
+                    s.x + i + h.x > l.x && (u = s.x + i - l.x + h.x), s.x - u - r.x < 0 && (u = s.x - r.x), s.y + e + h.y > l.y && (c = s.y + e - l.y + h.y), s.y - c - r.y < 0 && (c = s.y - r.y), (u || c) && t.fire("autopanstart").panBy([u, c])
                 }
             },
             _onCloseButtonClick: function(t) {
                 this._close(), o.DomEvent.stop(t)
             }
         }), o.popup = function(t, e) {
             return new o.Popup(t, e)
@@ -1700,21 +1773,24 @@
             togglePopup: function() {
                 return this._popup && (this._popup._isOpen ? this.closePopup() : this.openPopup()), this
             },
             bindPopup: function(t, e) {
                 var i = o.point(this.options.icon.options.popupAnchor || [0, 0]);
                 return i = i.add(o.Popup.prototype.options.offset), e && e.offset && (i = i.add(e.offset)), e = o.extend({
                     offset: i
-                }, e), this._popup || this.on("click", this.togglePopup, this).on("remove", this.closePopup, this).on("move", this._movePopup, this), t instanceof o.Popup ? (o.setOptions(t, e), this._popup = t) : this._popup = new o.Popup(e, this).setContent(t), this
+                }, e), this._popupHandlersAdded || (this.on("click", this.togglePopup, this).on("remove", this.closePopup, this).on("move", this._movePopup, this), this._popupHandlersAdded = !0), t instanceof o.Popup ? (o.setOptions(t, e), this._popup = t) : this._popup = new o.Popup(e, this).setContent(t), this
             },
             setPopupContent: function(t) {
                 return this._popup && this._popup.setContent(t), this
             },
             unbindPopup: function() {
-                return this._popup && (this._popup = null, this.off("click", this.togglePopup).off("remove", this.closePopup).off("move", this._movePopup)), this
+                return this._popup && (this._popup = null, this.off("click", this.togglePopup, this).off("remove", this.closePopup, this).off("move", this._movePopup, this), this._popupHandlersAdded = !1), this
+            },
+            getPopup: function() {
+                return this._popup
             },
             _movePopup: function(t) {
                 this._popup.setLatLng(t.latlng)
             }
         }), o.LayerGroup = o.Class.extend({
             initialize: function(t) {
                 this._layers = {};
@@ -1772,26 +1848,33 @@
             return new o.LayerGroup(t)
         }, o.FeatureGroup = o.LayerGroup.extend({
             includes: o.Mixin.Events,
             statics: {
                 EVENTS: "click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"
             },
             addLayer: function(t) {
-                return this.hasLayer(t) ? this : (t.on(o.FeatureGroup.EVENTS, this._propagateEvent, this), o.LayerGroup.prototype.addLayer.call(this, t), this._popupContent && t.bindPopup && t.bindPopup(this._popupContent, this._popupOptions), this.fire("layeradd", {
+                return this.hasLayer(t) ? this : ("on" in t && t.on(o.FeatureGroup.EVENTS, this._propagateEvent, this), o.LayerGroup.prototype.addLayer.call(this, t), this._popupContent && t.bindPopup && t.bindPopup(this._popupContent, this._popupOptions), this.fire("layeradd", {
                     layer: t
                 }))
             },
             removeLayer: function(t) {
                 return this.hasLayer(t) ? (t in this._layers && (t = this._layers[t]), t.off(o.FeatureGroup.EVENTS, this._propagateEvent, this), o.LayerGroup.prototype.removeLayer.call(this, t), this._popupContent && this.invoke("unbindPopup"), this.fire("layerremove", {
                     layer: t
                 })) : this
             },
             bindPopup: function(t, e) {
                 return this._popupContent = t, this._popupOptions = e, this.invoke("bindPopup", t, e)
             },
+            openPopup: function(t) {
+                for (var e in this._layers) {
+                    this._layers[e].openPopup(t);
+                    break
+                }
+                return this
+            },
             setStyle: function(t) {
                 return this.invoke("setStyle", t)
             },
             bringToFront: function() {
                 return this.invoke("bringToFront")
             },
             bringToBack: function() {
@@ -1800,15 +1883,18 @@
             getBounds: function() {
                 var t = new o.LatLngBounds;
                 return this.eachLayer(function(e) {
                     t.extend(e instanceof o.Marker ? e.getLatLng() : e.getBounds())
                 }), t
             },
             _propagateEvent: function(t) {
-                t.layer || (t.layer = t.target), t.target = this, this.fire(t.type, t)
+                t = o.extend({
+                    layer: t.target,
+                    target: this
+                }, t), this.fire(t.type, t)
             }
         }), o.featureGroup = function(t) {
             return new o.FeatureGroup(t)
         }, o.Path = o.Class.extend({
             includes: [o.Mixin.Events],
             statics: {
                 CLIP_PADDING: function() {
@@ -1817,14 +1903,16 @@
                     return Math.max(0, Math.min(.5, i))
                 }()
             },
             options: {
                 stroke: !0,
                 color: "#0033ff",
                 dashArray: null,
+                lineCap: null,
+                lineJoin: null,
                 weight: 5,
                 opacity: .5,
                 fill: !1,
                 fillColor: null,
                 fillOpacity: .2,
                 clickable: !0
             },
@@ -1881,29 +1969,29 @@
             _createElement: function(t) {
                 return e.createElementNS(o.Path.SVG_NS, t)
             },
             _initElements: function() {
                 this._map._initPathRoot(), this._initPath(), this._initStyle()
             },
             _initPath: function() {
-                this._container = this._createElement("g"), this._path = this._createElement("path"), this._container.appendChild(this._path)
+                this._container = this._createElement("g"), this._path = this._createElement("path"), this.options.className && o.DomUtil.addClass(this._path, this.options.className), this._container.appendChild(this._path)
             },
             _initStyle: function() {
                 this.options.stroke && (this._path.setAttribute("stroke-linejoin", "round"), this._path.setAttribute("stroke-linecap", "round")), this.options.fill && this._path.setAttribute("fill-rule", "evenodd"), this.options.pointerEvents && this._path.setAttribute("pointer-events", this.options.pointerEvents), this.options.clickable || this.options.pointerEvents || this._path.setAttribute("pointer-events", "none"), this._updateStyle()
             },
             _updateStyle: function() {
-                this.options.stroke ? (this._path.setAttribute("stroke", this.options.color), this._path.setAttribute("stroke-opacity", this.options.opacity), this._path.setAttribute("stroke-width", this.options.weight), this.options.dashArray ? this._path.setAttribute("stroke-dasharray", this.options.dashArray) : this._path.removeAttribute("stroke-dasharray")) : this._path.setAttribute("stroke", "none"), this.options.fill ? (this._path.setAttribute("fill", this.options.fillColor || this.options.color), this._path.setAttribute("fill-opacity", this.options.fillOpacity)) : this._path.setAttribute("fill", "none")
+                this.options.stroke ? (this._path.setAttribute("stroke", this.options.color), this._path.setAttribute("stroke-opacity", this.options.opacity), this._path.setAttribute("stroke-width", this.options.weight), this.options.dashArray ? this._path.setAttribute("stroke-dasharray", this.options.dashArray) : this._path.removeAttribute("stroke-dasharray"), this.options.lineCap && this._path.setAttribute("stroke-linecap", this.options.lineCap), this.options.lineJoin && this._path.setAttribute("stroke-linejoin", this.options.lineJoin)) : this._path.setAttribute("stroke", "none"), this.options.fill ? (this._path.setAttribute("fill", this.options.fillColor || this.options.color), this._path.setAttribute("fill-opacity", this.options.fillOpacity)) : this._path.setAttribute("fill", "none")
             },
             _updatePath: function() {
                 var t = this.getPathString();
                 t || (t = "M0 0"), this._path.setAttribute("d", t)
             },
             _initEvents: function() {
                 if (this.options.clickable) {
-                    (o.Browser.svg || !o.Browser.vml) && this._path.setAttribute("class", "leaflet-clickable"), o.DomEvent.on(this._container, "click", this._onMouseClick, this);
+                    (o.Browser.svg || !o.Browser.vml) && o.DomUtil.addClass(this._path, "leaflet-clickable"), o.DomEvent.on(this._container, "click", this._onMouseClick, this);
                     for (var t = ["dblclick", "mousedown", "mouseover", "mouseout", "mousemove", "contextmenu"], e = 0; e < t.length; e++) o.DomEvent.on(this._container, t[e], this._fireMouseEvent, this)
                 }
             },
             _onMouseClick: function(t) {
                 this._map.dragging && this._map.dragging.moved() || this._fireMouseEvent(t)
             },
             _fireMouseEvent: function(t) {
@@ -1918,18 +2006,18 @@
                         containerPoint: i,
                         originalEvent: t
                     }), "contextmenu" === t.type && o.DomEvent.preventDefault(t), "mousemove" !== t.type && o.DomEvent.stopPropagation(t)
                 }
             }
         }), o.Map.include({
             _initPathRoot: function() {
-                this._pathRoot || (this._pathRoot = o.Path.prototype._createElement("svg"), this._panes.overlayPane.appendChild(this._pathRoot), this.options.zoomAnimation && o.Browser.any3d ? (this._pathRoot.setAttribute("class", " leaflet-zoom-animated"), this.on({
+                this._pathRoot || (this._pathRoot = o.Path.prototype._createElement("svg"), this._panes.overlayPane.appendChild(this._pathRoot), this.options.zoomAnimation && o.Browser.any3d ? (o.DomUtil.addClass(this._pathRoot, "leaflet-zoom-animated"), this.on({
                     zoomanim: this._animatePathZoom,
                     zoomend: this._endPathZoom
-                })) : this._pathRoot.setAttribute("class", " leaflet-zoom-hide"), this.on("moveend", this._updateSvgViewport), this._updateSvgViewport())
+                })) : o.DomUtil.addClass(this._pathRoot, "leaflet-zoom-hide"), this.on("moveend", this._updateSvgViewport), this._updateSvgViewport())
             },
             _animatePathZoom: function(t) {
                 var e = this.getZoomScale(t.zoom),
                     i = this._getCenterOffset(t.center)._multiplyBy(-e)._add(this._pathViewport.min);
                 this._pathRoot.style[o.DomUtil.TRANSFORM] = o.DomUtil.getTranslateString(i) + " scale(" + e + ") ", this._pathZooming = !0
             },
             _endPathZoom: function() {
@@ -1990,25 +2078,25 @@
                     return function(t) {
                         return e.createElement("<" + t + ' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')
                     }
                 }
             }(),
             _initPath: function() {
                 var t = this._container = this._createElement("shape");
-                o.DomUtil.addClass(t, "leaflet-vml-shape"), this.options.clickable && o.DomUtil.addClass(t, "leaflet-clickable"), t.coordsize = "1 1", this._path = this._createElement("path"), t.appendChild(this._path), this._map._pathRoot.appendChild(t)
+                o.DomUtil.addClass(t, "leaflet-vml-shape" + (this.options.className ? " " + this.options.className : "")), this.options.clickable && o.DomUtil.addClass(t, "leaflet-clickable"), t.coordsize = "1 1", this._path = this._createElement("path"), t.appendChild(this._path), this._map._pathRoot.appendChild(t)
             },
             _initStyle: function() {
                 this._updateStyle()
             },
             _updateStyle: function() {
                 var t = this._stroke,
                     e = this._fill,
                     i = this.options,
                     n = this._container;
-                n.stroked = i.stroke, n.filled = i.fill, i.stroke ? (t || (t = this._stroke = this._createElement("stroke"), t.endcap = "round", n.appendChild(t)), t.weight = i.weight + "px", t.color = i.color, t.opacity = i.opacity, t.dashStyle = i.dashArray ? i.dashArray instanceof Array ? i.dashArray.join(" ") : i.dashArray.replace(/( *, *)/g, " ") : "") : t && (n.removeChild(t), this._stroke = null), i.fill ? (e || (e = this._fill = this._createElement("fill"), n.appendChild(e)), e.color = i.fillColor || i.color, e.opacity = i.fillOpacity) : e && (n.removeChild(e), this._fill = null)
+                n.stroked = i.stroke, n.filled = i.fill, i.stroke ? (t || (t = this._stroke = this._createElement("stroke"), t.endcap = "round", n.appendChild(t)), t.weight = i.weight + "px", t.color = i.color, t.opacity = i.opacity, t.dashStyle = i.dashArray ? o.Util.isArray(i.dashArray) ? i.dashArray.join(" ") : i.dashArray.replace(/( *, *)/g, " ") : "", i.lineCap && (t.endcap = i.lineCap.replace("butt", "flat")), i.lineJoin && (t.joinstyle = i.lineJoin)) : t && (n.removeChild(t), this._stroke = null), i.fill ? (e || (e = this._fill = this._createElement("fill"), n.appendChild(e)), e.color = i.fillColor || i.color, e.opacity = i.fillOpacity) : e && (n.removeChild(e), this._fill = null)
             },
             _updatePath: function() {
                 var t = this._container.style;
                 t.display = "none", this._path.v = this.getPathString() + " ", t.display = ""
             }
         }), o.Map.include(o.Browser.svg || !o.Browser.vml ? {} : {
             _initPathRoot: function() {
@@ -2234,26 +2322,32 @@
             }
             return t
         }, o.Polygon = o.Polyline.extend({
             options: {
                 fill: !0
             },
             initialize: function(t, e) {
-                var i, n, s;
-                if (o.Polyline.prototype.initialize.call(this, t, e), t && o.Util.isArray(t[0]) && "number" != typeof t[0][0])
-                    for (this._latlngs = this._convertLatLngs(t[0]), this._holes = t.slice(1), i = 0, n = this._holes.length; n > i; i++) s = this._holes[i] = this._convertLatLngs(this._holes[i]), s[0].equals(s[s.length - 1]) && s.pop();
+                o.Polyline.prototype.initialize.call(this, t, e), this._initWithHoles(t)
+            },
+            _initWithHoles: function(t) {
+                var e, i, n;
+                if (t && o.Util.isArray(t[0]) && "number" != typeof t[0][0])
+                    for (this._latlngs = this._convertLatLngs(t[0]), this._holes = t.slice(1), e = 0, i = this._holes.length; i > e; e++) n = this._holes[e] = this._convertLatLngs(this._holes[e]), n[0].equals(n[n.length - 1]) && n.pop();
                 t = this._latlngs, t.length >= 2 && t[0].equals(t[t.length - 1]) && t.pop()
             },
             projectLatlngs: function() {
                 if (o.Polyline.prototype.projectLatlngs.call(this), this._holePoints = [], this._holes) {
                     var t, e, i, n;
                     for (t = 0, i = this._holes.length; i > t; t++)
                         for (this._holePoints[t] = [], e = 0, n = this._holes[t].length; n > e; e++) this._holePoints[t][e] = this._map.latLngToLayerPoint(this._holes[t][e])
                 }
             },
+            setLatLngs: function(t) {
+                return t && o.Util.isArray(t[0]) && "number" != typeof t[0][0] ? (this._initWithHoles(t), this.redraw()) : o.Polyline.prototype.setLatLngs.call(this, t)
+            },
             _clipPoints: function() {
                 var t = this._originalPoints,
                     e = [];
                 if (this._parts = [t].concat(this._holePoints), !this.options.noClip) {
                     for (var i = 0, n = this._parts.length; n > i; i++) {
                         var s = o.PolyUtil.clipPolygon(this._parts[i], this._map._pathViewport);
                         s.length && e.push(s)
@@ -2324,31 +2418,31 @@
                 var t = this._getLngRadius(),
                     e = this._latlng,
                     i = this._map.latLngToLayerPoint([e.lat, e.lng - t]);
                 this._point = this._map.latLngToLayerPoint(e), this._radius = Math.max(this._point.x - i.x, 1)
             },
             getBounds: function() {
                 var t = this._getLngRadius(),
-                    e = 360 * (this._mRadius / 40075017),
+                    e = this._mRadius / 40075017 * 360,
                     i = this._latlng;
                 return new o.LatLngBounds([i.lat - e, i.lng - t], [i.lat + e, i.lng + t])
             },
             getLatLng: function() {
                 return this._latlng
             },
             getPathString: function() {
                 var t = this._point,
                     e = this._radius;
-                return this._checkIfEmpty() ? "" : o.Browser.svg ? "M" + t.x + "," + (t.y - e) + "A" + e + "," + e + ",0,1,1," + (t.x - .1) + "," + (t.y - e) + " z" : (t._round(), e = Math.round(e), "AL " + t.x + "," + t.y + " " + e + "," + e + " 0," + 23592600)
+                return this._checkIfEmpty() ? "" : o.Browser.svg ? "M" + t.x + "," + (t.y - e) + "A" + e + "," + e + ",0,1,1," + (t.x - .1) + "," + (t.y - e) + " z" : (t._round(), e = Math.round(e), "AL " + t.x + "," + t.y + " " + e + "," + e + " 0,23592600")
             },
             getRadius: function() {
                 return this._mRadius
             },
             _getLatRadius: function() {
-                return 360 * (this._mRadius / 40075017)
+                return this._mRadius / 40075017 * 360
             },
             _getLngRadius: function() {
                 return this._getLatRadius() / Math.cos(o.LatLng.DEG_TO_RAD * this._latlng.lat)
             },
             _checkIfEmpty: function() {
                 if (!this._map) return !1;
                 var t = this._map._pathViewport,
@@ -2368,16 +2462,22 @@
             },
             projectLatlngs: function() {
                 this._point = this._map.latLngToLayerPoint(this._latlng)
             },
             _updateStyle: function() {
                 o.Circle.prototype._updateStyle.call(this), this.setRadius(this.options.radius)
             },
+            setLatLng: function(t) {
+                return o.Circle.prototype.setLatLng.call(this, t), this._popup && this._popup._isOpen && this._popup.setLatLng(t), this
+            },
             setRadius: function(t) {
                 return this.options.radius = this._radius = t, this.redraw()
+            },
+            getRadius: function() {
+                return this._radius
             }
         }), o.circleMarker = function(t, e) {
             return new o.CircleMarker(t, e)
         }, o.Polyline.include(o.Path.CANVAS ? {
             _containsPoint: function(t, e) {
                 var i, n, s, a, r, h, l, u = this.options.weight / 2;
                 for (o.Browser.touch && (u += 10), i = 0, a = this._parts.length; a > i; i++)
@@ -2415,15 +2515,15 @@
                 var e, i, n, s = o.Util.isArray(t) ? t : t.features;
                 if (s) {
                     for (e = 0, i = s.length; i > e; e++) n = s[e], (n.geometries || n.geometry || n.features || n.coordinates) && this.addData(s[e]);
                     return this
                 }
                 var a = this.options;
                 if (!a.filter || a.filter(t)) {
-                    var r = o.GeoJSON.geometryToLayer(t, a.pointToLayer, a.coordsToLatLng);
+                    var r = o.GeoJSON.geometryToLayer(t, a.pointToLayer, a.coordsToLatLng, a);
                     return r.feature = o.GeoJSON.asFeature(t), r.defaultOptions = r.options, this.resetStyle(r), a.onEachFeature && a.onEachFeature(t, r), this.addLayer(r)
                 }
             },
             resetStyle: function(t) {
                 var e = this.options.style;
                 e && (o.Util.extend(t.options, t.defaultOptions), this._setLayerStyle(t, e))
             },
@@ -2432,53 +2532,55 @@
                     this._setLayerStyle(e, t)
                 }, this)
             },
             _setLayerStyle: function(t, e) {
                 "function" == typeof e && (e = e(t.feature)), t.setStyle && t.setStyle(e)
             }
         }), o.extend(o.GeoJSON, {
-            geometryToLayer: function(t, e, i) {
-                var n, s, a, r, h, l = "Feature" === t.type ? t.geometry : t,
+            geometryToLayer: function(t, e, i, n) {
+                var s, a, r, h, l = "Feature" === t.type ? t.geometry : t,
                     u = l.coordinates,
                     c = [];
                 switch (i = i || this.coordsToLatLng, l.type) {
                     case "Point":
-                        return n = i(u), e ? e(t, n) : new o.Marker(n);
+                        return s = i(u), e ? e(t, s) : new o.Marker(s);
                     case "MultiPoint":
-                        for (a = 0, r = u.length; r > a; a++) n = i(u[a]), h = e ? e(t, n) : new o.Marker(n), c.push(h);
+                        for (r = 0, h = u.length; h > r; r++) s = i(u[r]), c.push(e ? e(t, s) : new o.Marker(s));
                         return new o.FeatureGroup(c);
                     case "LineString":
-                        return s = this.coordsToLatLngs(u, 0, i), new o.Polyline(s);
+                        return a = this.coordsToLatLngs(u, 0, i), new o.Polyline(a, n);
                     case "Polygon":
-                        return s = this.coordsToLatLngs(u, 1, i), new o.Polygon(s);
+                        if (2 === u.length && !u[1].length) throw new Error("Invalid GeoJSON object.");
+                        return a = this.coordsToLatLngs(u, 1, i), new o.Polygon(a, n);
                     case "MultiLineString":
-                        return s = this.coordsToLatLngs(u, 1, i), new o.MultiPolyline(s);
+                        return a = this.coordsToLatLngs(u, 1, i), new o.MultiPolyline(a, n);
                     case "MultiPolygon":
-                        return s = this.coordsToLatLngs(u, 2, i), new o.MultiPolygon(s);
+                        return a = this.coordsToLatLngs(u, 2, i), new o.MultiPolygon(a, n);
                     case "GeometryCollection":
-                        for (a = 0, r = l.geometries.length; r > a; a++) h = this.geometryToLayer({
-                            geometry: l.geometries[a],
+                        for (r = 0, h = l.geometries.length; h > r; r++) c.push(this.geometryToLayer({
+                            geometry: l.geometries[r],
                             type: "Feature",
                             properties: t.properties
-                        }, e, i), c.push(h);
+                        }, e, i, n));
                         return new o.FeatureGroup(c);
                     default:
                         throw new Error("Invalid GeoJSON object.")
                 }
             },
             coordsToLatLng: function(t) {
-                return new o.LatLng(t[1], t[0])
+                return new o.LatLng(t[1], t[0], t[2])
             },
             coordsToLatLngs: function(t, e, i) {
                 var n, o, s, a = [];
                 for (o = 0, s = t.length; s > o; o++) n = e ? this.coordsToLatLngs(t[o], e - 1, i) : (i || this.coordsToLatLng)(t[o]), a.push(n);
                 return a
             },
             latLngToCoords: function(t) {
-                return [t.lng, t.lat]
+                var e = [t.lng, t.lat];
+                return t.alt !== i && e.push(t.alt), e
             },
             latLngsToCoords: function(t) {
                 for (var e = [], i = 0, n = t.length; n > i; i++) e.push(o.GeoJSON.latLngToCoords(t[i]));
                 return e
             },
             getFeature: function(t, e) {
                 return t.feature ? o.extend({}, t.feature, {
@@ -2516,82 +2618,94 @@
                 return o.GeoJSON.getFeature(this, {
                     type: "Polygon",
                     coordinates: n
                 })
             }
         }),
         function() {
-            function t(t, e) {
-                t.include({
-                    toGeoJSON: function() {
-                        var t = [];
-                        return this.eachLayer(function(e) {
-                            t.push(e.toGeoJSON().geometry.coordinates)
-                        }), o.GeoJSON.getFeature(this, {
-                            type: e,
-                            coordinates: t
-                        })
-                    }
-                })
-            }
-            t(o.MultiPolyline, "MultiLineString"), t(o.MultiPolygon, "MultiPolygon")
-        }(), o.LayerGroup.include({
-            toGeoJSON: function() {
-                var t = [];
-                return this.eachLayer(function(e) {
-                    e.toGeoJSON && t.push(o.GeoJSON.asFeature(e.toGeoJSON()))
-                }), {
-                    type: "FeatureCollection",
-                    features: t
+            function t(t) {
+                return function() {
+                    var e = [];
+                    return this.eachLayer(function(t) {
+                        e.push(t.toGeoJSON().geometry.coordinates)
+                    }), o.GeoJSON.getFeature(this, {
+                        type: t,
+                        coordinates: e
+                    })
                 }
             }
-        }), o.geoJson = function(t, e) {
+            o.MultiPolyline.include({
+                toGeoJSON: t("MultiLineString")
+            }), o.MultiPolygon.include({
+                toGeoJSON: t("MultiPolygon")
+            }), o.LayerGroup.include({
+                toGeoJSON: function() {
+                    var e, i = this.feature && this.feature.geometry,
+                        n = [];
+                    if (i && "MultiPoint" === i.type) return t("MultiPoint").call(this);
+                    var s = i && "GeometryCollection" === i.type;
+                    return this.eachLayer(function(t) {
+                        t.toGeoJSON && (e = t.toGeoJSON(), n.push(s ? e.geometry : o.GeoJSON.asFeature(e)))
+                    }), s ? o.GeoJSON.getFeature(this, {
+                        geometries: n,
+                        type: "GeometryCollection"
+                    }) : {
+                        type: "FeatureCollection",
+                        features: n
+                    }
+                }
+            })
+        }(), o.geoJson = function(t, e) {
             return new o.GeoJSON(t, e)
         }, o.DomEvent = {
             addListener: function(t, e, i, n) {
                 var s, a, r, h = o.stamp(i),
                     l = "_leaflet_" + e + h;
                 return t[l] ? this : (s = function(e) {
                     return i.call(n || t, e || o.DomEvent._getEvent())
-                }, o.Browser.msTouch && 0 === e.indexOf("touch") ? this.addMsTouchListener(t, e, s, h) : (o.Browser.touch && "dblclick" === e && this.addDoubleTapListener && this.addDoubleTapListener(t, s, h), "addEventListener" in t ? "mousewheel" === e ? (t.addEventListener("DOMMouseScroll", s, !1), t.addEventListener(e, s, !1)) : "mouseenter" === e || "mouseleave" === e ? (a = s, r = "mouseenter" === e ? "mouseover" : "mouseout", s = function(e) {
+                }, o.Browser.pointer && 0 === e.indexOf("touch") ? this.addPointerListener(t, e, s, h) : (o.Browser.touch && "dblclick" === e && this.addDoubleTapListener && this.addDoubleTapListener(t, s, h), "addEventListener" in t ? "mousewheel" === e ? (t.addEventListener("DOMMouseScroll", s, !1), t.addEventListener(e, s, !1)) : "mouseenter" === e || "mouseleave" === e ? (a = s, r = "mouseenter" === e ? "mouseover" : "mouseout", s = function(e) {
                     return o.DomEvent._checkMouse(t, e) ? a(e) : void 0
                 }, t.addEventListener(r, s, !1)) : "click" === e && o.Browser.android ? (a = s, s = function(t) {
                     return o.DomEvent._filterClick(t, a)
                 }, t.addEventListener(e, s, !1)) : t.addEventListener(e, s, !1) : "attachEvent" in t && t.attachEvent("on" + e, s), t[l] = s, this))
             },
             removeListener: function(t, e, i) {
                 var n = o.stamp(i),
                     s = "_leaflet_" + e + n,
                     a = t[s];
-                return a ? (o.Browser.msTouch && 0 === e.indexOf("touch") ? this.removeMsTouchListener(t, e, n) : o.Browser.touch && "dblclick" === e && this.removeDoubleTapListener ? this.removeDoubleTapListener(t, n) : "removeEventListener" in t ? "mousewheel" === e ? (t.removeEventListener("DOMMouseScroll", a, !1), t.removeEventListener(e, a, !1)) : "mouseenter" === e || "mouseleave" === e ? t.removeEventListener("mouseenter" === e ? "mouseover" : "mouseout", a, !1) : t.removeEventListener(e, a, !1) : "detachEvent" in t && t.detachEvent("on" + e, a), t[s] = null, this) : this
+                return a ? (o.Browser.pointer && 0 === e.indexOf("touch") ? this.removePointerListener(t, e, n) : o.Browser.touch && "dblclick" === e && this.removeDoubleTapListener ? this.removeDoubleTapListener(t, n) : "removeEventListener" in t ? "mousewheel" === e ? (t.removeEventListener("DOMMouseScroll", a, !1), t.removeEventListener(e, a, !1)) : "mouseenter" === e || "mouseleave" === e ? t.removeEventListener("mouseenter" === e ? "mouseover" : "mouseout", a, !1) : t.removeEventListener(e, a, !1) : "detachEvent" in t && t.detachEvent("on" + e, a), t[s] = null, this) : this
             },
             stopPropagation: function(t) {
-                return t.stopPropagation ? t.stopPropagation() : t.cancelBubble = !0, this
+                return t.stopPropagation ? t.stopPropagation() : t.cancelBubble = !0, o.DomEvent._skipped(t), this
+            },
+            disableScrollPropagation: function(t) {
+                var e = o.DomEvent.stopPropagation;
+                return o.DomEvent.on(t, "mousewheel", e).on(t, "MozMousePixelScroll", e)
             },
             disableClickPropagation: function(t) {
-                for (var e = o.DomEvent.stopPropagation, i = o.Draggable.START.length - 1; i >= 0; i--) o.DomEvent.addListener(t, o.Draggable.START[i], e);
-                return o.DomEvent.addListener(t, "click", o.DomEvent._fakeStop).addListener(t, "dblclick", e)
+                for (var e = o.DomEvent.stopPropagation, i = o.Draggable.START.length - 1; i >= 0; i--) o.DomEvent.on(t, o.Draggable.START[i], e);
+                return o.DomEvent.on(t, "click", o.DomEvent._fakeStop).on(t, "dblclick", e)
             },
             preventDefault: function(t) {
                 return t.preventDefault ? t.preventDefault() : t.returnValue = !1, this
             },
             stop: function(t) {
                 return o.DomEvent.preventDefault(t).stopPropagation(t)
             },
             getMousePosition: function(t, i) {
-                var n = o.Browser.ie7,
-                    s = e.body,
-                    a = e.documentElement,
-                    r = t.pageX ? t.pageX - s.scrollLeft - a.scrollLeft : t.clientX,
-                    h = t.pageY ? t.pageY - s.scrollTop - a.scrollTop : t.clientY,
-                    l = new o.Point(r, h),
-                    u = i.getBoundingClientRect(),
-                    c = u.left - i.clientLeft,
-                    d = u.top - i.clientTop;
-                return o.DomUtil.documentIsLtr() || !o.Browser.webkit && !n || (c += i.scrollWidth - i.clientWidth, n && "hidden" !== o.DomUtil.getStyle(i, "overflow-y") && "hidden" !== o.DomUtil.getStyle(i, "overflow") && (c += 17)), l._subtract(new o.Point(c, d))
+                var n = e.body,
+                    s = e.documentElement,
+                    a = o.DomUtil.documentIsLtr() ? t.pageX ? t.pageX - n.scrollLeft - s.scrollLeft : t.clientX : o.Browser.gecko ? t.pageX - n.scrollLeft - s.scrollLeft : t.pageX ? t.pageX - n.scrollLeft + s.scrollLeft : t.clientX,
+                    r = t.pageY ? t.pageY - n.scrollTop - s.scrollTop : t.clientY,
+                    h = new o.Point(a, r);
+                if (!i) return h;
+                var l = i.getBoundingClientRect(),
+                    u = l.left - i.clientLeft,
+                    c = l.top - i.clientTop;
+                return h._subtract(new o.Point(u, c))
             },
             getWheelDelta: function(t) {
                 var e = 0;
                 return t.wheelDelta && (e = t.wheelDelta / 120), t.detail && (e = -t.detail / 3), e
             },
             _skipEvents: {},
             _fakeStop: function(t) {
@@ -2625,19 +2739,21 @@
         }, o.DomEvent.on = o.DomEvent.addListener, o.DomEvent.off = o.DomEvent.removeListener, o.Draggable = o.Class.extend({
             includes: o.Mixin.Events,
             statics: {
                 START: o.Browser.touch ? ["touchstart", "mousedown"] : ["mousedown"],
                 END: {
                     mousedown: "mouseup",
                     touchstart: "touchend",
+                    pointerdown: "touchend",
                     MSPointerDown: "touchend"
                 },
                 MOVE: {
                     mousedown: "mousemove",
                     touchstart: "touchmove",
+                    pointerdown: "touchmove",
                     MSPointerDown: "touchmove"
                 }
             },
             initialize: function(t, e) {
                 this._element = t, this._dragStartTarget = e || t
             },
             enable: function() {
@@ -2649,36 +2765,35 @@
             disable: function() {
                 if (this._enabled) {
                     for (var t = o.Draggable.START.length - 1; t >= 0; t--) o.DomEvent.off(this._dragStartTarget, o.Draggable.START[t], this._onDown, this);
                     this._enabled = !1, this._moved = !1
                 }
             },
             _onDown: function(t) {
-                if (!t.shiftKey && (1 === t.which || 1 === t.button || t.touches) && (o.DomEvent.stopPropagation(t), !o.Draggable._disabled)) {
-                    o.DomUtil.disableImageDrag(), o.DomUtil.disableTextSelection();
-                    var i = t.touches ? t.touches[0] : t,
-                        n = i.target;
-                    o.Browser.touch && "a" === n.tagName.toLowerCase() && o.DomUtil.addClass(n, "leaflet-active"), this._moved = !1, this._moving || (this._startPoint = new o.Point(i.clientX, i.clientY), this._startPos = this._newPos = o.DomUtil.getPosition(this._element), o.DomEvent.on(e, o.Draggable.MOVE[t.type], this._onMove, this).on(e, o.Draggable.END[t.type], this._onUp, this))
+                if (this._moved = !1, !(t.shiftKey || 1 !== t.which && 1 !== t.button && !t.touches || (o.DomEvent.stopPropagation(t), o.Draggable._disabled || (o.DomUtil.disableImageDrag(), o.DomUtil.disableTextSelection(), this._moving)))) {
+                    var i = t.touches ? t.touches[0] : t;
+                    this._startPoint = new o.Point(i.clientX, i.clientY), this._startPos = this._newPos = o.DomUtil.getPosition(this._element), o.DomEvent.on(e, o.Draggable.MOVE[t.type], this._onMove, this).on(e, o.Draggable.END[t.type], this._onUp, this)
                 }
             },
             _onMove: function(t) {
-                if (!(t.touches && t.touches.length > 1)) {
-                    var i = t.touches && 1 === t.touches.length ? t.touches[0] : t,
-                        n = new o.Point(i.clientX, i.clientY),
-                        s = n.subtract(this._startPoint);
-                    (s.x || s.y) && (o.DomEvent.preventDefault(t), this._moved || (this.fire("dragstart"), this._moved = !0, this._startPos = o.DomUtil.getPosition(this._element).subtract(s), o.Browser.touch || o.DomUtil.addClass(e.body, "leaflet-dragging")), this._newPos = this._startPos.add(s), this._moving = !0, o.Util.cancelAnimFrame(this._animRequest), this._animRequest = o.Util.requestAnimFrame(this._updatePosition, this, !0, this._dragStartTarget))
-                }
+                if (t.touches && t.touches.length > 1) return this._moved = !0, void 0;
+                var i = t.touches && 1 === t.touches.length ? t.touches[0] : t,
+                    n = new o.Point(i.clientX, i.clientY),
+                    s = n.subtract(this._startPoint);
+                (s.x || s.y) && (o.DomEvent.preventDefault(t), this._moved || (this.fire("dragstart"), this._moved = !0, this._startPos = o.DomUtil.getPosition(this._element).subtract(s), o.DomUtil.addClass(e.body, "leaflet-dragging"), o.DomUtil.addClass(t.target || t.srcElement, "leaflet-drag-target")), this._newPos = this._startPos.add(s), this._moving = !0, o.Util.cancelAnimFrame(this._animRequest), this._animRequest = o.Util.requestAnimFrame(this._updatePosition, this, !0, this._dragStartTarget))
             },
             _updatePosition: function() {
                 this.fire("predrag"), o.DomUtil.setPosition(this._element, this._newPos), this.fire("drag")
             },
-            _onUp: function() {
-                o.Browser.touch || o.DomUtil.removeClass(e.body, "leaflet-dragging");
-                for (var t in o.Draggable.MOVE) o.DomEvent.off(e, o.Draggable.MOVE[t], this._onMove).off(e, o.Draggable.END[t], this._onUp);
-                o.DomUtil.enableImageDrag(), o.DomUtil.enableTextSelection(), this._moved && (o.Util.cancelAnimFrame(this._animRequest), this.fire("dragend")), this._moving = !1
+            _onUp: function(t) {
+                o.DomUtil.removeClass(e.body, "leaflet-dragging"), o.DomUtil.removeClass(t.target || t.srcElement, "leaflet-drag-target");
+                for (var i in o.Draggable.MOVE) o.DomEvent.off(e, o.Draggable.MOVE[i], this._onMove).off(e, o.Draggable.END[i], this._onUp);
+                o.DomUtil.enableImageDrag(), o.DomUtil.enableTextSelection(), this._moved && this._moving && (o.Util.cancelAnimFrame(this._animRequest), this.fire("dragend", {
+                    distance: this._newPos.distanceTo(this._startPos)
+                })), this._moving = !1
             }
         }), o.Handler = o.Class.extend({
             initialize: function(t) {
                 this._map = t
             },
             enable: function() {
                 this._enabled || (this._enabled = !0, this.addHooks())
@@ -2701,15 +2816,15 @@
             addHooks: function() {
                 if (!this._draggable) {
                     var t = this._map;
                     this._draggable = new o.Draggable(t._mapPane, t._container), this._draggable.on({
                         dragstart: this._onDragStart,
                         drag: this._onDrag,
                         dragend: this._onDragEnd
-                    }, this), t.options.worldCopyJump && (this._draggable.on("predrag", this._onPreDrag, this), t.on("viewreset", this._onViewReset, this), this._onViewReset())
+                    }, this), t.options.worldCopyJump && (this._draggable.on("predrag", this._onPreDrag, this), t.on("viewreset", this._onViewReset, this), t.whenReady(this._onViewReset, this))
                 }
                 this._draggable.enable()
             },
             removeHooks: function() {
                 this._draggable.disable()
             },
             moved: function() {
@@ -2738,50 +2853,52 @@
                     i = this._initialWorldOffset,
                     n = this._draggable._newPos.x,
                     o = (n - e + i) % t + e - i,
                     s = (n + e + i) % t - e - i,
                     a = Math.abs(o + i) < Math.abs(s + i) ? o : s;
                 this._draggable._newPos.x = a
             },
-            _onDragEnd: function() {
-                var t = this._map,
-                    e = t.options,
-                    i = +new Date - this._lastTime,
-                    n = !e.inertia || i > e.inertiaThreshold || !this._positions[0];
-                if (t.fire("dragend"), n) t.fire("moveend");
+            _onDragEnd: function(t) {
+                var e = this._map,
+                    i = e.options,
+                    n = +new Date - this._lastTime,
+                    s = !i.inertia || n > i.inertiaThreshold || !this._positions[0];
+                if (e.fire("dragend", t), s) e.fire("moveend");
                 else {
-                    var s = this._lastPos.subtract(this._positions[0]),
-                        a = (this._lastTime + i - this._times[0]) / 1e3,
-                        r = e.easeLinearity,
-                        h = s.multiplyBy(r / a),
-                        l = h.distanceTo([0, 0]),
-                        u = Math.min(e.inertiaMaxSpeed, l),
-                        c = h.multiplyBy(u / l),
-                        d = u / (e.inertiaDeceleration * r),
-                        p = c.multiplyBy(-d / 2).round();
-                    p.x && p.y ? o.Util.requestAnimFrame(function() {
-                        t.panBy(p, {
-                            duration: d,
-                            easeLinearity: r,
+                    var a = this._lastPos.subtract(this._positions[0]),
+                        r = (this._lastTime + n - this._times[0]) / 1e3,
+                        h = i.easeLinearity,
+                        l = a.multiplyBy(h / r),
+                        u = l.distanceTo([0, 0]),
+                        c = Math.min(i.inertiaMaxSpeed, u),
+                        d = l.multiplyBy(c / u),
+                        p = c / (i.inertiaDeceleration * h),
+                        _ = d.multiplyBy(-p / 2).round();
+                    _.x && _.y ? (_ = e._limitOffset(_, e.options.maxBounds), o.Util.requestAnimFrame(function() {
+                        e.panBy(_, {
+                            duration: p,
+                            easeLinearity: h,
                             noMoveStart: !0
                         })
-                    }) : t.fire("moveend")
+                    })) : e.fire("moveend")
                 }
             }
         }), o.Map.addInitHook("addHandler", "dragging", o.Map.Drag), o.Map.mergeOptions({
             doubleClickZoom: !0
         }), o.Map.DoubleClickZoom = o.Handler.extend({
             addHooks: function() {
-                this._map.on("dblclick", this._onDoubleClick)
+                this._map.on("dblclick", this._onDoubleClick, this)
             },
             removeHooks: function() {
-                this._map.off("dblclick", this._onDoubleClick)
+                this._map.off("dblclick", this._onDoubleClick, this)
             },
             _onDoubleClick: function(t) {
-                this.setZoomAround(t.containerPoint, this._zoom + 1)
+                var e = this._map,
+                    i = e.getZoom() + (t.originalEvent.shiftKey ? -1 : 1);
+                "center" === e.options.doubleClickZoom ? e.setZoom(i) : e.setZoomAround(t.containerPoint, i)
             }
         }), o.Map.addInitHook("addHandler", "doubleClickZoom", o.Map.DoubleClickZoom), o.Map.mergeOptions({
             scrollWheelZoom: !0
         }), o.Map.ScrollWheelZoom = o.Handler.extend({
             addHooks: function() {
                 o.DomEvent.on(this._map._container, "mousewheel", this._onWheelScroll, this), o.DomEvent.on(this._map._container, "MozMousePixelScroll", o.DomEvent.preventDefault), this._delta = 0
             },
@@ -2794,138 +2911,144 @@
                 var i = Math.max(40 - (+new Date - this._startTime), 0);
                 clearTimeout(this._timer), this._timer = setTimeout(o.bind(this._performZoom, this), i), o.DomEvent.preventDefault(t), o.DomEvent.stopPropagation(t)
             },
             _performZoom: function() {
                 var t = this._map,
                     e = this._delta,
                     i = t.getZoom();
-                e = e > 0 ? Math.ceil(e) : Math.floor(e), e = Math.max(Math.min(e, 4), -4), e = t._limitZoom(i + e) - i, this._delta = 0, this._startTime = null, e && t.setZoomAround(this._lastMousePos, i + e)
+                e = e > 0 ? Math.ceil(e) : Math.floor(e), e = Math.max(Math.min(e, 4), -4), e = t._limitZoom(i + e) - i, this._delta = 0, this._startTime = null, e && ("center" === t.options.scrollWheelZoom ? t.setZoom(i + e) : t.setZoomAround(this._lastMousePos, i + e))
             }
         }), o.Map.addInitHook("addHandler", "scrollWheelZoom", o.Map.ScrollWheelZoom), o.extend(o.DomEvent, {
-            _touchstart: o.Browser.msTouch ? "MSPointerDown" : "touchstart",
-            _touchend: o.Browser.msTouch ? "MSPointerUp" : "touchend",
+            _touchstart: o.Browser.msPointer ? "MSPointerDown" : o.Browser.pointer ? "pointerdown" : "touchstart",
+            _touchend: o.Browser.msPointer ? "MSPointerUp" : o.Browser.pointer ? "pointerup" : "touchend",
             addDoubleTapListener: function(t, i, n) {
                 function s(t) {
                     var e;
-                    if (o.Browser.msTouch ? (_.push(t.pointerId), e = _.length) : e = t.touches.length, !(e > 1)) {
+                    if (o.Browser.pointer ? (_.push(t.pointerId), e = _.length) : e = t.touches.length, !(e > 1)) {
                         var i = Date.now(),
                             n = i - (r || i);
                         h = t.touches ? t.touches[0] : t, l = n > 0 && u >= n, r = i
                     }
                 }
 
                 function a(t) {
-                    if (o.Browser.msTouch) {
+                    if (o.Browser.pointer) {
                         var e = _.indexOf(t.pointerId);
                         if (-1 === e) return;
                         _.splice(e, 1)
                     }
                     if (l) {
-                        if (o.Browser.msTouch) {
+                        if (o.Browser.pointer) {
                             var n, s = {};
                             for (var a in h) n = h[a], s[a] = "function" == typeof n ? n.bind(h) : n;
                             h = s
                         }
                         h.type = "dblclick", i(h), r = null
                     }
                 }
                 var r, h, l = !1,
                     u = 250,
                     c = "_leaflet_",
                     d = this._touchstart,
                     p = this._touchend,
                     _ = [];
                 t[c + d + n] = s, t[c + p + n] = a;
-                var m = o.Browser.msTouch ? e.documentElement : t;
-                return t.addEventListener(d, s, !1), m.addEventListener(p, a, !1), o.Browser.msTouch && m.addEventListener("MSPointerCancel", a, !1), this
+                var m = o.Browser.pointer ? e.documentElement : t;
+                return t.addEventListener(d, s, !1), m.addEventListener(p, a, !1), o.Browser.pointer && m.addEventListener(o.DomEvent.POINTER_CANCEL, a, !1), this
             },
             removeDoubleTapListener: function(t, i) {
                 var n = "_leaflet_";
-                return t.removeEventListener(this._touchstart, t[n + this._touchstart + i], !1), (o.Browser.msTouch ? e.documentElement : t).removeEventListener(this._touchend, t[n + this._touchend + i], !1), o.Browser.msTouch && e.documentElement.removeEventListener("MSPointerCancel", t[n + this._touchend + i], !1), this
+                return t.removeEventListener(this._touchstart, t[n + this._touchstart + i], !1), (o.Browser.pointer ? e.documentElement : t).removeEventListener(this._touchend, t[n + this._touchend + i], !1), o.Browser.pointer && e.documentElement.removeEventListener(o.DomEvent.POINTER_CANCEL, t[n + this._touchend + i], !1), this
             }
         }), o.extend(o.DomEvent, {
-            _msTouches: [],
-            _msDocumentListener: !1,
-            addMsTouchListener: function(t, e, i, n) {
+            POINTER_DOWN: o.Browser.msPointer ? "MSPointerDown" : "pointerdown",
+            POINTER_MOVE: o.Browser.msPointer ? "MSPointerMove" : "pointermove",
+            POINTER_UP: o.Browser.msPointer ? "MSPointerUp" : "pointerup",
+            POINTER_CANCEL: o.Browser.msPointer ? "MSPointerCancel" : "pointercancel",
+            _pointers: [],
+            _pointerDocumentListener: !1,
+            addPointerListener: function(t, e, i, n) {
                 switch (e) {
                     case "touchstart":
-                        return this.addMsTouchListenerStart(t, e, i, n);
+                        return this.addPointerListenerStart(t, e, i, n);
                     case "touchend":
-                        return this.addMsTouchListenerEnd(t, e, i, n);
+                        return this.addPointerListenerEnd(t, e, i, n);
                     case "touchmove":
-                        return this.addMsTouchListenerMove(t, e, i, n);
+                        return this.addPointerListenerMove(t, e, i, n);
                     default:
                         throw "Unknown touch event type"
                 }
             },
-            addMsTouchListenerStart: function(t, i, n, o) {
-                var s = "_leaflet_",
-                    a = this._msTouches,
-                    r = function(t) {
-                        for (var e = !1, i = 0; i < a.length; i++)
-                            if (a[i].pointerId === t.pointerId) {
+            addPointerListenerStart: function(t, i, n, s) {
+                var a = "_leaflet_",
+                    r = this._pointers,
+                    h = function(t) {
+                        o.DomEvent.preventDefault(t);
+                        for (var e = !1, i = 0; i < r.length; i++)
+                            if (r[i].pointerId === t.pointerId) {
                                 e = !0;
                                 break
-                            } e || a.push(t), t.touches = a.slice(), t.changedTouches = [t], n(t)
+                            } e || r.push(t), t.touches = r.slice(), t.changedTouches = [t], n(t)
                     };
-                if (t[s + "touchstart" + o] = r, t.addEventListener("MSPointerDown", r, !1), !this._msDocumentListener) {
-                    var h = function(t) {
-                        for (var e = 0; e < a.length; e++)
-                            if (a[e].pointerId === t.pointerId) {
-                                a.splice(e, 1);
+                if (t[a + "touchstart" + s] = h, t.addEventListener(this.POINTER_DOWN, h, !1), !this._pointerDocumentListener) {
+                    var l = function(t) {
+                        for (var e = 0; e < r.length; e++)
+                            if (r[e].pointerId === t.pointerId) {
+                                r.splice(e, 1);
                                 break
                             }
                     };
-                    e.documentElement.addEventListener("MSPointerUp", h, !1), e.documentElement.addEventListener("MSPointerCancel", h, !1), this._msDocumentListener = !0
+                    e.documentElement.addEventListener(this.POINTER_UP, l, !1), e.documentElement.addEventListener(this.POINTER_CANCEL, l, !1), this._pointerDocumentListener = !0
                 }
                 return this
             },
-            addMsTouchListenerMove: function(t, e, i, n) {
+            addPointerListenerMove: function(t, e, i, n) {
                 function o(t) {
-                    if (t.pointerType !== t.MSPOINTER_TYPE_MOUSE || 0 !== t.buttons) {
+                    if (t.pointerType !== t.MSPOINTER_TYPE_MOUSE && "mouse" !== t.pointerType || 0 !== t.buttons) {
                         for (var e = 0; e < a.length; e++)
                             if (a[e].pointerId === t.pointerId) {
                                 a[e] = t;
                                 break
                             } t.touches = a.slice(), t.changedTouches = [t], i(t)
                     }
                 }
                 var s = "_leaflet_",
-                    a = this._msTouches;
-                return t[s + "touchmove" + n] = o, t.addEventListener("MSPointerMove", o, !1), this
+                    a = this._pointers;
+                return t[s + "touchmove" + n] = o, t.addEventListener(this.POINTER_MOVE, o, !1), this
             },
-            addMsTouchListenerEnd: function(t, e, i, n) {
+            addPointerListenerEnd: function(t, e, i, n) {
                 var o = "_leaflet_",
-                    s = this._msTouches,
+                    s = this._pointers,
                     a = function(t) {
                         for (var e = 0; e < s.length; e++)
                             if (s[e].pointerId === t.pointerId) {
                                 s.splice(e, 1);
                                 break
                             } t.touches = s.slice(), t.changedTouches = [t], i(t)
                     };
-                return t[o + "touchend" + n] = a, t.addEventListener("MSPointerUp", a, !1), t.addEventListener("MSPointerCancel", a, !1), this
+                return t[o + "touchend" + n] = a, t.addEventListener(this.POINTER_UP, a, !1), t.addEventListener(this.POINTER_CANCEL, a, !1), this
             },
-            removeMsTouchListener: function(t, e, i) {
+            removePointerListener: function(t, e, i) {
                 var n = "_leaflet_",
                     o = t[n + e + i];
                 switch (e) {
                     case "touchstart":
-                        t.removeEventListener("MSPointerDown", o, !1);
+                        t.removeEventListener(this.POINTER_DOWN, o, !1);
                         break;
                     case "touchmove":
-                        t.removeEventListener("MSPointerMove", o, !1);
+                        t.removeEventListener(this.POINTER_MOVE, o, !1);
                         break;
                     case "touchend":
-                        t.removeEventListener("MSPointerUp", o, !1), t.removeEventListener("MSPointerCancel", o, !1)
+                        t.removeEventListener(this.POINTER_UP, o, !1), t.removeEventListener(this.POINTER_CANCEL, o, !1)
                 }
                 return this
             }
         }), o.Map.mergeOptions({
-            touchZoom: o.Browser.touch && !o.Browser.android23
+            touchZoom: o.Browser.touch && !o.Browser.android23,
+            bounceAtZoomLimits: !0
         }), o.Map.TouchZoom = o.Handler.extend({
             addHooks: function() {
                 o.DomEvent.on(this._map._container, "touchstart", this._onTouchStart, this)
             },
             removeHooks: function() {
                 o.DomEvent.off(this._map._container, "touchstart", this._onTouchStart, this)
             },
@@ -2939,15 +3062,15 @@
                 }
             },
             _onTouchMove: function(t) {
                 var e = this._map;
                 if (t.touches && 2 === t.touches.length && this._zooming) {
                     var i = e.mouseEventToLayerPoint(t.touches[0]),
                         n = e.mouseEventToLayerPoint(t.touches[1]);
-                    this._scale = i.distanceTo(n) / this._startDist, this._delta = i._add(n)._divideBy(2)._subtract(this._startCenter), 1 !== this._scale && (this._moved || (o.DomUtil.addClass(e._mapPane, "leaflet-touching"), e.fire("movestart").fire("zoomstart"), this._moved = !0), o.Util.cancelAnimFrame(this._animRequest), this._animRequest = o.Util.requestAnimFrame(this._updateOnMove, this, !0, this._map._container), o.DomEvent.preventDefault(t))
+                    this._scale = i.distanceTo(n) / this._startDist, this._delta = i._add(n)._divideBy(2)._subtract(this._startCenter), 1 !== this._scale && (e.options.bounceAtZoomLimits || !(e.getZoom() === e.getMinZoom() && this._scale < 1 || e.getZoom() === e.getMaxZoom() && this._scale > 1)) && (this._moved || (o.DomUtil.addClass(e._mapPane, "leaflet-touching"), e.fire("movestart").fire("zoomstart"), this._moved = !0), o.Util.cancelAnimFrame(this._animRequest), this._animRequest = o.Util.requestAnimFrame(this._updateOnMove, this, !0, this._map._container), o.DomEvent.preventDefault(t))
                 }
             },
             _updateOnMove: function() {
                 var t = this._map,
                     e = this._getScaleOrigin(),
                     i = t.layerPointToLatLng(e),
                     n = t.getScaleZoom(this._scale);
@@ -2981,62 +3104,66 @@
                 o.DomEvent.off(this._map._container, "touchstart", this._onDown, this)
             },
             _onDown: function(t) {
                 if (t.touches) {
                     if (o.DomEvent.preventDefault(t), this._fireClick = !0, t.touches.length > 1) return this._fireClick = !1, clearTimeout(this._holdTimeout), void 0;
                     var i = t.touches[0],
                         n = i.target;
-                    this._startPos = this._newPos = new o.Point(i.clientX, i.clientY), "a" === n.tagName.toLowerCase() && o.DomUtil.addClass(n, "leaflet-active"), this._holdTimeout = setTimeout(o.bind(function() {
+                    this._startPos = this._newPos = new o.Point(i.clientX, i.clientY), n.tagName && "a" === n.tagName.toLowerCase() && o.DomUtil.addClass(n, "leaflet-active"), this._holdTimeout = setTimeout(o.bind(function() {
                         this._isTapValid() && (this._fireClick = !1, this._onUp(), this._simulateEvent("contextmenu", i))
                     }, this), 1e3), o.DomEvent.on(e, "touchmove", this._onMove, this).on(e, "touchend", this._onUp, this)
                 }
             },
             _onUp: function(t) {
                 if (clearTimeout(this._holdTimeout), o.DomEvent.off(e, "touchmove", this._onMove, this).off(e, "touchend", this._onUp, this), this._fireClick && t && t.changedTouches) {
                     var i = t.changedTouches[0],
                         n = i.target;
-                    "a" === n.tagName.toLowerCase() && o.DomUtil.removeClass(n, "leaflet-active"), this._isTapValid() && this._simulateEvent("click", i)
+                    n && n.tagName && "a" === n.tagName.toLowerCase() && o.DomUtil.removeClass(n, "leaflet-active"), this._isTapValid() && this._simulateEvent("click", i)
                 }
             },
             _isTapValid: function() {
                 return this._newPos.distanceTo(this._startPos) <= this._map.options.tapTolerance
             },
             _onMove: function(t) {
                 var e = t.touches[0];
                 this._newPos = new o.Point(e.clientX, e.clientY)
             },
             _simulateEvent: function(i, n) {
                 var o = e.createEvent("MouseEvents");
                 o._simulated = !0, n.target._simulatedClick = !0, o.initMouseEvent(i, !0, !0, t, 1, n.screenX, n.screenY, n.clientX, n.clientY, !1, !1, !1, !1, 0, null), n.target.dispatchEvent(o)
             }
-        }), o.Browser.touch && !o.Browser.msTouch && o.Map.addInitHook("addHandler", "tap", o.Map.Tap), o.Map.mergeOptions({
+        }), o.Browser.touch && !o.Browser.pointer && o.Map.addInitHook("addHandler", "tap", o.Map.Tap), o.Map.mergeOptions({
             boxZoom: !0
         }), o.Map.BoxZoom = o.Handler.extend({
             initialize: function(t) {
-                this._map = t, this._container = t._container, this._pane = t._panes.overlayPane
+                this._map = t, this._container = t._container, this._pane = t._panes.overlayPane, this._moved = !1
             },
             addHooks: function() {
                 o.DomEvent.on(this._container, "mousedown", this._onMouseDown, this)
             },
             removeHooks: function() {
-                o.DomEvent.off(this._container, "mousedown", this._onMouseDown)
+                o.DomEvent.off(this._container, "mousedown", this._onMouseDown), this._moved = !1
+            },
+            moved: function() {
+                return this._moved
             },
             _onMouseDown: function(t) {
-                return !t.shiftKey || 1 !== t.which && 1 !== t.button ? !1 : (o.DomUtil.disableTextSelection(), o.DomUtil.disableImageDrag(), this._startLayerPoint = this._map.mouseEventToLayerPoint(t), this._box = o.DomUtil.create("div", "leaflet-zoom-box", this._pane), o.DomUtil.setPosition(this._box, this._startLayerPoint), this._container.style.cursor = "crosshair", o.DomEvent.on(e, "mousemove", this._onMouseMove, this).on(e, "mouseup", this._onMouseUp, this).on(e, "keydown", this._onKeyDown, this), this._map.fire("boxzoomstart"), void 0)
+                return this._moved = !1, !t.shiftKey || 1 !== t.which && 1 !== t.button ? !1 : (o.DomUtil.disableTextSelection(), o.DomUtil.disableImageDrag(), this._startLayerPoint = this._map.mouseEventToLayerPoint(t), o.DomEvent.on(e, "mousemove", this._onMouseMove, this).on(e, "mouseup", this._onMouseUp, this).on(e, "keydown", this._onKeyDown, this), void 0)
             },
             _onMouseMove: function(t) {
+                this._moved || (this._box = o.DomUtil.create("div", "leaflet-zoom-box", this._pane), o.DomUtil.setPosition(this._box, this._startLayerPoint), this._container.style.cursor = "crosshair", this._map.fire("boxzoomstart"));
                 var e = this._startLayerPoint,
                     i = this._box,
                     n = this._map.mouseEventToLayerPoint(t),
                     s = n.subtract(e),
                     a = new o.Point(Math.min(n.x, e.x), Math.min(n.y, e.y));
-                o.DomUtil.setPosition(i, a), i.style.width = Math.max(0, Math.abs(s.x) - 4) + "px", i.style.height = Math.max(0, Math.abs(s.y) - 4) + "px"
+                o.DomUtil.setPosition(i, a), this._moved = !0, i.style.width = Math.max(0, Math.abs(s.x) - 4) + "px", i.style.height = Math.max(0, Math.abs(s.y) - 4) + "px"
             },
             _finish: function() {
-                this._pane.removeChild(this._box), this._container.style.cursor = "", o.DomUtil.enableTextSelection(), o.DomUtil.enableImageDrag(), o.DomEvent.off(e, "mousemove", this._onMouseMove).off(e, "mouseup", this._onMouseUp).off(e, "keydown", this._onKeyDown)
+                this._moved && (this._pane.removeChild(this._box), this._container.style.cursor = ""), o.DomUtil.enableTextSelection(), o.DomUtil.enableImageDrag(), o.DomEvent.off(e, "mousemove", this._onMouseMove).off(e, "mouseup", this._onMouseUp).off(e, "keydown", this._onKeyDown)
             },
             _onMouseUp: function(t) {
                 this._finish();
                 var e = this._map,
                     i = e.mouseEventToLayerPoint(t);
                 if (!this._startLayerPoint.equals(i)) {
                     var n = new o.LatLngBounds(e.layerPointToLatLng(this._startLayerPoint), e.layerPointToLatLng(i));
@@ -3054,15 +3181,15 @@
             keyboardZoomOffset: 1
         }), o.Map.Keyboard = o.Handler.extend({
             keyCodes: {
                 left: [37],
                 right: [39],
                 down: [40],
                 up: [38],
-                zoomIn: [187, 107, 61],
+                zoomIn: [187, 107, 61, 171],
                 zoomOut: [189, 109, 173]
             },
             initialize: function(t) {
                 this._map = t, this._setPanOffset(t.options.keyboardPanOffset), this._setZoomOffset(t.options.keyboardZoomOffset)
             },
             addHooks: function() {
                 var t = this._map._container; - 1 === t.tabIndex && (t.tabIndex = "0"), o.DomEvent.on(t, "focus", this._onFocus, this).on(t, "blur", this._onBlur, this).on(t, "mousedown", this._onMouseDown, this), this._map.on("focus", this._addHooks, this).on("blur", this._removeHooks, this)
@@ -3121,18 +3248,18 @@
             }
         }), o.Map.addInitHook("addHandler", "keyboard", o.Map.Keyboard), o.Handler.MarkerDrag = o.Handler.extend({
             initialize: function(t) {
                 this._marker = t
             },
             addHooks: function() {
                 var t = this._marker._icon;
-                this._draggable || (this._draggable = new o.Draggable(t, t)), this._draggable.on("dragstart", this._onDragStart, this).on("drag", this._onDrag, this).on("dragend", this._onDragEnd, this), this._draggable.enable()
+                this._draggable || (this._draggable = new o.Draggable(t, t)), this._draggable.on("dragstart", this._onDragStart, this).on("drag", this._onDrag, this).on("dragend", this._onDragEnd, this), this._draggable.enable(), o.DomUtil.addClass(this._marker._icon, "leaflet-marker-draggable")
             },
             removeHooks: function() {
-                this._draggable.off("dragstart", this._onDragStart, this).off("drag", this._onDrag, this).off("dragend", this._onDragEnd, this), this._draggable.disable()
+                this._draggable.off("dragstart", this._onDragStart, this).off("drag", this._onDrag, this).off("dragend", this._onDragEnd, this), this._draggable.disable(), o.DomUtil.removeClass(this._marker._icon, "leaflet-marker-draggable")
             },
             moved: function() {
                 return this._draggable && this._draggable._moved
             },
             _onDragStart: function() {
                 this._marker.closePopup().fire("movestart").fire("dragstart")
             },
@@ -3141,16 +3268,16 @@
                     e = t._shadow,
                     i = o.DomUtil.getPosition(t._icon),
                     n = t._map.layerPointToLatLng(i);
                 e && o.DomUtil.setPosition(e, i), t._latlng = n, t.fire("move", {
                     latlng: n
                 }).fire("drag")
             },
-            _onDragEnd: function() {
-                this._marker.fire("moveend").fire("dragend")
+            _onDragEnd: function(t) {
+                this._marker.fire("moveend").fire("dragend", t)
             }
         }), o.Control = o.Class.extend({
             options: {
                 position: "topright"
             },
             initialize: function(t) {
                 o.setOptions(this, t)
@@ -3172,14 +3299,17 @@
                     n = t._controlCorners[i];
                 return o.DomUtil.addClass(e, "leaflet-control"), -1 !== i.indexOf("bottom") ? n.insertBefore(e, n.firstChild) : n.appendChild(e), this
             },
             removeFrom: function(t) {
                 var e = this.getPosition(),
                     i = t._controlCorners[e];
                 return i.removeChild(this._container), this._map = null, this.onRemove && this.onRemove(t), this
+            },
+            _refocusOnMap: function() {
+                this._map && this._map.getContainer().focus()
             }
         }), o.control = function(t) {
             return new o.Control(t)
         }, o.Map.include({
             addControl: function(t) {
                 return t.addTo(this), this
             },
@@ -3197,35 +3327,39 @@
                 t("top", "left"), t("top", "right"), t("bottom", "left"), t("bottom", "right")
             },
             _clearControlPos: function() {
                 this._container.removeChild(this._controlContainer)
             }
         }), o.Control.Zoom = o.Control.extend({
             options: {
-                position: "topleft"
+                position: "topleft",
+                zoomInText: "+",
+                zoomInTitle: "Zoom in",
+                zoomOutText: "-",
+                zoomOutTitle: "Zoom out"
             },
             onAdd: function(t) {
                 var e = "leaflet-control-zoom",
                     i = o.DomUtil.create("div", e + " leaflet-bar");
-                return this._map = t, this._zoomInButton = this._createButton("+", "Zoom in", e + "-in", i, this._zoomIn, this), this._zoomOutButton = this._createButton("-", "Zoom out", e + "-out", i, this._zoomOut, this), t.on("zoomend zoomlevelschange", this._updateDisabled, this), i
+                return this._map = t, this._zoomInButton = this._createButton(this.options.zoomInText, this.options.zoomInTitle, e + "-in", i, this._zoomIn, this), this._zoomOutButton = this._createButton(this.options.zoomOutText, this.options.zoomOutTitle, e + "-out", i, this._zoomOut, this), this._updateDisabled(), t.on("zoomend zoomlevelschange", this._updateDisabled, this), i
             },
             onRemove: function(t) {
                 t.off("zoomend zoomlevelschange", this._updateDisabled, this)
             },
             _zoomIn: function(t) {
                 this._map.zoomIn(t.shiftKey ? 3 : 1)
             },
             _zoomOut: function(t) {
                 this._map.zoomOut(t.shiftKey ? 3 : 1)
             },
             _createButton: function(t, e, i, n, s, a) {
                 var r = o.DomUtil.create("a", i, n);
                 r.innerHTML = t, r.href = "#", r.title = e;
                 var h = o.DomEvent.stopPropagation;
-                return o.DomEvent.on(r, "click", h).on(r, "mousedown", h).on(r, "dblclick", h).on(r, "click", o.DomEvent.preventDefault).on(r, "click", s, a), r
+                return o.DomEvent.on(r, "click", h).on(r, "mousedown", h).on(r, "dblclick", h).on(r, "click", o.DomEvent.preventDefault).on(r, "click", s, a).on(r, "click", this._refocusOnMap, a), r
             },
             _updateDisabled: function() {
                 var t = this._map,
                     e = "leaflet-disabled";
                 o.DomUtil.removeClass(this._zoomInButton, e), o.DomUtil.removeClass(this._zoomOutButton, e), t._zoom === t.getMinZoom() && o.DomUtil.addClass(this._zoomOutButton, e), t._zoom === t.getMaxZoom() && o.DomUtil.addClass(this._zoomInButton, e)
             }
         }), o.Map.mergeOptions({
@@ -3239,15 +3373,17 @@
                 position: "bottomright",
                 prefix: '<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'
             },
             initialize: function(t) {
                 o.setOptions(this, t), this._attributions = {}
             },
             onAdd: function(t) {
-                return this._container = o.DomUtil.create("div", "leaflet-control-attribution"), o.DomEvent.disableClickPropagation(this._container), t.on("layeradd", this._onLayerAdd, this).on("layerremove", this._onLayerRemove, this), this._update(), this._container
+                this._container = o.DomUtil.create("div", "leaflet-control-attribution"), o.DomEvent.disableClickPropagation(this._container);
+                for (var e in t._layers) t._layers[e].getAttribution && this.addAttribution(t._layers[e].getAttribution());
+                return t.on("layeradd", this._onLayerAdd, this).on("layerremove", this._onLayerRemove, this), this._update(), this._container
             },
             onRemove: function(t) {
                 t.off("layeradd", this._onLayerAdd).off("layerremove", this._onLayerRemove)
             },
             setPrefix: function(t) {
                 return this.options.prefix = t, this._update(), this
             },
@@ -3356,20 +3492,22 @@
             removeLayer: function(t) {
                 var e = o.stamp(t);
                 return delete this._layers[e], this._update(), this
             },
             _initLayout: function() {
                 var t = "leaflet-control-layers",
                     e = this._container = o.DomUtil.create("div", t);
-                e.setAttribute("aria-haspopup", !0), o.Browser.touch ? o.DomEvent.on(e, "click", o.DomEvent.stopPropagation) : (o.DomEvent.disableClickPropagation(e), o.DomEvent.on(e, "mousewheel", o.DomEvent.stopPropagation));
+                e.setAttribute("aria-haspopup", !0), o.Browser.touch ? o.DomEvent.on(e, "click", o.DomEvent.stopPropagation) : o.DomEvent.disableClickPropagation(e).disableScrollPropagation(e);
                 var i = this._form = o.DomUtil.create("form", t + "-list");
                 if (this.options.collapsed) {
                     o.Browser.android || o.DomEvent.on(e, "mouseover", this._expand, this).on(e, "mouseout", this._collapse, this);
                     var n = this._layersLink = o.DomUtil.create("a", t + "-toggle", e);
-                    n.href = "#", n.title = "Layers", o.Browser.touch ? o.DomEvent.on(n, "click", o.DomEvent.stop).on(n, "click", this._expand, this) : o.DomEvent.on(n, "focus", this._expand, this), this._map.on("click", this._collapse, this)
+                    n.href = "#", n.title = "Layers", o.Browser.touch ? o.DomEvent.on(n, "click", o.DomEvent.stop).on(n, "click", this._expand, this) : o.DomEvent.on(n, "focus", this._expand, this), o.DomEvent.on(i, "click", function() {
+                        setTimeout(o.bind(this._onInputClick, this), 0)
+                    }, this), this._map.on("click", this._collapse, this)
                 } else this._expand();
                 this._baseLayersList = o.DomUtil.create("div", t + "-base", i), this._separator = o.DomUtil.create("div", t + "-separator", i), this._overlaysList = o.DomUtil.create("div", t + "-overlays", i), e.appendChild(i)
             },
             _addLayer: function(t, e, i) {
                 var n = o.stamp(t);
                 this._layers[n] = {
                     layer: t,
@@ -3409,15 +3547,15 @@
                 var r = t.overlay ? this._overlaysList : this._baseLayersList;
                 return r.appendChild(n), n
             },
             _onInputClick: function() {
                 var t, e, i, n = this._form.getElementsByTagName("input"),
                     o = n.length;
                 for (this._handlingClick = !0, t = 0; o > t; t++) e = n[t], i = this._layers[e.layerId], e.checked && !this._map.hasLayer(i.layer) ? this._map.addLayer(i.layer) : !e.checked && this._map.hasLayer(i.layer) && this._map.removeLayer(i.layer);
-                this._handlingClick = !1
+                this._handlingClick = !1, this._refocusOnMap()
             },
             _expand: function() {
                 o.DomUtil.addClass(this._container, "leaflet-control-layers-expanded")
             },
             _collapse: function() {
                 this._container.className = this._container.className.replace(" leaflet-control-layers-expanded", "")
             }
@@ -3446,15 +3584,15 @@
                 return new o.Point(e, i, !0)
             },
             _onTransitionEnd: function() {
                 o.DomEvent.off(this._el, o.DomUtil.TRANSITION_END, this._onTransitionEnd, this), this._inProgress && (this._inProgress = !1, this._el.style[o.DomUtil.TRANSITION] = "", this._el._leaflet_pos = this._newPos, clearInterval(this._stepTimer), this.fire("step").fire("end"))
             }
         }), o.Map.include({
             setView: function(t, e, n) {
-                if (e = this._limitZoom(e), t = o.latLng(t), n = n || {}, this._panAnim && this._panAnim.stop(), this._loaded && !n.reset && n !== !0) {
+                if (e = e === i ? this._zoom : this._limitZoom(e), t = this._limitCenter(o.latLng(t), e, this.options.maxBounds), n = n || {}, this._panAnim && this._panAnim.stop(), this._loaded && !n.reset && n !== !0) {
                     n.animate !== i && (n.zoom = o.extend({
                         animate: n.animate
                     }, n.zoom), n.pan = o.extend({
                         animate: n.animate
                     }, n.pan));
                     var s = this._zoom !== e ? this._tryAnimatedZoom && this._tryAnimatedZoom(t, e, n.zoom) : this._tryAnimatedPan(t, n.pan);
                     if (s) return clearTimeout(this._sizeTimer), this
@@ -3510,16 +3648,16 @@
             }
         }), o.Map.mergeOptions({
             zoomAnimation: !0,
             zoomAnimationThreshold: 4
         }), o.DomUtil.TRANSITION && o.Map.addInitHook(function() {
             this._zoomAnimated = this.options.zoomAnimation && o.DomUtil.TRANSITION && o.Browser.any3d && !o.Browser.android23 && !o.Browser.mobileOpera, this._zoomAnimated && o.DomEvent.on(this._mapPane, o.DomUtil.TRANSITION_END, this._catchTransitionEnd, this)
         }), o.Map.include(o.DomUtil.TRANSITION ? {
-            _catchTransitionEnd: function() {
-                this._animatingZoom && this._onZoomTransitionEnd()
+            _catchTransitionEnd: function(t) {
+                this._animatingZoom && t.propertyName.indexOf("transform") >= 0 && this._onZoomTransitionEnd()
             },
             _nothingToAnimate: function() {
                 return !this._container.getElementsByClassName("leaflet-zoom-animated").length
             },
             _tryAnimatedZoom: function(t, e, i) {
                 if (this._animatingZoom) return !0;
                 if (i = i || {}, !this._zoomAnimated || i.animate === !1 || this._nothingToAnimate() || Math.abs(e - this._zoom) > this.options.zoomAnimationThreshold) return !1;
@@ -3615,14 +3753,15 @@
                     h = this._locateOptions;
                 if (h.setView) {
                     var l = Math.min(this.getBoundsZoom(r), h.maxZoom);
                     this.setView(n, l)
                 }
                 var u = {
                     latlng: n,
-                    bounds: r
+                    bounds: r,
+                    timestamp: t.timestamp
                 };
                 for (var c in t.coords) "number" == typeof t.coords[c] && (u[c] = t.coords[c]);
                 this.fire("locationfound", u)
             }
         })
 }(window, document);
```

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.ie.css` & `django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.ie.css`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.forms.js` & `django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.forms.js`

 * *Files 1% similar despite different names*

### js-beautify {}

```diff
@@ -80,15 +80,14 @@
         // Warn if leaving with unsaved changes
         var _beforeunload = window.onbeforeunload;
         window.onbeforeunload = L.Util.bind(function(e) {
             if (this._unsavedChanges)
                 return L.GeometryField.unsavedText;
             if (typeof(_beforeunload) == 'function')
                 return _beforeunload();
-            return null;
         }, this);
     },
 
     addTo: function(map) {
         this._map = map;
 
         var store_opts = L.Util.extend(this.options, {
```

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.extras.js` & `django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.extras.js`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/leaflet.css` & `django-leaflet-0.9.0/leaflet/static/leaflet/leaflet.css`

 * *Files 6% similar despite different names*

```diff
@@ -61,14 +61,24 @@
 .leaflet-tile-pane    { z-index: 2; }
 .leaflet-objects-pane { z-index: 3; }
 .leaflet-overlay-pane { z-index: 4; }
 .leaflet-shadow-pane  { z-index: 5; }
 .leaflet-marker-pane  { z-index: 6; }
 .leaflet-popup-pane   { z-index: 7; }
 
+.leaflet-vml-shape {
+	width: 1px;
+	height: 1px;
+	}
+.lvml {
+	behavior: url(#default#VML);
+	display: inline-block;
+	position: absolute;
+	}
+
 
 /* control positioning */
 
 .leaflet-control {
 	position: relative;
 	z-index: 7;
 	pointer-events: auto;
@@ -156,17 +166,16 @@
 	cursor: -webkit-grab;
 	cursor:    -moz-grab;
 	}
 .leaflet-popup-pane,
 .leaflet-control {
 	cursor: auto;
 	}
-.leaflet-dragging,
-.leaflet-dragging .leaflet-clickable,
-.leaflet-dragging .leaflet-container {
+.leaflet-dragging .leaflet-container,
+.leaflet-dragging .leaflet-clickable {
 	cursor: move;
 	cursor: -webkit-grabbing;
 	cursor:    -moz-grabbing;
 	}
 
 
 /* visual tweaks */
@@ -178,34 +187,33 @@
 .leaflet-container a {
 	color: #0078A8;
 	}
 .leaflet-container a.leaflet-active {
 	outline: 2px solid orange;
 	}
 .leaflet-zoom-box {
-	border: 2px dotted #05f;
-	background: white;
-	opacity: 0.5;
+	border: 2px dotted #38f;
+	background: rgba(255,255,255,0.5);
 	}
 
 
 /* general typography */
 .leaflet-container {
 	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
 	}
 
 
 /* general toolbar styles */
 
 .leaflet-bar {
-	box-shadow: 0 1px 7px rgba(0,0,0,0.65);
-	-webkit-border-radius: 4px;
-	        border-radius: 4px;
+	box-shadow: 0 1px 5px rgba(0,0,0,0.65);
+	border-radius: 4px;
 	}
-.leaflet-bar a, .leaflet-bar a:hover {
+.leaflet-bar a,
+.leaflet-bar a:hover {
 	background-color: #fff;
 	border-bottom: 1px solid #ccc;
 	width: 26px;
 	height: 26px;
 	line-height: 26px;
 	display: block;
 	text-align: center;
@@ -218,81 +226,60 @@
 	background-repeat: no-repeat;
 	display: block;
 	}
 .leaflet-bar a:hover {
 	background-color: #f4f4f4;
 	}
 .leaflet-bar a:first-child {
-	-webkit-border-top-left-radius: 4px;
-	        border-top-left-radius: 4px;
-	-webkit-border-top-right-radius: 4px;
-	        border-top-right-radius: 4px;
+	border-top-left-radius: 4px;
+	border-top-right-radius: 4px;
 	}
 .leaflet-bar a:last-child {
-	-webkit-border-bottom-left-radius: 4px;
-	        border-bottom-left-radius: 4px;
-	-webkit-border-bottom-right-radius: 4px;
-	        border-bottom-right-radius: 4px;
+	border-bottom-left-radius: 4px;
+	border-bottom-right-radius: 4px;
 	border-bottom: none;
 	}
 .leaflet-bar a.leaflet-disabled {
 	cursor: default;
 	background-color: #f4f4f4;
 	color: #bbb;
 	}
 
-.leaflet-touch .leaflet-bar {
-	-webkit-border-radius: 10px;
-	        border-radius: 10px;
-	}
 .leaflet-touch .leaflet-bar a {
 	width: 30px;
 	height: 30px;
-	}
-.leaflet-touch .leaflet-bar a:first-child {
-	-webkit-border-top-left-radius: 7px;
-	        border-top-left-radius: 7px;
-	-webkit-border-top-right-radius: 7px;
-	        border-top-right-radius: 7px;
-	}
-.leaflet-touch .leaflet-bar a:last-child {
-	-webkit-border-bottom-left-radius: 7px;
-	        border-bottom-left-radius: 7px;
-	-webkit-border-bottom-right-radius: 7px;
-	        border-bottom-right-radius: 7px;
-	border-bottom: none;
+	line-height: 30px;
 	}
 
 
 /* zoom control */
 
-.leaflet-control-zoom-in {
+.leaflet-control-zoom-in,
+.leaflet-control-zoom-out {
 	font: bold 18px 'Lucida Console', Monaco, monospace;
+	text-indent: 1px;
 	}
 .leaflet-control-zoom-out {
-	font: bold 22px 'Lucida Console', Monaco, monospace;
+	font-size: 20px;
 	}
 
 .leaflet-touch .leaflet-control-zoom-in {
 	font-size: 22px;
-	line-height: 30px;
 	}
 .leaflet-touch .leaflet-control-zoom-out {
-	font-size: 28px;
-	line-height: 30px;
+	font-size: 24px;
 	}
 
 
 /* layers control */
 
 .leaflet-control-layers {
-	box-shadow: 0 1px 7px rgba(0,0,0,0.4);
-	background: #f8f8f9;
-	-webkit-border-radius: 5px;
-	        border-radius: 5px;
+	box-shadow: 0 1px 5px rgba(0,0,0,0.4);
+	background: #fff;
+	border-radius: 5px;
 	}
 .leaflet-control-layers-toggle {
 	background-image: url(images/layers.png);
 	width: 36px;
 	height: 36px;
 	}
 .leaflet-retina .leaflet-control-layers-toggle {
@@ -330,78 +317,84 @@
 	margin: 5px -10px 5px -6px;
 	}
 
 
 /* attribution and scale controls */
 
 .leaflet-container .leaflet-control-attribution {
-	background-color: rgba(255, 255, 255, 0.7);
-	box-shadow: 0 0 5px #bbb;
+	background: #fff;
+	background: rgba(255, 255, 255, 0.7);
 	margin: 0;
 	}
 .leaflet-control-attribution,
 .leaflet-control-scale-line {
 	padding: 0 5px;
 	color: #333;
 	}
+.leaflet-control-attribution a {
+	text-decoration: none;
+	}
+.leaflet-control-attribution a:hover {
+	text-decoration: underline;
+	}
 .leaflet-container .leaflet-control-attribution,
 .leaflet-container .leaflet-control-scale {
 	font-size: 11px;
 	}
 .leaflet-left .leaflet-control-scale {
 	margin-left: 5px;
 	}
 .leaflet-bottom .leaflet-control-scale {
 	margin-bottom: 5px;
 	}
 .leaflet-control-scale-line {
 	border: 2px solid #777;
 	border-top: none;
-	color: black;
 	line-height: 1.1;
 	padding: 2px 5px 1px;
 	font-size: 11px;
-	text-shadow: 1px 1px 1px #fff;
-	background-color: rgba(255, 255, 255, 0.5);
-	box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.2);
 	white-space: nowrap;
 	overflow: hidden;
+	-moz-box-sizing: content-box;
+	     box-sizing: content-box;
+
+	background: #fff;
+	background: rgba(255, 255, 255, 0.5);
 	}
 .leaflet-control-scale-line:not(:first-child) {
 	border-top: 2px solid #777;
 	border-bottom: none;
 	margin-top: -2px;
-	box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
 	}
 .leaflet-control-scale-line:not(:first-child):not(:last-child) {
 	border-bottom: 2px solid #777;
 	}
 
 .leaflet-touch .leaflet-control-attribution,
 .leaflet-touch .leaflet-control-layers,
 .leaflet-touch .leaflet-bar {
 	box-shadow: none;
 	}
 .leaflet-touch .leaflet-control-layers,
 .leaflet-touch .leaflet-bar {
-	border: 4px solid rgba(0,0,0,0.3);
+	border: 2px solid rgba(0,0,0,0.2);
+	background-clip: padding-box;
 	}
 
 
 /* popup */
 
 .leaflet-popup {
 	position: absolute;
 	text-align: center;
 	}
 .leaflet-popup-content-wrapper {
 	padding: 1px;
 	text-align: left;
-	-webkit-border-radius: 12px;
-	        border-radius: 12px;
+	border-radius: 12px;
 	}
 .leaflet-popup-content {
 	margin: 13px 19px;
 	line-height: 1.4;
 	}
 .leaflet-popup-content p {
 	margin: 18px 0;
@@ -422,15 +415,16 @@
 
 	-webkit-transform: rotate(45deg);
 	   -moz-transform: rotate(45deg);
 	    -ms-transform: rotate(45deg);
 	     -o-transform: rotate(45deg);
 	        transform: rotate(45deg);
 	}
-.leaflet-popup-content-wrapper, .leaflet-popup-tip {
+.leaflet-popup-content-wrapper,
+.leaflet-popup-tip {
 	background: white;
 
 	box-shadow: 0 3px 14px rgba(0,0,0,0.4);
 	}
 .leaflet-container a.leaflet-popup-close-button {
 	position: absolute;
 	top: 0;
@@ -450,18 +444,35 @@
 	}
 .leaflet-popup-scrolled {
 	overflow: auto;
 	border-bottom: 1px solid #ddd;
 	border-top: 1px solid #ddd;
 	}
 
+.leaflet-oldie .leaflet-popup-content-wrapper {
+	zoom: 1;
+	}
+.leaflet-oldie .leaflet-popup-tip {
+	width: 24px;
+	margin: 0 auto;
+
+	-ms-filter: "progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)";
+	filter: progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678);
+	}
+.leaflet-oldie .leaflet-popup-tip-container {
+	margin-top: -1px;
+	}
+
+.leaflet-oldie .leaflet-control-zoom,
+.leaflet-oldie .leaflet-control-layers,
+.leaflet-oldie .leaflet-popup-content-wrapper,
+.leaflet-oldie .leaflet-popup-tip {
+	border: 1px solid #999;
+	}
+
 
 /* div icon */
 
 .leaflet-div-icon {
 	background: #fff;
 	border: 1px solid #666;
 	}
-.leaflet-editing-icon {
-	-webkit-border-radius: 2px;
-	        border-radius: 2px;
-	}
```

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/leaflet-src.js` & `django-leaflet-0.9.0/leaflet/static/leaflet/leaflet-src.js`

 * *Files 1% similar despite different names*

### js-beautify {}

```diff
@@ -3,15 +3,15 @@
  (c) 2010-2013, Vladimir Agafonkin
  (c) 2010-2011, CloudMade
 */
 (function(window, document, undefined) {
     var oldL = window.L,
         L = {};
 
-    L.version = '0.6.4';
+    L.version = '0.7.1';
 
     // define Leaflet for Node module pattern loaders, including Browserify
     if (typeof module === 'object' && typeof module.exports === 'object') {
         module.exports = L;
 
         // define Leaflet as an AMD module
     } else if (typeof define === 'function' && define.amd) {
@@ -130,28 +130,27 @@
         getParamString: function(obj, existingUrl, uppercase) {
             var params = [];
             for (var i in obj) {
                 params.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));
             }
             return ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');
         },
-
         template: function(str, data) {
             return str.replace(/\{ *([\w_]+) *\}/g, function(str, key) {
                 var value = data[key];
                 if (value === undefined) {
                     throw new Error('No value provided for variable ' + str);
                 } else if (typeof value === 'function') {
                     value = value(data);
                 }
                 return value;
             });
         },
 
-        isArray: function(obj) {
+        isArray: Array.isArray || function(obj) {
             return (Object.prototype.toString.call(obj) === '[object Array]');
         },
 
         emptyImageUrl: 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs='
     };
 
     (function() {
@@ -339,28 +338,28 @@
 
             // types can be a map of types/handlers
             if (L.Util.invokeEach(types, this.addEventListener, this, fn, context)) {
                 return this;
             }
 
             var events = this[eventsKey] = this[eventsKey] || {},
-                contextId = context && L.stamp(context),
+                contextId = context && context !== this && L.stamp(context),
                 i, len, event, type, indexKey, indexLenKey, typeIndex;
 
             // types can be a string of space-separated words
             types = L.Util.splitWords(types);
 
             for (i = 0, len = types.length; i < len; i++) {
                 event = {
                     action: fn,
                     context: context || this
                 };
                 type = types[i];
 
-                if (context) {
+                if (contextId) {
                     // store listeners of a particular context in a separate hash (if it has an id)
                     // gives a major performance boost when removing thousands of map layers
 
                     indexKey = type + '_idx';
                     indexLenKey = indexKey + '_len';
 
                     typeIndex = events[indexKey] = events[indexKey] || {};
@@ -401,15 +400,15 @@
             }
 
             if (L.Util.invokeEach(types, this.removeEventListener, this, fn, context)) {
                 return this;
             }
 
             var events = this[eventsKey],
-                contextId = context && L.stamp(context),
+                contextId = context && context !== this && L.stamp(context),
                 i, len, type, listeners, j, indexKey, indexLenKey, typeIndex, removed;
 
             types = L.Util.splitWords(types);
 
             for (i = 0, len = types.length; i < len; i++) {
                 type = types[i];
                 indexKey = type + '_idx';
@@ -417,17 +416,18 @@
 
                 typeIndex = events[indexKey];
 
                 if (!fn) {
                     // clear all listeners for a type if function isn't specified
                     delete events[type];
                     delete events[indexKey];
+                    delete events[indexLenKey];
 
                 } else {
-                    listeners = context && typeIndex ? typeIndex[contextId] : events[type];
+                    listeners = contextId && typeIndex ? typeIndex[contextId] : events[type];
 
                     if (listeners) {
                         for (j = listeners.length - 1; j >= 0; j--) {
                             if ((listeners[j].action === fn) && (!context || (listeners[j].context === context))) {
                                 removed = listeners.splice(j, 1);
                                 // set the old action to a no-op, because it is possible
                                 // that the listener is being iterated over as part of a dispatch
@@ -465,27 +465,27 @@
                 listeners, i, len, typeIndex, contextId;
 
             if (events[type]) {
                 // make sure adding/removing listeners inside other listeners won't cause infinite loop
                 listeners = events[type].slice();
 
                 for (i = 0, len = listeners.length; i < len; i++) {
-                    listeners[i].action.call(listeners[i].context || this, event);
+                    listeners[i].action.call(listeners[i].context, event);
                 }
             }
 
             // fire event for the context-indexed listeners as well
             typeIndex = events[type + '_idx'];
 
             for (contextId in typeIndex) {
                 listeners = typeIndex[contextId].slice();
 
                 if (listeners) {
                     for (i = 0, len = listeners.length; i < len; i++) {
-                        listeners[i].action.call(listeners[i].context || this, event);
+                        listeners[i].action.call(listeners[i].context, event);
                     }
                 }
             }
 
             return this;
         },
 
@@ -515,51 +515,52 @@
 
     /*
      * L.Browser handles different browser and feature detections for internal Leaflet use.
      */
 
     (function() {
 
-        var ie = !!window.ActiveXObject,
-            ie6 = ie && !window.XMLHttpRequest,
-            ie7 = ie && !document.querySelector,
+        var ie = 'ActiveXObject' in window,
             ielt9 = ie && !document.addEventListener,
 
             // terrible browser detection to work around Safari / iOS / Android browser bugs
             ua = navigator.userAgent.toLowerCase(),
             webkit = ua.indexOf('webkit') !== -1,
             chrome = ua.indexOf('chrome') !== -1,
             phantomjs = ua.indexOf('phantom') !== -1,
             android = ua.indexOf('android') !== -1,
             android23 = ua.search('android [23]') !== -1,
+            gecko = ua.indexOf('gecko') !== -1,
 
             mobile = typeof orientation !== undefined + '',
-            msTouch = window.navigator && window.navigator.msPointerEnabled &&
-            window.navigator.msMaxTouchPoints,
+            msPointer = window.navigator && window.navigator.msPointerEnabled &&
+            window.navigator.msMaxTouchPoints && !window.PointerEvent,
+            pointer = (window.PointerEvent && window.navigator.pointerEnabled && window.navigator.maxTouchPoints) ||
+            msPointer,
             retina = ('devicePixelRatio' in window && window.devicePixelRatio > 1) ||
             ('matchMedia' in window && window.matchMedia('(min-resolution:144dpi)') &&
                 window.matchMedia('(min-resolution:144dpi)').matches),
 
             doc = document.documentElement,
             ie3d = ie && ('transition' in doc.style),
-            webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()),
+            webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23,
             gecko3d = 'MozPerspective' in doc.style,
             opera3d = 'OTransition' in doc.style,
             any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d || opera3d) && !phantomjs;
 
 
         // PhantomJS has 'ontouchstart' in document.documentElement, but doesn't actually support touch.
         // https://github.com/Leaflet/Leaflet/pull/1434#issuecomment-13843151
 
         var touch = !window.L_NO_TOUCH && !phantomjs && (function() {
 
             var startName = 'ontouchstart';
 
-            // IE10+ (We simulate these into touch* events in L.DomEvent and L.DomEvent.MsTouch) or WebKit, etc.
-            if (msTouch || (startName in doc)) {
+            // IE10+ (We simulate these into touch* events in L.DomEvent and L.DomEvent.Pointer) or WebKit, etc.
+            if (pointer || (startName in doc)) {
                 return true;
             }
 
             // Firefox/Gecko
             var div = document.createElement('div'),
                 supported = false;
 
@@ -577,18 +578,17 @@
 
             return supported;
         }());
 
 
         L.Browser = {
             ie: ie,
-            ie6: ie6,
-            ie7: ie7,
             ielt9: ielt9,
             webkit: webkit,
+            gecko: gecko && !webkit && !window.opera && !ie,
 
             android: android,
             android23: android23,
 
             chrome: chrome,
 
             ie3d: ie3d,
@@ -599,15 +599,16 @@
 
             mobile: mobile,
             mobileWebkit: mobile && webkit,
             mobileWebkit3d: mobile && webkit3d,
             mobileOpera: mobile && window.opera,
 
             touch: touch,
-            msTouch: msTouch,
+            msPointer: msPointer,
+            pointer: pointer,
 
             retina: retina
         };
 
     }());
 
 
@@ -892,16 +893,15 @@
         getViewportOffset: function(element) {
 
             var top = 0,
                 left = 0,
                 el = element,
                 docBody = document.body,
                 docEl = document.documentElement,
-                pos,
-                ie7 = L.Browser.ie7;
+                pos;
 
             do {
                 top += el.offsetTop || 0;
                 left += el.offsetLeft || 0;
 
                 //add borders
                 top += parseInt(L.DomUtil.getStyle(el, 'borderTopWidth'), 10) || 0;
@@ -944,27 +944,14 @@
                 if (el === docBody) {
                     break;
                 }
 
                 top -= el.scrollTop || 0;
                 left -= el.scrollLeft || 0;
 
-                // webkit (and ie <= 7) handles RTL scrollLeft different to everyone else
-                // https://code.google.com/p/closure-library/source/browse/trunk/closure/goog/style/bidi.js
-                if (!L.DomUtil.documentIsLtr() && (L.Browser.webkit || ie7)) {
-                    left += el.scrollWidth - el.clientWidth;
-
-                    // ie7 shows the scrollbar by default and provides clientWidth counting it, so we
-                    // need to add it back in if it is visible; scrollbar is on the left as we are RTL
-                    if (ie7 && L.DomUtil.getStyle(el, 'overflow-y') !== 'hidden' &&
-                        L.DomUtil.getStyle(el, 'overflow') !== 'hidden') {
-                        left += 17;
-                    }
-                }
-
                 el = el.parentNode;
             } while (el);
 
             return new L.Point(left, top);
         },
 
         documentIsLtr: function() {
@@ -984,26 +971,52 @@
                 container.appendChild(el);
             }
 
             return el;
         },
 
         hasClass: function(el, name) {
-            return (el.className.length > 0) &&
-                new RegExp('(^|\\s)' + name + '(\\s|$)').test(el.className);
+            if (el.classList !== undefined) {
+                return el.classList.contains(name);
+            }
+            var className = L.DomUtil._getClass(el);
+            return className.length > 0 && new RegExp('(^|\\s)' + name + '(\\s|$)').test(className);
         },
 
         addClass: function(el, name) {
-            if (!L.DomUtil.hasClass(el, name)) {
-                el.className += (el.className ? ' ' : '') + name;
+            if (el.classList !== undefined) {
+                var classes = L.Util.splitWords(name);
+                for (var i = 0, len = classes.length; i < len; i++) {
+                    el.classList.add(classes[i]);
+                }
+            } else if (!L.DomUtil.hasClass(el, name)) {
+                var className = L.DomUtil._getClass(el);
+                L.DomUtil._setClass(el, (className ? className + ' ' : '') + name);
             }
         },
 
         removeClass: function(el, name) {
-            el.className = L.Util.trim((' ' + el.className + ' ').replace(' ' + name + ' ', ' '));
+            if (el.classList !== undefined) {
+                el.classList.remove(name);
+            } else {
+                L.DomUtil._setClass(el, L.Util.trim((' ' + L.DomUtil._getClass(el) + ' ').replace(' ' + name + ' ', ' ')));
+            }
+        },
+
+        _setClass: function(el, name) {
+            if (el.className.baseVal === undefined) {
+                el.className = name;
+            } else {
+                // in case of SVG element
+                el.className.baseVal = name;
+            }
+        },
+
+        _getClass: function(el) {
+            return el.className.baseVal === undefined ? el.className : el.className.baseVal;
         },
 
         setOpacity: function(el, value) {
 
             if ('opacity' in el.style) {
                 el.style.opacity = value;
 
@@ -1069,19 +1082,14 @@
         setPosition: function(el, point, disable3D) { // (HTMLElement, Point[, Boolean])
 
             // jshint camelcase: false
             el._leaflet_pos = point;
 
             if (!disable3D && L.Browser.any3d) {
                 el.style[L.DomUtil.TRANSFORM] = L.DomUtil.getTranslateString(point);
-
-                // workaround for Android 2/3 stability (https://github.com/CloudMade/Leaflet/issues/69)
-                if (L.Browser.mobileWebkit3d) {
-                    el.style.WebkitBackfaceVisibility = 'hidden';
-                }
             } else {
                 el.style.left = point.x + 'px';
                 el.style.top = point.y + 'px';
             }
         },
 
         getPosition: function(el) {
@@ -1106,35 +1114,47 @@
         ['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);
 
     L.DomUtil.TRANSITION_END =
         L.DomUtil.TRANSITION === 'webkitTransition' || L.DomUtil.TRANSITION === 'OTransition' ?
         L.DomUtil.TRANSITION + 'End' : 'transitionend';
 
     (function() {
-        var userSelectProperty = L.DomUtil.testProp(
-            ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);
+        if ('onselectstart' in document) {
+            L.extend(L.DomUtil, {
+                disableTextSelection: function() {
+                    L.DomEvent.on(window, 'selectstart', L.DomEvent.preventDefault);
+                },
 
-        L.extend(L.DomUtil, {
-            disableTextSelection: function() {
-                L.DomEvent.on(window, 'selectstart', L.DomEvent.preventDefault);
-                if (userSelectProperty) {
-                    var style = document.documentElement.style;
-                    this._userSelect = style[userSelectProperty];
-                    style[userSelectProperty] = 'none';
+                enableTextSelection: function() {
+                    L.DomEvent.off(window, 'selectstart', L.DomEvent.preventDefault);
                 }
-            },
+            });
+        } else {
+            var userSelectProperty = L.DomUtil.testProp(
+                ['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);
+
+            L.extend(L.DomUtil, {
+                disableTextSelection: function() {
+                    if (userSelectProperty) {
+                        var style = document.documentElement.style;
+                        this._userSelect = style[userSelectProperty];
+                        style[userSelectProperty] = 'none';
+                    }
+                },
 
-            enableTextSelection: function() {
-                L.DomEvent.off(window, 'selectstart', L.DomEvent.preventDefault);
-                if (userSelectProperty) {
-                    document.documentElement.style[userSelectProperty] = this._userSelect;
-                    delete this._userSelect;
+                enableTextSelection: function() {
+                    if (userSelectProperty) {
+                        document.documentElement.style[userSelectProperty] = this._userSelect;
+                        delete this._userSelect;
+                    }
                 }
-            },
+            });
+        }
 
+        L.extend(L.DomUtil, {
             disableImageDrag: function() {
                 L.DomEvent.on(window, 'dragstart', L.DomEvent.preventDefault);
             },
 
             enableImageDrag: function() {
                 L.DomEvent.off(window, 'dragstart', L.DomEvent.preventDefault);
             }
@@ -1142,24 +1162,28 @@
     })();
 
 
     /*
      * L.LatLng represents a geographical point with latitude and longitude coordinates.
      */
 
-    L.LatLng = function(rawLat, rawLng) { // (Number, Number)
-        var lat = parseFloat(rawLat),
-            lng = parseFloat(rawLng);
+    L.LatLng = function(lat, lng, alt) { // (Number, Number, Number)
+        lat = parseFloat(lat);
+        lng = parseFloat(lng);
 
         if (isNaN(lat) || isNaN(lng)) {
-            throw new Error('Invalid LatLng object: (' + rawLat + ', ' + rawLng + ')');
+            throw new Error('Invalid LatLng object: (' + lat + ', ' + lng + ')');
         }
 
         this.lat = lat;
         this.lng = lng;
+
+        if (alt !== undefined) {
+            this.alt = parseFloat(alt);
+        }
     };
 
     L.extend(L.LatLng, {
         DEG_TO_RAD: Math.PI / 180,
         RAD_TO_DEG: 180 / Math.PI,
         MAX_MARGIN: 1.0E-9 // max margin of error for the "equals" check
     });
@@ -1217,22 +1241,29 @@
     };
 
     L.latLng = function(a, b) { // (LatLng) or ([Number, Number]) or (Number, Number)
         if (a instanceof L.LatLng) {
             return a;
         }
         if (L.Util.isArray(a)) {
-            return new L.LatLng(a[0], a[1]);
+            if (typeof a[0] === 'number' || typeof a[0] === 'string') {
+                return new L.LatLng(a[0], a[1], a[2]);
+            } else {
+                return null;
+            }
         }
         if (a === undefined || a === null) {
             return a;
         }
         if (typeof a === 'object' && 'lat' in a) {
             return new L.LatLng(a.lat, 'lng' in a ? a.lng : a.lon);
         }
+        if (b === undefined) {
+            return null;
+        }
         return new L.LatLng(a, b);
     };
 
 
 
     /*
      * L.LatLngBounds represents a rectangular area on the map in geographical coordinates.
@@ -1253,16 +1284,17 @@
     L.LatLngBounds.prototype = {
         // extend the bounds to contain the given point or bounds
         extend: function(obj) { // (LatLng) or (LatLngBounds)
             if (!obj) {
                 return this;
             }
 
-            if (typeof obj[0] === 'number' || typeof obj[0] === 'string' || obj instanceof L.LatLng) {
-                obj = L.latLng(obj);
+            var latLng = L.latLng(obj);
+            if (latLng !== null) {
+                obj = latLng;
             } else {
                 obj = L.latLngBounds(obj);
             }
 
             if (obj instanceof L.LatLng) {
                 if (!this._southWest && !this._northEast) {
                     this._southWest = new L.LatLng(obj.lat, obj.lng);
@@ -1469,14 +1501,19 @@
 
         project: function(latlng) {
             return this.projection.project(latlng);
         },
 
         scale: function(zoom) {
             return 256 * Math.pow(2, zoom);
+        },
+
+        getSize: function(zoom) {
+            var s = this.scale(zoom);
+            return L.point(s, s);
         }
     };
 
 
     /*
      * A simple CRS that can be used for flat non-Earth maps like panoramas or game maps.
      */
@@ -1547,16 +1584,21 @@
             trackResize: true,
             markerZoomAnimation: L.DomUtil.TRANSITION && L.Browser.any3d
         },
 
         initialize: function(id, options) { // (HTMLElement or String, Object)
             options = L.setOptions(this, options);
 
+
             this._initContainer(id);
             this._initLayout();
+
+            // hack for https://github.com/Leaflet/Leaflet/issues/1980
+            this._onResize = L.bind(this._onResize, this);
+
             this._initEvents();
 
             if (options.maxBounds) {
                 this.setMaxBounds(options.maxBounds);
             }
 
             if (options.center && options.zoom !== undefined) {
@@ -1577,19 +1619,24 @@
         },
 
 
         // public methods that modify map state
 
         // replaced by animation-powered implementation in Map.PanAnimation.js
         setView: function(center, zoom) {
+            zoom = zoom === undefined ? this.getZoom() : zoom;
             this._resetView(L.latLng(center), this._limitZoom(zoom));
             return this;
         },
 
         setZoom: function(zoom, options) {
+            if (!this._loaded) {
+                this._zoom = this._limitZoom(zoom);
+                return this;
+            }
             return this.setView(this.getCenter(), zoom, {
                 zoom: options
             });
         },
 
         zoomIn: function(delta, options) {
             return this.setZoom(this._zoom + (delta || 1), options);
@@ -1623,14 +1670,16 @@
                 zoom = this.getBoundsZoom(bounds, false, paddingTL.add(paddingBR)),
                 paddingOffset = paddingBR.subtract(paddingTL).divideBy(2),
 
                 swPoint = this.project(bounds.getSouthWest(), zoom),
                 nePoint = this.project(bounds.getNorthEast(), zoom),
                 center = this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset), zoom);
 
+            zoom = options && options.maxZoom ? Math.min(options.maxZoom, zoom) : zoom;
+
             return this.setView(center, zoom, options);
         },
 
         fitWorld: function(options) {
             return this.fitBounds([
                 [-90, -180],
                 [90, 180]
@@ -1640,80 +1689,48 @@
         panTo: function(center, options) { // (LatLng)
             return this.setView(center, this._zoom, {
                 pan: options
             });
         },
 
         panBy: function(offset) { // (Point)
-            // replaced with animated panBy in Map.Animation.js
+            // replaced with animated panBy in Map.PanAnimation.js
             this.fire('movestart');
 
             this._rawPanBy(L.point(offset));
 
             this.fire('move');
             return this.fire('moveend');
         },
 
-        setMaxBounds: function(bounds, options) {
+        setMaxBounds: function(bounds) {
             bounds = L.latLngBounds(bounds);
 
             this.options.maxBounds = bounds;
 
             if (!bounds) {
-                this._boundsMinZoom = null;
-                this.off('moveend', this._panInsideMaxBounds, this);
-                return this;
+                return this.off('moveend', this._panInsideMaxBounds, this);
             }
 
-            var minZoom = this.getBoundsZoom(bounds, true);
-
-            this._boundsMinZoom = minZoom;
-
             if (this._loaded) {
-                if (this._zoom < minZoom) {
-                    this.setView(bounds.getCenter(), minZoom, options);
-                } else {
-                    this.panInsideBounds(bounds);
-                }
+                this._panInsideMaxBounds();
             }
 
-            this.on('moveend', this._panInsideMaxBounds, this);
-
-            return this;
+            return this.on('moveend', this._panInsideMaxBounds, this);
         },
 
-        panInsideBounds: function(bounds) {
-            bounds = L.latLngBounds(bounds);
-
-            var viewBounds = this.getPixelBounds(),
-                viewSw = viewBounds.getBottomLeft(),
-                viewNe = viewBounds.getTopRight(),
-                sw = this.project(bounds.getSouthWest()),
-                ne = this.project(bounds.getNorthEast()),
-                dx = 0,
-                dy = 0;
+        panInsideBounds: function(bounds, options) {
+            var center = this.getCenter(),
+                newCenter = this._limitCenter(center, this._zoom, bounds);
 
-            if (viewNe.y < ne.y) { // north
-                dy = Math.ceil(ne.y - viewNe.y);
-            }
-            if (viewNe.x > ne.x) { // east
-                dx = Math.floor(ne.x - viewNe.x);
-            }
-            if (viewSw.y > sw.y) { // south
-                dy = Math.floor(sw.y - viewSw.y);
-            }
-            if (viewSw.x < sw.x) { // west
-                dx = Math.ceil(sw.x - viewSw.x);
-            }
-
-            if (dx || dy) {
-                return this.panBy([dx, dy]);
+            if (center.equals(newCenter)) {
+                return this;
             }
 
-            return this;
+            return this.panTo(newCenter, options);
         },
 
         addLayer: function(layer) {
             // TODO method is too big, refactor
 
             var id = L.stamp(layer);
 
@@ -1743,15 +1760,15 @@
             return this;
         },
 
         removeLayer: function(layer) {
             var id = L.stamp(layer);
 
             if (!this._layers[id]) {
-                return;
+                return this;
             }
 
             if (this._loaded) {
                 layer.onRemove(this);
             }
 
             delete this._layers[id];
@@ -1789,34 +1806,33 @@
             for (var i in this._layers) {
                 method.call(context, this._layers[i]);
             }
             return this;
         },
 
         invalidateSize: function(options) {
+            if (!this._loaded) {
+                return this;
+            }
+
             options = L.extend({
                 animate: false,
                 pan: true
             }, options === true ? {
                 animate: true
             } : options);
 
             var oldSize = this.getSize();
             this._sizeChanged = true;
-
-            if (this.options.maxBounds) {
-                this.setMaxBounds(this.options.maxBounds);
-            }
-
-            if (!this._loaded) {
-                return this;
-            }
+            this._initialCenter = null;
 
             var newSize = this.getSize(),
-                offset = oldSize.subtract(newSize).divideBy(2).round();
+                oldCenter = oldSize.divideBy(2).round(),
+                newCenter = newSize.divideBy(2).round(),
+                offset = oldCenter.subtract(newCenter);
 
             if (!offset.x && !offset.y) {
                 return this;
             }
 
             if (options.animate && options.pan) {
                 this.panBy(offset);
@@ -1824,29 +1840,32 @@
             } else {
                 if (options.pan) {
                     this._rawPanBy(offset);
                 }
 
                 this.fire('move');
 
-                // make sure moveend is not fired too often on resize
-                clearTimeout(this._sizeTimer);
-                this._sizeTimer = setTimeout(L.bind(this.fire, this, 'moveend'), 200);
+                if (options.debounceMoveend) {
+                    clearTimeout(this._sizeTimer);
+                    this._sizeTimer = setTimeout(L.bind(this.fire, this, 'moveend'), 200);
+                } else {
+                    this.fire('moveend');
+                }
             }
 
             return this.fire('resize', {
                 oldSize: oldSize,
                 newSize: newSize
             });
         },
 
         // TODO handler.addTo
         addHandler: function(name, HandlerClass) {
             if (!HandlerClass) {
-                return;
+                return this;
             }
 
             var handler = this[name] = new HandlerClass(this);
 
             this._handlers.push(handler);
 
             if (this.options[name]) {
@@ -1859,15 +1878,20 @@
         remove: function() {
             if (this._loaded) {
                 this.fire('unload');
             }
 
             this._initEvents('off');
 
-            delete this._container._leaflet;
+            try {
+                // throws error in IE6-8
+                delete this._container._leaflet;
+            } catch (e) {
+                this._container._leaflet = undefined;
+            }
 
             this._clearPanes();
             if (this._clearControlPos) {
                 this._clearControlPos();
             }
 
             this._clearHandlers();
@@ -1877,15 +1901,15 @@
 
 
         // public methods for getting map state
 
         getCenter: function() { // (Boolean) -> LatLng
             this._checkIfLoaded();
 
-            if (!this._moved()) {
+            if (this._initialCenter && !this._moved()) {
                 return this._initialCenter;
             }
             return this.layerPointToLatLng(this._getCenterLayerPoint());
         },
 
         getZoom: function() {
             return this._zoom;
@@ -1896,17 +1920,17 @@
                 sw = this.unproject(bounds.getBottomLeft()),
                 ne = this.unproject(bounds.getTopRight());
 
             return new L.LatLngBounds(sw, ne);
         },
 
         getMinZoom: function() {
-            var z1 = this._layersMinZoom === undefined ? 0 : this._layersMinZoom,
-                z2 = this._boundsMinZoom === undefined ? 0 : this._boundsMinZoom;
-            return this.options.minZoom === undefined ? Math.max(z1, z2) : this.options.minZoom;
+            return this.options.minZoom === undefined ?
+                (this._layersMinZoom === undefined ? 0 : this._layersMinZoom) :
+                this.options.minZoom;
         },
 
         getMaxZoom: function() {
             return this.options.maxZoom === undefined ?
                 (this._layersMaxZoom === undefined ? Infinity : this._layersMaxZoom) :
                 this.options.maxZoom;
         },
@@ -2050,14 +2074,15 @@
 
         _initLayout: function() {
             var container = this._container;
 
             L.DomUtil.addClass(container, 'leaflet-container' +
                 (L.Browser.touch ? ' leaflet-touch' : '') +
                 (L.Browser.retina ? ' leaflet-retina' : '') +
+                (L.Browser.ielt9 ? ' leaflet-oldie' : '') +
                 (this.options.fadeAnimation ? ' leaflet-fade-anim' : ''));
 
             var position = L.DomUtil.getStyle(container, 'position');
 
             if (position !== 'absolute' && position !== 'relative' && position !== 'fixed') {
                 container.style.position = 'relative';
             }
@@ -2227,19 +2252,25 @@
                 L.DomEvent[onOff](window, 'resize', this._onResize, this);
             }
         },
 
         _onResize: function() {
             L.Util.cancelAnimFrame(this._resizeRequest);
             this._resizeRequest = L.Util.requestAnimFrame(
-                this.invalidateSize, this, false, this._container);
+                function() {
+                    this.invalidateSize({
+                        debounceMoveend: true
+                    });
+                }, this, false, this._container);
         },
 
         _onMouseClick: function(e) {
-            if (!this._loaded || (!e._simulated && this.dragging && this.dragging.moved()) ||
+            if (!this._loaded || (!e._simulated &&
+                    ((this.dragging && this.dragging.moved()) ||
+                        (this.boxZoom && this.boxZoom.moved()))) ||
                 L.DomEvent._skipped(e)) {
                 return;
             }
 
             this.fire('preclick');
             this._fireMouseEvent(e);
         },
@@ -2335,14 +2366,58 @@
         },
 
         // offset of the specified place to the current center in pixels
         _getCenterOffset: function(latlng) {
             return this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint());
         },
 
+        // adjust center for view to get inside bounds
+        _limitCenter: function(center, zoom, bounds) {
+
+            if (!bounds) {
+                return center;
+            }
+
+            var centerPoint = this.project(center, zoom),
+                viewHalf = this.getSize().divideBy(2),
+                viewBounds = new L.Bounds(centerPoint.subtract(viewHalf), centerPoint.add(viewHalf)),
+                offset = this._getBoundsOffset(viewBounds, bounds, zoom);
+
+            return this.unproject(centerPoint.add(offset), zoom);
+        },
+
+        // adjust offset for view to get inside bounds
+        _limitOffset: function(offset, bounds) {
+            if (!bounds) {
+                return offset;
+            }
+
+            var viewBounds = this.getPixelBounds(),
+                newBounds = new L.Bounds(viewBounds.min.add(offset), viewBounds.max.add(offset));
+
+            return offset.add(this._getBoundsOffset(newBounds, bounds));
+        },
+
+        // returns offset needed for pxBounds to get inside maxBounds at a specified zoom
+        _getBoundsOffset: function(pxBounds, maxBounds, zoom) {
+            var nwOffset = this.project(maxBounds.getNorthWest(), zoom).subtract(pxBounds.min),
+                seOffset = this.project(maxBounds.getSouthEast(), zoom).subtract(pxBounds.max),
+
+                dx = this._rebound(nwOffset.x, -seOffset.x),
+                dy = this._rebound(nwOffset.y, -seOffset.y);
+
+            return new L.Point(dx, dy);
+        },
+
+        _rebound: function(left, right) {
+            return left + right > 0 ?
+                Math.round(left - right) / 2 :
+                Math.max(0, Math.ceil(left)) - Math.max(0, Math.floor(right));
+        },
+
         _limitZoom: function(zoom) {
             var min = this.getMinZoom(),
                 max = this.getMaxZoom();
 
             return Math.max(min, Math.min(max, zoom));
         }
     });
@@ -2415,17 +2490,17 @@
         code: 'EPSG:3395',
 
         projection: L.Projection.Mercator,
 
         transformation: (function() {
             var m = L.Projection.Mercator,
                 r = m.R_MAJOR,
-                r2 = m.R_MINOR;
+                scale = 0.5 / (Math.PI * r);
 
-            return new L.Transformation(0.5 / (Math.PI * r), 0.5, -0.5 / (Math.PI * r2), 0.5);
+            return new L.Transformation(scale, 0.5, -scale, 0.5);
         }())
     });
 
 
     /*
      * L.TileLayer is used for standard xyz-numbered tile layers.
      */
@@ -2438,15 +2513,16 @@
             maxZoom: 18,
             tileSize: 256,
             subdomains: 'abc',
             errorTileUrl: '',
             attribution: '',
             zoomOffset: 0,
             opacity: 1,
-            /* (undefined works too)
+            /*
+            maxNativeZoom: null,
             zIndex: null,
             tms: false,
             continuousWorld: false,
             noWrap: false,
             zoomReverse: false,
             detectRetina: false,
             reuseTiles: false,
@@ -2487,17 +2563,14 @@
         onAdd: function(map) {
             this._map = map;
             this._animated = map._zoomAnimated;
 
             // create a container div for tiles
             this._initContainer();
 
-            // create an image to clone for tiles
-            this._createTileProto();
-
             // set up events
             map.on({
                 'viewreset': this._reset,
                 'moveend': this._update
             }, this);
 
             if (this._animated) {
@@ -2656,15 +2729,15 @@
 
             if (!this._container) {
                 this._container = L.DomUtil.create('div', 'leaflet-layer');
 
                 this._updateZIndex();
 
                 if (this._animated) {
-                    var className = 'leaflet-tile-container leaflet-zoom-animated';
+                    var className = 'leaflet-tile-container';
 
                     this._bgBuffer = L.DomUtil.create('div', className, this._container);
                     this._tileContainer = L.DomUtil.create('div', className, this._container);
 
                 } else {
                     this._tileContainer = this._container;
                 }
@@ -2696,23 +2769,37 @@
             if (this._animated && e && e.hard) {
                 this._clearBgBuffer();
             }
 
             this._initContainer();
         },
 
+        _getTileSize: function() {
+            var map = this._map,
+                zoom = map.getZoom() + this.options.zoomOffset,
+                zoomN = this.options.maxNativeZoom,
+                tileSize = this.options.tileSize;
+
+            if (zoomN && zoom > zoomN) {
+                tileSize = Math.round(map.getZoomScale(zoom) / map.getZoomScale(zoomN) * tileSize);
+            }
+
+            return tileSize;
+        },
+
         _update: function() {
 
             if (!this._map) {
                 return;
             }
 
-            var bounds = this._map.getPixelBounds(),
-                zoom = this._map.getZoom(),
-                tileSize = this.options.tileSize;
+            var map = this._map,
+                bounds = map.getPixelBounds(),
+                zoom = map.getZoom(),
+                tileSize = this._getTileSize();
 
             if (zoom > this.options.maxZoom || zoom < this.options.minZoom) {
                 return;
             }
 
             var tileBounds = L.bounds(
                 bounds.min.divideBy(tileSize)._floor(),
@@ -2775,16 +2862,16 @@
 
             var options = this.options;
 
             if (!options.continuousWorld) {
                 var limit = this._getWrapTileNum();
 
                 // don't load if exceeds world bounds
-                if ((options.noWrap && (tilePoint.x < 0 || tilePoint.x >= limit)) ||
-                    tilePoint.y < 0 || tilePoint.y >= limit) {
+                if ((options.noWrap && (tilePoint.x < 0 || tilePoint.x >= limit.x)) ||
+                    tilePoint.y < 0 || tilePoint.y >= limit.y) {
                     return false;
                 }
             }
 
             if (options.bounds) {
                 var tileSize = options.tileSize,
                     nwPoint = tilePoint.multiplyBy(tileSize),
@@ -2852,19 +2939,17 @@
 
             // get unused tile - or create a new tile
             var tile = this._getTile();
 
             /*
             Chrome 20 layouts much faster with top/left (verify with timeline, frames)
             Android 4 browser has display issues with top/left and requires transform instead
-            Android 2 browser requires top/left or tiles disappear on load or first drag
-            (reappear after zoom) https://github.com/CloudMade/Leaflet/issues/866
             (other browsers don't currently care) - see debug/hacks/jitter.html for an example
             */
-            L.DomUtil.setPosition(tile, tilePos, L.Browser.chrome || L.Browser.android23);
+            L.DomUtil.setPosition(tile, tilePos, L.Browser.chrome);
 
             this._tiles[tilePoint.x + ':' + tilePoint.y] = tile;
 
             this._loadTile(tile, tilePoint);
 
             if (tile.parentNode !== this._tileContainer) {
                 container.appendChild(tile);
@@ -2876,20 +2961,22 @@
             var options = this.options,
                 zoom = this._map.getZoom();
 
             if (options.zoomReverse) {
                 zoom = options.maxZoom - zoom;
             }
 
-            return zoom + options.zoomOffset;
+            zoom += options.zoomOffset;
+
+            return options.maxNativeZoom ? Math.min(zoom, options.maxNativeZoom) : zoom;
         },
 
         _getTilePos: function(tilePoint) {
             var origin = this._map.getPixelOrigin(),
-                tileSize = this.options.tileSize;
+                tileSize = this._getTileSize();
 
             return tilePoint.multiplyBy(tileSize).subtract(origin);
         },
 
         // image-specific code (override to implement e.g. Canvas or SVG tile layer)
 
         getTileUrl: function(tilePoint) {
@@ -2898,78 +2985,91 @@
                 z: tilePoint.z,
                 x: tilePoint.x,
                 y: tilePoint.y
             }, this.options));
         },
 
         _getWrapTileNum: function() {
-            // TODO refactor, limit is not valid for non-standard projections
-            return Math.pow(2, this._getZoomForUrl());
+            var crs = this._map.options.crs,
+                size = crs.getSize(this._map.getZoom());
+            return size.divideBy(this.options.tileSize);
         },
 
         _adjustTilePoint: function(tilePoint) {
 
             var limit = this._getWrapTileNum();
 
             // wrap tile coordinates
             if (!this.options.continuousWorld && !this.options.noWrap) {
-                tilePoint.x = ((tilePoint.x % limit) + limit) % limit;
+                tilePoint.x = ((tilePoint.x % limit.x) + limit.x) % limit.x;
             }
 
             if (this.options.tms) {
-                tilePoint.y = limit - tilePoint.y - 1;
+                tilePoint.y = limit.y - tilePoint.y - 1;
             }
 
             tilePoint.z = this._getZoomForUrl();
         },
 
         _getSubdomain: function(tilePoint) {
             var index = Math.abs(tilePoint.x + tilePoint.y) % this.options.subdomains.length;
             return this.options.subdomains[index];
         },
 
-        _createTileProto: function() {
-            var img = this._tileImg = L.DomUtil.create('img', 'leaflet-tile');
-            img.style.width = img.style.height = this.options.tileSize + 'px';
-            img.galleryimg = 'no';
-        },
-
         _getTile: function() {
             if (this.options.reuseTiles && this._unusedTiles.length > 0) {
                 var tile = this._unusedTiles.pop();
                 this._resetTile(tile);
                 return tile;
             }
             return this._createTile();
         },
 
         // Override if data stored on a tile needs to be cleaned up before reuse
         _resetTile: function( /*tile*/ ) {},
 
         _createTile: function() {
-            var tile = this._tileImg.cloneNode(false);
+            var tile = L.DomUtil.create('img', 'leaflet-tile');
+            tile.style.width = tile.style.height = this._getTileSize() + 'px';
+            tile.galleryimg = 'no';
+
             tile.onselectstart = tile.onmousemove = L.Util.falseFn;
 
             if (L.Browser.ielt9 && this.options.opacity !== undefined) {
                 L.DomUtil.setOpacity(tile, this.options.opacity);
             }
+            // without this hack, tiles disappear after zoom on Chrome for Android
+            // https://github.com/Leaflet/Leaflet/issues/2078
+            if (L.Browser.mobileWebkit3d) {
+                tile.style.WebkitBackfaceVisibility = 'hidden';
+            }
             return tile;
         },
 
         _loadTile: function(tile, tilePoint) {
             tile._layer = this;
             tile.onload = this._tileOnLoad;
             tile.onerror = this._tileOnError;
 
             this._adjustTilePoint(tilePoint);
             tile.src = this.getTileUrl(tilePoint);
+
+            this.fire('tileloadstart', {
+                tile: tile,
+                url: tile.src
+            });
         },
 
         _tileLoaded: function() {
             this._tilesToLoad--;
+
+            if (this._animated) {
+                L.DomUtil.addClass(this._tileContainer, 'leaflet-zoom-animated');
+            }
+
             if (!this._tilesToLoad) {
                 this.fire('load');
 
                 if (this._animated) {
                     // clear scaled tiles after all new tiles are loaded (for performance)
                     clearTimeout(this._clearBgBufferTimer);
                     this._clearBgBufferTimer = setTimeout(L.bind(this._clearBgBuffer, this), 500);
@@ -3056,32 +3156,33 @@
             L.setOptions(this, options);
         },
 
         onAdd: function(map) {
 
             this._crs = this.options.crs || map.options.crs;
 
-            var projectionKey = parseFloat(this.wmsParams.version) >= 1.3 ? 'crs' : 'srs';
+            this._wmsVersion = parseFloat(this.wmsParams.version);
+
+            var projectionKey = this._wmsVersion >= 1.3 ? 'crs' : 'srs';
             this.wmsParams[projectionKey] = this._crs.code;
 
             L.TileLayer.prototype.onAdd.call(this, map);
         },
 
-        getTileUrl: function(tilePoint, zoom) { // (Point, Number) -> String
+        getTileUrl: function(tilePoint) { // (Point, Number) -> String
 
             var map = this._map,
                 tileSize = this.options.tileSize,
 
                 nwPoint = tilePoint.multiplyBy(tileSize),
                 sePoint = nwPoint.add([tileSize, tileSize]),
 
-                nw = this._crs.project(map.unproject(nwPoint, zoom)),
-                se = this._crs.project(map.unproject(sePoint, zoom)),
-
-                bbox = [nw.x, se.y, se.x, nw.y].join(','),
+                nw = this._crs.project(map.unproject(nwPoint, tilePoint.z)),
+                se = this._crs.project(map.unproject(sePoint, tilePoint.z)),
+                bbox = this._wmsVersion >= 1.3 && this._crs === L.CRS.EPSG4326 ? [se.y, nw.x, nw.y, se.x].join(',') : [nw.x, se.y, se.x, nw.y].join(','),
 
                 url = L.Util.template(this._url, {
                     s: this._getSubdomain(tilePoint)
                 });
 
             return url + L.Util.getParamString(this.wmsParams, url, true) + '&BBOX=' + bbox;
         },
@@ -3131,21 +3232,17 @@
             return this;
         },
 
         _redrawTile: function(tile) {
             this.drawTile(tile, tile._tilePoint, this._map._zoom);
         },
 
-        _createTileProto: function() {
-            var proto = this._canvasProto = L.DomUtil.create('canvas', 'leaflet-tile');
-            proto.width = proto.height = this.options.tileSize;
-        },
-
         _createTile: function() {
-            var tile = this._canvasProto.cloneNode(false);
+            var tile = L.DomUtil.create('canvas', 'leaflet-tile');
+            tile.width = tile.height = this.options.tileSize;
             tile.onselectstart = tile.onmousemove = L.Util.falseFn;
             return tile;
         },
 
         _loadTile: function(tile, tilePoint) {
             tile._layer = this;
             tile._tilePoint = tilePoint;
@@ -3241,14 +3338,23 @@
             var pane = this._map._panes.overlayPane;
             if (this._image) {
                 pane.insertBefore(this._image, pane.firstChild);
             }
             return this;
         },
 
+        setUrl: function(url) {
+            this._url = url;
+            this._image.src = this._url;
+        },
+
+        getAttribution: function() {
+            return this.options.attribution;
+        },
+
         _initImage: function() {
             this._image = L.DomUtil.create('img', 'leaflet-image-layer');
 
             if (this._map.options.zoomAnimation && L.Browser.any3d) {
                 L.DomUtil.addClass(this._image, 'leaflet-zoom-animated');
             } else {
                 L.DomUtil.addClass(this._image, 'leaflet-zoom-hide');
@@ -3384,27 +3490,16 @@
             if (size) {
                 img.style.width = size.x + 'px';
                 img.style.height = size.y + 'px';
             }
         },
 
         _createImg: function(src, el) {
-
-            if (!L.Browser.ie6) {
-                if (!el) {
-                    el = document.createElement('img');
-                }
-                el.src = src;
-            } else {
-                if (!el) {
-                    el = document.createElement('div');
-                }
-                el.style.filter =
-                    'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="' + src + '")';
-            }
+            el = el || document.createElement('img');
+            el.src = src;
             return el;
         },
 
         _getIconUrl: function(name) {
             if (L.Browser.retina && this.options[name + 'RetinaUrl']) {
                 return this.options[name + 'RetinaUrl'];
             }
@@ -3477,14 +3572,15 @@
     L.Marker = L.Class.extend({
 
         includes: L.Mixin.Events,
 
         options: {
             icon: new L.Icon.Default(),
             title: '',
+            alt: '',
             clickable: true,
             draggable: false,
             keyboard: true,
             zIndexOffset: 0,
             opacity: 1,
             riseOnHover: false,
             riseOffset: 250
@@ -3498,14 +3594,15 @@
         onAdd: function(map) {
             this._map = map;
 
             map.on('viewreset', this.update, this);
 
             this._initIcon();
             this.update();
+            this.fire('add');
 
             if (map.options.zoomAnimation && map.options.markerZoomAnimation) {
                 map.on('zoomanim', this._animateZoom, this);
             }
         },
 
         addTo: function(map) {
@@ -3557,14 +3654,18 @@
             this.options.icon = icon;
 
             if (this._map) {
                 this._initIcon();
                 this.update();
             }
 
+            if (this._popup) {
+                this.bindPopup(this._popup);
+            }
+
             return this;
         },
 
         update: function() {
             if (this._icon) {
                 var pos = this._map.latLngToLayerPoint(this._latlng).round();
                 this._setPos(pos);
@@ -3588,14 +3689,18 @@
                     this._removeIcon();
                 }
                 addIcon = true;
 
                 if (options.title) {
                     icon.title = options.title;
                 }
+
+                if (options.alt) {
+                    icon.alt = options.alt;
+                }
             }
 
             L.DomUtil.addClass(icon, classToAdd);
 
             if (options.keyboard) {
                 icon.tabIndex = '0';
             }
@@ -3672,15 +3777,15 @@
         },
 
         _updateZIndex: function(offset) {
             this._icon.style.zIndex = this._zIndex + offset;
         },
 
         _animateZoom: function(opt) {
-            var pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center);
+            var pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center).round();
 
             this._setPos(pos);
         },
 
         _initInteraction: function() {
 
             if (!this.options.clickable) {
@@ -3845,19 +3950,21 @@
 
     L.Popup = L.Class.extend({
         includes: L.Mixin.Events,
 
         options: {
             minWidth: 50,
             maxWidth: 300,
-            maxHeight: null,
+            // maxHeight: null,
             autoPan: true,
             closeButton: true,
             offset: [0, 7],
             autoPanPadding: [5, 5],
+            // autoPanPaddingTopLeft: null,
+            // autoPanPaddingBottomRight: null,
             keepInView: false,
             className: '',
             zoomAnimation: true
         },
 
         initialize: function(options, source) {
             L.setOptions(this, options);
@@ -3869,26 +3976,25 @@
 
         onAdd: function(map) {
             this._map = map;
 
             if (!this._container) {
                 this._initLayout();
             }
-            this._updateContent();
 
             var animFade = map.options.fadeAnimation;
 
             if (animFade) {
                 L.DomUtil.setOpacity(this._container, 0);
             }
             map._panes.popupPane.appendChild(this._container);
 
             map.on(this._getEvents(), this);
 
-            this._update();
+            this.update();
 
             if (animFade) {
                 L.DomUtil.setOpacity(this._container, 1);
             }
 
             this.fire('open');
 
@@ -3935,26 +4041,53 @@
             if (this._source) {
                 this._source.fire('popupclose', {
                     popup: this
                 });
             }
         },
 
+        getLatLng: function() {
+            return this._latlng;
+        },
+
         setLatLng: function(latlng) {
             this._latlng = L.latLng(latlng);
-            this._update();
+            if (this._map) {
+                this._updatePosition();
+                this._adjustPan();
+            }
             return this;
         },
 
+        getContent: function() {
+            return this._content;
+        },
+
         setContent: function(content) {
             this._content = content;
-            this._update();
+            this.update();
             return this;
         },
 
+        update: function() {
+            if (!this._map) {
+                return;
+            }
+
+            this._container.style.visibility = 'hidden';
+
+            this._updateContent();
+            this._updateLayout();
+            this._updatePosition();
+
+            this._container.style.visibility = '';
+
+            this._adjustPan();
+        },
+
         _getEvents: function() {
             var events = {
                 viewreset: this._updatePosition
             };
 
             if (this._animated) {
                 events.zoomanim = this._zoomAnimation;
@@ -3993,37 +4126,22 @@
             }
 
             var wrapper = this._wrapper =
                 L.DomUtil.create('div', prefix + '-content-wrapper', container);
             L.DomEvent.disableClickPropagation(wrapper);
 
             this._contentNode = L.DomUtil.create('div', prefix + '-content', wrapper);
-            L.DomEvent.on(this._contentNode, 'mousewheel', L.DomEvent.stopPropagation);
-            L.DomEvent.on(this._contentNode, 'MozMousePixelScroll', L.DomEvent.stopPropagation);
+
+            L.DomEvent.disableScrollPropagation(this._contentNode);
             L.DomEvent.on(wrapper, 'contextmenu', L.DomEvent.stopPropagation);
+
             this._tipContainer = L.DomUtil.create('div', prefix + '-tip-container', container);
             this._tip = L.DomUtil.create('div', prefix + '-tip', this._tipContainer);
         },
 
-        _update: function() {
-            if (!this._map) {
-                return;
-            }
-
-            this._container.style.visibility = 'hidden';
-
-            this._updateContent();
-            this._updateLayout();
-            this._updatePosition();
-
-            this._container.style.visibility = '';
-
-            this._adjustPan();
-        },
-
         _updateContent: function() {
             if (!this._content) {
                 return;
             }
 
             if (typeof this._content === 'string') {
                 this._contentNode.innerHTML = this._content;
@@ -4106,29 +4224,31 @@
 
             if (this._animated) {
                 layerPos._add(L.DomUtil.getPosition(this._container));
             }
 
             var containerPos = map.layerPointToContainerPoint(layerPos),
                 padding = L.point(this.options.autoPanPadding),
+                paddingTL = L.point(this.options.autoPanPaddingTopLeft || padding),
+                paddingBR = L.point(this.options.autoPanPaddingBottomRight || padding),
                 size = map.getSize(),
                 dx = 0,
                 dy = 0;
 
-            if (containerPos.x + containerWidth > size.x) { // right
-                dx = containerPos.x + containerWidth - size.x + padding.x;
+            if (containerPos.x + containerWidth + paddingBR.x > size.x) { // right
+                dx = containerPos.x + containerWidth - size.x + paddingBR.x;
             }
-            if (containerPos.x - dx < 0) { // left
-                dx = containerPos.x - padding.x;
+            if (containerPos.x - dx - paddingTL.x < 0) { // left
+                dx = containerPos.x - paddingTL.x;
             }
-            if (containerPos.y + containerHeight > size.y) { // bottom
-                dy = containerPos.y + containerHeight - size.y + padding.y;
+            if (containerPos.y + containerHeight + paddingBR.y > size.y) { // bottom
+                dy = containerPos.y + containerHeight - size.y + paddingBR.y;
             }
-            if (containerPos.y - dy < 0) { // top
-                dy = containerPos.y - padding.y;
+            if (containerPos.y - dy - paddingTL.y < 0) { // top
+                dy = containerPos.y - paddingTL.y;
             }
 
             if (dx || dy) {
                 map
                     .fire('autopanstart')
                     .panBy([dx, dy]);
             }
@@ -4217,19 +4337,20 @@
                 anchor = anchor.add(options.offset);
             }
 
             options = L.extend({
                 offset: anchor
             }, options);
 
-            if (!this._popup) {
+            if (!this._popupHandlersAdded) {
                 this
                     .on('click', this.togglePopup, this)
                     .on('remove', this.closePopup, this)
                     .on('move', this._movePopup, this);
+                this._popupHandlersAdded = true;
             }
 
             if (content instanceof L.Popup) {
                 L.setOptions(content, options);
                 this._popup = content;
             } else {
                 this._popup = new L.Popup(options, this)
@@ -4246,21 +4367,26 @@
             return this;
         },
 
         unbindPopup: function() {
             if (this._popup) {
                 this._popup = null;
                 this
-                    .off('click', this.togglePopup)
-                    .off('remove', this.closePopup)
-                    .off('move', this._movePopup);
+                    .off('click', this.togglePopup, this)
+                    .off('remove', this.closePopup, this)
+                    .off('move', this._movePopup, this);
+                this._popupHandlersAdded = false;
             }
             return this;
         },
 
+        getPopup: function() {
+            return this._popup;
+        },
+
         _movePopup: function(e) {
             this._popup.setLatLng(e.latlng);
         }
     });
 
 
     /*
@@ -4395,15 +4521,17 @@
         },
 
         addLayer: function(layer) {
             if (this.hasLayer(layer)) {
                 return this;
             }
 
-            layer.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);
+            if ('on' in layer) {
+                layer.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);
+            }
 
             L.LayerGroup.prototype.addLayer.call(this, layer);
 
             if (this._popupContent && layer.bindPopup) {
                 layer.bindPopup(this._popupContent, this._popupOptions);
             }
 
@@ -4435,14 +4563,23 @@
 
         bindPopup: function(content, options) {
             this._popupContent = content;
             this._popupOptions = options;
             return this.invoke('bindPopup', content, options);
         },
 
+        openPopup: function(latlng) {
+            // open popup on the first layer
+            for (var id in this._layers) {
+                this._layers[id].openPopup(latlng);
+                break;
+            }
+            return this;
+        },
+
         setStyle: function(style) {
             return this.invoke('setStyle', style);
         },
 
         bringToFront: function() {
             return this.invoke('bringToFront');
         },
@@ -4458,19 +4595,18 @@
                 bounds.extend(layer instanceof L.Marker ? layer.getLatLng() : layer.getBounds());
             });
 
             return bounds;
         },
 
         _propagateEvent: function(e) {
-            if (!e.layer) {
-                e.layer = e.target;
-            }
-            e.target = this;
-
+            e = L.extend({
+                layer: e.target,
+                target: this
+            }, e);
             this.fire(e.type, e);
         }
     });
 
     L.featureGroup = function(layers) {
         return new L.FeatureGroup(layers);
     };
@@ -4494,14 +4630,16 @@
             })()
         },
 
         options: {
             stroke: true,
             color: '#0033ff',
             dashArray: null,
+            lineCap: null,
+            lineJoin: null,
             weight: 5,
             opacity: 0.5,
 
             fill: false,
             fillColor: null, //same as color by default
             fillOpacity: 0.2,
 
@@ -4643,14 +4781,19 @@
             this._initStyle();
         },
 
         _initPath: function() {
             this._container = this._createElement('g');
 
             this._path = this._createElement('path');
+
+            if (this.options.className) {
+                L.DomUtil.addClass(this._path, this.options.className);
+            }
+
             this._container.appendChild(this._path);
         },
 
         _initStyle: function() {
             if (this.options.stroke) {
                 this._path.setAttribute('stroke-linejoin', 'round');
                 this._path.setAttribute('stroke-linecap', 'round');
@@ -4673,14 +4816,20 @@
                 this._path.setAttribute('stroke-opacity', this.options.opacity);
                 this._path.setAttribute('stroke-width', this.options.weight);
                 if (this.options.dashArray) {
                     this._path.setAttribute('stroke-dasharray', this.options.dashArray);
                 } else {
                     this._path.removeAttribute('stroke-dasharray');
                 }
+                if (this.options.lineCap) {
+                    this._path.setAttribute('stroke-linecap', this.options.lineCap);
+                }
+                if (this.options.lineJoin) {
+                    this._path.setAttribute('stroke-linejoin', this.options.lineJoin);
+                }
             } else {
                 this._path.setAttribute('stroke', 'none');
             }
             if (this.options.fill) {
                 this._path.setAttribute('fill', this.options.fillColor || this.options.color);
                 this._path.setAttribute('fill-opacity', this.options.fillOpacity);
             } else {
@@ -4697,15 +4846,15 @@
             this._path.setAttribute('d', str);
         },
 
         // TODO remove duplication with L.Map
         _initEvents: function() {
             if (this.options.clickable) {
                 if (L.Browser.svg || !L.Browser.vml) {
-                    this._path.setAttribute('class', 'leaflet-clickable');
+                    L.DomUtil.addClass(this._path, 'leaflet-clickable');
                 }
 
                 L.DomEvent.on(this._container, 'click', this._onMouseClick, this);
 
                 var events = ['dblclick', 'mousedown', 'mouseover',
                     'mouseout', 'mousemove', 'contextmenu'
                 ];
@@ -4752,22 +4901,22 @@
     L.Map.include({
         _initPathRoot: function() {
             if (!this._pathRoot) {
                 this._pathRoot = L.Path.prototype._createElement('svg');
                 this._panes.overlayPane.appendChild(this._pathRoot);
 
                 if (this.options.zoomAnimation && L.Browser.any3d) {
-                    this._pathRoot.setAttribute('class', ' leaflet-zoom-animated');
+                    L.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-animated');
 
                     this.on({
                         'zoomanim': this._animatePathZoom,
                         'zoomend': this._endPathZoom
                     });
                 } else {
-                    this._pathRoot.setAttribute('class', ' leaflet-zoom-hide');
+                    L.DomUtil.addClass(this._pathRoot, 'leaflet-zoom-hide');
                 }
 
                 this.on('moveend', this._updateSvgViewport);
                 this._updateSvgViewport();
             }
         },
 
@@ -4928,18 +5077,22 @@
                         '<' + name + ' xmlns="urn:schemas-microsoft.com:vml" class="lvml">');
                 };
             }
         }()),
 
         _initPath: function() {
             var container = this._container = this._createElement('shape');
-            L.DomUtil.addClass(container, 'leaflet-vml-shape');
+
+            L.DomUtil.addClass(container, 'leaflet-vml-shape' +
+                (this.options.className ? ' ' + this.options.className : ''));
+
             if (this.options.clickable) {
                 L.DomUtil.addClass(container, 'leaflet-clickable');
             }
+
             container.coordsize = '1 1';
 
             this._path = this._createElement('path');
             container.appendChild(this._path);
 
             this._map._pathRoot.appendChild(container);
         },
@@ -4964,20 +5117,26 @@
                     container.appendChild(stroke);
                 }
                 stroke.weight = options.weight + 'px';
                 stroke.color = options.color;
                 stroke.opacity = options.opacity;
 
                 if (options.dashArray) {
-                    stroke.dashStyle = options.dashArray instanceof Array ?
+                    stroke.dashStyle = L.Util.isArray(options.dashArray) ?
                         options.dashArray.join(' ') :
                         options.dashArray.replace(/( *, *)/g, ' ');
                 } else {
                     stroke.dashStyle = '';
                 }
+                if (options.lineCap) {
+                    stroke.endcap = options.lineCap.replace('butt', 'flat');
+                }
+                if (options.lineJoin) {
+                    stroke.joinstyle = options.lineJoin;
+                }
 
             } else if (stroke) {
                 container.removeChild(stroke);
                 this._stroke = null;
             }
 
             if (options.fill) {
@@ -5225,15 +5384,15 @@
 
 
     /*
      * L.LineUtil contains different utility functions for line segments
      * and polylines (clipping, simplification, distances, etc.)
      */
 
-    /*jshint bitwise:false */ // allow bitwise oprations for this file
+    /*jshint bitwise:false */ // allow bitwise operations for this file
 
     L.LineUtil = {
 
         // Simplify polyline with vertex reduction and Douglas-Peucker simplification.
         // Improves rendering performance dramatically by lessening the number of points to draw.
 
         simplify: function( /*Point[]*/ points, /*Number*/ tolerance) {
@@ -5661,18 +5820,20 @@
 
     L.Polygon = L.Polyline.extend({
         options: {
             fill: true
         },
 
         initialize: function(latlngs, options) {
-            var i, len, hole;
-
             L.Polyline.prototype.initialize.call(this, latlngs, options);
+            this._initWithHoles(latlngs);
+        },
 
+        _initWithHoles: function(latlngs) {
+            var i, len, hole;
             if (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {
                 this._latlngs = this._convertLatLngs(latlngs[0]);
                 this._holes = latlngs.slice(1);
 
                 for (i = 0, len = this._holes.length; i < len; i++) {
                     hole = this._holes[i] = this._convertLatLngs(this._holes[i]);
                     if (hole[0].equals(hole[hole.length - 1])) {
@@ -5707,14 +5868,23 @@
 
                 for (j = 0, len2 = this._holes[i].length; j < len2; j++) {
                     this._holePoints[i][j] = this._map.latLngToLayerPoint(this._holes[i][j]);
                 }
             }
         },
 
+        setLatLngs: function(latlngs) {
+            if (latlngs && L.Util.isArray(latlngs[0]) && (typeof latlngs[0][0] !== 'number')) {
+                this._initWithHoles(latlngs);
+                return this.redraw();
+            } else {
+                return L.Polyline.prototype.setLatLngs.call(this, latlngs);
+            }
+        },
+
         _clipPoints: function() {
             var points = this._originalPoints,
                 newParts = [];
 
             this._parts = [points].concat(this._holePoints);
 
             if (this.options.noClip) {
@@ -5950,17 +6120,29 @@
         },
 
         _updateStyle: function() {
             L.Circle.prototype._updateStyle.call(this);
             this.setRadius(this.options.radius);
         },
 
+        setLatLng: function(latlng) {
+            L.Circle.prototype.setLatLng.call(this, latlng);
+            if (this._popup && this._popup._isOpen) {
+                this._popup.setLatLng(latlng);
+            }
+            return this;
+        },
+
         setRadius: function(radius) {
             this.options.radius = this._radius = radius;
             return this.redraw();
+        },
+
+        getRadius: function() {
+            return this._radius;
         }
     });
 
     L.circleMarker = function(latlng, options) {
         return new L.CircleMarker(latlng, options);
     };
 
@@ -6100,15 +6282,15 @@
 
             var options = this.options;
 
             if (options.filter && !options.filter(geojson)) {
                 return;
             }
 
-            var layer = L.GeoJSON.geometryToLayer(geojson, options.pointToLayer, options.coordsToLatLng);
+            var layer = L.GeoJSON.geometryToLayer(geojson, options.pointToLayer, options.coordsToLatLng, options);
             layer.feature = L.GeoJSON.asFeature(geojson);
 
             layer.defaultOptions = layer.options;
             this.resetStyle(layer);
 
             if (options.onEachFeature) {
                 options.onEachFeature(geojson, layer);
@@ -6140,71 +6322,71 @@
             if (layer.setStyle) {
                 layer.setStyle(style);
             }
         }
     });
 
     L.extend(L.GeoJSON, {
-        geometryToLayer: function(geojson, pointToLayer, coordsToLatLng) {
+        geometryToLayer: function(geojson, pointToLayer, coordsToLatLng, vectorOptions) {
             var geometry = geojson.type === 'Feature' ? geojson.geometry : geojson,
                 coords = geometry.coordinates,
                 layers = [],
-                latlng, latlngs, i, len, layer;
+                latlng, latlngs, i, len;
 
             coordsToLatLng = coordsToLatLng || this.coordsToLatLng;
 
             switch (geometry.type) {
                 case 'Point':
                     latlng = coordsToLatLng(coords);
                     return pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng);
 
                 case 'MultiPoint':
                     for (i = 0, len = coords.length; i < len; i++) {
                         latlng = coordsToLatLng(coords[i]);
-                        layer = pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng);
-                        layers.push(layer);
+                        layers.push(pointToLayer ? pointToLayer(geojson, latlng) : new L.Marker(latlng));
                     }
                     return new L.FeatureGroup(layers);
 
                 case 'LineString':
                     latlngs = this.coordsToLatLngs(coords, 0, coordsToLatLng);
-                    return new L.Polyline(latlngs);
+                    return new L.Polyline(latlngs, vectorOptions);
 
                 case 'Polygon':
+                    if (coords.length === 2 && !coords[1].length) {
+                        throw new Error('Invalid GeoJSON object.');
+                    }
                     latlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);
-                    return new L.Polygon(latlngs);
+                    return new L.Polygon(latlngs, vectorOptions);
 
                 case 'MultiLineString':
                     latlngs = this.coordsToLatLngs(coords, 1, coordsToLatLng);
-                    return new L.MultiPolyline(latlngs);
+                    return new L.MultiPolyline(latlngs, vectorOptions);
 
                 case 'MultiPolygon':
                     latlngs = this.coordsToLatLngs(coords, 2, coordsToLatLng);
-                    return new L.MultiPolygon(latlngs);
+                    return new L.MultiPolygon(latlngs, vectorOptions);
 
                 case 'GeometryCollection':
                     for (i = 0, len = geometry.geometries.length; i < len; i++) {
 
-                        layer = this.geometryToLayer({
+                        layers.push(this.geometryToLayer({
                             geometry: geometry.geometries[i],
                             type: 'Feature',
                             properties: geojson.properties
-                        }, pointToLayer, coordsToLatLng);
-
-                        layers.push(layer);
+                        }, pointToLayer, coordsToLatLng, vectorOptions));
                     }
                     return new L.FeatureGroup(layers);
 
                 default:
                     throw new Error('Invalid GeoJSON object.');
             }
         },
 
         coordsToLatLng: function(coords) { // (Array[, Boolean]) -> LatLng
-            return new L.LatLng(coords[1], coords[0]);
+            return new L.LatLng(coords[1], coords[0], coords[2]);
         },
 
         coordsToLatLngs: function(coords, levelsDeep, coordsToLatLng) { // (Array[, Number, Function]) -> Array
             var latlng, i, len,
                 latlngs = [];
 
             for (i = 0, len = coords.length; i < len; i++) {
@@ -6214,16 +6396,21 @@
 
                 latlngs.push(latlng);
             }
 
             return latlngs;
         },
 
-        latLngToCoords: function(latLng) {
-            return [latLng.lng, latLng.lat];
+        latLngToCoords: function(latlng) {
+            var coords = [latlng.lng, latlng.lat];
+
+            if (latlng.alt !== undefined) {
+                coords.push(latlng.alt);
+            }
+            return coords;
         },
 
         latLngsToCoords: function(latLngs) {
             var coords = [];
 
             for (var i = 0, len = latLngs.length; i < len; i++) {
                 coords.push(L.GeoJSON.latLngToCoords(latLngs[i]));
@@ -6292,51 +6479,70 @@
                 type: 'Polygon',
                 coordinates: coords
             });
         }
     });
 
     (function() {
-        function includeMulti(Klass, type) {
-            Klass.include({
-                toGeoJSON: function() {
-                    var coords = [];
+        function multiToGeoJSON(type) {
+            return function() {
+                var coords = [];
 
-                    this.eachLayer(function(layer) {
-                        coords.push(layer.toGeoJSON().geometry.coordinates);
-                    });
+                this.eachLayer(function(layer) {
+                    coords.push(layer.toGeoJSON().geometry.coordinates);
+                });
 
-                    return L.GeoJSON.getFeature(this, {
-                        type: type,
-                        coordinates: coords
-                    });
-                }
-            });
+                return L.GeoJSON.getFeature(this, {
+                    type: type,
+                    coordinates: coords
+                });
+            };
         }
 
-        includeMulti(L.MultiPolyline, 'MultiLineString');
-        includeMulti(L.MultiPolygon, 'MultiPolygon');
-    }());
+        L.MultiPolyline.include({
+            toGeoJSON: multiToGeoJSON('MultiLineString')
+        });
+        L.MultiPolygon.include({
+            toGeoJSON: multiToGeoJSON('MultiPolygon')
+        });
 
-    L.LayerGroup.include({
-        toGeoJSON: function() {
-            var features = [];
+        L.LayerGroup.include({
+            toGeoJSON: function() {
 
-            this.eachLayer(function(layer) {
-                if (layer.toGeoJSON) {
-                    features.push(L.GeoJSON.asFeature(layer.toGeoJSON()));
+                var geometry = this.feature && this.feature.geometry,
+                    jsons = [],
+                    json;
+
+                if (geometry && geometry.type === 'MultiPoint') {
+                    return multiToGeoJSON('MultiPoint').call(this);
                 }
-            });
 
-            return {
-                type: 'FeatureCollection',
-                features: features
-            };
-        }
-    });
+                var isGeometryCollection = geometry && geometry.type === 'GeometryCollection';
+
+                this.eachLayer(function(layer) {
+                    if (layer.toGeoJSON) {
+                        json = layer.toGeoJSON();
+                        jsons.push(isGeometryCollection ? json.geometry : L.GeoJSON.asFeature(json));
+                    }
+                });
+
+                if (isGeometryCollection) {
+                    return L.GeoJSON.getFeature(this, {
+                        geometries: jsons,
+                        type: 'GeometryCollection'
+                    });
+                }
+
+                return {
+                    type: 'FeatureCollection',
+                    features: jsons
+                };
+            }
+        });
+    }());
 
     L.geoJson = function(geojson, options) {
         return new L.GeoJSON(geojson, options);
     };
 
 
     /*
@@ -6355,16 +6561,16 @@
                 return this;
             }
 
             handler = function(e) {
                 return fn.call(context || obj, e || L.DomEvent._getEvent());
             };
 
-            if (L.Browser.msTouch && type.indexOf('touch') === 0) {
-                return this.addMsTouchListener(obj, type, handler, id);
+            if (L.Browser.pointer && type.indexOf('touch') === 0) {
+                return this.addPointerListener(obj, type, handler, id);
             }
             if (L.Browser.touch && (type === 'dblclick') && this.addDoubleTapListener) {
                 this.addDoubleTapListener(obj, handler, id);
             }
 
             if ('addEventListener' in obj) {
 
@@ -6412,16 +6618,16 @@
                 key = '_leaflet_' + type + id,
                 handler = obj[key];
 
             if (!handler) {
                 return this;
             }
 
-            if (L.Browser.msTouch && type.indexOf('touch') === 0) {
-                this.removeMsTouchListener(obj, type, id);
+            if (L.Browser.pointer && type.indexOf('touch') === 0) {
+                this.removePointerListener(obj, type, id);
             } else if (L.Browser.touch && (type === 'dblclick') && this.removeDoubleTapListener) {
                 this.removeDoubleTapListener(obj, id);
 
             } else if ('removeEventListener' in obj) {
 
                 if (type === 'mousewheel') {
                     obj.removeEventListener('DOMMouseScroll', handler, false);
@@ -6444,68 +6650,75 @@
         stopPropagation: function(e) {
 
             if (e.stopPropagation) {
                 e.stopPropagation();
             } else {
                 e.cancelBubble = true;
             }
+            L.DomEvent._skipped(e);
+
             return this;
         },
 
+        disableScrollPropagation: function(el) {
+            var stop = L.DomEvent.stopPropagation;
+
+            return L.DomEvent
+                .on(el, 'mousewheel', stop)
+                .on(el, 'MozMousePixelScroll', stop);
+        },
+
         disableClickPropagation: function(el) {
             var stop = L.DomEvent.stopPropagation;
 
             for (var i = L.Draggable.START.length - 1; i >= 0; i--) {
-                L.DomEvent.addListener(el, L.Draggable.START[i], stop);
+                L.DomEvent.on(el, L.Draggable.START[i], stop);
             }
 
             return L.DomEvent
-                .addListener(el, 'click', L.DomEvent._fakeStop)
-                .addListener(el, 'dblclick', stop);
+                .on(el, 'click', L.DomEvent._fakeStop)
+                .on(el, 'dblclick', stop);
         },
 
         preventDefault: function(e) {
 
             if (e.preventDefault) {
                 e.preventDefault();
             } else {
                 e.returnValue = false;
             }
             return this;
         },
 
         stop: function(e) {
-            return L.DomEvent.preventDefault(e).stopPropagation(e);
+            return L.DomEvent
+                .preventDefault(e)
+                .stopPropagation(e);
         },
 
         getMousePosition: function(e, container) {
-
-            var ie7 = L.Browser.ie7,
-                body = document.body,
+            var body = document.body,
                 docEl = document.documentElement,
-                x = e.pageX ? e.pageX - body.scrollLeft - docEl.scrollLeft : e.clientX,
+                //gecko makes scrollLeft more negative as you scroll in rtl, other browsers don't
+                //ref: https://code.google.com/p/closure-library/source/browse/closure/goog/style/bidi.js
+                x = L.DomUtil.documentIsLtr() ?
+                (e.pageX ? e.pageX - body.scrollLeft - docEl.scrollLeft : e.clientX) :
+                (L.Browser.gecko ? e.pageX - body.scrollLeft - docEl.scrollLeft :
+                    e.pageX ? e.pageX - body.scrollLeft + docEl.scrollLeft : e.clientX),
                 y = e.pageY ? e.pageY - body.scrollTop - docEl.scrollTop : e.clientY,
-                pos = new L.Point(x, y),
-                rect = container.getBoundingClientRect(),
-                left = rect.left - container.clientLeft,
-                top = rect.top - container.clientTop;
+                pos = new L.Point(x, y);
 
-            // webkit (and ie <= 7) handles RTL scrollLeft different to everyone else
-            // https://code.google.com/p/closure-library/source/browse/trunk/closure/goog/style/bidi.js
-            if (!L.DomUtil.documentIsLtr() && (L.Browser.webkit || ie7)) {
-                left += container.scrollWidth - container.clientWidth;
-
-                // ie7 shows the scrollbar by default and provides clientWidth counting it, so we
-                // need to add it back in if it is visible; scrollbar is on the left as we are RTL
-                if (ie7 && L.DomUtil.getStyle(container, 'overflow-y') !== 'hidden' &&
-                    L.DomUtil.getStyle(container, 'overflow') !== 'hidden') {
-                    left += 17;
-                }
+            if (!container) {
+                return pos;
             }
 
+            var rect = container.getBoundingClientRect(),
+                left = rect.left - container.clientLeft,
+                top = rect.top - container.clientTop;
+
             return pos._subtract(new L.Point(left, top));
         },
 
         getWheelDelta: function(e) {
 
             var delta = 0;
 
@@ -6599,19 +6812,21 @@
         includes: L.Mixin.Events,
 
         statics: {
             START: L.Browser.touch ? ['touchstart', 'mousedown'] : ['mousedown'],
             END: {
                 mousedown: 'mouseup',
                 touchstart: 'touchend',
+                pointerdown: 'touchend',
                 MSPointerDown: 'touchend'
             },
             MOVE: {
                 mousedown: 'mousemove',
                 touchstart: 'touchmove',
+                pointerdown: 'touchmove',
                 MSPointerDown: 'touchmove'
             }
         },
 
         initialize: function(element, dragStartTarget) {
             this._element = element;
             this._dragStartTarget = dragStartTarget || element;
@@ -6639,52 +6854,46 @@
             }
 
             this._enabled = false;
             this._moved = false;
         },
 
         _onDown: function(e) {
+            this._moved = false;
+
             if (e.shiftKey || ((e.which !== 1) && (e.button !== 1) && !e.touches)) {
                 return;
             }
 
-            L.DomEvent
-                .stopPropagation(e);
+            L.DomEvent.stopPropagation(e);
 
             if (L.Draggable._disabled) {
                 return;
             }
 
             L.DomUtil.disableImageDrag();
             L.DomUtil.disableTextSelection();
 
-            var first = e.touches ? e.touches[0] : e,
-                el = first.target;
-
-            // if touching a link, highlight it
-            if (L.Browser.touch && el.tagName.toLowerCase() === 'a') {
-                L.DomUtil.addClass(el, 'leaflet-active');
-            }
-
-            this._moved = false;
-
             if (this._moving) {
                 return;
             }
 
+            var first = e.touches ? e.touches[0] : e;
+
             this._startPoint = new L.Point(first.clientX, first.clientY);
             this._startPos = this._newPos = L.DomUtil.getPosition(this._element);
 
             L.DomEvent
                 .on(document, L.Draggable.MOVE[e.type], this._onMove, this)
                 .on(document, L.Draggable.END[e.type], this._onUp, this);
         },
 
         _onMove: function(e) {
             if (e.touches && e.touches.length > 1) {
+                this._moved = true;
                 return;
             }
 
             var first = (e.touches && e.touches.length === 1 ? e.touches[0] : e),
                 newPoint = new L.Point(first.clientX, first.clientY),
                 offset = newPoint.subtract(this._startPoint);
 
@@ -6696,17 +6905,16 @@
 
             if (!this._moved) {
                 this.fire('dragstart');
 
                 this._moved = true;
                 this._startPos = L.DomUtil.getPosition(this._element).subtract(offset);
 
-                if (!L.Browser.touch) {
-                    L.DomUtil.addClass(document.body, 'leaflet-dragging');
-                }
+                L.DomUtil.addClass(document.body, 'leaflet-dragging');
+                L.DomUtil.addClass((e.target || e.srcElement), 'leaflet-drag-target');
             }
 
             this._newPos = this._startPos.add(offset);
             this._moving = true;
 
             L.Util.cancelAnimFrame(this._animRequest);
             this._animRequest = L.Util.requestAnimFrame(this._updatePosition, this, true, this._dragStartTarget);
@@ -6714,33 +6922,34 @@
 
         _updatePosition: function() {
             this.fire('predrag');
             L.DomUtil.setPosition(this._element, this._newPos);
             this.fire('drag');
         },
 
-        _onUp: function() {
-            if (!L.Browser.touch) {
-                L.DomUtil.removeClass(document.body, 'leaflet-dragging');
-            }
+        _onUp: function(e) {
+            L.DomUtil.removeClass(document.body, 'leaflet-dragging');
+            L.DomUtil.removeClass((e.target || e.srcElement), 'leaflet-drag-target');
 
             for (var i in L.Draggable.MOVE) {
                 L.DomEvent
                     .off(document, L.Draggable.MOVE[i], this._onMove)
                     .off(document, L.Draggable.END[i], this._onUp);
             }
 
             L.DomUtil.enableImageDrag();
             L.DomUtil.enableTextSelection();
 
-            if (this._moved) {
+            if (this._moved && this._moving) {
                 // ensure drag is not fired after dragend
                 L.Util.cancelAnimFrame(this._animRequest);
 
-                this.fire('dragend');
+                this.fire('dragend', {
+                    distance: this._newPos.distanceTo(this._startPos)
+                });
             }
 
             this._moving = false;
         }
     });
 
 
@@ -6808,15 +7017,15 @@
                     'dragend': this._onDragEnd
                 }, this);
 
                 if (map.options.worldCopyJump) {
                     this._draggable.on('predrag', this._onPreDrag, this);
                     map.on('viewreset', this._onViewReset, this);
 
-                    this._onViewReset();
+                    map.whenReady(this._onViewReset, this);
                 }
             }
             this._draggable.enable();
         },
 
         removeHooks: function() {
             this._draggable.disable();
@@ -6880,22 +7089,22 @@
                 newX1 = (x - halfWidth + dx) % worldWidth + halfWidth - dx,
                 newX2 = (x + halfWidth + dx) % worldWidth - halfWidth - dx,
                 newX = Math.abs(newX1 + dx) < Math.abs(newX2 + dx) ? newX1 : newX2;
 
             this._draggable._newPos.x = newX;
         },
 
-        _onDragEnd: function() {
+        _onDragEnd: function(e) {
             var map = this._map,
                 options = map.options,
                 delay = +new Date() - this._lastTime,
 
                 noInertia = !options.inertia || delay > options.inertiaThreshold || !this._positions[0];
 
-            map.fire('dragend');
+            map.fire('dragend', e);
 
             if (noInertia) {
                 map.fire('moveend');
 
             } else {
 
                 var direction = this._lastPos.subtract(this._positions[0]),
@@ -6911,14 +7120,16 @@
                     decelerationDuration = limitedSpeed / (options.inertiaDeceleration * ease),
                     offset = limitedSpeedVector.multiplyBy(-decelerationDuration / 2).round();
 
                 if (!offset.x || !offset.y) {
                     map.fire('moveend');
 
                 } else {
+                    offset = map._limitOffset(offset, map.options.maxBounds);
+
                     L.Util.requestAnimFrame(function() {
                         map.panBy(offset, {
                             duration: decelerationDuration,
                             easeLinearity: ease,
                             noMoveStart: true
                         });
                     });
@@ -6936,23 +7147,30 @@
 
     L.Map.mergeOptions({
         doubleClickZoom: true
     });
 
     L.Map.DoubleClickZoom = L.Handler.extend({
         addHooks: function() {
-            this._map.on('dblclick', this._onDoubleClick);
+            this._map.on('dblclick', this._onDoubleClick, this);
         },
 
         removeHooks: function() {
-            this._map.off('dblclick', this._onDoubleClick);
+            this._map.off('dblclick', this._onDoubleClick, this);
         },
 
         _onDoubleClick: function(e) {
-            this.setZoomAround(e.containerPoint, this._zoom + 1);
+            var map = this._map,
+                zoom = map.getZoom() + (e.originalEvent.shiftKey ? -1 : 1);
+
+            if (map.options.doubleClickZoom === 'center') {
+                map.setZoom(zoom);
+            } else {
+                map.setZoomAround(e.containerPoint, zoom);
+            }
         }
     });
 
     L.Map.addInitHook('addHandler', 'doubleClickZoom', L.Map.DoubleClickZoom);
 
 
     /*
@@ -7006,29 +7224,33 @@
             this._delta = 0;
             this._startTime = null;
 
             if (!delta) {
                 return;
             }
 
-            map.setZoomAround(this._lastMousePos, zoom + delta);
+            if (map.options.scrollWheelZoom === 'center') {
+                map.setZoom(zoom + delta);
+            } else {
+                map.setZoomAround(this._lastMousePos, zoom + delta);
+            }
         }
     });
 
     L.Map.addInitHook('addHandler', 'scrollWheelZoom', L.Map.ScrollWheelZoom);
 
 
     /*
      * Extends the event handling code with double tap support for mobile browsers.
      */
 
     L.extend(L.DomEvent, {
 
-        _touchstart: L.Browser.msTouch ? 'MSPointerDown' : 'touchstart',
-        _touchend: L.Browser.msTouch ? 'MSPointerUp' : 'touchend',
+        _touchstart: L.Browser.msPointer ? 'MSPointerDown' : L.Browser.pointer ? 'pointerdown' : 'touchstart',
+        _touchend: L.Browser.msPointer ? 'MSPointerUp' : L.Browser.pointer ? 'pointerup' : 'touchend',
 
         // inspired by Zepto touch code by Thomas Fuchs
         addDoubleTapListener: function(obj, handler, id) {
             var last,
                 doubleTap = false,
                 delay = 250,
                 touch,
@@ -7036,15 +7258,15 @@
                 touchstart = this._touchstart,
                 touchend = this._touchend,
                 trackedTouches = [];
 
             function onTouchStart(e) {
                 var count;
 
-                if (L.Browser.msTouch) {
+                if (L.Browser.pointer) {
                     trackedTouches.push(e.pointerId);
                     count = trackedTouches.length;
                 } else {
                     count = e.touches.length;
                 }
                 if (count > 1) {
                     return;
@@ -7055,24 +7277,24 @@
 
                 touch = e.touches ? e.touches[0] : e;
                 doubleTap = (delta > 0 && delta <= delay);
                 last = now;
             }
 
             function onTouchEnd(e) {
-                if (L.Browser.msTouch) {
+                if (L.Browser.pointer) {
                     var idx = trackedTouches.indexOf(e.pointerId);
                     if (idx === -1) {
                         return;
                     }
                     trackedTouches.splice(idx, 1);
                 }
 
                 if (doubleTap) {
-                    if (L.Browser.msTouch) {
+                    if (L.Browser.pointer) {
                         // work around .type being readonly with MSPointer* events
                         var newTouch = {},
                             prop;
 
                         // jshint forin:false
                         for (var i in touch) {
                             prop = touch[i];
@@ -7088,125 +7310,135 @@
                     handler(touch);
                     last = null;
                 }
             }
             obj[pre + touchstart + id] = onTouchStart;
             obj[pre + touchend + id] = onTouchEnd;
 
-            // on msTouch we need to listen on the document, otherwise a drag starting on the map and moving off screen
+            // on pointer we need to listen on the document, otherwise a drag starting on the map and moving off screen
             // will not come through to us, so we will lose track of how many touches are ongoing
-            var endElement = L.Browser.msTouch ? document.documentElement : obj;
+            var endElement = L.Browser.pointer ? document.documentElement : obj;
 
             obj.addEventListener(touchstart, onTouchStart, false);
             endElement.addEventListener(touchend, onTouchEnd, false);
 
-            if (L.Browser.msTouch) {
-                endElement.addEventListener('MSPointerCancel', onTouchEnd, false);
+            if (L.Browser.pointer) {
+                endElement.addEventListener(L.DomEvent.POINTER_CANCEL, onTouchEnd, false);
             }
 
             return this;
         },
 
         removeDoubleTapListener: function(obj, id) {
             var pre = '_leaflet_';
 
             obj.removeEventListener(this._touchstart, obj[pre + this._touchstart + id], false);
-            (L.Browser.msTouch ? document.documentElement : obj).removeEventListener(
+            (L.Browser.pointer ? document.documentElement : obj).removeEventListener(
                 this._touchend, obj[pre + this._touchend + id], false);
 
-            if (L.Browser.msTouch) {
-                document.documentElement.removeEventListener('MSPointerCancel', obj[pre + this._touchend + id], false);
+            if (L.Browser.pointer) {
+                document.documentElement.removeEventListener(L.DomEvent.POINTER_CANCEL, obj[pre + this._touchend + id],
+                    false);
             }
 
             return this;
         }
     });
 
 
     /*
      * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.
      */
 
     L.extend(L.DomEvent, {
 
-        _msTouches: [],
-        _msDocumentListener: false,
+        //static
+        POINTER_DOWN: L.Browser.msPointer ? 'MSPointerDown' : 'pointerdown',
+        POINTER_MOVE: L.Browser.msPointer ? 'MSPointerMove' : 'pointermove',
+        POINTER_UP: L.Browser.msPointer ? 'MSPointerUp' : 'pointerup',
+        POINTER_CANCEL: L.Browser.msPointer ? 'MSPointerCancel' : 'pointercancel',
+
+        _pointers: [],
+        _pointerDocumentListener: false,
 
-        // Provides a touch events wrapper for msPointer events.
+        // Provides a touch events wrapper for (ms)pointer events.
         // Based on changes by veproza https://github.com/CloudMade/Leaflet/pull/1019
+        //ref http://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890
 
-        addMsTouchListener: function(obj, type, handler, id) {
+        addPointerListener: function(obj, type, handler, id) {
 
             switch (type) {
                 case 'touchstart':
-                    return this.addMsTouchListenerStart(obj, type, handler, id);
+                    return this.addPointerListenerStart(obj, type, handler, id);
                 case 'touchend':
-                    return this.addMsTouchListenerEnd(obj, type, handler, id);
+                    return this.addPointerListenerEnd(obj, type, handler, id);
                 case 'touchmove':
-                    return this.addMsTouchListenerMove(obj, type, handler, id);
+                    return this.addPointerListenerMove(obj, type, handler, id);
                 default:
                     throw 'Unknown touch event type';
             }
         },
 
-        addMsTouchListenerStart: function(obj, type, handler, id) {
+        addPointerListenerStart: function(obj, type, handler, id) {
             var pre = '_leaflet_',
-                touches = this._msTouches;
+                pointers = this._pointers;
 
             var cb = function(e) {
 
+                L.DomEvent.preventDefault(e);
+
                 var alreadyInArray = false;
-                for (var i = 0; i < touches.length; i++) {
-                    if (touches[i].pointerId === e.pointerId) {
+                for (var i = 0; i < pointers.length; i++) {
+                    if (pointers[i].pointerId === e.pointerId) {
                         alreadyInArray = true;
                         break;
                     }
                 }
                 if (!alreadyInArray) {
-                    touches.push(e);
+                    pointers.push(e);
                 }
 
-                e.touches = touches.slice();
+                e.touches = pointers.slice();
                 e.changedTouches = [e];
 
                 handler(e);
             };
 
             obj[pre + 'touchstart' + id] = cb;
-            obj.addEventListener('MSPointerDown', cb, false);
+            obj.addEventListener(this.POINTER_DOWN, cb, false);
 
-            // need to also listen for end events to keep the _msTouches list accurate
+            // need to also listen for end events to keep the _pointers list accurate
             // this needs to be on the body and never go away
-            if (!this._msDocumentListener) {
+            if (!this._pointerDocumentListener) {
                 var internalCb = function(e) {
-                    for (var i = 0; i < touches.length; i++) {
-                        if (touches[i].pointerId === e.pointerId) {
-                            touches.splice(i, 1);
+                    for (var i = 0; i < pointers.length; i++) {
+                        if (pointers[i].pointerId === e.pointerId) {
+                            pointers.splice(i, 1);
                             break;
                         }
                     }
                 };
                 //We listen on the documentElement as any drags that end by moving the touch off the screen get fired there
-                document.documentElement.addEventListener('MSPointerUp', internalCb, false);
-                document.documentElement.addEventListener('MSPointerCancel', internalCb, false);
+                document.documentElement.addEventListener(this.POINTER_UP, internalCb, false);
+                document.documentElement.addEventListener(this.POINTER_CANCEL, internalCb, false);
 
-                this._msDocumentListener = true;
+                this._pointerDocumentListener = true;
             }
 
             return this;
         },
 
-        addMsTouchListenerMove: function(obj, type, handler, id) {
+        addPointerListenerMove: function(obj, type, handler, id) {
             var pre = '_leaflet_',
-                touches = this._msTouches;
+                touches = this._pointers;
 
             function cb(e) {
 
                 // don't fire touch moves when mouse isn't down
-                if (e.pointerType === e.MSPOINTER_TYPE_MOUSE && e.buttons === 0) {
+                if ((e.pointerType === e.MSPOINTER_TYPE_MOUSE || e.pointerType === 'mouse') && e.buttons === 0) {
                     return;
                 }
 
                 for (var i = 0; i < touches.length; i++) {
                     if (touches[i].pointerId === e.pointerId) {
                         touches[i] = e;
                         break;
@@ -7216,22 +7448,22 @@
                 e.touches = touches.slice();
                 e.changedTouches = [e];
 
                 handler(e);
             }
 
             obj[pre + 'touchmove' + id] = cb;
-            obj.addEventListener('MSPointerMove', cb, false);
+            obj.addEventListener(this.POINTER_MOVE, cb, false);
 
             return this;
         },
 
-        addMsTouchListenerEnd: function(obj, type, handler, id) {
+        addPointerListenerEnd: function(obj, type, handler, id) {
             var pre = '_leaflet_',
-                touches = this._msTouches;
+                touches = this._pointers;
 
             var cb = function(e) {
                 for (var i = 0; i < touches.length; i++) {
                     if (touches[i].pointerId === e.pointerId) {
                         touches.splice(i, 1);
                         break;
                     }
@@ -7240,48 +7472,49 @@
                 e.touches = touches.slice();
                 e.changedTouches = [e];
 
                 handler(e);
             };
 
             obj[pre + 'touchend' + id] = cb;
-            obj.addEventListener('MSPointerUp', cb, false);
-            obj.addEventListener('MSPointerCancel', cb, false);
+            obj.addEventListener(this.POINTER_UP, cb, false);
+            obj.addEventListener(this.POINTER_CANCEL, cb, false);
 
             return this;
         },
 
-        removeMsTouchListener: function(obj, type, id) {
+        removePointerListener: function(obj, type, id) {
             var pre = '_leaflet_',
                 cb = obj[pre + type + id];
 
             switch (type) {
                 case 'touchstart':
-                    obj.removeEventListener('MSPointerDown', cb, false);
+                    obj.removeEventListener(this.POINTER_DOWN, cb, false);
                     break;
                 case 'touchmove':
-                    obj.removeEventListener('MSPointerMove', cb, false);
+                    obj.removeEventListener(this.POINTER_MOVE, cb, false);
                     break;
                 case 'touchend':
-                    obj.removeEventListener('MSPointerUp', cb, false);
-                    obj.removeEventListener('MSPointerCancel', cb, false);
+                    obj.removeEventListener(this.POINTER_UP, cb, false);
+                    obj.removeEventListener(this.POINTER_CANCEL, cb, false);
                     break;
             }
 
             return this;
         }
     });
 
 
     /*
      * L.Handler.TouchZoom is used by L.Map to add pinch zoom on supported mobile browsers.
      */
 
     L.Map.mergeOptions({
-        touchZoom: L.Browser.touch && !L.Browser.android23
+        touchZoom: L.Browser.touch && !L.Browser.android23,
+        bounceAtZoomLimits: true
     });
 
     L.Map.TouchZoom = L.Handler.extend({
         addHooks: function() {
             L.DomEvent.on(this._map._container, 'touchstart', this._onTouchStart, this);
         },
 
@@ -7332,14 +7565,21 @@
             this._scale = p1.distanceTo(p2) / this._startDist;
             this._delta = p1._add(p2)._divideBy(2)._subtract(this._startCenter);
 
             if (this._scale === 1) {
                 return;
             }
 
+            if (!map.options.bounceAtZoomLimits) {
+                if ((map.getZoom() === map.getMinZoom() && this._scale < 1) ||
+                    (map.getZoom() === map.getMaxZoom() && this._scale > 1)) {
+                    return;
+                }
+            }
+
             if (!this._moved) {
                 L.DomUtil.addClass(map._mapPane, 'leaflet-touching');
 
                 map
                     .fire('movestart')
                     .fire('zoomstart');
 
@@ -7437,15 +7677,15 @@
 
             var first = e.touches[0],
                 el = first.target;
 
             this._startPos = this._newPos = new L.Point(first.clientX, first.clientY);
 
             // if touching a link, highlight it
-            if (el.tagName.toLowerCase() === 'a') {
+            if (el.tagName && el.tagName.toLowerCase() === 'a') {
                 L.DomUtil.addClass(el, 'leaflet-active');
             }
 
             // simulate long hold but setting a timeout
             this._holdTimeout = setTimeout(L.bind(function() {
                 if (this._isTapValid()) {
                     this._fireClick = false;
@@ -7467,15 +7707,15 @@
                 .off(document, 'touchend', this._onUp, this);
 
             if (this._fireClick && e && e.changedTouches) {
 
                 var first = e.changedTouches[0],
                     el = first.target;
 
-                if (el.tagName.toLowerCase() === 'a') {
+                if (el && el.tagName && el.tagName.toLowerCase() === 'a') {
                     L.DomUtil.removeClass(el, 'leaflet-active');
                 }
 
                 // simulate click if the touch didn't move too much
                 if (this._isTapValid()) {
                     this._simulateEvent('click', first);
                 }
@@ -7503,15 +7743,15 @@
                 e.clientX, e.clientY,
                 false, false, false, false, 0, null);
 
             e.target.dispatchEvent(simulatedEvent);
         }
     });
 
-    if (L.Browser.touch && !L.Browser.msTouch) {
+    if (L.Browser.touch && !L.Browser.pointer) {
         L.Map.addInitHook('addHandler', 'tap', L.Map.Tap);
     }
 
 
     /*
      * L.Handler.ShiftDragZoom is used to add shift-drag zoom interaction to the map
      * (zoom to a selected bounding box), enabled by default.
@@ -7522,69 +7762,82 @@
     });
 
     L.Map.BoxZoom = L.Handler.extend({
         initialize: function(map) {
             this._map = map;
             this._container = map._container;
             this._pane = map._panes.overlayPane;
+            this._moved = false;
         },
 
         addHooks: function() {
             L.DomEvent.on(this._container, 'mousedown', this._onMouseDown, this);
         },
 
         removeHooks: function() {
             L.DomEvent.off(this._container, 'mousedown', this._onMouseDown);
+            this._moved = false;
+        },
+
+        moved: function() {
+            return this._moved;
         },
 
         _onMouseDown: function(e) {
+            this._moved = false;
+
             if (!e.shiftKey || ((e.which !== 1) && (e.button !== 1))) {
                 return false;
             }
 
             L.DomUtil.disableTextSelection();
             L.DomUtil.disableImageDrag();
 
             this._startLayerPoint = this._map.mouseEventToLayerPoint(e);
 
-            this._box = L.DomUtil.create('div', 'leaflet-zoom-box', this._pane);
-            L.DomUtil.setPosition(this._box, this._startLayerPoint);
-
-            //TODO refactor: move cursor to styles
-            this._container.style.cursor = 'crosshair';
-
             L.DomEvent
                 .on(document, 'mousemove', this._onMouseMove, this)
                 .on(document, 'mouseup', this._onMouseUp, this)
                 .on(document, 'keydown', this._onKeyDown, this);
-
-            this._map.fire('boxzoomstart');
         },
 
         _onMouseMove: function(e) {
+            if (!this._moved) {
+                this._box = L.DomUtil.create('div', 'leaflet-zoom-box', this._pane);
+                L.DomUtil.setPosition(this._box, this._startLayerPoint);
+
+                //TODO refactor: move cursor to styles
+                this._container.style.cursor = 'crosshair';
+                this._map.fire('boxzoomstart');
+            }
+
             var startPoint = this._startLayerPoint,
                 box = this._box,
 
                 layerPoint = this._map.mouseEventToLayerPoint(e),
                 offset = layerPoint.subtract(startPoint),
 
                 newPos = new L.Point(
                     Math.min(layerPoint.x, startPoint.x),
                     Math.min(layerPoint.y, startPoint.y));
 
             L.DomUtil.setPosition(box, newPos);
 
+            this._moved = true;
+
             // TODO refactor: remove hardcoded 4 pixels
             box.style.width = (Math.max(0, Math.abs(offset.x) - 4)) + 'px';
             box.style.height = (Math.max(0, Math.abs(offset.y) - 4)) + 'px';
         },
 
         _finish: function() {
-            this._pane.removeChild(this._box);
-            this._container.style.cursor = '';
+            if (this._moved) {
+                this._pane.removeChild(this._box);
+                this._container.style.cursor = '';
+            }
 
             L.DomUtil.enableTextSelection();
             L.DomUtil.enableImageDrag();
 
             L.DomEvent
                 .off(document, 'mousemove', this._onMouseMove)
                 .off(document, 'mouseup', this._onMouseUp)
@@ -7636,15 +7889,15 @@
     L.Map.Keyboard = L.Handler.extend({
 
         keyCodes: {
             left: [37],
             right: [39],
             down: [40],
             up: [38],
-            zoomIn: [187, 107, 61],
+            zoomIn: [187, 107, 61, 171],
             zoomOut: [189, 109, 173]
         },
 
         initialize: function(map) {
             this._map = map;
 
             this._setPanOffset(map.options.keyboardPanOffset);
@@ -7795,23 +8048,25 @@
             }
 
             this._draggable
                 .on('dragstart', this._onDragStart, this)
                 .on('drag', this._onDrag, this)
                 .on('dragend', this._onDragEnd, this);
             this._draggable.enable();
+            L.DomUtil.addClass(this._marker._icon, 'leaflet-marker-draggable');
         },
 
         removeHooks: function() {
             this._draggable
                 .off('dragstart', this._onDragStart, this)
                 .off('drag', this._onDrag, this)
                 .off('dragend', this._onDragEnd, this);
 
             this._draggable.disable();
+            L.DomUtil.removeClass(this._marker._icon, 'leaflet-marker-draggable');
         },
 
         moved: function() {
             return this._draggable && this._draggable._moved;
         },
 
         _onDragStart: function() {
@@ -7837,18 +8092,18 @@
             marker
                 .fire('move', {
                     latlng: latlng
                 })
                 .fire('drag');
         },
 
-        _onDragEnd: function() {
+        _onDragEnd: function(e) {
             this._marker
                 .fire('moveend')
-                .fire('dragend');
+                .fire('dragend', e);
         }
     });
 
 
     /*
      * L.Control is a base class for implementing map controls. Handles positioning.
      * All other controls extend from this class.
@@ -7913,14 +8168,20 @@
             this._map = null;
 
             if (this.onRemove) {
                 this.onRemove(map);
             }
 
             return this;
+        },
+
+        _refocusOnMap: function() {
+            if (this._map) {
+                this._map.getContainer().focus();
+            }
         }
     });
 
     L.control = function(options) {
         return new L.Control(options);
     };
 
@@ -7964,28 +8225,35 @@
 
     /*
      * L.Control.Zoom is used for the default zoom buttons on the map.
      */
 
     L.Control.Zoom = L.Control.extend({
         options: {
-            position: 'topleft'
+            position: 'topleft',
+            zoomInText: '+',
+            zoomInTitle: 'Zoom in',
+            zoomOutText: '-',
+            zoomOutTitle: 'Zoom out'
         },
 
         onAdd: function(map) {
             var zoomName = 'leaflet-control-zoom',
                 container = L.DomUtil.create('div', zoomName + ' leaflet-bar');
 
             this._map = map;
 
             this._zoomInButton = this._createButton(
-                '+', 'Zoom in', zoomName + '-in', container, this._zoomIn, this);
+                this.options.zoomInText, this.options.zoomInTitle,
+                zoomName + '-in', container, this._zoomIn, this);
             this._zoomOutButton = this._createButton(
-                '-', 'Zoom out', zoomName + '-out', container, this._zoomOut, this);
+                this.options.zoomOutText, this.options.zoomOutTitle,
+                zoomName + '-out', container, this._zoomOut, this);
 
+            this._updateDisabled();
             map.on('zoomend zoomlevelschange', this._updateDisabled, this);
 
             return container;
         },
 
         onRemove: function(map) {
             map.off('zoomend zoomlevelschange', this._updateDisabled, this);
@@ -8008,15 +8276,16 @@
             var stop = L.DomEvent.stopPropagation;
 
             L.DomEvent
                 .on(link, 'click', stop)
                 .on(link, 'mousedown', stop)
                 .on(link, 'dblclick', stop)
                 .on(link, 'click', L.DomEvent.preventDefault)
-                .on(link, 'click', fn, context);
+                .on(link, 'click', fn, context)
+                .on(link, 'click', this._refocusOnMap, context);
 
             return link;
         },
 
         _updateDisabled: function() {
             var map = this._map,
                 className = 'leaflet-disabled';
@@ -8066,14 +8335,20 @@
             this._attributions = {};
         },
 
         onAdd: function(map) {
             this._container = L.DomUtil.create('div', 'leaflet-control-attribution');
             L.DomEvent.disableClickPropagation(this._container);
 
+            for (var i in map._layers) {
+                if (map._layers[i].getAttribution) {
+                    this.addAttribution(map._layers[i].getAttribution());
+                }
+            }
+
             map
                 .on('layeradd', this._onLayerAdd, this)
                 .on('layerremove', this._onLayerRemove, this);
 
             this._update();
 
             return this._container;
@@ -8354,16 +8629,17 @@
             var className = 'leaflet-control-layers',
                 container = this._container = L.DomUtil.create('div', className);
 
             //Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released
             container.setAttribute('aria-haspopup', true);
 
             if (!L.Browser.touch) {
-                L.DomEvent.disableClickPropagation(container);
-                L.DomEvent.on(container, 'mousewheel', L.DomEvent.stopPropagation);
+                L.DomEvent
+                    .disableClickPropagation(container)
+                    .disableScrollPropagation(container);
             } else {
                 L.DomEvent.on(container, 'click', L.DomEvent.stopPropagation);
             }
 
             var form = this._form = L.DomUtil.create('form', className + '-list');
 
             if (this.options.collapsed) {
@@ -8379,14 +8655,18 @@
                 if (L.Browser.touch) {
                     L.DomEvent
                         .on(link, 'click', L.DomEvent.stop)
                         .on(link, 'click', this._expand, this);
                 } else {
                     L.DomEvent.on(link, 'focus', this._expand, this);
                 }
+                //Work around for Firefox android issue https://github.com/Leaflet/Leaflet/issues/2033
+                L.DomEvent.on(form, 'click', function() {
+                    setTimeout(L.bind(this._onInputClick, this), 0);
+                }, this);
 
                 this._map.on('click', this._collapse, this);
                 // TODO keyboard accessibility
             } else {
                 this._expand();
             }
 
@@ -8515,14 +8795,16 @@
 
                 } else if (!input.checked && this._map.hasLayer(obj.layer)) {
                     this._map.removeLayer(obj.layer);
                 }
             }
 
             this._handlingClick = false;
+
+            this._refocusOnMap();
         },
 
         _expand: function() {
             L.DomUtil.addClass(this._container, 'leaflet-control-layers-expanded');
         },
 
         _collapse: function() {
@@ -8641,16 +8923,16 @@
      * Extends L.Map to handle panning animations.
      */
 
     L.Map.include({
 
         setView: function(center, zoom, options) {
 
-            zoom = this._limitZoom(zoom);
-            center = L.latLng(center);
+            zoom = zoom === undefined ? this._zoom : this._limitZoom(zoom);
+            center = this._limitCenter(L.latLng(center), zoom, this.options.maxBounds);
             options = options || {};
 
             if (this._panAnim) {
                 this._panAnim.stop();
             }
 
             if (this._loaded && !options.reset && options !== true) {
@@ -8836,16 +9118,16 @@
                 L.DomEvent.on(this._mapPane, L.DomUtil.TRANSITION_END, this._catchTransitionEnd, this);
             }
         });
     }
 
     L.Map.include(!L.DomUtil.TRANSITION ? {} : {
 
-        _catchTransitionEnd: function() {
-            if (this._animatingZoom) {
+        _catchTransitionEnd: function(e) {
+            if (this._animatingZoom && e.propertyName.indexOf('transform') >= 0) {
                 this._onZoomTransitionEnd();
             }
         },
 
         _nothingToAnimate: function() {
             return !this._container.getElementsByClassName('leaflet-zoom-animated').length;
         },
@@ -9112,15 +9394,16 @@
             if (options.setView) {
                 var zoom = Math.min(this.getBoundsZoom(bounds), options.maxZoom);
                 this.setView(latlng, zoom);
             }
 
             var data = {
                 latlng: latlng,
-                bounds: bounds
+                bounds: bounds,
+                timestamp: pos.timestamp
             };
 
             for (var i in pos.coords) {
                 if (typeof pos.coords[i] === 'number') {
                     data[i] = pos.coords[i];
                 }
             }
```

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/eventlistener.ie8.js` & `django-leaflet-0.9.0/leaflet/static/leaflet/eventlistener.ie8.js`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/eventlistener.ie6-7.js` & `django-leaflet-0.9.0/leaflet/static/leaflet/eventlistener.ie6-7.js`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/Control.MiniMap.js` & `django-leaflet-0.9.0/leaflet/static/leaflet/Control.MiniMap.js`

 * *Files 14% similar despite different names*

### js-beautify {}

```diff
@@ -3,24 +3,39 @@
         position: 'bottomright',
         toggleDisplay: false,
         zoomLevelOffset: -5,
         zoomLevelFixed: false,
         zoomAnimation: false,
         autoToggleDisplay: false,
         width: 150,
-        height: 150
+        height: 150,
+        aimingRectOptions: {
+            color: "#ff7800",
+            weight: 1,
+            clickable: false
+        },
+        shadowRectOptions: {
+            color: "#000000",
+            weight: 1,
+            clickable: false,
+            opacity: 0,
+            fillOpacity: 0
+        }
     },
 
     hideText: 'Hide MiniMap',
 
     showText: 'Show MiniMap',
 
     //layer is the map layer to be shown in the minimap
     initialize: function(layer, options) {
         L.Util.setOptions(this, options);
+        //Make sure the aiming rects are non-clickable even if the user tries to set them clickable (most likely by forgetting to specify them false)
+        this.options.aimingRectOptions.clickable = false;
+        this.options.shadowRectOptions.clickable = false;
         this._layer = layer;
     },
 
     onAdd: function(map) {
 
         this._mainMap = map;
 
@@ -55,26 +70,16 @@
         this._minimized = false;
 
         if (this.options.toggleDisplay) {
             this._addToggleButton();
         }
 
         this._miniMap.whenReady(L.Util.bind(function() {
-            this._aimingRect = L.rectangle(this._mainMap.getBounds(), {
-                color: "#ff7800",
-                weight: 1,
-                clickable: false
-            }).addTo(this._miniMap);
-            this._shadowRect = L.rectangle(this._mainMap.getBounds(), {
-                color: "#000000",
-                weight: 1,
-                clickable: false,
-                opacity: 0,
-                fillOpacity: 0
-            }).addTo(this._miniMap);
+            this._aimingRect = L.rectangle(this._mainMap.getBounds(), this.options.aimingRectOptions).addTo(this._miniMap);
+            this._shadowRect = L.rectangle(this._mainMap.getBounds(), this.options.shadowRectOptions).addTo(this._miniMap);
             this._mainMap.on('moveend', this._onMainMapMoved, this);
             this._mainMap.on('move', this._onMainMapMoving, this);
             this._miniMap.on('movestart', this._onMiniMapMoveStarted, this);
             this._miniMap.on('move', this._onMiniMapMoving, this);
             this._miniMap.on('moveend', this._onMiniMapMoved, this);
         }, this));
 
@@ -212,16 +217,38 @@
         }
     },
 
     _decideZoom: function(fromMaintoMini) {
         if (!this.options.zoomLevelFixed) {
             if (fromMaintoMini)
                 return this._mainMap.getZoom() + this.options.zoomLevelOffset;
-            else
-                return this._miniMap.getZoom() - this.options.zoomLevelOffset;
+            else {
+                var currentDiff = this._miniMap.getZoom() - this._mainMap.getZoom();
+                var proposedZoom = this._miniMap.getZoom() - this.options.zoomLevelOffset;
+                var toRet;
+
+                if (currentDiff > this.options.zoomLevelOffset && this._mainMap.getZoom() < this._miniMap.getMinZoom() - this.options.zoomLevelOffset) {
+                    //This means the miniMap is zoomed out to the minimum zoom level and can't zoom any more.
+                    if (this._miniMap.getZoom() > this._lastMiniMapZoom) {
+                        //This means the user is trying to zoom in by using the minimap, zoom the main map.
+                        toRet = this._mainMap.getZoom() + 1;
+                        //Also we cheat and zoom the minimap out again to keep it visually consistent.
+                        this._miniMap.setZoom(this._miniMap.getZoom() - 1);
+                    } else {
+                        //Either the user is trying to zoom out past the mini map's min zoom or has just panned using it, we can't tell the difference.
+                        //Therefore, we ignore it!
+                        toRet = this._mainMap.getZoom();
+                    }
+                } else {
+                    //This is what happens in the majority of cases, and always if you configure the min levels + offset in a sane fashion.
+                    toRet = proposedZoom;
+                }
+                this._lastMiniMapZoom = this._miniMap.getZoom();
+                return toRet;
+            }
         } else {
             if (fromMaintoMini)
                 return this.options.zoomLevelFixed;
             else
                 return this._mainMap.getZoom();
         }
     },
```

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/images/zoom-out.png` & `django-leaflet-0.9.0/leaflet/static/leaflet/images/zoom-out.png`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/images/zoom-in.png` & `django-leaflet-0.9.0/leaflet/static/leaflet/images/zoom-in.png`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-shadow.png` & `django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-shadow.png`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-icon@2x.png` & `django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-icon@2x.png`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-icon.png` & `django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-icon.png`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/images/marker-icon-2x.png` & `django-leaflet-0.9.0/leaflet/static/leaflet/images/marker-icon-2x.png`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/images/layers.png` & `django-leaflet-0.9.0/leaflet/static/leaflet/images/layers.png`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/images/layers-2x.png` & `django-leaflet-0.9.0/leaflet/static/leaflet/images/layers-2x.png`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw.js` & `django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw.js`

 * *Files 3% similar despite different names*

### js-beautify {}

```diff
@@ -3,15 +3,15 @@
 	(c) 2012-2013, Jacob Toye, Smartrak
 
 	https://github.com/Leaflet/Leaflet.draw
 	http://leafletjs.com
 	https://github.com/jacobtoye
 */
 (function(t, e) {
-    L.drawVersion = "0.2.1-dev", L.drawLocal = {
+    L.drawVersion = "0.2.2", L.drawLocal = {
         draw: {
             toolbar: {
                 actions: {
                     title: "Cancel drawing",
                     text: "Cancel"
                 },
                 buttons: {
@@ -69,16 +69,18 @@
                     },
                     cancel: {
                         title: "Cancel editing, discards all changes.",
                         text: "Cancel"
                     }
                 },
                 buttons: {
-                    edit: "Edit layers",
-                    remove: "Delete layers"
+                    edit: "Edit layers.",
+                    editDisabled: "No layers to edit.",
+                    remove: "Delete layers.",
+                    removeDisabled: "No layers to delete."
                 }
             },
             handlers: {
                 edit: {
                     tooltip: {
                         text: "Drag handles, or marker to edit feature.",
                         subtext: "Click cancel to undo changes."
@@ -134,15 +136,14 @@
         },
         Poly: L.Polyline,
         options: {
             allowIntersection: !0,
             repeatMode: !1,
             drawError: {
                 color: "#b00b00",
-                message: L.drawLocal.draw.handlers.polyline.error,
                 timeout: 2500
             },
             icon: new L.DivIcon({
                 iconSize: new L.Point(8, 8),
                 className: "leaflet-div-icon leaflet-editing-icon"
             }),
             guidelineDistance: 20,
@@ -151,18 +152,19 @@
                 color: "#f06eaa",
                 weight: 4,
                 opacity: .5,
                 fill: !1,
                 clickable: !0
             },
             metric: !0,
+            showLength: !0,
             zIndexOffset: 2e3
         },
         initialize: function(t, e) {
-            e && e.drawError && (e.drawError = L.Util.extend({}, this.options.drawError, e.drawError)), this.type = L.Draw.Polyline.TYPE, L.Draw.Feature.prototype.initialize.call(this, t, e)
+            this.options.drawError.message = L.drawLocal.draw.handlers.polyline.error, e && e.drawError && (e.drawError = L.Util.extend({}, this.options.drawError, e.drawError)), this.type = L.Draw.Polyline.TYPE, L.Draw.Feature.prototype.initialize.call(this, t, e)
         },
         addHooks: function() {
             L.Draw.Feature.prototype.addHooks.call(this), this._map && (this._markers = [], this._markerGroup = new L.LayerGroup, this._map.addLayer(this._markerGroup), this._poly = new L.Polyline([], this.options.shapeOptions), this._tooltip.updateContent(this._getTooltipText()), this._mouseMarker || (this._mouseMarker = L.marker(this._map.getCenter(), {
                 icon: L.divIcon({
                     className: "leaflet-mouse-marker",
                     iconAnchor: [20, 20],
                     iconSize: [40, 40]
@@ -202,17 +204,16 @@
             var e = new L.Marker(t, {
                 icon: this.options.icon,
                 zIndexOffset: 2 * this.options.zIndexOffset
             });
             return this._markerGroup.addLayer(e), e
         },
         _updateGuide: function(t) {
-            t = t || this._map.latLngToLayerPoint(this._currentLatLng);
             var e = this._markers.length;
-            e > 0 && (this._clearGuides(), this._drawGuide(this._map.latLngToLayerPoint(this._markers[e - 1].getLatLng()), t))
+            e > 0 && (t = t || this._map.latLngToLayerPoint(this._currentLatLng), this._clearGuides(), this._drawGuide(this._map.latLngToLayerPoint(this._markers[e - 1].getLatLng()), t))
         },
         _updateTooltip: function(t) {
             var e = this._getTooltipText();
             t && this._tooltip.updatePosition(t), this._errorShown || this._tooltip.updateContent(e)
         },
         _drawGuide: function(t, e) {
             var i, o, a, s, r = Math.floor(Math.sqrt(Math.pow(e.x - t.x, 2) + Math.pow(e.y - t.y, 2)));
@@ -226,29 +227,29 @@
                 for (var e = 0, i = this._guidesContainer.childNodes.length; i > e; e++) this._guidesContainer.childNodes[e].style.backgroundColor = t
         },
         _clearGuides: function() {
             if (this._guidesContainer)
                 for (; this._guidesContainer.firstChild;) this._guidesContainer.removeChild(this._guidesContainer.firstChild)
         },
         _getTooltipText: function() {
-            var t, e;
+            var t, e, i = this.options.showLength;
             return 0 === this._markers.length ? t = {
                 text: L.drawLocal.draw.handlers.polyline.tooltip.start
-            } : (e = this._getMeasurementString(), t = 1 === this._markers.length ? {
+            } : (e = i ? this._getMeasurementString() : "", t = 1 === this._markers.length ? {
                 text: L.drawLocal.draw.handlers.polyline.tooltip.cont,
                 subtext: e
             } : {
                 text: L.drawLocal.draw.handlers.polyline.tooltip.end,
                 subtext: e
             }), t
         },
         _getMeasurementString: function() {
-            var t, e, i = this._currentLatLng,
-                o = this._markers[this._markers.length - 1].getLatLng();
-            return t = this._measurementRunningTotal + i.distanceTo(o), this.options.metric ? e = t > 1e3 ? (t / 1e3).toFixed(2) + " km" : Math.ceil(t) + " m" : (t *= 1.09361, e = t > 1760 ? (t / 1760).toFixed(2) + " miles" : Math.ceil(t) + " yd"), e
+            var t, e = this._currentLatLng,
+                i = this._markers[this._markers.length - 1].getLatLng();
+            return t = this._measurementRunningTotal + e.distanceTo(i), L.GeometryUtil.readableDistance(t, this.options.metric)
         },
         _showErrorTooltip: function() {
             this._errorShown = !0, this._tooltip.showAsError().updateContent({
                 text: this.options.drawError.message
             }), this._updateGuideColor(this.options.drawError.color), this._poly.setStyle({
                 color: this.options.drawError.color
             }), this._clearHideErrorTimeout(), this._hideErrorTimeout = setTimeout(L.Util.bind(this._hideErrorTooltip, this), this.options.drawError.timeout)
@@ -300,36 +301,36 @@
             var t, e;
             return 0 === this._markers.length ? t = L.drawLocal.draw.handlers.polygon.tooltip.start : 3 > this._markers.length ? t = L.drawLocal.draw.handlers.polygon.tooltip.cont : (t = L.drawLocal.draw.handlers.polygon.tooltip.end, e = this._getMeasurementString()), {
                 text: t,
                 subtext: e
             }
         },
         _getMeasurementString: function() {
-            var t, e = this._area;
-            return e ? (this.options.metric ? t = e >= 1e4 ? (1e-4 * e).toFixed(2) + " ha" : e.toFixed(2) + " m&sup2;" : (e *= .836127, t = e >= 3097600 ? (e / 3097600).toFixed(2) + " mi&sup2;" : e >= 4840 ? (e / 4840).toFixed(2) + " acres" : Math.ceil(e) + " yd&sup2;"), t) : null
+            var t = this._area;
+            return t ? L.GeometryUtil.readableArea(t, this.options.metric) : null
         },
         _shapeIsValid: function() {
             return this._markers.length >= 3
         },
         _vertexAdded: function() {
             if (!this.options.allowIntersection && this.options.showArea) {
                 var t = this._poly.getLatLngs();
-                this._area = L.PolygonUtil.geodesicArea(t)
+                this._area = L.GeometryUtil.geodesicArea(t)
             }
         },
         _cleanUpShape: function() {
             var t = this._markers.length;
             t > 0 && (this._markers[0].off("click", this._finishShape, this), t > 2 && this._markers[t - 1].off("dblclick", this._finishShape, this))
         }
     }), L.SimpleShape = {}, L.Draw.SimpleShape = L.Draw.Feature.extend({
         options: {
-            repeatMode: !0
+            repeatMode: !1
         },
         initialize: function(t, e) {
-            L.Draw.Feature.prototype.initialize.call(this, t, e)
+            this._endLabelText = L.drawLocal.draw.handlers.simpleshape.tooltip.end, L.Draw.Feature.prototype.initialize.call(this, t, e)
         },
         addHooks: function() {
             L.Draw.Feature.prototype.addHooks.call(this), this._map && (this._map.dragging.disable(), this._container.style.cursor = "crosshair", this._tooltip.updateContent({
                 text: this._initialLabelText
             }), this._map.on("mousedown", this._onMouseDown, this).on("mousemove", this._onMouseMove, this))
         },
         removeHooks: function() {
@@ -337,15 +338,15 @@
         },
         _onMouseDown: function(t) {
             this._isDrawing = !0, this._startLatLng = t.latlng, L.DomEvent.on(e, "mouseup", this._onMouseUp, this).preventDefault(t.originalEvent)
         },
         _onMouseMove: function(t) {
             var e = t.latlng;
             this._tooltip.updatePosition(e), this._isDrawing && (this._tooltip.updateContent({
-                text: L.drawLocal.draw.handlers.simpleshape.tooltip.end
+                text: this._endLabelText
             }), this._drawShape(e))
         },
         _onMouseUp: function() {
             this._shape && this._fireCreatedEvent(), this.disable(), this.options.repeatMode && this.enable()
         }
     }), L.Draw.Rectangle = L.Draw.SimpleShape.extend({
         statics: {
@@ -360,17 +361,16 @@
                 fill: !0,
                 fillColor: null,
                 fillOpacity: .2,
                 clickable: !0
             }
         },
         initialize: function(t, e) {
-            this.type = L.Draw.Rectangle.TYPE, L.Draw.SimpleShape.prototype.initialize.call(this, t, e)
+            this.type = L.Draw.Rectangle.TYPE, this._initialLabelText = L.drawLocal.draw.handlers.rectangle.tooltip.start, L.Draw.SimpleShape.prototype.initialize.call(this, t, e)
         },
-        _initialLabelText: L.drawLocal.draw.handlers.rectangle.tooltip.start,
         _drawShape: function(t) {
             this._shape ? this._shape.setBounds(new L.LatLngBounds(this._startLatLng, t)) : (this._shape = new L.Rectangle(new L.LatLngBounds(this._startLatLng, t), this.options.shapeOptions), this._map.addLayer(this._shape))
         },
         _fireCreatedEvent: function() {
             var t = new L.Rectangle(this._shape.getBounds(), this.options.shapeOptions);
             L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, t)
         }
@@ -384,32 +384,35 @@
                 color: "#f06eaa",
                 weight: 4,
                 opacity: .5,
                 fill: !0,
                 fillColor: null,
                 fillOpacity: .2,
                 clickable: !0
-            }
+            },
+            showRadius: !0,
+            metric: !0
         },
         initialize: function(t, e) {
-            this.type = L.Draw.Circle.TYPE, L.Draw.SimpleShape.prototype.initialize.call(this, t, e)
+            this.type = L.Draw.Circle.TYPE, this._initialLabelText = L.drawLocal.draw.handlers.circle.tooltip.start, L.Draw.SimpleShape.prototype.initialize.call(this, t, e)
         },
-        _initialLabelText: L.drawLocal.draw.handlers.circle.tooltip.start,
         _drawShape: function(t) {
             this._shape ? this._shape.setRadius(this._startLatLng.distanceTo(t)) : (this._shape = new L.Circle(this._startLatLng, this._startLatLng.distanceTo(t), this.options.shapeOptions), this._map.addLayer(this._shape))
         },
         _fireCreatedEvent: function() {
             var t = new L.Circle(this._startLatLng, this._shape.getRadius(), this.options.shapeOptions);
             L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, t)
         },
         _onMouseMove: function(t) {
-            var e, i = t.latlng;
+            var e, i = t.latlng,
+                o = (this.options.metric, this.options.showRadius),
+                a = this.options.metric;
             this._tooltip.updatePosition(i), this._isDrawing && (this._drawShape(i), e = this._shape.getRadius().toFixed(1), this._tooltip.updateContent({
-                text: "Release mouse to finish drawing.",
-                subtext: "Radius: " + e + " m"
+                text: this._endLabelText,
+                subtext: o ? "Radius: " + L.GeometryUtil.readableDistance(e, a) : ""
             }))
         }
     }), L.Draw.Marker = L.Draw.Feature.extend({
         statics: {
             TYPE: "marker"
         },
         options: {
@@ -591,15 +594,15 @@
         _onMarkerDrag: function(t) {
             var e = t.target,
                 i = e.getLatLng();
             e === this._moveMarker ? this._move(i) : this._resize(i), this._shape.redraw()
         },
         _onMarkerDragEnd: function(t) {
             var e = t.target;
-            e.setOpacity(1), this._shape.fire("edit"), this._fireEdit()
+            e.setOpacity(1), this._fireEdit()
         },
         _move: function() {},
         _resize: function() {}
     }), L.Edit = L.Edit || {}, L.Edit.Rectangle = L.Edit.SimpleShape.extend({
         _createMoveMarker: function() {
             var t = this._shape.getBounds(),
                 e = t.getCenter();
@@ -679,24 +682,32 @@
         cloneLatLngs: function(t) {
             for (var e = [], i = 0, o = t.length; o > i; i++) e.push(this.cloneLatLng(t[i]));
             return e
         },
         cloneLatLng: function(t) {
             return L.latLng(t.lat, t.lng)
         }
-    }, L.PolygonUtil = {
+    }, L.GeometryUtil = {
         geodesicArea: function(t) {
             var e, i, o = t.length,
                 a = 0,
                 s = L.LatLng.DEG_TO_RAD;
             if (o > 2) {
                 for (var r = 0; o > r; r++) e = t[r], i = t[(r + 1) % o], a += (i.lng - e.lng) * s * (2 + Math.sin(e.lat * s) + Math.sin(i.lat * s));
                 a = 6378137 * 6378137 * a / 2
             }
             return Math.abs(a)
+        },
+        readableArea: function(t, e) {
+            var i;
+            return e ? i = t >= 1e4 ? (1e-4 * t).toFixed(2) + " ha" : t.toFixed(2) + " m&sup2;" : (t *= .836127, i = t >= 3097600 ? (t / 3097600).toFixed(2) + " mi&sup2;" : t >= 4840 ? (t / 4840).toFixed(2) + " acres" : Math.ceil(t) + " yd&sup2;"), i
+        },
+        readableDistance: function(t, e) {
+            var i;
+            return e ? i = t > 1e3 ? (t / 1e3).toFixed(2) + " km" : Math.ceil(t) + " m" : (t *= 1.09361, i = t > 1760 ? (t / 1760).toFixed(2) + " miles" : Math.ceil(t) + " yd"), i
         }
     }, L.Util.extend(L.LineUtil, {
         segmentsIntersect: function(t, e, i, o) {
             return this._checkCounterclockwise(t, i, o) !== this._checkCounterclockwise(e, i, o) && this._checkCounterclockwise(t, e, i) !== this._checkCounterclockwise(t, e, o)
         },
         _checkCounterclockwise: function(t, e, i) {
             return (i.y - t.y) * (e.x - t.x) > (e.y - t.y) * (i.x - t.x)
@@ -763,14 +774,15 @@
             for (var e in this._toolbars) this._toolbars[e] instanceof L.DrawToolbar && this._toolbars[e].setOptions(t)
         },
         _toolbarEnabled: function(t) {
             var e = "" + L.stamp(t.target);
             for (var i in this._toolbars) this._toolbars.hasOwnProperty(i) && i !== e && this._toolbars[i].disable()
         }
     }), L.Map.mergeOptions({
+        drawControlTooltips: !0,
         drawControl: !1
     }), L.Map.addInitHook(function() {
         this.options.drawControl && (this.drawControl = new L.Control.Draw, this.addControl(this.drawControl))
     }), L.Toolbar = L.Class.extend({
         includes: [L.Mixin.Events],
         initialize: function(t) {
             L.setOptions(this, t), this._modes = {}, this._actionButtons = [], this._activeMode = null
@@ -807,56 +819,56 @@
         _handlerActivated: function(t) {
             this._activeMode && this._activeMode.handler.enabled() && this._activeMode.handler.disable(), this._activeMode = this._modes[t.handler], L.DomUtil.addClass(this._activeMode.button, "leaflet-draw-toolbar-button-enabled"), this._showActionsToolbar(), this.fire("enable")
         },
         _handlerDeactivated: function() {
             this._hideActionsToolbar(), L.DomUtil.removeClass(this._activeMode.button, "leaflet-draw-toolbar-button-enabled"), this._activeMode = null, this.fire("disable")
         },
         _createActions: function(t) {
-            for (var e, i, o = L.DomUtil.create("ul", "leaflet-draw-actions"), a = 50, s = t.length, r = s * a + (s - 1), n = 0; s > n; n++) e = L.DomUtil.create("li", "", o), i = this._createButton({
-                title: t[n].title,
-                text: t[n].text,
+            for (var e, i, o = L.DomUtil.create("ul", "leaflet-draw-actions"), a = t.length, s = 0; a > s; s++) e = L.DomUtil.create("li", "", o), i = this._createButton({
+                title: t[s].title,
+                text: t[s].text,
                 container: e,
-                callback: t[n].callback,
-                context: t[n].context
+                callback: t[s].callback,
+                context: t[s].context
             }), this._actionButtons.push({
                 button: i,
-                callback: t[n].callback
+                callback: t[s].callback
             });
-            return o.style.width = r + "px", o
+            return o
         },
         _showActionsToolbar: function() {
             var t = this._activeMode.buttonIndex,
                 e = this._lastButtonIndex,
                 i = 26,
                 o = 1,
                 a = t * i + t * o - 1;
             this._actionsContainer.style.top = a + "px", 0 === t && (L.DomUtil.addClass(this._toolbarContainer, "leaflet-draw-toolbar-notop"), L.DomUtil.addClass(this._actionsContainer, "leaflet-draw-actions-top")), t === e && (L.DomUtil.addClass(this._toolbarContainer, "leaflet-draw-toolbar-nobottom"), L.DomUtil.addClass(this._actionsContainer, "leaflet-draw-actions-bottom")), this._actionsContainer.style.display = "block"
         },
         _hideActionsToolbar: function() {
             this._actionsContainer.style.display = "none", L.DomUtil.removeClass(this._toolbarContainer, "leaflet-draw-toolbar-notop"), L.DomUtil.removeClass(this._toolbarContainer, "leaflet-draw-toolbar-nobottom"), L.DomUtil.removeClass(this._actionsContainer, "leaflet-draw-actions-top"), L.DomUtil.removeClass(this._actionsContainer, "leaflet-draw-actions-bottom")
         }
     }), L.Tooltip = L.Class.extend({
         initialize: function(t) {
-            this._map = t, this._popupPane = t._panes.popupPane, this._container = L.DomUtil.create("div", "leaflet-draw-tooltip", this._popupPane), this._singleLineLabel = !1
+            this._map = t, this._popupPane = t._panes.popupPane, this._container = t.options.drawControlTooltips ? L.DomUtil.create("div", "leaflet-draw-tooltip", this._popupPane) : null, this._singleLineLabel = !1
         },
         dispose: function() {
-            this._popupPane.removeChild(this._container), this._container = null
+            this._container && (this._popupPane.removeChild(this._container), this._container = null)
         },
         updateContent: function(t) {
-            return t.subtext = t.subtext || "", 0 !== t.subtext.length || this._singleLineLabel ? t.subtext.length > 0 && this._singleLineLabel && (L.DomUtil.removeClass(this._container, "leaflet-draw-tooltip-single"), this._singleLineLabel = !1) : (L.DomUtil.addClass(this._container, "leaflet-draw-tooltip-single"), this._singleLineLabel = !0), this._container.innerHTML = (t.subtext.length > 0 ? '<span class="leaflet-draw-tooltip-subtext">' + t.subtext + "</span>" + "<br />" : "") + "<span>" + t.text + "</span>", this
+            return this._container ? (t.subtext = t.subtext || "", 0 !== t.subtext.length || this._singleLineLabel ? t.subtext.length > 0 && this._singleLineLabel && (L.DomUtil.removeClass(this._container, "leaflet-draw-tooltip-single"), this._singleLineLabel = !1) : (L.DomUtil.addClass(this._container, "leaflet-draw-tooltip-single"), this._singleLineLabel = !0), this._container.innerHTML = (t.subtext.length > 0 ? '<span class="leaflet-draw-tooltip-subtext">' + t.subtext + "</span>" + "<br />" : "") + "<span>" + t.text + "</span>", this) : this
         },
         updatePosition: function(t) {
             var e = this._map.latLngToLayerPoint(t);
-            return L.DomUtil.setPosition(this._container, e), this
+            return this._container && L.DomUtil.setPosition(this._container, e), this
         },
         showAsError: function() {
-            return L.DomUtil.addClass(this._container, "leaflet-error-draw-tooltip"), this
+            return this._container && L.DomUtil.addClass(this._container, "leaflet-error-draw-tooltip"), this
         },
         removeError: function() {
-            return L.DomUtil.removeClass(this._container, "leaflet-error-draw-tooltip"), this
+            return this._container && L.DomUtil.removeClass(this._container, "leaflet-error-draw-tooltip"), this
         }
     }), L.DrawToolbar = L.Toolbar.extend({
         options: {
             polyline: {},
             polygon: {},
             rectangle: {},
             circle: {},
@@ -898,49 +910,62 @@
         },
         initialize: function(t) {
             t.edit && (t.edit.selectedPathOptions === undefined && (t.edit.selectedPathOptions = this.options.edit.selectedPathOptions), t.edit = L.extend({}, this.options.edit, t.edit)), t.remove && (t.remove = L.extend({}, this.options.remove, t.remove)), L.Toolbar.prototype.initialize.call(this, t), this._selectedFeatureCount = 0
         },
         addToolbar: function(t) {
             var e = L.DomUtil.create("div", "leaflet-draw-section"),
                 i = 0,
-                o = "leaflet-draw-edit";
+                o = "leaflet-draw-edit",
+                a = this.options.featureGroup;
             return this._toolbarContainer = L.DomUtil.create("div", "leaflet-draw-toolbar leaflet-bar"), this._map = t, this.options.edit && this._initModeHandler(new L.EditToolbar.Edit(t, {
-                featureGroup: this.options.featureGroup,
+                featureGroup: a,
                 selectedPathOptions: this.options.edit.selectedPathOptions
             }), this._toolbarContainer, i++, o, L.drawLocal.edit.toolbar.buttons.edit), this.options.remove && this._initModeHandler(new L.EditToolbar.Delete(t, {
-                featureGroup: this.options.featureGroup
+                featureGroup: a
             }), this._toolbarContainer, i++, o, L.drawLocal.edit.toolbar.buttons.remove), this._lastButtonIndex = --i, this._actionsContainer = this._createActions([{
                 title: L.drawLocal.edit.toolbar.actions.save.title,
                 text: L.drawLocal.edit.toolbar.actions.save.text,
                 callback: this._save,
                 context: this
             }, {
                 title: L.drawLocal.edit.toolbar.actions.cancel.title,
                 text: L.drawLocal.edit.toolbar.actions.cancel.text,
                 callback: this.disable,
                 context: this
-            }]), e.appendChild(this._toolbarContainer), e.appendChild(this._actionsContainer), e
+            }]), e.appendChild(this._toolbarContainer), e.appendChild(this._actionsContainer), this._checkDisabled(), a.on("layeradd layerremove", this._checkDisabled, this), e
+        },
+        removeToolbar: function() {
+            L.Toolbar.prototype.removeToolbar.call(this), this.options.featureGroup.off("layeradd layerremove", this._checkDisabled, this)
         },
         disable: function() {
             this.enabled() && (this._activeMode.handler.revertLayers(), L.Toolbar.prototype.disable.call(this))
         },
         _save: function() {
             this._activeMode.handler.save(), this._activeMode.handler.disable()
+        },
+        _checkDisabled: function() {
+            var t, e = this.options.featureGroup,
+                i = 0 === e.getLayers().length;
+            this.options.edit && (t = this._modes[L.EditToolbar.Edit.TYPE].button, L.DomUtil.toggleClass(t, "leaflet-disabled"), t.setAttribute("title", i ? L.drawLocal.edit.toolbar.buttons.edit : L.drawLocal.edit.toolbar.buttons.editDisabled)), this.options.remove && (t = this._modes[L.EditToolbar.Delete.TYPE].button, L.DomUtil.toggleClass(t, "leaflet-disabled"), t.setAttribute("title", i ? L.drawLocal.edit.toolbar.buttons.remove : L.drawLocal.edit.toolbar.buttons.removeDisabled))
+        }
+    }), L.DomUtil.toggleClass || L.Util.extend(L.DomUtil, {
+        toggleClass: function(t, e) {
+            this.hasClass(t, e) ? this.removeClass(t, e) : this.addClass(t, e)
         }
     }), L.EditToolbar.Edit = L.Handler.extend({
         statics: {
             TYPE: "edit"
         },
         includes: L.Mixin.Events,
         initialize: function(t, e) {
             if (L.Handler.prototype.initialize.call(this, t), this._selectedPathOptions = e.selectedPathOptions, this._featureGroup = e.featureGroup, !(this._featureGroup instanceof L.FeatureGroup)) throw Error("options.featureGroup must be a L.FeatureGroup");
             this._uneditedLayerProps = {}, this.type = L.EditToolbar.Edit.TYPE
         },
         enable: function() {
-            this._enabled || (L.Handler.prototype.enable.call(this), this._featureGroup.on("layeradd", this._enableLayerEdit, this).on("layerremove", this._disableLayerEdit, this), this.fire("enabled", {
+            !this._enabled && this._hasAvailableLayers() && (L.Handler.prototype.enable.call(this), this._featureGroup.on("layeradd", this._enableLayerEdit, this).on("layerremove", this._disableLayerEdit, this), this.fire("enabled", {
                 handler: this.type
             }), this._map.fire("draw:editstart", {
                 handler: this.type
             }))
         },
         disable: function() {
             this._enabled && (this.fire("disabled", {
@@ -983,16 +1008,18 @@
             })
         },
         _revertLayer: function(t) {
             var e = L.Util.stamp(t);
             t.edited = !1, this._uneditedLayerProps.hasOwnProperty(e) && (t instanceof L.Polyline || t instanceof L.Polygon || t instanceof L.Rectangle ? t.setLatLngs(this._uneditedLayerProps[e].latlngs) : t instanceof L.Circle ? (t.setLatLng(this._uneditedLayerProps[e].latlng), t.setRadius(this._uneditedLayerProps[e].radius)) : t.setLatLng(this._uneditedLayerProps[e].latlng))
         },
         _toggleMarkerHighlight: function(t) {
-            var e = t._icon;
-            e.style.display = "none", L.DomUtil.hasClass(e, "leaflet-edit-marker-selected") ? (L.DomUtil.removeClass(e, "leaflet-edit-marker-selected"), this._offsetMarker(e, -4)) : (L.DomUtil.addClass(e, "leaflet-edit-marker-selected"), this._offsetMarker(e, 4)), e.style.display = ""
+            if (t._icon) {
+                var e = t._icon;
+                e.style.display = "none", L.DomUtil.hasClass(e, "leaflet-edit-marker-selected") ? (L.DomUtil.removeClass(e, "leaflet-edit-marker-selected"), this._offsetMarker(e, -4)) : (L.DomUtil.addClass(e, "leaflet-edit-marker-selected"), this._offsetMarker(e, 4)), e.style.display = ""
+            }
         },
         _offsetMarker: function(t, e) {
             var i = parseInt(t.style.marginTop, 10) - e,
                 o = parseInt(t.style.marginLeft, 10) - e;
             t.style.marginTop = i + "px", t.style.marginLeft = o + "px"
         },
         _enableLayerEdit: function(t) {
@@ -1006,26 +1033,29 @@
         },
         _onMarkerDragEnd: function(t) {
             var e = t.target;
             e.edited = !0
         },
         _onMouseMove: function(t) {
             this._tooltip.updatePosition(t.latlng)
+        },
+        _hasAvailableLayers: function() {
+            return 0 !== this._featureGroup.getLayers().length
         }
     }), L.EditToolbar.Delete = L.Handler.extend({
         statics: {
             TYPE: "remove"
         },
         includes: L.Mixin.Events,
         initialize: function(t, e) {
             if (L.Handler.prototype.initialize.call(this, t), L.Util.setOptions(this, e), this._deletableLayers = this.options.featureGroup, !(this._deletableLayers instanceof L.FeatureGroup)) throw Error("options.featureGroup must be a L.FeatureGroup");
             this.type = L.EditToolbar.Delete.TYPE
         },
         enable: function() {
-            this._enabled || (L.Handler.prototype.enable.call(this), this._deletableLayers.on("layeradd", this._enableLayerDelete, this).on("layerremove", this._disableLayerDelete, this), this.fire("enabled", {
+            !this._enabled && this._hasAvailableLayers() && (L.Handler.prototype.enable.call(this), this._deletableLayers.on("layeradd", this._enableLayerDelete, this).on("layerremove", this._disableLayerDelete, this), this.fire("enabled", {
                 handler: this.type
             }), this._map.fire("draw:editstart", {
                 handler: this.type
             }))
         },
         disable: function() {
             this._enabled && (L.Handler.prototype.disable.call(this), this._deletableLayers.off("layeradd", this._enableLayerDelete, this).off("layerremove", this._disableLayerDelete, this), this.fire("disabled", {
@@ -1062,10 +1092,13 @@
         },
         _removeLayer: function(t) {
             var e = t.layer || t.target || t;
             this._deletableLayers.removeLayer(e), this._deletedLayers.addLayer(e)
         },
         _onMouseMove: function(t) {
             this._tooltip.updatePosition(t.latlng)
+        },
+        _hasAvailableLayers: function() {
+            return 0 !== this._deletableLayers.getLayers().length
         }
     })
 })(this, document);
```

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw.ie.css` & `django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw.ie.css`

 * *Files 6% similar despite different names*

```diff
@@ -13,14 +13,19 @@
 }
 
 .leaflet-draw-actions {
 	left: 32px;
 	margin-top: 3px;
 }
 
+.leaflet-draw-actions li {
+	display: inline;
+	zoom: 1;
+}
+
 .leaflet-edit-marker-selected {
 	border: 4px dashed #fe93c2;
 }
 
 .leaflet-draw-actions a {
 	background-color: #999;
 }
```

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw.css` & `django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw.css`

 * *Files 13% similar despite different names*

```diff
@@ -23,14 +23,19 @@
 }
 
 .leaflet-draw-toolbar a {
 	background-image: url('images/spritesheet.png');
 	background-repeat: no-repeat;
 }
 
+.leaflet-retina .leaflet-draw-toolbar a {
+	background-image: url('images/spritesheet-2x.png');
+	background-size: 210px 30px;
+}
+
 .leaflet-draw a {
 	display: block;
 	text-align: center;
 	text-decoration: none;
 }
 
 /* ================================================================== */
@@ -43,44 +48,62 @@
 	margin: 0;
 	padding: 0;
 	position: absolute;
 	left: 26px; /* leaflet-draw-toolbar.left + leaflet-draw-toolbar.width */
 	top: 0;
 }
 
+.leaflet-right .leaflet-draw-actions {
+	right:26px;
+	left:auto;
+}
+
 .leaflet-draw-actions li {
-	float: left;
+	display: inline-block;
 }
 
 .leaflet-draw-actions li:first-child a {
 	border-left: none;
 }
 
 .leaflet-draw-actions li:last-child a {
 	-webkit-border-radius: 0 4px 4px 0;
 	        border-radius: 0 4px 4px 0;
 }
 
+.leaflet-right .leaflet-draw-actions li:last-child a {
+	-webkit-border-radius: 0;
+	        border-radius: 0;
+}
+
+.leaflet-right .leaflet-draw-actions li:first-child a {
+	-webkit-border-radius: 4px 0 0 4px;
+	        border-radius: 4px 0 0 4px;
+}
+
 .leaflet-draw-actions a {
 	background-color: #919187;
 	border-left: 1px solid #AAA;
 	color: #FFF;
 	font: 11px/19px "Helvetica Neue", Arial, Helvetica, sans-serif;
 	line-height: 28px;
 	text-decoration: none;
-	width: 50px;
+	padding-left: 10px;
+	padding-right: 10px;
 	height: 28px;
 }
 
 .leaflet-draw-actions-bottom {
 	margin-top: 0;
+	white-space: nowrap;
 }
 
 .leaflet-draw-actions-top {
 	margin-top: 1px;
+	white-space: nowrap;
 }
 
 .leaflet-draw-actions-top a,
 .leaflet-draw-actions-bottom a {
 	height: 27px;
 	line-height: 27px;
 }
@@ -126,14 +149,22 @@
 	background-position: -152px -2px;
 }
 
 .leaflet-draw-toolbar .leaflet-draw-edit-remove {
 	background-position: -182px -2px;
 }
 
+.leaflet-draw-toolbar .leaflet-draw-edit-edit.leaflet-disabled {
+	background-position: -212px -2px;
+}
+
+.leaflet-draw-toolbar .leaflet-draw-edit-remove.leaflet-disabled {
+	background-position: -242px -2px;
+}
+
 /* ================================================================== */
 /* Drawing styles
 /* ================================================================== */
 
 .leaflet-mouse-marker {
 	background-color: #fff;
 	cursor: crosshair;
```

## Comparing `django-leaflet-0.8.5/leaflet/static/leaflet/draw/leaflet.draw-src.js` & `django-leaflet-0.9.0/leaflet/static/leaflet/draw/leaflet.draw-src.js`

 * *Files 2% similar despite different names*

### js-beautify {}

```diff
@@ -7,15 +7,15 @@
 	https://github.com/jacobtoye
 */
 (function(window, document, undefined) {
     /*
      * Leaflet.draw assumes that you have already included the Leaflet library.
      */
 
-    L.drawVersion = '0.2.1-dev';
+    L.drawVersion = '0.2.2';
 
     L.drawLocal = {
         draw: {
             toolbar: {
                 actions: {
                     title: 'Cancel drawing',
                     text: 'Cancel'
@@ -75,16 +75,18 @@
                     },
                     cancel: {
                         title: 'Cancel editing, discards all changes.',
                         text: 'Cancel'
                     }
                 },
                 buttons: {
-                    edit: 'Edit layers',
-                    remove: 'Delete layers'
+                    edit: 'Edit layers.',
+                    editDisabled: 'No layers to edit.',
+                    remove: 'Delete layers.',
+                    removeDisabled: 'No layers to delete.'
                 }
             },
             handlers: {
                 edit: {
                     tooltip: {
                         text: 'Drag handles, or marker to edit feature.',
                         subtext: 'Click cancel to undo changes.'
@@ -197,15 +199,14 @@
         Poly: L.Polyline,
 
         options: {
             allowIntersection: true,
             repeatMode: false,
             drawError: {
                 color: '#b00b00',
-                message: L.drawLocal.draw.handlers.polyline.error,
                 timeout: 2500
             },
             icon: new L.DivIcon({
                 iconSize: new L.Point(8, 8),
                 className: 'leaflet-div-icon leaflet-editing-icon'
             }),
             guidelineDistance: 20,
@@ -214,18 +215,22 @@
                 color: '#f06eaa',
                 weight: 4,
                 opacity: 0.5,
                 fill: false,
                 clickable: true
             },
             metric: true, // Whether to use the metric meaurement system or imperial
+            showLength: true, // Whether to display distance in the tooltip
             zIndexOffset: 2000 // This should be > than the highest z-index any map layers
         },
 
         initialize: function(map, options) {
+            // Need to set this here to ensure the correct message is used.
+            this.options.drawError.message = L.drawLocal.draw.handlers.polyline.error;
+
             // Merge default drawError options with custom options
             if (options && options.drawError) {
                 options.drawError = L.Util.extend({}, this.options.drawError, options.drawError);
             }
 
             // Save the type so super can fire, need to do this as cannot do this.TYPE :(
             this.type = L.Draw.Polyline.TYPE;
@@ -392,19 +397,19 @@
 
             this._markerGroup.addLayer(marker);
 
             return marker;
         },
 
         _updateGuide: function(newPos) {
-            newPos = newPos || this._map.latLngToLayerPoint(this._currentLatLng);
-
             var markerCount = this._markers.length;
 
             if (markerCount > 0) {
+                newPos = newPos || this._map.latLngToLayerPoint(this._currentLatLng);
+
                 // draw the guide line
                 this._clearGuides();
                 this._drawGuide(
                     this._map.latLngToLayerPoint(this._markers[markerCount - 1].getLatLng()),
                     newPos
                 );
             }
@@ -467,24 +472,23 @@
                 while (this._guidesContainer.firstChild) {
                     this._guidesContainer.removeChild(this._guidesContainer.firstChild);
                 }
             }
         },
 
         _getTooltipText: function() {
-            var labelText,
-                distance,
-                distanceStr;
+            var showLength = this.options.showLength,
+                labelText, distance, distanceStr;
 
             if (this._markers.length === 0) {
                 labelText = {
                     text: L.drawLocal.draw.handlers.polyline.tooltip.start
                 };
             } else {
-                distanceStr = this._getMeasurementString();
+                distanceStr = showLength ? this._getMeasurementString() : '';
 
                 if (this._markers.length === 1) {
                     labelText = {
                         text: L.drawLocal.draw.handlers.polyline.tooltip.cont,
                         subtext: distanceStr
                     };
                 } else {
@@ -496,37 +500,20 @@
             }
             return labelText;
         },
 
         _getMeasurementString: function() {
             var currentLatLng = this._currentLatLng,
                 previousLatLng = this._markers[this._markers.length - 1].getLatLng(),
-                distance, distanceStr;
+                distance;
 
             // calculate the distance from the last fixed point to the mouse position
             distance = this._measurementRunningTotal + currentLatLng.distanceTo(previousLatLng);
 
-            if (this.options.metric) {
-                // show metres when distance is < 1km, then show km
-                if (distance > 1000) {
-                    distanceStr = (distance / 1000).toFixed(2) + ' km';
-                } else {
-                    distanceStr = Math.ceil(distance) + ' m';
-                }
-            } else {
-                distance *= 1.09361;
-
-                if (distance > 1760) {
-                    distanceStr = (distance / 1760).toFixed(2) + ' miles';
-                } else {
-                    distanceStr = Math.ceil(distance) + ' yd';
-                }
-            }
-
-            return distanceStr;
+            return L.GeometryUtil.readableDistance(distance, this.options.metric);
         },
 
         _showErrorTooltip: function() {
             this._errorShown = true;
 
             // Update tooltip
             this._tooltip
@@ -587,14 +574,15 @@
 
         _fireCreatedEvent: function() {
             var poly = new this.Poly(this._poly.getLatLngs(), this.options.shapeOptions);
             L.Draw.Feature.prototype._fireCreatedEvent.call(this, poly);
         }
     });
 
+
     L.Draw.Polygon = L.Draw.Polyline.extend({
         statics: {
             TYPE: 'polygon'
         },
 
         Poly: L.Polygon,
 
@@ -652,55 +640,36 @@
             return {
                 text: text,
                 subtext: subtext
             };
         },
 
         _getMeasurementString: function() {
-            var area = this._area,
-                areaStr;
+            var area = this._area;
 
             if (!area) {
                 return null;
             }
 
-            if (this.options.metric) {
-                if (area >= 10000) {
-                    areaStr = (area * 0.0001).toFixed(2) + ' ha';
-                } else {
-                    areaStr = area.toFixed(2) + ' m&sup2;';
-                }
-            } else {
-                area *= 0.836127; // Square yards in 1 meter
-
-                if (area >= 3097600) { //3097600 square yards in 1 square mile
-                    areaStr = (area / 3097600).toFixed(2) + ' mi&sup2;';
-                } else if (area >= 4840) { //48040 square yards in 1 acre
-                    areaStr = (area / 4840).toFixed(2) + ' acres';
-                } else {
-                    areaStr = Math.ceil(area) + ' yd&sup2;';
-                }
-            }
-
-            return areaStr;
+            return L.GeometryUtil.readableArea(area, this.options.metric);
         },
 
         _shapeIsValid: function() {
             return this._markers.length >= 3;
         },
 
         _vertexAdded: function() {
             // Check to see if we should show the area
             if (this.options.allowIntersection || !this.options.showArea) {
                 return;
             }
 
             var latLngs = this._poly.getLatLngs();
 
-            this._area = L.PolygonUtil.geodesicArea(latLngs);
+            this._area = L.GeometryUtil.geodesicArea(latLngs);
         },
 
         _cleanUpShape: function() {
             var markerCount = this._markers.length;
 
             if (markerCount > 0) {
                 this._markers[0].off('click', this._finishShape, this);
@@ -713,18 +682,20 @@
     });
 
 
     L.SimpleShape = {};
 
     L.Draw.SimpleShape = L.Draw.Feature.extend({
         options: {
-            repeatMode: true
+            repeatMode: false
         },
 
         initialize: function(map, options) {
+            this._endLabelText = L.drawLocal.draw.handlers.simpleshape.tooltip.end;
+
             L.Draw.Feature.prototype.initialize.call(this, map, options);
         },
 
         addHooks: function() {
             L.Draw.Feature.prototype.addHooks.call(this);
             if (this._map) {
                 this._map.dragging.disable();
@@ -774,15 +745,15 @@
 
         _onMouseMove: function(e) {
             var latlng = e.latlng;
 
             this._tooltip.updatePosition(latlng);
             if (this._isDrawing) {
                 this._tooltip.updateContent({
-                    text: L.drawLocal.draw.handlers.simpleshape.tooltip.end
+                    text: this._endLabelText
                 });
                 this._drawShape(latlng);
             }
         },
 
         _onMouseUp: function() {
             if (this._shape) {
@@ -814,17 +785,18 @@
             }
         },
 
         initialize: function(map, options) {
             // Save the type so super can fire, need to do this as cannot do this.TYPE :(
             this.type = L.Draw.Rectangle.TYPE;
 
+            this._initialLabelText = L.drawLocal.draw.handlers.rectangle.tooltip.start;
+
             L.Draw.SimpleShape.prototype.initialize.call(this, map, options);
         },
-        _initialLabelText: L.drawLocal.draw.handlers.rectangle.tooltip.start,
 
         _drawShape: function(latlng) {
             if (!this._shape) {
                 this._shape = new L.Rectangle(new L.LatLngBounds(this._startLatLng, latlng), this.options.shapeOptions);
                 this._map.addLayer(this._shape);
             } else {
                 this._shape.setBounds(new L.LatLngBounds(this._startLatLng, latlng));
@@ -849,26 +821,28 @@
                 color: '#f06eaa',
                 weight: 4,
                 opacity: 0.5,
                 fill: true,
                 fillColor: null, //same as color by default
                 fillOpacity: 0.2,
                 clickable: true
-            }
+            },
+            showRadius: true,
+            metric: true // Whether to use the metric meaurement system or imperial
         },
 
         initialize: function(map, options) {
             // Save the type so super can fire, need to do this as cannot do this.TYPE :(
             this.type = L.Draw.Circle.TYPE;
 
+            this._initialLabelText = L.drawLocal.draw.handlers.circle.tooltip.start;
+
             L.Draw.SimpleShape.prototype.initialize.call(this, map, options);
         },
 
-        _initialLabelText: L.drawLocal.draw.handlers.circle.tooltip.start,
-
         _drawShape: function(latlng) {
             if (!this._shape) {
                 this._shape = new L.Circle(this._startLatLng, this._startLatLng.distanceTo(latlng), this.options.shapeOptions);
                 this._map.addLayer(this._shape);
             } else {
                 this._shape.setRadius(this._startLatLng.distanceTo(latlng));
             }
@@ -877,31 +851,35 @@
         _fireCreatedEvent: function() {
             var circle = new L.Circle(this._startLatLng, this._shape.getRadius(), this.options.shapeOptions);
             L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this, circle);
         },
 
         _onMouseMove: function(e) {
             var latlng = e.latlng,
+                metric = this.options.metric,
+                showRadius = this.options.showRadius,
+                useMetric = this.options.metric,
                 radius;
 
             this._tooltip.updatePosition(latlng);
             if (this._isDrawing) {
                 this._drawShape(latlng);
 
                 // Get the new radius (rouded to 1 dp)
                 radius = this._shape.getRadius().toFixed(1);
 
                 this._tooltip.updateContent({
-                    text: 'Release mouse to finish drawing.',
-                    subtext: 'Radius: ' + radius + ' m'
+                    text: this._endLabelText,
+                    subtext: showRadius ? 'Radius: ' + L.GeometryUtil.readableDistance(radius, useMetric) : ''
                 });
             }
         }
     });
 
+
     L.Draw.Marker = L.Draw.Feature.extend({
         statics: {
             TYPE: 'marker'
         },
 
         options: {
             icon: new L.Icon.Default(),
@@ -1396,27 +1374,27 @@
             this._shape.redraw();
         },
 
         _onMarkerDragEnd: function(e) {
             var marker = e.target;
             marker.setOpacity(1);
 
-            this._shape.fire('edit');
             this._fireEdit();
         },
 
         _move: function() {
             // Children override
         },
 
         _resize: function() {
             // Children override
         }
     });
 
+
     L.Edit = L.Edit || {};
 
     L.Edit.Rectangle = L.Edit.SimpleShape.extend({
         _createMoveMarker: function() {
             var bounds = this._shape.getBounds(),
                 center = bounds.getCenter();
 
@@ -1610,19 +1588,15 @@
         },
 
         cloneLatLng: function(latlng) {
             return L.latLng(latlng.lat, latlng.lng);
         }
     };
 
-    /*
-     * L.PolygonUtil contains different utility functions for Polygons.
-     */
-
-    L.PolygonUtil = {
+    L.GeometryUtil = {
         // Ported from the OpenLayers implementation. See https://github.com/openlayers/openlayers/blob/master/lib/OpenLayers/Geometry/LinearRing.js#L270
         geodesicArea: function(latLngs) {
             var pointsCount = latLngs.length,
                 area = 0.0,
                 d2r = L.LatLng.DEG_TO_RAD,
                 p1, p2;
 
@@ -1633,14 +1607,61 @@
                     area += ((p2.lng - p1.lng) * d2r) *
                         (2 + Math.sin(p1.lat * d2r) + Math.sin(p2.lat * d2r));
                 }
                 area = area * 6378137.0 * 6378137.0 / 2.0;
             }
 
             return Math.abs(area);
+        },
+
+        readableArea: function(area, isMetric) {
+            var areaStr;
+
+            if (isMetric) {
+                if (area >= 10000) {
+                    areaStr = (area * 0.0001).toFixed(2) + ' ha';
+                } else {
+                    areaStr = area.toFixed(2) + ' m&sup2;';
+                }
+            } else {
+                area *= 0.836127; // Square yards in 1 meter
+
+                if (area >= 3097600) { //3097600 square yards in 1 square mile
+                    areaStr = (area / 3097600).toFixed(2) + ' mi&sup2;';
+                } else if (area >= 4840) { //48040 square yards in 1 acre
+                    areaStr = (area / 4840).toFixed(2) + ' acres';
+                } else {
+                    areaStr = Math.ceil(area) + ' yd&sup2;';
+                }
+            }
+
+            return areaStr;
+        },
+
+        readableDistance: function(distance, isMetric) {
+            var distanceStr;
+
+            if (isMetric) {
+                // show metres when distance is < 1km, then show km
+                if (distance > 1000) {
+                    distanceStr = (distance / 1000).toFixed(2) + ' km';
+                } else {
+                    distanceStr = Math.ceil(distance) + ' m';
+                }
+            } else {
+                distance *= 1.09361;
+
+                if (distance > 1760) {
+                    distanceStr = (distance / 1760).toFixed(2) + ' miles';
+                } else {
+                    distanceStr = Math.ceil(distance) + ' yd';
+                }
+            }
+
+            return distanceStr;
         }
     };
 
     L.Util.extend(L.LineUtil, {
         // Checks to see if two line segments intersect. Does not handle degenerate cases.
         // http://compgeom.cs.uiuc.edu/~jeffe/teaching/373/notes/x06-sweepline.pdf
         segmentsIntersect: function( /*Point*/ p, /*Point*/ p1, /*Point*/ p2, /*Point*/ p3) {
@@ -1858,14 +1879,15 @@
                     this._toolbars[toolbarId].disable();
                 }
             }
         }
     });
 
     L.Map.mergeOptions({
+        drawControlTooltips: true,
         drawControl: false
     });
 
     L.Map.addInitHook(function() {
         if (this.options.drawControl) {
             this.drawControl = new L.Control.Draw();
             this.addControl(this.drawControl);
@@ -1998,17 +2020,15 @@
             this._activeMode = null;
 
             this.fire('disable');
         },
 
         _createActions: function(buttons) {
             var container = L.DomUtil.create('ul', 'leaflet-draw-actions'),
-                buttonWidth = 50,
                 l = buttons.length,
-                containerWidth = (l * buttonWidth) + (l - 1), //l - 1 = the borders
                 li, button;
 
             for (var i = 0; i < l; i++) {
                 li = L.DomUtil.create('li', '', container);
 
                 button = this._createButton({
                     title: buttons[i].title,
@@ -2020,16 +2040,14 @@
 
                 this._actionButtons.push({
                     button: button,
                     callback: buttons[i].callback
                 });
             }
 
-            container.style.width = containerWidth + 'px';
-
             return container;
         },
 
         _showActionsToolbar: function() {
             var buttonIndex = this._activeMode.buttonIndex,
                 lastButtonIndex = this._lastButtonIndex,
                 buttonHeight = 26, // TODO: this should be calculated
@@ -2063,24 +2081,29 @@
     });
 
     L.Tooltip = L.Class.extend({
         initialize: function(map) {
             this._map = map;
             this._popupPane = map._panes.popupPane;
 
-            this._container = L.DomUtil.create('div', 'leaflet-draw-tooltip', this._popupPane);
+            this._container = map.options.drawControlTooltips ? L.DomUtil.create('div', 'leaflet-draw-tooltip', this._popupPane) : null;
             this._singleLineLabel = false;
         },
 
         dispose: function() {
-            this._popupPane.removeChild(this._container);
-            this._container = null;
+            if (this._container) {
+                this._popupPane.removeChild(this._container);
+                this._container = null;
+            }
         },
 
         updateContent: function(labelText) {
+            if (!this._container) {
+                return this;
+            }
             labelText.subtext = labelText.subtext || '';
 
             // update the vertical position (only if changed)
             if (labelText.subtext.length === 0 && !this._singleLineLabel) {
                 L.DomUtil.addClass(this._container, 'leaflet-draw-tooltip-single');
                 this._singleLineLabel = true;
             } else if (labelText.subtext.length > 0 && this._singleLineLabel) {
@@ -2094,26 +2117,32 @@
 
             return this;
         },
 
         updatePosition: function(latlng) {
             var pos = this._map.latLngToLayerPoint(latlng);
 
-            L.DomUtil.setPosition(this._container, pos);
+            if (this._container) {
+                L.DomUtil.setPosition(this._container, pos);
+            }
 
             return this;
         },
 
         showAsError: function() {
-            L.DomUtil.addClass(this._container, 'leaflet-error-draw-tooltip');
+            if (this._container) {
+                L.DomUtil.addClass(this._container, 'leaflet-error-draw-tooltip');
+            }
             return this;
         },
 
         removeError: function() {
-            L.DomUtil.removeClass(this._container, 'leaflet-error-draw-tooltip');
+            if (this._container) {
+                L.DomUtil.removeClass(this._container, 'leaflet-error-draw-tooltip');
+            }
             return this;
         }
     });
 
     L.DrawToolbar = L.Toolbar.extend({
 
         options: {
@@ -2263,37 +2292,38 @@
 
             this._selectedFeatureCount = 0;
         },
 
         addToolbar: function(map) {
             var container = L.DomUtil.create('div', 'leaflet-draw-section'),
                 buttonIndex = 0,
-                buttonClassPrefix = 'leaflet-draw-edit';
+                buttonClassPrefix = 'leaflet-draw-edit',
+                featureGroup = this.options.featureGroup;
 
             this._toolbarContainer = L.DomUtil.create('div', 'leaflet-draw-toolbar leaflet-bar');
 
             this._map = map;
 
             if (this.options.edit) {
                 this._initModeHandler(
                     new L.EditToolbar.Edit(map, {
-                        featureGroup: this.options.featureGroup,
+                        featureGroup: featureGroup,
                         selectedPathOptions: this.options.edit.selectedPathOptions
                     }),
                     this._toolbarContainer,
                     buttonIndex++,
                     buttonClassPrefix,
                     L.drawLocal.edit.toolbar.buttons.edit
                 );
             }
 
             if (this.options.remove) {
                 this._initModeHandler(
                     new L.EditToolbar.Delete(map, {
-                        featureGroup: this.options.featureGroup
+                        featureGroup: featureGroup
                     }),
                     this._toolbarContainer,
                     buttonIndex++,
                     buttonClassPrefix,
                     L.drawLocal.edit.toolbar.buttons.remove
                 );
             }
@@ -2314,33 +2344,87 @@
                 context: this
             }]);
 
             // Add draw and cancel containers to the control container
             container.appendChild(this._toolbarContainer);
             container.appendChild(this._actionsContainer);
 
+            this._checkDisabled();
+
+            featureGroup.on('layeradd layerremove', this._checkDisabled, this);
+
             return container;
         },
 
+        removeToolbar: function() {
+            L.Toolbar.prototype.removeToolbar.call(this);
+
+            this.options.featureGroup.off('layeradd layerremove', this._checkDisabled, this);
+        },
+
         disable: function() {
             if (!this.enabled()) {
                 return;
             }
 
             this._activeMode.handler.revertLayers();
 
             L.Toolbar.prototype.disable.call(this);
         },
 
         _save: function() {
             this._activeMode.handler.save();
             this._activeMode.handler.disable();
+        },
+
+        _checkDisabled: function() {
+            var featureGroup = this.options.featureGroup,
+                hasLayers = featureGroup.getLayers().length === 0,
+                button;
+
+            if (this.options.edit) {
+                button = this._modes[L.EditToolbar.Edit.TYPE].button;
+
+                L.DomUtil.toggleClass(button, 'leaflet-disabled');
+
+                button.setAttribute(
+                    'title',
+                    hasLayers ?
+                    L.drawLocal.edit.toolbar.buttons.edit :
+                    L.drawLocal.edit.toolbar.buttons.editDisabled
+                );
+            }
+
+            if (this.options.remove) {
+                button = this._modes[L.EditToolbar.Delete.TYPE].button;
+
+                L.DomUtil.toggleClass(button, 'leaflet-disabled');
+
+                button.setAttribute(
+                    'title',
+                    hasLayers ?
+                    L.drawLocal.edit.toolbar.buttons.remove :
+                    L.drawLocal.edit.toolbar.buttons.removeDisabled
+                );
+            }
         }
     });
 
+    if (!L.DomUtil.toggleClass) {
+        L.Util.extend(L.DomUtil, {
+            toggleClass: function(el, name) {
+                if (this.hasClass(el, name)) {
+                    this.removeClass(el, name);
+                } else {
+                    this.addClass(el, name);
+                }
+            }
+        });
+    }
+
     L.EditToolbar.Edit = L.Handler.extend({
         statics: {
             TYPE: 'edit'
         },
 
         includes: L.Mixin.Events,
 
@@ -2360,15 +2444,15 @@
             this._uneditedLayerProps = {};
 
             // Save the type so super can fire, need to do this as cannot do this.TYPE :(
             this.type = L.EditToolbar.Edit.TYPE;
         },
 
         enable: function() {
-            if (this._enabled) {
+            if (this._enabled || !this._hasAvailableLayers()) {
                 return;
             }
 
             L.Handler.prototype.enable.call(this);
 
             this._featureGroup
                 .on('layeradd', this._enableLayerEdit, this)
@@ -2484,14 +2568,17 @@
                 } else { // Marker
                     layer.setLatLng(this._uneditedLayerProps[id].latlng);
                 }
             }
         },
 
         _toggleMarkerHighlight: function(marker) {
+            if (!marker._icon) {
+                return;
+            }
             // This is quite naughty, but I don't see another way of doing it. (short of setting a new icon)
             var icon = marker._icon;
 
             icon.style.display = 'none';
 
             if (L.DomUtil.hasClass(icon, 'leaflet-edit-marker-selected')) {
                 L.DomUtil.removeClass(icon, 'leaflet-edit-marker-selected');
@@ -2583,14 +2670,18 @@
         _onMarkerDragEnd: function(e) {
             var layer = e.target;
             layer.edited = true;
         },
 
         _onMouseMove: function(e) {
             this._tooltip.updatePosition(e.latlng);
+        },
+
+        _hasAvailableLayers: function() {
+            return this._featureGroup.getLayers().length !== 0;
         }
     });
 
 
     L.EditToolbar.Delete = L.Handler.extend({
         statics: {
             TYPE: 'remove' // not delete as delete is reserved in js
@@ -2611,15 +2702,15 @@
             }
 
             // Save the type so super can fire, need to do this as cannot do this.TYPE :(
             this.type = L.EditToolbar.Delete.TYPE;
         },
 
         enable: function() {
-            if (this._enabled) {
+            if (this._enabled || !this._hasAvailableLayers()) {
                 return;
             }
 
             L.Handler.prototype.enable.call(this);
 
             this._deletableLayers
                 .on('layeradd', this._enableLayerDelete, this)
@@ -2712,12 +2803,16 @@
             this._deletableLayers.removeLayer(layer);
 
             this._deletedLayers.addLayer(layer);
         },
 
         _onMouseMove: function(e) {
             this._tooltip.updatePosition(e.latlng);
+        },
+
+        _hasAvailableLayers: function() {
+            return this._deletableLayers.getLayers().length !== 0;
         }
     });
 
 
 }(this, document));
```

## Comparing `django-leaflet-0.8.5/leaflet/locale/it/LC_MESSAGES/django.mo` & `django-leaflet-0.9.0/leaflet/locale/it/LC_MESSAGES/django.mo`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/locale/fr/LC_MESSAGES/django.mo` & `django-leaflet-0.9.0/leaflet/locale/fr/LC_MESSAGES/django.mo`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/forms/widgets.py` & `django-leaflet-0.9.0/leaflet/forms/widgets.py`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/leaflet/forms/fields.py` & `django-leaflet-0.9.0/leaflet/forms/fields.py`

 * *Files identical despite different names*

## Comparing `django-leaflet-0.8.5/django_leaflet.egg-info/SOURCES.txt` & `django-leaflet-0.9.0/django_leaflet.egg-info/SOURCES.txt`

 * *Files 11% similar despite different names*

```diff
@@ -8,18 +8,18 @@
 django_leaflet.egg-info/dependency_links.txt
 django_leaflet.egg-info/not-zip-safe
 django_leaflet.egg-info/requires.txt
 django_leaflet.egg-info/top_level.txt
 leaflet/__init__.py
 leaflet/admin.py
 leaflet/models.py
-leaflet/tests.py
 leaflet/forms/__init__.py
 leaflet/forms/fields.py
 leaflet/forms/widgets.py
+leaflet/locale/de/LC_MESSAGES/django.mo
 leaflet/locale/fr/LC_MESSAGES/django.mo
 leaflet/locale/it/LC_MESSAGES/django.mo
 leaflet/static/leaflet/Control.MiniMap.css
 leaflet/static/leaflet/Control.MiniMap.js
 leaflet/static/leaflet/eventlistener.ie6-7.js
 leaflet/static/leaflet/eventlistener.ie8.js
 leaflet/static/leaflet/leaflet-src.js
@@ -49,8 +49,10 @@
 leaflet/templates/leaflet/_leaflet_draw_i18n.js
 leaflet/templates/leaflet/_leaflet_map.html
 leaflet/templates/leaflet/css.html
 leaflet/templates/leaflet/js.html
 leaflet/templates/leaflet/widget.html
 leaflet/templates/leaflet/admin/widget.html
 leaflet/templatetags/__init__.py
-leaflet/templatetags/leaflet_tags.py
+leaflet/templatetags/leaflet_tags.py
+leaflet/tests/__init__.py
+leaflet/tests/tests.py
```

## Comparing `django-leaflet-0.8.5/django_leaflet.egg-info/PKG-INFO` & `django-leaflet-0.9.0/django_leaflet.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,20 +1,20 @@
 Metadata-Version: 1.1
 Name: django-leaflet
-Version: 0.8.5
+Version: 0.9.0
 Summary: Use Leaflet in your django projects
 Home-page: https://github.com/makinacorpus/django-leaflet
 Author: Mathieu Leplatre
 Author-email: mathieu.leplatre@makina-corpus.com
 License: LPGL, see LICENSE file.
 Download-URL: http://pypi.python.org/pypi/django-leaflet/
 Description: *django-leaflet* allows you to use `Leaflet <http://leafletjs.com>`_
         in your `Django <https://www.djangoproject.com>`_ projects.
         
-        It embeds Leaflet in version *0.6.4*.
+        It embeds Leaflet in version *0.7.1*.
         
         .. image:: https://pypip.in/v/django-leaflet/badge.png
                 :target: https://pypi.python.org/pypi/django-leaflet
         
         .. image:: https://pypip.in/d/django-leaflet/badge.png
                 :target: https://pypi.python.org/pypi/django-leaflet
         
@@ -238,14 +238,29 @@
         
             'MINIMAP': True
         
         By default it shows the tiles of the first layer in the list.
         
         (`More info... <https://github.com/Norkart/Leaflet-MiniMap>`_)
         
+        Reset view button
+        ~~~~~~~~~~~~~~~~~
+        By default, a button appears below the zoom controls and, when clicked, shows the entire map.
+        To remove this button, set::
+        
+            'RESET_VIEW': False
+        
+        
+        Global initialization functions and ``window.maps``
+        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+        Since 0.7.0, the ``leaflet_map`` template tag no longer registers initialization functions in global scope,
+        and no longer adds map objects into ``window.maps`` array by default. To restore these features, use::
+        
+            'NO_GLOBALS' = False
+        
         
         Plugins
         ~~~~~~~
         
         To ease the usage of plugins, django-leaflet allows specifying a set of plugins, that can
         later be referred to from the template tags by name::
         
@@ -291,15 +306,15 @@
         
         Leaflet map forms widgets
         -------------------------
         
         With *Django* >= 1.6, a Leaflet widget is provided to edit geometry fields.
         In previous versions, it falls back to simple text areas.
         
-        It embeds *Leaflet.draw* in version *0.2.1dev*.
+        It embeds *Leaflet.draw* in version *0.2.2*.
         
         
         .. image :: https://f.cloud.github.com/assets/546692/1048836/78b6ad94-1094-11e3-86d8-c3e88626a31d.png
         
         
         In Adminsite
         ~~~~~~~~~~~~
@@ -472,14 +487,23 @@
         * Leaflet Copyright - 2010-2011 CloudMade, Vladimir Agafonkin
         
         
         =========
         CHANGELOG
         =========
         
+        0.9.0 (2013-12-11)
+        ------------------
+        
+        * Upgrade to Leaflet 0.7.1
+        * Fix unsaved warning being always triggered on Internet Explorer.
+        * Added DE locale (thanks @rosscdh)
+        * Fix installation with python 2.6 (thanks @ollb)
+        
+        
         0.8.5 (2013-11-05)
         ------------------
         
         * Fix name collision.
         
         
         0.8.4 (2013-11-05)
```

### html2text {}

```diff
@@ -1,15 +1,15 @@
-Metadata-Version: 1.1 Name: django-leaflet Version: 0.8.5 Summary: Use Leaflet
+Metadata-Version: 1.1 Name: django-leaflet Version: 0.9.0 Summary: Use Leaflet
 in your django projects Home-page: https://github.com/makinacorpus/django-
 leaflet Author: Mathieu Leplatre Author-email: mathieu.leplatre@makina-
 corpus.com License: LPGL, see LICENSE file. Download-URL: http://
 pypi.python.org/pypi/django-leaflet/ Description: *django-leaflet* allows you
 to use `Leaflet
 leafletjs.com>`_ in your `Django
-www.djangoproject.com>`_ projects. It embeds Leaflet in version *0.6.4*. ..
+www.djangoproject.com>`_ projects. It embeds Leaflet in version *0.7.1*. ..
 image:: https://pypip.in/v/django-leaflet/badge.png :target: https://
 pypi.python.org/pypi/django-leaflet .. image:: https://pypip.in/d/django-
 leaflet/badge.png :target: https://pypi.python.org/pypi/django-leaflet ..
 image:: https://travis-ci.org/makinacorpus/django-leaflet.png :target: https://
 travis-ci.org/makinacorpus/django-leaflet .. image:: https://coveralls.io/
 repos/makinacorpus/django-leaflet/badge.png :target: https://coveralls.io/r/
 makinacorpus/django-leaflet Main purposes of having a python package for the
@@ -57,39 +57,46 @@
 likely an empty string) :: 'ATTRIBUTION_PREFIX': 'Powered by django-leaflet'
 Default is ``None``, which leaves the value to `Leaflet's default
 leafletjs.com/reference.html#control-attribution>`_. Scale control
 ~~~~~~~~~~~~~ Disable scale control with km and miles:: 'SCALE': False Minimap
 control ~~~~~~~~~~~~~~~ Shows a small map in the corner which shows the same as
 the main map with a set zoom offset:: 'MINIMAP': True By default it shows the
 tiles of the first layer in the list. (`More info...
-github.com/Norkart/Leaflet-MiniMap>`_) Plugins ~~~~~~~ To ease the usage of
-plugins, django-leaflet allows specifying a set of plugins, that can later be
-referred to from the template tags by name:: 'PLUGINS': { 'name-of-plugin':
-{ 'css': ['relative/path/to/stylesheet.css', '/root/path/to/stylesheet.css'],
-'js': 'http://absolute-url.example.com/path/to/script.js', 'auto-include':
-True, }, . . . } Both 'css' and 'js' support identical features for specifying
-resource URLs: * can be either a plain string or a list of URLs * each string
-can be: * absolute URL - will be included as-is; **example**: ``http://
-absolute-url.example.com/path/to/script.js`` * a URL beginning from the root -
-will be included as-is; **example**: ``/root/path/to/stylesheet.css`` * a
-relative URL - settings.STATIC_URL will be prepended; **example**: ``relative/
-path/to/stylesheet.css`` will be included as **/static/relative/path/to/
-stylesheet.css** (depending on your setting for STATIC_URL) Now, use
-``leaflet_js`` and ``leaflet_css`` tags to load CSS and JS resources of
-configured Leaflet plugins. By default only plugins with ``'auto-include'`` as
-True will be included. To include specific plugins in the page, specify plugin
-names, comma separated:: {% load leaflet_tags %}
+github.com/Norkart/Leaflet-MiniMap>`_) Reset view button ~~~~~~~~~~~~~~~~~ By
+default, a button appears below the zoom controls and, when clicked, shows the
+entire map. To remove this button, set:: 'RESET_VIEW': False Global
+initialization functions and ``window.maps``
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Since 0.7.0, the
+``leaflet_map`` template tag no longer registers initialization functions in
+global scope, and no longer adds map objects into ``window.maps`` array by
+default. To restore these features, use:: 'NO_GLOBALS' = False Plugins ~~~~~~~
+To ease the usage of plugins, django-leaflet allows specifying a set of
+plugins, that can later be referred to from the template tags by name::
+'PLUGINS': { 'name-of-plugin': { 'css': ['relative/path/to/stylesheet.css', '/
+root/path/to/stylesheet.css'], 'js': 'http://absolute-url.example.com/path/to/
+script.js', 'auto-include': True, }, . . . } Both 'css' and 'js' support
+identical features for specifying resource URLs: * can be either a plain string
+or a list of URLs * each string can be: * absolute URL - will be included as-
+is; **example**: ``http://absolute-url.example.com/path/to/script.js`` * a URL
+beginning from the root - will be included as-is; **example**: ``/root/path/to/
+stylesheet.css`` * a relative URL - settings.STATIC_URL will be prepended;
+**example**: ``relative/path/to/stylesheet.css`` will be included as **/static/
+relative/path/to/stylesheet.css** (depending on your setting for STATIC_URL)
+Now, use ``leaflet_js`` and ``leaflet_css`` tags to load CSS and JS resources
+of configured Leaflet plugins. By default only plugins with ``'auto-include'``
+as True will be included. To include specific plugins in the page, specify
+plugin names, comma separated:: {% load leaflet_tags %}
 ... {% leaflet_js plugins="bouncemarker,draw" %} {% leaflet_css
 plugins="bouncemarker,draw" %}
 To include all plugins configured in ``LEAFLET_CONFIG['PLUGINS']``, use:: {%
 leaflet_js plugins="ALL" %} {% leaflet_css plugins="ALL" %} Leaflet map forms
 widgets ------------------------- With *Django* >= 1.6, a Leaflet widget is
 provided to edit geometry fields. In previous versions, it falls back to simple
-text areas. It embeds *Leaflet.draw* in version *0.2.1dev*. .. image :: https:/
-/f.cloud.github.com/assets/546692/1048836/78b6ad94-1094-11e3-86d8-
+text areas. It embeds *Leaflet.draw* in version *0.2.2*. .. image :: https://
+f.cloud.github.com/assets/546692/1048836/78b6ad94-1094-11e3-86d8-
 c3e88626a31d.png In Adminsite ~~~~~~~~~~~~ :: from django.contrib import admin
 from leaflet.admin import LeafletGeoAdmin from .models import WeatherStation
 admin.site.register(WeatherStation, LeafletGeoAdmin) In forms ~~~~~~~~ :: from
 django import forms from leaflet.forms.widgets import LeafletWidget class
 WeatherStationForm(forms.ModelForm): class Meta: model = WeatherStation fields
 = ('name', 'geom') widgets = {'geom': LeafletWidget()} The related template
 would look like this: :: {% load leaflet_tags %}
@@ -133,21 +140,24 @@
 ======= * Mathieu Leplatre
 makina-corpus.com> * Ariel NÃºÃ±ez
 ingenieroariel.com> * Boris Chervenkov
 github.com/boris-chervenkov> |makinacom|_ .. |makinacom| image:: http://
 depot.makina-corpus.org/public/logo.gif .. _makinacom: http://www.makina-
 corpus.com ======= LICENSE ======= * Lesser GNU Public License * Leaflet
 Copyright - 2010-2011 CloudMade, Vladimir Agafonkin ========= CHANGELOG
-========= 0.8.5 (2013-11-05) ------------------ * Fix name collision. 0.8.4
-(2013-11-05) ------------------ * Fix regression in Django leaflet options
-serialization. 0.8.3 (2013-11-05) ------------------ * Switch to lazy gettext
-in leaflet module init. 0.8.2 (2013-10-31) ------------------ * Fix drawing of
-multi-polygon (fixes #37) * Fix attached data for events with jQuery fallback
-(fixes #38) * Fix Javascript syntax errors when using form prefixes (fixes #40)
-0.8.1 (2013-09-30) ------------------ * Fix Leaflet library inclusion with
+========= 0.9.0 (2013-12-11) ------------------ * Upgrade to Leaflet 0.7.1 *
+Fix unsaved warning being always triggered on Internet Explorer. * Added DE
+locale (thanks @rosscdh) * Fix installation with python 2.6 (thanks @ollb)
+0.8.5 (2013-11-05) ------------------ * Fix name collision. 0.8.4 (2013-11-05)
+------------------ * Fix regression in Django leaflet options serialization.
+0.8.3 (2013-11-05) ------------------ * Switch to lazy gettext in leaflet
+module init. 0.8.2 (2013-10-31) ------------------ * Fix drawing of multi-
+polygon (fixes #37) * Fix attached data for events with jQuery fallback (fixes
+#38) * Fix Javascript syntax errors when using form prefixes (fixes #40) 0.8.1
+(2013-09-30) ------------------ * Fix Leaflet library inclusion with
 "plugins=ALL" outside Admin. * Do not include translations in every widgets
 outside Admin. * Fix syntax error if form widget translations contains quotes.
 * Fix dependency error if Leaflet is loaded after the form widget in the DOM. *
 Respect plugins declaration order using OrderedDicts * Prepend forms assets
 (instead of extend) if PLUGINS['forms'] already exists. 0.8.0 (2013-09-18) ----
 -------------- * Renamed Leaflet map fragment template * Leaflet map geometry
 widgets for adminsite and forms (requires Django 1.6) * Fix geometry type
```

