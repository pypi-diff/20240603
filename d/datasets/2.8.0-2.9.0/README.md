# Comparing `tmp/datasets-2.8.0.tar.gz` & `tmp/datasets-2.9.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/datasets-2.8.0.tar", last modified: Mon Dec 19 10:48:55 2022, max compression
+gzip compressed data, was "dist/datasets-2.9.0.tar", last modified: Thu Jan 26 19:30:06 2023, max compression
```

## Comparing `datasets-2.8.0.tar` & `datasets-2.9.0.tar`

### file list

```diff
@@ -1,151 +1,152 @@
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    11358 2020-04-21 09:41:30.000000 datasets-2.8.0/LICENSE
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    16204 2022-12-19 10:48:55.000000 datasets-2.8.0/PKG-INFO
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    13040 2022-12-13 15:05:54.000000 datasets-2.8.0/README.md
--rw-r--r--   0 quentinlhoest   (501) staff       (20)       57 2022-12-13 15:05:54.000000 datasets-2.8.0/pyproject.toml
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      481 2022-12-19 10:48:55.000000 datasets-2.8.0/setup.cfg
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     9404 2022-12-19 10:47:09.000000 datasets-2.8.0/setup.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3226 2022-12-19 10:46:58.000000 datasets-2.8.0/src/datasets/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)   261516 2022-12-19 10:46:05.000000 datasets-2.8.0/src/datasets/arrow_dataset.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    26585 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/arrow_reader.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    33206 2022-12-14 16:57:56.000000 datasets-2.8.0/src/datasets/arrow_writer.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    97701 2022-12-16 13:29:00.000000 datasets-2.8.0/src/datasets/builder.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     8982 2022-12-19 10:46:03.000000 datasets-2.8.0/src/datasets/combine.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/commands/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      312 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/commands/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     7914 2022-02-02 14:17:14.000000 datasets-2.8.0/src/datasets/commands/convert.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1381 2022-08-18 13:40:48.000000 datasets-2.8.0/src/datasets/commands/datasets_cli.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    23107 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/commands/dummy_data.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1080 2022-03-15 10:48:49.000000 datasets-2.8.0/src/datasets/commands/env.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     6665 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/commands/run_beam.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     8120 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/commands/test.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     7958 2022-12-16 13:29:00.000000 datasets-2.8.0/src/datasets/config.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    32887 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/data_files.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    91244 2022-12-16 13:29:00.000000 datasets-2.8.0/src/datasets/dataset_dict.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/download/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      281 2022-08-18 13:40:48.000000 datasets-2.8.0/src/datasets/download/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3037 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/download/download_config.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    18998 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/download/download_manager.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    10447 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/download/mock_download_manager.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    41357 2022-12-16 13:29:00.000000 datasets-2.8.0/src/datasets/download/streaming_download_manager.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/features/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      447 2022-03-15 10:56:17.000000 datasets-2.8.0/src/datasets/features/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    17195 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/features/audio.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    83635 2022-12-14 16:57:56.000000 datasets-2.8.0/src/datasets/features/features.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    12292 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/features/image.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     4385 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/features/translation.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/filesystems/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     2035 2022-12-16 13:29:02.000000 datasets-2.8.0/src/datasets/filesystems/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     5718 2022-03-15 13:46:27.000000 datasets-2.8.0/src/datasets/filesystems/compression.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3108 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/filesystems/hffilesystem.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     5571 2022-12-16 13:29:00.000000 datasets-2.8.0/src/datasets/filesystems/s3filesystem.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    22261 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/fingerprint.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/formatting/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     5140 2022-12-14 16:57:56.000000 datasets-2.8.0/src/datasets/formatting/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    26006 2022-12-19 10:46:05.000000 datasets-2.8.0/src/datasets/formatting/formatting.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     4316 2022-12-14 16:57:56.000000 datasets-2.8.0/src/datasets/formatting/jax_formatter.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3390 2022-12-14 16:57:56.000000 datasets-2.8.0/src/datasets/formatting/np_formatter.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     4035 2022-12-14 16:57:56.000000 datasets-2.8.0/src/datasets/formatting/tf_formatter.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3866 2022-12-14 16:57:56.000000 datasets-2.8.0/src/datasets/formatting/torch_formatter.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    23576 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/info.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    20987 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/inspect.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/io/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/io/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1655 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/io/abc.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     5197 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/io/csv.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1936 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/io/generator.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     6158 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/io/json.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     4181 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/io/parquet.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     4394 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/io/sql.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     2123 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/io/text.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    76394 2022-12-19 10:46:05.000000 datasets-2.8.0/src/datasets/iterable_dataset.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3826 2022-08-18 13:40:48.000000 datasets-2.8.0/src/datasets/keyhash.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    85844 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/load.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    27992 2022-08-25 16:49:59.000000 datasets-2.8.0/src/datasets/metric.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3001 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/naming.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/packaged_modules/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     2130 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/packaged_modules/__init__.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/packaged_modules/audiofolder/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/packaged_modules/audiofolder/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1635 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/packaged_modules/audiofolder/audiofolder.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/packaged_modules/csv/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/packaged_modules/csv/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     7848 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/packaged_modules/csv/csv.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/packaged_modules/folder_based_builder/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/packaged_modules/folder_based_builder/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    22528 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/packaged_modules/folder_based_builder/folder_based_builder.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/packaged_modules/generator/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/packaged_modules/generator/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      928 2022-12-16 17:08:55.000000 datasets-2.8.0/src/datasets/packaged_modules/generator/generator.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/packaged_modules/imagefolder/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2022-03-04 13:42:32.000000 datasets-2.8.0/src/datasets/packaged_modules/imagefolder/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1977 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/packaged_modules/imagefolder/imagefolder.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/packaged_modules/json/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/packaged_modules/json/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     9006 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/packaged_modules/json/json.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/packaged_modules/pandas/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/packaged_modules/pandas/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     2302 2022-08-18 13:40:48.000000 datasets-2.8.0/src/datasets/packaged_modules/pandas/pandas.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/packaged_modules/parquet/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/packaged_modules/parquet/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3689 2022-08-18 13:40:48.000000 datasets-2.8.0/src/datasets/packaged_modules/parquet/parquet.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/packaged_modules/sql/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/packaged_modules/sql/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     4471 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/packaged_modules/sql/sql.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/packaged_modules/text/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/packaged_modules/text/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     5763 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/packaged_modules/text/text.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/py.typed
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    33528 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/search.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    23337 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/splits.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     5665 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/streaming.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    94486 2022-12-16 13:29:00.000000 datasets-2.8.0/src/datasets/table.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/tasks/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1615 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/tasks/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1297 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/tasks/audio_classificiation.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1309 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/tasks/automatic_speech_recognition.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1095 2022-02-02 14:17:14.000000 datasets-2.8.0/src/datasets/tasks/base.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1297 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/tasks/image_classification.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      581 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/tasks/language_modeling.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1105 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/tasks/question_answering.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      772 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/tasks/summarization.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1403 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/tasks/text_classification.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/utils/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      921 2022-08-18 13:40:48.000000 datasets-2.8.0/src/datasets/utils/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     6637 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/utils/_hf_hub_fixes.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     2029 2022-05-19 08:32:00.000000 datasets-2.8.0/src/datasets/utils/beam_utils.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3452 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/utils/deprecation_utils.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      407 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/utils/doc_utils.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)       60 2022-08-18 13:40:48.000000 datasets-2.8.0/src/datasets/utils/download_manager.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    12442 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/utils/extract.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    23051 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/utils/file_utils.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    13813 2022-08-25 16:41:29.000000 datasets-2.8.0/src/datasets/utils/filelock.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      452 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/utils/hub.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3813 2022-03-01 16:20:18.000000 datasets-2.8.0/src/datasets/utils/info_utils.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     6752 2022-12-16 13:29:00.000000 datasets-2.8.0/src/datasets/utils/logging.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     5734 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/utils/metadata.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     4957 2022-08-18 13:40:48.000000 datasets-2.8.0/src/datasets/utils/patching.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    55870 2022-12-16 13:29:00.000000 datasets-2.8.0/src/datasets/utils/py_utils.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    12671 2022-08-18 13:40:48.000000 datasets-2.8.0/src/datasets/utils/readme.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets/utils/resources/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/utils/resources/__init__.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      257 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/utils/resources/creators.json
--rw-r--r--   0 quentinlhoest   (501) staff       (20)   199138 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/utils/resources/languages.json
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      205 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/utils/resources/multilingualities.json
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3877 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/utils/resources/readme_structure.yaml
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      171 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/utils/resources/size_categories.json
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3998 2022-12-19 10:46:03.000000 datasets-2.8.0/src/datasets/utils/sharding.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     4091 2022-08-18 13:40:48.000000 datasets-2.8.0/src/datasets/utils/stratify.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     2300 2022-11-15 16:10:47.000000 datasets-2.8.0/src/datasets/utils/tf_utils.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)      176 2021-12-01 18:59:38.000000 datasets-2.8.0/src/datasets/utils/typing.py
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     3281 2022-12-13 15:05:54.000000 datasets-2.8.0/src/datasets/utils/version.py
-drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets.egg-info/
--rw-r--r--   0 quentinlhoest   (501) staff       (20)    16204 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets.egg-info/PKG-INFO
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     4432 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets.egg-info/SOURCES.txt
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        1 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets.egg-info/dependency_links.txt
--rw-r--r--   0 quentinlhoest   (501) staff       (20)       70 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets.egg-info/entry_points.txt
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        1 2021-06-09 15:03:45.000000 datasets-2.8.0/src/datasets.egg-info/not-zip-safe
--rw-r--r--   0 quentinlhoest   (501) staff       (20)     1987 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets.egg-info/requires.txt
--rw-r--r--   0 quentinlhoest   (501) staff       (20)        9 2022-12-19 10:48:55.000000 datasets-2.8.0/src/datasets.egg-info/top_level.txt
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    11358 2020-04-21 09:41:30.000000 datasets-2.9.0/LICENSE
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    16204 2023-01-26 19:30:06.000000 datasets-2.9.0/PKG-INFO
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    13040 2022-12-13 15:05:54.000000 datasets-2.9.0/README.md
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)       57 2022-12-13 15:05:54.000000 datasets-2.9.0/pyproject.toml
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      481 2023-01-26 19:30:06.000000 datasets-2.9.0/setup.cfg
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     9420 2023-01-26 19:28:37.000000 datasets-2.9.0/setup.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3226 2023-01-26 19:28:29.000000 datasets-2.9.0/src/datasets/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)   261021 2023-01-26 18:42:34.000000 datasets-2.9.0/src/datasets/arrow_dataset.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    26585 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/arrow_reader.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    33206 2023-01-03 16:07:08.000000 datasets-2.9.0/src/datasets/arrow_writer.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    97923 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/builder.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     8997 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/combine.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/commands/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      312 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/commands/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     7914 2022-02-02 14:17:14.000000 datasets-2.9.0/src/datasets/commands/convert.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1381 2022-08-18 13:40:48.000000 datasets-2.9.0/src/datasets/commands/datasets_cli.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    23107 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/commands/dummy_data.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1080 2022-03-15 10:48:49.000000 datasets-2.9.0/src/datasets/commands/env.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     6665 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/commands/run_beam.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     8120 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/commands/test.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     7958 2023-01-03 10:53:09.000000 datasets-2.9.0/src/datasets/config.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    32887 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/data_files.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    90721 2023-01-26 18:42:34.000000 datasets-2.9.0/src/datasets/dataset_dict.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1560 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/distributed.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/download/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      281 2022-08-18 13:40:48.000000 datasets-2.9.0/src/datasets/download/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3037 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/download/download_config.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    22531 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/download/download_manager.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    10447 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/download/mock_download_manager.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    45418 2023-01-26 18:42:34.000000 datasets-2.9.0/src/datasets/download/streaming_download_manager.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/features/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      447 2022-03-15 10:56:17.000000 datasets-2.9.0/src/datasets/features/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    17195 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/features/audio.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    84114 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/features/features.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    14427 2023-01-26 18:42:34.000000 datasets-2.9.0/src/datasets/features/image.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     4385 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/features/translation.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/filesystems/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     2035 2023-01-03 16:07:08.000000 datasets-2.9.0/src/datasets/filesystems/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     5718 2022-03-15 13:46:27.000000 datasets-2.9.0/src/datasets/filesystems/compression.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3108 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/filesystems/hffilesystem.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     5629 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/filesystems/s3filesystem.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    22261 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/fingerprint.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/formatting/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     5140 2023-01-03 10:53:09.000000 datasets-2.9.0/src/datasets/formatting/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    26006 2023-01-03 10:53:09.000000 datasets-2.9.0/src/datasets/formatting/formatting.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     4316 2023-01-03 10:53:09.000000 datasets-2.9.0/src/datasets/formatting/jax_formatter.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3390 2023-01-03 10:53:09.000000 datasets-2.9.0/src/datasets/formatting/np_formatter.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     4035 2023-01-03 10:53:09.000000 datasets-2.9.0/src/datasets/formatting/tf_formatter.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3866 2023-01-03 10:53:09.000000 datasets-2.9.0/src/datasets/formatting/torch_formatter.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    25415 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/info.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    20987 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/inspect.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/io/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/io/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1655 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/io/abc.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     5116 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/io/csv.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1855 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/io/generator.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     6077 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/io/json.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     4302 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/io/parquet.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     4321 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/io/sql.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     2042 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/io/text.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    81888 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/iterable_dataset.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3826 2022-08-18 13:40:48.000000 datasets-2.9.0/src/datasets/keyhash.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    86914 2023-01-26 18:42:34.000000 datasets-2.9.0/src/datasets/load.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    27992 2022-08-25 16:49:59.000000 datasets-2.9.0/src/datasets/metric.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3001 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/naming.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/packaged_modules/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     2130 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/packaged_modules/__init__.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/packaged_modules/audiofolder/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/packaged_modules/audiofolder/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1635 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/packaged_modules/audiofolder/audiofolder.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/packaged_modules/csv/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/packaged_modules/csv/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     7848 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/packaged_modules/csv/csv.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/packaged_modules/folder_based_builder/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/packaged_modules/folder_based_builder/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    22528 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/packaged_modules/folder_based_builder/folder_based_builder.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/packaged_modules/generator/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/packaged_modules/generator/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      928 2022-12-16 17:08:55.000000 datasets-2.9.0/src/datasets/packaged_modules/generator/generator.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/packaged_modules/imagefolder/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2022-03-04 13:42:32.000000 datasets-2.9.0/src/datasets/packaged_modules/imagefolder/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1977 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/packaged_modules/imagefolder/imagefolder.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/packaged_modules/json/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/packaged_modules/json/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     9006 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/packaged_modules/json/json.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/packaged_modules/pandas/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/packaged_modules/pandas/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     2302 2022-08-18 13:40:48.000000 datasets-2.9.0/src/datasets/packaged_modules/pandas/pandas.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/packaged_modules/parquet/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/packaged_modules/parquet/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3689 2023-01-25 12:30:05.000000 datasets-2.9.0/src/datasets/packaged_modules/parquet/parquet.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/packaged_modules/sql/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/packaged_modules/sql/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     4471 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/packaged_modules/sql/sql.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/packaged_modules/text/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/packaged_modules/text/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     5763 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/packaged_modules/text/text.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/py.typed
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    33528 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/search.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    23340 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/splits.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     5763 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/streaming.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    96228 2023-01-26 18:42:34.000000 datasets-2.9.0/src/datasets/table.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/tasks/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1615 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/tasks/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1297 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/tasks/audio_classificiation.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1309 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/tasks/automatic_speech_recognition.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1095 2022-02-02 14:17:14.000000 datasets-2.9.0/src/datasets/tasks/base.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1297 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/tasks/image_classification.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      581 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/tasks/language_modeling.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1105 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/tasks/question_answering.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      772 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/tasks/summarization.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     1403 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/tasks/text_classification.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/utils/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      921 2022-08-18 13:40:48.000000 datasets-2.9.0/src/datasets/utils/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     6637 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/utils/_hf_hub_fixes.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     2029 2023-01-03 16:07:08.000000 datasets-2.9.0/src/datasets/utils/beam_utils.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3452 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/utils/deprecation_utils.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      407 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/utils/doc_utils.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)       60 2022-08-18 13:40:48.000000 datasets-2.9.0/src/datasets/utils/download_manager.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    12476 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/utils/extract.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    23051 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/utils/file_utils.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    13813 2022-08-25 16:41:29.000000 datasets-2.9.0/src/datasets/utils/filelock.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      452 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/utils/hub.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3813 2022-03-01 16:20:18.000000 datasets-2.9.0/src/datasets/utils/info_utils.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     6752 2023-01-03 10:53:09.000000 datasets-2.9.0/src/datasets/utils/logging.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     5734 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/utils/metadata.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     4957 2022-08-18 13:40:48.000000 datasets-2.9.0/src/datasets/utils/patching.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    55734 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/utils/py_utils.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    12671 2022-08-18 13:40:48.000000 datasets-2.9.0/src/datasets/utils/readme.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets/utils/resources/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        0 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/utils/resources/__init__.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      257 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/utils/resources/creators.json
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)   199138 2022-11-15 16:10:47.000000 datasets-2.9.0/src/datasets/utils/resources/languages.json
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      205 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/utils/resources/multilingualities.json
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3877 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/utils/resources/readme_structure.yaml
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      171 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/utils/resources/size_categories.json
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     4291 2023-01-26 18:42:33.000000 datasets-2.9.0/src/datasets/utils/sharding.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     4091 2022-08-18 13:40:48.000000 datasets-2.9.0/src/datasets/utils/stratify.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    22843 2023-01-26 18:42:34.000000 datasets-2.9.0/src/datasets/utils/tf_utils.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)      176 2021-12-01 18:59:38.000000 datasets-2.9.0/src/datasets/utils/typing.py
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     3281 2022-12-13 15:05:54.000000 datasets-2.9.0/src/datasets/utils/version.py
+drwxr-xr-x   0 quentinlhoest   (501) staff       (20)        0 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets.egg-info/
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)    16204 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets.egg-info/PKG-INFO
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     4460 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets.egg-info/SOURCES.txt
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        1 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets.egg-info/dependency_links.txt
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)       70 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets.egg-info/entry_points.txt
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        1 2021-06-09 15:03:45.000000 datasets-2.9.0/src/datasets.egg-info/not-zip-safe
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)     2011 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets.egg-info/requires.txt
+-rw-r--r--   0 quentinlhoest   (501) staff       (20)        9 2023-01-26 19:30:06.000000 datasets-2.9.0/src/datasets.egg-info/top_level.txt
```

### Comparing `datasets-2.8.0/LICENSE` & `datasets-2.9.0/LICENSE`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/PKG-INFO` & `datasets-2.9.0/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: datasets
-Version: 2.8.0
+Version: 2.9.0
 Summary: HuggingFace community-driven open-source library of datasets
 Home-page: https://github.com/huggingface/datasets
 Author: HuggingFace Inc.
 Author-email: thomas@huggingface.co
 License: Apache 2.0
 Download-URL: https://github.com/huggingface/datasets/tags
 Description: <p align="center">
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-Metadata-Version: 2.1 Name: datasets Version: 2.8.0 Summary: HuggingFace
+Metadata-Version: 2.1 Name: datasets Version: 2.9.0 Summary: HuggingFace
 community-driven open-source library of datasets Home-page: https://github.com/
 huggingface/datasets Author: HuggingFace Inc. Author-email:
 thomas@huggingface.co License: Apache 2.0 Download-URL: https://github.com/
 huggingface/datasets/tags Description:
 
 [https://raw.githubusercontent.com/huggingface/datasets/main/docs/source/imgs/
                             datasets_logo_name.jpg]
```

### Comparing `datasets-2.8.0/README.md` & `datasets-2.9.0/README.md`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/setup.py` & `datasets-2.9.0/setup.py`

 * *Files 0% similar despite different names*

```diff
@@ -159,15 +159,15 @@
 TESTS_REQUIRE = [
     # test dependencies
     "absl-py",
     "pytest",
     "pytest-datadir",
     "pytest-xdist",
     # optional dependencies
-    "apache-beam>=2.26.0;python_version<'3.8'",  # doesn't support recent dill versions for recent python versions
+    "apache-beam>=2.26.0,<2.44.0;python_version<'3.8'",  # doesn't support recent dill versions for recent python versions
     "elasticsearch<8.0.0",  # 8.0 asks users to provide hosts or cloud_id when instantiating ElasticSearch()
     "faiss-cpu>=1.6.4",
     "lz4",
     "py7zr",
     "rarfile>=4.0",
     "s3fs>=2021.11.1;python_version<'3.8'",  # aligned with fsspec[http]>=2021.11.1; test only on python 3.7 for now
     "tensorflow>=2.3,!=2.6.0,!=2.6.1; sys_platform != 'darwin' or platform_machine != 'arm64'",
@@ -216,15 +216,15 @@
     # Might need to add doc-builder and some specific deps in the future
     "s3fs",
 ]
 
 EXTRAS_REQUIRE = {
     "audio": AUDIO_REQUIRE,
     "vision": VISION_REQUIRE,
-    "apache-beam": ["apache-beam>=2.26.0"],
+    "apache-beam": ["apache-beam>=2.26.0,<2.44.0"],
     "tensorflow": [
         "tensorflow>=2.2.0,!=2.6.0,!=2.6.1; sys_platform != 'darwin' or platform_machine != 'arm64'",
         "tensorflow-macos; sys_platform == 'darwin' and platform_machine == 'arm64'",
     ],
     "tensorflow_gpu": ["tensorflow-gpu>=2.2.0,!=2.6.0,!=2.6.1"],
     "torch": ["torch"],
     "s3": ["s3fs"],
@@ -235,15 +235,15 @@
     "quality": QUALITY_REQUIRE,
     "benchmarks": BENCHMARKS_REQUIRE,
     "docs": DOCS_REQUIRE,
 }
 
 setup(
     name="datasets",
-    version="2.8.0",  # expected format is one of x.y.z.dev0, or x.y.z.rc1 or x.y.z (no to dashes, yes to dots)
+    version="2.9.0",  # expected format is one of x.y.z.dev0, or x.y.z.rc1 or x.y.z (no to dashes, yes to dots)
     description="HuggingFace community-driven open-source library of datasets",
     long_description=open("README.md", encoding="utf-8").read(),
     long_description_content_type="text/markdown",
     author="HuggingFace Inc.",
     author_email="thomas@huggingface.co",
     url="https://github.com/huggingface/datasets",
     download_url="https://github.com/huggingface/datasets/tags",
```

### Comparing `datasets-2.8.0/src/datasets/__init__.py` & `datasets-2.9.0/src/datasets/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -13,15 +13,15 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 # Lint as: python3
 # pylint: enable=line-too-long
 # pylint: disable=g-import-not-at-top,g-bad-import-order,wrong-import-position
 
-__version__ = "2.8.0"
+__version__ = "2.9.0"
 
 import platform
 
 import pyarrow
 from packaging import version
```

### Comparing `datasets-2.8.0/src/datasets/arrow_dataset.py` & `datasets-2.9.0/src/datasets/arrow_dataset.py`

 * *Files 0% similar despite different names*

```diff
@@ -205,16141 +205,16110 @@
 00000cc0: 7265 642c 2075 6e69 7175 655f 7661 6c75  red, unique_valu
 00000cd0: 6573 0a66 726f 6d20 2e75 7469 6c73 2e73  es.from .utils.s
 00000ce0: 7472 6174 6966 7920 696d 706f 7274 2073  tratify import s
 00000cf0: 7472 6174 6966 6965 645f 7368 7566 666c  tratified_shuffl
 00000d00: 655f 7370 6c69 745f 6765 6e65 7261 7465  e_split_generate
 00000d10: 5f69 6e64 6963 6573 0a66 726f 6d20 2e75  _indices.from .u
 00000d20: 7469 6c73 2e74 665f 7574 696c 7320 696d  tils.tf_utils im
-00000d30: 706f 7274 206d 696e 696d 616c 5f74 665f  port minimal_tf_
-00000d40: 636f 6c6c 6174 655f 666e 0a66 726f 6d20  collate_fn.from 
-00000d50: 2e75 7469 6c73 2e74 7970 696e 6720 696d  .utils.typing im
-00000d60: 706f 7274 2050 6174 684c 696b 650a 0a0a  port PathLike...
-00000d70: 6966 2054 5950 455f 4348 4543 4b49 4e47  if TYPE_CHECKING
-00000d80: 3a0a 2020 2020 696d 706f 7274 2073 716c  :.    import sql
-00000d90: 6974 6533 0a0a 2020 2020 696d 706f 7274  ite3..    import
-00000da0: 2073 716c 616c 6368 656d 790a 0a20 2020   sqlalchemy..   
-00000db0: 2066 726f 6d20 2e64 6174 6173 6574 5f64   from .dataset_d
-00000dc0: 6963 7420 696d 706f 7274 2044 6174 6173  ict import Datas
-00000dd0: 6574 4469 6374 0a0a 6c6f 6767 6572 203d  etDict..logger =
-00000de0: 206c 6f67 6769 6e67 2e67 6574 5f6c 6f67   logging.get_log
-00000df0: 6765 7228 5f5f 6e61 6d65 5f5f 290a 0a0a  ger(__name__)...
-00000e00: 636c 6173 7320 4461 7461 7365 7449 6e66  class DatasetInf
-00000e10: 6f4d 6978 696e 3a0a 2020 2020 2222 2254  oMixin:.    """T
-00000e20: 6869 7320 6261 7365 2063 6c61 7373 2065  his base class e
-00000e30: 7870 6f73 6573 2073 6f6d 6520 6174 7472  xposes some attr
-00000e40: 6962 7574 6573 206f 6620 4461 7461 7365  ibutes of Datase
-00000e50: 7449 6e66 6f0a 2020 2020 6174 2074 6865  tInfo.    at the
-00000e60: 2062 6173 6520 6c65 7665 6c20 6f66 2074   base level of t
-00000e70: 6865 2044 6174 6173 6574 2066 6f72 2065  he Dataset for e
-00000e80: 6173 7920 6163 6365 7373 2e0a 2020 2020  asy access..    
-00000e90: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-00000ea0: 6e69 745f 5f28 7365 6c66 2c20 696e 666f  nit__(self, info
-00000eb0: 3a20 4461 7461 7365 7449 6e66 6f2c 2073  : DatasetInfo, s
-00000ec0: 706c 6974 3a20 4f70 7469 6f6e 616c 5b4e  plit: Optional[N
-00000ed0: 616d 6564 5370 6c69 745d 293a 0a20 2020  amedSplit]):.   
-00000ee0: 2020 2020 2073 656c 662e 5f69 6e66 6f20       self._info 
-00000ef0: 3d20 696e 666f 0a20 2020 2020 2020 2073  = info.        s
-00000f00: 656c 662e 5f73 706c 6974 203d 2073 706c  elf._split = spl
-00000f10: 6974 0a0a 2020 2020 4070 726f 7065 7274  it..    @propert
-00000f20: 790a 2020 2020 6465 6620 696e 666f 2873  y.    def info(s
-00000f30: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00000f40: 225b 607e 6461 7461 7365 7473 2e44 6174  "[`~datasets.Dat
-00000f50: 6173 6574 496e 666f 605d 206f 626a 6563  asetInfo`] objec
-00000f60: 7420 636f 6e74 6169 6e69 6e67 2061 6c6c  t containing all
-00000f70: 2074 6865 206d 6574 6164 6174 6120 696e   the metadata in
-00000f80: 2074 6865 2064 6174 6173 6574 2e22 2222   the dataset."""
-00000f90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00000fa0: 7365 6c66 2e5f 696e 666f 0a0a 2020 2020  self._info..    
-00000fb0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00000fc0: 6620 7370 6c69 7428 7365 6c66 293a 0a20  f split(self):. 
-00000fd0: 2020 2020 2020 2022 2222 5b60 7e64 6174         """[`~dat
-00000fe0: 6173 6574 732e 4e61 6d65 6453 706c 6974  asets.NamedSplit
-00000ff0: 605d 206f 626a 6563 7420 636f 7272 6573  `] object corres
-00001000: 706f 6e64 696e 6720 746f 2061 206e 616d  ponding to a nam
-00001010: 6564 2064 6174 6173 6574 2073 706c 6974  ed dataset split
-00001020: 2e22 2222 0a20 2020 2020 2020 2072 6574  .""".        ret
-00001030: 7572 6e20 7365 6c66 2e5f 7370 6c69 740a  urn self._split.
-00001040: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00001050: 2020 2064 6566 2062 7569 6c64 6572 5f6e     def builder_n
-00001060: 616d 6528 7365 6c66 2920 2d3e 2073 7472  ame(self) -> str
-00001070: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00001080: 2073 656c 662e 5f69 6e66 6f2e 6275 696c   self._info.buil
-00001090: 6465 725f 6e61 6d65 0a0a 2020 2020 4070  der_name..    @p
-000010a0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-000010b0: 6369 7461 7469 6f6e 2873 656c 6629 202d  citation(self) -
-000010c0: 3e20 7374 723a 0a20 2020 2020 2020 2072  > str:.        r
-000010d0: 6574 7572 6e20 7365 6c66 2e5f 696e 666f  eturn self._info
-000010e0: 2e63 6974 6174 696f 6e0a 0a20 2020 2040  .citation..    @
-000010f0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00001100: 2063 6f6e 6669 675f 6e61 6d65 2873 656c   config_name(sel
-00001110: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
-00001120: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00001130: 696e 666f 2e63 6f6e 6669 675f 6e61 6d65  info.config_name
-00001140: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00001150: 2020 2020 6465 6620 6461 7461 7365 745f      def dataset_
-00001160: 7369 7a65 2873 656c 6629 202d 3e20 4f70  size(self) -> Op
-00001170: 7469 6f6e 616c 5b69 6e74 5d3a 0a20 2020  tional[int]:.   
-00001180: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00001190: 2e5f 696e 666f 2e64 6174 6173 6574 5f73  ._info.dataset_s
-000011a0: 697a 650a 0a20 2020 2040 7072 6f70 6572  ize..    @proper
-000011b0: 7479 0a20 2020 2064 6566 2064 6573 6372  ty.    def descr
-000011c0: 6970 7469 6f6e 2873 656c 6629 202d 3e20  iption(self) -> 
-000011d0: 7374 723a 0a20 2020 2020 2020 2072 6574  str:.        ret
-000011e0: 7572 6e20 7365 6c66 2e5f 696e 666f 2e64  urn self._info.d
-000011f0: 6573 6372 6970 7469 6f6e 0a0a 2020 2020  escription..    
-00001200: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00001210: 6620 646f 776e 6c6f 6164 5f63 6865 636b  f download_check
-00001220: 7375 6d73 2873 656c 6629 202d 3e20 4f70  sums(self) -> Op
-00001230: 7469 6f6e 616c 5b64 6963 745d 3a0a 2020  tional[dict]:.  
-00001240: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00001250: 662e 5f69 6e66 6f2e 646f 776e 6c6f 6164  f._info.download
-00001260: 5f63 6865 636b 7375 6d73 0a0a 2020 2020  _checksums..    
-00001270: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00001280: 6620 646f 776e 6c6f 6164 5f73 697a 6528  f download_size(
-00001290: 7365 6c66 2920 2d3e 204f 7074 696f 6e61  self) -> Optiona
-000012a0: 6c5b 696e 745d 3a0a 2020 2020 2020 2020  l[int]:.        
-000012b0: 7265 7475 726e 2073 656c 662e 5f69 6e66  return self._inf
-000012c0: 6f2e 646f 776e 6c6f 6164 5f73 697a 650a  o.download_size.
-000012d0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-000012e0: 2020 2064 6566 2066 6561 7475 7265 7328     def features(
-000012f0: 7365 6c66 2920 2d3e 2046 6561 7475 7265  self) -> Feature
-00001300: 733a 0a20 2020 2020 2020 2072 6574 7572  s:.        retur
-00001310: 6e20 7365 6c66 2e5f 696e 666f 2e66 6561  n self._info.fea
-00001320: 7475 7265 730a 0a20 2020 2040 7072 6f70  tures..    @prop
-00001330: 6572 7479 0a20 2020 2064 6566 2068 6f6d  erty.    def hom
-00001340: 6570 6167 6528 7365 6c66 2920 2d3e 204f  epage(self) -> O
-00001350: 7074 696f 6e61 6c5b 7374 725d 3a0a 2020  ptional[str]:.  
-00001360: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00001370: 662e 5f69 6e66 6f2e 686f 6d65 7061 6765  f._info.homepage
-00001380: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00001390: 2020 2020 6465 6620 6c69 6365 6e73 6528      def license(
-000013a0: 7365 6c66 2920 2d3e 204f 7074 696f 6e61  self) -> Optiona
-000013b0: 6c5b 7374 725d 3a0a 2020 2020 2020 2020  l[str]:.        
-000013c0: 7265 7475 726e 2073 656c 662e 5f69 6e66  return self._inf
-000013d0: 6f2e 6c69 6365 6e73 650a 0a20 2020 2040  o.license..    @
-000013e0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-000013f0: 2073 697a 655f 696e 5f62 7974 6573 2873   size_in_bytes(s
-00001400: 656c 6629 202d 3e20 4f70 7469 6f6e 616c  elf) -> Optional
-00001410: 5b69 6e74 5d3a 0a20 2020 2020 2020 2072  [int]:.        r
-00001420: 6574 7572 6e20 7365 6c66 2e5f 696e 666f  eturn self._info
-00001430: 2e73 697a 655f 696e 5f62 7974 6573 0a0a  .size_in_bytes..
-00001440: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-00001450: 2020 6465 6620 7375 7065 7276 6973 6564    def supervised
-00001460: 5f6b 6579 7328 7365 6c66 293a 0a20 2020  _keys(self):.   
-00001470: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00001480: 2e5f 696e 666f 2e73 7570 6572 7669 7365  ._info.supervise
-00001490: 645f 6b65 7973 0a0a 2020 2020 4070 726f  d_keys..    @pro
-000014a0: 7065 7274 790a 2020 2020 6465 6620 7461  perty.    def ta
-000014b0: 736b 5f74 656d 706c 6174 6573 2873 656c  sk_templates(sel
-000014c0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-000014d0: 726e 2073 656c 662e 5f69 6e66 6f2e 7461  rn self._info.ta
-000014e0: 736b 5f74 656d 706c 6174 6573 0a0a 2020  sk_templates..  
-000014f0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00001500: 6465 6620 7665 7273 696f 6e28 7365 6c66  def version(self
-00001510: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00001520: 6e20 7365 6c66 2e5f 696e 666f 2e76 6572  n self._info.ver
-00001530: 7369 6f6e 0a0a 0a63 6c61 7373 2054 656e  sion...class Ten
-00001540: 736f 7266 6c6f 7744 6174 6173 6574 4d69  sorflowDatasetMi
-00001550: 7869 6e3a 0a20 2020 205f 5446 5f44 4154  xin:.    _TF_DAT
-00001560: 4153 4554 5f52 4546 5320 3d20 7365 7428  ASET_REFS = set(
-00001570: 290a 0a20 2020 2040 7374 6174 6963 6d65  )..    @staticme
-00001580: 7468 6f64 0a20 2020 2064 6566 205f 6765  thod.    def _ge
-00001590: 745f 6f75 7470 7574 5f73 6967 6e61 7475  t_output_signatu
-000015a0: 7265 280a 2020 2020 2020 2020 6461 7461  re(.        data
-000015b0: 7365 743a 2022 4461 7461 7365 7422 2c0a  set: "Dataset",.
-000015c0: 2020 2020 2020 2020 636f 6c6c 6174 655f          collate_
-000015d0: 666e 3a20 4361 6c6c 6162 6c65 2c0a 2020  fn: Callable,.  
-000015e0: 2020 2020 2020 636f 6c6c 6174 655f 666e        collate_fn
-000015f0: 5f61 7267 733a 2064 6963 742c 0a20 2020  _args: dict,.   
-00001600: 2020 2020 2063 6f6c 735f 746f 5f72 6574       cols_to_ret
-00001610: 6169 6e3a 204f 7074 696f 6e61 6c5b 4c69  ain: Optional[Li
-00001620: 7374 5b73 7472 5d5d 203d 204e 6f6e 652c  st[str]] = None,
-00001630: 0a20 2020 2020 2020 2062 6174 6368 5f73  .        batch_s
-00001640: 697a 653a 204f 7074 696f 6e61 6c5b 696e  ize: Optional[in
-00001650: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
-00001660: 2020 206e 756d 5f74 6573 745f 6261 7463     num_test_batc
-00001670: 6865 733a 2069 6e74 203d 2032 3030 2c0a  hes: int = 200,.
-00001680: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-00001690: 2222 5072 6976 6174 6520 6d65 7468 6f64  ""Private method
-000016a0: 2075 7365 6420 6279 2060 746f 5f74 665f   used by `to_tf_
-000016b0: 6461 7461 7365 7428 2960 2074 6f20 6669  dataset()` to fi
-000016c0: 6e64 2074 6865 2073 6861 7065 7320 616e  nd the shapes an
-000016d0: 6420 6474 7970 6573 206f 6620 7361 6d70  d dtypes of samp
-000016e0: 6c65 7320 6672 6f6d 2074 6869 7320 6461  les from this da
-000016f0: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
-00001700: 2061 6674 6572 2062 6569 6e67 2070 6173   after being pas
-00001710: 7365 6420 7468 726f 7567 6820 7468 6520  sed through the 
-00001720: 636f 6c6c 6174 655f 666e 2e20 5465 6e73  collate_fn. Tens
-00001730: 6f72 666c 6f77 206e 6565 6473 2061 6e20  orflow needs an 
-00001740: 6578 6163 7420 7369 676e 6174 7572 6520  exact signature 
-00001750: 666f 7220 7466 2e6e 756d 7079 5f66 756e  for tf.numpy_fun
-00001760: 6374 696f 6e2c 2073 6f0a 2020 2020 2020  ction, so.      
-00001770: 2020 2020 2074 6865 206f 6e6c 7920 7761       the only wa
-00001780: 7920 746f 2064 6f20 7468 6973 2069 7320  y to do this is 
-00001790: 746f 2072 756e 2074 6573 7420 6261 7463  to run test batc
-000017a0: 6865 7320 2d20 7468 6520 636f 6c6c 6174  hes - the collat
-000017b0: 6f72 206d 6179 2061 6464 206f 7220 7265  or may add or re
-000017c0: 6e61 6d65 2063 6f6c 756d 6e73 2c20 736f  name columns, so
-000017d0: 2077 6520 6361 6e27 7420 6669 6775 7265   we can't figure
-000017e0: 0a20 2020 2020 2020 2020 2020 6974 206f  .           it o
-000017f0: 7574 206a 7573 7420 6279 2069 6e73 7065  ut just by inspe
-00001800: 6374 696e 6720 7468 6520 6461 7461 7365  cting the datase
-00001810: 742e 0a0a 2020 2020 2020 2020 4172 6773  t...        Args
-00001820: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
-00001830: 7461 7365 7420 2860 4461 7461 7365 7460  taset (`Dataset`
-00001840: 293a 2044 6174 6173 6574 2074 6f20 6c6f  ): Dataset to lo
-00001850: 6164 2073 616d 706c 6573 2066 726f 6d2e  ad samples from.
-00001860: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00001870: 6c61 7465 5f66 6e28 6062 6f6f 6c60 293a  late_fn(`bool`):
-00001880: 2053 6875 6666 6c65 2074 6865 2064 6174   Shuffle the dat
-00001890: 6173 6574 206f 7264 6572 2077 6865 6e20  aset order when 
-000018a0: 6c6f 6164 696e 672e 2052 6563 6f6d 6d65  loading. Recomme
-000018b0: 6e64 6564 2054 7275 6520 666f 7220 7472  nded True for tr
-000018c0: 6169 6e69 6e67 2c20 4661 6c73 6520 666f  aining, False fo
-000018d0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-000018e0: 2020 7661 6c69 6461 7469 6f6e 2f65 7661    validation/eva
-000018f0: 6c75 6174 696f 6e2e 0a20 2020 2020 2020  luation..       
-00001900: 2020 2020 2063 6f6c 6c61 7465 5f66 6e28       collate_fn(
-00001910: 6043 616c 6c61 626c 6560 293a 2041 2066  `Callable`): A f
-00001920: 756e 6374 696f 6e20 6f72 2063 616c 6c61  unction or calla
-00001930: 626c 6520 6f62 6a65 6374 2028 7375 6368  ble object (such
-00001940: 2061 7320 6120 6044 6174 6143 6f6c 6c61   as a `DataColla
-00001950: 746f 7260 2920 7468 6174 2077 696c 6c20  tor`) that will 
-00001960: 636f 6c6c 6174 650a 2020 2020 2020 2020  collate.        
-00001970: 2020 2020 2020 2020 6c69 7374 7320 6f66          lists of
-00001980: 2073 616d 706c 6573 2069 6e74 6f20 6120   samples into a 
-00001990: 6261 7463 682e 0a20 2020 2020 2020 2020  batch..         
-000019a0: 2020 2063 6f6c 6c61 7465 5f66 6e5f 6172     collate_fn_ar
-000019b0: 6773 2028 6044 6963 7460 293a 2041 2060  gs (`Dict`): A `
-000019c0: 6469 6374 6020 6f66 206b 6579 776f 7264  dict` of keyword
-000019d0: 2061 7267 756d 656e 7473 2074 6f20 6265   arguments to be
-000019e0: 2070 6173 7365 6420 746f 2074 6865 0a20   passed to the. 
-000019f0: 2020 2020 2020 2020 2020 2020 2020 2060                 `
-00001a00: 636f 6c6c 6174 655f 666e 602e 0a20 2020  collate_fn`..   
-00001a10: 2020 2020 2020 2020 2062 6174 6368 5f73           batch_s
-00001a20: 697a 6520 2860 696e 7460 2c20 6f70 7469  ize (`int`, opti
-00001a30: 6f6e 616c 293a 2054 6865 2073 697a 6520  onal): The size 
-00001a40: 6f66 2062 6174 6368 6573 206c 6f61 6465  of batches loade
-00001a50: 6420 6672 6f6d 2074 6865 2064 6174 6173  d from the datas
-00001a60: 6574 2e20 5573 6564 2066 6f72 2073 6861  et. Used for sha
-00001a70: 7065 2069 6e66 6572 656e 6365 2e0a 2020  pe inference..  
-00001a80: 2020 2020 2020 2020 2020 2020 2020 4361                Ca
-00001a90: 6e20 6265 204e 6f6e 652c 2077 6869 6368  n be None, which
-00001aa0: 2069 6e64 6963 6174 6573 2074 6861 7420   indicates that 
-00001ab0: 6261 7463 6820 7369 7a65 7320 6361 6e20  batch sizes can 
-00001ac0: 6265 2076 6172 6961 626c 652e 0a20 2020  be variable..   
-00001ad0: 2020 2020 2020 2020 206e 756d 5f74 6573           num_tes
-00001ae0: 745f 6261 7463 6865 7320 2860 696e 7460  t_batches (`int`
-00001af0: 293a 2054 6865 206e 756d 6265 7220 6f66  ): The number of
-00001b00: 2062 6174 6368 6573 2074 6f20 6c6f 6164   batches to load
-00001b10: 2066 726f 6d20 7468 6520 6461 7461 7365   from the datase
-00001b20: 7420 666f 7220 7368 6170 6520 696e 6665  t for shape infe
-00001b30: 7265 6e63 652e 0a0a 2020 2020 2020 2020  rence...        
-00001b40: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
-00001b50: 2020 2020 2060 6469 6374 603a 2044 6963       `dict`: Dic
-00001b60: 7420 6d61 7070 696e 6720 636f 6c75 6d6e  t mapping column
-00001b70: 206e 616d 6573 2074 6f20 7466 2e54 656e   names to tf.Ten
-00001b80: 736f 7273 7065 6320 6f62 6a65 6374 730a  sorspec objects.
-00001b90: 2020 2020 2020 2020 2020 2020 6064 6963              `dic
-00001ba0: 7460 3a20 4469 6374 206d 6170 7069 6e67  t`: Dict mapping
-00001bb0: 2063 6f6c 756d 6e20 6e61 6d65 7320 746f   column names to
-00001bc0: 206e 702e 6474 7970 6520 6f62 6a65 6374   np.dtype object
-00001bd0: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
-00001be0: 2020 2020 2020 6966 2063 6f6e 6669 672e        if config.
-00001bf0: 5446 5f41 5641 494c 4142 4c45 3a0a 2020  TF_AVAILABLE:.  
-00001c00: 2020 2020 2020 2020 2020 696d 706f 7274            import
-00001c10: 2074 656e 736f 7266 6c6f 7720 6173 2074   tensorflow as t
-00001c20: 660a 2020 2020 2020 2020 656c 7365 3a0a  f.        else:.
-00001c30: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00001c40: 6520 496d 706f 7274 4572 726f 7228 2243  e ImportError("C
-00001c50: 616c 6c65 6420 6120 5465 6e73 6f72 666c  alled a Tensorfl
-00001c60: 6f77 2d73 7065 6369 6669 6320 6675 6e63  ow-specific func
-00001c70: 7469 6f6e 2062 7574 2054 656e 736f 7266  tion but Tensorf
-00001c80: 6c6f 7720 6973 206e 6f74 2069 6e73 7461  low is not insta
-00001c90: 6c6c 6564 2e22 290a 0a20 2020 2020 2020  lled.")..       
-00001ca0: 2069 6620 6c65 6e28 6461 7461 7365 7429   if len(dataset)
-00001cb0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00001cc0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00001cd0: 726f 7228 2255 6e61 626c 6520 746f 2067  ror("Unable to g
-00001ce0: 6574 2074 6865 206f 7574 7075 7420 7369  et the output si
-00001cf0: 676e 6174 7572 6520 6265 6361 7573 6520  gnature because 
-00001d00: 7468 6520 6461 7461 7365 7420 6973 2065  the dataset is e
-00001d10: 6d70 7479 2e22 290a 2020 2020 2020 2020  mpty.").        
-00001d20: 6966 2062 6174 6368 5f73 697a 6520 6973  if batch_size is
-00001d30: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00001d40: 2020 2020 2020 2062 6174 6368 5f73 697a         batch_siz
-00001d50: 6520 3d20 6d69 6e28 6c65 6e28 6461 7461  e = min(len(data
-00001d60: 7365 7429 2c20 6261 7463 685f 7369 7a65  set), batch_size
-00001d70: 290a 2020 2020 2020 2020 7465 7374 5f62  ).        test_b
-00001d80: 6174 6368 5f73 697a 6520 3d20 6d69 6e28  atch_size = min(
-00001d90: 6c65 6e28 6461 7461 7365 7429 2c20 3229  len(dataset), 2)
-00001da0: 0a0a 2020 2020 2020 2020 6966 2063 6f6c  ..        if col
-00001db0: 735f 746f 5f72 6574 6169 6e20 6973 206e  s_to_retain is n
-00001dc0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00001dd0: 2020 2020 2063 6f6c 735f 746f 5f72 6574       cols_to_ret
-00001de0: 6169 6e20 3d20 6c69 7374 2873 6574 2863  ain = list(set(c
-00001df0: 6f6c 735f 746f 5f72 6574 6169 6e20 2b20  ols_to_retain + 
-00001e00: 5b22 6c61 6265 6c5f 6964 7322 2c20 226c  ["label_ids", "l
-00001e10: 6162 656c 222c 2022 6c61 6265 6c73 225d  abel", "labels"]
-00001e20: 2929 0a0a 2020 2020 2020 2020 7465 7374  ))..        test
-00001e30: 5f62 6174 6368 6573 203d 205b 5d0a 2020  _batches = [].  
-00001e40: 2020 2020 2020 666f 7220 5f20 696e 2072        for _ in r
-00001e50: 616e 6765 286e 756d 5f74 6573 745f 6261  ange(num_test_ba
-00001e60: 7463 6865 7329 3a0a 2020 2020 2020 2020  tches):.        
-00001e70: 2020 2020 696e 6469 6365 7320 3d20 7361      indices = sa
-00001e80: 6d70 6c65 2872 616e 6765 286c 656e 2864  mple(range(len(d
-00001e90: 6174 6173 6574 2929 2c20 7465 7374 5f62  ataset)), test_b
-00001ea0: 6174 6368 5f73 697a 6529 0a20 2020 2020  atch_size).     
-00001eb0: 2020 2020 2020 2074 6573 745f 6261 7463         test_batc
-00001ec0: 6820 3d20 6461 7461 7365 745b 696e 6469  h = dataset[indi
-00001ed0: 6365 735d 0a20 2020 2020 2020 2020 2020  ces].           
-00001ee0: 2069 6620 636f 6c73 5f74 6f5f 7265 7461   if cols_to_reta
-00001ef0: 696e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  in is not None:.
-00001f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f10: 7465 7374 5f62 6174 6368 203d 207b 6b65  test_batch = {ke
-00001f20: 793a 2076 616c 7565 2066 6f72 206b 6579  y: value for key
-00001f30: 2c20 7661 6c75 6520 696e 2074 6573 745f  , value in test_
-00001f40: 6261 7463 682e 6974 656d 7328 2920 6966  batch.items() if
-00001f50: 206b 6579 2069 6e20 636f 6c73 5f74 6f5f   key in cols_to_
-00001f60: 7265 7461 696e 7d0a 2020 2020 2020 2020  retain}.        
-00001f70: 2020 2020 7465 7374 5f62 6174 6368 203d      test_batch =
-00001f80: 205b 7b6b 6579 3a20 7661 6c75 655b 695d   [{key: value[i]
-00001f90: 2066 6f72 206b 6579 2c20 7661 6c75 6520   for key, value 
-00001fa0: 696e 2074 6573 745f 6261 7463 682e 6974  in test_batch.it
-00001fb0: 656d 7328 297d 2066 6f72 2069 2069 6e20  ems()} for i in 
-00001fc0: 7261 6e67 6528 7465 7374 5f62 6174 6368  range(test_batch
-00001fd0: 5f73 697a 6529 5d0a 2020 2020 2020 2020  _size)].        
-00001fe0: 2020 2020 7465 7374 5f62 6174 6368 203d      test_batch =
-00001ff0: 2063 6f6c 6c61 7465 5f66 6e28 7465 7374   collate_fn(test
-00002000: 5f62 6174 6368 2c20 2a2a 636f 6c6c 6174  _batch, **collat
-00002010: 655f 666e 5f61 7267 7329 0a20 2020 2020  e_fn_args).     
-00002020: 2020 2020 2020 2074 6573 745f 6261 7463         test_batc
-00002030: 6865 732e 6170 7065 6e64 2874 6573 745f  hes.append(test_
-00002040: 6261 7463 6829 0a0a 2020 2020 2020 2020  batch)..        
-00002050: 7466 5f63 6f6c 756d 6e73 5f74 6f5f 7369  tf_columns_to_si
-00002060: 676e 6174 7572 6573 203d 207b 7d0a 2020  gnatures = {}.  
-00002070: 2020 2020 2020 6e70 5f63 6f6c 756d 6e73        np_columns
-00002080: 5f74 6f5f 6474 7970 6573 203d 207b 7d0a  _to_dtypes = {}.
-00002090: 2020 2020 2020 2020 666f 7220 636f 6c75          for colu
-000020a0: 6d6e 2069 6e20 7465 7374 5f62 6174 6368  mn in test_batch
-000020b0: 6573 5b30 5d2e 6b65 7973 2829 3a0a 2020  es[0].keys():.  
-000020c0: 2020 2020 2020 2020 2020 7261 775f 6172            raw_ar
-000020d0: 7261 7973 203d 205b 6261 7463 685b 636f  rays = [batch[co
-000020e0: 6c75 6d6e 5d20 666f 7220 6261 7463 6820  lumn] for batch 
-000020f0: 696e 2074 6573 745f 6261 7463 6865 735d  in test_batches]
-00002100: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-00002110: 6e20 6361 7365 2074 6865 2063 6f6c 6c61  n case the colla
-00002120: 7465 5f66 6e20 7265 7475 726e 7320 736f  te_fn returns so
-00002130: 6d65 7468 696e 6720 7374 7261 6e67 650a  mething strange.
-00002140: 2020 2020 2020 2020 2020 2020 6e70 5f61              np_a
-00002150: 7272 6179 7320 3d20 5b5d 0a20 2020 2020  rrays = [].     
-00002160: 2020 2020 2020 2066 6f72 2061 7272 6179         for array
-00002170: 2069 6e20 7261 775f 6172 7261 7973 3a0a   in raw_arrays:.
-00002180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002190: 6966 2069 7369 6e73 7461 6e63 6528 6172  if isinstance(ar
-000021a0: 7261 792c 206e 702e 6e64 6172 7261 7929  ray, np.ndarray)
-000021b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000021c0: 2020 2020 2020 6e70 5f61 7272 6179 732e        np_arrays.
-000021d0: 6170 7065 6e64 2861 7272 6179 290a 2020  append(array).  
-000021e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000021f0: 6966 2069 7369 6e73 7461 6e63 6528 6172  if isinstance(ar
-00002200: 7261 792c 2074 662e 5465 6e73 6f72 293a  ray, tf.Tensor):
-00002210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002220: 2020 2020 206e 705f 6172 7261 7973 2e61       np_arrays.a
-00002230: 7070 656e 6428 6172 7261 792e 6e75 6d70  ppend(array.nump
-00002240: 7928 2929 0a20 2020 2020 2020 2020 2020  y()).           
-00002250: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00002260: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00002270: 705f 6172 7261 7973 2e61 7070 656e 6428  p_arrays.append(
-00002280: 6e70 2e61 7272 6179 2861 7272 6179 2929  np.array(array))
-00002290: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000022a0: 206e 702e 6973 7375 6264 7479 7065 286e   np.issubdtype(n
-000022b0: 705f 6172 7261 7973 5b30 5d2e 6474 7970  p_arrays[0].dtyp
-000022c0: 652c 206e 702e 696e 7465 6765 7229 206f  e, np.integer) o
-000022d0: 7220 6e70 5f61 7272 6179 735b 305d 2e64  r np_arrays[0].d
-000022e0: 7479 7065 203d 3d20 626f 6f6c 3a0a 2020  type == bool:.  
-000022f0: 2020 2020 2020 2020 2020 2020 2020 7466                tf
-00002300: 5f64 7479 7065 203d 2074 662e 696e 7436  _dtype = tf.int6
-00002310: 340a 2020 2020 2020 2020 2020 2020 2020  4.              
-00002320: 2020 6e70 5f64 7479 7065 203d 206e 702e    np_dtype = np.
-00002330: 696e 7436 340a 2020 2020 2020 2020 2020  int64.          
-00002340: 2020 656c 6966 206e 702e 6973 7375 6264    elif np.issubd
-00002350: 7479 7065 286e 705f 6172 7261 7973 5b30  type(np_arrays[0
-00002360: 5d2e 6474 7970 652c 206e 702e 6e75 6d62  ].dtype, np.numb
-00002370: 6572 293a 0a20 2020 2020 2020 2020 2020  er):.           
-00002380: 2020 2020 2074 665f 6474 7970 6520 3d20       tf_dtype = 
-00002390: 7466 2e66 6c6f 6174 3332 0a20 2020 2020  tf.float32.     
-000023a0: 2020 2020 2020 2020 2020 206e 705f 6474             np_dt
-000023b0: 7970 6520 3d20 6e70 2e66 6c6f 6174 3332  ype = np.float32
-000023c0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-000023d0: 6620 6e70 5f61 7272 6179 735b 305d 2e64  f np_arrays[0].d
-000023e0: 7479 7065 2e6b 696e 6420 3d3d 2022 5522  type.kind == "U"
-000023f0: 3a20 2023 2055 6e69 636f 6465 2073 7472  :  # Unicode str
-00002400: 696e 6773 0a20 2020 2020 2020 2020 2020  ings.           
-00002410: 2020 2020 206e 705f 6474 7970 6520 3d20       np_dtype = 
-00002420: 6e70 2e75 6e69 636f 6465 5f0a 2020 2020  np.unicode_.    
-00002430: 2020 2020 2020 2020 2020 2020 7466 5f64              tf_d
-00002440: 7479 7065 203d 2074 662e 7374 7269 6e67  type = tf.string
-00002450: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00002460: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00002470: 2020 2072 6169 7365 2052 756e 7469 6d65     raise Runtime
-00002480: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00002490: 2020 2020 2020 2020 2020 2066 2255 6e72             f"Unr
-000024a0: 6563 6f67 6e69 7a65 6420 6172 7261 7920  ecognized array 
-000024b0: 6474 7970 6520 7b6e 705f 6172 7261 7973  dtype {np_arrays
-000024c0: 5b30 5d2e 6474 7970 657d 2e20 5c6e 220a  [0].dtype}. \n".
-000024d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024e0: 2020 2020 224e 6573 7465 6420 7479 7065      "Nested type
-000024f0: 7320 616e 6420 696d 6167 652f 6175 6469  s and image/audi
-00002500: 6f20 7479 7065 7320 6172 6520 6e6f 7420  o types are not 
-00002510: 7375 7070 6f72 7465 6420 7965 742e 220a  supported yet.".
-00002520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002530: 290a 2020 2020 2020 2020 2020 2020 7368  ).            sh
-00002540: 6170 6573 203d 205b 6172 7261 792e 7368  apes = [array.sh
-00002550: 6170 6520 666f 7220 6172 7261 7920 696e  ape for array in
-00002560: 206e 705f 6172 7261 7973 5d0a 2020 2020   np_arrays].    
-00002570: 2020 2020 2020 2020 7374 6174 6963 5f73          static_s
-00002580: 6861 7065 203d 205b 5d0a 2020 2020 2020  hape = [].      
-00002590: 2020 2020 2020 666f 7220 6469 6d20 696e        for dim in
-000025a0: 2072 616e 6765 286c 656e 2873 6861 7065   range(len(shape
-000025b0: 735b 305d 2929 3a0a 2020 2020 2020 2020  s[0])):.        
-000025c0: 2020 2020 2020 2020 7369 7a65 7320 3d20          sizes = 
-000025d0: 7365 7428 5b73 6861 7065 5b64 696d 5d20  set([shape[dim] 
-000025e0: 666f 7220 7368 6170 6520 696e 2073 6861  for shape in sha
-000025f0: 7065 735d 290a 2020 2020 2020 2020 2020  pes]).          
-00002600: 2020 2020 2020 6966 2064 696d 203d 3d20        if dim == 
-00002610: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00002620: 2020 2020 2020 2073 7461 7469 635f 7368         static_sh
-00002630: 6170 652e 6170 7065 6e64 2862 6174 6368  ape.append(batch
-00002640: 5f73 697a 6529 0a20 2020 2020 2020 2020  _size).         
-00002650: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00002660: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00002670: 2020 2020 6966 206c 656e 2873 697a 6573      if len(sizes
-00002680: 2920 3d3d 2031 3a20 2023 2054 6869 7320  ) == 1:  # This 
-00002690: 6469 6d65 6e73 696f 6e20 6c6f 6f6b 7320  dimension looks 
-000026a0: 636f 6e73 7461 6e74 0a20 2020 2020 2020  constant.       
-000026b0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-000026c0: 7469 635f 7368 6170 652e 6170 7065 6e64  tic_shape.append
-000026d0: 2873 697a 6573 2e70 6f70 2829 290a 2020  (sizes.pop()).  
-000026e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000026f0: 7365 3a20 2023 2055 7365 204e 6f6e 6520  se:  # Use None 
-00002700: 666f 7220 7661 7269 6162 6c65 2064 696d  for variable dim
-00002710: 656e 7369 6f6e 730a 2020 2020 2020 2020  ensions.        
-00002720: 2020 2020 2020 2020 2020 2020 7374 6174              stat
-00002730: 6963 5f73 6861 7065 2e61 7070 656e 6428  ic_shape.append(
-00002740: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
-00002750: 2020 7466 5f63 6f6c 756d 6e73 5f74 6f5f    tf_columns_to_
-00002760: 7369 676e 6174 7572 6573 5b63 6f6c 756d  signatures[colum
-00002770: 6e5d 203d 2074 662e 5465 6e73 6f72 5370  n] = tf.TensorSp
-00002780: 6563 2873 6861 7065 3d73 7461 7469 635f  ec(shape=static_
-00002790: 7368 6170 652c 2064 7479 7065 3d74 665f  shape, dtype=tf_
-000027a0: 6474 7970 6529 0a20 2020 2020 2020 2020  dtype).         
-000027b0: 2020 206e 705f 636f 6c75 6d6e 735f 746f     np_columns_to
-000027c0: 5f64 7479 7065 735b 636f 6c75 6d6e 5d20  _dtypes[column] 
-000027d0: 3d20 6e70 5f64 7479 7065 0a0a 2020 2020  = np_dtype..    
-000027e0: 2020 2020 7265 7475 726e 2074 665f 636f      return tf_co
-000027f0: 6c75 6d6e 735f 746f 5f73 6967 6e61 7475  lumns_to_signatu
-00002800: 7265 732c 206e 705f 636f 6c75 6d6e 735f  res, np_columns_
-00002810: 746f 5f64 7479 7065 730a 0a20 2020 2064  to_dtypes..    d
-00002820: 6566 2074 6f5f 7466 5f64 6174 6173 6574  ef to_tf_dataset
-00002830: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00002840: 2020 2020 2020 2020 6261 7463 685f 7369          batch_si
-00002850: 7a65 3a20 696e 742c 0a20 2020 2020 2020  ze: int,.       
-00002860: 2063 6f6c 756d 6e73 3a20 4f70 7469 6f6e   columns: Option
-00002870: 616c 5b55 6e69 6f6e 5b73 7472 2c20 4c69  al[Union[str, Li
-00002880: 7374 5b73 7472 5d5d 5d20 3d20 4e6f 6e65  st[str]]] = None
-00002890: 2c0a 2020 2020 2020 2020 7368 7566 666c  ,.        shuffl
-000028a0: 653a 2062 6f6f 6c20 3d20 4661 6c73 652c  e: bool = False,
-000028b0: 0a20 2020 2020 2020 2063 6f6c 6c61 7465  .        collate
-000028c0: 5f66 6e3a 204f 7074 696f 6e61 6c5b 4361  _fn: Optional[Ca
-000028d0: 6c6c 6162 6c65 5d20 3d20 4e6f 6e65 2c0a  llable] = None,.
-000028e0: 2020 2020 2020 2020 6472 6f70 5f72 656d          drop_rem
-000028f0: 6169 6e64 6572 3a20 626f 6f6c 203d 2046  ainder: bool = F
-00002900: 616c 7365 2c0a 2020 2020 2020 2020 636f  alse,.        co
-00002910: 6c6c 6174 655f 666e 5f61 7267 733a 204f  llate_fn_args: O
-00002920: 7074 696f 6e61 6c5b 4469 6374 5b73 7472  ptional[Dict[str
-00002930: 2c20 416e 795d 5d20 3d20 4e6f 6e65 2c0a  , Any]] = None,.
-00002940: 2020 2020 2020 2020 6c61 6265 6c5f 636f          label_co
-00002950: 6c73 3a20 4f70 7469 6f6e 616c 5b55 6e69  ls: Optional[Uni
-00002960: 6f6e 5b73 7472 2c20 4c69 7374 5b73 7472  on[str, List[str
-00002970: 5d5d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ]]] = None,.    
-00002980: 2020 2020 7072 6566 6574 6368 3a20 626f      prefetch: bo
-00002990: 6f6c 203d 2054 7275 652c 0a20 2020 2029  ol = True,.    )
-000029a0: 3a0a 2020 2020 2020 2020 2222 2243 7265  :.        """Cre
-000029b0: 6174 6520 6120 6074 662e 6461 7461 2e44  ate a `tf.data.D
-000029c0: 6174 6173 6574 6020 6672 6f6d 2074 6865  ataset` from the
-000029d0: 2075 6e64 6572 6c79 696e 6720 4461 7461   underlying Data
-000029e0: 7365 742e 2054 6869 7320 6074 662e 6461  set. This `tf.da
-000029f0: 7461 2e44 6174 6173 6574 6020 7769 6c6c  ta.Dataset` will
-00002a00: 206c 6f61 6420 616e 6420 636f 6c6c 6174   load and collat
-00002a10: 6520 6261 7463 6865 7320 6672 6f6d 0a20  e batches from. 
-00002a20: 2020 2020 2020 2074 6865 2044 6174 6173         the Datas
-00002a30: 6574 2c20 616e 6420 6973 2073 7569 7461  et, and is suita
-00002a40: 626c 6520 666f 7220 7061 7373 696e 6720  ble for passing 
-00002a50: 746f 206d 6574 686f 6473 206c 696b 6520  to methods like 
-00002a60: 606d 6f64 656c 2e66 6974 2829 6020 6f72  `model.fit()` or
-00002a70: 2060 6d6f 6465 6c2e 7072 6564 6963 7428   `model.predict(
-00002a80: 2960 2e20 5468 6520 6461 7461 7365 7420  )`. The dataset 
-00002a90: 7769 6c6c 2079 6965 6c64 0a20 2020 2020  will yield.     
-00002aa0: 2020 2060 6469 6374 7360 2066 6f72 2062     `dicts` for b
-00002ab0: 6f74 6820 696e 7075 7473 2061 6e64 206c  oth inputs and l
-00002ac0: 6162 656c 7320 756e 6c65 7373 2074 6865  abels unless the
-00002ad0: 2060 6469 6374 6020 776f 756c 6420 636f   `dict` would co
-00002ae0: 6e74 6169 6e20 6f6e 6c79 2061 2073 696e  ntain only a sin
-00002af0: 676c 6520 6b65 792c 2069 6e20 7768 6963  gle key, in whic
-00002b00: 6820 6361 7365 2061 2072 6177 0a20 2020  h case a raw.   
-00002b10: 2020 2020 2060 7466 2e54 656e 736f 7260       `tf.Tensor`
-00002b20: 2069 7320 7969 656c 6465 6420 696e 7374   is yielded inst
-00002b30: 6561 642e 0a0a 2020 2020 2020 2020 4172  ead...        Ar
-00002b40: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00002b50: 6261 7463 685f 7369 7a65 2028 6069 6e74  batch_size (`int
-00002b60: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
-00002b70: 2020 2020 5369 7a65 206f 6620 6261 7463      Size of batc
-00002b80: 6865 7320 746f 206c 6f61 6420 6672 6f6d  hes to load from
-00002b90: 2074 6865 2064 6174 6173 6574 2e0a 2020   the dataset..  
-00002ba0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00002bb0: 7320 2860 4c69 7374 5b73 7472 5d60 206f  s (`List[str]` o
-00002bc0: 7220 6073 7472 602c 202a 6f70 7469 6f6e  r `str`, *option
-00002bd0: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
-00002be0: 2020 2020 2020 4461 7461 7365 7420 636f        Dataset co
-00002bf0: 6c75 6d6e 2873 2920 746f 206c 6f61 6420  lumn(s) to load 
-00002c00: 696e 2074 6865 2060 7466 2e64 6174 612e  in the `tf.data.
-00002c10: 4461 7461 7365 7460 2e0a 2020 2020 2020  Dataset`..      
-00002c20: 2020 2020 2020 2020 2020 436f 6c75 6d6e            Column
-00002c30: 206e 616d 6573 2074 6861 7420 6172 6520   names that are 
-00002c40: 6372 6561 7465 6420 6279 2074 6865 2060  created by the `
-00002c50: 636f 6c6c 6174 655f 666e 6020 616e 6420  collate_fn` and 
-00002c60: 7468 6174 2064 6f20 6e6f 7420 6578 6973  that do not exis
-00002c70: 7420 696e 2074 6865 206f 7269 6769 6e61  t in the origina
-00002c80: 6c20 6461 7461 7365 7420 6361 6e20 6265  l dataset can be
-00002c90: 2075 7365 642e 0a20 2020 2020 2020 2020   used..         
-00002ca0: 2020 2073 6875 6666 6c65 2860 626f 6f6c     shuffle(`bool
-00002cb0: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
-00002cc0: 4661 6c73 6560 293a 0a20 2020 2020 2020  False`):.       
-00002cd0: 2020 2020 2020 2020 2053 6875 6666 6c65           Shuffle
-00002ce0: 2074 6865 2064 6174 6173 6574 206f 7264   the dataset ord
-00002cf0: 6572 2077 6865 6e20 6c6f 6164 696e 672e  er when loading.
-00002d00: 2052 6563 6f6d 6d65 6e64 6564 2060 5472   Recommended `Tr
-00002d10: 7565 6020 666f 7220 7472 6169 6e69 6e67  ue` for training
-00002d20: 2c20 6046 616c 7365 6020 666f 720a 2020  , `False` for.  
-00002d30: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00002d40: 6c69 6461 7469 6f6e 2f65 7661 6c75 6174  lidation/evaluat
-00002d50: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
-00002d60: 2064 726f 705f 7265 6d61 696e 6465 7228   drop_remainder(
-00002d70: 6062 6f6f 6c60 2c20 6465 6661 756c 7473  `bool`, defaults
-00002d80: 2074 6f20 6046 616c 7365 6029 3a0a 2020   to `False`):.  
-00002d90: 2020 2020 2020 2020 2020 2020 2020 4472                Dr
-00002da0: 6f70 2074 6865 206c 6173 7420 696e 636f  op the last inco
-00002db0: 6d70 6c65 7465 2062 6174 6368 2077 6865  mplete batch whe
-00002dc0: 6e20 6c6f 6164 696e 672e 2045 6e73 7572  n loading. Ensur
-00002dd0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00002de0: 2020 2074 6861 7420 616c 6c20 6261 7463     that all batc
-00002df0: 6865 7320 7969 656c 6465 6420 6279 2074  hes yielded by t
-00002e00: 6865 2064 6174 6173 6574 2077 696c 6c20  he dataset will 
-00002e10: 6861 7665 2074 6865 2073 616d 6520 6c65  have the same le
-00002e20: 6e67 7468 206f 6e20 7468 6520 6261 7463  ngth on the batc
-00002e30: 6820 6469 6d65 6e73 696f 6e2e 0a20 2020  h dimension..   
-00002e40: 2020 2020 2020 2020 2063 6f6c 6c61 7465           collate
-00002e50: 5f66 6e28 6043 616c 6c61 626c 6560 2c20  _fn(`Callable`, 
-00002e60: 2a6f 7074 696f 6e61 6c2a 293a 0a20 2020  *optional*):.   
-00002e70: 2020 2020 2020 2020 2020 2020 2041 2066               A f
-00002e80: 756e 6374 696f 6e20 6f72 2063 616c 6c61  unction or calla
-00002e90: 626c 6520 6f62 6a65 6374 2028 7375 6368  ble object (such
-00002ea0: 2061 7320 6120 6044 6174 6143 6f6c 6c61   as a `DataColla
-00002eb0: 746f 7260 2920 7468 6174 2077 696c 6c20  tor`) that will 
-00002ec0: 636f 6c6c 6174 650a 2020 2020 2020 2020  collate.        
-00002ed0: 2020 2020 2020 2020 6c69 7374 7320 6f66          lists of
-00002ee0: 2073 616d 706c 6573 2069 6e74 6f20 6120   samples into a 
-00002ef0: 6261 7463 682e 0a20 2020 2020 2020 2020  batch..         
-00002f00: 2020 2063 6f6c 6c61 7465 5f66 6e5f 6172     collate_fn_ar
-00002f10: 6773 2028 6044 6963 7460 2c20 2a6f 7074  gs (`Dict`, *opt
-00002f20: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
-00002f30: 2020 2020 2020 2020 2041 6e20 6f70 7469           An opti
-00002f40: 6f6e 616c 2060 6469 6374 6020 6f66 206b  onal `dict` of k
-00002f50: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-00002f60: 2074 6f20 6265 2070 6173 7365 6420 746f   to be passed to
-00002f70: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00002f80: 2020 2020 2060 636f 6c6c 6174 655f 666e       `collate_fn
-00002f90: 602e 0a20 2020 2020 2020 2020 2020 206c  `..            l
-00002fa0: 6162 656c 5f63 6f6c 7320 2860 4c69 7374  abel_cols (`List
-00002fb0: 5b73 7472 5d60 206f 7220 6073 7472 602c  [str]` or `str`,
-00002fc0: 2064 6566 6175 6c74 7320 746f 2060 4e6f   defaults to `No
-00002fd0: 6e65 6029 3a0a 2020 2020 2020 2020 2020  ne`):.          
-00002fe0: 2020 2020 2020 4461 7461 7365 7420 636f        Dataset co
-00002ff0: 6c75 6d6e 2873 2920 746f 206c 6f61 6420  lumn(s) to load 
-00003000: 6173 206c 6162 656c 732e 0a20 2020 2020  as labels..     
-00003010: 2020 2020 2020 2020 2020 204e 6f74 6520             Note 
-00003020: 7468 6174 206d 616e 7920 6d6f 6465 6c73  that many models
-00003030: 2063 6f6d 7075 7465 206c 6f73 7320 696e   compute loss in
-00003040: 7465 726e 616c 6c79 2072 6174 6865 7220  ternally rather 
-00003050: 7468 616e 206c 6574 7469 6e67 204b 6572  than letting Ker
-00003060: 6173 2064 6f20 6974 2c20 696e 2077 6869  as do it, in whi
-00003070: 6368 2063 6173 650a 2020 2020 2020 2020  ch case.        
-00003080: 2020 2020 2020 2020 7061 7373 696e 6720          passing 
-00003090: 7468 6520 6c61 6265 6c73 2068 6572 6520  the labels here 
-000030a0: 6973 206f 7074 696f 6e61 6c2c 2061 7320  is optional, as 
-000030b0: 6c6f 6e67 2061 7320 7468 6579 2772 6520  long as they're 
-000030c0: 696e 2074 6865 2069 6e70 7574 2060 636f  in the input `co
-000030d0: 6c75 6d6e 7360 2e0a 2020 2020 2020 2020  lumns`..        
-000030e0: 2020 2020 7072 6566 6574 6368 2028 6062      prefetch (`b
-000030f0: 6f6f 6c60 2c20 6465 6661 756c 7473 2074  ool`, defaults t
-00003100: 6f20 6054 7275 6560 293a 0a20 2020 2020  o `True`):.     
-00003110: 2020 2020 2020 2020 2020 2057 6865 7468             Wheth
-00003120: 6572 2074 6f20 7275 6e20 7468 6520 6461  er to run the da
-00003130: 7461 6c6f 6164 6572 2069 6e20 6120 7365  taloader in a se
-00003140: 7061 7261 7465 2074 6872 6561 6420 616e  parate thread an
-00003150: 6420 6d61 696e 7461 696e 0a20 2020 2020  d maintain.     
-00003160: 2020 2020 2020 2020 2020 2061 2073 6d61             a sma
-00003170: 6c6c 2062 7566 6665 7220 6f66 2062 6174  ll buffer of bat
-00003180: 6368 6573 2066 6f72 2074 7261 696e 696e  ches for trainin
-00003190: 672e 2049 6d70 726f 7665 7320 7065 7266  g. Improves perf
-000031a0: 6f72 6d61 6e63 6520 6279 2061 6c6c 6f77  ormance by allow
-000031b0: 696e 6720 6461 7461 2074 6f20 6265 206c  ing data to be l
-000031c0: 6f61 6465 6420 696e 2074 6865 0a20 2020  oaded in the.   
-000031d0: 2020 2020 2020 2020 2020 2020 2062 6163               bac
-000031e0: 6b67 726f 756e 6420 7768 696c 6520 7468  kground while th
-000031f0: 6520 6d6f 6465 6c20 6973 2074 7261 696e  e model is train
-00003200: 696e 672e 0a0a 2020 2020 2020 2020 5265  ing...        Re
-00003210: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
-00003220: 2020 2060 7466 2e64 6174 612e 4461 7461     `tf.data.Data
-00003230: 7365 7460 0a0a 2020 2020 2020 2020 4578  set`..        Ex
-00003240: 616d 706c 653a 0a0a 2020 2020 2020 2020  ample:..        
-00003250: 6060 6070 790a 2020 2020 2020 2020 3e3e  ```py.        >>
-00003260: 3e20 6473 5f74 7261 696e 203d 2064 735b  > ds_train = ds[
-00003270: 2274 7261 696e 225d 2e74 6f5f 7466 5f64  "train"].to_tf_d
-00003280: 6174 6173 6574 280a 2020 2020 2020 2020  ataset(.        
-00003290: 2e2e 2e20 2020 2063 6f6c 756d 6e73 3d5b  ...    columns=[
-000032a0: 2769 6e70 7574 5f69 6473 272c 2027 746f  'input_ids', 'to
-000032b0: 6b65 6e5f 7479 7065 5f69 6473 272c 2027  ken_type_ids', '
-000032c0: 6174 7465 6e74 696f 6e5f 6d61 736b 272c  attention_mask',
-000032d0: 2027 6c61 6265 6c27 5d2c 0a20 2020 2020   'label'],.     
-000032e0: 2020 202e 2e2e 2020 2020 7368 7566 666c     ...    shuffl
-000032f0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
-00003300: 2e2e 2e20 2020 2062 6174 6368 5f73 697a  ...    batch_siz
-00003310: 653d 3136 2c0a 2020 2020 2020 2020 2e2e  e=16,.        ..
-00003320: 2e20 2020 2063 6f6c 6c61 7465 5f66 6e3d  .    collate_fn=
-00003330: 6461 7461 5f63 6f6c 6c61 746f 722c 0a20  data_collator,. 
-00003340: 2020 2020 2020 202e 2e2e 2029 0a20 2020         ... ).   
-00003350: 2020 2020 2060 6060 0a20 2020 2020 2020       ```.       
-00003360: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00003370: 636f 6e66 6967 2e54 465f 4156 4149 4c41  config.TF_AVAILA
-00003380: 424c 453a 0a20 2020 2020 2020 2020 2020  BLE:.           
-00003390: 2069 6d70 6f72 7420 7465 6e73 6f72 666c   import tensorfl
-000033a0: 6f77 2061 7320 7466 0a20 2020 2020 2020  ow as tf.       
-000033b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000033c0: 2020 2072 6169 7365 2049 6d70 6f72 7445     raise ImportE
-000033d0: 7272 6f72 2822 4361 6c6c 6564 2061 2054  rror("Called a T
-000033e0: 656e 736f 7266 6c6f 772d 7370 6563 6966  ensorflow-specif
-000033f0: 6963 2066 756e 6374 696f 6e20 6275 7420  ic function but 
-00003400: 5465 6e73 6f72 666c 6f77 2069 7320 6e6f  Tensorflow is no
-00003410: 7420 696e 7374 616c 6c65 642e 2229 0a0a  t installed.")..
-00003420: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00003430: 7461 6e63 6528 7466 2e64 6973 7472 6962  tance(tf.distrib
-00003440: 7574 652e 6765 745f 7374 7261 7465 6779  ute.get_strategy
-00003450: 2829 2c20 7466 2e64 6973 7472 6962 7574  (), tf.distribut
-00003460: 652e 5450 5553 7472 6174 6567 7929 3a0a  e.TPUStrategy):.
-00003470: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00003480: 6572 2e77 6172 6e69 6e67 280a 2020 2020  er.warning(.    
-00003490: 2020 2020 2020 2020 2020 2020 224e 6f74              "Not
-000034a0: 6520 7468 6174 2074 6f5f 7466 5f64 6174  e that to_tf_dat
-000034b0: 6173 6574 2829 206c 6f61 6473 2074 6865  aset() loads the
-000034c0: 2064 6174 6120 7769 7468 2061 2067 656e   data with a gen
-000034d0: 6572 6174 6f72 2072 6174 6865 7220 7468  erator rather th
-000034e0: 616e 2061 2066 756c 6c20 7466 2e64 6174  an a full tf.dat
-000034f0: 6120 220a 2020 2020 2020 2020 2020 2020  a ".            
-00003500: 2020 2020 2270 6970 656c 696e 6520 616e      "pipeline an
-00003510: 6420 6973 206e 6f74 2063 6f6d 7061 7469  d is not compati
-00003520: 626c 6520 7769 7468 2072 656d 6f74 6520  ble with remote 
-00003530: 5450 5520 636f 6e6e 6563 7469 6f6e 732e  TPU connections.
-00003540: 2049 6620 796f 7520 656e 636f 756e 7465   If you encounte
-00003550: 7220 6572 726f 7273 2c20 706c 6561 7365  r errors, please
-00003560: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00003570: 2020 2022 7472 7920 7573 696e 6720 6120     "try using a 
-00003580: 5450 5520 564d 206f 722c 2069 6620 796f  TPU VM or, if yo
-00003590: 7572 2064 6174 6120 6361 6e20 6669 7420  ur data can fit 
-000035a0: 696e 206d 656d 6f72 792c 206c 6f61 6469  in memory, loadi
-000035b0: 6e67 2069 7420 696e 746f 206d 656d 6f72  ng it into memor
-000035c0: 7920 6173 2061 2064 6963 7420 6f66 2022  y as a dict of "
-000035d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000035e0: 2022 5465 6e73 6f72 7320 696e 7374 6561   "Tensors instea
-000035f0: 6420 6f66 2073 7472 6561 6d69 6e67 2077  d of streaming w
-00003600: 6974 6820 746f 5f74 665f 6461 7461 7365  ith to_tf_datase
-00003610: 7428 292e 220a 2020 2020 2020 2020 2020  t().".          
-00003620: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-00003630: 636f 6c6c 6174 655f 666e 2069 7320 4e6f  collate_fn is No
-00003640: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00003650: 2320 5365 7420 6120 7665 7279 2073 696d  # Set a very sim
-00003660: 706c 6520 6465 6661 756c 7420 636f 6c6c  ple default coll
-00003670: 6174 6f72 2074 6861 7420 6a75 7374 2073  ator that just s
-00003680: 7461 636b 7320 7468 696e 6773 2074 6f67  tacks things tog
-00003690: 6574 6865 720a 2020 2020 2020 2020 2020  ether.          
-000036a0: 2020 636f 6c6c 6174 655f 666e 203d 206d    collate_fn = m
-000036b0: 696e 696d 616c 5f74 665f 636f 6c6c 6174  inimal_tf_collat
-000036c0: 655f 666e 0a20 2020 2020 2020 2069 6620  e_fn.        if 
-000036d0: 636f 6c6c 6174 655f 666e 5f61 7267 7320  collate_fn_args 
-000036e0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000036f0: 2020 2020 2063 6f6c 6c61 7465 5f66 6e5f       collate_fn_
-00003700: 6172 6773 203d 207b 7d0a 2020 2020 2020  args = {}.      
-00003710: 2020 6966 206c 6162 656c 5f63 6f6c 7320    if label_cols 
-00003720: 616e 6420 6e6f 7420 636f 6c75 6d6e 733a  and not columns:
-00003730: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00003740: 7365 2056 616c 7565 4572 726f 7228 2243  se ValueError("C
-00003750: 616e 6e6f 7420 7370 6563 6966 7920 6c61  annot specify la
-00003760: 6265 6c5f 636f 6c73 2077 6974 686f 7574  bel_cols without
-00003770: 2073 7065 6369 6679 696e 6720 636f 6c75   specifying colu
-00003780: 6d6e 7321 2229 0a20 2020 2020 2020 2069  mns!").        i
-00003790: 6620 6c61 6265 6c5f 636f 6c73 2069 7320  f label_cols is 
-000037a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000037b0: 2020 6c61 6265 6c5f 636f 6c73 203d 205b    label_cols = [
-000037c0: 5d0a 2020 2020 2020 2020 656c 6966 2069  ].        elif i
-000037d0: 7369 6e73 7461 6e63 6528 6c61 6265 6c5f  sinstance(label_
-000037e0: 636f 6c73 2c20 7374 7229 3a0a 2020 2020  cols, str):.    
-000037f0: 2020 2020 2020 2020 6c61 6265 6c5f 636f          label_co
-00003800: 6c73 203d 205b 6c61 6265 6c5f 636f 6c73  ls = [label_cols
-00003810: 5d0a 2020 2020 2020 2020 6966 206c 656e  ].        if len
-00003820: 2873 6574 286c 6162 656c 5f63 6f6c 7329  (set(label_cols)
-00003830: 2920 3c20 6c65 6e28 6c61 6265 6c5f 636f  ) < len(label_co
-00003840: 6c73 293a 0a20 2020 2020 2020 2020 2020  ls):.           
-00003850: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00003860: 7228 224c 6973 7420 6f66 206c 6162 656c  r("List of label
-00003870: 5f63 6f6c 7320 636f 6e74 6169 6e73 2064  _cols contains d
-00003880: 7570 6c69 6361 7465 732e 2229 0a20 2020  uplicates.").   
-00003890: 2020 2020 2069 6620 636f 6c75 6d6e 733a       if columns:
-000038a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000038b0: 6973 696e 7374 616e 6365 2863 6f6c 756d  isinstance(colum
-000038c0: 6e73 2c20 7374 7229 3a0a 2020 2020 2020  ns, str):.      
-000038d0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-000038e0: 7320 3d20 5b63 6f6c 756d 6e73 5d0a 2020  s = [columns].  
-000038f0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00003900: 2873 6574 2863 6f6c 756d 6e73 2929 203c  (set(columns)) <
-00003910: 206c 656e 2863 6f6c 756d 6e73 293a 0a20   len(columns):. 
-00003920: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00003930: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00003940: 224c 6973 7420 6f66 2063 6f6c 756d 6e73  "List of columns
-00003950: 2063 6f6e 7461 696e 7320 6475 706c 6963   contains duplic
-00003960: 6174 6573 2e22 290a 2020 2020 2020 2020  ates.").        
-00003970: 2020 2020 636f 6c73 5f74 6f5f 7265 7461      cols_to_reta
-00003980: 696e 203d 206c 6973 7428 7365 7428 636f  in = list(set(co
-00003990: 6c75 6d6e 7320 2b20 6c61 6265 6c5f 636f  lumns + label_co
-000039a0: 6c73 2929 0a20 2020 2020 2020 2065 6c73  ls)).        els
-000039b0: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-000039c0: 6f6c 735f 746f 5f72 6574 6169 6e20 3d20  ols_to_retain = 
-000039d0: 4e6f 6e65 2020 2320 496e 6469 6361 7465  None  # Indicate
-000039e0: 7320 6b65 6570 696e 6720 616c 6c20 7661  s keeping all va
-000039f0: 6c69 6420 636f 6c75 6d6e 730a 2020 2020  lid columns.    
-00003a00: 2020 2020 2020 2020 636f 6c75 6d6e 7320          columns 
-00003a10: 3d20 5b5d 0a0a 2020 2020 2020 2020 6966  = []..        if
-00003a20: 2073 656c 662e 666f 726d 6174 5b22 7479   self.format["ty
-00003a30: 7065 225d 2021 3d20 2263 7573 746f 6d22  pe"] != "custom"
-00003a40: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
-00003a50: 7461 7365 7420 3d20 7365 6c66 2e77 6974  taset = self.wit
-00003a60: 685f 666f 726d 6174 2822 6e75 6d70 7922  h_format("numpy"
-00003a70: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00003a80: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00003a90: 7365 7420 3d20 7365 6c66 0a0a 2020 2020  set = self..    
-00003aa0: 2020 2020 2320 544f 444f 284d 6174 742c      # TODO(Matt,
-00003ab0: 2051 4c29 3a20 6465 7072 6563 6174 6520   QL): deprecate 
-00003ac0: 7468 6520 7265 7465 6e74 696f 6e20 6f66  the retention of
-00003ad0: 206c 6162 656c 5f69 6473 2061 6e64 206c   label_ids and l
-00003ae0: 6162 656c 0a0a 2020 2020 2020 2020 6f75  abel..        ou
-00003af0: 7470 7574 5f73 6967 6e61 7475 7265 2c20  tput_signature, 
-00003b00: 636f 6c75 6d6e 735f 746f 5f6e 705f 7479  columns_to_np_ty
-00003b10: 7065 7320 3d20 6461 7461 7365 742e 5f67  pes = dataset._g
-00003b20: 6574 5f6f 7574 7075 745f 7369 676e 6174  et_output_signat
-00003b30: 7572 6528 0a20 2020 2020 2020 2020 2020  ure(.           
-00003b40: 2064 6174 6173 6574 2c0a 2020 2020 2020   dataset,.      
-00003b50: 2020 2020 2020 636f 6c6c 6174 655f 666e        collate_fn
-00003b60: 3d63 6f6c 6c61 7465 5f66 6e2c 0a20 2020  =collate_fn,.   
-00003b70: 2020 2020 2020 2020 2063 6f6c 6c61 7465           collate
-00003b80: 5f66 6e5f 6172 6773 3d63 6f6c 6c61 7465  _fn_args=collate
-00003b90: 5f66 6e5f 6172 6773 2c0a 2020 2020 2020  _fn_args,.      
-00003ba0: 2020 2020 2020 636f 6c73 5f74 6f5f 7265        cols_to_re
-00003bb0: 7461 696e 3d63 6f6c 735f 746f 5f72 6574  tain=cols_to_ret
-00003bc0: 6169 6e2c 0a20 2020 2020 2020 2020 2020  ain,.           
-00003bd0: 2062 6174 6368 5f73 697a 653d 6261 7463   batch_size=batc
-00003be0: 685f 7369 7a65 2069 6620 6472 6f70 5f72  h_size if drop_r
-00003bf0: 656d 6169 6e64 6572 2065 6c73 6520 4e6f  emainder else No
-00003c00: 6e65 2c0a 2020 2020 2020 2020 290a 0a20  ne,.        ).. 
-00003c10: 2020 2020 2020 2069 6620 226c 6162 656c         if "label
-00003c20: 7322 2069 6e20 6f75 7470 7574 5f73 6967  s" in output_sig
-00003c30: 6e61 7475 7265 3a0a 2020 2020 2020 2020  nature:.        
-00003c40: 2020 2020 6966 2028 226c 6162 656c 5f69      if ("label_i
-00003c50: 6473 2220 696e 2063 6f6c 756d 6e73 206f  ds" in columns o
-00003c60: 7220 226c 6162 656c 2220 696e 2063 6f6c  r "label" in col
-00003c70: 756d 6e73 2920 616e 6420 226c 6162 656c  umns) and "label
-00003c80: 7322 206e 6f74 2069 6e20 636f 6c75 6d6e  s" not in column
-00003c90: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00003ca0: 2020 2063 6f6c 756d 6e73 203d 205b 636f     columns = [co
-00003cb0: 6c20 666f 7220 636f 6c20 696e 2063 6f6c  l for col in col
-00003cc0: 756d 6e73 2069 6620 636f 6c20 6e6f 7420  umns if col not 
-00003cd0: 696e 205b 226c 6162 656c 5f69 6473 222c  in ["label_ids",
-00003ce0: 2022 6c61 6265 6c22 5d5d 202b 205b 226c   "label"]] + ["l
-00003cf0: 6162 656c 7322 5d0a 2020 2020 2020 2020  abels"].        
-00003d00: 2020 2020 6966 2028 226c 6162 656c 5f69      if ("label_i
-00003d10: 6473 2220 696e 206c 6162 656c 5f63 6f6c  ds" in label_col
-00003d20: 7320 6f72 2022 6c61 6265 6c22 2069 6e20  s or "label" in 
-00003d30: 6c61 6265 6c5f 636f 6c73 2920 616e 6420  label_cols) and 
-00003d40: 226c 6162 656c 7322 206e 6f74 2069 6e20  "labels" not in 
-00003d50: 6c61 6265 6c5f 636f 6c73 3a0a 2020 2020  label_cols:.    
-00003d60: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-00003d70: 6c5f 636f 6c73 203d 205b 636f 6c20 666f  l_cols = [col fo
-00003d80: 7220 636f 6c20 696e 206c 6162 656c 5f63  r col in label_c
-00003d90: 6f6c 7320 6966 2063 6f6c 206e 6f74 2069  ols if col not i
-00003da0: 6e20 5b22 6c61 6265 6c5f 6964 7322 2c20  n ["label_ids", 
-00003db0: 226c 6162 656c 225d 5d20 2b20 5b22 6c61  "label"]] + ["la
-00003dc0: 6265 6c73 225d 0a0a 2020 2020 2020 2020  bels"]..        
-00003dd0: 666f 7220 636f 6c20 696e 2063 6f6c 756d  for col in colum
-00003de0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-00003df0: 6966 2063 6f6c 206e 6f74 2069 6e20 6f75  if col not in ou
-00003e00: 7470 7574 5f73 6967 6e61 7475 7265 3a0a  tput_signature:.
-00003e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e20: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00003e30: 2866 2243 6f6c 756d 6e20 7b63 6f6c 7d20  (f"Column {col} 
-00003e40: 6e6f 7420 666f 756e 6420 696e 2064 6174  not found in dat
-00003e50: 6173 6574 2122 290a 0a20 2020 2020 2020  aset!")..       
-00003e60: 2066 6f72 2063 6f6c 2069 6e20 6c61 6265   for col in labe
-00003e70: 6c5f 636f 6c73 3a0a 2020 2020 2020 2020  l_cols:.        
-00003e80: 2020 2020 6966 2063 6f6c 206e 6f74 2069      if col not i
-00003e90: 6e20 6f75 7470 7574 5f73 6967 6e61 7475  n output_signatu
-00003ea0: 7265 3a0a 2020 2020 2020 2020 2020 2020  re:.            
-00003eb0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00003ec0: 7272 6f72 2866 224c 6162 656c 2063 6f6c  rror(f"Label col
-00003ed0: 756d 6e20 7b63 6f6c 7d20 6e6f 7420 666f  umn {col} not fo
-00003ee0: 756e 6420 696e 2064 6174 6173 6574 2122  und in dataset!"
-00003ef0: 290a 0a20 2020 2020 2020 2064 6566 206e  )..        def n
-00003f00: 705f 6765 745f 6261 7463 6828 696e 6469  p_get_batch(indi
-00003f10: 6365 7329 3a0a 2020 2020 2020 2020 2020  ces):.          
-00003f20: 2020 2320 4f70 7469 6d69 7a61 7469 6f6e    # Optimization
-00003f30: 202d 2069 6620 7765 2772 6520 6c6f 6164   - if we're load
-00003f40: 696e 6720 6120 7365 7175 656e 7469 616c  ing a sequential
-00003f50: 2062 6174 6368 2c20 646f 2069 7420 7769   batch, do it wi
-00003f60: 7468 2073 6c69 6369 6e67 2069 6e73 7465  th slicing inste
-00003f70: 6164 206f 6620 6120 6c69 7374 206f 6620  ad of a list of 
-00003f80: 696e 6469 6365 730a 2020 2020 2020 2020  indices.        
-00003f90: 2020 2020 6966 206e 702e 616c 6c28 6e70      if np.all(np
-00003fa0: 2e64 6966 6628 696e 6469 6365 7329 203d  .diff(indices) =
-00003fb0: 3d20 3129 3a0a 2020 2020 2020 2020 2020  = 1):.          
-00003fc0: 2020 2020 2020 6261 7463 6820 3d20 6461        batch = da
-00003fd0: 7461 7365 745b 696e 6469 6365 735b 305d  taset[indices[0]
-00003fe0: 203a 2069 6e64 6963 6573 5b2d 315d 202b   : indices[-1] +
-00003ff0: 2031 5d0a 2020 2020 2020 2020 2020 2020   1].            
-00004000: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00004010: 2020 2020 2020 6261 7463 6820 3d20 6461        batch = da
-00004020: 7461 7365 745b 696e 6469 6365 735d 0a0a  taset[indices]..
-00004030: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00004040: 6f6c 735f 746f 5f72 6574 6169 6e20 6973  ols_to_retain is
-00004050: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00004060: 2020 2020 2020 2020 2020 2062 6174 6368             batch
-00004070: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-00004080: 2020 2020 2020 2020 206b 6579 3a20 7661           key: va
-00004090: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
-000040a0: 2020 2020 2020 2020 666f 7220 6b65 792c          for key,
-000040b0: 2076 616c 7565 2069 6e20 6261 7463 682e   value in batch.
-000040c0: 6974 656d 7328 290a 2020 2020 2020 2020  items().        
-000040d0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-000040e0: 6579 2069 6e20 636f 6c73 5f74 6f5f 7265  ey in cols_to_re
-000040f0: 7461 696e 206f 7220 6b65 7920 696e 2028  tain or key in (
-00004100: 226c 6162 656c 222c 2022 6c61 6265 6c5f  "label", "label_
-00004110: 6964 7322 2c20 226c 6162 656c 7322 290a  ids", "labels").
-00004120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004130: 7d0a 2020 2020 2020 2020 2020 2020 656c  }.            el
-00004140: 6966 2063 6f6c 735f 746f 5f72 6574 6169  if cols_to_retai
-00004150: 6e20 6973 206e 6f74 204e 6f6e 653a 0a20  n is not None:. 
-00004160: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00004170: 6174 6368 203d 207b 6b65 793a 2076 616c  atch = {key: val
-00004180: 7565 2066 6f72 206b 6579 2c20 7661 6c75  ue for key, valu
-00004190: 6520 696e 2062 6174 6368 2e69 7465 6d73  e in batch.items
-000041a0: 2829 2069 6620 6b65 7920 696e 2063 6f6c  () if key in col
-000041b0: 735f 746f 5f72 6574 6169 6e7d 0a0a 2020  s_to_retain}..  
-000041c0: 2020 2020 2020 2020 2020 6163 7475 616c            actual
-000041d0: 5f73 697a 6520 3d20 6c65 6e28 6c69 7374  _size = len(list
-000041e0: 2862 6174 6368 2e76 616c 7565 7328 2929  (batch.values())
-000041f0: 5b30 5d29 2020 2320 4765 7420 7468 6520  [0])  # Get the 
-00004200: 6c65 6e67 7468 206f 6620 6f6e 6520 6f66  length of one of
-00004210: 2074 6865 2061 7272 6179 732c 2061 7373   the arrays, ass
-00004220: 756d 6520 616c 6c20 7361 6d65 0a20 2020  ume all same.   
-00004230: 2020 2020 2020 2020 2023 204f 7572 2063           # Our c
-00004240: 6f6c 6c61 746f 7273 2065 7870 6563 7420  ollators expect 
-00004250: 6120 6c69 7374 206f 6620 6469 6374 732c  a list of dicts,
-00004260: 206e 6f74 2061 2064 6963 7420 6f66 206c   not a dict of l
-00004270: 6973 7473 2f61 7272 6179 732c 2073 6f20  ists/arrays, so 
-00004280: 7765 2069 6e76 6572 740a 2020 2020 2020  we invert.      
-00004290: 2020 2020 2020 6261 7463 6820 3d20 5b7b        batch = [{
-000042a0: 6b65 793a 2076 616c 7565 5b69 5d20 666f  key: value[i] fo
-000042b0: 7220 6b65 792c 2076 616c 7565 2069 6e20  r key, value in 
-000042c0: 6261 7463 682e 6974 656d 7328 297d 2066  batch.items()} f
-000042d0: 6f72 2069 2069 6e20 7261 6e67 6528 6163  or i in range(ac
-000042e0: 7475 616c 5f73 697a 6529 5d0a 2020 2020  tual_size)].    
-000042f0: 2020 2020 2020 2020 6261 7463 6820 3d20          batch = 
-00004300: 636f 6c6c 6174 655f 666e 2862 6174 6368  collate_fn(batch
-00004310: 2c20 2a2a 636f 6c6c 6174 655f 666e 5f61  , **collate_fn_a
-00004320: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-00004330: 206f 7574 5f62 6174 6368 203d 205b 5d0a   out_batch = [].
-00004340: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00004350: 636f 6c2c 2063 6173 745f 6474 7970 6520  col, cast_dtype 
-00004360: 696e 2063 6f6c 756d 6e73 5f74 6f5f 6e70  in columns_to_np
-00004370: 5f74 7970 6573 2e69 7465 6d73 2829 3a0a  _types.items():.
-00004380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004390: 2320 496e 2063 6173 6520 7468 6520 636f  # In case the co
-000043a0: 6c6c 6174 655f 666e 2072 6574 7572 6e73  llate_fn returns
-000043b0: 2073 6f6d 6574 6869 6e67 2073 7472 616e   something stran
-000043c0: 6765 0a20 2020 2020 2020 2020 2020 2020  ge.             
-000043d0: 2020 2061 7272 6179 203d 206e 702e 6172     array = np.ar
-000043e0: 7261 7928 6261 7463 685b 636f 6c5d 290a  ray(batch[col]).
-000043f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004400: 6172 7261 7920 3d20 6172 7261 792e 6173  array = array.as
-00004410: 7479 7065 2863 6173 745f 6474 7970 6529  type(cast_dtype)
+00000d30: 706f 7274 2064 6174 6173 6574 5f74 6f5f  port dataset_to_
+00000d40: 7466 2c20 6d69 6e69 6d61 6c5f 7466 5f63  tf, minimal_tf_c
+00000d50: 6f6c 6c61 7465 5f66 6e2c 206d 756c 7469  ollate_fn, multi
+00000d60: 7072 6f63 6573 735f 6461 7461 7365 745f  process_dataset_
+00000d70: 746f 5f74 660a 6672 6f6d 202e 7574 696c  to_tf.from .util
+00000d80: 732e 7479 7069 6e67 2069 6d70 6f72 7420  s.typing import 
+00000d90: 5061 7468 4c69 6b65 0a0a 0a69 6620 5459  PathLike...if TY
+00000da0: 5045 5f43 4845 434b 494e 473a 0a20 2020  PE_CHECKING:.   
+00000db0: 2069 6d70 6f72 7420 7371 6c69 7465 330a   import sqlite3.
+00000dc0: 0a20 2020 2069 6d70 6f72 7420 7371 6c61  .    import sqla
+00000dd0: 6c63 6865 6d79 0a0a 2020 2020 6672 6f6d  lchemy..    from
+00000de0: 202e 6461 7461 7365 745f 6469 6374 2069   .dataset_dict i
+00000df0: 6d70 6f72 7420 4461 7461 7365 7444 6963  mport DatasetDic
+00000e00: 740a 0a6c 6f67 6765 7220 3d20 6c6f 6767  t..logger = logg
+00000e10: 696e 672e 6765 745f 6c6f 6767 6572 285f  ing.get_logger(_
+00000e20: 5f6e 616d 655f 5f29 0a0a 0a63 6c61 7373  _name__)...class
+00000e30: 2044 6174 6173 6574 496e 666f 4d69 7869   DatasetInfoMixi
+00000e40: 6e3a 0a20 2020 2022 2222 5468 6973 2062  n:.    """This b
+00000e50: 6173 6520 636c 6173 7320 6578 706f 7365  ase class expose
+00000e60: 7320 736f 6d65 2061 7474 7269 6275 7465  s some attribute
+00000e70: 7320 6f66 2044 6174 6173 6574 496e 666f  s of DatasetInfo
+00000e80: 0a20 2020 2061 7420 7468 6520 6261 7365  .    at the base
+00000e90: 206c 6576 656c 206f 6620 7468 6520 4461   level of the Da
+00000ea0: 7461 7365 7420 666f 7220 6561 7379 2061  taset for easy a
+00000eb0: 6363 6573 732e 0a20 2020 2022 2222 0a0a  ccess..    """..
+00000ec0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00000ed0: 2873 656c 662c 2069 6e66 6f3a 2044 6174  (self, info: Dat
+00000ee0: 6173 6574 496e 666f 2c20 7370 6c69 743a  asetInfo, split:
+00000ef0: 204f 7074 696f 6e61 6c5b 4e61 6d65 6453   Optional[NamedS
+00000f00: 706c 6974 5d29 3a0a 2020 2020 2020 2020  plit]):.        
+00000f10: 7365 6c66 2e5f 696e 666f 203d 2069 6e66  self._info = inf
+00000f20: 6f0a 2020 2020 2020 2020 7365 6c66 2e5f  o.        self._
+00000f30: 7370 6c69 7420 3d20 7370 6c69 740a 0a20  split = split.. 
+00000f40: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+00000f50: 2064 6566 2069 6e66 6f28 7365 6c66 293a   def info(self):
+00000f60: 0a20 2020 2020 2020 2022 2222 5b60 7e64  .        """[`~d
+00000f70: 6174 6173 6574 732e 4461 7461 7365 7449  atasets.DatasetI
+00000f80: 6e66 6f60 5d20 6f62 6a65 6374 2063 6f6e  nfo`] object con
+00000f90: 7461 696e 696e 6720 616c 6c20 7468 6520  taining all the 
+00000fa0: 6d65 7461 6461 7461 2069 6e20 7468 6520  metadata in the 
+00000fb0: 6461 7461 7365 742e 2222 220a 2020 2020  dataset.""".    
+00000fc0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00000fd0: 5f69 6e66 6f0a 0a20 2020 2040 7072 6f70  _info..    @prop
+00000fe0: 6572 7479 0a20 2020 2064 6566 2073 706c  erty.    def spl
+00000ff0: 6974 2873 656c 6629 3a0a 2020 2020 2020  it(self):.      
+00001000: 2020 2222 225b 607e 6461 7461 7365 7473    """[`~datasets
+00001010: 2e4e 616d 6564 5370 6c69 7460 5d20 6f62  .NamedSplit`] ob
+00001020: 6a65 6374 2063 6f72 7265 7370 6f6e 6469  ject correspondi
+00001030: 6e67 2074 6f20 6120 6e61 6d65 6420 6461  ng to a named da
+00001040: 7461 7365 7420 7370 6c69 742e 2222 220a  taset split.""".
+00001050: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00001060: 656c 662e 5f73 706c 6974 0a0a 2020 2020  elf._split..    
+00001070: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00001080: 6620 6275 696c 6465 725f 6e61 6d65 2873  f builder_name(s
+00001090: 656c 6629 202d 3e20 7374 723a 0a20 2020  elf) -> str:.   
+000010a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000010b0: 2e5f 696e 666f 2e62 7569 6c64 6572 5f6e  ._info.builder_n
+000010c0: 616d 650a 0a20 2020 2040 7072 6f70 6572  ame..    @proper
+000010d0: 7479 0a20 2020 2064 6566 2063 6974 6174  ty.    def citat
+000010e0: 696f 6e28 7365 6c66 2920 2d3e 2073 7472  ion(self) -> str
+000010f0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00001100: 2073 656c 662e 5f69 6e66 6f2e 6369 7461   self._info.cita
+00001110: 7469 6f6e 0a0a 2020 2020 4070 726f 7065  tion..    @prope
+00001120: 7274 790a 2020 2020 6465 6620 636f 6e66  rty.    def conf
+00001130: 6967 5f6e 616d 6528 7365 6c66 2920 2d3e  ig_name(self) ->
+00001140: 2073 7472 3a0a 2020 2020 2020 2020 7265   str:.        re
+00001150: 7475 726e 2073 656c 662e 5f69 6e66 6f2e  turn self._info.
+00001160: 636f 6e66 6967 5f6e 616d 650a 0a20 2020  config_name..   
+00001170: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+00001180: 6566 2064 6174 6173 6574 5f73 697a 6528  ef dataset_size(
+00001190: 7365 6c66 2920 2d3e 204f 7074 696f 6e61  self) -> Optiona
+000011a0: 6c5b 696e 745d 3a0a 2020 2020 2020 2020  l[int]:.        
+000011b0: 7265 7475 726e 2073 656c 662e 5f69 6e66  return self._inf
+000011c0: 6f2e 6461 7461 7365 745f 7369 7a65 0a0a  o.dataset_size..
+000011d0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+000011e0: 2020 6465 6620 6465 7363 7269 7074 696f    def descriptio
+000011f0: 6e28 7365 6c66 2920 2d3e 2073 7472 3a0a  n(self) -> str:.
+00001200: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00001210: 656c 662e 5f69 6e66 6f2e 6465 7363 7269  elf._info.descri
+00001220: 7074 696f 6e0a 0a20 2020 2040 7072 6f70  ption..    @prop
+00001230: 6572 7479 0a20 2020 2064 6566 2064 6f77  erty.    def dow
+00001240: 6e6c 6f61 645f 6368 6563 6b73 756d 7328  nload_checksums(
+00001250: 7365 6c66 2920 2d3e 204f 7074 696f 6e61  self) -> Optiona
+00001260: 6c5b 6469 6374 5d3a 0a20 2020 2020 2020  l[dict]:.       
+00001270: 2072 6574 7572 6e20 7365 6c66 2e5f 696e   return self._in
+00001280: 666f 2e64 6f77 6e6c 6f61 645f 6368 6563  fo.download_chec
+00001290: 6b73 756d 730a 0a20 2020 2040 7072 6f70  ksums..    @prop
+000012a0: 6572 7479 0a20 2020 2064 6566 2064 6f77  erty.    def dow
+000012b0: 6e6c 6f61 645f 7369 7a65 2873 656c 6629  nload_size(self)
+000012c0: 202d 3e20 4f70 7469 6f6e 616c 5b69 6e74   -> Optional[int
+000012d0: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
+000012e0: 6e20 7365 6c66 2e5f 696e 666f 2e64 6f77  n self._info.dow
+000012f0: 6e6c 6f61 645f 7369 7a65 0a0a 2020 2020  nload_size..    
+00001300: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00001310: 6620 6665 6174 7572 6573 2873 656c 6629  f features(self)
+00001320: 202d 3e20 4665 6174 7572 6573 3a0a 2020   -> Features:.  
+00001330: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00001340: 662e 5f69 6e66 6f2e 6665 6174 7572 6573  f._info.features
+00001350: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+00001360: 2020 2020 6465 6620 686f 6d65 7061 6765      def homepage
+00001370: 2873 656c 6629 202d 3e20 4f70 7469 6f6e  (self) -> Option
+00001380: 616c 5b73 7472 5d3a 0a20 2020 2020 2020  al[str]:.       
+00001390: 2072 6574 7572 6e20 7365 6c66 2e5f 696e   return self._in
+000013a0: 666f 2e68 6f6d 6570 6167 650a 0a20 2020  fo.homepage..   
+000013b0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+000013c0: 6566 206c 6963 656e 7365 2873 656c 6629  ef license(self)
+000013d0: 202d 3e20 4f70 7469 6f6e 616c 5b73 7472   -> Optional[str
+000013e0: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
+000013f0: 6e20 7365 6c66 2e5f 696e 666f 2e6c 6963  n self._info.lic
+00001400: 656e 7365 0a0a 2020 2020 4070 726f 7065  ense..    @prope
+00001410: 7274 790a 2020 2020 6465 6620 7369 7a65  rty.    def size
+00001420: 5f69 6e5f 6279 7465 7328 7365 6c66 2920  _in_bytes(self) 
+00001430: 2d3e 204f 7074 696f 6e61 6c5b 696e 745d  -> Optional[int]
+00001440: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00001450: 2073 656c 662e 5f69 6e66 6f2e 7369 7a65   self._info.size
+00001460: 5f69 6e5f 6279 7465 730a 0a20 2020 2040  _in_bytes..    @
+00001470: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00001480: 2073 7570 6572 7669 7365 645f 6b65 7973   supervised_keys
+00001490: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000014a0: 7265 7475 726e 2073 656c 662e 5f69 6e66  return self._inf
+000014b0: 6f2e 7375 7065 7276 6973 6564 5f6b 6579  o.supervised_key
+000014c0: 730a 0a20 2020 2040 7072 6f70 6572 7479  s..    @property
+000014d0: 0a20 2020 2064 6566 2074 6173 6b5f 7465  .    def task_te
+000014e0: 6d70 6c61 7465 7328 7365 6c66 293a 0a20  mplates(self):. 
+000014f0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00001500: 6c66 2e5f 696e 666f 2e74 6173 6b5f 7465  lf._info.task_te
+00001510: 6d70 6c61 7465 730a 0a20 2020 2040 7072  mplates..    @pr
+00001520: 6f70 6572 7479 0a20 2020 2064 6566 2076  operty.    def v
+00001530: 6572 7369 6f6e 2873 656c 6629 3a0a 2020  ersion(self):.  
+00001540: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00001550: 662e 5f69 6e66 6f2e 7665 7273 696f 6e0a  f._info.version.
+00001560: 0a0a 636c 6173 7320 5465 6e73 6f72 666c  ..class Tensorfl
+00001570: 6f77 4461 7461 7365 744d 6978 696e 3a0a  owDatasetMixin:.
+00001580: 2020 2020 5f54 465f 4441 5441 5345 545f      _TF_DATASET_
+00001590: 5245 4653 203d 2073 6574 2829 0a0a 2020  REFS = set()..  
+000015a0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+000015b0: 2020 2020 6465 6620 5f67 6574 5f6f 7574      def _get_out
+000015c0: 7075 745f 7369 676e 6174 7572 6528 0a20  put_signature(. 
+000015d0: 2020 2020 2020 2064 6174 6173 6574 3a20         dataset: 
+000015e0: 2244 6174 6173 6574 222c 0a20 2020 2020  "Dataset",.     
+000015f0: 2020 2063 6f6c 6c61 7465 5f66 6e3a 2043     collate_fn: C
+00001600: 616c 6c61 626c 652c 0a20 2020 2020 2020  allable,.       
+00001610: 2063 6f6c 6c61 7465 5f66 6e5f 6172 6773   collate_fn_args
+00001620: 3a20 6469 6374 2c0a 2020 2020 2020 2020  : dict,.        
+00001630: 636f 6c73 5f74 6f5f 7265 7461 696e 3a20  cols_to_retain: 
+00001640: 4f70 7469 6f6e 616c 5b4c 6973 745b 7374  Optional[List[st
+00001650: 725d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  r]] = None,.    
+00001660: 2020 2020 6261 7463 685f 7369 7a65 3a20      batch_size: 
+00001670: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
+00001680: 4e6f 6e65 2c0a 2020 2020 2020 2020 6e75  None,.        nu
+00001690: 6d5f 7465 7374 5f62 6174 6368 6573 3a20  m_test_batches: 
+000016a0: 696e 7420 3d20 3230 2c0a 2020 2020 293a  int = 20,.    ):
+000016b0: 0a20 2020 2020 2020 2022 2222 5072 6976  .        """Priv
+000016c0: 6174 6520 6d65 7468 6f64 2075 7365 6420  ate method used 
+000016d0: 6279 2060 746f 5f74 665f 6461 7461 7365  by `to_tf_datase
+000016e0: 7428 2960 2074 6f20 6669 6e64 2074 6865  t()` to find the
+000016f0: 2073 6861 7065 7320 616e 6420 6474 7970   shapes and dtyp
+00001700: 6573 206f 6620 7361 6d70 6c65 7320 6672  es of samples fr
+00001710: 6f6d 2074 6869 7320 6461 7461 7365 740a  om this dataset.
+00001720: 2020 2020 2020 2020 2020 2061 6674 6572             after
+00001730: 2062 6569 6e67 2070 6173 7365 6420 7468   being passed th
+00001740: 726f 7567 6820 7468 6520 636f 6c6c 6174  rough the collat
+00001750: 655f 666e 2e20 5465 6e73 6f72 666c 6f77  e_fn. Tensorflow
+00001760: 206e 6565 6473 2061 6e20 6578 6163 7420   needs an exact 
+00001770: 7369 676e 6174 7572 6520 666f 7220 7466  signature for tf
+00001780: 2e6e 756d 7079 5f66 756e 6374 696f 6e2c  .numpy_function,
+00001790: 2073 6f0a 2020 2020 2020 2020 2020 2074   so.           t
+000017a0: 6865 206f 6e6c 7920 7761 7920 746f 2064  he only way to d
+000017b0: 6f20 7468 6973 2069 7320 746f 2072 756e  o this is to run
+000017c0: 2074 6573 7420 6261 7463 6865 7320 2d20   test batches - 
+000017d0: 7468 6520 636f 6c6c 6174 6f72 206d 6179  the collator may
+000017e0: 2061 6464 206f 7220 7265 6e61 6d65 2063   add or rename c
+000017f0: 6f6c 756d 6e73 2c20 736f 2077 6520 6361  olumns, so we ca
+00001800: 6e27 7420 6669 6775 7265 0a20 2020 2020  n't figure.     
+00001810: 2020 2020 2020 6974 206f 7574 206a 7573        it out jus
+00001820: 7420 6279 2069 6e73 7065 6374 696e 6720  t by inspecting 
+00001830: 7468 6520 6461 7461 7365 742e 0a0a 2020  the dataset...  
+00001840: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+00001850: 2020 2020 2020 2020 6461 7461 7365 7420          dataset 
+00001860: 2860 4461 7461 7365 7460 293a 2044 6174  (`Dataset`): Dat
+00001870: 6173 6574 2074 6f20 6c6f 6164 2073 616d  aset to load sam
+00001880: 706c 6573 2066 726f 6d2e 0a20 2020 2020  ples from..     
+00001890: 2020 2020 2020 2063 6f6c 6c61 7465 5f66         collate_f
+000018a0: 6e28 6062 6f6f 6c60 293a 2053 6875 6666  n(`bool`): Shuff
+000018b0: 6c65 2074 6865 2064 6174 6173 6574 206f  le the dataset o
+000018c0: 7264 6572 2077 6865 6e20 6c6f 6164 696e  rder when loadin
+000018d0: 672e 2052 6563 6f6d 6d65 6e64 6564 2054  g. Recommended T
+000018e0: 7275 6520 666f 7220 7472 6169 6e69 6e67  rue for training
+000018f0: 2c20 4661 6c73 6520 666f 720a 2020 2020  , False for.    
+00001900: 2020 2020 2020 2020 2020 2020 7661 6c69              vali
+00001910: 6461 7469 6f6e 2f65 7661 6c75 6174 696f  dation/evaluatio
+00001920: 6e2e 0a20 2020 2020 2020 2020 2020 2063  n..            c
+00001930: 6f6c 6c61 7465 5f66 6e28 6043 616c 6c61  ollate_fn(`Calla
+00001940: 626c 6560 293a 2041 2066 756e 6374 696f  ble`): A functio
+00001950: 6e20 6f72 2063 616c 6c61 626c 6520 6f62  n or callable ob
+00001960: 6a65 6374 2028 7375 6368 2061 7320 6120  ject (such as a 
+00001970: 6044 6174 6143 6f6c 6c61 746f 7260 2920  `DataCollator`) 
+00001980: 7468 6174 2077 696c 6c20 636f 6c6c 6174  that will collat
+00001990: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000019a0: 2020 6c69 7374 7320 6f66 2073 616d 706c    lists of sampl
+000019b0: 6573 2069 6e74 6f20 6120 6261 7463 682e  es into a batch.
+000019c0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+000019d0: 6c61 7465 5f66 6e5f 6172 6773 2028 6044  late_fn_args (`D
+000019e0: 6963 7460 293a 2041 2060 6469 6374 6020  ict`): A `dict` 
+000019f0: 6f66 206b 6579 776f 7264 2061 7267 756d  of keyword argum
+00001a00: 656e 7473 2074 6f20 6265 2070 6173 7365  ents to be passe
+00001a10: 6420 746f 2074 6865 0a20 2020 2020 2020  d to the.       
+00001a20: 2020 2020 2020 2020 2060 636f 6c6c 6174           `collat
+00001a30: 655f 666e 602e 0a20 2020 2020 2020 2020  e_fn`..         
+00001a40: 2020 2062 6174 6368 5f73 697a 6520 2860     batch_size (`
+00001a50: 696e 7460 2c20 6f70 7469 6f6e 616c 293a  int`, optional):
+00001a60: 2054 6865 2073 697a 6520 6f66 2062 6174   The size of bat
+00001a70: 6368 6573 206c 6f61 6465 6420 6672 6f6d  ches loaded from
+00001a80: 2074 6865 2064 6174 6173 6574 2e20 5573   the dataset. Us
+00001a90: 6564 2066 6f72 2073 6861 7065 2069 6e66  ed for shape inf
+00001aa0: 6572 656e 6365 2e0a 2020 2020 2020 2020  erence..        
+00001ab0: 2020 2020 2020 2020 4361 6e20 6265 204e          Can be N
+00001ac0: 6f6e 652c 2077 6869 6368 2069 6e64 6963  one, which indic
+00001ad0: 6174 6573 2074 6861 7420 6261 7463 6820  ates that batch 
+00001ae0: 7369 7a65 7320 6361 6e20 6265 2076 6172  sizes can be var
+00001af0: 6961 626c 652e 0a20 2020 2020 2020 2020  iable..         
+00001b00: 2020 206e 756d 5f74 6573 745f 6261 7463     num_test_batc
+00001b10: 6865 7320 2860 696e 7460 293a 2054 6865  hes (`int`): The
+00001b20: 206e 756d 6265 7220 6f66 2062 6174 6368   number of batch
+00001b30: 6573 2074 6f20 6c6f 6164 2066 726f 6d20  es to load from 
+00001b40: 7468 6520 6461 7461 7365 7420 666f 7220  the dataset for 
+00001b50: 7368 6170 6520 696e 6665 7265 6e63 652e  shape inference.
+00001b60: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00001b70: 733a 0a20 2020 2020 2020 2020 2020 2060  s:.            `
+00001b80: 6469 6374 603a 2044 6963 7420 6d61 7070  dict`: Dict mapp
+00001b90: 696e 6720 636f 6c75 6d6e 206e 616d 6573  ing column names
+00001ba0: 2074 6f20 7466 2e54 656e 736f 7273 7065   to tf.Tensorspe
+00001bb0: 6320 6f62 6a65 6374 730a 2020 2020 2020  c objects.      
+00001bc0: 2020 2020 2020 6064 6963 7460 3a20 4469        `dict`: Di
+00001bd0: 6374 206d 6170 7069 6e67 2063 6f6c 756d  ct mapping colum
+00001be0: 6e20 6e61 6d65 7320 746f 206e 702e 6474  n names to np.dt
+00001bf0: 7970 6520 6f62 6a65 6374 730a 2020 2020  ype objects.    
+00001c00: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00001c10: 6966 2063 6f6e 6669 672e 5446 5f41 5641  if config.TF_AVA
+00001c20: 494c 4142 4c45 3a0a 2020 2020 2020 2020  ILABLE:.        
+00001c30: 2020 2020 696d 706f 7274 2074 656e 736f      import tenso
+00001c40: 7266 6c6f 7720 6173 2074 660a 2020 2020  rflow as tf.    
+00001c50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00001c60: 2020 2020 2020 7261 6973 6520 496d 706f        raise Impo
+00001c70: 7274 4572 726f 7228 2243 616c 6c65 6420  rtError("Called 
+00001c80: 6120 5465 6e73 6f72 666c 6f77 2d73 7065  a Tensorflow-spe
+00001c90: 6369 6669 6320 6675 6e63 7469 6f6e 2062  cific function b
+00001ca0: 7574 2054 656e 736f 7266 6c6f 7720 6973  ut Tensorflow is
+00001cb0: 206e 6f74 2069 6e73 7461 6c6c 6564 2e22   not installed."
+00001cc0: 290a 0a20 2020 2020 2020 2069 6620 6c65  )..        if le
+00001cd0: 6e28 6461 7461 7365 7429 203d 3d20 303a  n(dataset) == 0:
+00001ce0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00001cf0: 7365 2056 616c 7565 4572 726f 7228 2255  se ValueError("U
+00001d00: 6e61 626c 6520 746f 2067 6574 2074 6865  nable to get the
+00001d10: 206f 7574 7075 7420 7369 676e 6174 7572   output signatur
+00001d20: 6520 6265 6361 7573 6520 7468 6520 6461  e because the da
+00001d30: 7461 7365 7420 6973 2065 6d70 7479 2e22  taset is empty."
+00001d40: 290a 2020 2020 2020 2020 6966 2062 6174  ).        if bat
+00001d50: 6368 5f73 697a 6520 6973 206e 6f74 204e  ch_size is not N
+00001d60: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00001d70: 2062 6174 6368 5f73 697a 6520 3d20 6d69   batch_size = mi
+00001d80: 6e28 6c65 6e28 6461 7461 7365 7429 2c20  n(len(dataset), 
+00001d90: 6261 7463 685f 7369 7a65 290a 2020 2020  batch_size).    
+00001da0: 2020 2020 7465 7374 5f62 6174 6368 5f73      test_batch_s
+00001db0: 697a 6520 3d20 310a 0a20 2020 2020 2020  ize = 1..       
+00001dc0: 2069 6620 636f 6c73 5f74 6f5f 7265 7461   if cols_to_reta
+00001dd0: 696e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  in is not None:.
+00001de0: 2020 2020 2020 2020 2020 2020 636f 6c73              cols
+00001df0: 5f74 6f5f 7265 7461 696e 203d 206c 6973  _to_retain = lis
+00001e00: 7428 7365 7428 636f 6c73 5f74 6f5f 7265  t(set(cols_to_re
+00001e10: 7461 696e 202b 205b 226c 6162 656c 5f69  tain + ["label_i
+00001e20: 6473 222c 2022 6c61 6265 6c22 2c20 226c  ds", "label", "l
+00001e30: 6162 656c 7322 5d29 290a 0a20 2020 2020  abels"]))..     
+00001e40: 2020 2074 6573 745f 6261 7463 6865 7320     test_batches 
+00001e50: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+00001e60: 205f 2069 6e20 7261 6e67 6528 6e75 6d5f   _ in range(num_
+00001e70: 7465 7374 5f62 6174 6368 6573 293a 0a20  test_batches):. 
+00001e80: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
+00001e90: 6573 203d 2073 616d 706c 6528 7261 6e67  es = sample(rang
+00001ea0: 6528 6c65 6e28 6461 7461 7365 7429 292c  e(len(dataset)),
+00001eb0: 2074 6573 745f 6261 7463 685f 7369 7a65   test_batch_size
+00001ec0: 290a 2020 2020 2020 2020 2020 2020 7465  ).            te
+00001ed0: 7374 5f62 6174 6368 203d 2064 6174 6173  st_batch = datas
+00001ee0: 6574 5b69 6e64 6963 6573 5d0a 2020 2020  et[indices].    
+00001ef0: 2020 2020 2020 2020 6966 2063 6f6c 735f          if cols_
+00001f00: 746f 5f72 6574 6169 6e20 6973 206e 6f74  to_retain is not
+00001f10: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00001f20: 2020 2020 2020 2074 6573 745f 6261 7463         test_batc
+00001f30: 6820 3d20 7b6b 6579 3a20 7661 6c75 6520  h = {key: value 
+00001f40: 666f 7220 6b65 792c 2076 616c 7565 2069  for key, value i
+00001f50: 6e20 7465 7374 5f62 6174 6368 2e69 7465  n test_batch.ite
+00001f60: 6d73 2829 2069 6620 6b65 7920 696e 2063  ms() if key in c
+00001f70: 6f6c 735f 746f 5f72 6574 6169 6e7d 0a20  ols_to_retain}. 
+00001f80: 2020 2020 2020 2020 2020 2074 6573 745f             test_
+00001f90: 6261 7463 6820 3d20 5b7b 6b65 793a 2076  batch = [{key: v
+00001fa0: 616c 7565 5b69 5d20 666f 7220 6b65 792c  alue[i] for key,
+00001fb0: 2076 616c 7565 2069 6e20 7465 7374 5f62   value in test_b
+00001fc0: 6174 6368 2e69 7465 6d73 2829 7d20 666f  atch.items()} fo
+00001fd0: 7220 6920 696e 2072 616e 6765 2874 6573  r i in range(tes
+00001fe0: 745f 6261 7463 685f 7369 7a65 295d 0a20  t_batch_size)]. 
+00001ff0: 2020 2020 2020 2020 2020 2074 6573 745f             test_
+00002000: 6261 7463 6820 3d20 636f 6c6c 6174 655f  batch = collate_
+00002010: 666e 2874 6573 745f 6261 7463 682c 202a  fn(test_batch, *
+00002020: 2a63 6f6c 6c61 7465 5f66 6e5f 6172 6773  *collate_fn_args
+00002030: 290a 2020 2020 2020 2020 2020 2020 7465  ).            te
+00002040: 7374 5f62 6174 6368 6573 2e61 7070 656e  st_batches.appen
+00002050: 6428 7465 7374 5f62 6174 6368 290a 0a20  d(test_batch).. 
+00002060: 2020 2020 2020 2074 665f 636f 6c75 6d6e         tf_column
+00002070: 735f 746f 5f73 6967 6e61 7475 7265 7320  s_to_signatures 
+00002080: 3d20 7b7d 0a20 2020 2020 2020 206e 705f  = {}.        np_
+00002090: 636f 6c75 6d6e 735f 746f 5f64 7479 7065  columns_to_dtype
+000020a0: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
+000020b0: 6f72 2063 6f6c 756d 6e20 696e 2074 6573  or column in tes
+000020c0: 745f 6261 7463 6865 735b 305d 2e6b 6579  t_batches[0].key
+000020d0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+000020e0: 2072 6177 5f61 7272 6179 7320 3d20 5b62   raw_arrays = [b
+000020f0: 6174 6368 5b63 6f6c 756d 6e5d 2066 6f72  atch[column] for
+00002100: 2062 6174 6368 2069 6e20 7465 7374 5f62   batch in test_b
+00002110: 6174 6368 6573 5d0a 2020 2020 2020 2020  atches].        
+00002120: 2020 2020 2320 496e 2063 6173 6520 7468      # In case th
+00002130: 6520 636f 6c6c 6174 655f 666e 2072 6574  e collate_fn ret
+00002140: 7572 6e73 2073 6f6d 6574 6869 6e67 2073  urns something s
+00002150: 7472 616e 6765 0a20 2020 2020 2020 2020  trange.         
+00002160: 2020 206e 705f 6172 7261 7973 203d 205b     np_arrays = [
+00002170: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
+00002180: 7220 6172 7261 7920 696e 2072 6177 5f61  r array in raw_a
+00002190: 7272 6179 733a 0a20 2020 2020 2020 2020  rrays:.         
+000021a0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+000021b0: 616e 6365 2861 7272 6179 2c20 6e70 2e6e  ance(array, np.n
+000021c0: 6461 7272 6179 293a 0a20 2020 2020 2020  darray):.       
+000021d0: 2020 2020 2020 2020 2020 2020 206e 705f               np_
+000021e0: 6172 7261 7973 2e61 7070 656e 6428 6172  arrays.append(ar
+000021f0: 7261 7929 0a20 2020 2020 2020 2020 2020  ray).           
+00002200: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00002210: 616e 6365 2861 7272 6179 2c20 7466 2e54  ance(array, tf.T
+00002220: 656e 736f 7229 3a0a 2020 2020 2020 2020  ensor):.        
+00002230: 2020 2020 2020 2020 2020 2020 6e70 5f61              np_a
+00002240: 7272 6179 732e 6170 7065 6e64 2861 7272  rrays.append(arr
+00002250: 6179 2e6e 756d 7079 2829 290a 2020 2020  ay.numpy()).    
+00002260: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00002270: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002280: 2020 2020 2020 6e70 5f61 7272 6179 732e        np_arrays.
+00002290: 6170 7065 6e64 286e 702e 6172 7261 7928  append(np.array(
+000022a0: 6172 7261 7929 290a 0a20 2020 2020 2020  array))..       
+000022b0: 2020 2020 2069 6620 6e70 2e69 7373 7562       if np.issub
+000022c0: 6474 7970 6528 6e70 5f61 7272 6179 735b  dtype(np_arrays[
+000022d0: 305d 2e64 7479 7065 2c20 6e70 2e69 6e74  0].dtype, np.int
+000022e0: 6567 6572 2920 6f72 206e 705f 6172 7261  eger) or np_arra
+000022f0: 7973 5b30 5d2e 6474 7970 6520 3d3d 2062  ys[0].dtype == b
+00002300: 6f6f 6c3a 0a20 2020 2020 2020 2020 2020  ool:.           
+00002310: 2020 2020 2074 665f 6474 7970 6520 3d20       tf_dtype = 
+00002320: 7466 2e69 6e74 3634 0a20 2020 2020 2020  tf.int64.       
+00002330: 2020 2020 2020 2020 206e 705f 6474 7970           np_dtyp
+00002340: 6520 3d20 6e70 2e69 6e74 3634 0a20 2020  e = np.int64.   
+00002350: 2020 2020 2020 2020 2065 6c69 6620 6e70           elif np
+00002360: 2e69 7373 7562 6474 7970 6528 6e70 5f61  .issubdtype(np_a
+00002370: 7272 6179 735b 305d 2e64 7479 7065 2c20  rrays[0].dtype, 
+00002380: 6e70 2e6e 756d 6265 7229 3a0a 2020 2020  np.number):.    
+00002390: 2020 2020 2020 2020 2020 2020 7466 5f64              tf_d
+000023a0: 7479 7065 203d 2074 662e 666c 6f61 7433  type = tf.float3
+000023b0: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
+000023c0: 2020 6e70 5f64 7479 7065 203d 206e 702e    np_dtype = np.
+000023d0: 666c 6f61 7433 320a 2020 2020 2020 2020  float32.        
+000023e0: 2020 2020 656c 6966 206e 705f 6172 7261      elif np_arra
+000023f0: 7973 5b30 5d2e 6474 7970 652e 6b69 6e64  ys[0].dtype.kind
+00002400: 203d 3d20 2255 223a 2020 2320 556e 6963   == "U":  # Unic
+00002410: 6f64 6520 7374 7269 6e67 730a 2020 2020  ode strings.    
+00002420: 2020 2020 2020 2020 2020 2020 6e70 5f64              np_d
+00002430: 7479 7065 203d 206e 702e 756e 6963 6f64  type = np.unicod
+00002440: 655f 0a20 2020 2020 2020 2020 2020 2020  e_.             
+00002450: 2020 2074 665f 6474 7970 6520 3d20 7466     tf_dtype = tf
+00002460: 2e73 7472 696e 670a 2020 2020 2020 2020  .string.        
+00002470: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00002480: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00002490: 5275 6e74 696d 6545 7272 6f72 280a 2020  RuntimeError(.  
+000024a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000024b0: 2020 6622 556e 7265 636f 676e 697a 6564    f"Unrecognized
+000024c0: 2061 7272 6179 2064 7479 7065 207b 6e70   array dtype {np
+000024d0: 5f61 7272 6179 735b 305d 2e64 7479 7065  _arrays[0].dtype
+000024e0: 7d2e 205c 6e22 0a20 2020 2020 2020 2020  }. \n".         
+000024f0: 2020 2020 2020 2020 2020 2022 4e65 7374             "Nest
+00002500: 6564 2074 7970 6573 2061 6e64 2069 6d61  ed types and ima
+00002510: 6765 2f61 7564 696f 2074 7970 6573 2061  ge/audio types a
+00002520: 7265 206e 6f74 2073 7570 706f 7274 6564  re not supported
+00002530: 2079 6574 2e22 0a20 2020 2020 2020 2020   yet.".         
+00002540: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00002550: 2020 2020 2073 6861 7065 7320 3d20 5b61       shapes = [a
+00002560: 7272 6179 2e73 6861 7065 2066 6f72 2061  rray.shape for a
+00002570: 7272 6179 2069 6e20 6e70 5f61 7272 6179  rray in np_array
+00002580: 735d 0a20 2020 2020 2020 2020 2020 2073  s].            s
+00002590: 7461 7469 635f 7368 6170 6520 3d20 5b5d  tatic_shape = []
+000025a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000025b0: 2064 696d 2069 6e20 7261 6e67 6528 6c65   dim in range(le
+000025c0: 6e28 7368 6170 6573 5b30 5d29 293a 0a20  n(shapes[0])):. 
+000025d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000025e0: 697a 6573 203d 2073 6574 285b 7368 6170  izes = set([shap
+000025f0: 655b 6469 6d5d 2066 6f72 2073 6861 7065  e[dim] for shape
+00002600: 2069 6e20 7368 6170 6573 5d29 0a20 2020   in shapes]).   
+00002610: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00002620: 6469 6d20 3d3d 2030 3a0a 2020 2020 2020  dim == 0:.      
+00002630: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00002640: 6174 6963 5f73 6861 7065 2e61 7070 656e  atic_shape.appen
+00002650: 6428 6261 7463 685f 7369 7a65 290a 2020  d(batch_size).  
+00002660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002670: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+00002680: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00002690: 6e28 7369 7a65 7329 203d 3d20 313a 2020  n(sizes) == 1:  
+000026a0: 2320 5468 6973 2064 696d 656e 7369 6f6e  # This dimension
+000026b0: 206c 6f6f 6b73 2063 6f6e 7374 616e 740a   looks constant.
+000026c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000026d0: 2020 2020 7374 6174 6963 5f73 6861 7065      static_shape
+000026e0: 2e61 7070 656e 6428 7369 7a65 732e 706f  .append(sizes.po
+000026f0: 7028 2929 0a20 2020 2020 2020 2020 2020  p()).           
+00002700: 2020 2020 2065 6c73 653a 2020 2320 5573       else:  # Us
+00002710: 6520 4e6f 6e65 2066 6f72 2076 6172 6961  e None for varia
+00002720: 626c 6520 6469 6d65 6e73 696f 6e73 0a20  ble dimensions. 
+00002730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002740: 2020 2073 7461 7469 635f 7368 6170 652e     static_shape.
+00002750: 6170 7065 6e64 284e 6f6e 6529 0a20 2020  append(None).   
+00002760: 2020 2020 2020 2020 2074 665f 636f 6c75           tf_colu
+00002770: 6d6e 735f 746f 5f73 6967 6e61 7475 7265  mns_to_signature
+00002780: 735b 636f 6c75 6d6e 5d20 3d20 7466 2e54  s[column] = tf.T
+00002790: 656e 736f 7253 7065 6328 7368 6170 653d  ensorSpec(shape=
+000027a0: 7374 6174 6963 5f73 6861 7065 2c20 6474  static_shape, dt
+000027b0: 7970 653d 7466 5f64 7479 7065 290a 2020  ype=tf_dtype).  
+000027c0: 2020 2020 2020 2020 2020 6e70 5f63 6f6c            np_col
+000027d0: 756d 6e73 5f74 6f5f 6474 7970 6573 5b63  umns_to_dtypes[c
+000027e0: 6f6c 756d 6e5d 203d 206e 705f 6474 7970  olumn] = np_dtyp
+000027f0: 650a 0a20 2020 2020 2020 2072 6574 7572  e..        retur
+00002800: 6e20 7466 5f63 6f6c 756d 6e73 5f74 6f5f  n tf_columns_to_
+00002810: 7369 676e 6174 7572 6573 2c20 6e70 5f63  signatures, np_c
+00002820: 6f6c 756d 6e73 5f74 6f5f 6474 7970 6573  olumns_to_dtypes
+00002830: 0a0a 2020 2020 6465 6620 746f 5f74 665f  ..    def to_tf_
+00002840: 6461 7461 7365 7428 0a20 2020 2020 2020  dataset(.       
+00002850: 2073 656c 662c 0a20 2020 2020 2020 2062   self,.        b
+00002860: 6174 6368 5f73 697a 653a 2069 6e74 2c0a  atch_size: int,.
+00002870: 2020 2020 2020 2020 636f 6c75 6d6e 733a          columns:
+00002880: 204f 7074 696f 6e61 6c5b 556e 696f 6e5b   Optional[Union[
+00002890: 7374 722c 204c 6973 745b 7374 725d 5d5d  str, List[str]]]
+000028a0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000028b0: 2073 6875 6666 6c65 3a20 626f 6f6c 203d   shuffle: bool =
+000028c0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+000028d0: 636f 6c6c 6174 655f 666e 3a20 4f70 7469  collate_fn: Opti
+000028e0: 6f6e 616c 5b43 616c 6c61 626c 655d 203d  onal[Callable] =
+000028f0: 204e 6f6e 652c 0a20 2020 2020 2020 2064   None,.        d
+00002900: 726f 705f 7265 6d61 696e 6465 723a 2062  rop_remainder: b
+00002910: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+00002920: 2020 2020 2063 6f6c 6c61 7465 5f66 6e5f       collate_fn_
+00002930: 6172 6773 3a20 4f70 7469 6f6e 616c 5b44  args: Optional[D
+00002940: 6963 745b 7374 722c 2041 6e79 5d5d 203d  ict[str, Any]] =
+00002950: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
+00002960: 6162 656c 5f63 6f6c 733a 204f 7074 696f  abel_cols: Optio
+00002970: 6e61 6c5b 556e 696f 6e5b 7374 722c 204c  nal[Union[str, L
+00002980: 6973 745b 7374 725d 5d5d 203d 204e 6f6e  ist[str]]] = Non
+00002990: 652c 0a20 2020 2020 2020 2070 7265 6665  e,.        prefe
+000029a0: 7463 683a 2062 6f6f 6c20 3d20 5472 7565  tch: bool = True
+000029b0: 2c0a 2020 2020 2020 2020 6e75 6d5f 776f  ,.        num_wo
+000029c0: 726b 6572 733a 2069 6e74 203d 2030 2c0a  rkers: int = 0,.
+000029d0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+000029e0: 2222 4372 6561 7465 2061 2060 7466 2e64  ""Create a `tf.d
+000029f0: 6174 612e 4461 7461 7365 7460 2066 726f  ata.Dataset` fro
+00002a00: 6d20 7468 6520 756e 6465 726c 7969 6e67  m the underlying
+00002a10: 2044 6174 6173 6574 2e20 5468 6973 2060   Dataset. This `
+00002a20: 7466 2e64 6174 612e 4461 7461 7365 7460  tf.data.Dataset`
+00002a30: 2077 696c 6c20 6c6f 6164 2061 6e64 2063   will load and c
+00002a40: 6f6c 6c61 7465 2062 6174 6368 6573 2066  ollate batches f
+00002a50: 726f 6d0a 2020 2020 2020 2020 7468 6520  rom.        the 
+00002a60: 4461 7461 7365 742c 2061 6e64 2069 7320  Dataset, and is 
+00002a70: 7375 6974 6162 6c65 2066 6f72 2070 6173  suitable for pas
+00002a80: 7369 6e67 2074 6f20 6d65 7468 6f64 7320  sing to methods 
+00002a90: 6c69 6b65 2060 6d6f 6465 6c2e 6669 7428  like `model.fit(
+00002aa0: 2960 206f 7220 606d 6f64 656c 2e70 7265  )` or `model.pre
+00002ab0: 6469 6374 2829 602e 2054 6865 2064 6174  dict()`. The dat
+00002ac0: 6173 6574 2077 696c 6c20 7969 656c 640a  aset will yield.
+00002ad0: 2020 2020 2020 2020 6064 6963 7473 6020          `dicts` 
+00002ae0: 666f 7220 626f 7468 2069 6e70 7574 7320  for both inputs 
+00002af0: 616e 6420 6c61 6265 6c73 2075 6e6c 6573  and labels unles
+00002b00: 7320 7468 6520 6064 6963 7460 2077 6f75  s the `dict` wou
+00002b10: 6c64 2063 6f6e 7461 696e 206f 6e6c 7920  ld contain only 
+00002b20: 6120 7369 6e67 6c65 206b 6579 2c20 696e  a single key, in
+00002b30: 2077 6869 6368 2063 6173 6520 6120 7261   which case a ra
+00002b40: 770a 2020 2020 2020 2020 6074 662e 5465  w.        `tf.Te
+00002b50: 6e73 6f72 6020 6973 2079 6965 6c64 6564  nsor` is yielded
+00002b60: 2069 6e73 7465 6164 2e0a 0a20 2020 2020   instead...     
+00002b70: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00002b80: 2020 2020 2062 6174 6368 5f73 697a 6520       batch_size 
+00002b90: 2860 696e 7460 293a 0a20 2020 2020 2020  (`int`):.       
+00002ba0: 2020 2020 2020 2020 2053 697a 6520 6f66           Size of
+00002bb0: 2062 6174 6368 6573 2074 6f20 6c6f 6164   batches to load
+00002bc0: 2066 726f 6d20 7468 6520 6461 7461 7365   from the datase
+00002bd0: 742e 0a20 2020 2020 2020 2020 2020 2063  t..            c
+00002be0: 6f6c 756d 6e73 2028 604c 6973 745b 7374  olumns (`List[st
+00002bf0: 725d 6020 6f72 2060 7374 7260 2c20 2a6f  r]` or `str`, *o
+00002c00: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
+00002c10: 2020 2020 2020 2020 2020 2044 6174 6173             Datas
+00002c20: 6574 2063 6f6c 756d 6e28 7329 2074 6f20  et column(s) to 
+00002c30: 6c6f 6164 2069 6e20 7468 6520 6074 662e  load in the `tf.
+00002c40: 6461 7461 2e44 6174 6173 6574 602e 0a20  data.Dataset`.. 
+00002c50: 2020 2020 2020 2020 2020 2020 2020 2043                 C
+00002c60: 6f6c 756d 6e20 6e61 6d65 7320 7468 6174  olumn names that
+00002c70: 2061 7265 2063 7265 6174 6564 2062 7920   are created by 
+00002c80: 7468 6520 6063 6f6c 6c61 7465 5f66 6e60  the `collate_fn`
+00002c90: 2061 6e64 2074 6861 7420 646f 206e 6f74   and that do not
+00002ca0: 2065 7869 7374 2069 6e20 7468 6520 6f72   exist in the or
+00002cb0: 6967 696e 616c 2064 6174 6173 6574 2063  iginal dataset c
+00002cc0: 616e 2062 6520 7573 6564 2e0a 2020 2020  an be used..    
+00002cd0: 2020 2020 2020 2020 7368 7566 666c 6528          shuffle(
+00002ce0: 6062 6f6f 6c60 2c20 6465 6661 756c 7473  `bool`, defaults
+00002cf0: 2074 6f20 6046 616c 7365 6029 3a0a 2020   to `False`):.  
+00002d00: 2020 2020 2020 2020 2020 2020 2020 5368                Sh
+00002d10: 7566 666c 6520 7468 6520 6461 7461 7365  uffle the datase
+00002d20: 7420 6f72 6465 7220 7768 656e 206c 6f61  t order when loa
+00002d30: 6469 6e67 2e20 5265 636f 6d6d 656e 6465  ding. Recommende
+00002d40: 6420 6054 7275 6560 2066 6f72 2074 7261  d `True` for tra
+00002d50: 696e 696e 672c 2060 4661 6c73 6560 2066  ining, `False` f
+00002d60: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
+00002d70: 2020 2076 616c 6964 6174 696f 6e2f 6576     validation/ev
+00002d80: 616c 7561 7469 6f6e 2e0a 2020 2020 2020  aluation..      
+00002d90: 2020 2020 2020 6472 6f70 5f72 656d 6169        drop_remai
+00002da0: 6e64 6572 2860 626f 6f6c 602c 2064 6566  nder(`bool`, def
+00002db0: 6175 6c74 7320 746f 2060 4661 6c73 6560  aults to `False`
+00002dc0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00002dd0: 2020 2044 726f 7020 7468 6520 6c61 7374     Drop the last
+00002de0: 2069 6e63 6f6d 706c 6574 6520 6261 7463   incomplete batc
+00002df0: 6820 7768 656e 206c 6f61 6469 6e67 2e20  h when loading. 
+00002e00: 456e 7375 7265 730a 2020 2020 2020 2020  Ensures.        
+00002e10: 2020 2020 2020 2020 7468 6174 2061 6c6c          that all
+00002e20: 2062 6174 6368 6573 2079 6965 6c64 6564   batches yielded
+00002e30: 2062 7920 7468 6520 6461 7461 7365 7420   by the dataset 
+00002e40: 7769 6c6c 2068 6176 6520 7468 6520 7361  will have the sa
+00002e50: 6d65 206c 656e 6774 6820 6f6e 2074 6865  me length on the
+00002e60: 2062 6174 6368 2064 696d 656e 7369 6f6e   batch dimension
+00002e70: 2e0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+00002e80: 6c6c 6174 655f 666e 2860 4361 6c6c 6162  llate_fn(`Callab
+00002e90: 6c65 602c 202a 6f70 7469 6f6e 616c 2a29  le`, *optional*)
+00002ea0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002eb0: 2020 4120 6675 6e63 7469 6f6e 206f 7220    A function or 
+00002ec0: 6361 6c6c 6162 6c65 206f 626a 6563 7420  callable object 
+00002ed0: 2873 7563 6820 6173 2061 2060 4461 7461  (such as a `Data
+00002ee0: 436f 6c6c 6174 6f72 6029 2074 6861 7420  Collator`) that 
+00002ef0: 7769 6c6c 2063 6f6c 6c61 7465 0a20 2020  will collate.   
+00002f00: 2020 2020 2020 2020 2020 2020 206c 6973               lis
+00002f10: 7473 206f 6620 7361 6d70 6c65 7320 696e  ts of samples in
+00002f20: 746f 2061 2062 6174 6368 2e0a 2020 2020  to a batch..    
+00002f30: 2020 2020 2020 2020 636f 6c6c 6174 655f          collate_
+00002f40: 666e 5f61 7267 7320 2860 4469 6374 602c  fn_args (`Dict`,
+00002f50: 202a 6f70 7469 6f6e 616c 2a29 3a0a 2020   *optional*):.  
+00002f60: 2020 2020 2020 2020 2020 2020 2020 416e                An
+00002f70: 206f 7074 696f 6e61 6c20 6064 6963 7460   optional `dict`
+00002f80: 206f 6620 6b65 7977 6f72 6420 6172 6775   of keyword argu
+00002f90: 6d65 6e74 7320 746f 2062 6520 7061 7373  ments to be pass
+00002fa0: 6564 2074 6f20 7468 650a 2020 2020 2020  ed to the.      
+00002fb0: 2020 2020 2020 2020 2020 6063 6f6c 6c61            `colla
+00002fc0: 7465 5f66 6e60 2e0a 2020 2020 2020 2020  te_fn`..        
+00002fd0: 2020 2020 6c61 6265 6c5f 636f 6c73 2028      label_cols (
+00002fe0: 604c 6973 745b 7374 725d 6020 6f72 2060  `List[str]` or `
+00002ff0: 7374 7260 2c20 6465 6661 756c 7473 2074  str`, defaults t
+00003000: 6f20 604e 6f6e 6560 293a 0a20 2020 2020  o `None`):.     
+00003010: 2020 2020 2020 2020 2020 2044 6174 6173             Datas
+00003020: 6574 2063 6f6c 756d 6e28 7329 2074 6f20  et column(s) to 
+00003030: 6c6f 6164 2061 7320 6c61 6265 6c73 2e0a  load as labels..
+00003040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003050: 4e6f 7465 2074 6861 7420 6d61 6e79 206d  Note that many m
+00003060: 6f64 656c 7320 636f 6d70 7574 6520 6c6f  odels compute lo
+00003070: 7373 2069 6e74 6572 6e61 6c6c 7920 7261  ss internally ra
+00003080: 7468 6572 2074 6861 6e20 6c65 7474 696e  ther than lettin
+00003090: 6720 4b65 7261 7320 646f 2069 742c 2069  g Keras do it, i
+000030a0: 6e20 7768 6963 6820 6361 7365 0a20 2020  n which case.   
+000030b0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+000030c0: 7369 6e67 2074 6865 206c 6162 656c 7320  sing the labels 
+000030d0: 6865 7265 2069 7320 6f70 7469 6f6e 616c  here is optional
+000030e0: 2c20 6173 206c 6f6e 6720 6173 2074 6865  , as long as the
+000030f0: 7927 7265 2069 6e20 7468 6520 696e 7075  y're in the inpu
+00003100: 7420 6063 6f6c 756d 6e73 602e 0a20 2020  t `columns`..   
+00003110: 2020 2020 2020 2020 2070 7265 6665 7463           prefetc
+00003120: 6820 2860 626f 6f6c 602c 2064 6566 6175  h (`bool`, defau
+00003130: 6c74 7320 746f 2060 5472 7565 6029 3a0a  lts to `True`):.
+00003140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003150: 5768 6574 6865 7220 746f 2072 756e 2074  Whether to run t
+00003160: 6865 2064 6174 616c 6f61 6465 7220 696e  he dataloader in
+00003170: 2061 2073 6570 6172 6174 6520 7468 7265   a separate thre
+00003180: 6164 2061 6e64 206d 6169 6e74 6169 6e0a  ad and maintain.
+00003190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031a0: 6120 736d 616c 6c20 6275 6666 6572 206f  a small buffer o
+000031b0: 6620 6261 7463 6865 7320 666f 7220 7472  f batches for tr
+000031c0: 6169 6e69 6e67 2e20 496d 7072 6f76 6573  aining. Improves
+000031d0: 2070 6572 666f 726d 616e 6365 2062 7920   performance by 
+000031e0: 616c 6c6f 7769 6e67 2064 6174 6120 746f  allowing data to
+000031f0: 2062 6520 6c6f 6164 6564 2069 6e20 7468   be loaded in th
+00003200: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00003210: 2020 6261 636b 6772 6f75 6e64 2077 6869    background whi
+00003220: 6c65 2074 6865 206d 6f64 656c 2069 7320  le the model is 
+00003230: 7472 6169 6e69 6e67 2e0a 2020 2020 2020  training..      
+00003240: 2020 2020 2020 6e75 6d5f 776f 726b 6572        num_worker
+00003250: 7320 2860 696e 7460 2c20 6465 6661 756c  s (`int`, defaul
+00003260: 7473 2074 6f20 6030 6029 3a0a 2020 2020  ts to `0`):.    
+00003270: 2020 2020 2020 2020 2020 2020 4e75 6d62              Numb
+00003280: 6572 206f 6620 776f 726b 6572 7320 746f  er of workers to
+00003290: 2075 7365 2066 6f72 206c 6f61 6469 6e67   use for loading
+000032a0: 2074 6865 2064 6174 6173 6574 2e20 4f6e   the dataset. On
+000032b0: 6c79 2073 7570 706f 7274 6564 206f 6e20  ly supported on 
+000032c0: 5079 7468 6f6e 2076 6572 7369 6f6e 7320  Python versions 
+000032d0: 3e3d 2033 2e38 2e0a 0a20 2020 2020 2020  >= 3.8...       
+000032e0: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
+000032f0: 2020 2020 2020 6074 662e 6461 7461 2e44        `tf.data.D
+00003300: 6174 6173 6574 600a 0a20 2020 2020 2020  ataset`..       
+00003310: 2045 7861 6d70 6c65 3a0a 0a20 2020 2020   Example:..     
+00003320: 2020 2060 6060 7079 0a20 2020 2020 2020     ```py.       
+00003330: 203e 3e3e 2064 735f 7472 6169 6e20 3d20   >>> ds_train = 
+00003340: 6473 5b22 7472 6169 6e22 5d2e 746f 5f74  ds["train"].to_t
+00003350: 665f 6461 7461 7365 7428 0a20 2020 2020  f_dataset(.     
+00003360: 2020 202e 2e2e 2020 2020 636f 6c75 6d6e     ...    column
+00003370: 733d 5b27 696e 7075 745f 6964 7327 2c20  s=['input_ids', 
+00003380: 2774 6f6b 656e 5f74 7970 655f 6964 7327  'token_type_ids'
+00003390: 2c20 2761 7474 656e 7469 6f6e 5f6d 6173  , 'attention_mas
+000033a0: 6b27 2c20 276c 6162 656c 275d 2c0a 2020  k', 'label'],.  
+000033b0: 2020 2020 2020 2e2e 2e20 2020 2073 6875        ...    shu
+000033c0: 6666 6c65 3d54 7275 652c 0a20 2020 2020  ffle=True,.     
+000033d0: 2020 202e 2e2e 2020 2020 6261 7463 685f     ...    batch_
+000033e0: 7369 7a65 3d31 362c 0a20 2020 2020 2020  size=16,.       
+000033f0: 202e 2e2e 2020 2020 636f 6c6c 6174 655f   ...    collate_
+00003400: 666e 3d64 6174 615f 636f 6c6c 6174 6f72  fn=data_collator
+00003410: 2c0a 2020 2020 2020 2020 2e2e 2e20 290a  ,.        ... ).
+00003420: 2020 2020 2020 2020 6060 600a 2020 2020          ```.    
+00003430: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00003440: 6966 2063 6f6e 6669 672e 5446 5f41 5641  if config.TF_AVA
+00003450: 494c 4142 4c45 3a0a 2020 2020 2020 2020  ILABLE:.        
+00003460: 2020 2020 696d 706f 7274 2074 656e 736f      import tenso
+00003470: 7266 6c6f 7720 6173 2074 660a 2020 2020  rflow as tf.    
+00003480: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00003490: 2020 2020 2020 7261 6973 6520 496d 706f        raise Impo
+000034a0: 7274 4572 726f 7228 2243 616c 6c65 6420  rtError("Called 
+000034b0: 6120 5465 6e73 6f72 666c 6f77 2d73 7065  a Tensorflow-spe
+000034c0: 6369 6669 6320 6675 6e63 7469 6f6e 2062  cific function b
+000034d0: 7574 2054 656e 736f 7266 6c6f 7720 6973  ut Tensorflow is
+000034e0: 206e 6f74 2069 6e73 7461 6c6c 6564 2e22   not installed."
+000034f0: 290a 0a20 2020 2020 2020 2069 6620 6973  )..        if is
+00003500: 696e 7374 616e 6365 2874 662e 6469 7374  instance(tf.dist
+00003510: 7269 6275 7465 2e67 6574 5f73 7472 6174  ribute.get_strat
+00003520: 6567 7928 292c 2074 662e 6469 7374 7269  egy(), tf.distri
+00003530: 6275 7465 2e54 5055 5374 7261 7465 6779  bute.TPUStrategy
+00003540: 293a 0a20 2020 2020 2020 2020 2020 206c  ):.            l
+00003550: 6f67 6765 722e 7761 726e 696e 6728 0a20  ogger.warning(. 
+00003560: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00003570: 4e6f 7465 2074 6861 7420 746f 5f74 665f  Note that to_tf_
+00003580: 6461 7461 7365 7428 2920 6c6f 6164 7320  dataset() loads 
+00003590: 7468 6520 6461 7461 2077 6974 6820 6120  the data with a 
+000035a0: 6765 6e65 7261 746f 7220 7261 7468 6572  generator rather
+000035b0: 2074 6861 6e20 6120 6675 6c6c 2074 662e   than a full tf.
+000035c0: 6461 7461 2022 0a20 2020 2020 2020 2020  data ".         
+000035d0: 2020 2020 2020 2022 7069 7065 6c69 6e65         "pipeline
+000035e0: 2061 6e64 2069 7320 6e6f 7420 636f 6d70   and is not comp
+000035f0: 6174 6962 6c65 2077 6974 6820 7265 6d6f  atible with remo
+00003600: 7465 2054 5055 2063 6f6e 6e65 6374 696f  te TPU connectio
+00003610: 6e73 2e20 4966 2079 6f75 2065 6e63 6f75  ns. If you encou
+00003620: 6e74 6572 2065 7272 6f72 732c 2070 6c65  nter errors, ple
+00003630: 6173 6520 220a 2020 2020 2020 2020 2020  ase ".          
+00003640: 2020 2020 2020 2274 7279 2075 7369 6e67        "try using
+00003650: 2061 2054 5055 2056 4d20 6f72 2c20 6966   a TPU VM or, if
+00003660: 2079 6f75 7220 6461 7461 2063 616e 2066   your data can f
+00003670: 6974 2069 6e20 6d65 6d6f 7279 2c20 6c6f  it in memory, lo
+00003680: 6164 696e 6720 6974 2069 6e74 6f20 6d65  ading it into me
+00003690: 6d6f 7279 2061 7320 6120 6469 6374 206f  mory as a dict o
+000036a0: 6620 220a 2020 2020 2020 2020 2020 2020  f ".            
+000036b0: 2020 2020 2254 656e 736f 7273 2069 6e73      "Tensors ins
+000036c0: 7465 6164 206f 6620 7374 7265 616d 696e  tead of streamin
+000036d0: 6720 7769 7468 2074 6f5f 7466 5f64 6174  g with to_tf_dat
+000036e0: 6173 6574 2829 2e22 0a20 2020 2020 2020  aset().".       
+000036f0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00003700: 6966 206e 756d 5f77 6f72 6b65 7273 203e  if num_workers >
+00003710: 2030 2061 6e64 2073 7973 2e76 6572 7369   0 and sys.versi
+00003720: 6f6e 5f69 6e66 6f20 3c20 2833 2c20 3829  on_info < (3, 8)
+00003730: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00003740: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00003750: 5573 696e 6720 6d75 6c74 6970 6c65 2077  Using multiple w
+00003760: 6f72 6b65 7273 2069 7320 6f6e 6c79 2073  orkers is only s
+00003770: 7570 706f 7274 6564 206f 6e20 5079 7468  upported on Pyth
+00003780: 6f6e 2076 6572 7369 6f6e 7320 3e3d 2033  on versions >= 3
+00003790: 2e38 2e22 290a 0a20 2020 2020 2020 2069  .8.")..        i
+000037a0: 6620 636f 6c6c 6174 655f 666e 2069 7320  f collate_fn is 
+000037b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000037c0: 2020 2320 5365 7420 6120 7665 7279 2073    # Set a very s
+000037d0: 696d 706c 6520 6465 6661 756c 7420 636f  imple default co
+000037e0: 6c6c 6174 6f72 2074 6861 7420 6a75 7374  llator that just
+000037f0: 2073 7461 636b 7320 7468 696e 6773 2074   stacks things t
+00003800: 6f67 6574 6865 720a 2020 2020 2020 2020  ogether.        
+00003810: 2020 2020 636f 6c6c 6174 655f 666e 203d      collate_fn =
+00003820: 206d 696e 696d 616c 5f74 665f 636f 6c6c   minimal_tf_coll
+00003830: 6174 655f 666e 0a20 2020 2020 2020 2069  ate_fn.        i
+00003840: 6620 636f 6c6c 6174 655f 666e 5f61 7267  f collate_fn_arg
+00003850: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00003860: 2020 2020 2020 2063 6f6c 6c61 7465 5f66         collate_f
+00003870: 6e5f 6172 6773 203d 207b 7d0a 2020 2020  n_args = {}.    
+00003880: 2020 2020 6966 206c 6162 656c 5f63 6f6c      if label_col
+00003890: 7320 616e 6420 6e6f 7420 636f 6c75 6d6e  s and not column
+000038a0: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+000038b0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+000038c0: 2243 616e 6e6f 7420 7370 6563 6966 7920  "Cannot specify 
+000038d0: 6c61 6265 6c5f 636f 6c73 2077 6974 686f  label_cols witho
+000038e0: 7574 2073 7065 6369 6679 696e 6720 636f  ut specifying co
+000038f0: 6c75 6d6e 7321 2229 0a20 2020 2020 2020  lumns!").       
+00003900: 2069 6620 6c61 6265 6c5f 636f 6c73 2069   if label_cols i
+00003910: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00003920: 2020 2020 6c61 6265 6c5f 636f 6c73 203d      label_cols =
+00003930: 205b 5d0a 2020 2020 2020 2020 656c 6966   [].        elif
+00003940: 2069 7369 6e73 7461 6e63 6528 6c61 6265   isinstance(labe
+00003950: 6c5f 636f 6c73 2c20 7374 7229 3a0a 2020  l_cols, str):.  
+00003960: 2020 2020 2020 2020 2020 6c61 6265 6c5f            label_
+00003970: 636f 6c73 203d 205b 6c61 6265 6c5f 636f  cols = [label_co
+00003980: 6c73 5d0a 2020 2020 2020 2020 6966 206c  ls].        if l
+00003990: 656e 2873 6574 286c 6162 656c 5f63 6f6c  en(set(label_col
+000039a0: 7329 2920 3c20 6c65 6e28 6c61 6265 6c5f  s)) < len(label_
+000039b0: 636f 6c73 293a 0a20 2020 2020 2020 2020  cols):.         
+000039c0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+000039d0: 726f 7228 224c 6973 7420 6f66 206c 6162  ror("List of lab
+000039e0: 656c 5f63 6f6c 7320 636f 6e74 6169 6e73  el_cols contains
+000039f0: 2064 7570 6c69 6361 7465 732e 2229 0a20   duplicates."). 
+00003a00: 2020 2020 2020 2069 6620 636f 6c75 6d6e         if column
+00003a10: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+00003a20: 6620 6973 696e 7374 616e 6365 2863 6f6c  f isinstance(col
+00003a30: 756d 6e73 2c20 7374 7229 3a0a 2020 2020  umns, str):.    
+00003a40: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+00003a50: 6d6e 7320 3d20 5b63 6f6c 756d 6e73 5d0a  mns = [columns].
+00003a60: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00003a70: 656e 2873 6574 2863 6f6c 756d 6e73 2929  en(set(columns))
+00003a80: 203c 206c 656e 2863 6f6c 756d 6e73 293a   < len(columns):
+00003a90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003aa0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00003ab0: 7228 224c 6973 7420 6f66 2063 6f6c 756d  r("List of colum
+00003ac0: 6e73 2063 6f6e 7461 696e 7320 6475 706c  ns contains dupl
+00003ad0: 6963 6174 6573 2e22 290a 2020 2020 2020  icates.").      
+00003ae0: 2020 2020 2020 636f 6c73 5f74 6f5f 7265        cols_to_re
+00003af0: 7461 696e 203d 206c 6973 7428 7365 7428  tain = list(set(
+00003b00: 636f 6c75 6d6e 7320 2b20 6c61 6265 6c5f  columns + label_
+00003b10: 636f 6c73 2929 0a20 2020 2020 2020 2065  cols)).        e
+00003b20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00003b30: 2063 6f6c 735f 746f 5f72 6574 6169 6e20   cols_to_retain 
+00003b40: 3d20 4e6f 6e65 2020 2320 496e 6469 6361  = None  # Indica
+00003b50: 7465 7320 6b65 6570 696e 6720 616c 6c20  tes keeping all 
+00003b60: 7661 6c69 6420 636f 6c75 6d6e 730a 2020  valid columns.  
+00003b70: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
+00003b80: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+00003b90: 6966 2073 656c 662e 666f 726d 6174 5b22  if self.format["
+00003ba0: 7479 7065 225d 2021 3d20 2263 7573 746f  type"] != "custo
+00003bb0: 6d22 3a0a 2020 2020 2020 2020 2020 2020  m":.            
+00003bc0: 6461 7461 7365 7420 3d20 7365 6c66 2e77  dataset = self.w
+00003bd0: 6974 685f 666f 726d 6174 2822 6e75 6d70  ith_format("nump
+00003be0: 7922 290a 2020 2020 2020 2020 656c 7365  y").        else
+00003bf0: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
+00003c00: 7461 7365 7420 3d20 7365 6c66 0a0a 2020  taset = self..  
+00003c10: 2020 2020 2020 2320 544f 444f 284d 6174        # TODO(Mat
+00003c20: 742c 2051 4c29 3a20 6465 7072 6563 6174  t, QL): deprecat
+00003c30: 6520 7468 6520 7265 7465 6e74 696f 6e20  e the retention 
+00003c40: 6f66 206c 6162 656c 5f69 6473 2061 6e64  of label_ids and
+00003c50: 206c 6162 656c 0a0a 2020 2020 2020 2020   label..        
+00003c60: 6f75 7470 7574 5f73 6967 6e61 7475 7265  output_signature
+00003c70: 2c20 636f 6c75 6d6e 735f 746f 5f6e 705f  , columns_to_np_
+00003c80: 7479 7065 7320 3d20 6461 7461 7365 742e  types = dataset.
+00003c90: 5f67 6574 5f6f 7574 7075 745f 7369 676e  _get_output_sign
+00003ca0: 6174 7572 6528 0a20 2020 2020 2020 2020  ature(.         
+00003cb0: 2020 2064 6174 6173 6574 2c0a 2020 2020     dataset,.    
+00003cc0: 2020 2020 2020 2020 636f 6c6c 6174 655f          collate_
+00003cd0: 666e 3d63 6f6c 6c61 7465 5f66 6e2c 0a20  fn=collate_fn,. 
+00003ce0: 2020 2020 2020 2020 2020 2063 6f6c 6c61             colla
+00003cf0: 7465 5f66 6e5f 6172 6773 3d63 6f6c 6c61  te_fn_args=colla
+00003d00: 7465 5f66 6e5f 6172 6773 2c0a 2020 2020  te_fn_args,.    
+00003d10: 2020 2020 2020 2020 636f 6c73 5f74 6f5f          cols_to_
+00003d20: 7265 7461 696e 3d63 6f6c 735f 746f 5f72  retain=cols_to_r
+00003d30: 6574 6169 6e2c 0a20 2020 2020 2020 2020  etain,.         
+00003d40: 2020 2062 6174 6368 5f73 697a 653d 6261     batch_size=ba
+00003d50: 7463 685f 7369 7a65 2069 6620 6472 6f70  tch_size if drop
+00003d60: 5f72 656d 6169 6e64 6572 2065 6c73 6520  _remainder else 
+00003d70: 4e6f 6e65 2c0a 2020 2020 2020 2020 290a  None,.        ).
+00003d80: 0a20 2020 2020 2020 2069 6620 226c 6162  .        if "lab
+00003d90: 656c 7322 2069 6e20 6f75 7470 7574 5f73  els" in output_s
+00003da0: 6967 6e61 7475 7265 3a0a 2020 2020 2020  ignature:.      
+00003db0: 2020 2020 2020 6966 2028 226c 6162 656c        if ("label
+00003dc0: 5f69 6473 2220 696e 2063 6f6c 756d 6e73  _ids" in columns
+00003dd0: 206f 7220 226c 6162 656c 2220 696e 2063   or "label" in c
+00003de0: 6f6c 756d 6e73 2920 616e 6420 226c 6162  olumns) and "lab
+00003df0: 656c 7322 206e 6f74 2069 6e20 636f 6c75  els" not in colu
+00003e00: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
+00003e10: 2020 2020 2063 6f6c 756d 6e73 203d 205b       columns = [
+00003e20: 636f 6c20 666f 7220 636f 6c20 696e 2063  col for col in c
+00003e30: 6f6c 756d 6e73 2069 6620 636f 6c20 6e6f  olumns if col no
+00003e40: 7420 696e 205b 226c 6162 656c 5f69 6473  t in ["label_ids
+00003e50: 222c 2022 6c61 6265 6c22 5d5d 202b 205b  ", "label"]] + [
+00003e60: 226c 6162 656c 7322 5d0a 2020 2020 2020  "labels"].      
+00003e70: 2020 2020 2020 6966 2028 226c 6162 656c        if ("label
+00003e80: 5f69 6473 2220 696e 206c 6162 656c 5f63  _ids" in label_c
+00003e90: 6f6c 7320 6f72 2022 6c61 6265 6c22 2069  ols or "label" i
+00003ea0: 6e20 6c61 6265 6c5f 636f 6c73 2920 616e  n label_cols) an
+00003eb0: 6420 226c 6162 656c 7322 206e 6f74 2069  d "labels" not i
+00003ec0: 6e20 6c61 6265 6c5f 636f 6c73 3a0a 2020  n label_cols:.  
+00003ed0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00003ee0: 6265 6c5f 636f 6c73 203d 205b 636f 6c20  bel_cols = [col 
+00003ef0: 666f 7220 636f 6c20 696e 206c 6162 656c  for col in label
+00003f00: 5f63 6f6c 7320 6966 2063 6f6c 206e 6f74  _cols if col not
+00003f10: 2069 6e20 5b22 6c61 6265 6c5f 6964 7322   in ["label_ids"
+00003f20: 2c20 226c 6162 656c 225d 5d20 2b20 5b22  , "label"]] + ["
+00003f30: 6c61 6265 6c73 225d 0a0a 2020 2020 2020  labels"]..      
+00003f40: 2020 666f 7220 636f 6c20 696e 2063 6f6c    for col in col
+00003f50: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
+00003f60: 2020 6966 2063 6f6c 206e 6f74 2069 6e20    if col not in 
+00003f70: 6f75 7470 7574 5f73 6967 6e61 7475 7265  output_signature
+00003f80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003f90: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00003fa0: 6f72 2866 2243 6f6c 756d 6e20 7b63 6f6c  or(f"Column {col
+00003fb0: 7d20 6e6f 7420 666f 756e 6420 696e 2064  } not found in d
+00003fc0: 6174 6173 6574 2122 290a 0a20 2020 2020  ataset!")..     
+00003fd0: 2020 2066 6f72 2063 6f6c 2069 6e20 6c61     for col in la
+00003fe0: 6265 6c5f 636f 6c73 3a0a 2020 2020 2020  bel_cols:.      
+00003ff0: 2020 2020 2020 6966 2063 6f6c 206e 6f74        if col not
+00004000: 2069 6e20 6f75 7470 7574 5f73 6967 6e61   in output_signa
+00004010: 7475 7265 3a0a 2020 2020 2020 2020 2020  ture:.          
+00004020: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00004030: 6545 7272 6f72 2866 224c 6162 656c 2063  eError(f"Label c
+00004040: 6f6c 756d 6e20 7b63 6f6c 7d20 6e6f 7420  olumn {col} not 
+00004050: 666f 756e 6420 696e 2064 6174 6173 6574  found in dataset
+00004060: 2122 290a 0a20 2020 2020 2020 2069 6620  !")..        if 
+00004070: 6e75 6d5f 776f 726b 6572 7320 3d3d 2030  num_workers == 0
+00004080: 3a0a 2020 2020 2020 2020 2020 2020 7466  :.            tf
+00004090: 5f64 6174 6173 6574 203d 2064 6174 6173  _dataset = datas
+000040a0: 6574 5f74 6f5f 7466 280a 2020 2020 2020  et_to_tf(.      
+000040b0: 2020 2020 2020 2020 2020 6461 7461 7365            datase
+000040c0: 743d 6461 7461 7365 742c 0a20 2020 2020  t=dataset,.     
+000040d0: 2020 2020 2020 2020 2020 2063 6f6c 735f             cols_
+000040e0: 746f 5f72 6574 6169 6e3d 636f 6c73 5f74  to_retain=cols_t
+000040f0: 6f5f 7265 7461 696e 2c0a 2020 2020 2020  o_retain,.      
+00004100: 2020 2020 2020 2020 2020 636f 6c6c 6174            collat
+00004110: 655f 666e 3d63 6f6c 6c61 7465 5f66 6e2c  e_fn=collate_fn,
+00004120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004130: 2063 6f6c 6c61 7465 5f66 6e5f 6172 6773   collate_fn_args
+00004140: 3d63 6f6c 6c61 7465 5f66 6e5f 6172 6773  =collate_fn_args
+00004150: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004160: 2020 636f 6c75 6d6e 735f 746f 5f6e 705f    columns_to_np_
+00004170: 7479 7065 733d 636f 6c75 6d6e 735f 746f  types=columns_to
+00004180: 5f6e 705f 7479 7065 732c 0a20 2020 2020  _np_types,.     
+00004190: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+000041a0: 745f 7369 676e 6174 7572 653d 6f75 7470  t_signature=outp
+000041b0: 7574 5f73 6967 6e61 7475 7265 2c0a 2020  ut_signature,.  
+000041c0: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+000041d0: 7566 666c 653d 7368 7566 666c 652c 0a20  uffle=shuffle,. 
+000041e0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+000041f0: 6174 6368 5f73 697a 653d 6261 7463 685f  atch_size=batch_
+00004200: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
+00004210: 2020 2020 2020 6472 6f70 5f72 656d 6169        drop_remai
+00004220: 6e64 6572 3d64 726f 705f 7265 6d61 696e  nder=drop_remain
+00004230: 6465 722c 0a20 2020 2020 2020 2020 2020  der,.           
+00004240: 2029 0a20 2020 2020 2020 2065 6c69 6620   ).        elif 
+00004250: 6e75 6d5f 776f 726b 6572 7320 3e20 303a  num_workers > 0:
+00004260: 0a20 2020 2020 2020 2020 2020 2074 665f  .            tf_
+00004270: 6461 7461 7365 7420 3d20 6d75 6c74 6970  dataset = multip
+00004280: 726f 6365 7373 5f64 6174 6173 6574 5f74  rocess_dataset_t
+00004290: 6f5f 7466 280a 2020 2020 2020 2020 2020  o_tf(.          
+000042a0: 2020 2020 2020 6461 7461 7365 743d 6461        dataset=da
+000042b0: 7461 7365 742c 0a20 2020 2020 2020 2020  taset,.         
+000042c0: 2020 2020 2020 2063 6f6c 735f 746f 5f72         cols_to_r
+000042d0: 6574 6169 6e3d 636f 6c73 5f74 6f5f 7265  etain=cols_to_re
+000042e0: 7461 696e 2c0a 2020 2020 2020 2020 2020  tain,.          
+000042f0: 2020 2020 2020 636f 6c6c 6174 655f 666e        collate_fn
+00004300: 3d63 6f6c 6c61 7465 5f66 6e2c 0a20 2020  =collate_fn,.   
+00004310: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+00004320: 6c61 7465 5f66 6e5f 6172 6773 3d63 6f6c  late_fn_args=col
+00004330: 6c61 7465 5f66 6e5f 6172 6773 2c0a 2020  late_fn_args,.  
+00004340: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00004350: 6c75 6d6e 735f 746f 5f6e 705f 7479 7065  lumns_to_np_type
+00004360: 733d 636f 6c75 6d6e 735f 746f 5f6e 705f  s=columns_to_np_
+00004370: 7479 7065 732c 0a20 2020 2020 2020 2020  types,.         
+00004380: 2020 2020 2020 206f 7574 7075 745f 7369         output_si
+00004390: 676e 6174 7572 653d 6f75 7470 7574 5f73  gnature=output_s
+000043a0: 6967 6e61 7475 7265 2c0a 2020 2020 2020  ignature,.      
+000043b0: 2020 2020 2020 2020 2020 7368 7566 666c            shuffl
+000043c0: 653d 7368 7566 666c 652c 0a20 2020 2020  e=shuffle,.     
+000043d0: 2020 2020 2020 2020 2020 2062 6174 6368             batch
+000043e0: 5f73 697a 653d 6261 7463 685f 7369 7a65  _size=batch_size
+000043f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004400: 2020 6472 6f70 5f72 656d 6169 6e64 6572    drop_remainder
+00004410: 3d64 726f 705f 7265 6d61 696e 6465 722c  =drop_remainder,
 00004420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004430: 206f 7574 5f62 6174 6368 2e61 7070 656e   out_batch.appen
-00004440: 6428 6172 7261 7929 0a20 2020 2020 2020  d(array).       
-00004450: 2020 2020 2072 6574 7572 6e20 6f75 745f       return out_
-00004460: 6261 7463 680a 0a20 2020 2020 2020 2040  batch..        @
-00004470: 7466 2e66 756e 6374 696f 6e28 696e 7075  tf.function(inpu
-00004480: 745f 7369 676e 6174 7572 653d 5b74 662e  t_signature=[tf.
-00004490: 5465 6e73 6f72 5370 6563 284e 6f6e 652c  TensorSpec(None,
-000044a0: 2074 662e 696e 7436 3429 5d29 0a20 2020   tf.int64)]).   
-000044b0: 2020 2020 2064 6566 2066 6574 6368 5f66       def fetch_f
-000044c0: 756e 6374 696f 6e28 696e 6469 6365 7329  unction(indices)
-000044d0: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
-000044e0: 7470 7574 203d 2074 662e 6e75 6d70 795f  tput = tf.numpy_
-000044f0: 6675 6e63 7469 6f6e 280a 2020 2020 2020  function(.      
-00004500: 2020 2020 2020 2020 2020 6e70 5f67 6574            np_get
-00004510: 5f62 6174 6368 2c0a 2020 2020 2020 2020  _batch,.        
-00004520: 2020 2020 2020 2020 696e 703d 5b69 6e64          inp=[ind
-00004530: 6963 6573 5d2c 0a20 2020 2020 2020 2020  ices],.         
-00004540: 2020 2020 2020 2023 2054 6869 7320 776f         # This wo
-00004550: 726b 7320 6265 6361 7573 6520 6469 6374  rks because dict
-00004560: 696f 6e61 7269 6573 2061 6c77 6179 7320  ionaries always 
-00004570: 6f75 7470 7574 2069 6e20 7468 6520 7361  output in the sa
-00004580: 6d65 206f 7264 6572 0a20 2020 2020 2020  me order.       
-00004590: 2020 2020 2020 2020 2054 6f75 743d 5b74           Tout=[t
-000045a0: 662e 6474 7970 6573 2e61 735f 6474 7970  f.dtypes.as_dtyp
-000045b0: 6528 6474 7970 6529 2066 6f72 2064 7479  e(dtype) for dty
-000045c0: 7065 2069 6e20 636f 6c75 6d6e 735f 746f  pe in columns_to
-000045d0: 5f6e 705f 7479 7065 732e 7661 6c75 6573  _np_types.values
-000045e0: 2829 5d2c 0a20 2020 2020 2020 2020 2020  ()],.           
-000045f0: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
-00004600: 6574 7572 6e20 7b6b 6579 3a20 6f75 7470  eturn {key: outp
-00004610: 7574 5b69 5d20 666f 7220 692c 206b 6579  ut[i] for i, key
-00004620: 2069 6e20 656e 756d 6572 6174 6528 636f   in enumerate(co
-00004630: 6c75 6d6e 735f 746f 5f6e 705f 7479 7065  lumns_to_np_type
-00004640: 732e 6b65 7973 2829 297d 0a0a 2020 2020  s.keys())}..    
-00004650: 2020 2020 7466 5f64 6174 6173 6574 203d      tf_dataset =
-00004660: 2074 662e 6461 7461 2e44 6174 6173 6574   tf.data.Dataset
-00004670: 2e66 726f 6d5f 7465 6e73 6f72 5f73 6c69  .from_tensor_sli
-00004680: 6365 7328 6e70 2e61 7261 6e67 6528 6c65  ces(np.arange(le
-00004690: 6e28 6461 7461 7365 7429 2c20 6474 7970  n(dataset), dtyp
-000046a0: 653d 6e70 2e69 6e74 3634 2929 0a0a 2020  e=np.int64))..  
-000046b0: 2020 2020 2020 6966 2073 6875 6666 6c65        if shuffle
-000046c0: 3a0a 2020 2020 2020 2020 2020 2020 7466  :.            tf
-000046d0: 5f64 6174 6173 6574 203d 2074 665f 6461  _dataset = tf_da
-000046e0: 7461 7365 742e 7368 7566 666c 6528 6c65  taset.shuffle(le
-000046f0: 6e28 6461 7461 7365 7429 290a 0a20 2020  n(dataset))..   
-00004700: 2020 2020 2074 665f 6461 7461 7365 7420       tf_dataset 
-00004710: 3d20 7466 5f64 6174 6173 6574 2e62 6174  = tf_dataset.bat
-00004720: 6368 2862 6174 6368 5f73 697a 652c 2064  ch(batch_size, d
-00004730: 726f 705f 7265 6d61 696e 6465 723d 6472  rop_remainder=dr
-00004740: 6f70 5f72 656d 6169 6e64 6572 292e 6d61  op_remainder).ma
-00004750: 7028 6665 7463 685f 6675 6e63 7469 6f6e  p(fetch_function
-00004760: 290a 0a20 2020 2020 2020 2064 6566 2065  )..        def e
-00004770: 6e73 7572 655f 7368 6170 6573 2869 6e70  nsure_shapes(inp
-00004780: 7574 5f64 6963 7429 3a0a 2020 2020 2020  ut_dict):.      
-00004790: 2020 2020 2020 7265 7475 726e 207b 6b65        return {ke
-000047a0: 793a 2074 662e 656e 7375 7265 5f73 6861  y: tf.ensure_sha
-000047b0: 7065 2876 616c 2c20 6f75 7470 7574 5f73  pe(val, output_s
-000047c0: 6967 6e61 7475 7265 5b6b 6579 5d2e 7368  ignature[key].sh
-000047d0: 6170 6529 2066 6f72 206b 6579 2c20 7661  ape) for key, va
-000047e0: 6c20 696e 2069 6e70 7574 5f64 6963 742e  l in input_dict.
-000047f0: 6974 656d 7328 297d 0a0a 2020 2020 2020  items()}..      
-00004800: 2020 7466 5f64 6174 6173 6574 203d 2074    tf_dataset = t
-00004810: 665f 6461 7461 7365 742e 6d61 7028 656e  f_dataset.map(en
-00004820: 7375 7265 5f73 6861 7065 7329 0a0a 2020  sure_shapes)..  
-00004830: 2020 2020 2020 6465 6620 7370 6c69 745f        def split_
-00004840: 6665 6174 7572 6573 5f61 6e64 5f6c 6162  features_and_lab
-00004850: 656c 7328 696e 7075 745f 6261 7463 6829  els(input_batch)
-00004860: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00004870: 544f 444f 284d 6174 742c 2051 4c29 3a20  TODO(Matt, QL): 
-00004880: 6465 7072 6563 6174 6520 7265 7475 726e  deprecate return
-00004890: 696e 6720 7468 6520 6469 6374 2063 6f6e  ing the dict con
-000048a0: 7465 6e74 2077 6865 6e20 7468 6572 6527  tent when there'
-000048b0: 7320 6f6e 6c79 206f 6e65 206b 6579 0a20  s only one key. 
-000048c0: 2020 2020 2020 2020 2020 2066 6561 7475             featu
-000048d0: 7265 7320 3d20 7b6b 6579 3a20 7465 6e73  res = {key: tens
-000048e0: 6f72 2066 6f72 206b 6579 2c20 7465 6e73  or for key, tens
-000048f0: 6f72 2069 6e20 696e 7075 745f 6261 7463  or in input_batc
-00004900: 682e 6974 656d 7328 2920 6966 206b 6579  h.items() if key
-00004910: 2069 6e20 636f 6c75 6d6e 737d 0a20 2020   in columns}.   
-00004920: 2020 2020 2020 2020 206c 6162 656c 7320           labels 
-00004930: 3d20 7b6b 6579 3a20 7465 6e73 6f72 2066  = {key: tensor f
-00004940: 6f72 206b 6579 2c20 7465 6e73 6f72 2069  or key, tensor i
-00004950: 6e20 696e 7075 745f 6261 7463 682e 6974  n input_batch.it
-00004960: 656d 7328 2920 6966 206b 6579 2069 6e20  ems() if key in 
-00004970: 6c61 6265 6c5f 636f 6c73 7d0a 2020 2020  label_cols}.    
-00004980: 2020 2020 2020 2020 6966 206c 656e 2866          if len(f
-00004990: 6561 7475 7265 7329 203d 3d20 313a 0a20  eatures) == 1:. 
-000049a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000049b0: 6561 7475 7265 7320 3d20 6c69 7374 2866  eatures = list(f
-000049c0: 6561 7475 7265 732e 7661 6c75 6573 2829  eatures.values()
-000049d0: 295b 305d 0a20 2020 2020 2020 2020 2020  )[0].           
-000049e0: 2069 6620 6c65 6e28 6c61 6265 6c73 2920   if len(labels) 
-000049f0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-00004a00: 2020 2020 2020 6c61 6265 6c73 203d 206c        labels = l
-00004a10: 6973 7428 6c61 6265 6c73 2e76 616c 7565  ist(labels.value
-00004a20: 7328 2929 5b30 5d0a 2020 2020 2020 2020  s())[0].        
-00004a30: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00004a40: 6528 6c61 6265 6c73 2c20 6469 6374 2920  e(labels, dict) 
-00004a50: 616e 6420 6c65 6e28 6c61 6265 6c73 2920  and len(labels) 
-00004a60: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00004a70: 2020 2020 2020 7265 7475 726e 2066 6561        return fea
-00004a80: 7475 7265 730a 2020 2020 2020 2020 2020  tures.          
-00004a90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00004aa0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-00004ab0: 6561 7475 7265 732c 206c 6162 656c 730a  eatures, labels.
-00004ac0: 0a20 2020 2020 2020 2069 6620 636f 6c73  .        if cols
-00004ad0: 5f74 6f5f 7265 7461 696e 2069 7320 6e6f  _to_retain is no
-00004ae0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00004af0: 2020 2020 7466 5f64 6174 6173 6574 203d      tf_dataset =
-00004b00: 2074 665f 6461 7461 7365 742e 6d61 7028   tf_dataset.map(
-00004b10: 7370 6c69 745f 6665 6174 7572 6573 5f61  split_features_a
-00004b20: 6e64 5f6c 6162 656c 7329 0a0a 2020 2020  nd_labels)..    
-00004b30: 2020 2020 6966 2070 7265 6665 7463 683a      if prefetch:
-00004b40: 0a20 2020 2020 2020 2020 2020 2074 665f  .            tf_
-00004b50: 6461 7461 7365 7420 3d20 7466 5f64 6174  dataset = tf_dat
-00004b60: 6173 6574 2e70 7265 6665 7463 6828 7466  aset.prefetch(tf
-00004b70: 2e64 6174 612e 6578 7065 7269 6d65 6e74  .data.experiment
-00004b80: 616c 2e41 5554 4f54 554e 4529 0a0a 2020  al.AUTOTUNE)..  
-00004b90: 2020 2020 2020 2320 5265 6d6f 7665 2061        # Remove a
-00004ba0: 2072 6566 6572 656e 6365 2074 6f20 7468   reference to th
-00004bb0: 6520 6f70 656e 2041 7272 6f77 2066 696c  e open Arrow fil
-00004bc0: 6520 6f6e 2064 656c 6574 650a 2020 2020  e on delete.    
-00004bd0: 2020 2020 6465 6620 636c 6561 6e75 705f      def cleanup_
-00004be0: 6361 6c6c 6261 636b 2872 6566 293a 0a20  callback(ref):. 
-00004bf0: 2020 2020 2020 2020 2020 2064 6174 6173             datas
-00004c00: 6574 2e5f 5f64 656c 5f5f 2829 0a20 2020  et.__del__().   
-00004c10: 2020 2020 2020 2020 2073 656c 662e 5f54           self._T
-00004c20: 465f 4441 5441 5345 545f 5245 4653 2e72  F_DATASET_REFS.r
-00004c30: 656d 6f76 6528 7265 6629 0a0a 2020 2020  emove(ref)..    
-00004c40: 2020 2020 7365 6c66 2e5f 5446 5f44 4154      self._TF_DAT
-00004c50: 4153 4554 5f52 4546 532e 6164 6428 7765  ASET_REFS.add(we
-00004c60: 616b 7265 662e 7265 6628 7466 5f64 6174  akref.ref(tf_dat
-00004c70: 6173 6574 2c20 636c 6561 6e75 705f 6361  aset, cleanup_ca
-00004c80: 6c6c 6261 636b 2929 0a0a 2020 2020 2020  llback))..      
-00004c90: 2020 7265 7475 726e 2074 665f 6461 7461    return tf_data
-00004ca0: 7365 740a 0a0a 636c 6173 7320 4461 7461  set...class Data
-00004cb0: 7365 7454 7261 6e73 666f 726d 6174 696f  setTransformatio
-00004cc0: 6e4e 6f74 416c 6c6f 7765 6445 7272 6f72  nNotAllowedError
-00004cd0: 2845 7863 6570 7469 6f6e 293a 0a20 2020  (Exception):.   
-00004ce0: 2070 6173 730a 0a0a 6465 6620 7472 616e   pass...def tran
-00004cf0: 736d 6974 5f66 6f72 6d61 7428 6675 6e63  smit_format(func
-00004d00: 293a 0a20 2020 2022 2222 5772 6170 7065  ):.    """Wrappe
-00004d10: 7220 666f 7220 6461 7461 7365 7420 7472  r for dataset tr
-00004d20: 616e 7366 6f72 6d73 2074 6861 7420 7265  ansforms that re
-00004d30: 6372 6561 7465 2061 206e 6577 2044 6174  create a new Dat
-00004d40: 6173 6574 2074 6f20 7472 616e 736d 6974  aset to transmit
-00004d50: 2074 6865 2066 6f72 6d61 7420 6f66 2074   the format of t
-00004d60: 6865 206f 7269 6769 6e61 6c20 6461 7461  he original data
-00004d70: 7365 7420 746f 2074 6865 206e 6577 2064  set to the new d
-00004d80: 6174 6173 6574 2222 220a 0a20 2020 2040  ataset"""..    @
-00004d90: 7772 6170 7328 6675 6e63 290a 2020 2020  wraps(func).    
-00004da0: 6465 6620 7772 6170 7065 7228 2a61 7267  def wrapper(*arg
-00004db0: 732c 202a 2a6b 7761 7267 7329 3a0a 2020  s, **kwargs):.  
-00004dc0: 2020 2020 2020 6966 2061 7267 733a 0a20        if args:. 
-00004dd0: 2020 2020 2020 2020 2020 2073 656c 663a             self:
-00004de0: 2022 4461 7461 7365 7422 203d 2061 7267   "Dataset" = arg
-00004df0: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
-00004e00: 2061 7267 7320 3d20 6172 6773 5b31 3a5d   args = args[1:]
-00004e10: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00004e20: 2020 2020 2020 2020 2020 2073 656c 663a             self:
-00004e30: 2022 4461 7461 7365 7422 203d 206b 7761   "Dataset" = kwa
-00004e40: 7267 732e 706f 7028 2273 656c 6622 290a  rgs.pop("self").
-00004e50: 2020 2020 2020 2020 2320 646f 6e27 7420          # don't 
-00004e60: 7573 6520 7365 6c66 2e66 6f72 6d61 7420  use self.format 
-00004e70: 7369 6e63 6520 6974 2072 6574 7572 6e73  since it returns
-00004e80: 2061 206c 6973 7420 6f66 2063 6f6c 756d   a list of colum
-00004e90: 6e73 2066 6f72 2027 636f 6c75 6d6e 7327  ns for 'columns'
-00004ea0: 2065 7665 6e20 6966 2073 656c 665f 666f   even if self_fo
-00004eb0: 726d 6174 5f63 6f6c 756d 6e73 2069 7320  rmat_columns is 
-00004ec0: 4e6f 6e65 0a20 2020 2020 2020 2075 6e66  None.        unf
-00004ed0: 6f72 6d61 7474 6564 5f63 6f6c 756d 6e73  ormatted_columns
-00004ee0: 203d 2073 6574 2873 656c 662e 636f 6c75   = set(self.colu
-00004ef0: 6d6e 5f6e 616d 6573 2920 2d20 7365 7428  mn_names) - set(
-00004f00: 7365 6c66 2e5f 666f 726d 6174 5f63 6f6c  self._format_col
-00004f10: 756d 6e73 206f 7220 5b5d 290a 2020 2020  umns or []).    
-00004f20: 2020 2020 7365 6c66 5f66 6f72 6d61 7420      self_format 
-00004f30: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00004f40: 2274 7970 6522 3a20 7365 6c66 2e5f 666f  "type": self._fo
-00004f50: 726d 6174 5f74 7970 652c 0a20 2020 2020  rmat_type,.     
-00004f60: 2020 2020 2020 2022 666f 726d 6174 5f6b         "format_k
-00004f70: 7761 7267 7322 3a20 7365 6c66 2e5f 666f  wargs": self._fo
-00004f80: 726d 6174 5f6b 7761 7267 732c 0a20 2020  rmat_kwargs,.   
-00004f90: 2020 2020 2020 2020 2022 636f 6c75 6d6e           "column
-00004fa0: 7322 3a20 7365 6c66 2e5f 666f 726d 6174  s": self._format
-00004fb0: 5f63 6f6c 756d 6e73 2c0a 2020 2020 2020  _columns,.      
-00004fc0: 2020 2020 2020 226f 7574 7075 745f 616c        "output_al
-00004fd0: 6c5f 636f 6c75 6d6e 7322 3a20 7365 6c66  l_columns": self
-00004fe0: 2e5f 6f75 7470 7574 5f61 6c6c 5f63 6f6c  ._output_all_col
-00004ff0: 756d 6e73 2c0a 2020 2020 2020 2020 7d0a  umns,.        }.
-00005000: 2020 2020 2020 2020 2320 6170 706c 7920          # apply 
-00005010: 6163 7475 616c 2066 756e 6374 696f 6e0a  actual function.
-00005020: 2020 2020 2020 2020 6f75 743a 2055 6e69          out: Uni
-00005030: 6f6e 5b22 4461 7461 7365 7422 2c20 2244  on["Dataset", "D
-00005040: 6174 6173 6574 4469 6374 225d 203d 2066  atasetDict"] = f
-00005050: 756e 6328 7365 6c66 2c20 2a61 7267 732c  unc(self, *args,
-00005060: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-00005070: 2020 2064 6174 6173 6574 733a 204c 6973     datasets: Lis
-00005080: 745b 2244 6174 6173 6574 225d 203d 206c  t["Dataset"] = l
-00005090: 6973 7428 6f75 742e 7661 6c75 6573 2829  ist(out.values()
-000050a0: 2920 6966 2069 7369 6e73 7461 6e63 6528  ) if isinstance(
-000050b0: 6f75 742c 2064 6963 7429 2065 6c73 6520  out, dict) else 
-000050c0: 5b6f 7574 5d0a 2020 2020 2020 2020 2320  [out].        # 
-000050d0: 7265 2d61 7070 6c79 2066 6f72 6d61 7420  re-apply format 
-000050e0: 746f 2074 6865 206f 7574 7075 740a 2020  to the output.  
-000050f0: 2020 2020 2020 666f 7220 6461 7461 7365        for datase
-00005100: 7420 696e 2064 6174 6173 6574 733a 0a20  t in datasets:. 
-00005110: 2020 2020 2020 2020 2020 206e 6577 5f66             new_f
-00005120: 6f72 6d61 7420 3d20 7365 6c66 5f66 6f72  ormat = self_for
-00005130: 6d61 742e 636f 7079 2829 0a20 2020 2020  mat.copy().     
-00005140: 2020 2020 2020 2069 6620 6e65 775f 666f         if new_fo
-00005150: 726d 6174 5b22 636f 6c75 6d6e 7322 5d20  rmat["columns"] 
-00005160: 6973 206e 6f74 204e 6f6e 653a 2020 2320  is not None:  # 
-00005170: 6e65 7720 666f 726d 6174 7465 6420 636f  new formatted co
-00005180: 6c75 6d6e 7320 3d20 2863 6f6c 756d 6e73  lumns = (columns
-00005190: 202d 2070 7265 7669 6f75 736c 7920 756e   - previously un
-000051a0: 666f 726d 6174 7465 6420 636f 6c75 6d6e  formatted column
-000051b0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-000051c0: 2020 2023 2073 6f72 7420 7468 6520 636f     # sort the co
-000051d0: 6c75 6d6e 7320 746f 2068 6176 6520 6120  lumns to have a 
-000051e0: 6465 7465 726d 696e 6973 7469 6320 6c69  deterministic li
-000051f0: 7374 206f 6620 636f 6c75 6d6e 7320 7468  st of columns th
-00005200: 6174 2077 6520 6361 6e20 636f 6d70 6172  at we can compar
-00005210: 6520 7769 7468 2060 6f75 745f 666f 726d  e with `out_form
-00005220: 6174 600a 2020 2020 2020 2020 2020 2020  at`.            
-00005230: 2020 2020 6e65 775f 666f 726d 6174 5b22      new_format["
-00005240: 636f 6c75 6d6e 7322 5d20 3d20 736f 7274  columns"] = sort
-00005250: 6564 2873 6574 2864 6174 6173 6574 2e63  ed(set(dataset.c
-00005260: 6f6c 756d 6e5f 6e61 6d65 7329 202d 2075  olumn_names) - u
-00005270: 6e66 6f72 6d61 7474 6564 5f63 6f6c 756d  nformatted_colum
-00005280: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
-00005290: 6f75 745f 666f 726d 6174 203d 207b 0a20  out_format = {. 
-000052a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000052b0: 7479 7065 223a 2064 6174 6173 6574 2e5f  type": dataset._
-000052c0: 666f 726d 6174 5f74 7970 652c 0a20 2020  format_type,.   
-000052d0: 2020 2020 2020 2020 2020 2020 2022 666f               "fo
-000052e0: 726d 6174 5f6b 7761 7267 7322 3a20 6461  rmat_kwargs": da
-000052f0: 7461 7365 742e 5f66 6f72 6d61 745f 6b77  taset._format_kw
-00005300: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
-00005310: 2020 2020 2020 2263 6f6c 756d 6e73 223a        "columns":
-00005320: 2073 6f72 7465 6428 6461 7461 7365 742e   sorted(dataset.
-00005330: 5f66 6f72 6d61 745f 636f 6c75 6d6e 7329  _format_columns)
-00005340: 2069 6620 6461 7461 7365 742e 5f66 6f72   if dataset._for
-00005350: 6d61 745f 636f 6c75 6d6e 7320 6973 206e  mat_columns is n
-00005360: 6f74 204e 6f6e 6520 656c 7365 204e 6f6e  ot None else Non
-00005370: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00005380: 2020 2022 6f75 7470 7574 5f61 6c6c 5f63     "output_all_c
-00005390: 6f6c 756d 6e73 223a 2064 6174 6173 6574  olumns": dataset
-000053a0: 2e5f 6f75 7470 7574 5f61 6c6c 5f63 6f6c  ._output_all_col
-000053b0: 756d 6e73 2c0a 2020 2020 2020 2020 2020  umns,.          
-000053c0: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-000053d0: 6966 206f 7574 5f66 6f72 6d61 7420 213d  if out_format !=
-000053e0: 206e 6577 5f66 6f72 6d61 743a 2020 2320   new_format:  # 
-000053f0: 6f6e 6c79 2061 7070 6c79 2069 6620 7468  only apply if th
-00005400: 6572 6527 7320 6120 6368 616e 6765 206e  ere's a change n
-00005410: 6f74 2074 6f20 7570 6461 7465 2074 6865  ot to update the
-00005420: 2066 696e 6765 7270 7269 6e74 2066 6f72   fingerprint for
-00005430: 206e 6f74 6869 6e67 0a20 2020 2020 2020   nothing.       
-00005440: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
-00005450: 2e73 6574 5f66 6f72 6d61 7428 2a2a 6e65  .set_format(**ne
-00005460: 775f 666f 726d 6174 290a 2020 2020 2020  w_format).      
-00005470: 2020 7265 7475 726e 206f 7574 0a0a 2020    return out..  
-00005480: 2020 7772 6170 7065 722e 5f64 6563 6f72    wrapper._decor
-00005490: 6174 6f72 5f6e 616d 655f 203d 2022 7472  ator_name_ = "tr
-000054a0: 616e 736d 6974 5f66 6f72 6d61 7422 0a20  ansmit_format". 
-000054b0: 2020 2072 6574 7572 6e20 7772 6170 7065     return wrappe
-000054c0: 720a 0a0a 6465 6620 7472 616e 736d 6974  r...def transmit
-000054d0: 5f74 6173 6b73 2866 756e 6329 3a0a 2020  _tasks(func):.  
-000054e0: 2020 2222 2257 7261 7070 6572 2066 6f72    """Wrapper for
-000054f0: 2064 6174 6173 6574 2074 7261 6e73 666f   dataset transfo
-00005500: 726d 7320 7468 6174 2072 6563 7265 6174  rms that recreat
-00005510: 6520 6120 6e65 7720 4461 7461 7365 7420  e a new Dataset 
-00005520: 746f 2074 7261 6e73 6d69 7420 7468 6520  to transmit the 
-00005530: 7461 736b 2074 656d 706c 6174 6573 206f  task templates o
-00005540: 6620 7468 6520 6f72 6967 696e 616c 2064  f the original d
-00005550: 6174 6173 6574 2074 6f20 7468 6520 6e65  ataset to the ne
-00005560: 7720 6461 7461 7365 7422 2222 0a0a 2020  w dataset"""..  
-00005570: 2020 4077 7261 7073 2866 756e 6329 0a20    @wraps(func). 
-00005580: 2020 2064 6566 2077 7261 7070 6572 282a     def wrapper(*
-00005590: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-000055a0: 0a20 2020 2020 2020 2069 6620 6172 6773  .        if args
-000055b0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-000055c0: 6c66 3a20 2244 6174 6173 6574 2220 3d20  lf: "Dataset" = 
-000055d0: 6172 6773 5b30 5d0a 2020 2020 2020 2020  args[0].        
-000055e0: 2020 2020 6172 6773 203d 2061 7267 735b      args = args[
-000055f0: 313a 5d0a 2020 2020 2020 2020 656c 7365  1:].        else
-00005600: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00005610: 6c66 3a20 2244 6174 6173 6574 2220 3d20  lf: "Dataset" = 
-00005620: 6b77 6172 6773 2e70 6f70 2822 7365 6c66  kwargs.pop("self
-00005630: 2229 0a20 2020 2020 2020 2023 2061 7070  ").        # app
-00005640: 6c79 2061 6374 7561 6c20 6675 6e63 7469  ly actual functi
-00005650: 6f6e 0a20 2020 2020 2020 206f 7574 3a20  on.        out: 
-00005660: 556e 696f 6e5b 2244 6174 6173 6574 222c  Union["Dataset",
-00005670: 2022 4461 7461 7365 7444 6963 7422 5d20   "DatasetDict"] 
-00005680: 3d20 6675 6e63 2873 656c 662c 202a 6172  = func(self, *ar
-00005690: 6773 2c20 2a2a 6b77 6172 6773 290a 2020  gs, **kwargs).  
-000056a0: 2020 2020 2020 6461 7461 7365 7473 3a20        datasets: 
-000056b0: 4c69 7374 5b22 4461 7461 7365 7422 5d20  List["Dataset"] 
-000056c0: 3d20 6c69 7374 286f 7574 2e76 616c 7565  = list(out.value
-000056d0: 7328 2929 2069 6620 6973 696e 7374 616e  s()) if isinstan
-000056e0: 6365 286f 7574 2c20 6469 6374 2920 656c  ce(out, dict) el
-000056f0: 7365 205b 6f75 745d 0a20 2020 2020 2020  se [out].       
-00005700: 2066 6f72 2064 6174 6173 6574 2069 6e20   for dataset in 
-00005710: 6461 7461 7365 7473 3a0a 2020 2020 2020  datasets:.      
-00005720: 2020 2020 2020 2320 5265 6d6f 7665 2074        # Remove t
-00005730: 6173 6b20 7465 6d70 6c61 7465 7320 6966  ask templates if
-00005740: 2061 2063 6f6c 756d 6e20 6d61 7070 696e   a column mappin
-00005750: 6720 6f66 2074 6865 2074 656d 706c 6174  g of the templat
-00005760: 6520 6973 206e 6f20 6c6f 6e67 6572 2076  e is no longer v
-00005770: 616c 6964 0a20 2020 2020 2020 2020 2020  alid.           
-00005780: 2069 6620 7365 6c66 2e69 6e66 6f2e 7461   if self.info.ta
-00005790: 736b 5f74 656d 706c 6174 6573 2069 7320  sk_templates is 
-000057a0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000057b0: 2020 2020 2020 2020 2020 6461 7461 7365            datase
-000057c0: 742e 696e 666f 2e74 6173 6b5f 7465 6d70  t.info.task_temp
-000057d0: 6c61 7465 7320 3d20 5b0a 2020 2020 2020  lates = [.      
-000057e0: 2020 2020 2020 2020 2020 2020 2020 7465                te
-000057f0: 6d70 6c61 7465 0a20 2020 2020 2020 2020  mplate.         
-00005800: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
-00005810: 656d 706c 6174 6520 696e 2073 656c 662e  emplate in self.
-00005820: 696e 666f 2e74 6173 6b5f 7465 6d70 6c61  info.task_templa
-00005830: 7465 730a 2020 2020 2020 2020 2020 2020  tes.            
-00005840: 2020 2020 2020 2020 6966 2061 6c6c 2864          if all(d
-00005850: 6174 6173 6574 2e66 6561 7475 7265 732e  ataset.features.
-00005860: 6765 7428 6b29 203d 3d20 7365 6c66 2e66  get(k) == self.f
-00005870: 6561 7475 7265 732e 6765 7428 6b29 2066  eatures.get(k) f
-00005880: 6f72 206b 2069 6e20 7465 6d70 6c61 7465  or k in template
-00005890: 2e63 6f6c 756d 6e5f 6d61 7070 696e 672e  .column_mapping.
-000058a0: 6b65 7973 2829 290a 2020 2020 2020 2020  keys()).        
-000058b0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-000058c0: 2020 7265 7475 726e 206f 7574 0a0a 2020    return out..  
-000058d0: 2020 7772 6170 7065 722e 5f64 6563 6f72    wrapper._decor
-000058e0: 6174 6f72 5f6e 616d 655f 203d 2022 7472  ator_name_ = "tr
-000058f0: 616e 736d 6974 5f74 6173 6b73 220a 2020  ansmit_tasks".  
-00005900: 2020 7265 7475 726e 2077 7261 7070 6572    return wrapper
-00005910: 0a0a 0a64 6566 2075 7064 6174 655f 6d65  ...def update_me
-00005920: 7461 6461 7461 5f77 6974 685f 6665 6174  tadata_with_feat
-00005930: 7572 6573 2874 6162 6c65 3a20 5461 626c  ures(table: Tabl
-00005940: 652c 2066 6561 7475 7265 733a 2046 6561  e, features: Fea
-00005950: 7475 7265 7329 3a0a 2020 2020 2222 2254  tures):.    """T
-00005960: 6f20 6265 2075 7365 6420 696e 2064 6174  o be used in dat
-00005970: 6173 6574 2074 7261 6e73 666f 726d 7320  aset transforms 
-00005980: 7468 6174 206d 6f64 6966 7920 7468 6520  that modify the 
-00005990: 6665 6174 7572 6573 206f 6620 7468 6520  features of the 
-000059a0: 6461 7461 7365 742c 2069 6e20 6f72 6465  dataset, in orde
-000059b0: 7220 746f 2075 7064 6174 6520 7468 6520  r to update the 
-000059c0: 6665 6174 7572 6573 2073 746f 7265 6420  features stored 
-000059d0: 696e 2074 6865 206d 6574 6164 6174 6120  in the metadata 
-000059e0: 6f66 2069 7473 2073 6368 656d 612e 2222  of its schema.""
-000059f0: 220a 2020 2020 6665 6174 7572 6573 203d  ".    features =
-00005a00: 2046 6561 7475 7265 7328 7b63 6f6c 5f6e   Features({col_n
-00005a10: 616d 653a 2066 6561 7475 7265 735b 636f  ame: features[co
-00005a20: 6c5f 6e61 6d65 5d20 666f 7220 636f 6c5f  l_name] for col_
-00005a30: 6e61 6d65 2069 6e20 7461 626c 652e 636f  name in table.co
-00005a40: 6c75 6d6e 5f6e 616d 6573 7d29 0a20 2020  lumn_names}).   
-00005a50: 2069 6620 7461 626c 652e 7363 6865 6d61   if table.schema
-00005a60: 2e6d 6574 6164 6174 6120 6973 204e 6f6e  .metadata is Non
-00005a70: 6520 6f72 2062 2268 7567 6769 6e67 6661  e or b"huggingfa
-00005a80: 6365 2220 6e6f 7420 696e 2074 6162 6c65  ce" not in table
-00005a90: 2e73 6368 656d 612e 6d65 7461 6461 7461  .schema.metadata
-00005aa0: 3a0a 2020 2020 2020 2020 7061 5f6d 6574  :.        pa_met
-00005ab0: 6164 6174 6120 3d20 4172 726f 7757 7269  adata = ArrowWri
-00005ac0: 7465 722e 5f62 7569 6c64 5f6d 6574 6164  ter._build_metad
-00005ad0: 6174 6128 4461 7461 7365 7449 6e66 6f28  ata(DatasetInfo(
-00005ae0: 6665 6174 7572 6573 3d66 6561 7475 7265  features=feature
-00005af0: 7329 290a 2020 2020 656c 7365 3a0a 2020  s)).    else:.  
-00005b00: 2020 2020 2020 6d65 7461 6461 7461 203d        metadata =
-00005b10: 206a 736f 6e2e 6c6f 6164 7328 7461 626c   json.loads(tabl
-00005b20: 652e 7363 6865 6d61 2e6d 6574 6164 6174  e.schema.metadat
-00005b30: 615b 6222 6875 6767 696e 6766 6163 6522  a[b"huggingface"
-00005b40: 5d2e 6465 636f 6465 2829 290a 2020 2020  ].decode()).    
-00005b50: 2020 2020 6966 2022 696e 666f 2220 6e6f      if "info" no
-00005b60: 7420 696e 206d 6574 6164 6174 613a 0a20  t in metadata:. 
-00005b70: 2020 2020 2020 2020 2020 206d 6574 6164             metad
-00005b80: 6174 615b 2269 6e66 6f22 5d20 3d20 6173  ata["info"] = as
-00005b90: 6469 6374 2844 6174 6173 6574 496e 666f  dict(DatasetInfo
-00005ba0: 2866 6561 7475 7265 733d 6665 6174 7572  (features=featur
-00005bb0: 6573 2929 0a20 2020 2020 2020 2065 6c73  es)).        els
-00005bc0: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
-00005bd0: 6574 6164 6174 615b 2269 6e66 6f22 5d5b  etadata["info"][
-00005be0: 2266 6561 7475 7265 7322 5d20 3d20 6173  "features"] = as
-00005bf0: 6469 6374 2844 6174 6173 6574 496e 666f  dict(DatasetInfo
-00005c00: 2866 6561 7475 7265 733d 6665 6174 7572  (features=featur
-00005c10: 6573 2929 5b22 6665 6174 7572 6573 225d  es))["features"]
-00005c20: 0a20 2020 2020 2020 2070 615f 6d65 7461  .        pa_meta
-00005c30: 6461 7461 203d 207b 2268 7567 6769 6e67  data = {"hugging
-00005c40: 6661 6365 223a 206a 736f 6e2e 6475 6d70  face": json.dump
-00005c50: 7328 6d65 7461 6461 7461 297d 0a20 2020  s(metadata)}.   
-00005c60: 2074 6162 6c65 203d 2074 6162 6c65 2e72   table = table.r
-00005c70: 6570 6c61 6365 5f73 6368 656d 615f 6d65  eplace_schema_me
-00005c80: 7461 6461 7461 2870 615f 6d65 7461 6461  tadata(pa_metada
-00005c90: 7461 290a 2020 2020 7265 7475 726e 2074  ta).    return t
-00005ca0: 6162 6c65 0a0a 0a64 6566 205f 6368 6563  able...def _chec
-00005cb0: 6b5f 7461 626c 6528 7461 626c 6529 202d  k_table(table) -
-00005cc0: 3e20 5461 626c 653a 0a20 2020 2022 2222  > Table:.    """
-00005cd0: 5765 2063 6865 636b 2074 6865 2074 6162  We check the tab
-00005ce0: 6c65 2074 7970 6520 746f 206d 616b 6520  le type to make 
-00005cf0: 7375 7265 2069 7427 7320 616e 2069 6e73  sure it's an ins
-00005d00: 7461 6e63 6520 6f66 203a 636c 6173 733a  tance of :class:
-00005d10: 6064 6174 6173 6574 732e 7461 626c 652e  `datasets.table.
-00005d20: 5461 626c 6560 2222 220a 2020 2020 6966  Table`""".    if
-00005d30: 2069 7369 6e73 7461 6e63 6528 7461 626c   isinstance(tabl
-00005d40: 652c 2070 612e 5461 626c 6529 3a0a 2020  e, pa.Table):.  
-00005d50: 2020 2020 2020 2320 666f 7220 6120 7079        # for a py
-00005d60: 6172 726f 7720 7461 626c 652c 2077 6520  arrow table, we 
-00005d70: 6361 6e20 6a75 7374 2063 6f6e 7369 6465  can just conside
-00005d80: 7220 6974 2061 7320 6120 696e 2d6d 656d  r it as a in-mem
-00005d90: 6f72 7920 7461 626c 650a 2020 2020 2020  ory table.      
-00005da0: 2020 2320 7468 6973 2069 7320 6865 7265    # this is here
-00005db0: 2066 6f72 2062 6163 6b77 6172 6420 636f   for backward co
-00005dc0: 6d70 6174 6962 696c 6974 790a 2020 2020  mpatibility.    
-00005dd0: 2020 2020 7265 7475 726e 2049 6e4d 656d      return InMem
-00005de0: 6f72 7954 6162 6c65 2874 6162 6c65 290a  oryTable(table).
-00005df0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00005e00: 6e63 6528 7461 626c 652c 2054 6162 6c65  nce(table, Table
-00005e10: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00005e20: 6e20 7461 626c 650a 2020 2020 656c 7365  n table.    else
-00005e30: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00005e40: 5479 7065 4572 726f 7228 6622 4578 7065  TypeError(f"Expe
-00005e50: 6374 6564 2061 2070 7961 7272 6f77 2e54  cted a pyarrow.T
-00005e60: 6162 6c65 206f 7220 6120 6461 7461 7365  able or a datase
-00005e70: 7473 2e74 6162 6c65 2e54 6162 6c65 206f  ts.table.Table o
-00005e80: 626a 6563 742c 2062 7574 2067 6f74 207b  bject, but got {
-00005e90: 7461 626c 657d 2e22 290a 0a0a 6465 6620  table}.")...def 
-00005ea0: 5f63 6865 636b 5f63 6f6c 756d 6e5f 6e61  _check_column_na
-00005eb0: 6d65 7328 636f 6c75 6d6e 5f6e 616d 6573  mes(column_names
-00005ec0: 3a20 4c69 7374 5b73 7472 5d29 3a0a 2020  : List[str]):.  
-00005ed0: 2020 2222 2243 6865 636b 2074 6865 2063    """Check the c
-00005ee0: 6f6c 756d 6e20 6e61 6d65 7320 746f 206d  olumn names to m
-00005ef0: 616b 6520 7375 7265 2074 6865 7920 646f  ake sure they do
-00005f00: 6e27 7420 636f 6e74 6169 6e20 6475 706c  n't contain dupl
-00005f10: 6963 6174 6573 2e22 2222 0a20 2020 2063  icates.""".    c
-00005f20: 6f75 6e74 6572 203d 2043 6f75 6e74 6572  ounter = Counter
-00005f30: 2863 6f6c 756d 6e5f 6e61 6d65 7329 0a20  (column_names). 
-00005f40: 2020 2069 6620 6e6f 7420 616c 6c28 636f     if not all(co
-00005f50: 756e 7420 3d3d 2031 2066 6f72 2063 6f75  unt == 1 for cou
-00005f60: 6e74 2069 6e20 636f 756e 7465 722e 7661  nt in counter.va
-00005f70: 6c75 6573 2829 293a 0a20 2020 2020 2020  lues()):.       
-00005f80: 2064 7570 6c69 6361 7465 645f 636f 6c75   duplicated_colu
-00005f90: 6d6e 7320 3d20 5b63 6f6c 2066 6f72 2063  mns = [col for c
-00005fa0: 6f6c 2069 6e20 636f 756e 7465 7220 6966  ol in counter if
-00005fb0: 2063 6f75 6e74 6572 5b63 6f6c 5d20 3e20   counter[col] > 
-00005fc0: 315d 0a20 2020 2020 2020 2072 6169 7365  1].        raise
-00005fd0: 2056 616c 7565 4572 726f 7228 6622 5468   ValueError(f"Th
-00005fe0: 6520 7461 626c 6520 6361 6e27 7420 6861  e table can't ha
-00005ff0: 7665 2064 7570 6c69 6361 7465 6420 636f  ve duplicated co
-00006000: 6c75 6d6e 7320 6275 7420 636f 6c75 6d6e  lumns but column
-00006010: 7320 7b64 7570 6c69 6361 7465 645f 636f  s {duplicated_co
-00006020: 6c75 6d6e 737d 2061 7265 2064 7570 6c69  lumns} are dupli
-00006030: 6361 7465 642e 2229 0a0a 0a64 6566 205f  cated.")...def _
-00006040: 6368 6563 6b5f 7661 6c69 645f 696e 6469  check_valid_indi
-00006050: 6365 735f 7661 6c75 6528 696e 6465 782c  ces_value(index,
-00006060: 2073 697a 6529 3a0a 2020 2020 6966 2028   size):.    if (
-00006070: 696e 6465 7820 3c20 3020 616e 6420 696e  index < 0 and in
-00006080: 6465 7820 2b20 7369 7a65 203c 2030 2920  dex + size < 0) 
-00006090: 6f72 2028 696e 6465 7820 3e3d 2073 697a  or (index >= siz
-000060a0: 6529 3a0a 2020 2020 2020 2020 7261 6973  e):.        rais
-000060b0: 6520 496e 6465 7845 7272 6f72 2866 2249  e IndexError(f"I
-000060c0: 6e64 6578 207b 696e 6465 787d 206f 7574  ndex {index} out
-000060d0: 206f 6620 7261 6e67 6520 666f 7220 6461   of range for da
-000060e0: 7461 7365 7420 6f66 2073 697a 6520 7b73  taset of size {s
-000060f0: 697a 657d 2e22 290a 0a0a 636c 6173 7320  ize}.")...class 
-00006100: 4e6f 6e45 7869 7374 656e 7444 6174 6173  NonExistentDatas
-00006110: 6574 4572 726f 7228 4578 6365 7074 696f  etError(Exceptio
-00006120: 6e29 3a0a 2020 2020 2222 2255 7365 6420  n):.    """Used 
-00006130: 7768 656e 2077 6520 6578 7065 6374 2074  when we expect t
-00006140: 6865 2065 7869 7374 656e 6365 206f 6620  he existence of 
-00006150: 6120 6461 7461 7365 7422 2222 0a0a 2020  a dataset"""..  
-00006160: 2020 7061 7373 0a0a 0a63 6c61 7373 2044    pass...class D
-00006170: 6174 6173 6574 2844 6174 6173 6574 496e  ataset(DatasetIn
-00006180: 666f 4d69 7869 6e2c 2049 6e64 6578 6162  foMixin, Indexab
-00006190: 6c65 4d69 7869 6e2c 2054 656e 736f 7266  leMixin, Tensorf
-000061a0: 6c6f 7744 6174 6173 6574 4d69 7869 6e29  lowDatasetMixin)
-000061b0: 3a0a 2020 2020 2222 2241 2044 6174 6173  :.    """A Datas
-000061c0: 6574 2062 6163 6b65 6420 6279 2061 6e20  et backed by an 
-000061d0: 4172 726f 7720 7461 626c 652e 2222 220a  Arrow table.""".
-000061e0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-000061f0: 5f28 0a20 2020 2020 2020 2073 656c 662c  _(.        self,
-00006200: 0a20 2020 2020 2020 2061 7272 6f77 5f74  .        arrow_t
-00006210: 6162 6c65 3a20 5461 626c 652c 0a20 2020  able: Table,.   
-00006220: 2020 2020 2069 6e66 6f3a 204f 7074 696f       info: Optio
-00006230: 6e61 6c5b 4461 7461 7365 7449 6e66 6f5d  nal[DatasetInfo]
-00006240: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00006250: 2073 706c 6974 3a20 4f70 7469 6f6e 616c   split: Optional
-00006260: 5b4e 616d 6564 5370 6c69 745d 203d 204e  [NamedSplit] = N
-00006270: 6f6e 652c 0a20 2020 2020 2020 2069 6e64  one,.        ind
-00006280: 6963 6573 5f74 6162 6c65 3a20 4f70 7469  ices_table: Opti
-00006290: 6f6e 616c 5b54 6162 6c65 5d20 3d20 4e6f  onal[Table] = No
-000062a0: 6e65 2c0a 2020 2020 2020 2020 6669 6e67  ne,.        fing
-000062b0: 6572 7072 696e 743a 204f 7074 696f 6e61  erprint: Optiona
-000062c0: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
-000062d0: 2020 2029 3a0a 2020 2020 2020 2020 696e     ):.        in
-000062e0: 666f 203d 2069 6e66 6f2e 636f 7079 2829  fo = info.copy()
-000062f0: 2069 6620 696e 666f 2069 7320 6e6f 7420   if info is not 
-00006300: 4e6f 6e65 2065 6c73 6520 4461 7461 7365  None else Datase
-00006310: 7449 6e66 6f28 290a 2020 2020 2020 2020  tInfo().        
-00006320: 4461 7461 7365 7449 6e66 6f4d 6978 696e  DatasetInfoMixin
-00006330: 2e5f 5f69 6e69 745f 5f28 7365 6c66 2c20  .__init__(self, 
-00006340: 696e 666f 3d69 6e66 6f2c 2073 706c 6974  info=info, split
-00006350: 3d73 706c 6974 290a 2020 2020 2020 2020  =split).        
-00006360: 496e 6465 7861 626c 654d 6978 696e 2e5f  IndexableMixin._
-00006370: 5f69 6e69 745f 5f28 7365 6c66 290a 0a20  _init__(self).. 
-00006380: 2020 2020 2020 2073 656c 662e 5f64 6174         self._dat
-00006390: 613a 2054 6162 6c65 203d 205f 6368 6563  a: Table = _chec
-000063a0: 6b5f 7461 626c 6528 6172 726f 775f 7461  k_table(arrow_ta
-000063b0: 626c 6529 0a20 2020 2020 2020 2073 656c  ble).        sel
-000063c0: 662e 5f69 6e64 6963 6573 3a20 4f70 7469  f._indices: Opti
-000063d0: 6f6e 616c 5b54 6162 6c65 5d20 3d20 5f63  onal[Table] = _c
-000063e0: 6865 636b 5f74 6162 6c65 2869 6e64 6963  heck_table(indic
-000063f0: 6573 5f74 6162 6c65 2920 6966 2069 6e64  es_table) if ind
-00006400: 6963 6573 5f74 6162 6c65 2069 7320 6e6f  ices_table is no
-00006410: 7420 4e6f 6e65 2065 6c73 6520 4e6f 6e65  t None else None
-00006420: 0a20 2020 2020 2020 206d 6179 6265 5f72  .        maybe_r
-00006430: 6567 6973 7465 725f 6461 7461 7365 745f  egister_dataset_
-00006440: 666f 725f 7465 6d70 5f64 6972 5f64 656c  for_temp_dir_del
-00006450: 6574 696f 6e28 7365 6c66 290a 0a20 2020  etion(self)..   
-00006460: 2020 2020 2073 656c 662e 5f66 6f72 6d61       self._forma
-00006470: 745f 7479 7065 3a20 4f70 7469 6f6e 616c  t_type: Optional
-00006480: 5b73 7472 5d20 3d20 4e6f 6e65 0a20 2020  [str] = None.   
-00006490: 2020 2020 2073 656c 662e 5f66 6f72 6d61       self._forma
-000064a0: 745f 6b77 6172 6773 3a20 6469 6374 203d  t_kwargs: dict =
-000064b0: 207b 7d0a 2020 2020 2020 2020 7365 6c66   {}.        self
-000064c0: 2e5f 666f 726d 6174 5f63 6f6c 756d 6e73  ._format_columns
-000064d0: 3a20 4f70 7469 6f6e 616c 5b6c 6973 745d  : Optional[list]
-000064e0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-000064f0: 7365 6c66 2e5f 6f75 7470 7574 5f61 6c6c  self._output_all
-00006500: 5f63 6f6c 756d 6e73 3a20 626f 6f6c 203d  _columns: bool =
-00006510: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
-00006520: 656c 662e 5f66 696e 6765 7270 7269 6e74  elf._fingerprint
-00006530: 3a20 7374 7220 3d20 6669 6e67 6572 7072  : str = fingerpr
-00006540: 696e 740a 0a20 2020 2020 2020 2023 2052  int..        # R
-00006550: 6561 6420 6d65 7461 6461 7461 0a0a 2020  ead metadata..  
-00006560: 2020 2020 2020 6966 2073 656c 662e 5f64        if self._d
-00006570: 6174 612e 7363 6865 6d61 2e6d 6574 6164  ata.schema.metad
-00006580: 6174 6120 6973 206e 6f74 204e 6f6e 6520  ata is not None 
-00006590: 616e 6420 6222 6875 6767 696e 6766 6163  and b"huggingfac
-000065a0: 6522 2069 6e20 7365 6c66 2e5f 6461 7461  e" in self._data
-000065b0: 2e73 6368 656d 612e 6d65 7461 6461 7461  .schema.metadata
-000065c0: 3a0a 2020 2020 2020 2020 2020 2020 6d65  :.            me
-000065d0: 7461 6461 7461 203d 206a 736f 6e2e 6c6f  tadata = json.lo
-000065e0: 6164 7328 7365 6c66 2e5f 6461 7461 2e73  ads(self._data.s
-000065f0: 6368 656d 612e 6d65 7461 6461 7461 5b62  chema.metadata[b
-00006600: 2268 7567 6769 6e67 6661 6365 225d 2e64  "huggingface"].d
-00006610: 6563 6f64 6528 2929 0a20 2020 2020 2020  ecode()).       
-00006620: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00006630: 2020 2020 2020 2020 2020 2266 696e 6765            "finge
-00006640: 7270 7269 6e74 2220 696e 206d 6574 6164  rprint" in metad
-00006650: 6174 6120 616e 6420 7365 6c66 2e5f 6669  ata and self._fi
-00006660: 6e67 6572 7072 696e 7420 6973 204e 6f6e  ngerprint is Non
-00006670: 650a 2020 2020 2020 2020 2020 2020 293a  e.            ):
-00006680: 2020 2320 7472 7920 746f 206c 6f61 6420    # try to load 
-00006690: 6669 6e67 6572 7072 696e 7420 6672 6f6d  fingerprint from
-000066a0: 2074 6865 2061 7272 6f77 2066 696c 6520   the arrow file 
-000066b0: 6d65 7461 6461 7461 0a20 2020 2020 2020  metadata.       
-000066c0: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
-000066d0: 696e 6765 7270 7269 6e74 203d 206d 6574  ingerprint = met
-000066e0: 6164 6174 615b 2266 696e 6765 7270 7269  adata["fingerpri
-000066f0: 6e74 225d 0a0a 2020 2020 2020 2020 2320  nt"]..        # 
-00006700: 496e 6665 7220 6665 6174 7572 6573 2069  Infer features i
-00006710: 6620 4e6f 6e65 0a20 2020 2020 2020 2069  f None.        i
-00006720: 6e66 6572 7265 645f 6665 6174 7572 6573  nferred_features
-00006730: 203d 2046 6561 7475 7265 732e 6672 6f6d   = Features.from
-00006740: 5f61 7272 6f77 5f73 6368 656d 6128 6172  _arrow_schema(ar
-00006750: 726f 775f 7461 626c 652e 7363 6865 6d61  row_table.schema
-00006760: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
-00006770: 662e 696e 666f 2e66 6561 7475 7265 7320  f.info.features 
-00006780: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00006790: 2020 2020 2073 656c 662e 696e 666f 2e66       self.info.f
-000067a0: 6561 7475 7265 7320 3d20 696e 6665 7272  eatures = inferr
-000067b0: 6564 5f66 6561 7475 7265 730a 2020 2020  ed_features.    
-000067c0: 2020 2020 656c 7365 3a20 2023 206d 616b      else:  # mak
-000067d0: 6520 7375 7265 2074 6865 206e 6573 7465  e sure the neste
-000067e0: 6420 636f 6c75 6d6e 7320 6172 6520 696e  d columns are in
-000067f0: 2074 6865 2072 6967 6874 206f 7264 6572   the right order
-00006800: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00006810: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006820: 2020 7365 6c66 2e69 6e66 6f2e 6665 6174    self.info.feat
-00006830: 7572 6573 203d 2073 656c 662e 696e 666f  ures = self.info
-00006840: 2e66 6561 7475 7265 732e 7265 6f72 6465  .features.reorde
-00006850: 725f 6669 656c 6473 5f61 7328 696e 6665  r_fields_as(infe
-00006860: 7272 6564 5f66 6561 7475 7265 7329 0a20  rred_features). 
-00006870: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00006880: 7420 5661 6c75 6545 7272 6f72 2061 7320  t ValueError as 
-00006890: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000068a0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000068b0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-000068c0: 2020 2020 2020 2020 2066 227b 657d 5c6e           f"{e}\n
-000068d0: 5468 6520 2773 6f75 7263 6527 2066 6561  The 'source' fea
-000068e0: 7475 7265 7320 636f 6d65 2066 726f 6d20  tures come from 
-000068f0: 6461 7461 7365 745f 696e 666f 2e6a 736f  dataset_info.jso
-00006900: 6e2c 2061 6e64 2074 6865 2027 7461 7267  n, and the 'targ
-00006910: 6574 2720 6f6e 6573 2061 7265 2074 686f  et' ones are tho
-00006920: 7365 206f 6620 7468 6520 6461 7461 7365  se of the datase
-00006930: 7420 6172 726f 7720 6669 6c65 2e22 0a20  t arrow file.". 
-00006940: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00006950: 0a0a 2020 2020 2020 2020 2320 496e 6665  ..        # Infe
-00006960: 7220 6669 6e67 6572 7072 696e 7420 6966  r fingerprint if
-00006970: 204e 6f6e 650a 0a20 2020 2020 2020 2069   None..        i
-00006980: 6620 7365 6c66 2e5f 6669 6e67 6572 7072  f self._fingerpr
-00006990: 696e 7420 6973 204e 6f6e 653a 0a20 2020  int is None:.   
-000069a0: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
-000069b0: 696e 6765 7270 7269 6e74 203d 2067 656e  ingerprint = gen
-000069c0: 6572 6174 655f 6669 6e67 6572 7072 696e  erate_fingerprin
-000069d0: 7428 7365 6c66 290a 0a20 2020 2020 2020  t(self)..       
-000069e0: 2023 2053 616e 6974 7920 6368 6563 6b73   # Sanity checks
-000069f0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00006a00: 662e 6665 6174 7572 6573 2069 7320 4e6f  f.features is No
-00006a10: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00006a20: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00006a30: 2822 4665 6174 7572 6573 2063 616e 2774  ("Features can't
-00006a40: 2062 6520 4e6f 6e65 2069 6e20 6120 4461   be None in a Da
-00006a50: 7461 7365 7420 6f62 6a65 6374 2229 0a20  taset object"). 
-00006a60: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00006a70: 6669 6e67 6572 7072 696e 7420 6973 204e  fingerprint is N
-00006a80: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00006a90: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00006aa0: 7228 2246 696e 6765 7270 7269 6e74 2063  r("Fingerprint c
-00006ab0: 616e 2774 2062 6520 4e6f 6e65 2069 6e20  an't be None in 
-00006ac0: 6120 4461 7461 7365 7420 6f62 6a65 6374  a Dataset object
-00006ad0: 2229 0a20 2020 2020 2020 2069 6620 7365  ").        if se
-00006ae0: 6c66 2e69 6e66 6f2e 6665 6174 7572 6573  lf.info.features
-00006af0: 2e74 7970 6520 213d 2069 6e66 6572 7265  .type != inferre
-00006b00: 645f 6665 6174 7572 6573 2e74 7970 653a  d_features.type:
-00006b10: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00006b20: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-00006b30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00006b40: 2245 7874 6572 6e61 6c20 6665 6174 7572  "External featur
-00006b50: 6573 2069 6e66 6f20 646f 6e27 7420 6d61  es info don't ma
-00006b60: 7463 6820 7468 6520 6461 7461 7365 743a  tch the dataset:
-00006b70: 5c6e 476f 745c 6e7b 7365 6c66 2e69 6e66  \nGot\n{self.inf
-00006b80: 6f2e 6665 6174 7572 6573 7d5c 6e77 6974  o.features}\nwit
-00006b90: 6820 7479 7065 5c6e 7b73 656c 662e 696e  h type\n{self.in
-00006ba0: 666f 2e66 6561 7475 7265 732e 7479 7065  fo.features.type
-00006bb0: 7d5c 6e5c 6e62 7574 2065 7870 6563 7465  }\n\nbut expecte
-00006bc0: 6420 736f 6d65 7468 696e 6720 6c69 6b65  d something like
-00006bd0: 5c6e 7b69 6e66 6572 7265 645f 6665 6174  \n{inferred_feat
-00006be0: 7572 6573 7d5c 6e77 6974 6820 7479 7065  ures}\nwith type
-00006bf0: 5c6e 7b69 6e66 6572 7265 645f 6665 6174  \n{inferred_feat
-00006c00: 7572 6573 2e74 7970 657d 220a 2020 2020  ures.type}".    
-00006c10: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00006c20: 2020 2069 6620 7365 6c66 2e5f 696e 6469     if self._indi
-00006c30: 6365 7320 6973 206e 6f74 204e 6f6e 653a  ces is not None:
-00006c40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00006c50: 6e6f 7420 7061 2e74 7970 6573 2e69 735f  not pa.types.is_
-00006c60: 756e 7369 676e 6564 5f69 6e74 6567 6572  unsigned_integer
-00006c70: 2873 656c 662e 5f69 6e64 6963 6573 2e63  (self._indices.c
-00006c80: 6f6c 756d 6e28 3029 2e74 7970 6529 3a0a  olumn(0).type):.
-00006c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ca0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00006cb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00006cc0: 2020 2020 2020 6622 696e 6469 6365 7320        f"indices 
-00006cd0: 6d75 7374 2062 6520 616e 2041 7272 6f77  must be an Arrow
-00006ce0: 2074 6162 6c65 206f 6620 756e 7369 676e   table of unsign
-00006cf0: 6564 2069 6e74 6567 6572 732c 2063 7572  ed integers, cur
-00006d00: 7265 6e74 2074 7970 6520 6973 207b 7365  rent type is {se
-00006d10: 6c66 2e5f 696e 6469 6365 732e 636f 6c75  lf._indices.colu
-00006d20: 6d6e 2830 292e 7479 7065 7d22 0a20 2020  mn(0).type}".   
-00006d30: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00006d40: 2020 2020 2020 205f 6368 6563 6b5f 636f         _check_co
-00006d50: 6c75 6d6e 5f6e 616d 6573 2873 656c 662e  lumn_names(self.
-00006d60: 5f64 6174 612e 636f 6c75 6d6e 5f6e 616d  _data.column_nam
-00006d70: 6573 290a 0a20 2020 2020 2020 2073 656c  es)..        sel
-00006d80: 662e 5f64 6174 6120 3d20 7570 6461 7465  f._data = update
-00006d90: 5f6d 6574 6164 6174 615f 7769 7468 5f66  _metadata_with_f
-00006da0: 6561 7475 7265 7328 7365 6c66 2e5f 6461  eatures(self._da
-00006db0: 7461 2c20 7365 6c66 2e66 6561 7475 7265  ta, self.feature
-00006dc0: 7329 0a0a 2020 2020 4063 6c61 7373 6d65  s)..    @classme
-00006dd0: 7468 6f64 0a20 2020 2064 6566 2066 726f  thod.    def fro
-00006de0: 6d5f 6669 6c65 280a 2020 2020 2020 2020  m_file(.        
-00006df0: 636c 732c 0a20 2020 2020 2020 2066 696c  cls,.        fil
-00006e00: 656e 616d 653a 2073 7472 2c0a 2020 2020  ename: str,.    
-00006e10: 2020 2020 696e 666f 3a20 4f70 7469 6f6e      info: Option
-00006e20: 616c 5b44 6174 6173 6574 496e 666f 5d20  al[DatasetInfo] 
-00006e30: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00006e40: 7370 6c69 743a 204f 7074 696f 6e61 6c5b  split: Optional[
-00006e50: 4e61 6d65 6453 706c 6974 5d20 3d20 4e6f  NamedSplit] = No
-00006e60: 6e65 2c0a 2020 2020 2020 2020 696e 6469  ne,.        indi
-00006e70: 6365 735f 6669 6c65 6e61 6d65 3a20 4f70  ces_filename: Op
-00006e80: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-00006e90: 6e65 2c0a 2020 2020 2020 2020 696e 5f6d  ne,.        in_m
-00006ea0: 656d 6f72 793a 2062 6f6f 6c20 3d20 4661  emory: bool = Fa
-00006eb0: 6c73 652c 0a20 2020 2029 202d 3e20 2244  lse,.    ) -> "D
-00006ec0: 6174 6173 6574 223a 0a20 2020 2020 2020  ataset":.       
-00006ed0: 2022 2222 496e 7374 616e 7469 6174 6520   """Instantiate 
-00006ee0: 6120 4461 7461 7365 7420 6261 636b 6564  a Dataset backed
-00006ef0: 2062 7920 616e 2041 7272 6f77 2074 6162   by an Arrow tab
-00006f00: 6c65 2061 7420 6669 6c65 6e61 6d65 2e0a  le at filename..
-00006f10: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-00006f20: 2020 2020 2020 2020 2020 2066 696c 656e             filen
-00006f30: 616d 6520 2860 7374 7260 293a 0a20 2020  ame (`str`):.   
-00006f40: 2020 2020 2020 2020 2020 2020 2046 696c               Fil
-00006f50: 6520 6e61 6d65 206f 6620 7468 6520 6461  e name of the da
-00006f60: 7461 7365 742e 0a20 2020 2020 2020 2020  taset..         
-00006f70: 2020 2069 6e66 6f20 2860 4461 7461 7365     info (`Datase
-00006f80: 7449 6e66 6f60 2c20 2a6f 7074 696f 6e61  tInfo`, *optiona
-00006f90: 6c2a 293a 0a20 2020 2020 2020 2020 2020  l*):.           
-00006fa0: 2020 2020 2044 6174 6173 6574 2069 6e66       Dataset inf
-00006fb0: 6f72 6d61 7469 6f6e 2c20 6c69 6b65 2064  ormation, like d
-00006fc0: 6573 6372 6970 7469 6f6e 2c20 6369 7461  escription, cita
-00006fd0: 7469 6f6e 2c20 6574 632e 0a20 2020 2020  tion, etc..     
-00006fe0: 2020 2020 2020 2073 706c 6974 2028 604e         split (`N
-00006ff0: 616d 6564 5370 6c69 7460 2c20 2a6f 7074  amedSplit`, *opt
-00007000: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
-00007010: 2020 2020 2020 2020 204e 616d 6520 6f66           Name of
-00007020: 2074 6865 2064 6174 6173 6574 2073 706c   the dataset spl
-00007030: 6974 2e0a 2020 2020 2020 2020 2020 2020  it..            
-00007040: 696e 6469 6365 735f 6669 6c65 6e61 6d65  indices_filename
-00007050: 2028 6073 7472 602c 202a 6f70 7469 6f6e   (`str`, *option
-00007060: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
-00007070: 2020 2020 2020 4669 6c65 206e 616d 6573        File names
-00007080: 206f 6620 7468 6520 696e 6469 6365 732e   of the indices.
-00007090: 0a20 2020 2020 2020 2020 2020 2069 6e5f  .            in_
-000070a0: 6d65 6d6f 7279 2028 6062 6f6f 6c60 2c20  memory (`bool`, 
-000070b0: 6465 6661 756c 7473 2074 6f20 6046 616c  defaults to `Fal
-000070c0: 7365 6029 3a0a 2020 2020 2020 2020 2020  se`):.          
-000070d0: 2020 2020 2020 5768 6574 6865 7220 746f        Whether to
-000070e0: 2063 6f70 7920 7468 6520 6461 7461 2069   copy the data i
-000070f0: 6e2d 6d65 6d6f 7279 2e0a 0a20 2020 2020  n-memory...     
-00007100: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
-00007110: 2020 2020 2020 2020 5b60 4461 7461 7365          [`Datase
-00007120: 7460 5d0a 2020 2020 2020 2020 2222 220a  t`].        """.
-00007130: 2020 2020 2020 2020 7461 626c 6520 3d20          table = 
-00007140: 4172 726f 7752 6561 6465 722e 7265 6164  ArrowReader.read
-00007150: 5f74 6162 6c65 2866 696c 656e 616d 652c  _table(filename,
-00007160: 2069 6e5f 6d65 6d6f 7279 3d69 6e5f 6d65   in_memory=in_me
-00007170: 6d6f 7279 290a 0a20 2020 2020 2020 2069  mory)..        i
-00007180: 6620 696e 6469 6365 735f 6669 6c65 6e61  f indices_filena
-00007190: 6d65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  me is not None:.
-000071a0: 2020 2020 2020 2020 2020 2020 696e 6469              indi
-000071b0: 6365 735f 7061 5f74 6162 6c65 203d 2041  ces_pa_table = A
-000071c0: 7272 6f77 5265 6164 6572 2e72 6561 645f  rrowReader.read_
-000071d0: 7461 626c 6528 696e 6469 6365 735f 6669  table(indices_fi
-000071e0: 6c65 6e61 6d65 2c20 696e 5f6d 656d 6f72  lename, in_memor
-000071f0: 793d 696e 5f6d 656d 6f72 7929 0a20 2020  y=in_memory).   
-00007200: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00007210: 2020 2020 2020 2069 6e64 6963 6573 5f70         indices_p
-00007220: 615f 7461 626c 6520 3d20 4e6f 6e65 0a0a  a_table = None..
-00007230: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00007240: 6c73 280a 2020 2020 2020 2020 2020 2020  ls(.            
-00007250: 6172 726f 775f 7461 626c 653d 7461 626c  arrow_table=tabl
-00007260: 652c 0a20 2020 2020 2020 2020 2020 2069  e,.            i
-00007270: 6e66 6f3d 696e 666f 2c0a 2020 2020 2020  nfo=info,.      
-00007280: 2020 2020 2020 7370 6c69 743d 7370 6c69        split=spli
-00007290: 742c 0a20 2020 2020 2020 2020 2020 2069  t,.            i
-000072a0: 6e64 6963 6573 5f74 6162 6c65 3d69 6e64  ndices_table=ind
-000072b0: 6963 6573 5f70 615f 7461 626c 652c 0a20  ices_pa_table,. 
-000072c0: 2020 2020 2020 2029 0a0a 2020 2020 4063         )..    @c
-000072d0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-000072e0: 6566 2066 726f 6d5f 6275 6666 6572 280a  ef from_buffer(.
-000072f0: 2020 2020 2020 2020 636c 732c 0a20 2020          cls,.   
-00007300: 2020 2020 2062 7566 6665 723a 2070 612e       buffer: pa.
-00007310: 4275 6666 6572 2c0a 2020 2020 2020 2020  Buffer,.        
-00007320: 696e 666f 3a20 4f70 7469 6f6e 616c 5b44  info: Optional[D
-00007330: 6174 6173 6574 496e 666f 5d20 3d20 4e6f  atasetInfo] = No
-00007340: 6e65 2c0a 2020 2020 2020 2020 7370 6c69  ne,.        spli
-00007350: 743a 204f 7074 696f 6e61 6c5b 4e61 6d65  t: Optional[Name
-00007360: 6453 706c 6974 5d20 3d20 4e6f 6e65 2c0a  dSplit] = None,.
-00007370: 2020 2020 2020 2020 696e 6469 6365 735f          indices_
-00007380: 6275 6666 6572 3a20 4f70 7469 6f6e 616c  buffer: Optional
-00007390: 5b70 612e 4275 6666 6572 5d20 3d20 4e6f  [pa.Buffer] = No
-000073a0: 6e65 2c0a 2020 2020 2920 2d3e 2022 4461  ne,.    ) -> "Da
-000073b0: 7461 7365 7422 3a0a 2020 2020 2020 2020  taset":.        
-000073c0: 2222 2249 6e73 7461 6e74 6961 7465 2061  """Instantiate a
-000073d0: 2044 6174 6173 6574 2062 6163 6b65 6420   Dataset backed 
-000073e0: 6279 2061 6e20 4172 726f 7720 6275 6666  by an Arrow buff
-000073f0: 6572 2e0a 0a20 2020 2020 2020 2041 7267  er...        Arg
-00007400: 733a 0a20 2020 2020 2020 2020 2020 2062  s:.            b
-00007410: 7566 6665 7220 2860 7079 6172 726f 772e  uffer (`pyarrow.
-00007420: 4275 6666 6572 6029 3a0a 2020 2020 2020  Buffer`):.      
-00007430: 2020 2020 2020 2020 2020 4172 726f 7720            Arrow 
-00007440: 6275 6666 6572 2e0a 2020 2020 2020 2020  buffer..        
-00007450: 2020 2020 696e 666f 2028 6044 6174 6173      info (`Datas
-00007460: 6574 496e 666f 602c 202a 6f70 7469 6f6e  etInfo`, *option
-00007470: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
-00007480: 2020 2020 2020 4461 7461 7365 7420 696e        Dataset in
-00007490: 666f 726d 6174 696f 6e2c 206c 696b 6520  formation, like 
-000074a0: 6465 7363 7269 7074 696f 6e2c 2063 6974  description, cit
-000074b0: 6174 696f 6e2c 2065 7463 2e0a 2020 2020  ation, etc..    
-000074c0: 2020 2020 2020 2020 7370 6c69 7420 2860          split (`
-000074d0: 4e61 6d65 6453 706c 6974 602c 202a 6f70  NamedSplit`, *op
-000074e0: 7469 6f6e 616c 2a29 3a0a 2020 2020 2020  tional*):.      
-000074f0: 2020 2020 2020 2020 2020 4e61 6d65 206f            Name o
-00007500: 6620 7468 6520 6461 7461 7365 7420 7370  f the dataset sp
-00007510: 6c69 742e 0a20 2020 2020 2020 2020 2020  lit..           
-00007520: 2069 6e64 6963 6573 5f62 7566 6665 7220   indices_buffer 
-00007530: 2860 7079 6172 726f 772e 4275 6666 6572  (`pyarrow.Buffer
-00007540: 602c 202a 6f70 7469 6f6e 616c 2a29 3a0a  `, *optional*):.
-00007550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007560: 496e 6469 6365 7320 4172 726f 7720 6275  Indices Arrow bu
-00007570: 6666 6572 2e0a 0a20 2020 2020 2020 2052  ffer...        R
-00007580: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-00007590: 2020 2020 5b60 4461 7461 7365 7460 5d0a      [`Dataset`].
-000075a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000075b0: 2020 2020 7461 626c 6520 3d20 496e 4d65      table = InMe
-000075c0: 6d6f 7279 5461 626c 652e 6672 6f6d 5f62  moryTable.from_b
-000075d0: 7566 6665 7228 6275 6666 6572 290a 0a20  uffer(buffer).. 
-000075e0: 2020 2020 2020 2069 6620 696e 6469 6365         if indice
-000075f0: 735f 6275 6666 6572 2069 7320 6e6f 7420  s_buffer is not 
-00007600: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00007610: 2020 696e 6469 6365 735f 7461 626c 6520    indices_table 
-00007620: 3d20 496e 4d65 6d6f 7279 5461 626c 652e  = InMemoryTable.
-00007630: 6672 6f6d 5f62 7566 6665 7228 6275 6666  from_buffer(buff
-00007640: 6572 290a 2020 2020 2020 2020 656c 7365  er).        else
-00007650: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
-00007660: 6469 6365 735f 7461 626c 6520 3d20 4e6f  dices_table = No
-00007670: 6e65 0a0a 2020 2020 2020 2020 7265 7475  ne..        retu
-00007680: 726e 2063 6c73 2874 6162 6c65 2c20 696e  rn cls(table, in
-00007690: 666f 3d69 6e66 6f2c 2073 706c 6974 3d73  fo=info, split=s
-000076a0: 706c 6974 2c20 696e 6469 6365 735f 7461  plit, indices_ta
-000076b0: 626c 653d 696e 6469 6365 735f 7461 626c  ble=indices_tabl
-000076c0: 6529 0a0a 2020 2020 4063 6c61 7373 6d65  e)..    @classme
-000076d0: 7468 6f64 0a20 2020 2064 6566 2066 726f  thod.    def fro
-000076e0: 6d5f 7061 6e64 6173 280a 2020 2020 2020  m_pandas(.      
-000076f0: 2020 636c 732c 0a20 2020 2020 2020 2064    cls,.        d
-00007700: 663a 2070 642e 4461 7461 4672 616d 652c  f: pd.DataFrame,
-00007710: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
-00007720: 733a 204f 7074 696f 6e61 6c5b 4665 6174  s: Optional[Feat
-00007730: 7572 6573 5d20 3d20 4e6f 6e65 2c0a 2020  ures] = None,.  
-00007740: 2020 2020 2020 696e 666f 3a20 4f70 7469        info: Opti
-00007750: 6f6e 616c 5b44 6174 6173 6574 496e 666f  onal[DatasetInfo
-00007760: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00007770: 2020 7370 6c69 743a 204f 7074 696f 6e61    split: Optiona
-00007780: 6c5b 4e61 6d65 6453 706c 6974 5d20 3d20  l[NamedSplit] = 
-00007790: 4e6f 6e65 2c0a 2020 2020 2020 2020 7072  None,.        pr
-000077a0: 6573 6572 7665 5f69 6e64 6578 3a20 4f70  eserve_index: Op
-000077b0: 7469 6f6e 616c 5b62 6f6f 6c5d 203d 204e  tional[bool] = N
-000077c0: 6f6e 652c 0a20 2020 2029 202d 3e20 2244  one,.    ) -> "D
-000077d0: 6174 6173 6574 223a 0a20 2020 2020 2020  ataset":.       
-000077e0: 2022 2222 0a20 2020 2020 2020 2043 6f6e   """.        Con
-000077f0: 7665 7274 2060 7061 6e64 6173 2e44 6174  vert `pandas.Dat
-00007800: 6146 7261 6d65 6020 746f 2061 2060 7079  aFrame` to a `py
-00007810: 6172 726f 772e 5461 626c 6560 2074 6f20  arrow.Table` to 
-00007820: 6372 6561 7465 2061 205b 6044 6174 6173  create a [`Datas
-00007830: 6574 605d 2e0a 0a20 2020 2020 2020 2054  et`]...        T
-00007840: 6865 2063 6f6c 756d 6e20 7479 7065 7320  he column types 
-00007850: 696e 2074 6865 2072 6573 756c 7469 6e67  in the resulting
-00007860: 2041 7272 6f77 2054 6162 6c65 2061 7265   Arrow Table are
-00007870: 2069 6e66 6572 7265 6420 6672 6f6d 2074   inferred from t
-00007880: 6865 2064 7479 7065 7320 6f66 2074 6865  he dtypes of the
-00007890: 2060 7061 6e64 6173 2e53 6572 6965 7360   `pandas.Series`
-000078a0: 2069 6e20 7468 650a 2020 2020 2020 2020   in the.        
-000078b0: 4461 7461 4672 616d 652e 2049 6e20 7468  DataFrame. In th
-000078c0: 6520 6361 7365 206f 6620 6e6f 6e2d 6f62  e case of non-ob
-000078d0: 6a65 6374 2053 6572 6965 732c 2074 6865  ject Series, the
-000078e0: 204e 756d 5079 2064 7479 7065 2069 7320   NumPy dtype is 
-000078f0: 7472 616e 736c 6174 6564 2074 6f20 6974  translated to it
-00007900: 7320 4172 726f 7720 6571 7569 7661 6c65  s Arrow equivale
-00007910: 6e74 2e20 496e 2074 6865 0a20 2020 2020  nt. In the.     
-00007920: 2020 2063 6173 6520 6f66 2060 6f62 6a65     case of `obje
-00007930: 6374 602c 2077 6520 6e65 6564 2074 6f20  ct`, we need to 
-00007940: 6775 6573 7320 7468 6520 6461 7461 7479  guess the dataty
-00007950: 7065 2062 7920 6c6f 6f6b 696e 6720 6174  pe by looking at
-00007960: 2074 6865 2050 7974 686f 6e20 6f62 6a65   the Python obje
-00007970: 6374 7320 696e 2074 6869 7320 5365 7269  cts in this Seri
-00007980: 6573 2e0a 0a20 2020 2020 2020 2042 6520  es...        Be 
-00007990: 6177 6172 6520 7468 6174 2053 6572 6965  aware that Serie
-000079a0: 7320 6f66 2074 6865 2060 6f62 6a65 6374  s of the `object
-000079b0: 6020 6474 7970 6520 646f 6e27 7420 6361  ` dtype don't ca
-000079c0: 7272 7920 656e 6f75 6768 2069 6e66 6f72  rry enough infor
-000079d0: 6d61 7469 6f6e 2074 6f20 616c 7761 7973  mation to always
-000079e0: 206c 6561 6420 746f 2061 206d 6561 6e69   lead to a meani
-000079f0: 6e67 6675 6c20 4172 726f 770a 2020 2020  ngful Arrow.    
-00007a00: 2020 2020 7479 7065 2e20 496e 2074 6865      type. In the
-00007a10: 2063 6173 6520 7468 6174 2077 6520 6361   case that we ca
-00007a20: 6e6e 6f74 2069 6e66 6572 2061 2074 7970  nnot infer a typ
-00007a30: 652c 2065 2e67 2e20 6265 6361 7573 6520  e, e.g. because 
-00007a40: 7468 6520 4461 7461 4672 616d 6520 6973  the DataFrame is
-00007a50: 206f 6620 6c65 6e67 7468 2030 206f 7220   of length 0 or 
-00007a60: 7468 6520 5365 7269 6573 206f 6e6c 790a  the Series only.
-00007a70: 2020 2020 2020 2020 636f 6e74 6169 6e73          contains
-00007a80: 2060 4e6f 6e65 2f6e 616e 6020 6f62 6a65   `None/nan` obje
-00007a90: 6374 732c 2074 6865 2074 7970 6520 6973  cts, the type is
-00007aa0: 2073 6574 2074 6f20 606e 756c 6c60 2e20   set to `null`. 
-00007ab0: 5468 6973 2062 6568 6176 696f 7220 6361  This behavior ca
-00007ac0: 6e20 6265 2061 766f 6964 6564 2062 7920  n be avoided by 
-00007ad0: 636f 6e73 7472 7563 7469 6e67 2065 7870  constructing exp
-00007ae0: 6c69 6369 740a 2020 2020 2020 2020 6665  licit.        fe
-00007af0: 6174 7572 6573 2061 6e64 2070 6173 7369  atures and passi
-00007b00: 6e67 2069 7420 746f 2074 6869 7320 6675  ng it to this fu
-00007b10: 6e63 7469 6f6e 2e0a 0a20 2020 2020 2020  nction...       
-00007b20: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00007b30: 2020 2064 6620 2860 7061 6e64 6173 2e44     df (`pandas.D
-00007b40: 6174 6146 7261 6d65 6029 3a0a 2020 2020  ataFrame`):.    
-00007b50: 2020 2020 2020 2020 2020 2020 4461 7461              Data
-00007b60: 6672 616d 6520 7468 6174 2063 6f6e 7461  frame that conta
-00007b70: 696e 7320 7468 6520 6461 7461 7365 742e  ins the dataset.
-00007b80: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
-00007b90: 7475 7265 7320 285b 6046 6561 7475 7265  tures ([`Feature
-00007ba0: 7360 5d2c 202a 6f70 7469 6f6e 616c 2a29  s`], *optional*)
-00007bb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007bc0: 2020 4461 7461 7365 7420 6665 6174 7572    Dataset featur
-00007bd0: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-00007be0: 696e 666f 2028 6044 6174 6173 6574 496e  info (`DatasetIn
-00007bf0: 666f 602c 202a 6f70 7469 6f6e 616c 2a29  fo`, *optional*)
-00007c00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007c10: 2020 4461 7461 7365 7420 696e 666f 726d    Dataset inform
-00007c20: 6174 696f 6e2c 206c 696b 6520 6465 7363  ation, like desc
-00007c30: 7269 7074 696f 6e2c 2063 6974 6174 696f  ription, citatio
-00007c40: 6e2c 2065 7463 2e0a 2020 2020 2020 2020  n, etc..        
-00007c50: 2020 2020 7370 6c69 7420 2860 4e61 6d65      split (`Name
-00007c60: 6453 706c 6974 602c 202a 6f70 7469 6f6e  dSplit`, *option
-00007c70: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
-00007c80: 2020 2020 2020 4e61 6d65 206f 6620 7468        Name of th
-00007c90: 6520 6461 7461 7365 7420 7370 6c69 742e  e dataset split.
-00007ca0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00007cb0: 7365 7276 655f 696e 6465 7820 2860 626f  serve_index (`bo
-00007cc0: 6f6c 602c 202a 6f70 7469 6f6e 616c 2a29  ol`, *optional*)
-00007cd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007ce0: 2020 5768 6574 6865 7220 746f 2073 746f    Whether to sto
-00007cf0: 7265 2074 6865 2069 6e64 6578 2061 7320  re the index as 
-00007d00: 616e 2061 6464 6974 696f 6e61 6c20 636f  an additional co
-00007d10: 6c75 6d6e 2069 6e20 7468 6520 7265 7375  lumn in the resu
-00007d20: 6c74 696e 6720 4461 7461 7365 742e 0a20  lting Dataset.. 
-00007d30: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00007d40: 6865 2064 6566 6175 6c74 206f 6620 604e  he default of `N
-00007d50: 6f6e 6560 2077 696c 6c20 7374 6f72 6520  one` will store 
-00007d60: 7468 6520 696e 6465 7820 6173 2061 2063  the index as a c
-00007d70: 6f6c 756d 6e2c 2065 7863 6570 7420 666f  olumn, except fo
-00007d80: 7220 6052 616e 6765 496e 6465 7860 2077  r `RangeIndex` w
-00007d90: 6869 6368 2069 7320 7374 6f72 6564 2061  hich is stored a
-00007da0: 7320 6d65 7461 6461 7461 206f 6e6c 792e  s metadata only.
-00007db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007dc0: 2055 7365 2060 7072 6573 6572 7665 5f69   Use `preserve_i
-00007dd0: 6e64 6578 3d54 7275 6560 2074 6f20 666f  ndex=True` to fo
-00007de0: 7263 6520 6974 2074 6f20 6265 2073 746f  rce it to be sto
-00007df0: 7265 6420 6173 2061 2063 6f6c 756d 6e2e  red as a column.
-00007e00: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00007e10: 733a 0a20 2020 2020 2020 2020 2020 205b  s:.            [
-00007e20: 6044 6174 6173 6574 605d 0a0a 2020 2020  `Dataset`]..    
-00007e30: 2020 2020 4578 616d 706c 653a 0a0a 2020      Example:..  
-00007e40: 2020 2020 2020 6060 6070 790a 2020 2020        ```py.    
-00007e50: 2020 2020 3e3e 3e20 6473 203d 2044 6174      >>> ds = Dat
-00007e60: 6173 6574 2e66 726f 6d5f 7061 6e64 6173  aset.from_pandas
-00007e70: 2864 6629 0a20 2020 2020 2020 2060 6060  (df).        ```
-00007e80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00007e90: 2020 2020 2069 6620 696e 666f 2069 7320       if info is 
-00007ea0: 6e6f 7420 4e6f 6e65 2061 6e64 2066 6561  not None and fea
-00007eb0: 7475 7265 7320 6973 206e 6f74 204e 6f6e  tures is not Non
-00007ec0: 6520 616e 6420 696e 666f 2e66 6561 7475  e and info.featu
-00007ed0: 7265 7320 213d 2066 6561 7475 7265 733a  res != features:
-00007ee0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00007ef0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-00007f00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00007f10: 2246 6561 7475 7265 7320 7370 6563 6966  "Features specif
-00007f20: 6965 6420 696e 2060 6665 6174 7572 6573  ied in `features
-00007f30: 6020 616e 6420 6069 6e66 6f2e 6665 6174  ` and `info.feat
-00007f40: 7572 6573 6020 6361 6e27 7420 6265 2064  ures` can't be d
-00007f50: 6966 6665 7265 6e74 3a5c 6e7b 6665 6174  ifferent:\n{feat
-00007f60: 7572 6573 7d5c 6e7b 696e 666f 2e66 6561  ures}\n{info.fea
-00007f70: 7475 7265 737d 220a 2020 2020 2020 2020  tures}".        
-00007f80: 2020 2020 290a 2020 2020 2020 2020 6665      ).        fe
-00007f90: 6174 7572 6573 203d 2066 6561 7475 7265  atures = feature
-00007fa0: 7320 6966 2066 6561 7475 7265 7320 6973  s if features is
-00007fb0: 206e 6f74 204e 6f6e 6520 656c 7365 2069   not None else i
-00007fc0: 6e66 6f2e 6665 6174 7572 6573 2069 6620  nfo.features if 
-00007fd0: 696e 666f 2069 7320 6e6f 7420 4e6f 6e65  info is not None
-00007fe0: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
-00007ff0: 2020 2069 6620 696e 666f 2069 7320 4e6f     if info is No
-00008000: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00008010: 696e 666f 203d 2044 6174 6173 6574 496e  info = DatasetIn
-00008020: 666f 2829 0a20 2020 2020 2020 2069 6e66  fo().        inf
-00008030: 6f2e 6665 6174 7572 6573 203d 2066 6561  o.features = fea
-00008040: 7475 7265 730a 2020 2020 2020 2020 7461  tures.        ta
-00008050: 626c 6520 3d20 496e 4d65 6d6f 7279 5461  ble = InMemoryTa
-00008060: 626c 652e 6672 6f6d 5f70 616e 6461 7328  ble.from_pandas(
-00008070: 0a20 2020 2020 2020 2020 2020 2064 663d  .            df=
-00008080: 6466 2c0a 2020 2020 2020 2020 2020 2020  df,.            
-00008090: 7072 6573 6572 7665 5f69 6e64 6578 3d70  preserve_index=p
-000080a0: 7265 7365 7276 655f 696e 6465 782c 0a20  reserve_index,. 
-000080b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000080c0: 2069 6620 6665 6174 7572 6573 2069 7320   if features is 
-000080d0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000080e0: 2020 2020 2020 2320 6d6f 7265 2065 7870        # more exp
-000080f0: 656e 7369 7665 2063 6173 7420 7468 616e  ensive cast than
-00008100: 2049 6e4d 656d 6f72 7954 6162 6c65 2e66   InMemoryTable.f
-00008110: 726f 6d5f 7061 6e64 6173 282e 2e2e 2c20  rom_pandas(..., 
-00008120: 7363 6865 6d61 3d66 6561 7475 7265 732e  schema=features.
-00008130: 6172 726f 775f 7363 6865 6d61 290a 2020  arrow_schema).  
-00008140: 2020 2020 2020 2020 2020 2320 6e65 6564            # need
-00008150: 6564 2074 6f20 7375 7070 6f72 7420 7468  ed to support th
-00008160: 6520 7374 7220 746f 2041 7564 696f 2063  e str to Audio c
-00008170: 6f6e 7665 7273 696f 6e20 666f 7220 696e  onversion for in
-00008180: 7374 616e 6365 0a20 2020 2020 2020 2020  stance.         
-00008190: 2020 2074 6162 6c65 203d 2074 6162 6c65     table = table
-000081a0: 2e63 6173 7428 6665 6174 7572 6573 2e61  .cast(features.a
-000081b0: 7272 6f77 5f73 6368 656d 6129 0a20 2020  rrow_schema).   
-000081c0: 2020 2020 2072 6574 7572 6e20 636c 7328       return cls(
-000081d0: 7461 626c 652c 2069 6e66 6f3d 696e 666f  table, info=info
-000081e0: 2c20 7370 6c69 743d 7370 6c69 7429 0a0a  , split=split)..
-000081f0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00008200: 0a20 2020 2064 6566 2066 726f 6d5f 6469  .    def from_di
-00008210: 6374 280a 2020 2020 2020 2020 636c 732c  ct(.        cls,
-00008220: 0a20 2020 2020 2020 206d 6170 7069 6e67  .        mapping
-00008230: 3a20 6469 6374 2c0a 2020 2020 2020 2020  : dict,.        
-00008240: 6665 6174 7572 6573 3a20 4f70 7469 6f6e  features: Option
-00008250: 616c 5b46 6561 7475 7265 735d 203d 204e  al[Features] = N
-00008260: 6f6e 652c 0a20 2020 2020 2020 2069 6e66  one,.        inf
-00008270: 6f3a 204f 7074 696f 6e61 6c5b 4461 7461  o: Optional[Data
-00008280: 7365 7449 6e66 6f5d 203d 204e 6f6e 652c  setInfo] = None,
-00008290: 0a20 2020 2020 2020 2073 706c 6974 3a20  .        split: 
-000082a0: 4f70 7469 6f6e 616c 5b4e 616d 6564 5370  Optional[NamedSp
-000082b0: 6c69 745d 203d 204e 6f6e 652c 0a20 2020  lit] = None,.   
-000082c0: 2029 202d 3e20 2244 6174 6173 6574 223a   ) -> "Dataset":
-000082d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000082e0: 2020 2020 2043 6f6e 7665 7274 2060 6469       Convert `di
-000082f0: 6374 6020 746f 2061 2060 7079 6172 726f  ct` to a `pyarro
-00008300: 772e 5461 626c 6560 2074 6f20 6372 6561  w.Table` to crea
-00008310: 7465 2061 205b 6044 6174 6173 6574 605d  te a [`Dataset`]
-00008320: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-00008330: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-00008340: 7069 6e67 2028 604d 6170 7069 6e67 6029  ping (`Mapping`)
-00008350: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008360: 2020 4d61 7070 696e 6720 6f66 2073 7472    Mapping of str
-00008370: 696e 6773 2074 6f20 4172 7261 7973 206f  ings to Arrays o
-00008380: 7220 5079 7468 6f6e 206c 6973 7473 2e0a  r Python lists..
-00008390: 2020 2020 2020 2020 2020 2020 6665 6174              feat
-000083a0: 7572 6573 2028 5b60 4665 6174 7572 6573  ures ([`Features
-000083b0: 605d 2c20 2a6f 7074 696f 6e61 6c2a 293a  `], *optional*):
-000083c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000083d0: 2044 6174 6173 6574 2066 6561 7475 7265   Dataset feature
-000083e0: 732e 0a20 2020 2020 2020 2020 2020 2069  s..            i
-000083f0: 6e66 6f20 2860 4461 7461 7365 7449 6e66  nfo (`DatasetInf
-00008400: 6f60 2c20 2a6f 7074 696f 6e61 6c2a 293a  o`, *optional*):
-00008410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008420: 2044 6174 6173 6574 2069 6e66 6f72 6d61   Dataset informa
-00008430: 7469 6f6e 2c20 6c69 6b65 2064 6573 6372  tion, like descr
-00008440: 6970 7469 6f6e 2c20 6369 7461 7469 6f6e  iption, citation
-00008450: 2c20 6574 632e 0a20 2020 2020 2020 2020  , etc..         
-00008460: 2020 2073 706c 6974 2028 604e 616d 6564     split (`Named
-00008470: 5370 6c69 7460 2c20 2a6f 7074 696f 6e61  Split`, *optiona
-00008480: 6c2a 293a 0a20 2020 2020 2020 2020 2020  l*):.           
-00008490: 2020 2020 204e 616d 6520 6f66 2074 6865       Name of the
-000084a0: 2064 6174 6173 6574 2073 706c 6974 2e0a   dataset split..
-000084b0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-000084c0: 3a0a 2020 2020 2020 2020 2020 2020 5b60  :.            [`
-000084d0: 4461 7461 7365 7460 5d0a 2020 2020 2020  Dataset`].      
-000084e0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-000084f0: 2069 6e66 6f20 6973 206e 6f74 204e 6f6e   info is not Non
-00008500: 6520 616e 6420 6665 6174 7572 6573 2069  e and features i
-00008510: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2069  s not None and i
-00008520: 6e66 6f2e 6665 6174 7572 6573 2021 3d20  nfo.features != 
-00008530: 6665 6174 7572 6573 3a0a 2020 2020 2020  features:.      
-00008540: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00008550: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00008560: 2020 2020 2020 2020 6622 4665 6174 7572          f"Featur
-00008570: 6573 2073 7065 6369 6669 6564 2069 6e20  es specified in 
-00008580: 6066 6561 7475 7265 7360 2061 6e64 2060  `features` and `
-00008590: 696e 666f 2e66 6561 7475 7265 7360 2063  info.features` c
-000085a0: 616e 2774 2062 6520 6469 6666 6572 656e  an't be differen
-000085b0: 743a 5c6e 7b66 6561 7475 7265 737d 5c6e  t:\n{features}\n
-000085c0: 7b69 6e66 6f2e 6665 6174 7572 6573 7d22  {info.features}"
-000085d0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-000085e0: 2020 2020 2020 2066 6561 7475 7265 7320         features 
-000085f0: 3d20 6665 6174 7572 6573 2069 6620 6665  = features if fe
-00008600: 6174 7572 6573 2069 7320 6e6f 7420 4e6f  atures is not No
-00008610: 6e65 2065 6c73 6520 696e 666f 2e66 6561  ne else info.fea
-00008620: 7475 7265 7320 6966 2069 6e66 6f20 6973  tures if info is
-00008630: 206e 6f74 204e 6f6e 6520 656c 7365 204e   not None else N
-00008640: 6f6e 650a 2020 2020 2020 2020 6966 2069  one.        if i
-00008650: 6e66 6f20 6973 204e 6f6e 653a 0a20 2020  nfo is None:.   
-00008660: 2020 2020 2020 2020 2069 6e66 6f20 3d20           info = 
-00008670: 4461 7461 7365 7449 6e66 6f28 290a 2020  DatasetInfo().  
-00008680: 2020 2020 2020 696e 666f 2e66 6561 7475        info.featu
-00008690: 7265 7320 3d20 6665 6174 7572 6573 0a20  res = features. 
-000086a0: 2020 2020 2020 2069 6620 6665 6174 7572         if featur
-000086b0: 6573 2069 7320 6e6f 7420 4e6f 6e65 3a0a  es is not None:.
-000086c0: 2020 2020 2020 2020 2020 2020 6d61 7070              mapp
-000086d0: 696e 6720 3d20 6665 6174 7572 6573 2e65  ing = features.e
-000086e0: 6e63 6f64 655f 6261 7463 6828 6d61 7070  ncode_batch(mapp
-000086f0: 696e 6729 0a20 2020 2020 2020 206d 6170  ing).        map
-00008700: 7069 6e67 203d 207b 0a20 2020 2020 2020  ping = {.       
-00008710: 2020 2020 2063 6f6c 3a20 4f70 7469 6d69       col: Optimi
-00008720: 7a65 6454 7970 6564 5365 7175 656e 6365  zedTypedSequence
-00008730: 2864 6174 612c 2074 7970 653d 6665 6174  (data, type=feat
-00008740: 7572 6573 5b63 6f6c 5d20 6966 2066 6561  ures[col] if fea
-00008750: 7475 7265 7320 6973 206e 6f74 204e 6f6e  tures is not Non
-00008760: 6520 656c 7365 204e 6f6e 652c 2063 6f6c  e else None, col
-00008770: 3d63 6f6c 290a 2020 2020 2020 2020 2020  =col).          
-00008780: 2020 666f 7220 636f 6c2c 2064 6174 6120    for col, data 
-00008790: 696e 206d 6170 7069 6e67 2e69 7465 6d73  in mapping.items
-000087a0: 2829 0a20 2020 2020 2020 207d 0a20 2020  ().        }.   
-000087b0: 2020 2020 2070 615f 7461 626c 6520 3d20       pa_table = 
-000087c0: 496e 4d65 6d6f 7279 5461 626c 652e 6672  InMemoryTable.fr
-000087d0: 6f6d 5f70 7964 6963 7428 6d61 7070 696e  om_pydict(mappin
-000087e0: 673d 6d61 7070 696e 6729 0a20 2020 2020  g=mapping).     
-000087f0: 2020 2069 6620 696e 666f 2e66 6561 7475     if info.featu
-00008800: 7265 7320 6973 204e 6f6e 653a 0a20 2020  res is None:.   
-00008810: 2020 2020 2020 2020 2069 6e66 6f2e 6665           info.fe
-00008820: 6174 7572 6573 203d 2046 6561 7475 7265  atures = Feature
-00008830: 7328 7b63 6f6c 3a20 7473 2e67 6574 5f69  s({col: ts.get_i
-00008840: 6e66 6572 7265 645f 7479 7065 2829 2066  nferred_type() f
-00008850: 6f72 2063 6f6c 2c20 7473 2069 6e20 6d61  or col, ts in ma
-00008860: 7070 696e 672e 6974 656d 7328 297d 290a  pping.items()}).
-00008870: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00008880: 6c73 2870 615f 7461 626c 652c 2069 6e66  ls(pa_table, inf
-00008890: 6f3d 696e 666f 2c20 7370 6c69 743d 7370  o=info, split=sp
-000088a0: 6c69 7429 0a0a 2020 2020 4063 6c61 7373  lit)..    @class
-000088b0: 6d65 7468 6f64 0a20 2020 2064 6566 2066  method.    def f
-000088c0: 726f 6d5f 6c69 7374 280a 2020 2020 2020  rom_list(.      
-000088d0: 2020 636c 732c 0a20 2020 2020 2020 206d    cls,.        m
-000088e0: 6170 7069 6e67 3a20 4c69 7374 5b64 6963  apping: List[dic
-000088f0: 745d 2c0a 2020 2020 2020 2020 6665 6174  t],.        feat
-00008900: 7572 6573 3a20 4f70 7469 6f6e 616c 5b46  ures: Optional[F
-00008910: 6561 7475 7265 735d 203d 204e 6f6e 652c  eatures] = None,
-00008920: 0a20 2020 2020 2020 2069 6e66 6f3a 204f  .        info: O
-00008930: 7074 696f 6e61 6c5b 4461 7461 7365 7449  ptional[DatasetI
-00008940: 6e66 6f5d 203d 204e 6f6e 652c 0a20 2020  nfo] = None,.   
-00008950: 2020 2020 2073 706c 6974 3a20 4f70 7469       split: Opti
-00008960: 6f6e 616c 5b4e 616d 6564 5370 6c69 745d  onal[NamedSplit]
-00008970: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-00008980: 3e20 2244 6174 6173 6574 223a 0a20 2020  > "Dataset":.   
-00008990: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000089a0: 2043 6f6e 7665 7274 2061 206c 6973 7420   Convert a list 
-000089b0: 6f66 2064 6963 7473 2074 6f20 6120 6070  of dicts to a `p
-000089c0: 7961 7272 6f77 2e54 6162 6c65 6020 746f  yarrow.Table` to
-000089d0: 2063 7265 6174 6520 6120 3a63 6c61 7373   create a :class
-000089e0: 3a60 4461 7461 7365 7460 2e0a 0a20 2020  :`Dataset`...   
-000089f0: 2020 2020 204e 6f74 6520 7468 6174 2074       Note that t
-00008a00: 6865 206b 6579 7320 6f66 2074 6865 2066  he keys of the f
-00008a10: 6972 7374 2065 6e74 7279 2077 696c 6c20  irst entry will 
-00008a20: 6265 2075 7365 6420 746f 2064 6574 6572  be used to deter
-00008a30: 6d69 6e65 2074 6865 2064 6174 6173 6574  mine the dataset
-00008a40: 2063 6f6c 756d 6e73 2c0a 2020 2020 2020   columns,.      
-00008a50: 2020 7265 6761 7264 6c65 7373 206f 6620    regardless of 
-00008a60: 7768 6174 2069 7320 7061 7373 6564 2074  what is passed t
-00008a70: 6f20 6665 6174 7572 6573 2e0a 0a20 2020  o features...   
-00008a80: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00008a90: 2020 2020 2020 206d 6170 7069 6e67 2028         mapping (
-00008aa0: 604c 6973 745b 6469 6374 5d60 293a 2041  `List[dict]`): A
-00008ab0: 206c 6973 7420 6f66 206d 6170 7069 6e67   list of mapping
-00008ac0: 7320 6f66 2073 7472 696e 6773 2074 6f20  s of strings to 
-00008ad0: 726f 7720 7661 6c75 6573 2e0a 2020 2020  row values..    
-00008ae0: 2020 2020 2020 2020 6665 6174 7572 6573          features
-00008af0: 2028 3a63 6c61 7373 3a60 4665 6174 7572   (:class:`Featur
-00008b00: 6573 602c 206f 7074 696f 6e61 6c29 3a20  es`, optional): 
-00008b10: 4461 7461 7365 7420 6665 6174 7572 6573  Dataset features
-00008b20: 2e0a 2020 2020 2020 2020 2020 2020 696e  ..            in
-00008b30: 666f 2028 3a63 6c61 7373 3a60 4461 7461  fo (:class:`Data
-00008b40: 7365 7449 6e66 6f60 2c20 6f70 7469 6f6e  setInfo`, option
-00008b50: 616c 293a 2044 6174 6173 6574 2069 6e66  al): Dataset inf
-00008b60: 6f72 6d61 7469 6f6e 2c20 6c69 6b65 2064  ormation, like d
-00008b70: 6573 6372 6970 7469 6f6e 2c20 6369 7461  escription, cita
-00008b80: 7469 6f6e 2c20 6574 632e 0a20 2020 2020  tion, etc..     
-00008b90: 2020 2020 2020 2073 706c 6974 2028 3a63         split (:c
-00008ba0: 6c61 7373 3a60 4e61 6d65 6453 706c 6974  lass:`NamedSplit
-00008bb0: 602c 206f 7074 696f 6e61 6c29 3a20 4e61  `, optional): Na
-00008bc0: 6d65 206f 6620 7468 6520 6461 7461 7365  me of the datase
-00008bd0: 7420 7370 6c69 742e 0a0a 2020 2020 2020  t split...      
-00008be0: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-00008bf0: 2020 2020 2020 203a 636c 6173 733a 6044         :class:`D
-00008c00: 6174 6173 6574 600a 2020 2020 2020 2020  ataset`.        
-00008c10: 2222 220a 2020 2020 2020 2020 2320 666f  """.        # fo
-00008c20: 7220 7369 6d70 6c69 6369 7479 2061 6e64  r simplicity and
-00008c30: 2063 6f6e 7369 7374 656e 6379 2077 7274   consistency wrt
-00008c40: 204f 7074 696d 697a 6564 5479 7065 6453   OptimizedTypedS
-00008c50: 6571 7565 6e63 6520 7765 2064 6f20 6e6f  equence we do no
-00008c60: 7420 7573 6520 496e 4d65 6d6f 7279 5461  t use InMemoryTa
-00008c70: 626c 652e 6672 6f6d 5f70 796c 6973 7420  ble.from_pylist 
-00008c80: 6865 7265 0a20 2020 2020 2020 206d 6170  here.        map
-00008c90: 7069 6e67 203d 207b 6b3a 205b 722e 6765  ping = {k: [r.ge
-00008ca0: 7428 6b29 2066 6f72 2072 2069 6e20 6d61  t(k) for r in ma
-00008cb0: 7070 696e 675d 2066 6f72 206b 2069 6e20  pping] for k in 
-00008cc0: 6d61 7070 696e 675b 305d 7d20 6966 206d  mapping[0]} if m
-00008cd0: 6170 7069 6e67 2065 6c73 6520 7b7d 0a20  apping else {}. 
-00008ce0: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
-00008cf0: 732e 6672 6f6d 5f64 6963 7428 6d61 7070  s.from_dict(mapp
-00008d00: 696e 672c 2066 6561 7475 7265 732c 2069  ing, features, i
-00008d10: 6e66 6f2c 2073 706c 6974 290a 0a20 2020  nfo, split)..   
-00008d20: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
-00008d30: 2020 2064 6566 2066 726f 6d5f 6373 7628     def from_csv(
-00008d40: 0a20 2020 2020 2020 2070 6174 685f 6f72  .        path_or
-00008d50: 5f70 6174 6873 3a20 556e 696f 6e5b 5061  _paths: Union[Pa
-00008d60: 7468 4c69 6b65 2c20 4c69 7374 5b50 6174  thLike, List[Pat
-00008d70: 684c 696b 655d 5d2c 0a20 2020 2020 2020  hLike]],.       
-00008d80: 2073 706c 6974 3a20 4f70 7469 6f6e 616c   split: Optional
-00008d90: 5b4e 616d 6564 5370 6c69 745d 203d 204e  [NamedSplit] = N
-00008da0: 6f6e 652c 0a20 2020 2020 2020 2066 6561  one,.        fea
-00008db0: 7475 7265 733a 204f 7074 696f 6e61 6c5b  tures: Optional[
-00008dc0: 4665 6174 7572 6573 5d20 3d20 4e6f 6e65  Features] = None
-00008dd0: 2c0a 2020 2020 2020 2020 6361 6368 655f  ,.        cache_
-00008de0: 6469 723a 2073 7472 203d 204e 6f6e 652c  dir: str = None,
-00008df0: 0a20 2020 2020 2020 206b 6565 705f 696e  .        keep_in
-00008e00: 5f6d 656d 6f72 793a 2062 6f6f 6c20 3d20  _memory: bool = 
-00008e10: 4661 6c73 652c 0a20 2020 2020 2020 206e  False,.        n
-00008e20: 756d 5f70 726f 633a 204f 7074 696f 6e61  um_proc: Optiona
-00008e30: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
-00008e40: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
-00008e50: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00008e60: 2222 2243 7265 6174 6520 4461 7461 7365  """Create Datase
-00008e70: 7420 6672 6f6d 2043 5356 2066 696c 6528  t from CSV file(
-00008e80: 7329 2e0a 0a20 2020 2020 2020 2041 7267  s)...        Arg
-00008e90: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-00008ea0: 6174 685f 6f72 5f70 6174 6873 2028 6070  ath_or_paths (`p
-00008eb0: 6174 682d 6c69 6b65 6020 6f72 206c 6973  ath-like` or lis
-00008ec0: 7420 6f66 2060 7061 7468 2d6c 696b 6560  t of `path-like`
-00008ed0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00008ee0: 2020 2050 6174 6828 7329 206f 6620 7468     Path(s) of th
-00008ef0: 6520 4353 5620 6669 6c65 2873 292e 0a20  e CSV file(s).. 
-00008f00: 2020 2020 2020 2020 2020 2073 706c 6974             split
-00008f10: 2028 5b60 4e61 6d65 6453 706c 6974 605d   ([`NamedSplit`]
-00008f20: 2c20 2a6f 7074 696f 6e61 6c2a 293a 0a20  , *optional*):. 
-00008f30: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-00008f40: 706c 6974 206e 616d 6520 746f 2062 6520  plit name to be 
-00008f50: 6173 7369 676e 6564 2074 6f20 7468 6520  assigned to the 
-00008f60: 6461 7461 7365 742e 0a20 2020 2020 2020  dataset..       
-00008f70: 2020 2020 2066 6561 7475 7265 7320 285b       features ([
-00008f80: 6046 6561 7475 7265 7360 5d2c 202a 6f70  `Features`], *op
-00008f90: 7469 6f6e 616c 2a29 3a0a 2020 2020 2020  tional*):.      
-00008fa0: 2020 2020 2020 2020 2020 4461 7461 7365            Datase
-00008fb0: 7420 6665 6174 7572 6573 2e0a 2020 2020  t features..    
-00008fc0: 2020 2020 2020 2020 6361 6368 655f 6469          cache_di
-00008fd0: 7220 2860 7374 7260 2c20 2a6f 7074 696f  r (`str`, *optio
-00008fe0: 6e61 6c2a 2c20 6465 6661 756c 7473 2074  nal*, defaults t
-00008ff0: 6f20 6022 7e2f 2e63 6163 6865 2f68 7567  o `"~/.cache/hug
-00009000: 6769 6e67 6661 6365 2f64 6174 6173 6574  gingface/dataset
-00009010: 7322 6029 3a0a 2020 2020 2020 2020 2020  s"`):.          
-00009020: 2020 2020 2020 4469 7265 6374 6f72 7920        Directory 
-00009030: 746f 2063 6163 6865 2064 6174 612e 0a20  to cache data.. 
-00009040: 2020 2020 2020 2020 2020 206b 6565 705f             keep_
-00009050: 696e 5f6d 656d 6f72 7920 2860 626f 6f6c  in_memory (`bool
-00009060: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
-00009070: 4661 6c73 6560 293a 0a20 2020 2020 2020  False`):.       
-00009080: 2020 2020 2020 2020 2057 6865 7468 6572           Whether
-00009090: 2074 6f20 636f 7079 2074 6865 2064 6174   to copy the dat
-000090a0: 6120 696e 2d6d 656d 6f72 792e 0a20 2020  a in-memory..   
-000090b0: 2020 2020 2020 2020 206e 756d 5f70 726f           num_pro
-000090c0: 6320 2860 696e 7460 2c20 2a6f 7074 696f  c (`int`, *optio
-000090d0: 6e61 6c2a 2c20 6465 6661 756c 7473 2074  nal*, defaults t
-000090e0: 6f20 604e 6f6e 6560 293a 0a20 2020 2020  o `None`):.     
-000090f0: 2020 2020 2020 2020 2020 204e 756d 6265             Numbe
-00009100: 7220 6f66 2070 726f 6365 7373 6573 2077  r of processes w
-00009110: 6865 6e20 646f 776e 6c6f 6164 696e 6720  hen downloading 
-00009120: 616e 6420 6765 6e65 7261 7469 6e67 2074  and generating t
-00009130: 6865 2064 6174 6173 6574 206c 6f63 616c  he dataset local
-00009140: 6c79 2e0a 2020 2020 2020 2020 2020 2020  ly..            
-00009150: 2020 2020 5468 6973 2069 7320 6865 6c70      This is help
-00009160: 6675 6c20 6966 2074 6865 2064 6174 6173  ful if the datas
-00009170: 6574 2069 7320 6d61 6465 206f 6620 6d75  et is made of mu
-00009180: 6c74 6970 6c65 2066 696c 6573 2e20 4d75  ltiple files. Mu
-00009190: 6c74 6970 726f 6365 7373 696e 6720 6973  ltiprocessing is
-000091a0: 2064 6973 6162 6c65 6420 6279 2064 6566   disabled by def
-000091b0: 6175 6c74 2e0a 0a20 2020 2020 2020 2020  ault...         
-000091c0: 2020 2020 2020 203c 4164 6465 6420 7665         <Added ve
-000091d0: 7273 696f 6e3d 2232 2e38 2e30 222f 3e0a  rsion="2.8.0"/>.
-000091e0: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
-000091f0: 6172 6773 2028 6164 6469 7469 6f6e 616c  args (additional
-00009200: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-00009210: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
-00009220: 2020 2020 204b 6579 776f 7264 2061 7267       Keyword arg
-00009230: 756d 656e 7473 2074 6f20 6265 2070 6173  uments to be pas
-00009240: 7365 6420 746f 205b 6070 616e 6461 732e  sed to [`pandas.
-00009250: 7265 6164 5f63 7376 605d 2e0a 0a20 2020  read_csv`]...   
-00009260: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
-00009270: 2020 2020 2020 2020 2020 5b60 4461 7461            [`Data
-00009280: 7365 7460 5d0a 0a20 2020 2020 2020 2045  set`]..        E
-00009290: 7861 6d70 6c65 3a0a 0a20 2020 2020 2020  xample:..       
-000092a0: 2060 6060 7079 0a20 2020 2020 2020 203e   ```py.        >
-000092b0: 3e3e 2064 7320 3d20 4461 7461 7365 742e  >> ds = Dataset.
-000092c0: 6672 6f6d 5f63 7376 2827 7061 7468 2f74  from_csv('path/t
-000092d0: 6f2f 6461 7461 7365 742e 6373 7627 290a  o/dataset.csv').
-000092e0: 2020 2020 2020 2020 6060 600a 2020 2020          ```.    
-000092f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00009300: 2320 4479 6e61 6d69 6320 696d 706f 7274  # Dynamic import
-00009310: 2074 6f20 6176 6f69 6420 6369 7263 756c   to avoid circul
-00009320: 6172 2064 6570 656e 6465 6e63 790a 2020  ar dependency.  
-00009330: 2020 2020 2020 6672 6f6d 202e 696f 2e63        from .io.c
-00009340: 7376 2069 6d70 6f72 7420 4373 7644 6174  sv import CsvDat
-00009350: 6173 6574 5265 6164 6572 0a0a 2020 2020  asetReader..    
-00009360: 2020 2020 7265 7475 726e 2043 7376 4461      return CsvDa
-00009370: 7461 7365 7452 6561 6465 7228 0a20 2020  tasetReader(.   
-00009380: 2020 2020 2020 2020 2070 6174 685f 6f72           path_or
-00009390: 5f70 6174 6873 2c0a 2020 2020 2020 2020  _paths,.        
-000093a0: 2020 2020 7370 6c69 743d 7370 6c69 742c      split=split,
-000093b0: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
-000093c0: 7475 7265 733d 6665 6174 7572 6573 2c0a  tures=features,.
-000093d0: 2020 2020 2020 2020 2020 2020 6361 6368              cach
-000093e0: 655f 6469 723d 6361 6368 655f 6469 722c  e_dir=cache_dir,
-000093f0: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
-00009400: 705f 696e 5f6d 656d 6f72 793d 6b65 6570  p_in_memory=keep
-00009410: 5f69 6e5f 6d65 6d6f 7279 2c0a 2020 2020  _in_memory,.    
-00009420: 2020 2020 2020 2020 6e75 6d5f 7072 6f63          num_proc
-00009430: 3d6e 756d 5f70 726f 632c 0a20 2020 2020  =num_proc,.     
-00009440: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
-00009450: 0a20 2020 2020 2020 2029 2e72 6561 6428  .        ).read(
-00009460: 290a 0a20 2020 2040 7374 6174 6963 6d65  )..    @staticme
-00009470: 7468 6f64 0a20 2020 2064 6566 2066 726f  thod.    def fro
-00009480: 6d5f 6765 6e65 7261 746f 7228 0a20 2020  m_generator(.   
-00009490: 2020 2020 2067 656e 6572 6174 6f72 3a20       generator: 
-000094a0: 4361 6c6c 6162 6c65 2c0a 2020 2020 2020  Callable,.      
-000094b0: 2020 6665 6174 7572 6573 3a20 4f70 7469    features: Opti
-000094c0: 6f6e 616c 5b46 6561 7475 7265 735d 203d  onal[Features] =
-000094d0: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
-000094e0: 6163 6865 5f64 6972 3a20 7374 7220 3d20  ache_dir: str = 
-000094f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6b65  None,.        ke
-00009500: 6570 5f69 6e5f 6d65 6d6f 7279 3a20 626f  ep_in_memory: bo
-00009510: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-00009520: 2020 2020 6765 6e5f 6b77 6172 6773 3a20      gen_kwargs: 
-00009530: 4f70 7469 6f6e 616c 5b64 6963 745d 203d  Optional[dict] =
-00009540: 204e 6f6e 652c 0a20 2020 2020 2020 206e   None,.        n
-00009550: 756d 5f70 726f 633a 204f 7074 696f 6e61  um_proc: Optiona
-00009560: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
-00009570: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
-00009580: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00009590: 2222 2243 7265 6174 6520 6120 4461 7461  """Create a Data
-000095a0: 7365 7420 6672 6f6d 2061 2067 656e 6572  set from a gener
-000095b0: 6174 6f72 2e0a 0a20 2020 2020 2020 2041  ator...        A
-000095c0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-000095d0: 2067 656e 6572 6174 6f72 2028 3a60 4361   generator (:`Ca
-000095e0: 6c6c 6162 6c65 6029 3a0a 2020 2020 2020  llable`):.      
-000095f0: 2020 2020 2020 2020 2020 4120 6765 6e65            A gene
-00009600: 7261 746f 7220 6675 6e63 7469 6f6e 2074  rator function t
-00009610: 6861 7420 6079 6965 6c64 7360 2065 7861  hat `yields` exa
-00009620: 6d70 6c65 732e 0a20 2020 2020 2020 2020  mples..         
-00009630: 2020 2066 6561 7475 7265 7320 285b 6046     features ([`F
-00009640: 6561 7475 7265 7360 5d2c 202a 6f70 7469  eatures`], *opti
-00009650: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
-00009660: 2020 2020 2020 2020 4461 7461 7365 7420          Dataset 
-00009670: 6665 6174 7572 6573 2e0a 2020 2020 2020  features..      
-00009680: 2020 2020 2020 6361 6368 655f 6469 7220        cache_dir 
-00009690: 2860 7374 7260 2c20 2a6f 7074 696f 6e61  (`str`, *optiona
-000096a0: 6c2a 2c20 6465 6661 756c 7473 2074 6f20  l*, defaults to 
-000096b0: 6022 7e2f 2e63 6163 6865 2f68 7567 6769  `"~/.cache/huggi
-000096c0: 6e67 6661 6365 2f64 6174 6173 6574 7322  ngface/datasets"
-000096d0: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
-000096e0: 2020 2020 4469 7265 6374 6f72 7920 746f      Directory to
-000096f0: 2063 6163 6865 2064 6174 612e 0a20 2020   cache data..   
-00009700: 2020 2020 2020 2020 206b 6565 705f 696e           keep_in
-00009710: 5f6d 656d 6f72 7920 2860 626f 6f6c 602c  _memory (`bool`,
-00009720: 2064 6566 6175 6c74 7320 746f 2060 4661   defaults to `Fa
-00009730: 6c73 6560 293a 0a20 2020 2020 2020 2020  lse`):.         
-00009740: 2020 2020 2020 2057 6865 7468 6572 2074         Whether t
-00009750: 6f20 636f 7079 2074 6865 2064 6174 6120  o copy the data 
-00009760: 696e 2d6d 656d 6f72 792e 0a20 2020 2020  in-memory..     
-00009770: 2020 2020 2020 2067 656e 5f6b 7761 7267         gen_kwarg
-00009780: 7328 6064 6963 7460 2c20 2a6f 7074 696f  s(`dict`, *optio
-00009790: 6e61 6c2a 293a 0a20 2020 2020 2020 2020  nal*):.         
-000097a0: 2020 2020 2020 204b 6579 776f 7264 2061         Keyword a
-000097b0: 7267 756d 656e 7473 2074 6f20 6265 2070  rguments to be p
-000097c0: 6173 7365 6420 746f 2074 6865 2060 6765  assed to the `ge
-000097d0: 6e65 7261 746f 7260 2063 616c 6c61 626c  nerator` callabl
-000097e0: 652e 0a20 2020 2020 2020 2020 2020 2020  e..             
-000097f0: 2020 2059 6f75 2063 616e 2064 6566 696e     You can defin
-00009800: 6520 6120 7368 6172 6465 6420 6461 7461  e a sharded data
-00009810: 7365 7420 6279 2070 6173 7369 6e67 2074  set by passing t
-00009820: 6865 206c 6973 7420 6f66 2073 6861 7264  he list of shard
-00009830: 7320 696e 2060 6765 6e5f 6b77 6172 6773  s in `gen_kwargs
-00009840: 602e 0a20 2020 2020 2020 2020 2020 206e  `..            n
-00009850: 756d 5f70 726f 6320 2860 696e 7460 2c20  um_proc (`int`, 
-00009860: 2a6f 7074 696f 6e61 6c2a 2c20 6465 6661  *optional*, defa
-00009870: 756c 7473 2074 6f20 604e 6f6e 6560 293a  ults to `None`):
-00009880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009890: 204e 756d 6265 7220 6f66 2070 726f 6365   Number of proce
-000098a0: 7373 6573 2077 6865 6e20 646f 776e 6c6f  sses when downlo
-000098b0: 6164 696e 6720 616e 6420 6765 6e65 7261  ading and genera
-000098c0: 7469 6e67 2074 6865 2064 6174 6173 6574  ting the dataset
-000098d0: 206c 6f63 616c 6c79 2e0a 2020 2020 2020   locally..      
-000098e0: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-000098f0: 6973 2069 7320 6865 6c70 6675 6c20 6966  is is helpful if
-00009900: 2074 6865 2064 6174 6173 6574 2069 7320   the dataset is 
-00009910: 6d61 6465 206f 6620 6d75 6c74 6970 6c65  made of multiple
-00009920: 2066 696c 6573 2e20 4d75 6c74 6970 726f   files. Multipro
-00009930: 6365 7373 696e 6720 6973 2064 6973 6162  cessing is disab
-00009940: 6c65 6420 6279 2064 6566 6175 6c74 2e0a  led by default..
-00009950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009960: 2020 2020 203c 4164 6465 6420 7665 7273       <Added vers
-00009970: 696f 6e3d 2232 2e37 2e30 222f 3e0a 2020  ion="2.7.0"/>.  
-00009980: 2020 2020 2020 2020 2020 2a2a 6b77 6172            **kwar
-00009990: 6773 2028 6164 6469 7469 6f6e 616c 206b  gs (additional k
-000099a0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-000099b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000099c0: 2020 204b 6579 776f 7264 2061 7267 756d     Keyword argum
-000099d0: 656e 7473 2074 6f20 6265 2070 6173 7365  ents to be passe
-000099e0: 6420 746f 203a 5b60 4765 6e65 7261 746f  d to :[`Generato
-000099f0: 7243 6f6e 6669 6760 5d2e 0a0a 2020 2020  rConfig`]...    
-00009a00: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
-00009a10: 2020 2020 2020 2020 205b 6044 6174 6173           [`Datas
-00009a20: 6574 605d 0a0a 2020 2020 2020 2020 4578  et`]..        Ex
-00009a30: 616d 706c 653a 0a0a 2020 2020 2020 2020  ample:..        
-00009a40: 6060 6070 790a 2020 2020 2020 2020 3e3e  ```py.        >>
-00009a50: 3e20 6465 6620 6765 6e28 293a 0a20 2020  > def gen():.   
-00009a60: 2020 2020 202e 2e2e 2020 2020 2079 6965       ...     yie
-00009a70: 6c64 207b 2274 6578 7422 3a20 2247 6f6f  ld {"text": "Goo
-00009a80: 6422 2c20 226c 6162 656c 223a 2030 7d0a  d", "label": 0}.
-00009a90: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-00009aa0: 7969 656c 6420 7b22 7465 7874 223a 2022  yield {"text": "
-00009ab0: 4261 6422 2c20 226c 6162 656c 223a 2031  Bad", "label": 1
-00009ac0: 7d0a 2020 2020 2020 2020 2e2e 2e0a 2020  }.        ....  
-00009ad0: 2020 2020 2020 3e3e 3e20 6473 203d 2044        >>> ds = D
-00009ae0: 6174 6173 6574 2e66 726f 6d5f 6765 6e65  ataset.from_gene
-00009af0: 7261 746f 7228 6765 6e29 0a20 2020 2020  rator(gen).     
-00009b00: 2020 2060 6060 0a0a 2020 2020 2020 2020     ```..        
-00009b10: 6060 6070 790a 2020 2020 2020 2020 3e3e  ```py.        >>
-00009b20: 3e20 6465 6620 6765 6e28 7368 6172 6473  > def gen(shards
-00009b30: 293a 0a20 2020 2020 2020 202e 2e2e 2020  ):.        ...  
-00009b40: 2020 2066 6f72 2073 6861 7264 2069 6e20     for shard in 
-00009b50: 7368 6172 6473 3a0a 2020 2020 2020 2020  shards:.        
-00009b60: 2e2e 2e20 2020 2020 2020 2020 7769 7468  ...         with
-00009b70: 206f 7065 6e28 7368 6172 6429 2061 7320   open(shard) as 
-00009b80: 663a 0a20 2020 2020 2020 202e 2e2e 2020  f:.        ...  
-00009b90: 2020 2020 2020 2020 2020 2066 6f72 206c             for l
-00009ba0: 696e 6520 696e 2066 3a0a 2020 2020 2020  ine in f:.      
-00009bb0: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
-00009bc0: 2020 2020 2020 7969 656c 6420 7b22 6c69        yield {"li
-00009bd0: 6e65 223a 206c 696e 657d 0a20 2020 2020  ne": line}.     
-00009be0: 2020 202e 2e2e 0a20 2020 2020 2020 203e     ....        >
-00009bf0: 3e3e 2073 6861 7264 7320 3d20 5b66 2264  >> shards = [f"d
-00009c00: 6174 617b 697d 2e74 7874 2220 666f 7220  ata{i}.txt" for 
-00009c10: 6920 696e 2072 616e 6765 2833 3229 5d0a  i in range(32)].
-00009c20: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
-00009c30: 2044 6174 6173 6574 2e66 726f 6d5f 6765   Dataset.from_ge
-00009c40: 6e65 7261 746f 7228 6765 6e2c 2067 656e  nerator(gen, gen
-00009c50: 5f6b 7761 7267 733d 7b22 7368 6172 6473  _kwargs={"shards
-00009c60: 223a 2073 6861 7264 737d 290a 2020 2020  ": shards}).    
-00009c70: 2020 2020 6060 600a 2020 2020 2020 2020      ```.        
-00009c80: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-00009c90: 202e 696f 2e67 656e 6572 6174 6f72 2069   .io.generator i
-00009ca0: 6d70 6f72 7420 4765 6e65 7261 746f 7244  mport GeneratorD
-00009cb0: 6174 6173 6574 496e 7075 7453 7472 6561  atasetInputStrea
-00009cc0: 6d0a 0a20 2020 2020 2020 2072 6574 7572  m..        retur
-00009cd0: 6e20 4765 6e65 7261 746f 7244 6174 6173  n GeneratorDatas
-00009ce0: 6574 496e 7075 7453 7472 6561 6d28 0a20  etInputStream(. 
-00009cf0: 2020 2020 2020 2020 2020 2067 656e 6572             gener
-00009d00: 6174 6f72 3d67 656e 6572 6174 6f72 2c0a  ator=generator,.
-00009d10: 2020 2020 2020 2020 2020 2020 6665 6174              feat
-00009d20: 7572 6573 3d66 6561 7475 7265 732c 0a20  ures=features,. 
-00009d30: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-00009d40: 5f64 6972 3d63 6163 6865 5f64 6972 2c0a  _dir=cache_dir,.
-00009d50: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
-00009d60: 5f69 6e5f 6d65 6d6f 7279 3d6b 6565 705f  _in_memory=keep_
-00009d70: 696e 5f6d 656d 6f72 792c 0a20 2020 2020  in_memory,.     
-00009d80: 2020 2020 2020 2067 656e 5f6b 7761 7267         gen_kwarg
-00009d90: 733d 6765 6e5f 6b77 6172 6773 2c0a 2020  s=gen_kwargs,.  
-00009da0: 2020 2020 2020 2020 2020 6e75 6d5f 7072            num_pr
-00009db0: 6f63 3d6e 756d 5f70 726f 632c 0a20 2020  oc=num_proc,.   
-00009dc0: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
-00009dd0: 732c 0a20 2020 2020 2020 2029 2e72 6561  s,.        ).rea
-00009de0: 6428 290a 0a20 2020 2040 7374 6174 6963  d()..    @static
-00009df0: 6d65 7468 6f64 0a20 2020 2064 6566 2066  method.    def f
-00009e00: 726f 6d5f 6a73 6f6e 280a 2020 2020 2020  rom_json(.      
-00009e10: 2020 7061 7468 5f6f 725f 7061 7468 733a    path_or_paths:
-00009e20: 2055 6e69 6f6e 5b50 6174 684c 696b 652c   Union[PathLike,
-00009e30: 204c 6973 745b 5061 7468 4c69 6b65 5d5d   List[PathLike]]
-00009e40: 2c0a 2020 2020 2020 2020 7370 6c69 743a  ,.        split:
-00009e50: 204f 7074 696f 6e61 6c5b 4e61 6d65 6453   Optional[NamedS
-00009e60: 706c 6974 5d20 3d20 4e6f 6e65 2c0a 2020  plit] = None,.  
-00009e70: 2020 2020 2020 6665 6174 7572 6573 3a20        features: 
-00009e80: 4f70 7469 6f6e 616c 5b46 6561 7475 7265  Optional[Feature
-00009e90: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
-00009ea0: 2020 2063 6163 6865 5f64 6972 3a20 7374     cache_dir: st
-00009eb0: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
-00009ec0: 2020 6b65 6570 5f69 6e5f 6d65 6d6f 7279    keep_in_memory
-00009ed0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-00009ee0: 2020 2020 2020 2020 6669 656c 643a 204f          field: O
-00009ef0: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-00009f00: 6f6e 652c 0a20 2020 2020 2020 206e 756d  one,.        num
-00009f10: 5f70 726f 633a 204f 7074 696f 6e61 6c5b  _proc: Optional[
-00009f20: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
-00009f30: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-00009f40: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-00009f50: 2243 7265 6174 6520 4461 7461 7365 7420  "Create Dataset 
-00009f60: 6672 6f6d 204a 534f 4e20 6f72 204a 534f  from JSON or JSO
-00009f70: 4e20 4c69 6e65 7320 6669 6c65 2873 292e  N Lines file(s).
-00009f80: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-00009f90: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00009fa0: 5f6f 725f 7061 7468 7320 2860 7061 7468  _or_paths (`path
-00009fb0: 2d6c 696b 6560 206f 7220 6c69 7374 206f  -like` or list o
-00009fc0: 6620 6070 6174 682d 6c69 6b65 6029 3a0a  f `path-like`):.
-00009fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fe0: 5061 7468 2873 2920 6f66 2074 6865 204a  Path(s) of the J
-00009ff0: 534f 4e20 6f72 204a 534f 4e20 4c69 6e65  SON or JSON Line
-0000a000: 7320 6669 6c65 2873 292e 0a20 2020 2020  s file(s)..     
-0000a010: 2020 2020 2020 2073 706c 6974 2028 5b60         split ([`
-0000a020: 4e61 6d65 6453 706c 6974 605d 2c20 2a6f  NamedSplit`], *o
-0000a030: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
-0000a040: 2020 2020 2020 2020 2020 2053 706c 6974             Split
-0000a050: 206e 616d 6520 746f 2062 6520 6173 7369   name to be assi
-0000a060: 676e 6564 2074 6f20 7468 6520 6461 7461  gned to the data
-0000a070: 7365 742e 0a20 2020 2020 2020 2020 2020  set..           
-0000a080: 2066 6561 7475 7265 7320 285b 6046 6561   features ([`Fea
-0000a090: 7475 7265 7360 5d2c 202a 6f70 7469 6f6e  tures`], *option
-0000a0a0: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
-0000a0b0: 2020 2020 2020 2044 6174 6173 6574 2066         Dataset f
-0000a0c0: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
-0000a0d0: 2020 2020 2063 6163 6865 5f64 6972 2028       cache_dir (
-0000a0e0: 6073 7472 602c 202a 6f70 7469 6f6e 616c  `str`, *optional
-0000a0f0: 2a2c 2064 6566 6175 6c74 7320 746f 2060  *, defaults to `
-0000a100: 227e 2f2e 6361 6368 652f 6875 6767 696e  "~/.cache/huggin
-0000a110: 6766 6163 652f 6461 7461 7365 7473 2260  gface/datasets"`
-0000a120: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000a130: 2020 2044 6972 6563 746f 7279 2074 6f20     Directory to 
-0000a140: 6361 6368 6520 6461 7461 2e0a 2020 2020  cache data..    
-0000a150: 2020 2020 2020 2020 6b65 6570 5f69 6e5f          keep_in_
-0000a160: 6d65 6d6f 7279 2028 6062 6f6f 6c60 2c20  memory (`bool`, 
-0000a170: 6465 6661 756c 7473 2074 6f20 6046 616c  defaults to `Fal
-0000a180: 7365 6029 3a0a 2020 2020 2020 2020 2020  se`):.          
-0000a190: 2020 2020 2020 5768 6574 6865 7220 746f        Whether to
-0000a1a0: 2063 6f70 7920 7468 6520 6461 7461 2069   copy the data i
-0000a1b0: 6e2d 6d65 6d6f 7279 2e0a 2020 2020 2020  n-memory..      
-0000a1c0: 2020 2020 2020 6669 656c 6420 2860 7374        field (`st
-0000a1d0: 7260 2c20 2a6f 7074 696f 6e61 6c2a 293a  r`, *optional*):
-0000a1e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a1f0: 2046 6965 6c64 206e 616d 6520 6f66 2074   Field name of t
-0000a200: 6865 204a 534f 4e20 6669 6c65 2077 6865  he JSON file whe
-0000a210: 7265 2074 6865 2064 6174 6173 6574 2069  re the dataset i
-0000a220: 7320 636f 6e74 6169 6e65 6420 696e 2e0a  s contained in..
-0000a230: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
-0000a240: 7072 6f63 2028 6069 6e74 602c 202a 6f70  proc (`int`, *op
-0000a250: 7469 6f6e 616c 2a20 6465 6661 756c 7473  tional* defaults
-0000a260: 2074 6f20 604e 6f6e 6560 293a 0a20 2020   to `None`):.   
-0000a270: 2020 2020 2020 2020 2020 2020 204e 756d               Num
-0000a280: 6265 7220 6f66 2070 726f 6365 7373 6573  ber of processes
-0000a290: 2077 6865 6e20 646f 776e 6c6f 6164 696e   when downloadin
-0000a2a0: 6720 616e 6420 6765 6e65 7261 7469 6e67  g and generating
-0000a2b0: 2074 6865 2064 6174 6173 6574 206c 6f63   the dataset loc
-0000a2c0: 616c 6c79 2e0a 2020 2020 2020 2020 2020  ally..          
-0000a2d0: 2020 2020 2020 5468 6973 2069 7320 6865        This is he
-0000a2e0: 6c70 6675 6c20 6966 2074 6865 2064 6174  lpful if the dat
-0000a2f0: 6173 6574 2069 7320 6d61 6465 206f 6620  aset is made of 
-0000a300: 6d75 6c74 6970 6c65 2066 696c 6573 2e20  multiple files. 
-0000a310: 4d75 6c74 6970 726f 6365 7373 696e 6720  Multiprocessing 
-0000a320: 6973 2064 6973 6162 6c65 6420 6279 2064  is disabled by d
-0000a330: 6566 6175 6c74 2e0a 0a20 2020 2020 2020  efault...       
-0000a340: 2020 2020 2020 2020 203c 4164 6465 6420           <Added 
-0000a350: 7665 7273 696f 6e3d 2232 2e38 2e30 222f  version="2.8.0"/
-0000a360: 3e0a 2020 2020 2020 2020 2020 2020 2a2a  >.            **
-0000a370: 6b77 6172 6773 2028 6164 6469 7469 6f6e  kwargs (addition
-0000a380: 616c 206b 6579 776f 7264 2061 7267 756d  al keyword argum
-0000a390: 656e 7473 293a 0a20 2020 2020 2020 2020  ents):.         
-0000a3a0: 2020 2020 2020 204b 6579 776f 7264 2061         Keyword a
-0000a3b0: 7267 756d 656e 7473 2074 6f20 6265 2070  rguments to be p
-0000a3c0: 6173 7365 6420 746f 205b 604a 736f 6e43  assed to [`JsonC
-0000a3d0: 6f6e 6669 6760 5d2e 0a0a 2020 2020 2020  onfig`]...      
-0000a3e0: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-0000a3f0: 2020 2020 2020 205b 6044 6174 6173 6574         [`Dataset
-0000a400: 605d 0a0a 2020 2020 2020 2020 4578 616d  `]..        Exam
-0000a410: 706c 653a 0a0a 2020 2020 2020 2020 6060  ple:..        ``
-0000a420: 6070 790a 2020 2020 2020 2020 3e3e 3e20  `py.        >>> 
-0000a430: 6473 203d 2044 6174 6173 6574 2e66 726f  ds = Dataset.fro
-0000a440: 6d5f 6a73 6f6e 2827 7061 7468 2f74 6f2f  m_json('path/to/
-0000a450: 6461 7461 7365 742e 6a73 6f6e 2729 0a20  dataset.json'). 
-0000a460: 2020 2020 2020 2060 6060 0a20 2020 2020         ```.     
-0000a470: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-0000a480: 2044 796e 616d 6963 2069 6d70 6f72 7420   Dynamic import 
-0000a490: 746f 2061 766f 6964 2063 6972 6375 6c61  to avoid circula
-0000a4a0: 7220 6465 7065 6e64 656e 6379 0a20 2020  r dependency.   
-0000a4b0: 2020 2020 2066 726f 6d20 2e69 6f2e 6a73       from .io.js
-0000a4c0: 6f6e 2069 6d70 6f72 7420 4a73 6f6e 4461  on import JsonDa
-0000a4d0: 7461 7365 7452 6561 6465 720a 0a20 2020  tasetReader..   
-0000a4e0: 2020 2020 2072 6574 7572 6e20 4a73 6f6e       return Json
-0000a4f0: 4461 7461 7365 7452 6561 6465 7228 0a20  DatasetReader(. 
-0000a500: 2020 2020 2020 2020 2020 2070 6174 685f             path_
-0000a510: 6f72 5f70 6174 6873 2c0a 2020 2020 2020  or_paths,.      
-0000a520: 2020 2020 2020 7370 6c69 743d 7370 6c69        split=spli
-0000a530: 742c 0a20 2020 2020 2020 2020 2020 2066  t,.            f
-0000a540: 6561 7475 7265 733d 6665 6174 7572 6573  eatures=features
-0000a550: 2c0a 2020 2020 2020 2020 2020 2020 6361  ,.            ca
-0000a560: 6368 655f 6469 723d 6361 6368 655f 6469  che_dir=cache_di
-0000a570: 722c 0a20 2020 2020 2020 2020 2020 206b  r,.            k
-0000a580: 6565 705f 696e 5f6d 656d 6f72 793d 6b65  eep_in_memory=ke
-0000a590: 6570 5f69 6e5f 6d65 6d6f 7279 2c0a 2020  ep_in_memory,.  
-0000a5a0: 2020 2020 2020 2020 2020 6669 656c 643d            field=
-0000a5b0: 6669 656c 642c 0a20 2020 2020 2020 2020  field,.         
-0000a5c0: 2020 206e 756d 5f70 726f 633d 6e75 6d5f     num_proc=num_
-0000a5d0: 7072 6f63 2c0a 2020 2020 2020 2020 2020  proc,.          
-0000a5e0: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
-0000a5f0: 2020 2020 292e 7265 6164 2829 0a0a 2020      ).read()..  
-0000a600: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-0000a610: 2020 2020 6465 6620 6672 6f6d 5f70 6172      def from_par
-0000a620: 7175 6574 280a 2020 2020 2020 2020 7061  quet(.        pa
-0000a630: 7468 5f6f 725f 7061 7468 733a 2055 6e69  th_or_paths: Uni
-0000a640: 6f6e 5b50 6174 684c 696b 652c 204c 6973  on[PathLike, Lis
-0000a650: 745b 5061 7468 4c69 6b65 5d5d 2c0a 2020  t[PathLike]],.  
-0000a660: 2020 2020 2020 7370 6c69 743a 204f 7074        split: Opt
-0000a670: 696f 6e61 6c5b 4e61 6d65 6453 706c 6974  ional[NamedSplit
-0000a680: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-0000a690: 2020 6665 6174 7572 6573 3a20 4f70 7469    features: Opti
-0000a6a0: 6f6e 616c 5b46 6561 7475 7265 735d 203d  onal[Features] =
-0000a6b0: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
-0000a6c0: 6163 6865 5f64 6972 3a20 7374 7220 3d20  ache_dir: str = 
-0000a6d0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6b65  None,.        ke
-0000a6e0: 6570 5f69 6e5f 6d65 6d6f 7279 3a20 626f  ep_in_memory: bo
-0000a6f0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0000a700: 2020 2020 636f 6c75 6d6e 733a 204f 7074      columns: Opt
-0000a710: 696f 6e61 6c5b 4c69 7374 5b73 7472 5d5d  ional[List[str]]
-0000a720: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0000a730: 206e 756d 5f70 726f 633a 204f 7074 696f   num_proc: Optio
-0000a740: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
-0000a750: 0a20 2020 2020 2020 202a 2a6b 7761 7267  .        **kwarg
-0000a760: 732c 0a20 2020 2029 3a0a 2020 2020 2020  s,.    ):.      
-0000a770: 2020 2222 2243 7265 6174 6520 4461 7461    """Create Data
-0000a780: 7365 7420 6672 6f6d 2050 6172 7175 6574  set from Parquet
-0000a790: 2066 696c 6528 7329 2e0a 0a20 2020 2020   file(s)...     
-0000a7a0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-0000a7b0: 2020 2020 2070 6174 685f 6f72 5f70 6174       path_or_pat
-0000a7c0: 6873 2028 6070 6174 682d 6c69 6b65 6020  hs (`path-like` 
-0000a7d0: 6f72 206c 6973 7420 6f66 2060 7061 7468  or list of `path
-0000a7e0: 2d6c 696b 6560 293a 0a20 2020 2020 2020  -like`):.       
-0000a7f0: 2020 2020 2020 2020 2050 6174 6828 7329           Path(s)
-0000a800: 206f 6620 7468 6520 5061 7271 7565 7420   of the Parquet 
-0000a810: 6669 6c65 2873 292e 0a20 2020 2020 2020  file(s)..       
-0000a820: 2020 2020 2073 706c 6974 2028 604e 616d       split (`Nam
-0000a830: 6564 5370 6c69 7460 2c20 2a6f 7074 696f  edSplit`, *optio
-0000a840: 6e61 6c2a 293a 0a20 2020 2020 2020 2020  nal*):.         
-0000a850: 2020 2020 2020 2053 706c 6974 206e 616d         Split nam
-0000a860: 6520 746f 2062 6520 6173 7369 676e 6564  e to be assigned
-0000a870: 2074 6f20 7468 6520 6461 7461 7365 742e   to the dataset.
-0000a880: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
-0000a890: 7475 7265 7320 2860 4665 6174 7572 6573  tures (`Features
-0000a8a0: 602c 202a 6f70 7469 6f6e 616c 2a29 3a0a  `, *optional*):.
-0000a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a8c0: 4461 7461 7365 7420 6665 6174 7572 6573  Dataset features
-0000a8d0: 2e0a 2020 2020 2020 2020 2020 2020 6361  ..            ca
-0000a8e0: 6368 655f 6469 7220 2860 7374 7260 2c20  che_dir (`str`, 
-0000a8f0: 2a6f 7074 696f 6e61 6c2a 2c20 6465 6661  *optional*, defa
-0000a900: 756c 7473 2074 6f20 6022 7e2f 2e63 6163  ults to `"~/.cac
-0000a910: 6865 2f68 7567 6769 6e67 6661 6365 2f64  he/huggingface/d
-0000a920: 6174 6173 6574 7322 6029 3a0a 2020 2020  atasets"`):.    
-0000a930: 2020 2020 2020 2020 2020 2020 4469 7265              Dire
-0000a940: 6374 6f72 7920 746f 2063 6163 6865 2064  ctory to cache d
-0000a950: 6174 612e 0a20 2020 2020 2020 2020 2020  ata..           
-0000a960: 206b 6565 705f 696e 5f6d 656d 6f72 7920   keep_in_memory 
-0000a970: 2860 626f 6f6c 602c 2064 6566 6175 6c74  (`bool`, default
-0000a980: 7320 746f 2060 4661 6c73 6560 293a 0a20  s to `False`):. 
-0000a990: 2020 2020 2020 2020 2020 2020 2020 2057                 W
-0000a9a0: 6865 7468 6572 2074 6f20 636f 7079 2074  hether to copy t
-0000a9b0: 6865 2064 6174 6120 696e 2d6d 656d 6f72  he data in-memor
-0000a9c0: 792e 0a20 2020 2020 2020 2020 2020 2063  y..            c
-0000a9d0: 6f6c 756d 6e73 2028 604c 6973 745b 7374  olumns (`List[st
-0000a9e0: 725d 602c 202a 6f70 7469 6f6e 616c 2a29  r]`, *optional*)
-0000a9f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000aa00: 2020 4966 206e 6f74 2060 4e6f 6e65 602c    If not `None`,
-0000aa10: 206f 6e6c 7920 7468 6573 6520 636f 6c75   only these colu
-0000aa20: 6d6e 7320 7769 6c6c 2062 6520 7265 6164  mns will be read
-0000aa30: 2066 726f 6d20 7468 6520 6669 6c65 2e0a   from the file..
-0000aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa50: 4120 636f 6c75 6d6e 206e 616d 6520 6d61  A column name ma
-0000aa60: 7920 6265 2061 2070 7265 6669 7820 6f66  y be a prefix of
-0000aa70: 2061 206e 6573 7465 6420 6669 656c 642c   a nested field,
-0000aa80: 2065 2e67 2e20 2761 2720 7769 6c6c 2073   e.g. 'a' will s
-0000aa90: 656c 6563 740a 2020 2020 2020 2020 2020  elect.          
-0000aaa0: 2020 2020 2020 2761 2e62 272c 2027 612e        'a.b', 'a.
-0000aab0: 6327 2c20 616e 6420 2761 2e64 2e65 272e  c', and 'a.d.e'.
-0000aac0: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
-0000aad0: 5f70 726f 6320 2860 696e 7460 2c20 2a6f  _proc (`int`, *o
-0000aae0: 7074 696f 6e61 6c2a 2c20 6465 6661 756c  ptional*, defaul
-0000aaf0: 7473 2074 6f20 604e 6f6e 6560 293a 0a20  ts to `None`):. 
-0000ab00: 2020 2020 2020 2020 2020 2020 2020 204e                 N
-0000ab10: 756d 6265 7220 6f66 2070 726f 6365 7373  umber of process
-0000ab20: 6573 2077 6865 6e20 646f 776e 6c6f 6164  es when download
-0000ab30: 696e 6720 616e 6420 6765 6e65 7261 7469  ing and generati
-0000ab40: 6e67 2074 6865 2064 6174 6173 6574 206c  ng the dataset l
-0000ab50: 6f63 616c 6c79 2e0a 2020 2020 2020 2020  ocally..        
-0000ab60: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
-0000ab70: 6865 6c70 6675 6c20 6966 2074 6865 2064  helpful if the d
-0000ab80: 6174 6173 6574 2069 7320 6d61 6465 206f  ataset is made o
-0000ab90: 6620 6d75 6c74 6970 6c65 2066 696c 6573  f multiple files
-0000aba0: 2e20 4d75 6c74 6970 726f 6365 7373 696e  . Multiprocessin
-0000abb0: 6720 6973 2064 6973 6162 6c65 6420 6279  g is disabled by
-0000abc0: 2064 6566 6175 6c74 2e0a 0a20 2020 2020   default...     
-0000abd0: 2020 2020 2020 2020 2020 203c 4164 6465             <Adde
-0000abe0: 6420 7665 7273 696f 6e3d 2232 2e38 2e30  d version="2.8.0
-0000abf0: 222f 3e0a 2020 2020 2020 2020 2020 2020  "/>.            
-0000ac00: 2a2a 6b77 6172 6773 2028 6164 6469 7469  **kwargs (additi
-0000ac10: 6f6e 616c 206b 6579 776f 7264 2061 7267  onal keyword arg
-0000ac20: 756d 656e 7473 293a 0a20 2020 2020 2020  uments):.       
-0000ac30: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
-0000ac40: 2061 7267 756d 656e 7473 2074 6f20 6265   arguments to be
-0000ac50: 2070 6173 7365 6420 746f 205b 6050 6172   passed to [`Par
-0000ac60: 7175 6574 436f 6e66 6967 605d 2e0a 0a20  quetConfig`]... 
-0000ac70: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
-0000ac80: 2020 2020 2020 2020 2020 2020 5b60 4461              [`Da
-0000ac90: 7461 7365 7460 5d0a 0a20 2020 2020 2020  taset`]..       
-0000aca0: 2045 7861 6d70 6c65 3a0a 0a20 2020 2020   Example:..     
-0000acb0: 2020 2060 6060 7079 0a20 2020 2020 2020     ```py.       
-0000acc0: 203e 3e3e 2064 7320 3d20 4461 7461 7365   >>> ds = Datase
-0000acd0: 742e 6672 6f6d 5f70 6172 7175 6574 2827  t.from_parquet('
-0000ace0: 7061 7468 2f74 6f2f 6461 7461 7365 742e  path/to/dataset.
-0000acf0: 7061 7271 7565 7427 290a 2020 2020 2020  parquet').      
-0000ad00: 2020 6060 600a 2020 2020 2020 2020 2222    ```.        ""
-0000ad10: 220a 2020 2020 2020 2020 2320 4479 6e61  ".        # Dyna
-0000ad20: 6d69 6320 696d 706f 7274 2074 6f20 6176  mic import to av
-0000ad30: 6f69 6420 6369 7263 756c 6172 2064 6570  oid circular dep
-0000ad40: 656e 6465 6e63 790a 2020 2020 2020 2020  endency.        
-0000ad50: 6672 6f6d 202e 696f 2e70 6172 7175 6574  from .io.parquet
-0000ad60: 2069 6d70 6f72 7420 5061 7271 7565 7444   import ParquetD
-0000ad70: 6174 6173 6574 5265 6164 6572 0a0a 2020  atasetReader..  
-0000ad80: 2020 2020 2020 7265 7475 726e 2050 6172        return Par
-0000ad90: 7175 6574 4461 7461 7365 7452 6561 6465  quetDatasetReade
-0000ada0: 7228 0a20 2020 2020 2020 2020 2020 2070  r(.            p
-0000adb0: 6174 685f 6f72 5f70 6174 6873 2c0a 2020  ath_or_paths,.  
-0000adc0: 2020 2020 2020 2020 2020 7370 6c69 743d            split=
-0000add0: 7370 6c69 742c 0a20 2020 2020 2020 2020  split,.         
-0000ade0: 2020 2066 6561 7475 7265 733d 6665 6174     features=feat
-0000adf0: 7572 6573 2c0a 2020 2020 2020 2020 2020  ures,.          
-0000ae00: 2020 6361 6368 655f 6469 723d 6361 6368    cache_dir=cach
-0000ae10: 655f 6469 722c 0a20 2020 2020 2020 2020  e_dir,.         
-0000ae20: 2020 206b 6565 705f 696e 5f6d 656d 6f72     keep_in_memor
-0000ae30: 793d 6b65 6570 5f69 6e5f 6d65 6d6f 7279  y=keep_in_memory
-0000ae40: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-0000ae50: 6c75 6d6e 733d 636f 6c75 6d6e 732c 0a20  lumns=columns,. 
-0000ae60: 2020 2020 2020 2020 2020 206e 756d 5f70             num_p
-0000ae70: 726f 633d 6e75 6d5f 7072 6f63 2c0a 2020  roc=num_proc,.  
-0000ae80: 2020 2020 2020 2020 2020 2a2a 6b77 6172            **kwar
-0000ae90: 6773 2c0a 2020 2020 2020 2020 292e 7265  gs,.        ).re
-0000aea0: 6164 2829 0a0a 2020 2020 4073 7461 7469  ad()..    @stati
-0000aeb0: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-0000aec0: 6672 6f6d 5f74 6578 7428 0a20 2020 2020  from_text(.     
-0000aed0: 2020 2070 6174 685f 6f72 5f70 6174 6873     path_or_paths
-0000aee0: 3a20 556e 696f 6e5b 5061 7468 4c69 6b65  : Union[PathLike
-0000aef0: 2c20 4c69 7374 5b50 6174 684c 696b 655d  , List[PathLike]
-0000af00: 5d2c 0a20 2020 2020 2020 2073 706c 6974  ],.        split
-0000af10: 3a20 4f70 7469 6f6e 616c 5b4e 616d 6564  : Optional[Named
-0000af20: 5370 6c69 745d 203d 204e 6f6e 652c 0a20  Split] = None,. 
-0000af30: 2020 2020 2020 2066 6561 7475 7265 733a         features:
-0000af40: 204f 7074 696f 6e61 6c5b 4665 6174 7572   Optional[Featur
-0000af50: 6573 5d20 3d20 4e6f 6e65 2c0a 2020 2020  es] = None,.    
-0000af60: 2020 2020 6361 6368 655f 6469 723a 2073      cache_dir: s
-0000af70: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
-0000af80: 2020 206b 6565 705f 696e 5f6d 656d 6f72     keep_in_memor
-0000af90: 793a 2062 6f6f 6c20 3d20 4661 6c73 652c  y: bool = False,
-0000afa0: 0a20 2020 2020 2020 206e 756d 5f70 726f  .        num_pro
-0000afb0: 633a 204f 7074 696f 6e61 6c5b 696e 745d  c: Optional[int]
-0000afc0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0000afd0: 202a 2a6b 7761 7267 732c 0a20 2020 2029   **kwargs,.    )
-0000afe0: 3a0a 2020 2020 2020 2020 2222 2243 7265  :.        """Cre
-0000aff0: 6174 6520 4461 7461 7365 7420 6672 6f6d  ate Dataset from
-0000b000: 2074 6578 7420 6669 6c65 2873 292e 0a0a   text file(s)...
-0000b010: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-0000b020: 2020 2020 2020 2020 2020 7061 7468 5f6f            path_o
-0000b030: 725f 7061 7468 7320 2860 7061 7468 2d6c  r_paths (`path-l
-0000b040: 696b 6560 206f 7220 6c69 7374 206f 6620  ike` or list of 
-0000b050: 6070 6174 682d 6c69 6b65 6029 3a0a 2020  `path-like`):.  
-0000b060: 2020 2020 2020 2020 2020 2020 2020 5061                Pa
-0000b070: 7468 2873 2920 6f66 2074 6865 2074 6578  th(s) of the tex
-0000b080: 7420 6669 6c65 2873 292e 0a20 2020 2020  t file(s)..     
-0000b090: 2020 2020 2020 2073 706c 6974 2028 604e         split (`N
-0000b0a0: 616d 6564 5370 6c69 7460 2c20 2a6f 7074  amedSplit`, *opt
-0000b0b0: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
-0000b0c0: 2020 2020 2020 2020 2053 706c 6974 206e           Split n
-0000b0d0: 616d 6520 746f 2062 6520 6173 7369 676e  ame to be assign
-0000b0e0: 6564 2074 6f20 7468 6520 6461 7461 7365  ed to the datase
-0000b0f0: 742e 0a20 2020 2020 2020 2020 2020 2066  t..            f
-0000b100: 6561 7475 7265 7320 2860 4665 6174 7572  eatures (`Featur
-0000b110: 6573 602c 206f 2a70 7469 6f6e 616c 2a29  es`, o*ptional*)
-0000b120: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b130: 2020 4461 7461 7365 7420 6665 6174 7572    Dataset featur
-0000b140: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-0000b150: 6361 6368 655f 6469 7220 2860 7374 7260  cache_dir (`str`
-0000b160: 2c20 2a6f 7074 696f 6e61 6c2a 2c20 6465  , *optional*, de
-0000b170: 6661 756c 7473 2074 6f20 6022 7e2f 2e63  faults to `"~/.c
-0000b180: 6163 6865 2f68 7567 6769 6e67 6661 6365  ache/huggingface
-0000b190: 2f64 6174 6173 6574 7322 6029 3a0a 2020  /datasets"`):.  
-0000b1a0: 2020 2020 2020 2020 2020 2020 2020 4469                Di
-0000b1b0: 7265 6374 6f72 7920 746f 2063 6163 6865  rectory to cache
-0000b1c0: 2064 6174 612e 0a20 2020 2020 2020 2020   data..         
-0000b1d0: 2020 206b 6565 705f 696e 5f6d 656d 6f72     keep_in_memor
-0000b1e0: 7920 2860 626f 6f6c 602c 2064 6566 6175  y (`bool`, defau
-0000b1f0: 6c74 7320 746f 2060 4661 6c73 6560 293a  lts to `False`):
-0000b200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b210: 2057 6865 7468 6572 2074 6f20 636f 7079   Whether to copy
-0000b220: 2074 6865 2064 6174 6120 696e 2d6d 656d   the data in-mem
-0000b230: 6f72 792e 0a20 2020 2020 2020 2020 2020  ory..           
-0000b240: 206e 756d 5f70 726f 6320 2860 696e 7460   num_proc (`int`
-0000b250: 2c20 2a6f 7074 696f 6e61 6c2a 2c20 6465  , *optional*, de
-0000b260: 6661 756c 7473 2074 6f20 604e 6f6e 6560  faults to `None`
-0000b270: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000b280: 2020 204e 756d 6265 7220 6f66 2070 726f     Number of pro
-0000b290: 6365 7373 6573 2077 6865 6e20 646f 776e  cesses when down
-0000b2a0: 6c6f 6164 696e 6720 616e 6420 6765 6e65  loading and gene
-0000b2b0: 7261 7469 6e67 2074 6865 2064 6174 6173  rating the datas
-0000b2c0: 6574 206c 6f63 616c 6c79 2e0a 2020 2020  et locally..    
-0000b2d0: 2020 2020 2020 2020 2020 2020 5468 6973              This
-0000b2e0: 2069 7320 6865 6c70 6675 6c20 6966 2074   is helpful if t
-0000b2f0: 6865 2064 6174 6173 6574 2069 7320 6d61  he dataset is ma
-0000b300: 6465 206f 6620 6d75 6c74 6970 6c65 2066  de of multiple f
-0000b310: 696c 6573 2e20 4d75 6c74 6970 726f 6365  iles. Multiproce
-0000b320: 7373 696e 6720 6973 2064 6973 6162 6c65  ssing is disable
-0000b330: 6420 6279 2064 6566 6175 6c74 2e0a 0a20  d by default... 
-0000b340: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-0000b350: 4164 6465 6420 7665 7273 696f 6e3d 2232  Added version="2
-0000b360: 2e38 2e30 222f 3e0a 2020 2020 2020 2020  .8.0"/>.        
-0000b370: 2020 2020 2a2a 6b77 6172 6773 2028 6164      **kwargs (ad
-0000b380: 6469 7469 6f6e 616c 206b 6579 776f 7264  ditional keyword
-0000b390: 2061 7267 756d 656e 7473 293a 0a20 2020   arguments):.   
-0000b3a0: 2020 2020 2020 2020 2020 2020 204b 6579               Key
-0000b3b0: 776f 7264 2061 7267 756d 656e 7473 2074  word arguments t
-0000b3c0: 6f20 6265 2070 6173 7365 6420 746f 205b  o be passed to [
-0000b3d0: 6054 6578 7443 6f6e 6669 6760 5d2e 0a0a  `TextConfig`]...
-0000b3e0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-0000b3f0: 0a20 2020 2020 2020 2020 2020 205b 6044  .            [`D
-0000b400: 6174 6173 6574 605d 0a0a 2020 2020 2020  ataset`]..      
-0000b410: 2020 4578 616d 706c 653a 0a0a 2020 2020    Example:..    
-0000b420: 2020 2020 6060 6070 790a 2020 2020 2020      ```py.      
-0000b430: 2020 3e3e 3e20 6473 203d 2044 6174 6173    >>> ds = Datas
-0000b440: 6574 2e66 726f 6d5f 7465 7874 2827 7061  et.from_text('pa
-0000b450: 7468 2f74 6f2f 6461 7461 7365 742e 7478  th/to/dataset.tx
-0000b460: 7427 290a 2020 2020 2020 2020 6060 600a  t').        ```.
-0000b470: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000b480: 2020 2020 2320 4479 6e61 6d69 6320 696d      # Dynamic im
-0000b490: 706f 7274 2074 6f20 6176 6f69 6420 6369  port to avoid ci
-0000b4a0: 7263 756c 6172 2064 6570 656e 6465 6e63  rcular dependenc
-0000b4b0: 790a 2020 2020 2020 2020 6672 6f6d 202e  y.        from .
-0000b4c0: 696f 2e74 6578 7420 696d 706f 7274 2054  io.text import T
-0000b4d0: 6578 7444 6174 6173 6574 5265 6164 6572  extDatasetReader
-0000b4e0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000b4f0: 2054 6578 7444 6174 6173 6574 5265 6164   TextDatasetRead
-0000b500: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
-0000b510: 7061 7468 5f6f 725f 7061 7468 732c 0a20  path_or_paths,. 
-0000b520: 2020 2020 2020 2020 2020 2073 706c 6974             split
-0000b530: 3d73 706c 6974 2c0a 2020 2020 2020 2020  =split,.        
-0000b540: 2020 2020 6665 6174 7572 6573 3d66 6561      features=fea
-0000b550: 7475 7265 732c 0a20 2020 2020 2020 2020  tures,.         
-0000b560: 2020 2063 6163 6865 5f64 6972 3d63 6163     cache_dir=cac
-0000b570: 6865 5f64 6972 2c0a 2020 2020 2020 2020  he_dir,.        
-0000b580: 2020 2020 6b65 6570 5f69 6e5f 6d65 6d6f      keep_in_memo
-0000b590: 7279 3d6b 6565 705f 696e 5f6d 656d 6f72  ry=keep_in_memor
-0000b5a0: 792c 0a20 2020 2020 2020 2020 2020 206e  y,.            n
-0000b5b0: 756d 5f70 726f 633d 6e75 6d5f 7072 6f63  um_proc=num_proc
-0000b5c0: 2c0a 2020 2020 2020 2020 2020 2020 2a2a  ,.            **
-0000b5d0: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
-0000b5e0: 292e 7265 6164 2829 0a0a 2020 2020 4073  ).read()..    @s
-0000b5f0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-0000b600: 6465 6620 6672 6f6d 5f73 716c 280a 2020  def from_sql(.  
-0000b610: 2020 2020 2020 7371 6c3a 2055 6e69 6f6e        sql: Union
-0000b620: 5b73 7472 2c20 2273 716c 616c 6368 656d  [str, "sqlalchem
-0000b630: 792e 7371 6c2e 5365 6c65 6374 6162 6c65  y.sql.Selectable
-0000b640: 225d 2c0a 2020 2020 2020 2020 636f 6e3a  "],.        con:
-0000b650: 2055 6e69 6f6e 5b73 7472 2c20 2273 716c   Union[str, "sql
-0000b660: 616c 6368 656d 792e 656e 6769 6e65 2e43  alchemy.engine.C
-0000b670: 6f6e 6e65 6374 696f 6e22 2c20 2273 716c  onnection", "sql
-0000b680: 616c 6368 656d 792e 656e 6769 6e65 2e45  alchemy.engine.E
-0000b690: 6e67 696e 6522 2c20 2273 716c 6974 6533  ngine", "sqlite3
-0000b6a0: 2e43 6f6e 6e65 6374 696f 6e22 5d2c 0a20  .Connection"],. 
-0000b6b0: 2020 2020 2020 2066 6561 7475 7265 733a         features:
-0000b6c0: 204f 7074 696f 6e61 6c5b 4665 6174 7572   Optional[Featur
-0000b6d0: 6573 5d20 3d20 4e6f 6e65 2c0a 2020 2020  es] = None,.    
-0000b6e0: 2020 2020 6361 6368 655f 6469 723a 2073      cache_dir: s
-0000b6f0: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
-0000b700: 2020 206b 6565 705f 696e 5f6d 656d 6f72     keep_in_memor
-0000b710: 793a 2062 6f6f 6c20 3d20 4661 6c73 652c  y: bool = False,
-0000b720: 0a20 2020 2020 2020 202a 2a6b 7761 7267  .        **kwarg
-0000b730: 732c 0a20 2020 2029 3a0a 2020 2020 2020  s,.    ):.      
-0000b740: 2020 2222 2243 7265 6174 6520 4461 7461    """Create Data
-0000b750: 7365 7420 6672 6f6d 2053 514c 2071 7565  set from SQL que
-0000b760: 7279 206f 7220 6461 7461 6261 7365 2074  ry or database t
-0000b770: 6162 6c65 2e0a 0a20 2020 2020 2020 2041  able...        A
-0000b780: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-0000b790: 2073 716c 2028 6073 7472 6020 6f72 2060   sql (`str` or `
-0000b7a0: 7371 6c61 6c63 6865 6d79 2e73 716c 2e53  sqlalchemy.sql.S
-0000b7b0: 656c 6563 7461 626c 6560 293a 0a20 2020  electable`):.   
-0000b7c0: 2020 2020 2020 2020 2020 2020 2053 514c               SQL
-0000b7d0: 2071 7565 7279 2074 6f20 6265 2065 7865   query to be exe
-0000b7e0: 6375 7465 6420 6f72 2061 2074 6162 6c65  cuted or a table
-0000b7f0: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
-0000b800: 2020 2063 6f6e 2028 6073 7472 6020 6f72     con (`str` or
-0000b810: 2060 7371 6c69 7465 332e 436f 6e6e 6563   `sqlite3.Connec
-0000b820: 7469 6f6e 6020 6f72 2060 7371 6c61 6c63  tion` or `sqlalc
-0000b830: 6865 6d79 2e65 6e67 696e 652e 436f 6e6e  hemy.engine.Conn
-0000b840: 6563 7469 6f6e 6020 6f72 2060 7371 6c61  ection` or `sqla
-0000b850: 6c63 6865 6d79 2e65 6e67 696e 652e 436f  lchemy.engine.Co
-0000b860: 6e6e 6563 7469 6f6e 6029 3a0a 2020 2020  nnection`):.    
-0000b870: 2020 2020 2020 2020 2020 2020 4120 5b55              A [U
-0000b880: 5249 2073 7472 696e 675d 2868 7474 7073  RI string](https
-0000b890: 3a2f 2f64 6f63 732e 7371 6c61 6c63 6865  ://docs.sqlalche
-0000b8a0: 6d79 2e6f 7267 2f65 6e2f 3133 2f63 6f72  my.org/en/13/cor
-0000b8b0: 652f 656e 6769 6e65 732e 6874 6d6c 2364  e/engines.html#d
-0000b8c0: 6174 6162 6173 652d 7572 6c73 2920 7573  atabase-urls) us
-0000b8d0: 6564 2074 6f20 696e 7374 616e 7469 6174  ed to instantiat
-0000b8e0: 6520 6120 6461 7461 6261 7365 2063 6f6e  e a database con
-0000b8f0: 6e65 6374 696f 6e20 6f72 2061 2053 514c  nection or a SQL
-0000b900: 6974 6533 2f53 514c 416c 6368 656d 7920  ite3/SQLAlchemy 
-0000b910: 636f 6e6e 6563 7469 6f6e 206f 626a 6563  connection objec
-0000b920: 742e 0a20 2020 2020 2020 2020 2020 2066  t..            f
-0000b930: 6561 7475 7265 7320 285b 6046 6561 7475  eatures ([`Featu
-0000b940: 7265 7360 5d2c 202a 6f70 7469 6f6e 616c  res`], *optional
-0000b950: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
-0000b960: 2020 2020 4461 7461 7365 7420 6665 6174      Dataset feat
-0000b970: 7572 6573 2e0a 2020 2020 2020 2020 2020  ures..          
-0000b980: 2020 6361 6368 655f 6469 7220 2860 7374    cache_dir (`st
-0000b990: 7260 2c20 2a6f 7074 696f 6e61 6c2a 2c20  r`, *optional*, 
-0000b9a0: 6465 6661 756c 7473 2074 6f20 6022 7e2f  defaults to `"~/
-0000b9b0: 2e63 6163 6865 2f68 7567 6769 6e67 6661  .cache/huggingfa
-0000b9c0: 6365 2f64 6174 6173 6574 7322 6029 3a0a  ce/datasets"`):.
-0000b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9e0: 4469 7265 6374 6f72 7920 746f 2063 6163  Directory to cac
-0000b9f0: 6865 2064 6174 612e 0a20 2020 2020 2020  he data..       
-0000ba00: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
-0000ba10: 6f72 7920 2860 626f 6f6c 602c 2064 6566  ory (`bool`, def
-0000ba20: 6175 6c74 7320 746f 2060 4661 6c73 6560  aults to `False`
-0000ba30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000ba40: 2020 2057 6865 7468 6572 2074 6f20 636f     Whether to co
-0000ba50: 7079 2074 6865 2064 6174 6120 696e 2d6d  py the data in-m
-0000ba60: 656d 6f72 792e 0a20 2020 2020 2020 2020  emory..         
-0000ba70: 2020 202a 2a6b 7761 7267 7320 2861 6464     **kwargs (add
-0000ba80: 6974 696f 6e61 6c20 6b65 7977 6f72 6420  itional keyword 
-0000ba90: 6172 6775 6d65 6e74 7329 3a0a 2020 2020  arguments):.    
-0000baa0: 2020 2020 2020 2020 2020 2020 4b65 7977              Keyw
-0000bab0: 6f72 6420 6172 6775 6d65 6e74 7320 746f  ord arguments to
-0000bac0: 2062 6520 7061 7373 6564 2074 6f20 5b60   be passed to [`
-0000bad0: 5371 6c43 6f6e 6669 6760 5d2e 0a0a 2020  SqlConfig`]...  
-0000bae0: 2020 2020 2020 5265 7475 726e 733a 0a20        Returns:. 
-0000baf0: 2020 2020 2020 2020 2020 205b 6044 6174             [`Dat
-0000bb00: 6173 6574 605d 0a0a 2020 2020 2020 2020  aset`]..        
-0000bb10: 4578 616d 706c 653a 0a0a 2020 2020 2020  Example:..      
-0000bb20: 2020 6060 6070 790a 2020 2020 2020 2020    ```py.        
-0000bb30: 3e3e 3e20 2320 4665 7463 6820 6120 6461  >>> # Fetch a da
-0000bb40: 7461 6261 7365 2074 6162 6c65 0a20 2020  tabase table.   
-0000bb50: 2020 2020 203e 3e3e 2064 7320 3d20 4461       >>> ds = Da
-0000bb60: 7461 7365 742e 6672 6f6d 5f73 716c 2822  taset.from_sql("
-0000bb70: 7465 7374 5f64 6174 6122 2c20 2270 6f73  test_data", "pos
-0000bb80: 7467 7265 733a 2f2f 2f64 625f 6e61 6d65  tgres:///db_name
-0000bb90: 2229 0a20 2020 2020 2020 203e 3e3e 2023  ").        >>> #
-0000bba0: 2045 7865 6375 7465 2061 2053 514c 2071   Execute a SQL q
-0000bbb0: 7565 7279 206f 6e20 7468 6520 7461 626c  uery on the tabl
-0000bbc0: 650a 2020 2020 2020 2020 3e3e 3e20 6473  e.        >>> ds
-0000bbd0: 203d 2044 6174 6173 6574 2e66 726f 6d5f   = Dataset.from_
-0000bbe0: 7371 6c28 2253 454c 4543 5420 7365 6e74  sql("SELECT sent
-0000bbf0: 656e 6365 2046 524f 4d20 7465 7374 5f64  ence FROM test_d
-0000bc00: 6174 6122 2c20 2270 6f73 7467 7265 733a  ata", "postgres:
-0000bc10: 2f2f 2f64 625f 6e61 6d65 2229 0a20 2020  ///db_name").   
-0000bc20: 2020 2020 203e 3e3e 2023 2055 7365 2061       >>> # Use a
-0000bc30: 2053 656c 6563 7461 626c 6520 6f62 6a65   Selectable obje
-0000bc40: 6374 2074 6f20 7370 6563 6966 7920 7468  ct to specify th
-0000bc50: 6520 7175 6572 790a 2020 2020 2020 2020  e query.        
-0000bc60: 3e3e 3e20 6672 6f6d 2073 716c 616c 6368  >>> from sqlalch
-0000bc70: 656d 7920 696d 706f 7274 2073 656c 6563  emy import selec
-0000bc80: 742c 2074 6578 740a 2020 2020 2020 2020  t, text.        
-0000bc90: 3e3e 3e20 7374 6d74 203d 2073 656c 6563  >>> stmt = selec
-0000bca0: 7428 5b74 6578 7428 2273 656e 7465 6e63  t([text("sentenc
-0000bcb0: 6522 295d 292e 7365 6c65 6374 5f66 726f  e")]).select_fro
-0000bcc0: 6d28 7465 7874 2822 7465 7374 5f64 6174  m(text("test_dat
-0000bcd0: 6122 2929 0a20 2020 2020 2020 203e 3e3e  a")).        >>>
-0000bce0: 2064 7320 3d20 4461 7461 7365 742e 6672   ds = Dataset.fr
-0000bcf0: 6f6d 5f73 716c 2873 746d 742c 2022 706f  om_sql(stmt, "po
-0000bd00: 7374 6772 6573 3a2f 2f2f 6462 5f6e 616d  stgres:///db_nam
-0000bd10: 6522 290a 2020 2020 2020 2020 6060 600a  e").        ```.
-0000bd20: 0a20 2020 2020 2020 203c 5469 703e 0a0a  .        <Tip>..
-0000bd30: 2020 2020 2020 2020 5468 6520 7265 7475          The retu
-0000bd40: 726e 6564 2064 6174 6173 6574 2063 616e  rned dataset can
-0000bd50: 206f 6e6c 7920 6265 2063 6163 6865 6420   only be cached 
-0000bd60: 6966 2060 636f 6e60 2069 7320 7370 6563  if `con` is spec
-0000bd70: 6966 6965 6420 6173 2055 5249 2073 7472  ified as URI str
-0000bd80: 696e 672e 0a0a 2020 2020 2020 2020 3c2f  ing...        </
-0000bd90: 5469 703e 0a20 2020 2020 2020 2022 2222  Tip>.        """
-0000bda0: 0a20 2020 2020 2020 2066 726f 6d20 2e69  .        from .i
-0000bdb0: 6f2e 7371 6c20 696d 706f 7274 2053 716c  o.sql import Sql
-0000bdc0: 4461 7461 7365 7452 6561 6465 720a 0a20  DatasetReader.. 
-0000bdd0: 2020 2020 2020 2072 6574 7572 6e20 5371         return Sq
-0000bde0: 6c44 6174 6173 6574 5265 6164 6572 280a  lDatasetReader(.
-0000bdf0: 2020 2020 2020 2020 2020 2020 7371 6c2c              sql,
-0000be00: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-0000be10: 2c0a 2020 2020 2020 2020 2020 2020 6665  ,.            fe
-0000be20: 6174 7572 6573 3d66 6561 7475 7265 732c  atures=features,
-0000be30: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
-0000be40: 6865 5f64 6972 3d63 6163 6865 5f64 6972  he_dir=cache_dir
-0000be50: 2c0a 2020 2020 2020 2020 2020 2020 6b65  ,.            ke
-0000be60: 6570 5f69 6e5f 6d65 6d6f 7279 3d6b 6565  ep_in_memory=kee
-0000be70: 705f 696e 5f6d 656d 6f72 792c 0a20 2020  p_in_memory,.   
-0000be80: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
-0000be90: 732c 0a20 2020 2020 2020 2029 2e72 6561  s,.        ).rea
-0000bea0: 6428 290a 0a20 2020 2064 6566 205f 5f64  d()..    def __d
-0000beb0: 656c 5f5f 2873 656c 6629 3a0a 2020 2020  el__(self):.    
-0000bec0: 2020 2020 6966 2068 6173 6174 7472 2873      if hasattr(s
-0000bed0: 656c 662c 2022 5f64 6174 6122 293a 0a20  elf, "_data"):. 
-0000bee0: 2020 2020 2020 2020 2020 2064 656c 2073             del s
-0000bef0: 656c 662e 5f64 6174 610a 2020 2020 2020  elf._data.      
-0000bf00: 2020 6966 2068 6173 6174 7472 2873 656c    if hasattr(sel
-0000bf10: 662c 2022 5f69 6e64 6963 6573 2229 3a0a  f, "_indices"):.
-0000bf20: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-0000bf30: 7365 6c66 2e5f 696e 6469 6365 730a 0a20  self._indices.. 
-0000bf40: 2020 2064 6566 205f 5f65 6e74 6572 5f5f     def __enter__
-0000bf50: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000bf60: 7265 7475 726e 2073 656c 660a 0a20 2020  return self..   
-0000bf70: 2064 6566 205f 5f65 7869 745f 5f28 7365   def __exit__(se
-0000bf80: 6c66 2c20 6578 635f 7479 7065 2c20 6578  lf, exc_type, ex
-0000bf90: 635f 7661 6c2c 2065 7863 5f74 6229 3a0a  c_val, exc_tb):.
-0000bfa0: 2020 2020 2020 2020 2320 4865 7265 2060          # Here `
-0000bfb0: 6465 6c60 2069 7320 7573 6564 2074 6f20  del` is used to 
-0000bfc0: 6465 6c20 7468 6520 7079 6172 726f 7720  del the pyarrow 
-0000bfd0: 7461 626c 6573 2e20 5468 6973 2070 726f  tables. This pro
-0000bfe0: 7065 726c 7920 636c 6f73 6573 2074 6865  perly closes the
-0000bff0: 2066 696c 6573 2075 7365 6420 666f 7220   files used for 
-0000c000: 6d65 6d6f 7279 206d 6170 7065 6420 7461  memory mapped ta
-0000c010: 626c 6573 0a20 2020 2020 2020 2073 656c  bles.        sel
-0000c020: 662e 5f5f 6465 6c5f 5f28 290a 0a20 2020  f.__del__()..   
-0000c030: 2064 6566 2073 6176 655f 746f 5f64 6973   def save_to_dis
-0000c040: 6b28 0a20 2020 2020 2020 2073 656c 662c  k(.        self,
-0000c050: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
-0000c060: 5f70 6174 683a 2050 6174 684c 696b 652c  _path: PathLike,
-0000c070: 0a20 2020 2020 2020 2066 733d 2264 6570  .        fs="dep
-0000c080: 7265 6361 7465 6422 2c0a 2020 2020 2020  recated",.      
-0000c090: 2020 6d61 785f 7368 6172 645f 7369 7a65    max_shard_size
-0000c0a0: 3a20 4f70 7469 6f6e 616c 5b55 6e69 6f6e  : Optional[Union
-0000c0b0: 5b73 7472 2c20 696e 745d 5d20 3d20 4e6f  [str, int]] = No
-0000c0c0: 6e65 2c0a 2020 2020 2020 2020 6e75 6d5f  ne,.        num_
-0000c0d0: 7368 6172 6473 3a20 4f70 7469 6f6e 616c  shards: Optional
-0000c0e0: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
-0000c0f0: 2020 2020 2020 6e75 6d5f 7072 6f63 3a20        num_proc: 
-0000c100: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
-0000c110: 4e6f 6e65 2c0a 2020 2020 2020 2020 7374  None,.        st
-0000c120: 6f72 6167 655f 6f70 7469 6f6e 733a 204f  orage_options: O
-0000c130: 7074 696f 6e61 6c5b 6469 6374 5d20 3d20  ptional[dict] = 
-0000c140: 4e6f 6e65 2c0a 2020 2020 293a 0a20 2020  None,.    ):.   
-0000c150: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000c160: 2053 6176 6573 2061 2064 6174 6173 6574   Saves a dataset
-0000c170: 2074 6f20 6120 6461 7461 7365 7420 6469   to a dataset di
-0000c180: 7265 6374 6f72 792c 206f 7220 696e 2061  rectory, or in a
-0000c190: 2066 696c 6573 7973 7465 6d20 7573 696e   filesystem usin
-0000c1a0: 6720 6569 7468 6572 2060 7333 6673 2e53  g either `s3fs.S
-0000c1b0: 3346 696c 6553 7973 7465 6d60 206f 720a  3FileSystem` or.
-0000c1c0: 2020 2020 2020 2020 616e 7920 696d 706c          any impl
-0000c1d0: 656d 656e 7461 7469 6f6e 206f 6620 6066  ementation of `f
-0000c1e0: 7373 7065 632e 7370 6563 2e41 6273 7472  sspec.spec.Abstr
-0000c1f0: 6163 7446 696c 6553 7973 7465 6d60 2e0a  actFileSystem`..
-0000c200: 0a20 2020 2020 2020 2046 6f72 205b 6049  .        For [`I
-0000c210: 6d61 6765 605d 2061 6e64 205b 6041 7564  mage`] and [`Aud
-0000c220: 696f 605d 2064 6174 613a 0a0a 2020 2020  io`] data:..    
-0000c230: 2020 2020 416c 6c20 7468 6520 496d 6167      All the Imag
-0000c240: 6528 2920 616e 6420 4175 6469 6f28 2920  e() and Audio() 
-0000c250: 6461 7461 2061 7265 2073 746f 7265 6420  data are stored 
-0000c260: 696e 2074 6865 2061 7272 6f77 2066 696c  in the arrow fil
-0000c270: 6573 2e0a 2020 2020 2020 2020 4966 2079  es..        If y
-0000c280: 6f75 2077 616e 7420 746f 2073 746f 7265  ou want to store
-0000c290: 2070 6174 6873 206f 7220 7572 6c73 2c20   paths or urls, 
-0000c2a0: 706c 6561 7365 2075 7365 2074 6865 2056  please use the V
-0000c2b0: 616c 7565 2822 7374 7269 6e67 2229 2074  alue("string") t
-0000c2c0: 7970 652e 0a0a 2020 2020 2020 2020 4172  ype...        Ar
-0000c2d0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0000c2e0: 6461 7461 7365 745f 7061 7468 2028 6073  dataset_path (`s
-0000c2f0: 7472 6029 3a0a 2020 2020 2020 2020 2020  tr`):.          
-0000c300: 2020 2020 2020 5061 7468 2028 652e 672e        Path (e.g.
-0000c310: 2060 6461 7461 7365 742f 7472 6169 6e60   `dataset/train`
-0000c320: 2920 6f72 2072 656d 6f74 6520 5552 4920  ) or remote URI 
-0000c330: 2865 2e67 2e20 6073 333a 2f2f 6d79 2d62  (e.g. `s3://my-b
-0000c340: 7563 6b65 742f 6461 7461 7365 742f 7472  ucket/dataset/tr
-0000c350: 6169 6e60 290a 2020 2020 2020 2020 2020  ain`).          
-0000c360: 2020 2020 2020 6f66 2074 6865 2064 6174        of the dat
-0000c370: 6173 6574 2064 6972 6563 746f 7279 2077  aset directory w
-0000c380: 6865 7265 2074 6865 2064 6174 6173 6574  here the dataset
-0000c390: 2077 696c 6c20 6265 2073 6176 6564 2074   will be saved t
-0000c3a0: 6f2e 0a20 2020 2020 2020 2020 2020 2066  o..            f
-0000c3b0: 7320 2860 6673 7370 6563 2e73 7065 632e  s (`fsspec.spec.
-0000c3c0: 4162 7374 7261 6374 4669 6c65 5379 7374  AbstractFileSyst
-0000c3d0: 656d 602c 202a 6f70 7469 6f6e 616c 2a29  em`, *optional*)
-0000c3e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c3f0: 2020 496e 7374 616e 6365 206f 6620 7468    Instance of th
-0000c400: 6520 7265 6d6f 7465 2066 696c 6573 7973  e remote filesys
-0000c410: 7465 6d20 7768 6572 6520 7468 6520 6461  tem where the da
-0000c420: 7461 7365 7420 7769 6c6c 2062 6520 7361  taset will be sa
-0000c430: 7665 6420 746f 2e0a 0a20 2020 2020 2020  ved to...       
-0000c440: 2020 2020 2020 2020 203c 4465 7072 6563           <Deprec
-0000c450: 6174 6564 2076 6572 7369 6f6e 3d22 322e  ated version="2.
-0000c460: 382e 3022 3e0a 0a20 2020 2020 2020 2020  8.0">..         
-0000c470: 2020 2020 2020 2060 6673 6020 7761 7320         `fs` was 
-0000c480: 6465 7072 6563 6174 6564 2069 6e20 7665  deprecated in ve
-0000c490: 7273 696f 6e20 322e 382e 3020 616e 6420  rsion 2.8.0 and 
-0000c4a0: 7769 6c6c 2062 6520 7265 6d6f 7665 6420  will be removed 
-0000c4b0: 696e 2033 2e30 2e30 2e0a 2020 2020 2020  in 3.0.0..      
-0000c4c0: 2020 2020 2020 2020 2020 506c 6561 7365            Please
-0000c4d0: 2075 7365 2060 7374 6f72 6167 655f 6f70   use `storage_op
-0000c4e0: 7469 6f6e 7360 2069 6e73 7465 6164 2c20  tions` instead, 
-0000c4f0: 652e 672e 2060 7374 6f72 6167 655f 6f70  e.g. `storage_op
-0000c500: 7469 6f6e 733d 6673 2e73 746f 7261 6765  tions=fs.storage
-0000c510: 5f6f 7074 696f 6e73 600a 0a20 2020 2020  _options`..     
-0000c520: 2020 2020 2020 2020 2020 203c 2f44 6570             </Dep
-0000c530: 7265 6361 7465 643e 0a0a 2020 2020 2020  recated>..      
-0000c540: 2020 2020 2020 6d61 785f 7368 6172 645f        max_shard_
-0000c550: 7369 7a65 2028 6069 6e74 6020 6f72 2060  size (`int` or `
-0000c560: 7374 7260 2c20 2a6f 7074 696f 6e61 6c2a  str`, *optional*
-0000c570: 2c20 6465 6661 756c 7473 2074 6f20 6022  , defaults to `"
-0000c580: 3530 304d 4222 6029 3a0a 2020 2020 2020  500MB"`):.      
-0000c590: 2020 2020 2020 2020 2020 5468 6520 6d61            The ma
-0000c5a0: 7869 6d75 6d20 7369 7a65 206f 6620 7468  ximum size of th
-0000c5b0: 6520 6461 7461 7365 7420 7368 6172 6473  e dataset shards
-0000c5c0: 2074 6f20 6265 2075 706c 6f61 6465 6420   to be uploaded 
-0000c5d0: 746f 2074 6865 2068 7562 2e20 4966 2065  to the hub. If e
-0000c5e0: 7870 7265 7373 6564 2061 7320 6120 7374  xpressed as a st
-0000c5f0: 7269 6e67 2c20 6e65 6564 7320 746f 2062  ring, needs to b
-0000c600: 6520 6469 6769 7473 2066 6f6c 6c6f 7765  e digits followe
-0000c610: 6420 6279 2061 2075 6e69 740a 2020 2020  d by a unit.    
-0000c620: 2020 2020 2020 2020 2020 2020 286c 696b              (lik
-0000c630: 6520 6022 3530 4d42 2260 292e 0a20 2020  e `"50MB"`)..   
-0000c640: 2020 2020 2020 2020 206e 756d 5f73 6861           num_sha
-0000c650: 7264 7320 2860 696e 7460 2c20 2a6f 7074  rds (`int`, *opt
-0000c660: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
-0000c670: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
-0000c680: 6f66 2073 6861 7264 7320 746f 2077 7269  of shards to wri
-0000c690: 7465 2e20 4279 2064 6566 6175 6c74 2074  te. By default t
-0000c6a0: 6865 206e 756d 6265 7220 6f66 2073 6861  he number of sha
-0000c6b0: 7264 7320 6465 7065 6e64 7320 6f6e 2060  rds depends on `
-0000c6c0: 6d61 785f 7368 6172 645f 7369 7a65 602e  max_shard_size`.
-0000c6d0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c6e0: 2020 3c41 6464 6564 2076 6572 7369 6f6e    <Added version
-0000c6f0: 3d22 322e 382e 3022 2f3e 0a20 2020 2020  ="2.8.0"/>.     
-0000c700: 2020 2020 2020 206e 756d 5f70 726f 6320         num_proc 
-0000c710: 2860 696e 7460 2c20 2a6f 7074 696f 6e61  (`int`, *optiona
-0000c720: 6c2a 293a 0a20 2020 2020 2020 2020 2020  l*):.           
-0000c730: 2020 2020 204e 756d 6265 7220 6f66 2070       Number of p
-0000c740: 726f 6365 7373 6573 2077 6865 6e20 646f  rocesses when do
-0000c750: 776e 6c6f 6164 696e 6720 616e 6420 6765  wnloading and ge
-0000c760: 6e65 7261 7469 6e67 2074 6865 2064 6174  nerating the dat
-0000c770: 6173 6574 206c 6f63 616c 6c79 2e0a 2020  aset locally..  
-0000c780: 2020 2020 2020 2020 2020 2020 2020 4d75                Mu
-0000c790: 6c74 6970 726f 6365 7373 696e 6720 6973  ltiprocessing is
-0000c7a0: 2064 6973 6162 6c65 6420 6279 2064 6566   disabled by def
-0000c7b0: 6175 6c74 2e0a 0a20 2020 2020 2020 2020  ault...         
-0000c7c0: 2020 2020 2020 203c 4164 6465 6420 7665         <Added ve
-0000c7d0: 7273 696f 6e3d 2232 2e38 2e30 222f 3e0a  rsion="2.8.0"/>.
-0000c7e0: 2020 2020 2020 2020 2020 2020 7374 6f72              stor
-0000c7f0: 6167 655f 6f70 7469 6f6e 7320 2860 6469  age_options (`di
-0000c800: 6374 602c 202a 6f70 7469 6f6e 616c 2a29  ct`, *optional*)
-0000c810: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c820: 2020 4b65 792f 7661 6c75 6520 7061 6972    Key/value pair
-0000c830: 7320 746f 2062 6520 7061 7373 6564 206f  s to be passed o
-0000c840: 6e20 746f 2074 6865 2066 696c 652d 7379  n to the file-sy
-0000c850: 7374 656d 2062 6163 6b65 6e64 2c20 6966  stem backend, if
-0000c860: 2061 6e79 2e0a 0a20 2020 2020 2020 2020   any...         
-0000c870: 2020 2020 2020 203c 4164 6465 6420 7665         <Added ve
-0000c880: 7273 696f 6e3d 2232 2e38 2e30 222f 3e0a  rsion="2.8.0"/>.
-0000c890: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-0000c8a0: 3a0a 0a20 2020 2020 2020 2060 6060 7079  :..        ```py
-0000c8b0: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
-0000c8c0: 7361 7665 5f74 6f5f 6469 736b 2822 7061  save_to_disk("pa
-0000c8d0: 7468 2f74 6f2f 6461 7461 7365 742f 6469  th/to/dataset/di
-0000c8e0: 7265 6374 6f72 7922 290a 2020 2020 2020  rectory").      
-0000c8f0: 2020 3e3e 3e20 6473 2e73 6176 655f 746f    >>> ds.save_to
-0000c900: 5f64 6973 6b28 2270 6174 682f 746f 2f64  _disk("path/to/d
-0000c910: 6174 6173 6574 2f64 6972 6563 746f 7279  ataset/directory
-0000c920: 222c 206d 6178 5f73 6861 7264 5f73 697a  ", max_shard_siz
-0000c930: 653d 2231 4742 2229 0a20 2020 2020 2020  e="1GB").       
-0000c940: 203e 3e3e 2064 732e 7361 7665 5f74 6f5f   >>> ds.save_to_
-0000c950: 6469 736b 2822 7061 7468 2f74 6f2f 6461  disk("path/to/da
-0000c960: 7461 7365 742f 6469 7265 6374 6f72 7922  taset/directory"
-0000c970: 2c20 6e75 6d5f 7368 6172 6473 3d31 3032  , num_shards=102
-0000c980: 3429 0a20 2020 2020 2020 2060 6060 0a20  4).        ```. 
-0000c990: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000c9a0: 2020 2069 6620 6d61 785f 7368 6172 645f     if max_shard_
-0000c9b0: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
-0000c9c0: 2061 6e64 206e 756d 5f73 6861 7264 7320   and num_shards 
-0000c9d0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000c9e0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0000c9f0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-0000ca00: 2020 2020 2020 2020 2020 2022 4661 696c             "Fail
-0000ca10: 6564 2074 6f20 7075 7368 5f74 6f5f 6875  ed to push_to_hu
-0000ca20: 623a 2070 6c65 6173 6520 7370 6563 6966  b: please specif
-0000ca30: 7920 6569 7468 6572 206d 6178 5f73 6861  y either max_sha
-0000ca40: 7264 5f73 697a 6520 6f72 206e 756d 5f73  rd_size or num_s
-0000ca50: 6861 7264 732c 2062 7574 206e 6f74 2062  hards, but not b
-0000ca60: 6f74 682e 220a 2020 2020 2020 2020 2020  oth.".          
-0000ca70: 2020 290a 2020 2020 2020 2020 6966 2066    ).        if f
-0000ca80: 7320 213d 2022 6465 7072 6563 6174 6564  s != "deprecated
-0000ca90: 223a 0a20 2020 2020 2020 2020 2020 2077  ":.            w
-0000caa0: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
-0000cab0: 2020 2020 2020 2020 2020 2020 2020 2227                "'
-0000cac0: 6673 2720 7761 7320 6973 2064 6570 7265  fs' was is depre
-0000cad0: 6361 7465 6420 696e 2066 6176 6f72 206f  cated in favor o
-0000cae0: 6620 2773 746f 7261 6765 5f6f 7074 696f  f 'storage_optio
-0000caf0: 6e73 2720 696e 2076 6572 7369 6f6e 2032  ns' in version 2
-0000cb00: 2e38 2e30 2061 6e64 2077 696c 6c20 6265  .8.0 and will be
-0000cb10: 2072 656d 6f76 6564 2069 6e20 332e 302e   removed in 3.0.
-0000cb20: 302e 5c6e 220a 2020 2020 2020 2020 2020  0.\n".          
-0000cb30: 2020 2020 2020 2259 6f75 2063 616e 2072        "You can r
-0000cb40: 656d 6f76 6520 7468 6973 2077 6172 6e69  emove this warni
-0000cb50: 6e67 2062 7920 7061 7373 696e 6720 2773  ng by passing 's
-0000cb60: 746f 7261 6765 5f6f 7074 696f 6e73 3d66  torage_options=f
-0000cb70: 732e 7374 6f72 6167 655f 6f70 7469 6f6e  s.storage_option
-0000cb80: 7327 2069 6e73 7465 6164 2e22 2c0a 2020  s' instead.",.  
-0000cb90: 2020 2020 2020 2020 2020 2020 2020 4675                Fu
-0000cba0: 7475 7265 5761 726e 696e 672c 0a20 2020  tureWarning,.   
-0000cbb0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000cbc0: 2020 2020 2020 2073 746f 7261 6765 5f6f         storage_o
-0000cbd0: 7074 696f 6e73 203d 2066 732e 7374 6f72  ptions = fs.stor
-0000cbe0: 6167 655f 6f70 7469 6f6e 730a 0a20 2020  age_options..   
-0000cbf0: 2020 2020 2069 6620 6e75 6d5f 7368 6172       if num_shar
-0000cc00: 6473 2069 7320 4e6f 6e65 3a0a 2020 2020  ds is None:.    
-0000cc10: 2020 2020 2020 2020 6461 7461 7365 745f          dataset_
-0000cc20: 6e62 7974 6573 203d 2073 656c 662e 5f65  nbytes = self._e
-0000cc30: 7374 696d 6174 655f 6e62 7974 6573 2829  stimate_nbytes()
-0000cc40: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
-0000cc50: 5f73 6861 7264 5f73 697a 6520 3d20 636f  _shard_size = co
-0000cc60: 6e76 6572 745f 6669 6c65 5f73 697a 655f  nvert_file_size_
-0000cc70: 746f 5f69 6e74 286d 6178 5f73 6861 7264  to_int(max_shard
-0000cc80: 5f73 697a 6520 6f72 2063 6f6e 6669 672e  _size or config.
-0000cc90: 4d41 585f 5348 4152 445f 5349 5a45 290a  MAX_SHARD_SIZE).
-0000cca0: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
-0000ccb0: 7368 6172 6473 203d 2069 6e74 2864 6174  shards = int(dat
-0000ccc0: 6173 6574 5f6e 6279 7465 7320 2f20 6d61  aset_nbytes / ma
-0000ccd0: 785f 7368 6172 645f 7369 7a65 2920 2b20  x_shard_size) + 
-0000cce0: 310a 2020 2020 2020 2020 2020 2020 6e75  1.            nu
-0000ccf0: 6d5f 7368 6172 6473 203d 206d 6178 286e  m_shards = max(n
-0000cd00: 756d 5f73 6861 7264 732c 206e 756d 5f70  um_shards, num_p
-0000cd10: 726f 6320 6f72 2031 290a 0a20 2020 2020  roc or 1)..     
-0000cd20: 2020 206e 756d 5f70 726f 6320 3d20 6e75     num_proc = nu
-0000cd30: 6d5f 7072 6f63 2069 6620 6e75 6d5f 7072  m_proc if num_pr
-0000cd40: 6f63 2069 7320 6e6f 7420 4e6f 6e65 2065  oc is not None e
-0000cd50: 6c73 6520 310a 2020 2020 2020 2020 6e75  lse 1.        nu
-0000cd60: 6d5f 7368 6172 6473 203d 206e 756d 5f73  m_shards = num_s
-0000cd70: 6861 7264 7320 6966 206e 756d 5f73 6861  hards if num_sha
-0000cd80: 7264 7320 6973 206e 6f74 204e 6f6e 6520  rds is not None 
-0000cd90: 656c 7365 206e 756d 5f70 726f 630a 0a20  else num_proc.. 
-0000cda0: 2020 2020 2020 2066 735f 746f 6b65 6e5f         fs_token_
-0000cdb0: 7061 7468 7320 3d20 6673 7370 6563 2e67  paths = fsspec.g
-0000cdc0: 6574 5f66 735f 746f 6b65 6e5f 7061 7468  et_fs_token_path
-0000cdd0: 7328 6461 7461 7365 745f 7061 7468 2c20  s(dataset_path, 
-0000cde0: 7374 6f72 6167 655f 6f70 7469 6f6e 733d  storage_options=
-0000cdf0: 7374 6f72 6167 655f 6f70 7469 6f6e 7329  storage_options)
-0000ce00: 0a20 2020 2020 2020 2066 733a 2066 7373  .        fs: fss
-0000ce10: 7065 632e 4162 7374 7261 6374 4669 6c65  pec.AbstractFile
-0000ce20: 5379 7374 656d 203d 2066 735f 746f 6b65  System = fs_toke
-0000ce30: 6e5f 7061 7468 735b 305d 0a20 2020 2020  n_paths[0].     
-0000ce40: 2020 2069 735f 6c6f 6361 6c20 3d20 6e6f     is_local = no
-0000ce50: 7420 6973 5f72 656d 6f74 655f 6669 6c65  t is_remote_file
-0000ce60: 7379 7374 656d 2866 7329 0a20 2020 2020  system(fs).     
-0000ce70: 2020 2070 6174 685f 6a6f 696e 203d 206f     path_join = o
-0000ce80: 732e 7061 7468 2e6a 6f69 6e20 6966 2069  s.path.join if i
-0000ce90: 735f 6c6f 6361 6c20 656c 7365 2070 6f73  s_local else pos
-0000cea0: 6978 7061 7468 2e6a 6f69 6e0a 0a20 2020  ixpath.join..   
-0000ceb0: 2020 2020 2069 6620 7365 6c66 2e6c 6973       if self.lis
-0000cec0: 745f 696e 6465 7865 7328 293a 0a20 2020  t_indexes():.   
-0000ced0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0000cee0: 616c 7565 4572 726f 7228 2270 6c65 6173  alueError("pleas
-0000cef0: 6520 7265 6d6f 7665 2061 6c6c 2074 6865  e remove all the
-0000cf00: 2069 6e64 6578 6573 2075 7369 6e67 2060   indexes using `
-0000cf10: 6461 7461 7365 742e 6472 6f70 5f69 6e64  dataset.drop_ind
-0000cf20: 6578 6020 6265 666f 7265 2073 6176 696e  ex` before savin
-0000cf30: 6720 6120 6461 7461 7365 7422 290a 0a20  g a dataset").. 
-0000cf40: 2020 2020 2020 2064 6174 6173 6574 203d         dataset =
-0000cf50: 2073 656c 662e 666c 6174 7465 6e5f 696e   self.flatten_in
-0000cf60: 6469 6365 7328 6e75 6d5f 7072 6f63 3d6e  dices(num_proc=n
-0000cf70: 756d 5f70 726f 6329 2069 6620 7365 6c66  um_proc) if self
-0000cf80: 2e5f 696e 6469 6365 7320 6973 206e 6f74  ._indices is not
-0000cf90: 204e 6f6e 6520 656c 7365 2073 656c 660a   None else self.
-0000cfa0: 0a20 2020 2020 2020 2069 6620 6973 5f6c  .        if is_l
-0000cfb0: 6f63 616c 3a0a 2020 2020 2020 2020 2020  ocal:.          
-0000cfc0: 2020 5061 7468 2864 6174 6173 6574 5f70    Path(dataset_p
-0000cfd0: 6174 6829 2e72 6573 6f6c 7665 2829 2e6d  ath).resolve().m
-0000cfe0: 6b64 6972 2870 6172 656e 7473 3d54 7275  kdir(parents=Tru
-0000cff0: 652c 2065 7869 7374 5f6f 6b3d 5472 7565  e, exist_ok=True
-0000d000: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
-0000d010: 7265 6e74 5f63 6163 6865 5f66 696c 6573  rent_cache_files
-0000d020: 5f70 6174 6873 203d 2073 6574 280a 2020  _paths = set(.  
-0000d030: 2020 2020 2020 2020 2020 2020 2020 5061                Pa
-0000d040: 7468 2863 6163 6865 5f66 696c 656e 616d  th(cache_filenam
-0000d050: 655b 2266 696c 656e 616d 6522 5d29 2e72  e["filename"]).r
-0000d060: 6573 6f6c 7665 2829 2e70 6172 656e 7420  esolve().parent 
-0000d070: 666f 7220 6361 6368 655f 6669 6c65 6e61  for cache_filena
-0000d080: 6d65 2069 6e20 7365 6c66 2e63 6163 6865  me in self.cache
-0000d090: 5f66 696c 6573 0a20 2020 2020 2020 2020  _files.         
-0000d0a0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000d0b0: 2023 2043 6865 636b 2074 6861 7420 7468   # Check that th
-0000d0c0: 6520 6461 7461 7365 7420 646f 6573 6e27  e dataset doesn'
-0000d0d0: 7420 6f76 6572 7772 6974 6520 6973 656c  t overwrite isel
-0000d0e0: 662e 2049 7420 6361 6e20 6361 7573 6520  f. It can cause 
-0000d0f0: 6120 7065 726d 6973 7369 6f6e 2065 7272  a permission err
-0000d100: 6f72 206f 6e20 5769 6e64 6f77 7320 616e  or on Windows an
-0000d110: 6420 6120 7365 6766 6175 6c74 206f 6e20  d a segfault on 
-0000d120: 6c69 6e75 782e 0a20 2020 2020 2020 2020  linux..         
-0000d130: 2020 2069 6620 5061 7468 2864 6174 6173     if Path(datas
-0000d140: 6574 5f70 6174 6829 2e72 6573 6f6c 7665  et_path).resolve
-0000d150: 2829 2069 6e20 7061 7265 6e74 5f63 6163  () in parent_cac
-0000d160: 6865 5f66 696c 6573 5f70 6174 6873 3a0a  he_files_paths:.
-0000d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d180: 7261 6973 6520 5065 726d 6973 7369 6f6e  raise Permission
-0000d190: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0000d1a0: 2020 2020 2020 2020 2020 2066 2254 7269             f"Tri
-0000d1b0: 6564 2074 6f20 6f76 6572 7772 6974 6520  ed to overwrite 
-0000d1c0: 7b50 6174 6828 6461 7461 7365 745f 7061  {Path(dataset_pa
-0000d1d0: 7468 292e 7265 736f 6c76 6528 297d 2062  th).resolve()} b
-0000d1e0: 7574 2061 2064 6174 6173 6574 2063 616e  ut a dataset can
-0000d1f0: 2774 206f 7665 7277 7269 7465 2069 7473  't overwrite its
-0000d200: 656c 662e 220a 2020 2020 2020 2020 2020  elf.".          
-0000d210: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000d220: 2023 2047 6574 206a 736f 6e20 7365 7269   # Get json seri
-0000d230: 616c 697a 6162 6c65 2073 7461 7465 0a20  alizable state. 
-0000d240: 2020 2020 2020 2073 7461 7465 203d 207b         state = {
-0000d250: 0a20 2020 2020 2020 2020 2020 206b 6579  .            key
-0000d260: 3a20 6461 7461 7365 742e 5f5f 6469 6374  : dataset.__dict
-0000d270: 5f5f 5b6b 6579 5d0a 2020 2020 2020 2020  __[key].        
-0000d280: 2020 2020 666f 7220 6b65 7920 696e 205b      for key in [
-0000d290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d2a0: 2022 5f66 696e 6765 7270 7269 6e74 222c   "_fingerprint",
-0000d2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d2c0: 2022 5f66 6f72 6d61 745f 636f 6c75 6d6e   "_format_column
-0000d2d0: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
-0000d2e0: 2020 2020 225f 666f 726d 6174 5f6b 7761      "_format_kwa
-0000d2f0: 7267 7322 2c0a 2020 2020 2020 2020 2020  rgs",.          
-0000d300: 2020 2020 2020 225f 666f 726d 6174 5f74        "_format_t
-0000d310: 7970 6522 2c0a 2020 2020 2020 2020 2020  ype",.          
-0000d320: 2020 2020 2020 225f 6f75 7470 7574 5f61        "_output_a
-0000d330: 6c6c 5f63 6f6c 756d 6e73 222c 0a20 2020  ll_columns",.   
-0000d340: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-0000d350: 2020 207d 0a20 2020 2020 2020 2073 7461     }.        sta
-0000d360: 7465 5b22 5f73 706c 6974 225d 203d 2073  te["_split"] = s
-0000d370: 7472 2864 6174 6173 6574 2e73 706c 6974  tr(dataset.split
-0000d380: 2920 6966 2064 6174 6173 6574 2e73 706c  ) if dataset.spl
-0000d390: 6974 2069 7320 6e6f 7420 4e6f 6e65 2065  it is not None e
-0000d3a0: 6c73 6520 6461 7461 7365 742e 7370 6c69  lse dataset.spli
-0000d3b0: 740a 2020 2020 2020 2020 7374 6174 655b  t.        state[
-0000d3c0: 225f 6461 7461 5f66 696c 6573 225d 203d  "_data_files"] =
-0000d3d0: 205b 0a20 2020 2020 2020 2020 2020 207b   [.            {
-0000d3e0: 2266 696c 656e 616d 6522 3a20 6622 6461  "filename": f"da
-0000d3f0: 7461 2d7b 7368 6172 645f 6964 783a 3035  ta-{shard_idx:05
-0000d400: 647d 2d6f 662d 7b6e 756d 5f73 6861 7264  d}-of-{num_shard
-0000d410: 733a 3035 647d 2e61 7272 6f77 227d 2066  s:05d}.arrow"} f
-0000d420: 6f72 2073 6861 7264 5f69 6478 2069 6e20  or shard_idx in 
-0000d430: 7261 6e67 6528 6e75 6d5f 7368 6172 6473  range(num_shards
-0000d440: 290a 2020 2020 2020 2020 5d0a 2020 2020  ).        ].    
-0000d450: 2020 2020 666f 7220 6b20 696e 2073 7461      for k in sta
-0000d460: 7465 5b22 5f66 6f72 6d61 745f 6b77 6172  te["_format_kwar
-0000d470: 6773 225d 2e6b 6579 7328 293a 0a20 2020  gs"].keys():.   
-0000d480: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0000d490: 2020 2020 2020 2020 2020 2020 2020 6a73                js
-0000d4a0: 6f6e 2e64 756d 7073 2873 7461 7465 5b22  on.dumps(state["
-0000d4b0: 5f66 6f72 6d61 745f 6b77 6172 6773 225d  _format_kwargs"]
-0000d4c0: 5b6b 5d29 0a20 2020 2020 2020 2020 2020  [k]).           
-0000d4d0: 2065 7863 6570 7420 5479 7065 4572 726f   except TypeErro
-0000d4e0: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-0000d4f0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-0000d500: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
-0000d510: 2020 2020 2020 2020 2020 2020 2073 7472               str
-0000d520: 2865 2920 2b20 6622 5c6e 5468 6520 666f  (e) + f"\nThe fo
-0000d530: 726d 6174 206b 7761 7267 7320 6d75 7374  rmat kwargs must
-0000d540: 2062 6520 4a53 4f4e 2073 6572 6961 6c69   be JSON seriali
-0000d550: 7a61 626c 652c 2062 7574 206b 6579 2027  zable, but key '
-0000d560: 7b6b 7d27 2069 736e 2774 2e22 0a20 2020  {k}' isn't.".   
-0000d570: 2020 2020 2020 2020 2020 2020 2029 2066               ) f
-0000d580: 726f 6d20 4e6f 6e65 0a20 2020 2020 2020  rom None.       
-0000d590: 2023 2047 6574 206a 736f 6e20 7365 7269   # Get json seri
-0000d5a0: 616c 697a 6162 6c65 2064 6174 6173 6574  alizable dataset
-0000d5b0: 2069 6e66 6f0a 2020 2020 2020 2020 6461   info.        da
-0000d5c0: 7461 7365 745f 696e 666f 203d 2061 7364  taset_info = asd
-0000d5d0: 6963 7428 6461 7461 7365 742e 5f69 6e66  ict(dataset._inf
-0000d5e0: 6f29 0a0a 2020 2020 2020 2020 7368 6172  o)..        shar
-0000d5f0: 6473 5f64 6f6e 6520 3d20 300a 2020 2020  ds_done = 0.    
-0000d600: 2020 2020 7062 6172 203d 206c 6f67 6769      pbar = loggi
-0000d610: 6e67 2e74 7164 6d28 0a20 2020 2020 2020  ng.tqdm(.       
-0000d620: 2020 2020 2064 6973 6162 6c65 3d6e 6f74       disable=not
-0000d630: 206c 6f67 6769 6e67 2e69 735f 7072 6f67   logging.is_prog
-0000d640: 7265 7373 5f62 6172 5f65 6e61 626c 6564  ress_bar_enabled
-0000d650: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-0000d660: 756e 6974 3d22 2065 7861 6d70 6c65 7322  unit=" examples"
-0000d670: 2c0a 2020 2020 2020 2020 2020 2020 746f  ,.            to
-0000d680: 7461 6c3d 6c65 6e28 6461 7461 7365 7429  tal=len(dataset)
-0000d690: 2c0a 2020 2020 2020 2020 2020 2020 6c65  ,.            le
-0000d6a0: 6176 653d 4661 6c73 652c 0a20 2020 2020  ave=False,.     
-0000d6b0: 2020 2020 2020 2064 6573 633d 6622 5361         desc=f"Sa
-0000d6c0: 7669 6e67 2074 6865 2064 6174 6173 6574  ving the dataset
-0000d6d0: 2028 7b73 6861 7264 735f 646f 6e65 7d2f   ({shards_done}/
-0000d6e0: 7b6e 756d 5f73 6861 7264 737d 2073 6861  {num_shards} sha
-0000d6f0: 7264 7329 222c 0a20 2020 2020 2020 2029  rds)",.        )
-0000d700: 0a20 2020 2020 2020 206b 7761 7267 735f  .        kwargs_
-0000d710: 7065 725f 6a6f 6220 3d20 280a 2020 2020  per_job = (.    
-0000d720: 2020 2020 2020 2020 7b0a 2020 2020 2020          {.      
-0000d730: 2020 2020 2020 2020 2020 226a 6f62 5f69            "job_i
-0000d740: 6422 3a20 7368 6172 645f 6964 782c 0a20  d": shard_idx,. 
-0000d750: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000d760: 7368 6172 6422 3a20 6461 7461 7365 742e  shard": dataset.
-0000d770: 7368 6172 6428 6e75 6d5f 7368 6172 6473  shard(num_shards
-0000d780: 3d6e 756d 5f73 6861 7264 732c 2069 6e64  =num_shards, ind
-0000d790: 6578 3d73 6861 7264 5f69 6478 2c20 636f  ex=shard_idx, co
-0000d7a0: 6e74 6967 756f 7573 3d54 7275 6529 2c0a  ntiguous=True),.
-0000d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7c0: 2266 7061 7468 223a 2070 6174 685f 6a6f  "fpath": path_jo
-0000d7d0: 696e 2864 6174 6173 6574 5f70 6174 682c  in(dataset_path,
-0000d7e0: 2066 2264 6174 612d 7b73 6861 7264 5f69   f"data-{shard_i
-0000d7f0: 6478 3a30 3564 7d2d 6f66 2d7b 6e75 6d5f  dx:05d}-of-{num_
-0000d800: 7368 6172 6473 3a30 3564 7d2e 6172 726f  shards:05d}.arro
-0000d810: 7722 292c 0a20 2020 2020 2020 2020 2020  w"),.           
-0000d820: 2020 2020 2022 7374 6f72 6167 655f 6f70       "storage_op
-0000d830: 7469 6f6e 7322 3a20 7374 6f72 6167 655f  tions": storage_
-0000d840: 6f70 7469 6f6e 732c 0a20 2020 2020 2020  options,.       
-0000d850: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-0000d860: 2020 2066 6f72 2073 6861 7264 5f69 6478     for shard_idx
-0000d870: 2069 6e20 7261 6e67 6528 6e75 6d5f 7368   in range(num_sh
-0000d880: 6172 6473 290a 2020 2020 2020 2020 290a  ards).        ).
-0000d890: 2020 2020 2020 2020 7368 6172 645f 6c65          shard_le
-0000d8a0: 6e67 7468 7320 3d20 5b4e 6f6e 655d 202a  ngths = [None] *
-0000d8b0: 206e 756d 5f73 6861 7264 730a 2020 2020   num_shards.    
-0000d8c0: 2020 2020 7368 6172 645f 7369 7a65 7320      shard_sizes 
-0000d8d0: 3d20 5b4e 6f6e 655d 202a 206e 756d 5f73  = [None] * num_s
-0000d8e0: 6861 7264 730a 2020 2020 2020 2020 6966  hards.        if
-0000d8f0: 206e 756d 5f70 726f 6320 3e20 313a 0a20   num_proc > 1:. 
-0000d900: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0000d910: 506f 6f6c 286e 756d 5f70 726f 6329 2061  Pool(num_proc) a
-0000d920: 7320 706f 6f6c 3a0a 2020 2020 2020 2020  s pool:.        
-0000d930: 2020 2020 2020 2020 666f 7220 6a6f 625f          for job_
-0000d940: 6964 2c20 646f 6e65 2c20 636f 6e74 656e  id, done, conten
-0000d950: 7420 696e 2069 666c 6174 6d61 705f 756e  t in iflatmap_un
-0000d960: 6f72 6465 7265 6428 0a20 2020 2020 2020  ordered(.       
-0000d970: 2020 2020 2020 2020 2020 2020 2070 6f6f               poo
-0000d980: 6c2c 2044 6174 6173 6574 2e5f 7361 7665  l, Dataset._save
-0000d990: 5f74 6f5f 6469 736b 5f73 696e 676c 652c  _to_disk_single,
-0000d9a0: 206b 7761 7267 735f 6974 6572 6162 6c65   kwargs_iterable
-0000d9b0: 3d6b 7761 7267 735f 7065 725f 6a6f 620a  =kwargs_per_job.
-0000d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000d9e0: 2020 2020 2020 2069 6620 646f 6e65 3a0a         if done:.
+00004430: 206e 756d 5f77 6f72 6b65 7273 3d6e 756d   num_workers=num
+00004440: 5f77 6f72 6b65 7273 2c0a 2020 2020 2020  _workers,.      
+00004450: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00004460: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00004470: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00004480: 6f72 2822 6e75 6d5f 776f 726b 6572 7320  or("num_workers 
+00004490: 6d75 7374 2062 6520 3e3d 2030 2229 0a0a  must be >= 0")..
+000044a0: 2020 2020 2020 2020 6465 6620 7370 6c69          def spli
+000044b0: 745f 6665 6174 7572 6573 5f61 6e64 5f6c  t_features_and_l
+000044c0: 6162 656c 7328 696e 7075 745f 6261 7463  abels(input_batc
+000044d0: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+000044e0: 2320 544f 444f 284d 6174 742c 2051 4c29  # TODO(Matt, QL)
+000044f0: 3a20 6465 7072 6563 6174 6520 7265 7475  : deprecate retu
+00004500: 726e 696e 6720 7468 6520 6469 6374 2063  rning the dict c
+00004510: 6f6e 7465 6e74 2077 6865 6e20 7468 6572  ontent when ther
+00004520: 6527 7320 6f6e 6c79 206f 6e65 206b 6579  e's only one key
+00004530: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
+00004540: 7475 7265 7320 3d20 7b6b 6579 3a20 7465  tures = {key: te
+00004550: 6e73 6f72 2066 6f72 206b 6579 2c20 7465  nsor for key, te
+00004560: 6e73 6f72 2069 6e20 696e 7075 745f 6261  nsor in input_ba
+00004570: 7463 682e 6974 656d 7328 2920 6966 206b  tch.items() if k
+00004580: 6579 2069 6e20 636f 6c75 6d6e 737d 0a20  ey in columns}. 
+00004590: 2020 2020 2020 2020 2020 206c 6162 656c             label
+000045a0: 7320 3d20 7b6b 6579 3a20 7465 6e73 6f72  s = {key: tensor
+000045b0: 2066 6f72 206b 6579 2c20 7465 6e73 6f72   for key, tensor
+000045c0: 2069 6e20 696e 7075 745f 6261 7463 682e   in input_batch.
+000045d0: 6974 656d 7328 2920 6966 206b 6579 2069  items() if key i
+000045e0: 6e20 6c61 6265 6c5f 636f 6c73 7d0a 2020  n label_cols}.  
+000045f0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00004600: 2866 6561 7475 7265 7329 203d 3d20 313a  (features) == 1:
+00004610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004620: 2066 6561 7475 7265 7320 3d20 6c69 7374   features = list
+00004630: 2866 6561 7475 7265 732e 7661 6c75 6573  (features.values
+00004640: 2829 295b 305d 0a20 2020 2020 2020 2020  ())[0].         
+00004650: 2020 2069 6620 6c65 6e28 6c61 6265 6c73     if len(labels
+00004660: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+00004670: 2020 2020 2020 2020 6c61 6265 6c73 203d          labels =
+00004680: 206c 6973 7428 6c61 6265 6c73 2e76 616c   list(labels.val
+00004690: 7565 7328 2929 5b30 5d0a 2020 2020 2020  ues())[0].      
+000046a0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+000046b0: 6e63 6528 6c61 6265 6c73 2c20 6469 6374  nce(labels, dict
+000046c0: 2920 616e 6420 6c65 6e28 6c61 6265 6c73  ) and len(labels
+000046d0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+000046e0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+000046f0: 6561 7475 7265 730a 2020 2020 2020 2020  eatures.        
+00004700: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00004710: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00004720: 2066 6561 7475 7265 732c 206c 6162 656c   features, label
+00004730: 730a 0a20 2020 2020 2020 2069 6620 636f  s..        if co
+00004740: 6c73 5f74 6f5f 7265 7461 696e 2069 7320  ls_to_retain is 
+00004750: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00004760: 2020 2020 2020 7466 5f64 6174 6173 6574        tf_dataset
+00004770: 203d 2074 665f 6461 7461 7365 742e 6d61   = tf_dataset.ma
+00004780: 7028 7370 6c69 745f 6665 6174 7572 6573  p(split_features
+00004790: 5f61 6e64 5f6c 6162 656c 7329 0a0a 2020  _and_labels)..  
+000047a0: 2020 2020 2020 6966 2070 7265 6665 7463        if prefetc
+000047b0: 683a 0a20 2020 2020 2020 2020 2020 2074  h:.            t
+000047c0: 665f 6461 7461 7365 7420 3d20 7466 5f64  f_dataset = tf_d
+000047d0: 6174 6173 6574 2e70 7265 6665 7463 6828  ataset.prefetch(
+000047e0: 7466 2e64 6174 612e 6578 7065 7269 6d65  tf.data.experime
+000047f0: 6e74 616c 2e41 5554 4f54 554e 4529 0a0a  ntal.AUTOTUNE)..
+00004800: 2020 2020 2020 2020 2320 5265 6d6f 7665          # Remove
+00004810: 2061 2072 6566 6572 656e 6365 2074 6f20   a reference to 
+00004820: 7468 6520 6f70 656e 2041 7272 6f77 2066  the open Arrow f
+00004830: 696c 6520 6f6e 2064 656c 6574 650a 2020  ile on delete.  
+00004840: 2020 2020 2020 6465 6620 636c 6561 6e75        def cleanu
+00004850: 705f 6361 6c6c 6261 636b 2872 6566 293a  p_callback(ref):
+00004860: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00004870: 6173 6574 2e5f 5f64 656c 5f5f 2829 0a20  aset.__del__(). 
+00004880: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004890: 5f54 465f 4441 5441 5345 545f 5245 4653  _TF_DATASET_REFS
+000048a0: 2e72 656d 6f76 6528 7265 6629 0a0a 2020  .remove(ref)..  
+000048b0: 2020 2020 2020 7365 6c66 2e5f 5446 5f44        self._TF_D
+000048c0: 4154 4153 4554 5f52 4546 532e 6164 6428  ATASET_REFS.add(
+000048d0: 7765 616b 7265 662e 7265 6628 7466 5f64  weakref.ref(tf_d
+000048e0: 6174 6173 6574 2c20 636c 6561 6e75 705f  ataset, cleanup_
+000048f0: 6361 6c6c 6261 636b 2929 0a0a 2020 2020  callback))..    
+00004900: 2020 2020 7265 7475 726e 2074 665f 6461      return tf_da
+00004910: 7461 7365 740a 0a0a 636c 6173 7320 4461  taset...class Da
+00004920: 7461 7365 7454 7261 6e73 666f 726d 6174  tasetTransformat
+00004930: 696f 6e4e 6f74 416c 6c6f 7765 6445 7272  ionNotAllowedErr
+00004940: 6f72 2845 7863 6570 7469 6f6e 293a 0a20  or(Exception):. 
+00004950: 2020 2070 6173 730a 0a0a 6465 6620 7472     pass...def tr
+00004960: 616e 736d 6974 5f66 6f72 6d61 7428 6675  ansmit_format(fu
+00004970: 6e63 293a 0a20 2020 2022 2222 5772 6170  nc):.    """Wrap
+00004980: 7065 7220 666f 7220 6461 7461 7365 7420  per for dataset 
+00004990: 7472 616e 7366 6f72 6d73 2074 6861 7420  transforms that 
+000049a0: 7265 6372 6561 7465 2061 206e 6577 2044  recreate a new D
+000049b0: 6174 6173 6574 2074 6f20 7472 616e 736d  ataset to transm
+000049c0: 6974 2074 6865 2066 6f72 6d61 7420 6f66  it the format of
+000049d0: 2074 6865 206f 7269 6769 6e61 6c20 6461   the original da
+000049e0: 7461 7365 7420 746f 2074 6865 206e 6577  taset to the new
+000049f0: 2064 6174 6173 6574 2222 220a 0a20 2020   dataset"""..   
+00004a00: 2040 7772 6170 7328 6675 6e63 290a 2020   @wraps(func).  
+00004a10: 2020 6465 6620 7772 6170 7065 7228 2a61    def wrapper(*a
+00004a20: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
+00004a30: 2020 2020 2020 2020 6966 2061 7267 733a          if args:
+00004a40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00004a50: 663a 2022 4461 7461 7365 7422 203d 2061  f: "Dataset" = a
+00004a60: 7267 735b 305d 0a20 2020 2020 2020 2020  rgs[0].         
+00004a70: 2020 2061 7267 7320 3d20 6172 6773 5b31     args = args[1
+00004a80: 3a5d 0a20 2020 2020 2020 2065 6c73 653a  :].        else:
+00004a90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00004aa0: 663a 2022 4461 7461 7365 7422 203d 206b  f: "Dataset" = k
+00004ab0: 7761 7267 732e 706f 7028 2273 656c 6622  wargs.pop("self"
+00004ac0: 290a 2020 2020 2020 2020 2320 646f 6e27  ).        # don'
+00004ad0: 7420 7573 6520 7365 6c66 2e66 6f72 6d61  t use self.forma
+00004ae0: 7420 7369 6e63 6520 6974 2072 6574 7572  t since it retur
+00004af0: 6e73 2061 206c 6973 7420 6f66 2063 6f6c  ns a list of col
+00004b00: 756d 6e73 2066 6f72 2027 636f 6c75 6d6e  umns for 'column
+00004b10: 7327 2065 7665 6e20 6966 2073 656c 665f  s' even if self_
+00004b20: 666f 726d 6174 5f63 6f6c 756d 6e73 2069  format_columns i
+00004b30: 7320 4e6f 6e65 0a20 2020 2020 2020 2075  s None.        u
+00004b40: 6e66 6f72 6d61 7474 6564 5f63 6f6c 756d  nformatted_colum
+00004b50: 6e73 203d 2073 6574 2873 656c 662e 636f  ns = set(self.co
+00004b60: 6c75 6d6e 5f6e 616d 6573 2920 2d20 7365  lumn_names) - se
+00004b70: 7428 7365 6c66 2e5f 666f 726d 6174 5f63  t(self._format_c
+00004b80: 6f6c 756d 6e73 206f 7220 5b5d 290a 2020  olumns or []).  
+00004b90: 2020 2020 2020 7365 6c66 5f66 6f72 6d61        self_forma
+00004ba0: 7420 3d20 7b0a 2020 2020 2020 2020 2020  t = {.          
+00004bb0: 2020 2274 7970 6522 3a20 7365 6c66 2e5f    "type": self._
+00004bc0: 666f 726d 6174 5f74 7970 652c 0a20 2020  format_type,.   
+00004bd0: 2020 2020 2020 2020 2022 666f 726d 6174           "format
+00004be0: 5f6b 7761 7267 7322 3a20 7365 6c66 2e5f  _kwargs": self._
+00004bf0: 666f 726d 6174 5f6b 7761 7267 732c 0a20  format_kwargs,. 
+00004c00: 2020 2020 2020 2020 2020 2022 636f 6c75             "colu
+00004c10: 6d6e 7322 3a20 7365 6c66 2e5f 666f 726d  mns": self._form
+00004c20: 6174 5f63 6f6c 756d 6e73 2c0a 2020 2020  at_columns,.    
+00004c30: 2020 2020 2020 2020 226f 7574 7075 745f          "output_
+00004c40: 616c 6c5f 636f 6c75 6d6e 7322 3a20 7365  all_columns": se
+00004c50: 6c66 2e5f 6f75 7470 7574 5f61 6c6c 5f63  lf._output_all_c
+00004c60: 6f6c 756d 6e73 2c0a 2020 2020 2020 2020  olumns,.        
+00004c70: 7d0a 2020 2020 2020 2020 2320 6170 706c  }.        # appl
+00004c80: 7920 6163 7475 616c 2066 756e 6374 696f  y actual functio
+00004c90: 6e0a 2020 2020 2020 2020 6f75 743a 2055  n.        out: U
+00004ca0: 6e69 6f6e 5b22 4461 7461 7365 7422 2c20  nion["Dataset", 
+00004cb0: 2244 6174 6173 6574 4469 6374 225d 203d  "DatasetDict"] =
+00004cc0: 2066 756e 6328 7365 6c66 2c20 2a61 7267   func(self, *arg
+00004cd0: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
+00004ce0: 2020 2020 2064 6174 6173 6574 733a 204c       datasets: L
+00004cf0: 6973 745b 2244 6174 6173 6574 225d 203d  ist["Dataset"] =
+00004d00: 206c 6973 7428 6f75 742e 7661 6c75 6573   list(out.values
+00004d10: 2829 2920 6966 2069 7369 6e73 7461 6e63  ()) if isinstanc
+00004d20: 6528 6f75 742c 2064 6963 7429 2065 6c73  e(out, dict) els
+00004d30: 6520 5b6f 7574 5d0a 2020 2020 2020 2020  e [out].        
+00004d40: 2320 7265 2d61 7070 6c79 2066 6f72 6d61  # re-apply forma
+00004d50: 7420 746f 2074 6865 206f 7574 7075 740a  t to the output.
+00004d60: 2020 2020 2020 2020 666f 7220 6461 7461          for data
+00004d70: 7365 7420 696e 2064 6174 6173 6574 733a  set in datasets:
+00004d80: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00004d90: 5f66 6f72 6d61 7420 3d20 7365 6c66 5f66  _format = self_f
+00004da0: 6f72 6d61 742e 636f 7079 2829 0a20 2020  ormat.copy().   
+00004db0: 2020 2020 2020 2020 2069 6620 6e65 775f           if new_
+00004dc0: 666f 726d 6174 5b22 636f 6c75 6d6e 7322  format["columns"
+00004dd0: 5d20 6973 206e 6f74 204e 6f6e 653a 2020  ] is not None:  
+00004de0: 2320 6e65 7720 666f 726d 6174 7465 6420  # new formatted 
+00004df0: 636f 6c75 6d6e 7320 3d20 2863 6f6c 756d  columns = (colum
+00004e00: 6e73 202d 2070 7265 7669 6f75 736c 7920  ns - previously 
+00004e10: 756e 666f 726d 6174 7465 6420 636f 6c75  unformatted colu
+00004e20: 6d6e 7329 0a20 2020 2020 2020 2020 2020  mns).           
+00004e30: 2020 2020 2023 2073 6f72 7420 7468 6520       # sort the 
+00004e40: 636f 6c75 6d6e 7320 746f 2068 6176 6520  columns to have 
+00004e50: 6120 6465 7465 726d 696e 6973 7469 6320  a deterministic 
+00004e60: 6c69 7374 206f 6620 636f 6c75 6d6e 7320  list of columns 
+00004e70: 7468 6174 2077 6520 6361 6e20 636f 6d70  that we can comp
+00004e80: 6172 6520 7769 7468 2060 6f75 745f 666f  are with `out_fo
+00004e90: 726d 6174 600a 2020 2020 2020 2020 2020  rmat`.          
+00004ea0: 2020 2020 2020 6e65 775f 666f 726d 6174        new_format
+00004eb0: 5b22 636f 6c75 6d6e 7322 5d20 3d20 736f  ["columns"] = so
+00004ec0: 7274 6564 2873 6574 2864 6174 6173 6574  rted(set(dataset
+00004ed0: 2e63 6f6c 756d 6e5f 6e61 6d65 7329 202d  .column_names) -
+00004ee0: 2075 6e66 6f72 6d61 7474 6564 5f63 6f6c   unformatted_col
+00004ef0: 756d 6e73 290a 2020 2020 2020 2020 2020  umns).          
+00004f00: 2020 6f75 745f 666f 726d 6174 203d 207b    out_format = {
+00004f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004f20: 2022 7479 7065 223a 2064 6174 6173 6574   "type": dataset
+00004f30: 2e5f 666f 726d 6174 5f74 7970 652c 0a20  ._format_type,. 
+00004f40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00004f50: 666f 726d 6174 5f6b 7761 7267 7322 3a20  format_kwargs": 
+00004f60: 6461 7461 7365 742e 5f66 6f72 6d61 745f  dataset._format_
+00004f70: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
+00004f80: 2020 2020 2020 2020 2263 6f6c 756d 6e73          "columns
+00004f90: 223a 2073 6f72 7465 6428 6461 7461 7365  ": sorted(datase
+00004fa0: 742e 5f66 6f72 6d61 745f 636f 6c75 6d6e  t._format_column
+00004fb0: 7329 2069 6620 6461 7461 7365 742e 5f66  s) if dataset._f
+00004fc0: 6f72 6d61 745f 636f 6c75 6d6e 7320 6973  ormat_columns is
+00004fd0: 206e 6f74 204e 6f6e 6520 656c 7365 204e   not None else N
+00004fe0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00004ff0: 2020 2020 2022 6f75 7470 7574 5f61 6c6c       "output_all
+00005000: 5f63 6f6c 756d 6e73 223a 2064 6174 6173  _columns": datas
+00005010: 6574 2e5f 6f75 7470 7574 5f61 6c6c 5f63  et._output_all_c
+00005020: 6f6c 756d 6e73 2c0a 2020 2020 2020 2020  olumns,.        
+00005030: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+00005040: 2020 6966 206f 7574 5f66 6f72 6d61 7420    if out_format 
+00005050: 213d 206e 6577 5f66 6f72 6d61 743a 2020  != new_format:  
+00005060: 2320 6f6e 6c79 2061 7070 6c79 2069 6620  # only apply if 
+00005070: 7468 6572 6527 7320 6120 6368 616e 6765  there's a change
+00005080: 206e 6f74 2074 6f20 7570 6461 7465 2074   not to update t
+00005090: 6865 2066 696e 6765 7270 7269 6e74 2066  he fingerprint f
+000050a0: 6f72 206e 6f74 6869 6e67 0a20 2020 2020  or nothing.     
+000050b0: 2020 2020 2020 2020 2020 2064 6174 6173             datas
+000050c0: 6574 2e73 6574 5f66 6f72 6d61 7428 2a2a  et.set_format(**
+000050d0: 6e65 775f 666f 726d 6174 290a 2020 2020  new_format).    
+000050e0: 2020 2020 7265 7475 726e 206f 7574 0a0a      return out..
+000050f0: 2020 2020 7772 6170 7065 722e 5f64 6563      wrapper._dec
+00005100: 6f72 6174 6f72 5f6e 616d 655f 203d 2022  orator_name_ = "
+00005110: 7472 616e 736d 6974 5f66 6f72 6d61 7422  transmit_format"
+00005120: 0a20 2020 2072 6574 7572 6e20 7772 6170  .    return wrap
+00005130: 7065 720a 0a0a 6465 6620 7472 616e 736d  per...def transm
+00005140: 6974 5f74 6173 6b73 2866 756e 6329 3a0a  it_tasks(func):.
+00005150: 2020 2020 2222 2257 7261 7070 6572 2066      """Wrapper f
+00005160: 6f72 2064 6174 6173 6574 2074 7261 6e73  or dataset trans
+00005170: 666f 726d 7320 7468 6174 2072 6563 7265  forms that recre
+00005180: 6174 6520 6120 6e65 7720 4461 7461 7365  ate a new Datase
+00005190: 7420 746f 2074 7261 6e73 6d69 7420 7468  t to transmit th
+000051a0: 6520 7461 736b 2074 656d 706c 6174 6573  e task templates
+000051b0: 206f 6620 7468 6520 6f72 6967 696e 616c   of the original
+000051c0: 2064 6174 6173 6574 2074 6f20 7468 6520   dataset to the 
+000051d0: 6e65 7720 6461 7461 7365 7422 2222 0a0a  new dataset"""..
+000051e0: 2020 2020 4077 7261 7073 2866 756e 6329      @wraps(func)
+000051f0: 0a20 2020 2064 6566 2077 7261 7070 6572  .    def wrapper
+00005200: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+00005210: 293a 0a20 2020 2020 2020 2069 6620 6172  ):.        if ar
+00005220: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00005230: 7365 6c66 3a20 2244 6174 6173 6574 2220  self: "Dataset" 
+00005240: 3d20 6172 6773 5b30 5d0a 2020 2020 2020  = args[0].      
+00005250: 2020 2020 2020 6172 6773 203d 2061 7267        args = arg
+00005260: 735b 313a 5d0a 2020 2020 2020 2020 656c  s[1:].        el
+00005270: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00005280: 7365 6c66 3a20 2244 6174 6173 6574 2220  self: "Dataset" 
+00005290: 3d20 6b77 6172 6773 2e70 6f70 2822 7365  = kwargs.pop("se
+000052a0: 6c66 2229 0a20 2020 2020 2020 2023 2061  lf").        # a
+000052b0: 7070 6c79 2061 6374 7561 6c20 6675 6e63  pply actual func
+000052c0: 7469 6f6e 0a20 2020 2020 2020 206f 7574  tion.        out
+000052d0: 3a20 556e 696f 6e5b 2244 6174 6173 6574  : Union["Dataset
+000052e0: 222c 2022 4461 7461 7365 7444 6963 7422  ", "DatasetDict"
+000052f0: 5d20 3d20 6675 6e63 2873 656c 662c 202a  ] = func(self, *
+00005300: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
+00005310: 2020 2020 2020 2020 6461 7461 7365 7473          datasets
+00005320: 3a20 4c69 7374 5b22 4461 7461 7365 7422  : List["Dataset"
+00005330: 5d20 3d20 6c69 7374 286f 7574 2e76 616c  ] = list(out.val
+00005340: 7565 7328 2929 2069 6620 6973 696e 7374  ues()) if isinst
+00005350: 616e 6365 286f 7574 2c20 6469 6374 2920  ance(out, dict) 
+00005360: 656c 7365 205b 6f75 745d 0a20 2020 2020  else [out].     
+00005370: 2020 2066 6f72 2064 6174 6173 6574 2069     for dataset i
+00005380: 6e20 6461 7461 7365 7473 3a0a 2020 2020  n datasets:.    
+00005390: 2020 2020 2020 2020 2320 5265 6d6f 7665          # Remove
+000053a0: 2074 6173 6b20 7465 6d70 6c61 7465 7320   task templates 
+000053b0: 6966 2061 2063 6f6c 756d 6e20 6d61 7070  if a column mapp
+000053c0: 696e 6720 6f66 2074 6865 2074 656d 706c  ing of the templ
+000053d0: 6174 6520 6973 206e 6f20 6c6f 6e67 6572  ate is no longer
+000053e0: 2076 616c 6964 0a20 2020 2020 2020 2020   valid.         
+000053f0: 2020 2069 6620 7365 6c66 2e69 6e66 6f2e     if self.info.
+00005400: 7461 736b 5f74 656d 706c 6174 6573 2069  task_templates i
+00005410: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00005420: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00005430: 7365 742e 696e 666f 2e74 6173 6b5f 7465  set.info.task_te
+00005440: 6d70 6c61 7465 7320 3d20 5b0a 2020 2020  mplates = [.    
+00005450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005460: 7465 6d70 6c61 7465 0a20 2020 2020 2020  template.       
+00005470: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00005480: 2074 656d 706c 6174 6520 696e 2073 656c   template in sel
+00005490: 662e 696e 666f 2e74 6173 6b5f 7465 6d70  f.info.task_temp
+000054a0: 6c61 7465 730a 2020 2020 2020 2020 2020  lates.          
+000054b0: 2020 2020 2020 2020 2020 6966 2061 6c6c            if all
+000054c0: 2864 6174 6173 6574 2e66 6561 7475 7265  (dataset.feature
+000054d0: 732e 6765 7428 6b29 203d 3d20 7365 6c66  s.get(k) == self
+000054e0: 2e66 6561 7475 7265 732e 6765 7428 6b29  .features.get(k)
+000054f0: 2066 6f72 206b 2069 6e20 7465 6d70 6c61   for k in templa
+00005500: 7465 2e63 6f6c 756d 6e5f 6d61 7070 696e  te.column_mappin
+00005510: 672e 6b65 7973 2829 290a 2020 2020 2020  g.keys()).      
+00005520: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+00005530: 2020 2020 7265 7475 726e 206f 7574 0a0a      return out..
+00005540: 2020 2020 7772 6170 7065 722e 5f64 6563      wrapper._dec
+00005550: 6f72 6174 6f72 5f6e 616d 655f 203d 2022  orator_name_ = "
+00005560: 7472 616e 736d 6974 5f74 6173 6b73 220a  transmit_tasks".
+00005570: 2020 2020 7265 7475 726e 2077 7261 7070      return wrapp
+00005580: 6572 0a0a 0a64 6566 2075 7064 6174 655f  er...def update_
+00005590: 6d65 7461 6461 7461 5f77 6974 685f 6665  metadata_with_fe
+000055a0: 6174 7572 6573 2874 6162 6c65 3a20 5461  atures(table: Ta
+000055b0: 626c 652c 2066 6561 7475 7265 733a 2046  ble, features: F
+000055c0: 6561 7475 7265 7329 3a0a 2020 2020 2222  eatures):.    ""
+000055d0: 2254 6f20 6265 2075 7365 6420 696e 2064  "To be used in d
+000055e0: 6174 6173 6574 2074 7261 6e73 666f 726d  ataset transform
+000055f0: 7320 7468 6174 206d 6f64 6966 7920 7468  s that modify th
+00005600: 6520 6665 6174 7572 6573 206f 6620 7468  e features of th
+00005610: 6520 6461 7461 7365 742c 2069 6e20 6f72  e dataset, in or
+00005620: 6465 7220 746f 2075 7064 6174 6520 7468  der to update th
+00005630: 6520 6665 6174 7572 6573 2073 746f 7265  e features store
+00005640: 6420 696e 2074 6865 206d 6574 6164 6174  d in the metadat
+00005650: 6120 6f66 2069 7473 2073 6368 656d 612e  a of its schema.
+00005660: 2222 220a 2020 2020 6665 6174 7572 6573  """.    features
+00005670: 203d 2046 6561 7475 7265 7328 7b63 6f6c   = Features({col
+00005680: 5f6e 616d 653a 2066 6561 7475 7265 735b  _name: features[
+00005690: 636f 6c5f 6e61 6d65 5d20 666f 7220 636f  col_name] for co
+000056a0: 6c5f 6e61 6d65 2069 6e20 7461 626c 652e  l_name in table.
+000056b0: 636f 6c75 6d6e 5f6e 616d 6573 7d29 0a20  column_names}). 
+000056c0: 2020 2069 6620 7461 626c 652e 7363 6865     if table.sche
+000056d0: 6d61 2e6d 6574 6164 6174 6120 6973 204e  ma.metadata is N
+000056e0: 6f6e 6520 6f72 2062 2268 7567 6769 6e67  one or b"hugging
+000056f0: 6661 6365 2220 6e6f 7420 696e 2074 6162  face" not in tab
+00005700: 6c65 2e73 6368 656d 612e 6d65 7461 6461  le.schema.metada
+00005710: 7461 3a0a 2020 2020 2020 2020 7061 5f6d  ta:.        pa_m
+00005720: 6574 6164 6174 6120 3d20 4172 726f 7757  etadata = ArrowW
+00005730: 7269 7465 722e 5f62 7569 6c64 5f6d 6574  riter._build_met
+00005740: 6164 6174 6128 4461 7461 7365 7449 6e66  adata(DatasetInf
+00005750: 6f28 6665 6174 7572 6573 3d66 6561 7475  o(features=featu
+00005760: 7265 7329 290a 2020 2020 656c 7365 3a0a  res)).    else:.
+00005770: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
+00005780: 203d 206a 736f 6e2e 6c6f 6164 7328 7461   = json.loads(ta
+00005790: 626c 652e 7363 6865 6d61 2e6d 6574 6164  ble.schema.metad
+000057a0: 6174 615b 6222 6875 6767 696e 6766 6163  ata[b"huggingfac
+000057b0: 6522 5d2e 6465 636f 6465 2829 290a 2020  e"].decode()).  
+000057c0: 2020 2020 2020 6966 2022 696e 666f 2220        if "info" 
+000057d0: 6e6f 7420 696e 206d 6574 6164 6174 613a  not in metadata:
+000057e0: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+000057f0: 6164 6174 615b 2269 6e66 6f22 5d20 3d20  adata["info"] = 
+00005800: 6173 6469 6374 2844 6174 6173 6574 496e  asdict(DatasetIn
+00005810: 666f 2866 6561 7475 7265 733d 6665 6174  fo(features=feat
+00005820: 7572 6573 2929 0a20 2020 2020 2020 2065  ures)).        e
+00005830: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00005840: 206d 6574 6164 6174 615b 2269 6e66 6f22   metadata["info"
+00005850: 5d5b 2266 6561 7475 7265 7322 5d20 3d20  ]["features"] = 
+00005860: 6173 6469 6374 2844 6174 6173 6574 496e  asdict(DatasetIn
+00005870: 666f 2866 6561 7475 7265 733d 6665 6174  fo(features=feat
+00005880: 7572 6573 2929 5b22 6665 6174 7572 6573  ures))["features
+00005890: 225d 0a20 2020 2020 2020 2070 615f 6d65  "].        pa_me
+000058a0: 7461 6461 7461 203d 207b 2268 7567 6769  tadata = {"huggi
+000058b0: 6e67 6661 6365 223a 206a 736f 6e2e 6475  ngface": json.du
+000058c0: 6d70 7328 6d65 7461 6461 7461 297d 0a20  mps(metadata)}. 
+000058d0: 2020 2074 6162 6c65 203d 2074 6162 6c65     table = table
+000058e0: 2e72 6570 6c61 6365 5f73 6368 656d 615f  .replace_schema_
+000058f0: 6d65 7461 6461 7461 2870 615f 6d65 7461  metadata(pa_meta
+00005900: 6461 7461 290a 2020 2020 7265 7475 726e  data).    return
+00005910: 2074 6162 6c65 0a0a 0a64 6566 205f 6368   table...def _ch
+00005920: 6563 6b5f 7461 626c 6528 7461 626c 6529  eck_table(table)
+00005930: 202d 3e20 5461 626c 653a 0a20 2020 2022   -> Table:.    "
+00005940: 2222 5765 2063 6865 636b 2074 6865 2074  ""We check the t
+00005950: 6162 6c65 2074 7970 6520 746f 206d 616b  able type to mak
+00005960: 6520 7375 7265 2069 7427 7320 616e 2069  e sure it's an i
+00005970: 6e73 7461 6e63 6520 6f66 203a 636c 6173  nstance of :clas
+00005980: 733a 6064 6174 6173 6574 732e 7461 626c  s:`datasets.tabl
+00005990: 652e 5461 626c 6560 2222 220a 2020 2020  e.Table`""".    
+000059a0: 6966 2069 7369 6e73 7461 6e63 6528 7461  if isinstance(ta
+000059b0: 626c 652c 2070 612e 5461 626c 6529 3a0a  ble, pa.Table):.
+000059c0: 2020 2020 2020 2020 2320 666f 7220 6120          # for a 
+000059d0: 7079 6172 726f 7720 7461 626c 652c 2077  pyarrow table, w
+000059e0: 6520 6361 6e20 6a75 7374 2063 6f6e 7369  e can just consi
+000059f0: 6465 7220 6974 2061 7320 6120 696e 2d6d  der it as a in-m
+00005a00: 656d 6f72 7920 7461 626c 650a 2020 2020  emory table.    
+00005a10: 2020 2020 2320 7468 6973 2069 7320 6865      # this is he
+00005a20: 7265 2066 6f72 2062 6163 6b77 6172 6420  re for backward 
+00005a30: 636f 6d70 6174 6962 696c 6974 790a 2020  compatibility.  
+00005a40: 2020 2020 2020 7265 7475 726e 2049 6e4d        return InM
+00005a50: 656d 6f72 7954 6162 6c65 2874 6162 6c65  emoryTable(table
+00005a60: 290a 2020 2020 656c 6966 2069 7369 6e73  ).    elif isins
+00005a70: 7461 6e63 6528 7461 626c 652c 2054 6162  tance(table, Tab
+00005a80: 6c65 293a 0a20 2020 2020 2020 2072 6574  le):.        ret
+00005a90: 7572 6e20 7461 626c 650a 2020 2020 656c  urn table.    el
+00005aa0: 7365 3a0a 2020 2020 2020 2020 7261 6973  se:.        rais
+00005ab0: 6520 5479 7065 4572 726f 7228 6622 4578  e TypeError(f"Ex
+00005ac0: 7065 6374 6564 2061 2070 7961 7272 6f77  pected a pyarrow
+00005ad0: 2e54 6162 6c65 206f 7220 6120 6461 7461  .Table or a data
+00005ae0: 7365 7473 2e74 6162 6c65 2e54 6162 6c65  sets.table.Table
+00005af0: 206f 626a 6563 742c 2062 7574 2067 6f74   object, but got
+00005b00: 207b 7461 626c 657d 2e22 290a 0a0a 6465   {table}.")...de
+00005b10: 6620 5f63 6865 636b 5f63 6f6c 756d 6e5f  f _check_column_
+00005b20: 6e61 6d65 7328 636f 6c75 6d6e 5f6e 616d  names(column_nam
+00005b30: 6573 3a20 4c69 7374 5b73 7472 5d29 3a0a  es: List[str]):.
+00005b40: 2020 2020 2222 2243 6865 636b 2074 6865      """Check the
+00005b50: 2063 6f6c 756d 6e20 6e61 6d65 7320 746f   column names to
+00005b60: 206d 616b 6520 7375 7265 2074 6865 7920   make sure they 
+00005b70: 646f 6e27 7420 636f 6e74 6169 6e20 6475  don't contain du
+00005b80: 706c 6963 6174 6573 2e22 2222 0a20 2020  plicates.""".   
+00005b90: 2063 6f75 6e74 6572 203d 2043 6f75 6e74   counter = Count
+00005ba0: 6572 2863 6f6c 756d 6e5f 6e61 6d65 7329  er(column_names)
+00005bb0: 0a20 2020 2069 6620 6e6f 7420 616c 6c28  .    if not all(
+00005bc0: 636f 756e 7420 3d3d 2031 2066 6f72 2063  count == 1 for c
+00005bd0: 6f75 6e74 2069 6e20 636f 756e 7465 722e  ount in counter.
+00005be0: 7661 6c75 6573 2829 293a 0a20 2020 2020  values()):.     
+00005bf0: 2020 2064 7570 6c69 6361 7465 645f 636f     duplicated_co
+00005c00: 6c75 6d6e 7320 3d20 5b63 6f6c 2066 6f72  lumns = [col for
+00005c10: 2063 6f6c 2069 6e20 636f 756e 7465 7220   col in counter 
+00005c20: 6966 2063 6f75 6e74 6572 5b63 6f6c 5d20  if counter[col] 
+00005c30: 3e20 315d 0a20 2020 2020 2020 2072 6169  > 1].        rai
+00005c40: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
+00005c50: 5468 6520 7461 626c 6520 6361 6e27 7420  The table can't 
+00005c60: 6861 7665 2064 7570 6c69 6361 7465 6420  have duplicated 
+00005c70: 636f 6c75 6d6e 7320 6275 7420 636f 6c75  columns but colu
+00005c80: 6d6e 7320 7b64 7570 6c69 6361 7465 645f  mns {duplicated_
+00005c90: 636f 6c75 6d6e 737d 2061 7265 2064 7570  columns} are dup
+00005ca0: 6c69 6361 7465 642e 2229 0a0a 0a64 6566  licated.")...def
+00005cb0: 205f 6368 6563 6b5f 7661 6c69 645f 696e   _check_valid_in
+00005cc0: 6469 6365 735f 7661 6c75 6528 696e 6465  dices_value(inde
+00005cd0: 782c 2073 697a 6529 3a0a 2020 2020 6966  x, size):.    if
+00005ce0: 2028 696e 6465 7820 3c20 3020 616e 6420   (index < 0 and 
+00005cf0: 696e 6465 7820 2b20 7369 7a65 203c 2030  index + size < 0
+00005d00: 2920 6f72 2028 696e 6465 7820 3e3d 2073  ) or (index >= s
+00005d10: 697a 6529 3a0a 2020 2020 2020 2020 7261  ize):.        ra
+00005d20: 6973 6520 496e 6465 7845 7272 6f72 2866  ise IndexError(f
+00005d30: 2249 6e64 6578 207b 696e 6465 787d 206f  "Index {index} o
+00005d40: 7574 206f 6620 7261 6e67 6520 666f 7220  ut of range for 
+00005d50: 6461 7461 7365 7420 6f66 2073 697a 6520  dataset of size 
+00005d60: 7b73 697a 657d 2e22 290a 0a0a 636c 6173  {size}.")...clas
+00005d70: 7320 4e6f 6e45 7869 7374 656e 7444 6174  s NonExistentDat
+00005d80: 6173 6574 4572 726f 7228 4578 6365 7074  asetError(Except
+00005d90: 696f 6e29 3a0a 2020 2020 2222 2255 7365  ion):.    """Use
+00005da0: 6420 7768 656e 2077 6520 6578 7065 6374  d when we expect
+00005db0: 2074 6865 2065 7869 7374 656e 6365 206f   the existence o
+00005dc0: 6620 6120 6461 7461 7365 7422 2222 0a0a  f a dataset"""..
+00005dd0: 2020 2020 7061 7373 0a0a 0a63 6c61 7373      pass...class
+00005de0: 2044 6174 6173 6574 2844 6174 6173 6574   Dataset(Dataset
+00005df0: 496e 666f 4d69 7869 6e2c 2049 6e64 6578  InfoMixin, Index
+00005e00: 6162 6c65 4d69 7869 6e2c 2054 656e 736f  ableMixin, Tenso
+00005e10: 7266 6c6f 7744 6174 6173 6574 4d69 7869  rflowDatasetMixi
+00005e20: 6e29 3a0a 2020 2020 2222 2241 2044 6174  n):.    """A Dat
+00005e30: 6173 6574 2062 6163 6b65 6420 6279 2061  aset backed by a
+00005e40: 6e20 4172 726f 7720 7461 626c 652e 2222  n Arrow table.""
+00005e50: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00005e60: 745f 5f28 0a20 2020 2020 2020 2073 656c  t__(.        sel
+00005e70: 662c 0a20 2020 2020 2020 2061 7272 6f77  f,.        arrow
+00005e80: 5f74 6162 6c65 3a20 5461 626c 652c 0a20  _table: Table,. 
+00005e90: 2020 2020 2020 2069 6e66 6f3a 204f 7074         info: Opt
+00005ea0: 696f 6e61 6c5b 4461 7461 7365 7449 6e66  ional[DatasetInf
+00005eb0: 6f5d 203d 204e 6f6e 652c 0a20 2020 2020  o] = None,.     
+00005ec0: 2020 2073 706c 6974 3a20 4f70 7469 6f6e     split: Option
+00005ed0: 616c 5b4e 616d 6564 5370 6c69 745d 203d  al[NamedSplit] =
+00005ee0: 204e 6f6e 652c 0a20 2020 2020 2020 2069   None,.        i
+00005ef0: 6e64 6963 6573 5f74 6162 6c65 3a20 4f70  ndices_table: Op
+00005f00: 7469 6f6e 616c 5b54 6162 6c65 5d20 3d20  tional[Table] = 
+00005f10: 4e6f 6e65 2c0a 2020 2020 2020 2020 6669  None,.        fi
+00005f20: 6e67 6572 7072 696e 743a 204f 7074 696f  ngerprint: Optio
+00005f30: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+00005f40: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+00005f50: 696e 666f 203d 2069 6e66 6f2e 636f 7079  info = info.copy
+00005f60: 2829 2069 6620 696e 666f 2069 7320 6e6f  () if info is no
+00005f70: 7420 4e6f 6e65 2065 6c73 6520 4461 7461  t None else Data
+00005f80: 7365 7449 6e66 6f28 290a 2020 2020 2020  setInfo().      
+00005f90: 2020 4461 7461 7365 7449 6e66 6f4d 6978    DatasetInfoMix
+00005fa0: 696e 2e5f 5f69 6e69 745f 5f28 7365 6c66  in.__init__(self
+00005fb0: 2c20 696e 666f 3d69 6e66 6f2c 2073 706c  , info=info, spl
+00005fc0: 6974 3d73 706c 6974 290a 2020 2020 2020  it=split).      
+00005fd0: 2020 496e 6465 7861 626c 654d 6978 696e    IndexableMixin
+00005fe0: 2e5f 5f69 6e69 745f 5f28 7365 6c66 290a  .__init__(self).
+00005ff0: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
+00006000: 6174 613a 2054 6162 6c65 203d 205f 6368  ata: Table = _ch
+00006010: 6563 6b5f 7461 626c 6528 6172 726f 775f  eck_table(arrow_
+00006020: 7461 626c 6529 0a20 2020 2020 2020 2073  table).        s
+00006030: 656c 662e 5f69 6e64 6963 6573 3a20 4f70  elf._indices: Op
+00006040: 7469 6f6e 616c 5b54 6162 6c65 5d20 3d20  tional[Table] = 
+00006050: 5f63 6865 636b 5f74 6162 6c65 2869 6e64  _check_table(ind
+00006060: 6963 6573 5f74 6162 6c65 2920 6966 2069  ices_table) if i
+00006070: 6e64 6963 6573 5f74 6162 6c65 2069 7320  ndices_table is 
+00006080: 6e6f 7420 4e6f 6e65 2065 6c73 6520 4e6f  not None else No
+00006090: 6e65 0a20 2020 2020 2020 206d 6179 6265  ne.        maybe
+000060a0: 5f72 6567 6973 7465 725f 6461 7461 7365  _register_datase
+000060b0: 745f 666f 725f 7465 6d70 5f64 6972 5f64  t_for_temp_dir_d
+000060c0: 656c 6574 696f 6e28 7365 6c66 290a 0a20  eletion(self).. 
+000060d0: 2020 2020 2020 2073 656c 662e 5f66 6f72         self._for
+000060e0: 6d61 745f 7479 7065 3a20 4f70 7469 6f6e  mat_type: Option
+000060f0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 0a20  al[str] = None. 
+00006100: 2020 2020 2020 2073 656c 662e 5f66 6f72         self._for
+00006110: 6d61 745f 6b77 6172 6773 3a20 6469 6374  mat_kwargs: dict
+00006120: 203d 207b 7d0a 2020 2020 2020 2020 7365   = {}.        se
+00006130: 6c66 2e5f 666f 726d 6174 5f63 6f6c 756d  lf._format_colum
+00006140: 6e73 3a20 4f70 7469 6f6e 616c 5b6c 6973  ns: Optional[lis
+00006150: 745d 203d 204e 6f6e 650a 2020 2020 2020  t] = None.      
+00006160: 2020 7365 6c66 2e5f 6f75 7470 7574 5f61    self._output_a
+00006170: 6c6c 5f63 6f6c 756d 6e73 3a20 626f 6f6c  ll_columns: bool
+00006180: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00006190: 2073 656c 662e 5f66 696e 6765 7270 7269   self._fingerpri
+000061a0: 6e74 3a20 7374 7220 3d20 6669 6e67 6572  nt: str = finger
+000061b0: 7072 696e 740a 0a20 2020 2020 2020 2023  print..        #
+000061c0: 2052 6561 6420 6d65 7461 6461 7461 0a0a   Read metadata..
+000061d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000061e0: 5f64 6174 612e 7363 6865 6d61 2e6d 6574  _data.schema.met
+000061f0: 6164 6174 6120 6973 206e 6f74 204e 6f6e  adata is not Non
+00006200: 6520 616e 6420 6222 6875 6767 696e 6766  e and b"huggingf
+00006210: 6163 6522 2069 6e20 7365 6c66 2e5f 6461  ace" in self._da
+00006220: 7461 2e73 6368 656d 612e 6d65 7461 6461  ta.schema.metada
+00006230: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+00006240: 6d65 7461 6461 7461 203d 206a 736f 6e2e  metadata = json.
+00006250: 6c6f 6164 7328 7365 6c66 2e5f 6461 7461  loads(self._data
+00006260: 2e73 6368 656d 612e 6d65 7461 6461 7461  .schema.metadata
+00006270: 5b62 2268 7567 6769 6e67 6661 6365 225d  [b"huggingface"]
+00006280: 2e64 6563 6f64 6528 2929 0a20 2020 2020  .decode()).     
+00006290: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+000062a0: 2020 2020 2020 2020 2020 2020 2266 696e              "fin
+000062b0: 6765 7270 7269 6e74 2220 696e 206d 6574  gerprint" in met
+000062c0: 6164 6174 6120 616e 6420 7365 6c66 2e5f  adata and self._
+000062d0: 6669 6e67 6572 7072 696e 7420 6973 204e  fingerprint is N
+000062e0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+000062f0: 293a 2020 2320 7472 7920 746f 206c 6f61  ):  # try to loa
+00006300: 6420 6669 6e67 6572 7072 696e 7420 6672  d fingerprint fr
+00006310: 6f6d 2074 6865 2061 7272 6f77 2066 696c  om the arrow fil
+00006320: 6520 6d65 7461 6461 7461 0a20 2020 2020  e metadata.     
+00006330: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006340: 5f66 696e 6765 7270 7269 6e74 203d 206d  _fingerprint = m
+00006350: 6574 6164 6174 615b 2266 696e 6765 7270  etadata["fingerp
+00006360: 7269 6e74 225d 0a0a 2020 2020 2020 2020  rint"]..        
+00006370: 2320 496e 6665 7220 6665 6174 7572 6573  # Infer features
+00006380: 2069 6620 4e6f 6e65 0a20 2020 2020 2020   if None.       
+00006390: 2069 6e66 6572 7265 645f 6665 6174 7572   inferred_featur
+000063a0: 6573 203d 2046 6561 7475 7265 732e 6672  es = Features.fr
+000063b0: 6f6d 5f61 7272 6f77 5f73 6368 656d 6128  om_arrow_schema(
+000063c0: 6172 726f 775f 7461 626c 652e 7363 6865  arrow_table.sche
+000063d0: 6d61 290a 2020 2020 2020 2020 6966 2073  ma).        if s
+000063e0: 656c 662e 696e 666f 2e66 6561 7475 7265  elf.info.feature
+000063f0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00006400: 2020 2020 2020 2073 656c 662e 696e 666f         self.info
+00006410: 2e66 6561 7475 7265 7320 3d20 696e 6665  .features = infe
+00006420: 7272 6564 5f66 6561 7475 7265 730a 2020  rred_features.  
+00006430: 2020 2020 2020 656c 7365 3a20 2023 206d        else:  # m
+00006440: 616b 6520 7375 7265 2074 6865 206e 6573  ake sure the nes
+00006450: 7465 6420 636f 6c75 6d6e 7320 6172 6520  ted columns are 
+00006460: 696e 2074 6865 2072 6967 6874 206f 7264  in the right ord
+00006470: 6572 0a20 2020 2020 2020 2020 2020 2074  er.            t
+00006480: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00006490: 2020 2020 7365 6c66 2e69 6e66 6f2e 6665      self.info.fe
+000064a0: 6174 7572 6573 203d 2073 656c 662e 696e  atures = self.in
+000064b0: 666f 2e66 6561 7475 7265 732e 7265 6f72  fo.features.reor
+000064c0: 6465 725f 6669 656c 6473 5f61 7328 696e  der_fields_as(in
+000064d0: 6665 7272 6564 5f66 6561 7475 7265 7329  ferred_features)
+000064e0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+000064f0: 6570 7420 5661 6c75 6545 7272 6f72 2061  ept ValueError a
+00006500: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+00006510: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00006520: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00006530: 2020 2020 2020 2020 2020 2066 227b 657d             f"{e}
+00006540: 5c6e 5468 6520 2773 6f75 7263 6527 2066  \nThe 'source' f
+00006550: 6561 7475 7265 7320 636f 6d65 2066 726f  eatures come fro
+00006560: 6d20 6461 7461 7365 745f 696e 666f 2e6a  m dataset_info.j
+00006570: 736f 6e2c 2061 6e64 2074 6865 2027 7461  son, and the 'ta
+00006580: 7267 6574 2720 6f6e 6573 2061 7265 2074  rget' ones are t
+00006590: 686f 7365 206f 6620 7468 6520 6461 7461  hose of the data
+000065a0: 7365 7420 6172 726f 7720 6669 6c65 2e22  set arrow file."
+000065b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000065c0: 2029 0a0a 2020 2020 2020 2020 2320 496e   )..        # In
+000065d0: 6665 7220 6669 6e67 6572 7072 696e 7420  fer fingerprint 
+000065e0: 6966 204e 6f6e 650a 0a20 2020 2020 2020  if None..       
+000065f0: 2069 6620 7365 6c66 2e5f 6669 6e67 6572   if self._finger
+00006600: 7072 696e 7420 6973 204e 6f6e 653a 0a20  print is None:. 
+00006610: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006620: 5f66 696e 6765 7270 7269 6e74 203d 2067  _fingerprint = g
+00006630: 656e 6572 6174 655f 6669 6e67 6572 7072  enerate_fingerpr
+00006640: 696e 7428 7365 6c66 290a 0a20 2020 2020  int(self)..     
+00006650: 2020 2023 2053 616e 6974 7920 6368 6563     # Sanity chec
+00006660: 6b73 0a0a 2020 2020 2020 2020 6966 2073  ks..        if s
+00006670: 656c 662e 6665 6174 7572 6573 2069 7320  elf.features is 
+00006680: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00006690: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+000066a0: 6f72 2822 4665 6174 7572 6573 2063 616e  or("Features can
+000066b0: 2774 2062 6520 4e6f 6e65 2069 6e20 6120  't be None in a 
+000066c0: 4461 7461 7365 7420 6f62 6a65 6374 2229  Dataset object")
+000066d0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000066e0: 2e5f 6669 6e67 6572 7072 696e 7420 6973  ._fingerprint is
+000066f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00006700: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00006710: 726f 7228 2246 696e 6765 7270 7269 6e74  ror("Fingerprint
+00006720: 2063 616e 2774 2062 6520 4e6f 6e65 2069   can't be None i
+00006730: 6e20 6120 4461 7461 7365 7420 6f62 6a65  n a Dataset obje
+00006740: 6374 2229 0a20 2020 2020 2020 2069 6620  ct").        if 
+00006750: 7365 6c66 2e69 6e66 6f2e 6665 6174 7572  self.info.featur
+00006760: 6573 2e74 7970 6520 213d 2069 6e66 6572  es.type != infer
+00006770: 7265 645f 6665 6174 7572 6573 2e74 7970  red_features.typ
+00006780: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00006790: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+000067a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000067b0: 2066 2245 7874 6572 6e61 6c20 6665 6174   f"External feat
+000067c0: 7572 6573 2069 6e66 6f20 646f 6e27 7420  ures info don't 
+000067d0: 6d61 7463 6820 7468 6520 6461 7461 7365  match the datase
+000067e0: 743a 5c6e 476f 745c 6e7b 7365 6c66 2e69  t:\nGot\n{self.i
+000067f0: 6e66 6f2e 6665 6174 7572 6573 7d5c 6e77  nfo.features}\nw
+00006800: 6974 6820 7479 7065 5c6e 7b73 656c 662e  ith type\n{self.
+00006810: 696e 666f 2e66 6561 7475 7265 732e 7479  info.features.ty
+00006820: 7065 7d5c 6e5c 6e62 7574 2065 7870 6563  pe}\n\nbut expec
+00006830: 7465 6420 736f 6d65 7468 696e 6720 6c69  ted something li
+00006840: 6b65 5c6e 7b69 6e66 6572 7265 645f 6665  ke\n{inferred_fe
+00006850: 6174 7572 6573 7d5c 6e77 6974 6820 7479  atures}\nwith ty
+00006860: 7065 5c6e 7b69 6e66 6572 7265 645f 6665  pe\n{inferred_fe
+00006870: 6174 7572 6573 2e74 7970 657d 220a 2020  atures.type}".  
+00006880: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00006890: 2020 2020 2069 6620 7365 6c66 2e5f 696e       if self._in
+000068a0: 6469 6365 7320 6973 206e 6f74 204e 6f6e  dices is not Non
+000068b0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+000068c0: 6620 6e6f 7420 7061 2e74 7970 6573 2e69  f not pa.types.i
+000068d0: 735f 756e 7369 676e 6564 5f69 6e74 6567  s_unsigned_integ
+000068e0: 6572 2873 656c 662e 5f69 6e64 6963 6573  er(self._indices
+000068f0: 2e63 6f6c 756d 6e28 3029 2e74 7970 6529  .column(0).type)
+00006900: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006910: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00006920: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00006930: 2020 2020 2020 2020 6622 696e 6469 6365          f"indice
+00006940: 7320 6d75 7374 2062 6520 616e 2041 7272  s must be an Arr
+00006950: 6f77 2074 6162 6c65 206f 6620 756e 7369  ow table of unsi
+00006960: 676e 6564 2069 6e74 6567 6572 732c 2063  gned integers, c
+00006970: 7572 7265 6e74 2074 7970 6520 6973 207b  urrent type is {
+00006980: 7365 6c66 2e5f 696e 6469 6365 732e 636f  self._indices.co
+00006990: 6c75 6d6e 2830 292e 7479 7065 7d22 0a20  lumn(0).type}". 
+000069a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000069b0: 0a20 2020 2020 2020 205f 6368 6563 6b5f  .        _check_
+000069c0: 636f 6c75 6d6e 5f6e 616d 6573 2873 656c  column_names(sel
+000069d0: 662e 5f64 6174 612e 636f 6c75 6d6e 5f6e  f._data.column_n
+000069e0: 616d 6573 290a 0a20 2020 2020 2020 2073  ames)..        s
+000069f0: 656c 662e 5f64 6174 6120 3d20 7570 6461  elf._data = upda
+00006a00: 7465 5f6d 6574 6164 6174 615f 7769 7468  te_metadata_with
+00006a10: 5f66 6561 7475 7265 7328 7365 6c66 2e5f  _features(self._
+00006a20: 6461 7461 2c20 7365 6c66 2e66 6561 7475  data, self.featu
+00006a30: 7265 7329 0a0a 2020 2020 4063 6c61 7373  res)..    @class
+00006a40: 6d65 7468 6f64 0a20 2020 2064 6566 2066  method.    def f
+00006a50: 726f 6d5f 6669 6c65 280a 2020 2020 2020  rom_file(.      
+00006a60: 2020 636c 732c 0a20 2020 2020 2020 2066    cls,.        f
+00006a70: 696c 656e 616d 653a 2073 7472 2c0a 2020  ilename: str,.  
+00006a80: 2020 2020 2020 696e 666f 3a20 4f70 7469        info: Opti
+00006a90: 6f6e 616c 5b44 6174 6173 6574 496e 666f  onal[DatasetInfo
+00006aa0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00006ab0: 2020 7370 6c69 743a 204f 7074 696f 6e61    split: Optiona
+00006ac0: 6c5b 4e61 6d65 6453 706c 6974 5d20 3d20  l[NamedSplit] = 
+00006ad0: 4e6f 6e65 2c0a 2020 2020 2020 2020 696e  None,.        in
+00006ae0: 6469 6365 735f 6669 6c65 6e61 6d65 3a20  dices_filename: 
+00006af0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00006b00: 4e6f 6e65 2c0a 2020 2020 2020 2020 696e  None,.        in
+00006b10: 5f6d 656d 6f72 793a 2062 6f6f 6c20 3d20  _memory: bool = 
+00006b20: 4661 6c73 652c 0a20 2020 2029 202d 3e20  False,.    ) -> 
+00006b30: 2244 6174 6173 6574 223a 0a20 2020 2020  "Dataset":.     
+00006b40: 2020 2022 2222 496e 7374 616e 7469 6174     """Instantiat
+00006b50: 6520 6120 4461 7461 7365 7420 6261 636b  e a Dataset back
+00006b60: 6564 2062 7920 616e 2041 7272 6f77 2074  ed by an Arrow t
+00006b70: 6162 6c65 2061 7420 6669 6c65 6e61 6d65  able at filename
+00006b80: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00006b90: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00006ba0: 656e 616d 6520 2860 7374 7260 293a 0a20  ename (`str`):. 
+00006bb0: 2020 2020 2020 2020 2020 2020 2020 2046                 F
+00006bc0: 696c 6520 6e61 6d65 206f 6620 7468 6520  ile name of the 
+00006bd0: 6461 7461 7365 742e 0a20 2020 2020 2020  dataset..       
+00006be0: 2020 2020 2069 6e66 6f20 2860 4461 7461       info (`Data
+00006bf0: 7365 7449 6e66 6f60 2c20 2a6f 7074 696f  setInfo`, *optio
+00006c00: 6e61 6c2a 293a 0a20 2020 2020 2020 2020  nal*):.         
+00006c10: 2020 2020 2020 2044 6174 6173 6574 2069         Dataset i
+00006c20: 6e66 6f72 6d61 7469 6f6e 2c20 6c69 6b65  nformation, like
+00006c30: 2064 6573 6372 6970 7469 6f6e 2c20 6369   description, ci
+00006c40: 7461 7469 6f6e 2c20 6574 632e 0a20 2020  tation, etc..   
+00006c50: 2020 2020 2020 2020 2073 706c 6974 2028           split (
+00006c60: 604e 616d 6564 5370 6c69 7460 2c20 2a6f  `NamedSplit`, *o
+00006c70: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
+00006c80: 2020 2020 2020 2020 2020 204e 616d 6520             Name 
+00006c90: 6f66 2074 6865 2064 6174 6173 6574 2073  of the dataset s
+00006ca0: 706c 6974 2e0a 2020 2020 2020 2020 2020  plit..          
+00006cb0: 2020 696e 6469 6365 735f 6669 6c65 6e61    indices_filena
+00006cc0: 6d65 2028 6073 7472 602c 202a 6f70 7469  me (`str`, *opti
+00006cd0: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
+00006ce0: 2020 2020 2020 2020 4669 6c65 206e 616d          File nam
+00006cf0: 6573 206f 6620 7468 6520 696e 6469 6365  es of the indice
+00006d00: 732e 0a20 2020 2020 2020 2020 2020 2069  s..            i
+00006d10: 6e5f 6d65 6d6f 7279 2028 6062 6f6f 6c60  n_memory (`bool`
+00006d20: 2c20 6465 6661 756c 7473 2074 6f20 6046  , defaults to `F
+00006d30: 616c 7365 6029 3a0a 2020 2020 2020 2020  alse`):.        
+00006d40: 2020 2020 2020 2020 5768 6574 6865 7220          Whether 
+00006d50: 746f 2063 6f70 7920 7468 6520 6461 7461  to copy the data
+00006d60: 2069 6e2d 6d65 6d6f 7279 2e0a 0a20 2020   in-memory...   
+00006d70: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
+00006d80: 2020 2020 2020 2020 2020 5b60 4461 7461            [`Data
+00006d90: 7365 7460 5d0a 2020 2020 2020 2020 2222  set`].        ""
+00006da0: 220a 2020 2020 2020 2020 7461 626c 6520  ".        table 
+00006db0: 3d20 4172 726f 7752 6561 6465 722e 7265  = ArrowReader.re
+00006dc0: 6164 5f74 6162 6c65 2866 696c 656e 616d  ad_table(filenam
+00006dd0: 652c 2069 6e5f 6d65 6d6f 7279 3d69 6e5f  e, in_memory=in_
+00006de0: 6d65 6d6f 7279 290a 0a20 2020 2020 2020  memory)..       
+00006df0: 2069 6620 696e 6469 6365 735f 6669 6c65   if indices_file
+00006e00: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
+00006e10: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+00006e20: 6469 6365 735f 7061 5f74 6162 6c65 203d  dices_pa_table =
+00006e30: 2041 7272 6f77 5265 6164 6572 2e72 6561   ArrowReader.rea
+00006e40: 645f 7461 626c 6528 696e 6469 6365 735f  d_table(indices_
+00006e50: 6669 6c65 6e61 6d65 2c20 696e 5f6d 656d  filename, in_mem
+00006e60: 6f72 793d 696e 5f6d 656d 6f72 7929 0a20  ory=in_memory). 
+00006e70: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00006e80: 2020 2020 2020 2020 2069 6e64 6963 6573           indices
+00006e90: 5f70 615f 7461 626c 6520 3d20 4e6f 6e65  _pa_table = None
+00006ea0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00006eb0: 2063 6c73 280a 2020 2020 2020 2020 2020   cls(.          
+00006ec0: 2020 6172 726f 775f 7461 626c 653d 7461    arrow_table=ta
+00006ed0: 626c 652c 0a20 2020 2020 2020 2020 2020  ble,.           
+00006ee0: 2069 6e66 6f3d 696e 666f 2c0a 2020 2020   info=info,.    
+00006ef0: 2020 2020 2020 2020 7370 6c69 743d 7370          split=sp
+00006f00: 6c69 742c 0a20 2020 2020 2020 2020 2020  lit,.           
+00006f10: 2069 6e64 6963 6573 5f74 6162 6c65 3d69   indices_table=i
+00006f20: 6e64 6963 6573 5f70 615f 7461 626c 652c  ndices_pa_table,
+00006f30: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00006f40: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00006f50: 2064 6566 2066 726f 6d5f 6275 6666 6572   def from_buffer
+00006f60: 280a 2020 2020 2020 2020 636c 732c 0a20  (.        cls,. 
+00006f70: 2020 2020 2020 2062 7566 6665 723a 2070         buffer: p
+00006f80: 612e 4275 6666 6572 2c0a 2020 2020 2020  a.Buffer,.      
+00006f90: 2020 696e 666f 3a20 4f70 7469 6f6e 616c    info: Optional
+00006fa0: 5b44 6174 6173 6574 496e 666f 5d20 3d20  [DatasetInfo] = 
+00006fb0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7370  None,.        sp
+00006fc0: 6c69 743a 204f 7074 696f 6e61 6c5b 4e61  lit: Optional[Na
+00006fd0: 6d65 6453 706c 6974 5d20 3d20 4e6f 6e65  medSplit] = None
+00006fe0: 2c0a 2020 2020 2020 2020 696e 6469 6365  ,.        indice
+00006ff0: 735f 6275 6666 6572 3a20 4f70 7469 6f6e  s_buffer: Option
+00007000: 616c 5b70 612e 4275 6666 6572 5d20 3d20  al[pa.Buffer] = 
+00007010: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 2022  None,.    ) -> "
+00007020: 4461 7461 7365 7422 3a0a 2020 2020 2020  Dataset":.      
+00007030: 2020 2222 2249 6e73 7461 6e74 6961 7465    """Instantiate
+00007040: 2061 2044 6174 6173 6574 2062 6163 6b65   a Dataset backe
+00007050: 6420 6279 2061 6e20 4172 726f 7720 6275  d by an Arrow bu
+00007060: 6666 6572 2e0a 0a20 2020 2020 2020 2041  ffer...        A
+00007070: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00007080: 2062 7566 6665 7220 2860 7079 6172 726f   buffer (`pyarro
+00007090: 772e 4275 6666 6572 6029 3a0a 2020 2020  w.Buffer`):.    
+000070a0: 2020 2020 2020 2020 2020 2020 4172 726f              Arro
+000070b0: 7720 6275 6666 6572 2e0a 2020 2020 2020  w buffer..      
+000070c0: 2020 2020 2020 696e 666f 2028 6044 6174        info (`Dat
+000070d0: 6173 6574 496e 666f 602c 202a 6f70 7469  asetInfo`, *opti
+000070e0: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
+000070f0: 2020 2020 2020 2020 4461 7461 7365 7420          Dataset 
+00007100: 696e 666f 726d 6174 696f 6e2c 206c 696b  information, lik
+00007110: 6520 6465 7363 7269 7074 696f 6e2c 2063  e description, c
+00007120: 6974 6174 696f 6e2c 2065 7463 2e0a 2020  itation, etc..  
+00007130: 2020 2020 2020 2020 2020 7370 6c69 7420            split 
+00007140: 2860 4e61 6d65 6453 706c 6974 602c 202a  (`NamedSplit`, *
+00007150: 6f70 7469 6f6e 616c 2a29 3a0a 2020 2020  optional*):.    
+00007160: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
+00007170: 206f 6620 7468 6520 6461 7461 7365 7420   of the dataset 
+00007180: 7370 6c69 742e 0a20 2020 2020 2020 2020  split..         
+00007190: 2020 2069 6e64 6963 6573 5f62 7566 6665     indices_buffe
+000071a0: 7220 2860 7079 6172 726f 772e 4275 6666  r (`pyarrow.Buff
+000071b0: 6572 602c 202a 6f70 7469 6f6e 616c 2a29  er`, *optional*)
+000071c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000071d0: 2020 496e 6469 6365 7320 4172 726f 7720    Indices Arrow 
+000071e0: 6275 6666 6572 2e0a 0a20 2020 2020 2020  buffer...       
+000071f0: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
+00007200: 2020 2020 2020 5b60 4461 7461 7365 7460        [`Dataset`
+00007210: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
+00007220: 2020 2020 2020 7461 626c 6520 3d20 496e        table = In
+00007230: 4d65 6d6f 7279 5461 626c 652e 6672 6f6d  MemoryTable.from
+00007240: 5f62 7566 6665 7228 6275 6666 6572 290a  _buffer(buffer).
+00007250: 0a20 2020 2020 2020 2069 6620 696e 6469  .        if indi
+00007260: 6365 735f 6275 6666 6572 2069 7320 6e6f  ces_buffer is no
+00007270: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00007280: 2020 2020 696e 6469 6365 735f 7461 626c      indices_tabl
+00007290: 6520 3d20 496e 4d65 6d6f 7279 5461 626c  e = InMemoryTabl
+000072a0: 652e 6672 6f6d 5f62 7566 6665 7228 6275  e.from_buffer(bu
+000072b0: 6666 6572 290a 2020 2020 2020 2020 656c  ffer).        el
+000072c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000072d0: 696e 6469 6365 735f 7461 626c 6520 3d20  indices_table = 
+000072e0: 4e6f 6e65 0a0a 2020 2020 2020 2020 7265  None..        re
+000072f0: 7475 726e 2063 6c73 2874 6162 6c65 2c20  turn cls(table, 
+00007300: 696e 666f 3d69 6e66 6f2c 2073 706c 6974  info=info, split
+00007310: 3d73 706c 6974 2c20 696e 6469 6365 735f  =split, indices_
+00007320: 7461 626c 653d 696e 6469 6365 735f 7461  table=indices_ta
+00007330: 626c 6529 0a0a 2020 2020 4063 6c61 7373  ble)..    @class
+00007340: 6d65 7468 6f64 0a20 2020 2064 6566 2066  method.    def f
+00007350: 726f 6d5f 7061 6e64 6173 280a 2020 2020  rom_pandas(.    
+00007360: 2020 2020 636c 732c 0a20 2020 2020 2020      cls,.       
+00007370: 2064 663a 2070 642e 4461 7461 4672 616d   df: pd.DataFram
+00007380: 652c 0a20 2020 2020 2020 2066 6561 7475  e,.        featu
+00007390: 7265 733a 204f 7074 696f 6e61 6c5b 4665  res: Optional[Fe
+000073a0: 6174 7572 6573 5d20 3d20 4e6f 6e65 2c0a  atures] = None,.
+000073b0: 2020 2020 2020 2020 696e 666f 3a20 4f70          info: Op
+000073c0: 7469 6f6e 616c 5b44 6174 6173 6574 496e  tional[DatasetIn
+000073d0: 666f 5d20 3d20 4e6f 6e65 2c0a 2020 2020  fo] = None,.    
+000073e0: 2020 2020 7370 6c69 743a 204f 7074 696f      split: Optio
+000073f0: 6e61 6c5b 4e61 6d65 6453 706c 6974 5d20  nal[NamedSplit] 
+00007400: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00007410: 7072 6573 6572 7665 5f69 6e64 6578 3a20  preserve_index: 
+00007420: 4f70 7469 6f6e 616c 5b62 6f6f 6c5d 203d  Optional[bool] =
+00007430: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
+00007440: 2244 6174 6173 6574 223a 0a20 2020 2020  "Dataset":.     
+00007450: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
+00007460: 6f6e 7665 7274 2060 7061 6e64 6173 2e44  onvert `pandas.D
+00007470: 6174 6146 7261 6d65 6020 746f 2061 2060  ataFrame` to a `
+00007480: 7079 6172 726f 772e 5461 626c 6560 2074  pyarrow.Table` t
+00007490: 6f20 6372 6561 7465 2061 205b 6044 6174  o create a [`Dat
+000074a0: 6173 6574 605d 2e0a 0a20 2020 2020 2020  aset`]...       
+000074b0: 2054 6865 2063 6f6c 756d 6e20 7479 7065   The column type
+000074c0: 7320 696e 2074 6865 2072 6573 756c 7469  s in the resulti
+000074d0: 6e67 2041 7272 6f77 2054 6162 6c65 2061  ng Arrow Table a
+000074e0: 7265 2069 6e66 6572 7265 6420 6672 6f6d  re inferred from
+000074f0: 2074 6865 2064 7479 7065 7320 6f66 2074   the dtypes of t
+00007500: 6865 2060 7061 6e64 6173 2e53 6572 6965  he `pandas.Serie
+00007510: 7360 2069 6e20 7468 650a 2020 2020 2020  s` in the.      
+00007520: 2020 4461 7461 4672 616d 652e 2049 6e20    DataFrame. In 
+00007530: 7468 6520 6361 7365 206f 6620 6e6f 6e2d  the case of non-
+00007540: 6f62 6a65 6374 2053 6572 6965 732c 2074  object Series, t
+00007550: 6865 204e 756d 5079 2064 7479 7065 2069  he NumPy dtype i
+00007560: 7320 7472 616e 736c 6174 6564 2074 6f20  s translated to 
+00007570: 6974 7320 4172 726f 7720 6571 7569 7661  its Arrow equiva
+00007580: 6c65 6e74 2e20 496e 2074 6865 0a20 2020  lent. In the.   
+00007590: 2020 2020 2063 6173 6520 6f66 2060 6f62       case of `ob
+000075a0: 6a65 6374 602c 2077 6520 6e65 6564 2074  ject`, we need t
+000075b0: 6f20 6775 6573 7320 7468 6520 6461 7461  o guess the data
+000075c0: 7479 7065 2062 7920 6c6f 6f6b 696e 6720  type by looking 
+000075d0: 6174 2074 6865 2050 7974 686f 6e20 6f62  at the Python ob
+000075e0: 6a65 6374 7320 696e 2074 6869 7320 5365  jects in this Se
+000075f0: 7269 6573 2e0a 0a20 2020 2020 2020 2042  ries...        B
+00007600: 6520 6177 6172 6520 7468 6174 2053 6572  e aware that Ser
+00007610: 6965 7320 6f66 2074 6865 2060 6f62 6a65  ies of the `obje
+00007620: 6374 6020 6474 7970 6520 646f 6e27 7420  ct` dtype don't 
+00007630: 6361 7272 7920 656e 6f75 6768 2069 6e66  carry enough inf
+00007640: 6f72 6d61 7469 6f6e 2074 6f20 616c 7761  ormation to alwa
+00007650: 7973 206c 6561 6420 746f 2061 206d 6561  ys lead to a mea
+00007660: 6e69 6e67 6675 6c20 4172 726f 770a 2020  ningful Arrow.  
+00007670: 2020 2020 2020 7479 7065 2e20 496e 2074        type. In t
+00007680: 6865 2063 6173 6520 7468 6174 2077 6520  he case that we 
+00007690: 6361 6e6e 6f74 2069 6e66 6572 2061 2074  cannot infer a t
+000076a0: 7970 652c 2065 2e67 2e20 6265 6361 7573  ype, e.g. becaus
+000076b0: 6520 7468 6520 4461 7461 4672 616d 6520  e the DataFrame 
+000076c0: 6973 206f 6620 6c65 6e67 7468 2030 206f  is of length 0 o
+000076d0: 7220 7468 6520 5365 7269 6573 206f 6e6c  r the Series onl
+000076e0: 790a 2020 2020 2020 2020 636f 6e74 6169  y.        contai
+000076f0: 6e73 2060 4e6f 6e65 2f6e 616e 6020 6f62  ns `None/nan` ob
+00007700: 6a65 6374 732c 2074 6865 2074 7970 6520  jects, the type 
+00007710: 6973 2073 6574 2074 6f20 606e 756c 6c60  is set to `null`
+00007720: 2e20 5468 6973 2062 6568 6176 696f 7220  . This behavior 
+00007730: 6361 6e20 6265 2061 766f 6964 6564 2062  can be avoided b
+00007740: 7920 636f 6e73 7472 7563 7469 6e67 2065  y constructing e
+00007750: 7870 6c69 6369 740a 2020 2020 2020 2020  xplicit.        
+00007760: 6665 6174 7572 6573 2061 6e64 2070 6173  features and pas
+00007770: 7369 6e67 2069 7420 746f 2074 6869 7320  sing it to this 
+00007780: 6675 6e63 7469 6f6e 2e0a 0a20 2020 2020  function...     
+00007790: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+000077a0: 2020 2020 2064 6620 2860 7061 6e64 6173       df (`pandas
+000077b0: 2e44 6174 6146 7261 6d65 6029 3a0a 2020  .DataFrame`):.  
+000077c0: 2020 2020 2020 2020 2020 2020 2020 4461                Da
+000077d0: 7461 6672 616d 6520 7468 6174 2063 6f6e  taframe that con
+000077e0: 7461 696e 7320 7468 6520 6461 7461 7365  tains the datase
+000077f0: 742e 0a20 2020 2020 2020 2020 2020 2066  t..            f
+00007800: 6561 7475 7265 7320 285b 6046 6561 7475  eatures ([`Featu
+00007810: 7265 7360 5d2c 202a 6f70 7469 6f6e 616c  res`], *optional
+00007820: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
+00007830: 2020 2020 4461 7461 7365 7420 6665 6174      Dataset feat
+00007840: 7572 6573 2e0a 2020 2020 2020 2020 2020  ures..          
+00007850: 2020 696e 666f 2028 6044 6174 6173 6574    info (`Dataset
+00007860: 496e 666f 602c 202a 6f70 7469 6f6e 616c  Info`, *optional
+00007870: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
+00007880: 2020 2020 4461 7461 7365 7420 696e 666f      Dataset info
+00007890: 726d 6174 696f 6e2c 206c 696b 6520 6465  rmation, like de
+000078a0: 7363 7269 7074 696f 6e2c 2063 6974 6174  scription, citat
+000078b0: 696f 6e2c 2065 7463 2e0a 2020 2020 2020  ion, etc..      
+000078c0: 2020 2020 2020 7370 6c69 7420 2860 4e61        split (`Na
+000078d0: 6d65 6453 706c 6974 602c 202a 6f70 7469  medSplit`, *opti
+000078e0: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
+000078f0: 2020 2020 2020 2020 4e61 6d65 206f 6620          Name of 
+00007900: 7468 6520 6461 7461 7365 7420 7370 6c69  the dataset spli
+00007910: 742e 0a20 2020 2020 2020 2020 2020 2070  t..            p
+00007920: 7265 7365 7276 655f 696e 6465 7820 2860  reserve_index (`
+00007930: 626f 6f6c 602c 202a 6f70 7469 6f6e 616c  bool`, *optional
+00007940: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
+00007950: 2020 2020 5768 6574 6865 7220 746f 2073      Whether to s
+00007960: 746f 7265 2074 6865 2069 6e64 6578 2061  tore the index a
+00007970: 7320 616e 2061 6464 6974 696f 6e61 6c20  s an additional 
+00007980: 636f 6c75 6d6e 2069 6e20 7468 6520 7265  column in the re
+00007990: 7375 6c74 696e 6720 4461 7461 7365 742e  sulting Dataset.
+000079a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000079b0: 2054 6865 2064 6566 6175 6c74 206f 6620   The default of 
+000079c0: 604e 6f6e 6560 2077 696c 6c20 7374 6f72  `None` will stor
+000079d0: 6520 7468 6520 696e 6465 7820 6173 2061  e the index as a
+000079e0: 2063 6f6c 756d 6e2c 2065 7863 6570 7420   column, except 
+000079f0: 666f 7220 6052 616e 6765 496e 6465 7860  for `RangeIndex`
+00007a00: 2077 6869 6368 2069 7320 7374 6f72 6564   which is stored
+00007a10: 2061 7320 6d65 7461 6461 7461 206f 6e6c   as metadata onl
+00007a20: 792e 0a20 2020 2020 2020 2020 2020 2020  y..             
+00007a30: 2020 2055 7365 2060 7072 6573 6572 7665     Use `preserve
+00007a40: 5f69 6e64 6578 3d54 7275 6560 2074 6f20  _index=True` to 
+00007a50: 666f 7263 6520 6974 2074 6f20 6265 2073  force it to be s
+00007a60: 746f 7265 6420 6173 2061 2063 6f6c 756d  tored as a colum
+00007a70: 6e2e 0a0a 2020 2020 2020 2020 5265 7475  n...        Retu
+00007a80: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
+00007a90: 205b 6044 6174 6173 6574 605d 0a0a 2020   [`Dataset`]..  
+00007aa0: 2020 2020 2020 4578 616d 706c 653a 0a0a        Example:..
+00007ab0: 2020 2020 2020 2020 6060 6070 790a 2020          ```py.  
+00007ac0: 2020 2020 2020 3e3e 3e20 6473 203d 2044        >>> ds = D
+00007ad0: 6174 6173 6574 2e66 726f 6d5f 7061 6e64  ataset.from_pand
+00007ae0: 6173 2864 6629 0a20 2020 2020 2020 2060  as(df).        `
+00007af0: 6060 0a20 2020 2020 2020 2022 2222 0a20  ``.        """. 
+00007b00: 2020 2020 2020 2069 6620 696e 666f 2069         if info i
+00007b10: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2066  s not None and f
+00007b20: 6561 7475 7265 7320 6973 206e 6f74 204e  eatures is not N
+00007b30: 6f6e 6520 616e 6420 696e 666f 2e66 6561  one and info.fea
+00007b40: 7475 7265 7320 213d 2066 6561 7475 7265  tures != feature
+00007b50: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+00007b60: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00007b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007b80: 2066 2246 6561 7475 7265 7320 7370 6563   f"Features spec
+00007b90: 6966 6965 6420 696e 2060 6665 6174 7572  ified in `featur
+00007ba0: 6573 6020 616e 6420 6069 6e66 6f2e 6665  es` and `info.fe
+00007bb0: 6174 7572 6573 6020 6361 6e27 7420 6265  atures` can't be
+00007bc0: 2064 6966 6665 7265 6e74 3a5c 6e7b 6665   different:\n{fe
+00007bd0: 6174 7572 6573 7d5c 6e7b 696e 666f 2e66  atures}\n{info.f
+00007be0: 6561 7475 7265 737d 220a 2020 2020 2020  eatures}".      
+00007bf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00007c00: 6665 6174 7572 6573 203d 2066 6561 7475  features = featu
+00007c10: 7265 7320 6966 2066 6561 7475 7265 7320  res if features 
+00007c20: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
+00007c30: 2069 6e66 6f2e 6665 6174 7572 6573 2069   info.features i
+00007c40: 6620 696e 666f 2069 7320 6e6f 7420 4e6f  f info is not No
+00007c50: 6e65 2065 6c73 6520 4e6f 6e65 0a20 2020  ne else None.   
+00007c60: 2020 2020 2069 6620 696e 666f 2069 7320       if info is 
+00007c70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00007c80: 2020 696e 666f 203d 2044 6174 6173 6574    info = Dataset
+00007c90: 496e 666f 2829 0a20 2020 2020 2020 2069  Info().        i
+00007ca0: 6e66 6f2e 6665 6174 7572 6573 203d 2066  nfo.features = f
+00007cb0: 6561 7475 7265 730a 2020 2020 2020 2020  eatures.        
+00007cc0: 7461 626c 6520 3d20 496e 4d65 6d6f 7279  table = InMemory
+00007cd0: 5461 626c 652e 6672 6f6d 5f70 616e 6461  Table.from_panda
+00007ce0: 7328 0a20 2020 2020 2020 2020 2020 2064  s(.            d
+00007cf0: 663d 6466 2c0a 2020 2020 2020 2020 2020  f=df,.          
+00007d00: 2020 7072 6573 6572 7665 5f69 6e64 6578    preserve_index
+00007d10: 3d70 7265 7365 7276 655f 696e 6465 782c  =preserve_index,
+00007d20: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00007d30: 2020 2069 6620 6665 6174 7572 6573 2069     if features i
+00007d40: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00007d50: 2020 2020 2020 2020 2320 6d6f 7265 2065          # more e
+00007d60: 7870 656e 7369 7665 2063 6173 7420 7468  xpensive cast th
+00007d70: 616e 2049 6e4d 656d 6f72 7954 6162 6c65  an InMemoryTable
+00007d80: 2e66 726f 6d5f 7061 6e64 6173 282e 2e2e  .from_pandas(...
+00007d90: 2c20 7363 6865 6d61 3d66 6561 7475 7265  , schema=feature
+00007da0: 732e 6172 726f 775f 7363 6865 6d61 290a  s.arrow_schema).
+00007db0: 2020 2020 2020 2020 2020 2020 2320 6e65              # ne
+00007dc0: 6564 6564 2074 6f20 7375 7070 6f72 7420  eded to support 
+00007dd0: 7468 6520 7374 7220 746f 2041 7564 696f  the str to Audio
+00007de0: 2063 6f6e 7665 7273 696f 6e20 666f 7220   conversion for 
+00007df0: 696e 7374 616e 6365 0a20 2020 2020 2020  instance.       
+00007e00: 2020 2020 2074 6162 6c65 203d 2074 6162       table = tab
+00007e10: 6c65 2e63 6173 7428 6665 6174 7572 6573  le.cast(features
+00007e20: 2e61 7272 6f77 5f73 6368 656d 6129 0a20  .arrow_schema). 
+00007e30: 2020 2020 2020 2072 6574 7572 6e20 636c         return cl
+00007e40: 7328 7461 626c 652c 2069 6e66 6f3d 696e  s(table, info=in
+00007e50: 666f 2c20 7370 6c69 743d 7370 6c69 7429  fo, split=split)
+00007e60: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00007e70: 6f64 0a20 2020 2064 6566 2066 726f 6d5f  od.    def from_
+00007e80: 6469 6374 280a 2020 2020 2020 2020 636c  dict(.        cl
+00007e90: 732c 0a20 2020 2020 2020 206d 6170 7069  s,.        mappi
+00007ea0: 6e67 3a20 6469 6374 2c0a 2020 2020 2020  ng: dict,.      
+00007eb0: 2020 6665 6174 7572 6573 3a20 4f70 7469    features: Opti
+00007ec0: 6f6e 616c 5b46 6561 7475 7265 735d 203d  onal[Features] =
+00007ed0: 204e 6f6e 652c 0a20 2020 2020 2020 2069   None,.        i
+00007ee0: 6e66 6f3a 204f 7074 696f 6e61 6c5b 4461  nfo: Optional[Da
+00007ef0: 7461 7365 7449 6e66 6f5d 203d 204e 6f6e  tasetInfo] = Non
+00007f00: 652c 0a20 2020 2020 2020 2073 706c 6974  e,.        split
+00007f10: 3a20 4f70 7469 6f6e 616c 5b4e 616d 6564  : Optional[Named
+00007f20: 5370 6c69 745d 203d 204e 6f6e 652c 0a20  Split] = None,. 
+00007f30: 2020 2029 202d 3e20 2244 6174 6173 6574     ) -> "Dataset
+00007f40: 223a 0a20 2020 2020 2020 2022 2222 0a20  ":.        """. 
+00007f50: 2020 2020 2020 2043 6f6e 7665 7274 2060         Convert `
+00007f60: 6469 6374 6020 746f 2061 2060 7079 6172  dict` to a `pyar
+00007f70: 726f 772e 5461 626c 6560 2074 6f20 6372  row.Table` to cr
+00007f80: 6561 7465 2061 205b 6044 6174 6173 6574  eate a [`Dataset
+00007f90: 605d 2e0a 0a20 2020 2020 2020 2041 7267  `]...        Arg
+00007fa0: 733a 0a20 2020 2020 2020 2020 2020 206d  s:.            m
+00007fb0: 6170 7069 6e67 2028 604d 6170 7069 6e67  apping (`Mapping
+00007fc0: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
+00007fd0: 2020 2020 4d61 7070 696e 6720 6f66 2073      Mapping of s
+00007fe0: 7472 696e 6773 2074 6f20 4172 7261 7973  trings to Arrays
+00007ff0: 206f 7220 5079 7468 6f6e 206c 6973 7473   or Python lists
+00008000: 2e0a 2020 2020 2020 2020 2020 2020 6665  ..            fe
+00008010: 6174 7572 6573 2028 5b60 4665 6174 7572  atures ([`Featur
+00008020: 6573 605d 2c20 2a6f 7074 696f 6e61 6c2a  es`], *optional*
+00008030: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00008040: 2020 2044 6174 6173 6574 2066 6561 7475     Dataset featu
+00008050: 7265 732e 0a20 2020 2020 2020 2020 2020  res..           
+00008060: 2069 6e66 6f20 2860 4461 7461 7365 7449   info (`DatasetI
+00008070: 6e66 6f60 2c20 2a6f 7074 696f 6e61 6c2a  nfo`, *optional*
+00008080: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00008090: 2020 2044 6174 6173 6574 2069 6e66 6f72     Dataset infor
+000080a0: 6d61 7469 6f6e 2c20 6c69 6b65 2064 6573  mation, like des
+000080b0: 6372 6970 7469 6f6e 2c20 6369 7461 7469  cription, citati
+000080c0: 6f6e 2c20 6574 632e 0a20 2020 2020 2020  on, etc..       
+000080d0: 2020 2020 2073 706c 6974 2028 604e 616d       split (`Nam
+000080e0: 6564 5370 6c69 7460 2c20 2a6f 7074 696f  edSplit`, *optio
+000080f0: 6e61 6c2a 293a 0a20 2020 2020 2020 2020  nal*):.         
+00008100: 2020 2020 2020 204e 616d 6520 6f66 2074         Name of t
+00008110: 6865 2064 6174 6173 6574 2073 706c 6974  he dataset split
+00008120: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00008130: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00008140: 5b60 4461 7461 7365 7460 5d0a 2020 2020  [`Dataset`].    
+00008150: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00008160: 6966 2069 6e66 6f20 6973 206e 6f74 204e  if info is not N
+00008170: 6f6e 6520 616e 6420 6665 6174 7572 6573  one and features
+00008180: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00008190: 2069 6e66 6f2e 6665 6174 7572 6573 2021   info.features !
+000081a0: 3d20 6665 6174 7572 6573 3a0a 2020 2020  = features:.    
+000081b0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+000081c0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+000081d0: 2020 2020 2020 2020 2020 6622 4665 6174            f"Feat
+000081e0: 7572 6573 2073 7065 6369 6669 6564 2069  ures specified i
+000081f0: 6e20 6066 6561 7475 7265 7360 2061 6e64  n `features` and
+00008200: 2060 696e 666f 2e66 6561 7475 7265 7360   `info.features`
+00008210: 2063 616e 2774 2062 6520 6469 6666 6572   can't be differ
+00008220: 656e 743a 5c6e 7b66 6561 7475 7265 737d  ent:\n{features}
+00008230: 5c6e 7b69 6e66 6f2e 6665 6174 7572 6573  \n{info.features
+00008240: 7d22 0a20 2020 2020 2020 2020 2020 2029  }".            )
+00008250: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
+00008260: 7320 3d20 6665 6174 7572 6573 2069 6620  s = features if 
+00008270: 6665 6174 7572 6573 2069 7320 6e6f 7420  features is not 
+00008280: 4e6f 6e65 2065 6c73 6520 696e 666f 2e66  None else info.f
+00008290: 6561 7475 7265 7320 6966 2069 6e66 6f20  eatures if info 
+000082a0: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
+000082b0: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
+000082c0: 2069 6e66 6f20 6973 204e 6f6e 653a 0a20   info is None:. 
+000082d0: 2020 2020 2020 2020 2020 2069 6e66 6f20             info 
+000082e0: 3d20 4461 7461 7365 7449 6e66 6f28 290a  = DatasetInfo().
+000082f0: 2020 2020 2020 2020 696e 666f 2e66 6561          info.fea
+00008300: 7475 7265 7320 3d20 6665 6174 7572 6573  tures = features
+00008310: 0a20 2020 2020 2020 2069 6620 6665 6174  .        if feat
+00008320: 7572 6573 2069 7320 6e6f 7420 4e6f 6e65  ures is not None
+00008330: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
+00008340: 7070 696e 6720 3d20 6665 6174 7572 6573  pping = features
+00008350: 2e65 6e63 6f64 655f 6261 7463 6828 6d61  .encode_batch(ma
+00008360: 7070 696e 6729 0a20 2020 2020 2020 206d  pping).        m
+00008370: 6170 7069 6e67 203d 207b 0a20 2020 2020  apping = {.     
+00008380: 2020 2020 2020 2063 6f6c 3a20 4f70 7469         col: Opti
+00008390: 6d69 7a65 6454 7970 6564 5365 7175 656e  mizedTypedSequen
+000083a0: 6365 2864 6174 612c 2074 7970 653d 6665  ce(data, type=fe
+000083b0: 6174 7572 6573 5b63 6f6c 5d20 6966 2066  atures[col] if f
+000083c0: 6561 7475 7265 7320 6973 206e 6f74 204e  eatures is not N
+000083d0: 6f6e 6520 656c 7365 204e 6f6e 652c 2063  one else None, c
+000083e0: 6f6c 3d63 6f6c 290a 2020 2020 2020 2020  ol=col).        
+000083f0: 2020 2020 666f 7220 636f 6c2c 2064 6174      for col, dat
+00008400: 6120 696e 206d 6170 7069 6e67 2e69 7465  a in mapping.ite
+00008410: 6d73 2829 0a20 2020 2020 2020 207d 0a20  ms().        }. 
+00008420: 2020 2020 2020 2070 615f 7461 626c 6520         pa_table 
+00008430: 3d20 496e 4d65 6d6f 7279 5461 626c 652e  = InMemoryTable.
+00008440: 6672 6f6d 5f70 7964 6963 7428 6d61 7070  from_pydict(mapp
+00008450: 696e 673d 6d61 7070 696e 6729 0a20 2020  ing=mapping).   
+00008460: 2020 2020 2069 6620 696e 666f 2e66 6561       if info.fea
+00008470: 7475 7265 7320 6973 204e 6f6e 653a 0a20  tures is None:. 
+00008480: 2020 2020 2020 2020 2020 2069 6e66 6f2e             info.
+00008490: 6665 6174 7572 6573 203d 2046 6561 7475  features = Featu
+000084a0: 7265 7328 7b63 6f6c 3a20 7473 2e67 6574  res({col: ts.get
+000084b0: 5f69 6e66 6572 7265 645f 7479 7065 2829  _inferred_type()
+000084c0: 2066 6f72 2063 6f6c 2c20 7473 2069 6e20   for col, ts in 
+000084d0: 6d61 7070 696e 672e 6974 656d 7328 297d  mapping.items()}
+000084e0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000084f0: 2063 6c73 2870 615f 7461 626c 652c 2069   cls(pa_table, i
+00008500: 6e66 6f3d 696e 666f 2c20 7370 6c69 743d  nfo=info, split=
+00008510: 7370 6c69 7429 0a0a 2020 2020 4063 6c61  split)..    @cla
+00008520: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00008530: 2066 726f 6d5f 6c69 7374 280a 2020 2020   from_list(.    
+00008540: 2020 2020 636c 732c 0a20 2020 2020 2020      cls,.       
+00008550: 206d 6170 7069 6e67 3a20 4c69 7374 5b64   mapping: List[d
+00008560: 6963 745d 2c0a 2020 2020 2020 2020 6665  ict],.        fe
+00008570: 6174 7572 6573 3a20 4f70 7469 6f6e 616c  atures: Optional
+00008580: 5b46 6561 7475 7265 735d 203d 204e 6f6e  [Features] = Non
+00008590: 652c 0a20 2020 2020 2020 2069 6e66 6f3a  e,.        info:
+000085a0: 204f 7074 696f 6e61 6c5b 4461 7461 7365   Optional[Datase
+000085b0: 7449 6e66 6f5d 203d 204e 6f6e 652c 0a20  tInfo] = None,. 
+000085c0: 2020 2020 2020 2073 706c 6974 3a20 4f70         split: Op
+000085d0: 7469 6f6e 616c 5b4e 616d 6564 5370 6c69  tional[NamedSpli
+000085e0: 745d 203d 204e 6f6e 652c 0a20 2020 2029  t] = None,.    )
+000085f0: 202d 3e20 2244 6174 6173 6574 223a 0a20   -> "Dataset":. 
+00008600: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00008610: 2020 2043 6f6e 7665 7274 2061 206c 6973     Convert a lis
+00008620: 7420 6f66 2064 6963 7473 2074 6f20 6120  t of dicts to a 
+00008630: 6070 7961 7272 6f77 2e54 6162 6c65 6020  `pyarrow.Table` 
+00008640: 746f 2063 7265 6174 6520 6120 3a63 6c61  to create a :cla
+00008650: 7373 3a60 4461 7461 7365 7460 2e0a 0a20  ss:`Dataset`... 
+00008660: 2020 2020 2020 204e 6f74 6520 7468 6174         Note that
+00008670: 2074 6865 206b 6579 7320 6f66 2074 6865   the keys of the
+00008680: 2066 6972 7374 2065 6e74 7279 2077 696c   first entry wil
+00008690: 6c20 6265 2075 7365 6420 746f 2064 6574  l be used to det
+000086a0: 6572 6d69 6e65 2074 6865 2064 6174 6173  ermine the datas
+000086b0: 6574 2063 6f6c 756d 6e73 2c0a 2020 2020  et columns,.    
+000086c0: 2020 2020 7265 6761 7264 6c65 7373 206f      regardless o
+000086d0: 6620 7768 6174 2069 7320 7061 7373 6564  f what is passed
+000086e0: 2074 6f20 6665 6174 7572 6573 2e0a 0a20   to features... 
+000086f0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00008700: 2020 2020 2020 2020 206d 6170 7069 6e67           mapping
+00008710: 2028 604c 6973 745b 6469 6374 5d60 293a   (`List[dict]`):
+00008720: 2041 206c 6973 7420 6f66 206d 6170 7069   A list of mappi
+00008730: 6e67 7320 6f66 2073 7472 696e 6773 2074  ngs of strings t
+00008740: 6f20 726f 7720 7661 6c75 6573 2e0a 2020  o row values..  
+00008750: 2020 2020 2020 2020 2020 6665 6174 7572            featur
+00008760: 6573 2028 3a63 6c61 7373 3a60 4665 6174  es (:class:`Feat
+00008770: 7572 6573 602c 206f 7074 696f 6e61 6c29  ures`, optional)
+00008780: 3a20 4461 7461 7365 7420 6665 6174 7572  : Dataset featur
+00008790: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
+000087a0: 696e 666f 2028 3a63 6c61 7373 3a60 4461  info (:class:`Da
+000087b0: 7461 7365 7449 6e66 6f60 2c20 6f70 7469  tasetInfo`, opti
+000087c0: 6f6e 616c 293a 2044 6174 6173 6574 2069  onal): Dataset i
+000087d0: 6e66 6f72 6d61 7469 6f6e 2c20 6c69 6b65  nformation, like
+000087e0: 2064 6573 6372 6970 7469 6f6e 2c20 6369   description, ci
+000087f0: 7461 7469 6f6e 2c20 6574 632e 0a20 2020  tation, etc..   
+00008800: 2020 2020 2020 2020 2073 706c 6974 2028           split (
+00008810: 3a63 6c61 7373 3a60 4e61 6d65 6453 706c  :class:`NamedSpl
+00008820: 6974 602c 206f 7074 696f 6e61 6c29 3a20  it`, optional): 
+00008830: 4e61 6d65 206f 6620 7468 6520 6461 7461  Name of the data
+00008840: 7365 7420 7370 6c69 742e 0a0a 2020 2020  set split...    
+00008850: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+00008860: 2020 2020 2020 2020 203a 636c 6173 733a           :class:
+00008870: 6044 6174 6173 6574 600a 2020 2020 2020  `Dataset`.      
+00008880: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
+00008890: 666f 7220 7369 6d70 6c69 6369 7479 2061  for simplicity a
+000088a0: 6e64 2063 6f6e 7369 7374 656e 6379 2077  nd consistency w
+000088b0: 7274 204f 7074 696d 697a 6564 5479 7065  rt OptimizedType
+000088c0: 6453 6571 7565 6e63 6520 7765 2064 6f20  dSequence we do 
+000088d0: 6e6f 7420 7573 6520 496e 4d65 6d6f 7279  not use InMemory
+000088e0: 5461 626c 652e 6672 6f6d 5f70 796c 6973  Table.from_pylis
+000088f0: 7420 6865 7265 0a20 2020 2020 2020 206d  t here.        m
+00008900: 6170 7069 6e67 203d 207b 6b3a 205b 722e  apping = {k: [r.
+00008910: 6765 7428 6b29 2066 6f72 2072 2069 6e20  get(k) for r in 
+00008920: 6d61 7070 696e 675d 2066 6f72 206b 2069  mapping] for k i
+00008930: 6e20 6d61 7070 696e 675b 305d 7d20 6966  n mapping[0]} if
+00008940: 206d 6170 7069 6e67 2065 6c73 6520 7b7d   mapping else {}
+00008950: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00008960: 636c 732e 6672 6f6d 5f64 6963 7428 6d61  cls.from_dict(ma
+00008970: 7070 696e 672c 2066 6561 7475 7265 732c  pping, features,
+00008980: 2069 6e66 6f2c 2073 706c 6974 290a 0a20   info, split).. 
+00008990: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+000089a0: 0a20 2020 2064 6566 2066 726f 6d5f 6373  .    def from_cs
+000089b0: 7628 0a20 2020 2020 2020 2070 6174 685f  v(.        path_
+000089c0: 6f72 5f70 6174 6873 3a20 556e 696f 6e5b  or_paths: Union[
+000089d0: 5061 7468 4c69 6b65 2c20 4c69 7374 5b50  PathLike, List[P
+000089e0: 6174 684c 696b 655d 5d2c 0a20 2020 2020  athLike]],.     
+000089f0: 2020 2073 706c 6974 3a20 4f70 7469 6f6e     split: Option
+00008a00: 616c 5b4e 616d 6564 5370 6c69 745d 203d  al[NamedSplit] =
+00008a10: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
+00008a20: 6561 7475 7265 733a 204f 7074 696f 6e61  eatures: Optiona
+00008a30: 6c5b 4665 6174 7572 6573 5d20 3d20 4e6f  l[Features] = No
+00008a40: 6e65 2c0a 2020 2020 2020 2020 6361 6368  ne,.        cach
+00008a50: 655f 6469 723a 2073 7472 203d 204e 6f6e  e_dir: str = Non
+00008a60: 652c 0a20 2020 2020 2020 206b 6565 705f  e,.        keep_
+00008a70: 696e 5f6d 656d 6f72 793a 2062 6f6f 6c20  in_memory: bool 
+00008a80: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+00008a90: 206e 756d 5f70 726f 633a 204f 7074 696f   num_proc: Optio
+00008aa0: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
+00008ab0: 0a20 2020 2020 2020 202a 2a6b 7761 7267  .        **kwarg
+00008ac0: 732c 0a20 2020 2029 3a0a 2020 2020 2020  s,.    ):.      
+00008ad0: 2020 2222 2243 7265 6174 6520 4461 7461    """Create Data
+00008ae0: 7365 7420 6672 6f6d 2043 5356 2066 696c  set from CSV fil
+00008af0: 6528 7329 2e0a 0a20 2020 2020 2020 2041  e(s)...        A
+00008b00: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00008b10: 2070 6174 685f 6f72 5f70 6174 6873 2028   path_or_paths (
+00008b20: 6070 6174 682d 6c69 6b65 6020 6f72 206c  `path-like` or l
+00008b30: 6973 7420 6f66 2060 7061 7468 2d6c 696b  ist of `path-lik
+00008b40: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
+00008b50: 2020 2020 2050 6174 6828 7329 206f 6620       Path(s) of 
+00008b60: 7468 6520 4353 5620 6669 6c65 2873 292e  the CSV file(s).
+00008b70: 0a20 2020 2020 2020 2020 2020 2073 706c  .            spl
+00008b80: 6974 2028 5b60 4e61 6d65 6453 706c 6974  it ([`NamedSplit
+00008b90: 605d 2c20 2a6f 7074 696f 6e61 6c2a 293a  `], *optional*):
+00008ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008bb0: 2053 706c 6974 206e 616d 6520 746f 2062   Split name to b
+00008bc0: 6520 6173 7369 676e 6564 2074 6f20 7468  e assigned to th
+00008bd0: 6520 6461 7461 7365 742e 0a20 2020 2020  e dataset..     
+00008be0: 2020 2020 2020 2066 6561 7475 7265 7320         features 
+00008bf0: 285b 6046 6561 7475 7265 7360 5d2c 202a  ([`Features`], *
+00008c00: 6f70 7469 6f6e 616c 2a29 3a0a 2020 2020  optional*):.    
+00008c10: 2020 2020 2020 2020 2020 2020 4461 7461              Data
+00008c20: 7365 7420 6665 6174 7572 6573 2e0a 2020  set features..  
+00008c30: 2020 2020 2020 2020 2020 6361 6368 655f            cache_
+00008c40: 6469 7220 2860 7374 7260 2c20 2a6f 7074  dir (`str`, *opt
+00008c50: 696f 6e61 6c2a 2c20 6465 6661 756c 7473  ional*, defaults
+00008c60: 2074 6f20 6022 7e2f 2e63 6163 6865 2f68   to `"~/.cache/h
+00008c70: 7567 6769 6e67 6661 6365 2f64 6174 6173  uggingface/datas
+00008c80: 6574 7322 6029 3a0a 2020 2020 2020 2020  ets"`):.        
+00008c90: 2020 2020 2020 2020 4469 7265 6374 6f72          Director
+00008ca0: 7920 746f 2063 6163 6865 2064 6174 612e  y to cache data.
+00008cb0: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
+00008cc0: 705f 696e 5f6d 656d 6f72 7920 2860 626f  p_in_memory (`bo
+00008cd0: 6f6c 602c 2064 6566 6175 6c74 7320 746f  ol`, defaults to
+00008ce0: 2060 4661 6c73 6560 293a 0a20 2020 2020   `False`):.     
+00008cf0: 2020 2020 2020 2020 2020 2057 6865 7468             Wheth
+00008d00: 6572 2074 6f20 636f 7079 2074 6865 2064  er to copy the d
+00008d10: 6174 6120 696e 2d6d 656d 6f72 792e 0a20  ata in-memory.. 
+00008d20: 2020 2020 2020 2020 2020 206e 756d 5f70             num_p
+00008d30: 726f 6320 2860 696e 7460 2c20 2a6f 7074  roc (`int`, *opt
+00008d40: 696f 6e61 6c2a 2c20 6465 6661 756c 7473  ional*, defaults
+00008d50: 2074 6f20 604e 6f6e 6560 293a 0a20 2020   to `None`):.   
+00008d60: 2020 2020 2020 2020 2020 2020 204e 756d               Num
+00008d70: 6265 7220 6f66 2070 726f 6365 7373 6573  ber of processes
+00008d80: 2077 6865 6e20 646f 776e 6c6f 6164 696e   when downloadin
+00008d90: 6720 616e 6420 6765 6e65 7261 7469 6e67  g and generating
+00008da0: 2074 6865 2064 6174 6173 6574 206c 6f63   the dataset loc
+00008db0: 616c 6c79 2e0a 2020 2020 2020 2020 2020  ally..          
+00008dc0: 2020 2020 2020 5468 6973 2069 7320 6865        This is he
+00008dd0: 6c70 6675 6c20 6966 2074 6865 2064 6174  lpful if the dat
+00008de0: 6173 6574 2069 7320 6d61 6465 206f 6620  aset is made of 
+00008df0: 6d75 6c74 6970 6c65 2066 696c 6573 2e20  multiple files. 
+00008e00: 4d75 6c74 6970 726f 6365 7373 696e 6720  Multiprocessing 
+00008e10: 6973 2064 6973 6162 6c65 6420 6279 2064  is disabled by d
+00008e20: 6566 6175 6c74 2e0a 0a20 2020 2020 2020  efault...       
+00008e30: 2020 2020 2020 2020 203c 4164 6465 6420           <Added 
+00008e40: 7665 7273 696f 6e3d 2232 2e38 2e30 222f  version="2.8.0"/
+00008e50: 3e0a 2020 2020 2020 2020 2020 2020 2a2a  >.            **
+00008e60: 6b77 6172 6773 2028 6164 6469 7469 6f6e  kwargs (addition
+00008e70: 616c 206b 6579 776f 7264 2061 7267 756d  al keyword argum
+00008e80: 656e 7473 293a 0a20 2020 2020 2020 2020  ents):.         
+00008e90: 2020 2020 2020 204b 6579 776f 7264 2061         Keyword a
+00008ea0: 7267 756d 656e 7473 2074 6f20 6265 2070  rguments to be p
+00008eb0: 6173 7365 6420 746f 205b 6070 616e 6461  assed to [`panda
+00008ec0: 732e 7265 6164 5f63 7376 605d 2e0a 0a20  s.read_csv`]... 
+00008ed0: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
+00008ee0: 2020 2020 2020 2020 2020 2020 5b60 4461              [`Da
+00008ef0: 7461 7365 7460 5d0a 0a20 2020 2020 2020  taset`]..       
+00008f00: 2045 7861 6d70 6c65 3a0a 0a20 2020 2020   Example:..     
+00008f10: 2020 2060 6060 7079 0a20 2020 2020 2020     ```py.       
+00008f20: 203e 3e3e 2064 7320 3d20 4461 7461 7365   >>> ds = Datase
+00008f30: 742e 6672 6f6d 5f63 7376 2827 7061 7468  t.from_csv('path
+00008f40: 2f74 6f2f 6461 7461 7365 742e 6373 7627  /to/dataset.csv'
+00008f50: 290a 2020 2020 2020 2020 6060 600a 2020  ).        ```.  
+00008f60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00008f70: 2020 2320 4479 6e61 6d69 6320 696d 706f    # Dynamic impo
+00008f80: 7274 2074 6f20 6176 6f69 6420 6369 7263  rt to avoid circ
+00008f90: 756c 6172 2064 6570 656e 6465 6e63 790a  ular dependency.
+00008fa0: 2020 2020 2020 2020 6672 6f6d 202e 696f          from .io
+00008fb0: 2e63 7376 2069 6d70 6f72 7420 4373 7644  .csv import CsvD
+00008fc0: 6174 6173 6574 5265 6164 6572 0a0a 2020  atasetReader..  
+00008fd0: 2020 2020 2020 7265 7475 726e 2043 7376        return Csv
+00008fe0: 4461 7461 7365 7452 6561 6465 7228 0a20  DatasetReader(. 
+00008ff0: 2020 2020 2020 2020 2020 2070 6174 685f             path_
+00009000: 6f72 5f70 6174 6873 2c0a 2020 2020 2020  or_paths,.      
+00009010: 2020 2020 2020 7370 6c69 743d 7370 6c69        split=spli
+00009020: 742c 0a20 2020 2020 2020 2020 2020 2066  t,.            f
+00009030: 6561 7475 7265 733d 6665 6174 7572 6573  eatures=features
+00009040: 2c0a 2020 2020 2020 2020 2020 2020 6361  ,.            ca
+00009050: 6368 655f 6469 723d 6361 6368 655f 6469  che_dir=cache_di
+00009060: 722c 0a20 2020 2020 2020 2020 2020 206b  r,.            k
+00009070: 6565 705f 696e 5f6d 656d 6f72 793d 6b65  eep_in_memory=ke
+00009080: 6570 5f69 6e5f 6d65 6d6f 7279 2c0a 2020  ep_in_memory,.  
+00009090: 2020 2020 2020 2020 2020 6e75 6d5f 7072            num_pr
+000090a0: 6f63 3d6e 756d 5f70 726f 632c 0a20 2020  oc=num_proc,.   
+000090b0: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
+000090c0: 732c 0a20 2020 2020 2020 2029 2e72 6561  s,.        ).rea
+000090d0: 6428 290a 0a20 2020 2040 7374 6174 6963  d()..    @static
+000090e0: 6d65 7468 6f64 0a20 2020 2064 6566 2066  method.    def f
+000090f0: 726f 6d5f 6765 6e65 7261 746f 7228 0a20  rom_generator(. 
+00009100: 2020 2020 2020 2067 656e 6572 6174 6f72         generator
+00009110: 3a20 4361 6c6c 6162 6c65 2c0a 2020 2020  : Callable,.    
+00009120: 2020 2020 6665 6174 7572 6573 3a20 4f70      features: Op
+00009130: 7469 6f6e 616c 5b46 6561 7475 7265 735d  tional[Features]
+00009140: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00009150: 2063 6163 6865 5f64 6972 3a20 7374 7220   cache_dir: str 
+00009160: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00009170: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 3a20  keep_in_memory: 
+00009180: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+00009190: 2020 2020 2020 6765 6e5f 6b77 6172 6773        gen_kwargs
+000091a0: 3a20 4f70 7469 6f6e 616c 5b64 6963 745d  : Optional[dict]
+000091b0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000091c0: 206e 756d 5f70 726f 633a 204f 7074 696f   num_proc: Optio
+000091d0: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
+000091e0: 0a20 2020 2020 2020 202a 2a6b 7761 7267  .        **kwarg
+000091f0: 732c 0a20 2020 2029 3a0a 2020 2020 2020  s,.    ):.      
+00009200: 2020 2222 2243 7265 6174 6520 6120 4461    """Create a Da
+00009210: 7461 7365 7420 6672 6f6d 2061 2067 656e  taset from a gen
+00009220: 6572 6174 6f72 2e0a 0a20 2020 2020 2020  erator...       
+00009230: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00009240: 2020 2067 656e 6572 6174 6f72 2028 3a60     generator (:`
+00009250: 4361 6c6c 6162 6c65 6029 3a0a 2020 2020  Callable`):.    
+00009260: 2020 2020 2020 2020 2020 2020 4120 6765              A ge
+00009270: 6e65 7261 746f 7220 6675 6e63 7469 6f6e  nerator function
+00009280: 2074 6861 7420 6079 6965 6c64 7360 2065   that `yields` e
+00009290: 7861 6d70 6c65 732e 0a20 2020 2020 2020  xamples..       
+000092a0: 2020 2020 2066 6561 7475 7265 7320 285b       features ([
+000092b0: 6046 6561 7475 7265 7360 5d2c 202a 6f70  `Features`], *op
+000092c0: 7469 6f6e 616c 2a29 3a0a 2020 2020 2020  tional*):.      
+000092d0: 2020 2020 2020 2020 2020 4461 7461 7365            Datase
+000092e0: 7420 6665 6174 7572 6573 2e0a 2020 2020  t features..    
+000092f0: 2020 2020 2020 2020 6361 6368 655f 6469          cache_di
+00009300: 7220 2860 7374 7260 2c20 2a6f 7074 696f  r (`str`, *optio
+00009310: 6e61 6c2a 2c20 6465 6661 756c 7473 2074  nal*, defaults t
+00009320: 6f20 6022 7e2f 2e63 6163 6865 2f68 7567  o `"~/.cache/hug
+00009330: 6769 6e67 6661 6365 2f64 6174 6173 6574  gingface/dataset
+00009340: 7322 6029 3a0a 2020 2020 2020 2020 2020  s"`):.          
+00009350: 2020 2020 2020 4469 7265 6374 6f72 7920        Directory 
+00009360: 746f 2063 6163 6865 2064 6174 612e 0a20  to cache data.. 
+00009370: 2020 2020 2020 2020 2020 206b 6565 705f             keep_
+00009380: 696e 5f6d 656d 6f72 7920 2860 626f 6f6c  in_memory (`bool
+00009390: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
+000093a0: 4661 6c73 6560 293a 0a20 2020 2020 2020  False`):.       
+000093b0: 2020 2020 2020 2020 2057 6865 7468 6572           Whether
+000093c0: 2074 6f20 636f 7079 2074 6865 2064 6174   to copy the dat
+000093d0: 6120 696e 2d6d 656d 6f72 792e 0a20 2020  a in-memory..   
+000093e0: 2020 2020 2020 2020 2067 656e 5f6b 7761           gen_kwa
+000093f0: 7267 7328 6064 6963 7460 2c20 2a6f 7074  rgs(`dict`, *opt
+00009400: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
+00009410: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
+00009420: 2061 7267 756d 656e 7473 2074 6f20 6265   arguments to be
+00009430: 2070 6173 7365 6420 746f 2074 6865 2060   passed to the `
+00009440: 6765 6e65 7261 746f 7260 2063 616c 6c61  generator` calla
+00009450: 626c 652e 0a20 2020 2020 2020 2020 2020  ble..           
+00009460: 2020 2020 2059 6f75 2063 616e 2064 6566       You can def
+00009470: 696e 6520 6120 7368 6172 6465 6420 6461  ine a sharded da
+00009480: 7461 7365 7420 6279 2070 6173 7369 6e67  taset by passing
+00009490: 2074 6865 206c 6973 7420 6f66 2073 6861   the list of sha
+000094a0: 7264 7320 696e 2060 6765 6e5f 6b77 6172  rds in `gen_kwar
+000094b0: 6773 602e 0a20 2020 2020 2020 2020 2020  gs`..           
+000094c0: 206e 756d 5f70 726f 6320 2860 696e 7460   num_proc (`int`
+000094d0: 2c20 2a6f 7074 696f 6e61 6c2a 2c20 6465  , *optional*, de
+000094e0: 6661 756c 7473 2074 6f20 604e 6f6e 6560  faults to `None`
+000094f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00009500: 2020 204e 756d 6265 7220 6f66 2070 726f     Number of pro
+00009510: 6365 7373 6573 2077 6865 6e20 646f 776e  cesses when down
+00009520: 6c6f 6164 696e 6720 616e 6420 6765 6e65  loading and gene
+00009530: 7261 7469 6e67 2074 6865 2064 6174 6173  rating the datas
+00009540: 6574 206c 6f63 616c 6c79 2e0a 2020 2020  et locally..    
+00009550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009560: 5468 6973 2069 7320 6865 6c70 6675 6c20  This is helpful 
+00009570: 6966 2074 6865 2064 6174 6173 6574 2069  if the dataset i
+00009580: 7320 6d61 6465 206f 6620 6d75 6c74 6970  s made of multip
+00009590: 6c65 2066 696c 6573 2e20 4d75 6c74 6970  le files. Multip
+000095a0: 726f 6365 7373 696e 6720 6973 2064 6973  rocessing is dis
+000095b0: 6162 6c65 6420 6279 2064 6566 6175 6c74  abled by default
+000095c0: 2e0a 0a20 2020 2020 2020 2020 2020 2020  ...             
+000095d0: 2020 2020 2020 203c 4164 6465 6420 7665         <Added ve
+000095e0: 7273 696f 6e3d 2232 2e37 2e30 222f 3e0a  rsion="2.7.0"/>.
+000095f0: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
+00009600: 6172 6773 2028 6164 6469 7469 6f6e 616c  args (additional
+00009610: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+00009620: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
+00009630: 2020 2020 204b 6579 776f 7264 2061 7267       Keyword arg
+00009640: 756d 656e 7473 2074 6f20 6265 2070 6173  uments to be pas
+00009650: 7365 6420 746f 203a 5b60 4765 6e65 7261  sed to :[`Genera
+00009660: 746f 7243 6f6e 6669 6760 5d2e 0a0a 2020  torConfig`]...  
+00009670: 2020 2020 2020 5265 7475 726e 733a 0a20        Returns:. 
+00009680: 2020 2020 2020 2020 2020 205b 6044 6174             [`Dat
+00009690: 6173 6574 605d 0a0a 2020 2020 2020 2020  aset`]..        
+000096a0: 4578 616d 706c 653a 0a0a 2020 2020 2020  Example:..      
+000096b0: 2020 6060 6070 790a 2020 2020 2020 2020    ```py.        
+000096c0: 3e3e 3e20 6465 6620 6765 6e28 293a 0a20  >>> def gen():. 
+000096d0: 2020 2020 2020 202e 2e2e 2020 2020 2079         ...     y
+000096e0: 6965 6c64 207b 2274 6578 7422 3a20 2247  ield {"text": "G
+000096f0: 6f6f 6422 2c20 226c 6162 656c 223a 2030  ood", "label": 0
+00009700: 7d0a 2020 2020 2020 2020 2e2e 2e20 2020  }.        ...   
+00009710: 2020 7969 656c 6420 7b22 7465 7874 223a    yield {"text":
+00009720: 2022 4261 6422 2c20 226c 6162 656c 223a   "Bad", "label":
+00009730: 2031 7d0a 2020 2020 2020 2020 2e2e 2e0a   1}.        ....
+00009740: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
+00009750: 2044 6174 6173 6574 2e66 726f 6d5f 6765   Dataset.from_ge
+00009760: 6e65 7261 746f 7228 6765 6e29 0a20 2020  nerator(gen).   
+00009770: 2020 2020 2060 6060 0a0a 2020 2020 2020       ```..      
+00009780: 2020 6060 6070 790a 2020 2020 2020 2020    ```py.        
+00009790: 3e3e 3e20 6465 6620 6765 6e28 7368 6172  >>> def gen(shar
+000097a0: 6473 293a 0a20 2020 2020 2020 202e 2e2e  ds):.        ...
+000097b0: 2020 2020 2066 6f72 2073 6861 7264 2069       for shard i
+000097c0: 6e20 7368 6172 6473 3a0a 2020 2020 2020  n shards:.      
+000097d0: 2020 2e2e 2e20 2020 2020 2020 2020 7769    ...         wi
+000097e0: 7468 206f 7065 6e28 7368 6172 6429 2061  th open(shard) a
+000097f0: 7320 663a 0a20 2020 2020 2020 202e 2e2e  s f:.        ...
+00009800: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00009810: 206c 696e 6520 696e 2066 3a0a 2020 2020   line in f:.    
+00009820: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+00009830: 2020 2020 2020 2020 7969 656c 6420 7b22          yield {"
+00009840: 6c69 6e65 223a 206c 696e 657d 0a20 2020  line": line}.   
+00009850: 2020 2020 202e 2e2e 0a20 2020 2020 2020       ....       
+00009860: 203e 3e3e 2073 6861 7264 7320 3d20 5b66   >>> shards = [f
+00009870: 2264 6174 617b 697d 2e74 7874 2220 666f  "data{i}.txt" fo
+00009880: 7220 6920 696e 2072 616e 6765 2833 3229  r i in range(32)
+00009890: 5d0a 2020 2020 2020 2020 3e3e 3e20 6473  ].        >>> ds
+000098a0: 203d 2044 6174 6173 6574 2e66 726f 6d5f   = Dataset.from_
+000098b0: 6765 6e65 7261 746f 7228 6765 6e2c 2067  generator(gen, g
+000098c0: 656e 5f6b 7761 7267 733d 7b22 7368 6172  en_kwargs={"shar
+000098d0: 6473 223a 2073 6861 7264 737d 290a 2020  ds": shards}).  
+000098e0: 2020 2020 2020 6060 600a 2020 2020 2020        ```.      
+000098f0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+00009900: 6f6d 202e 696f 2e67 656e 6572 6174 6f72  om .io.generator
+00009910: 2069 6d70 6f72 7420 4765 6e65 7261 746f   import Generato
+00009920: 7244 6174 6173 6574 496e 7075 7453 7472  rDatasetInputStr
+00009930: 6561 6d0a 0a20 2020 2020 2020 2072 6574  eam..        ret
+00009940: 7572 6e20 4765 6e65 7261 746f 7244 6174  urn GeneratorDat
+00009950: 6173 6574 496e 7075 7453 7472 6561 6d28  asetInputStream(
+00009960: 0a20 2020 2020 2020 2020 2020 2067 656e  .            gen
+00009970: 6572 6174 6f72 3d67 656e 6572 6174 6f72  erator=generator
+00009980: 2c0a 2020 2020 2020 2020 2020 2020 6665  ,.            fe
+00009990: 6174 7572 6573 3d66 6561 7475 7265 732c  atures=features,
+000099a0: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
+000099b0: 6865 5f64 6972 3d63 6163 6865 5f64 6972  he_dir=cache_dir
+000099c0: 2c0a 2020 2020 2020 2020 2020 2020 6b65  ,.            ke
+000099d0: 6570 5f69 6e5f 6d65 6d6f 7279 3d6b 6565  ep_in_memory=kee
+000099e0: 705f 696e 5f6d 656d 6f72 792c 0a20 2020  p_in_memory,.   
+000099f0: 2020 2020 2020 2020 2067 656e 5f6b 7761           gen_kwa
+00009a00: 7267 733d 6765 6e5f 6b77 6172 6773 2c0a  rgs=gen_kwargs,.
+00009a10: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+00009a20: 7072 6f63 3d6e 756d 5f70 726f 632c 0a20  proc=num_proc,. 
+00009a30: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
+00009a40: 7267 732c 0a20 2020 2020 2020 2029 2e72  rgs,.        ).r
+00009a50: 6561 6428 290a 0a20 2020 2040 7374 6174  ead()..    @stat
+00009a60: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00009a70: 2066 726f 6d5f 6a73 6f6e 280a 2020 2020   from_json(.    
+00009a80: 2020 2020 7061 7468 5f6f 725f 7061 7468      path_or_path
+00009a90: 733a 2055 6e69 6f6e 5b50 6174 684c 696b  s: Union[PathLik
+00009aa0: 652c 204c 6973 745b 5061 7468 4c69 6b65  e, List[PathLike
+00009ab0: 5d5d 2c0a 2020 2020 2020 2020 7370 6c69  ]],.        spli
+00009ac0: 743a 204f 7074 696f 6e61 6c5b 4e61 6d65  t: Optional[Name
+00009ad0: 6453 706c 6974 5d20 3d20 4e6f 6e65 2c0a  dSplit] = None,.
+00009ae0: 2020 2020 2020 2020 6665 6174 7572 6573          features
+00009af0: 3a20 4f70 7469 6f6e 616c 5b46 6561 7475  : Optional[Featu
+00009b00: 7265 735d 203d 204e 6f6e 652c 0a20 2020  res] = None,.   
+00009b10: 2020 2020 2063 6163 6865 5f64 6972 3a20       cache_dir: 
+00009b20: 7374 7220 3d20 4e6f 6e65 2c0a 2020 2020  str = None,.    
+00009b30: 2020 2020 6b65 6570 5f69 6e5f 6d65 6d6f      keep_in_memo
+00009b40: 7279 3a20 626f 6f6c 203d 2046 616c 7365  ry: bool = False
+00009b50: 2c0a 2020 2020 2020 2020 6669 656c 643a  ,.        field:
+00009b60: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+00009b70: 204e 6f6e 652c 0a20 2020 2020 2020 206e   None,.        n
+00009b80: 756d 5f70 726f 633a 204f 7074 696f 6e61  um_proc: Optiona
+00009b90: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
+00009ba0: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
+00009bb0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+00009bc0: 2222 2243 7265 6174 6520 4461 7461 7365  """Create Datase
+00009bd0: 7420 6672 6f6d 204a 534f 4e20 6f72 204a  t from JSON or J
+00009be0: 534f 4e20 4c69 6e65 7320 6669 6c65 2873  SON Lines file(s
+00009bf0: 292e 0a0a 2020 2020 2020 2020 4172 6773  )...        Args
+00009c00: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00009c10: 7468 5f6f 725f 7061 7468 7320 2860 7061  th_or_paths (`pa
+00009c20: 7468 2d6c 696b 6560 206f 7220 6c69 7374  th-like` or list
+00009c30: 206f 6620 6070 6174 682d 6c69 6b65 6029   of `path-like`)
+00009c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009c50: 2020 5061 7468 2873 2920 6f66 2074 6865    Path(s) of the
+00009c60: 204a 534f 4e20 6f72 204a 534f 4e20 4c69   JSON or JSON Li
+00009c70: 6e65 7320 6669 6c65 2873 292e 0a20 2020  nes file(s)..   
+00009c80: 2020 2020 2020 2020 2073 706c 6974 2028           split (
+00009c90: 5b60 4e61 6d65 6453 706c 6974 605d 2c20  [`NamedSplit`], 
+00009ca0: 2a6f 7074 696f 6e61 6c2a 293a 0a20 2020  *optional*):.   
+00009cb0: 2020 2020 2020 2020 2020 2020 2053 706c               Spl
+00009cc0: 6974 206e 616d 6520 746f 2062 6520 6173  it name to be as
+00009cd0: 7369 676e 6564 2074 6f20 7468 6520 6461  signed to the da
+00009ce0: 7461 7365 742e 0a20 2020 2020 2020 2020  taset..         
+00009cf0: 2020 2066 6561 7475 7265 7320 285b 6046     features ([`F
+00009d00: 6561 7475 7265 7360 5d2c 202a 6f70 7469  eatures`], *opti
+00009d10: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
+00009d20: 2020 2020 2020 2020 2044 6174 6173 6574           Dataset
+00009d30: 2066 6561 7475 7265 732e 0a20 2020 2020   features..     
+00009d40: 2020 2020 2020 2063 6163 6865 5f64 6972         cache_dir
+00009d50: 2028 6073 7472 602c 202a 6f70 7469 6f6e   (`str`, *option
+00009d60: 616c 2a2c 2064 6566 6175 6c74 7320 746f  al*, defaults to
+00009d70: 2060 227e 2f2e 6361 6368 652f 6875 6767   `"~/.cache/hugg
+00009d80: 696e 6766 6163 652f 6461 7461 7365 7473  ingface/datasets
+00009d90: 2260 293a 0a20 2020 2020 2020 2020 2020  "`):.           
+00009da0: 2020 2020 2044 6972 6563 746f 7279 2074       Directory t
+00009db0: 6f20 6361 6368 6520 6461 7461 2e0a 2020  o cache data..  
+00009dc0: 2020 2020 2020 2020 2020 6b65 6570 5f69            keep_i
+00009dd0: 6e5f 6d65 6d6f 7279 2028 6062 6f6f 6c60  n_memory (`bool`
+00009de0: 2c20 6465 6661 756c 7473 2074 6f20 6046  , defaults to `F
+00009df0: 616c 7365 6029 3a0a 2020 2020 2020 2020  alse`):.        
+00009e00: 2020 2020 2020 2020 5768 6574 6865 7220          Whether 
+00009e10: 746f 2063 6f70 7920 7468 6520 6461 7461  to copy the data
+00009e20: 2069 6e2d 6d65 6d6f 7279 2e0a 2020 2020   in-memory..    
+00009e30: 2020 2020 2020 2020 6669 656c 6420 2860          field (`
+00009e40: 7374 7260 2c20 2a6f 7074 696f 6e61 6c2a  str`, *optional*
+00009e50: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00009e60: 2020 2046 6965 6c64 206e 616d 6520 6f66     Field name of
+00009e70: 2074 6865 204a 534f 4e20 6669 6c65 2077   the JSON file w
+00009e80: 6865 7265 2074 6865 2064 6174 6173 6574  here the dataset
+00009e90: 2069 7320 636f 6e74 6169 6e65 6420 696e   is contained in
+00009ea0: 2e0a 2020 2020 2020 2020 2020 2020 6e75  ..            nu
+00009eb0: 6d5f 7072 6f63 2028 6069 6e74 602c 202a  m_proc (`int`, *
+00009ec0: 6f70 7469 6f6e 616c 2a20 6465 6661 756c  optional* defaul
+00009ed0: 7473 2074 6f20 604e 6f6e 6560 293a 0a20  ts to `None`):. 
+00009ee0: 2020 2020 2020 2020 2020 2020 2020 204e                 N
+00009ef0: 756d 6265 7220 6f66 2070 726f 6365 7373  umber of process
+00009f00: 6573 2077 6865 6e20 646f 776e 6c6f 6164  es when download
+00009f10: 696e 6720 616e 6420 6765 6e65 7261 7469  ing and generati
+00009f20: 6e67 2074 6865 2064 6174 6173 6574 206c  ng the dataset l
+00009f30: 6f63 616c 6c79 2e0a 2020 2020 2020 2020  ocally..        
+00009f40: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
+00009f50: 6865 6c70 6675 6c20 6966 2074 6865 2064  helpful if the d
+00009f60: 6174 6173 6574 2069 7320 6d61 6465 206f  ataset is made o
+00009f70: 6620 6d75 6c74 6970 6c65 2066 696c 6573  f multiple files
+00009f80: 2e20 4d75 6c74 6970 726f 6365 7373 696e  . Multiprocessin
+00009f90: 6720 6973 2064 6973 6162 6c65 6420 6279  g is disabled by
+00009fa0: 2064 6566 6175 6c74 2e0a 0a20 2020 2020   default...     
+00009fb0: 2020 2020 2020 2020 2020 203c 4164 6465             <Adde
+00009fc0: 6420 7665 7273 696f 6e3d 2232 2e38 2e30  d version="2.8.0
+00009fd0: 222f 3e0a 2020 2020 2020 2020 2020 2020  "/>.            
+00009fe0: 2a2a 6b77 6172 6773 2028 6164 6469 7469  **kwargs (additi
+00009ff0: 6f6e 616c 206b 6579 776f 7264 2061 7267  onal keyword arg
+0000a000: 756d 656e 7473 293a 0a20 2020 2020 2020  uments):.       
+0000a010: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
+0000a020: 2061 7267 756d 656e 7473 2074 6f20 6265   arguments to be
+0000a030: 2070 6173 7365 6420 746f 205b 604a 736f   passed to [`Jso
+0000a040: 6e43 6f6e 6669 6760 5d2e 0a0a 2020 2020  nConfig`]...    
+0000a050: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+0000a060: 2020 2020 2020 2020 205b 6044 6174 6173           [`Datas
+0000a070: 6574 605d 0a0a 2020 2020 2020 2020 4578  et`]..        Ex
+0000a080: 616d 706c 653a 0a0a 2020 2020 2020 2020  ample:..        
+0000a090: 6060 6070 790a 2020 2020 2020 2020 3e3e  ```py.        >>
+0000a0a0: 3e20 6473 203d 2044 6174 6173 6574 2e66  > ds = Dataset.f
+0000a0b0: 726f 6d5f 6a73 6f6e 2827 7061 7468 2f74  rom_json('path/t
+0000a0c0: 6f2f 6461 7461 7365 742e 6a73 6f6e 2729  o/dataset.json')
+0000a0d0: 0a20 2020 2020 2020 2060 6060 0a20 2020  .        ```.   
+0000a0e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000a0f0: 2023 2044 796e 616d 6963 2069 6d70 6f72   # Dynamic impor
+0000a100: 7420 746f 2061 766f 6964 2063 6972 6375  t to avoid circu
+0000a110: 6c61 7220 6465 7065 6e64 656e 6379 0a20  lar dependency. 
+0000a120: 2020 2020 2020 2066 726f 6d20 2e69 6f2e         from .io.
+0000a130: 6a73 6f6e 2069 6d70 6f72 7420 4a73 6f6e  json import Json
+0000a140: 4461 7461 7365 7452 6561 6465 720a 0a20  DatasetReader.. 
+0000a150: 2020 2020 2020 2072 6574 7572 6e20 4a73         return Js
+0000a160: 6f6e 4461 7461 7365 7452 6561 6465 7228  onDatasetReader(
+0000a170: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+0000a180: 685f 6f72 5f70 6174 6873 2c0a 2020 2020  h_or_paths,.    
+0000a190: 2020 2020 2020 2020 7370 6c69 743d 7370          split=sp
+0000a1a0: 6c69 742c 0a20 2020 2020 2020 2020 2020  lit,.           
+0000a1b0: 2066 6561 7475 7265 733d 6665 6174 7572   features=featur
+0000a1c0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0000a1d0: 6361 6368 655f 6469 723d 6361 6368 655f  cache_dir=cache_
+0000a1e0: 6469 722c 0a20 2020 2020 2020 2020 2020  dir,.           
+0000a1f0: 206b 6565 705f 696e 5f6d 656d 6f72 793d   keep_in_memory=
+0000a200: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 2c0a  keep_in_memory,.
+0000a210: 2020 2020 2020 2020 2020 2020 6669 656c              fiel
+0000a220: 643d 6669 656c 642c 0a20 2020 2020 2020  d=field,.       
+0000a230: 2020 2020 206e 756d 5f70 726f 633d 6e75       num_proc=nu
+0000a240: 6d5f 7072 6f63 2c0a 2020 2020 2020 2020  m_proc,.        
+0000a250: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
+0000a260: 2020 2020 2020 292e 7265 6164 2829 0a0a        ).read()..
+0000a270: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+0000a280: 640a 2020 2020 6465 6620 6672 6f6d 5f70  d.    def from_p
+0000a290: 6172 7175 6574 280a 2020 2020 2020 2020  arquet(.        
+0000a2a0: 7061 7468 5f6f 725f 7061 7468 733a 2055  path_or_paths: U
+0000a2b0: 6e69 6f6e 5b50 6174 684c 696b 652c 204c  nion[PathLike, L
+0000a2c0: 6973 745b 5061 7468 4c69 6b65 5d5d 2c0a  ist[PathLike]],.
+0000a2d0: 2020 2020 2020 2020 7370 6c69 743a 204f          split: O
+0000a2e0: 7074 696f 6e61 6c5b 4e61 6d65 6453 706c  ptional[NamedSpl
+0000a2f0: 6974 5d20 3d20 4e6f 6e65 2c0a 2020 2020  it] = None,.    
+0000a300: 2020 2020 6665 6174 7572 6573 3a20 4f70      features: Op
+0000a310: 7469 6f6e 616c 5b46 6561 7475 7265 735d  tional[Features]
+0000a320: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0000a330: 2063 6163 6865 5f64 6972 3a20 7374 7220   cache_dir: str 
+0000a340: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000a350: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 3a20  keep_in_memory: 
+0000a360: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+0000a370: 2020 2020 2020 636f 6c75 6d6e 733a 204f        columns: O
+0000a380: 7074 696f 6e61 6c5b 4c69 7374 5b73 7472  ptional[List[str
+0000a390: 5d5d 203d 204e 6f6e 652c 0a20 2020 2020  ]] = None,.     
+0000a3a0: 2020 206e 756d 5f70 726f 633a 204f 7074     num_proc: Opt
+0000a3b0: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
+0000a3c0: 652c 0a20 2020 2020 2020 202a 2a6b 7761  e,.        **kwa
+0000a3d0: 7267 732c 0a20 2020 2029 3a0a 2020 2020  rgs,.    ):.    
+0000a3e0: 2020 2020 2222 2243 7265 6174 6520 4461      """Create Da
+0000a3f0: 7461 7365 7420 6672 6f6d 2050 6172 7175  taset from Parqu
+0000a400: 6574 2066 696c 6528 7329 2e0a 0a20 2020  et file(s)...   
+0000a410: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+0000a420: 2020 2020 2020 2070 6174 685f 6f72 5f70         path_or_p
+0000a430: 6174 6873 2028 6070 6174 682d 6c69 6b65  aths (`path-like
+0000a440: 6020 6f72 206c 6973 7420 6f66 2060 7061  ` or list of `pa
+0000a450: 7468 2d6c 696b 6560 293a 0a20 2020 2020  th-like`):.     
+0000a460: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
+0000a470: 7329 206f 6620 7468 6520 5061 7271 7565  s) of the Parque
+0000a480: 7420 6669 6c65 2873 292e 0a20 2020 2020  t file(s)..     
+0000a490: 2020 2020 2020 2073 706c 6974 2028 604e         split (`N
+0000a4a0: 616d 6564 5370 6c69 7460 2c20 2a6f 7074  amedSplit`, *opt
+0000a4b0: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
+0000a4c0: 2020 2020 2020 2020 2053 706c 6974 206e           Split n
+0000a4d0: 616d 6520 746f 2062 6520 6173 7369 676e  ame to be assign
+0000a4e0: 6564 2074 6f20 7468 6520 6461 7461 7365  ed to the datase
+0000a4f0: 742e 0a20 2020 2020 2020 2020 2020 2066  t..            f
+0000a500: 6561 7475 7265 7320 2860 4665 6174 7572  eatures (`Featur
+0000a510: 6573 602c 202a 6f70 7469 6f6e 616c 2a29  es`, *optional*)
+0000a520: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a530: 2020 4461 7461 7365 7420 6665 6174 7572    Dataset featur
+0000a540: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
+0000a550: 6361 6368 655f 6469 7220 2860 7374 7260  cache_dir (`str`
+0000a560: 2c20 2a6f 7074 696f 6e61 6c2a 2c20 6465  , *optional*, de
+0000a570: 6661 756c 7473 2074 6f20 6022 7e2f 2e63  faults to `"~/.c
+0000a580: 6163 6865 2f68 7567 6769 6e67 6661 6365  ache/huggingface
+0000a590: 2f64 6174 6173 6574 7322 6029 3a0a 2020  /datasets"`):.  
+0000a5a0: 2020 2020 2020 2020 2020 2020 2020 4469                Di
+0000a5b0: 7265 6374 6f72 7920 746f 2063 6163 6865  rectory to cache
+0000a5c0: 2064 6174 612e 0a20 2020 2020 2020 2020   data..         
+0000a5d0: 2020 206b 6565 705f 696e 5f6d 656d 6f72     keep_in_memor
+0000a5e0: 7920 2860 626f 6f6c 602c 2064 6566 6175  y (`bool`, defau
+0000a5f0: 6c74 7320 746f 2060 4661 6c73 6560 293a  lts to `False`):
+0000a600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a610: 2057 6865 7468 6572 2074 6f20 636f 7079   Whether to copy
+0000a620: 2074 6865 2064 6174 6120 696e 2d6d 656d   the data in-mem
+0000a630: 6f72 792e 0a20 2020 2020 2020 2020 2020  ory..           
+0000a640: 2063 6f6c 756d 6e73 2028 604c 6973 745b   columns (`List[
+0000a650: 7374 725d 602c 202a 6f70 7469 6f6e 616c  str]`, *optional
+0000a660: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
+0000a670: 2020 2020 4966 206e 6f74 2060 4e6f 6e65      If not `None
+0000a680: 602c 206f 6e6c 7920 7468 6573 6520 636f  `, only these co
+0000a690: 6c75 6d6e 7320 7769 6c6c 2062 6520 7265  lumns will be re
+0000a6a0: 6164 2066 726f 6d20 7468 6520 6669 6c65  ad from the file
+0000a6b0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a6c0: 2020 4120 636f 6c75 6d6e 206e 616d 6520    A column name 
+0000a6d0: 6d61 7920 6265 2061 2070 7265 6669 7820  may be a prefix 
+0000a6e0: 6f66 2061 206e 6573 7465 6420 6669 656c  of a nested fiel
+0000a6f0: 642c 2065 2e67 2e20 2761 2720 7769 6c6c  d, e.g. 'a' will
+0000a700: 2073 656c 6563 740a 2020 2020 2020 2020   select.        
+0000a710: 2020 2020 2020 2020 2761 2e62 272c 2027          'a.b', '
+0000a720: 612e 6327 2c20 616e 6420 2761 2e64 2e65  a.c', and 'a.d.e
+0000a730: 272e 0a20 2020 2020 2020 2020 2020 206e  '..            n
+0000a740: 756d 5f70 726f 6320 2860 696e 7460 2c20  um_proc (`int`, 
+0000a750: 2a6f 7074 696f 6e61 6c2a 2c20 6465 6661  *optional*, defa
+0000a760: 756c 7473 2074 6f20 604e 6f6e 6560 293a  ults to `None`):
+0000a770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a780: 204e 756d 6265 7220 6f66 2070 726f 6365   Number of proce
+0000a790: 7373 6573 2077 6865 6e20 646f 776e 6c6f  sses when downlo
+0000a7a0: 6164 696e 6720 616e 6420 6765 6e65 7261  ading and genera
+0000a7b0: 7469 6e67 2074 6865 2064 6174 6173 6574  ting the dataset
+0000a7c0: 206c 6f63 616c 6c79 2e0a 2020 2020 2020   locally..      
+0000a7d0: 2020 2020 2020 2020 2020 5468 6973 2069            This i
+0000a7e0: 7320 6865 6c70 6675 6c20 6966 2074 6865  s helpful if the
+0000a7f0: 2064 6174 6173 6574 2069 7320 6d61 6465   dataset is made
+0000a800: 206f 6620 6d75 6c74 6970 6c65 2066 696c   of multiple fil
+0000a810: 6573 2e20 4d75 6c74 6970 726f 6365 7373  es. Multiprocess
+0000a820: 696e 6720 6973 2064 6973 6162 6c65 6420  ing is disabled 
+0000a830: 6279 2064 6566 6175 6c74 2e0a 0a20 2020  by default...   
+0000a840: 2020 2020 2020 2020 2020 2020 203c 4164               <Ad
+0000a850: 6465 6420 7665 7273 696f 6e3d 2232 2e38  ded version="2.8
+0000a860: 2e30 222f 3e0a 2020 2020 2020 2020 2020  .0"/>.          
+0000a870: 2020 2a2a 6b77 6172 6773 2028 6164 6469    **kwargs (addi
+0000a880: 7469 6f6e 616c 206b 6579 776f 7264 2061  tional keyword a
+0000a890: 7267 756d 656e 7473 293a 0a20 2020 2020  rguments):.     
+0000a8a0: 2020 2020 2020 2020 2020 204b 6579 776f             Keywo
+0000a8b0: 7264 2061 7267 756d 656e 7473 2074 6f20  rd arguments to 
+0000a8c0: 6265 2070 6173 7365 6420 746f 205b 6050  be passed to [`P
+0000a8d0: 6172 7175 6574 436f 6e66 6967 605d 2e0a  arquetConfig`]..
+0000a8e0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+0000a8f0: 3a0a 2020 2020 2020 2020 2020 2020 5b60  :.            [`
+0000a900: 4461 7461 7365 7460 5d0a 0a20 2020 2020  Dataset`]..     
+0000a910: 2020 2045 7861 6d70 6c65 3a0a 0a20 2020     Example:..   
+0000a920: 2020 2020 2060 6060 7079 0a20 2020 2020       ```py.     
+0000a930: 2020 203e 3e3e 2064 7320 3d20 4461 7461     >>> ds = Data
+0000a940: 7365 742e 6672 6f6d 5f70 6172 7175 6574  set.from_parquet
+0000a950: 2827 7061 7468 2f74 6f2f 6461 7461 7365  ('path/to/datase
+0000a960: 742e 7061 7271 7565 7427 290a 2020 2020  t.parquet').    
+0000a970: 2020 2020 6060 600a 2020 2020 2020 2020      ```.        
+0000a980: 2222 220a 2020 2020 2020 2020 2320 4479  """.        # Dy
+0000a990: 6e61 6d69 6320 696d 706f 7274 2074 6f20  namic import to 
+0000a9a0: 6176 6f69 6420 6369 7263 756c 6172 2064  avoid circular d
+0000a9b0: 6570 656e 6465 6e63 790a 2020 2020 2020  ependency.      
+0000a9c0: 2020 6672 6f6d 202e 696f 2e70 6172 7175    from .io.parqu
+0000a9d0: 6574 2069 6d70 6f72 7420 5061 7271 7565  et import Parque
+0000a9e0: 7444 6174 6173 6574 5265 6164 6572 0a0a  tDatasetReader..
+0000a9f0: 2020 2020 2020 2020 7265 7475 726e 2050          return P
+0000aa00: 6172 7175 6574 4461 7461 7365 7452 6561  arquetDatasetRea
+0000aa10: 6465 7228 0a20 2020 2020 2020 2020 2020  der(.           
+0000aa20: 2070 6174 685f 6f72 5f70 6174 6873 2c0a   path_or_paths,.
+0000aa30: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
+0000aa40: 743d 7370 6c69 742c 0a20 2020 2020 2020  t=split,.       
+0000aa50: 2020 2020 2066 6561 7475 7265 733d 6665       features=fe
+0000aa60: 6174 7572 6573 2c0a 2020 2020 2020 2020  atures,.        
+0000aa70: 2020 2020 6361 6368 655f 6469 723d 6361      cache_dir=ca
+0000aa80: 6368 655f 6469 722c 0a20 2020 2020 2020  che_dir,.       
+0000aa90: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
+0000aaa0: 6f72 793d 6b65 6570 5f69 6e5f 6d65 6d6f  ory=keep_in_memo
+0000aab0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
+0000aac0: 636f 6c75 6d6e 733d 636f 6c75 6d6e 732c  columns=columns,
+0000aad0: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+0000aae0: 5f70 726f 633d 6e75 6d5f 7072 6f63 2c0a  _proc=num_proc,.
+0000aaf0: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
+0000ab00: 6172 6773 2c0a 2020 2020 2020 2020 292e  args,.        ).
+0000ab10: 7265 6164 2829 0a0a 2020 2020 4073 7461  read()..    @sta
+0000ab20: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+0000ab30: 6620 6672 6f6d 5f74 6578 7428 0a20 2020  f from_text(.   
+0000ab40: 2020 2020 2070 6174 685f 6f72 5f70 6174       path_or_pat
+0000ab50: 6873 3a20 556e 696f 6e5b 5061 7468 4c69  hs: Union[PathLi
+0000ab60: 6b65 2c20 4c69 7374 5b50 6174 684c 696b  ke, List[PathLik
+0000ab70: 655d 5d2c 0a20 2020 2020 2020 2073 706c  e]],.        spl
+0000ab80: 6974 3a20 4f70 7469 6f6e 616c 5b4e 616d  it: Optional[Nam
+0000ab90: 6564 5370 6c69 745d 203d 204e 6f6e 652c  edSplit] = None,
+0000aba0: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
+0000abb0: 733a 204f 7074 696f 6e61 6c5b 4665 6174  s: Optional[Feat
+0000abc0: 7572 6573 5d20 3d20 4e6f 6e65 2c0a 2020  ures] = None,.  
+0000abd0: 2020 2020 2020 6361 6368 655f 6469 723a        cache_dir:
+0000abe0: 2073 7472 203d 204e 6f6e 652c 0a20 2020   str = None,.   
+0000abf0: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
+0000ac00: 6f72 793a 2062 6f6f 6c20 3d20 4661 6c73  ory: bool = Fals
+0000ac10: 652c 0a20 2020 2020 2020 206e 756d 5f70  e,.        num_p
+0000ac20: 726f 633a 204f 7074 696f 6e61 6c5b 696e  roc: Optional[in
+0000ac30: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
+0000ac40: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
+0000ac50: 2029 3a0a 2020 2020 2020 2020 2222 2243   ):.        """C
+0000ac60: 7265 6174 6520 4461 7461 7365 7420 6672  reate Dataset fr
+0000ac70: 6f6d 2074 6578 7420 6669 6c65 2873 292e  om text file(s).
+0000ac80: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+0000ac90: 2020 2020 2020 2020 2020 2020 7061 7468              path
+0000aca0: 5f6f 725f 7061 7468 7320 2860 7061 7468  _or_paths (`path
+0000acb0: 2d6c 696b 6560 206f 7220 6c69 7374 206f  -like` or list o
+0000acc0: 6620 6070 6174 682d 6c69 6b65 6029 3a0a  f `path-like`):.
+0000acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ace0: 5061 7468 2873 2920 6f66 2074 6865 2074  Path(s) of the t
+0000acf0: 6578 7420 6669 6c65 2873 292e 0a20 2020  ext file(s)..   
+0000ad00: 2020 2020 2020 2020 2073 706c 6974 2028           split (
+0000ad10: 604e 616d 6564 5370 6c69 7460 2c20 2a6f  `NamedSplit`, *o
+0000ad20: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
+0000ad30: 2020 2020 2020 2020 2020 2053 706c 6974             Split
+0000ad40: 206e 616d 6520 746f 2062 6520 6173 7369   name to be assi
+0000ad50: 676e 6564 2074 6f20 7468 6520 6461 7461  gned to the data
+0000ad60: 7365 742e 0a20 2020 2020 2020 2020 2020  set..           
+0000ad70: 2066 6561 7475 7265 7320 2860 4665 6174   features (`Feat
+0000ad80: 7572 6573 602c 206f 2a70 7469 6f6e 616c  ures`, o*ptional
+0000ad90: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
+0000ada0: 2020 2020 4461 7461 7365 7420 6665 6174      Dataset feat
+0000adb0: 7572 6573 2e0a 2020 2020 2020 2020 2020  ures..          
+0000adc0: 2020 6361 6368 655f 6469 7220 2860 7374    cache_dir (`st
+0000add0: 7260 2c20 2a6f 7074 696f 6e61 6c2a 2c20  r`, *optional*, 
+0000ade0: 6465 6661 756c 7473 2074 6f20 6022 7e2f  defaults to `"~/
+0000adf0: 2e63 6163 6865 2f68 7567 6769 6e67 6661  .cache/huggingfa
+0000ae00: 6365 2f64 6174 6173 6574 7322 6029 3a0a  ce/datasets"`):.
+0000ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae20: 4469 7265 6374 6f72 7920 746f 2063 6163  Directory to cac
+0000ae30: 6865 2064 6174 612e 0a20 2020 2020 2020  he data..       
+0000ae40: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
+0000ae50: 6f72 7920 2860 626f 6f6c 602c 2064 6566  ory (`bool`, def
+0000ae60: 6175 6c74 7320 746f 2060 4661 6c73 6560  aults to `False`
+0000ae70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000ae80: 2020 2057 6865 7468 6572 2074 6f20 636f     Whether to co
+0000ae90: 7079 2074 6865 2064 6174 6120 696e 2d6d  py the data in-m
+0000aea0: 656d 6f72 792e 0a20 2020 2020 2020 2020  emory..         
+0000aeb0: 2020 206e 756d 5f70 726f 6320 2860 696e     num_proc (`in
+0000aec0: 7460 2c20 2a6f 7074 696f 6e61 6c2a 2c20  t`, *optional*, 
+0000aed0: 6465 6661 756c 7473 2074 6f20 604e 6f6e  defaults to `Non
+0000aee0: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
+0000aef0: 2020 2020 204e 756d 6265 7220 6f66 2070       Number of p
+0000af00: 726f 6365 7373 6573 2077 6865 6e20 646f  rocesses when do
+0000af10: 776e 6c6f 6164 696e 6720 616e 6420 6765  wnloading and ge
+0000af20: 6e65 7261 7469 6e67 2074 6865 2064 6174  nerating the dat
+0000af30: 6173 6574 206c 6f63 616c 6c79 2e0a 2020  aset locally..  
+0000af40: 2020 2020 2020 2020 2020 2020 2020 5468                Th
+0000af50: 6973 2069 7320 6865 6c70 6675 6c20 6966  is is helpful if
+0000af60: 2074 6865 2064 6174 6173 6574 2069 7320   the dataset is 
+0000af70: 6d61 6465 206f 6620 6d75 6c74 6970 6c65  made of multiple
+0000af80: 2066 696c 6573 2e20 4d75 6c74 6970 726f   files. Multipro
+0000af90: 6365 7373 696e 6720 6973 2064 6973 6162  cessing is disab
+0000afa0: 6c65 6420 6279 2064 6566 6175 6c74 2e0a  led by default..
+0000afb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000afc0: 203c 4164 6465 6420 7665 7273 696f 6e3d   <Added version=
+0000afd0: 2232 2e38 2e30 222f 3e0a 2020 2020 2020  "2.8.0"/>.      
+0000afe0: 2020 2020 2020 2a2a 6b77 6172 6773 2028        **kwargs (
+0000aff0: 6164 6469 7469 6f6e 616c 206b 6579 776f  additional keywo
+0000b000: 7264 2061 7267 756d 656e 7473 293a 0a20  rd arguments):. 
+0000b010: 2020 2020 2020 2020 2020 2020 2020 204b                 K
+0000b020: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+0000b030: 2074 6f20 6265 2070 6173 7365 6420 746f   to be passed to
+0000b040: 205b 6054 6578 7443 6f6e 6669 6760 5d2e   [`TextConfig`].
+0000b050: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+0000b060: 733a 0a20 2020 2020 2020 2020 2020 205b  s:.            [
+0000b070: 6044 6174 6173 6574 605d 0a0a 2020 2020  `Dataset`]..    
+0000b080: 2020 2020 4578 616d 706c 653a 0a0a 2020      Example:..  
+0000b090: 2020 2020 2020 6060 6070 790a 2020 2020        ```py.    
+0000b0a0: 2020 2020 3e3e 3e20 6473 203d 2044 6174      >>> ds = Dat
+0000b0b0: 6173 6574 2e66 726f 6d5f 7465 7874 2827  aset.from_text('
+0000b0c0: 7061 7468 2f74 6f2f 6461 7461 7365 742e  path/to/dataset.
+0000b0d0: 7478 7427 290a 2020 2020 2020 2020 6060  txt').        ``
+0000b0e0: 600a 2020 2020 2020 2020 2222 220a 2020  `.        """.  
+0000b0f0: 2020 2020 2020 2320 4479 6e61 6d69 6320        # Dynamic 
+0000b100: 696d 706f 7274 2074 6f20 6176 6f69 6420  import to avoid 
+0000b110: 6369 7263 756c 6172 2064 6570 656e 6465  circular depende
+0000b120: 6e63 790a 2020 2020 2020 2020 6672 6f6d  ncy.        from
+0000b130: 202e 696f 2e74 6578 7420 696d 706f 7274   .io.text import
+0000b140: 2054 6578 7444 6174 6173 6574 5265 6164   TextDatasetRead
+0000b150: 6572 0a0a 2020 2020 2020 2020 7265 7475  er..        retu
+0000b160: 726e 2054 6578 7444 6174 6173 6574 5265  rn TextDatasetRe
+0000b170: 6164 6572 280a 2020 2020 2020 2020 2020  ader(.          
+0000b180: 2020 7061 7468 5f6f 725f 7061 7468 732c    path_or_paths,
+0000b190: 0a20 2020 2020 2020 2020 2020 2073 706c  .            spl
+0000b1a0: 6974 3d73 706c 6974 2c0a 2020 2020 2020  it=split,.      
+0000b1b0: 2020 2020 2020 6665 6174 7572 6573 3d66        features=f
+0000b1c0: 6561 7475 7265 732c 0a20 2020 2020 2020  eatures,.       
+0000b1d0: 2020 2020 2063 6163 6865 5f64 6972 3d63       cache_dir=c
+0000b1e0: 6163 6865 5f64 6972 2c0a 2020 2020 2020  ache_dir,.      
+0000b1f0: 2020 2020 2020 6b65 6570 5f69 6e5f 6d65        keep_in_me
+0000b200: 6d6f 7279 3d6b 6565 705f 696e 5f6d 656d  mory=keep_in_mem
+0000b210: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
+0000b220: 206e 756d 5f70 726f 633d 6e75 6d5f 7072   num_proc=num_pr
+0000b230: 6f63 2c0a 2020 2020 2020 2020 2020 2020  oc,.            
+0000b240: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
+0000b250: 2020 292e 7265 6164 2829 0a0a 2020 2020    ).read()..    
+0000b260: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+0000b270: 2020 6465 6620 6672 6f6d 5f73 716c 280a    def from_sql(.
+0000b280: 2020 2020 2020 2020 7371 6c3a 2055 6e69          sql: Uni
+0000b290: 6f6e 5b73 7472 2c20 2273 716c 616c 6368  on[str, "sqlalch
+0000b2a0: 656d 792e 7371 6c2e 5365 6c65 6374 6162  emy.sql.Selectab
+0000b2b0: 6c65 225d 2c0a 2020 2020 2020 2020 636f  le"],.        co
+0000b2c0: 6e3a 2055 6e69 6f6e 5b73 7472 2c20 2273  n: Union[str, "s
+0000b2d0: 716c 616c 6368 656d 792e 656e 6769 6e65  qlalchemy.engine
+0000b2e0: 2e43 6f6e 6e65 6374 696f 6e22 2c20 2273  .Connection", "s
+0000b2f0: 716c 616c 6368 656d 792e 656e 6769 6e65  qlalchemy.engine
+0000b300: 2e45 6e67 696e 6522 2c20 2273 716c 6974  .Engine", "sqlit
+0000b310: 6533 2e43 6f6e 6e65 6374 696f 6e22 5d2c  e3.Connection"],
+0000b320: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
+0000b330: 733a 204f 7074 696f 6e61 6c5b 4665 6174  s: Optional[Feat
+0000b340: 7572 6573 5d20 3d20 4e6f 6e65 2c0a 2020  ures] = None,.  
+0000b350: 2020 2020 2020 6361 6368 655f 6469 723a        cache_dir:
+0000b360: 2073 7472 203d 204e 6f6e 652c 0a20 2020   str = None,.   
+0000b370: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
+0000b380: 6f72 793a 2062 6f6f 6c20 3d20 4661 6c73  ory: bool = Fals
+0000b390: 652c 0a20 2020 2020 2020 202a 2a6b 7761  e,.        **kwa
+0000b3a0: 7267 732c 0a20 2020 2029 3a0a 2020 2020  rgs,.    ):.    
+0000b3b0: 2020 2020 2222 2243 7265 6174 6520 4461      """Create Da
+0000b3c0: 7461 7365 7420 6672 6f6d 2053 514c 2071  taset from SQL q
+0000b3d0: 7565 7279 206f 7220 6461 7461 6261 7365  uery or database
+0000b3e0: 2074 6162 6c65 2e0a 0a20 2020 2020 2020   table...       
+0000b3f0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+0000b400: 2020 2073 716c 2028 6073 7472 6020 6f72     sql (`str` or
+0000b410: 2060 7371 6c61 6c63 6865 6d79 2e73 716c   `sqlalchemy.sql
+0000b420: 2e53 656c 6563 7461 626c 6560 293a 0a20  .Selectable`):. 
+0000b430: 2020 2020 2020 2020 2020 2020 2020 2053                 S
+0000b440: 514c 2071 7565 7279 2074 6f20 6265 2065  QL query to be e
+0000b450: 7865 6375 7465 6420 6f72 2061 2074 6162  xecuted or a tab
+0000b460: 6c65 206e 616d 652e 0a20 2020 2020 2020  le name..       
+0000b470: 2020 2020 2063 6f6e 2028 6073 7472 6020       con (`str` 
+0000b480: 6f72 2060 7371 6c69 7465 332e 436f 6e6e  or `sqlite3.Conn
+0000b490: 6563 7469 6f6e 6020 6f72 2060 7371 6c61  ection` or `sqla
+0000b4a0: 6c63 6865 6d79 2e65 6e67 696e 652e 436f  lchemy.engine.Co
+0000b4b0: 6e6e 6563 7469 6f6e 6020 6f72 2060 7371  nnection` or `sq
+0000b4c0: 6c61 6c63 6865 6d79 2e65 6e67 696e 652e  lalchemy.engine.
+0000b4d0: 436f 6e6e 6563 7469 6f6e 6029 3a0a 2020  Connection`):.  
+0000b4e0: 2020 2020 2020 2020 2020 2020 2020 4120                A 
+0000b4f0: 5b55 5249 2073 7472 696e 675d 2868 7474  [URI string](htt
+0000b500: 7073 3a2f 2f64 6f63 732e 7371 6c61 6c63  ps://docs.sqlalc
+0000b510: 6865 6d79 2e6f 7267 2f65 6e2f 3133 2f63  hemy.org/en/13/c
+0000b520: 6f72 652f 656e 6769 6e65 732e 6874 6d6c  ore/engines.html
+0000b530: 2364 6174 6162 6173 652d 7572 6c73 2920  #database-urls) 
+0000b540: 7573 6564 2074 6f20 696e 7374 616e 7469  used to instanti
+0000b550: 6174 6520 6120 6461 7461 6261 7365 2063  ate a database c
+0000b560: 6f6e 6e65 6374 696f 6e20 6f72 2061 2053  onnection or a S
+0000b570: 514c 6974 6533 2f53 514c 416c 6368 656d  QLite3/SQLAlchem
+0000b580: 7920 636f 6e6e 6563 7469 6f6e 206f 626a  y connection obj
+0000b590: 6563 742e 0a20 2020 2020 2020 2020 2020  ect..           
+0000b5a0: 2066 6561 7475 7265 7320 285b 6046 6561   features ([`Fea
+0000b5b0: 7475 7265 7360 5d2c 202a 6f70 7469 6f6e  tures`], *option
+0000b5c0: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
+0000b5d0: 2020 2020 2020 4461 7461 7365 7420 6665        Dataset fe
+0000b5e0: 6174 7572 6573 2e0a 2020 2020 2020 2020  atures..        
+0000b5f0: 2020 2020 6361 6368 655f 6469 7220 2860      cache_dir (`
+0000b600: 7374 7260 2c20 2a6f 7074 696f 6e61 6c2a  str`, *optional*
+0000b610: 2c20 6465 6661 756c 7473 2074 6f20 6022  , defaults to `"
+0000b620: 7e2f 2e63 6163 6865 2f68 7567 6769 6e67  ~/.cache/hugging
+0000b630: 6661 6365 2f64 6174 6173 6574 7322 6029  face/datasets"`)
+0000b640: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b650: 2020 4469 7265 6374 6f72 7920 746f 2063    Directory to c
+0000b660: 6163 6865 2064 6174 612e 0a20 2020 2020  ache data..     
+0000b670: 2020 2020 2020 206b 6565 705f 696e 5f6d         keep_in_m
+0000b680: 656d 6f72 7920 2860 626f 6f6c 602c 2064  emory (`bool`, d
+0000b690: 6566 6175 6c74 7320 746f 2060 4661 6c73  efaults to `Fals
+0000b6a0: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
+0000b6b0: 2020 2020 2057 6865 7468 6572 2074 6f20       Whether to 
+0000b6c0: 636f 7079 2074 6865 2064 6174 6120 696e  copy the data in
+0000b6d0: 2d6d 656d 6f72 792e 0a20 2020 2020 2020  -memory..       
+0000b6e0: 2020 2020 202a 2a6b 7761 7267 7320 2861       **kwargs (a
+0000b6f0: 6464 6974 696f 6e61 6c20 6b65 7977 6f72  dditional keywor
+0000b700: 6420 6172 6775 6d65 6e74 7329 3a0a 2020  d arguments):.  
+0000b710: 2020 2020 2020 2020 2020 2020 2020 4b65                Ke
+0000b720: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
+0000b730: 746f 2062 6520 7061 7373 6564 2074 6f20  to be passed to 
+0000b740: 5b60 5371 6c43 6f6e 6669 6760 5d2e 0a0a  [`SqlConfig`]...
+0000b750: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
+0000b760: 0a20 2020 2020 2020 2020 2020 205b 6044  .            [`D
+0000b770: 6174 6173 6574 605d 0a0a 2020 2020 2020  ataset`]..      
+0000b780: 2020 4578 616d 706c 653a 0a0a 2020 2020    Example:..    
+0000b790: 2020 2020 6060 6070 790a 2020 2020 2020      ```py.      
+0000b7a0: 2020 3e3e 3e20 2320 4665 7463 6820 6120    >>> # Fetch a 
+0000b7b0: 6461 7461 6261 7365 2074 6162 6c65 0a20  database table. 
+0000b7c0: 2020 2020 2020 203e 3e3e 2064 7320 3d20         >>> ds = 
+0000b7d0: 4461 7461 7365 742e 6672 6f6d 5f73 716c  Dataset.from_sql
+0000b7e0: 2822 7465 7374 5f64 6174 6122 2c20 2270  ("test_data", "p
+0000b7f0: 6f73 7467 7265 733a 2f2f 2f64 625f 6e61  ostgres:///db_na
+0000b800: 6d65 2229 0a20 2020 2020 2020 203e 3e3e  me").        >>>
+0000b810: 2023 2045 7865 6375 7465 2061 2053 514c   # Execute a SQL
+0000b820: 2071 7565 7279 206f 6e20 7468 6520 7461   query on the ta
+0000b830: 626c 650a 2020 2020 2020 2020 3e3e 3e20  ble.        >>> 
+0000b840: 6473 203d 2044 6174 6173 6574 2e66 726f  ds = Dataset.fro
+0000b850: 6d5f 7371 6c28 2253 454c 4543 5420 7365  m_sql("SELECT se
+0000b860: 6e74 656e 6365 2046 524f 4d20 7465 7374  ntence FROM test
+0000b870: 5f64 6174 6122 2c20 2270 6f73 7467 7265  _data", "postgre
+0000b880: 733a 2f2f 2f64 625f 6e61 6d65 2229 0a20  s:///db_name"). 
+0000b890: 2020 2020 2020 203e 3e3e 2023 2055 7365         >>> # Use
+0000b8a0: 2061 2053 656c 6563 7461 626c 6520 6f62   a Selectable ob
+0000b8b0: 6a65 6374 2074 6f20 7370 6563 6966 7920  ject to specify 
+0000b8c0: 7468 6520 7175 6572 790a 2020 2020 2020  the query.      
+0000b8d0: 2020 3e3e 3e20 6672 6f6d 2073 716c 616c    >>> from sqlal
+0000b8e0: 6368 656d 7920 696d 706f 7274 2073 656c  chemy import sel
+0000b8f0: 6563 742c 2074 6578 740a 2020 2020 2020  ect, text.      
+0000b900: 2020 3e3e 3e20 7374 6d74 203d 2073 656c    >>> stmt = sel
+0000b910: 6563 7428 5b74 6578 7428 2273 656e 7465  ect([text("sente
+0000b920: 6e63 6522 295d 292e 7365 6c65 6374 5f66  nce")]).select_f
+0000b930: 726f 6d28 7465 7874 2822 7465 7374 5f64  rom(text("test_d
+0000b940: 6174 6122 2929 0a20 2020 2020 2020 203e  ata")).        >
+0000b950: 3e3e 2064 7320 3d20 4461 7461 7365 742e  >> ds = Dataset.
+0000b960: 6672 6f6d 5f73 716c 2873 746d 742c 2022  from_sql(stmt, "
+0000b970: 706f 7374 6772 6573 3a2f 2f2f 6462 5f6e  postgres:///db_n
+0000b980: 616d 6522 290a 2020 2020 2020 2020 6060  ame").        ``
+0000b990: 600a 0a20 2020 2020 2020 203c 5469 703e  `..        <Tip>
+0000b9a0: 0a0a 2020 2020 2020 2020 5468 6520 7265  ..        The re
+0000b9b0: 7475 726e 6564 2064 6174 6173 6574 2063  turned dataset c
+0000b9c0: 616e 206f 6e6c 7920 6265 2063 6163 6865  an only be cache
+0000b9d0: 6420 6966 2060 636f 6e60 2069 7320 7370  d if `con` is sp
+0000b9e0: 6563 6966 6965 6420 6173 2055 5249 2073  ecified as URI s
+0000b9f0: 7472 696e 672e 0a0a 2020 2020 2020 2020  tring...        
+0000ba00: 3c2f 5469 703e 0a20 2020 2020 2020 2022  </Tip>.        "
+0000ba10: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+0000ba20: 2e69 6f2e 7371 6c20 696d 706f 7274 2053  .io.sql import S
+0000ba30: 716c 4461 7461 7365 7452 6561 6465 720a  qlDatasetReader.
+0000ba40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000ba50: 5371 6c44 6174 6173 6574 5265 6164 6572  SqlDatasetReader
+0000ba60: 280a 2020 2020 2020 2020 2020 2020 7371  (.            sq
+0000ba70: 6c2c 0a20 2020 2020 2020 2020 2020 2063  l,.            c
+0000ba80: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0000ba90: 6665 6174 7572 6573 3d66 6561 7475 7265  features=feature
+0000baa0: 732c 0a20 2020 2020 2020 2020 2020 2063  s,.            c
+0000bab0: 6163 6865 5f64 6972 3d63 6163 6865 5f64  ache_dir=cache_d
+0000bac0: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
+0000bad0: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 3d6b  keep_in_memory=k
+0000bae0: 6565 705f 696e 5f6d 656d 6f72 792c 0a20  eep_in_memory,. 
+0000baf0: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
+0000bb00: 7267 732c 0a20 2020 2020 2020 2029 2e72  rgs,.        ).r
+0000bb10: 6561 6428 290a 0a20 2020 2064 6566 205f  ead()..    def _
+0000bb20: 5f64 656c 5f5f 2873 656c 6629 3a0a 2020  _del__(self):.  
+0000bb30: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+0000bb40: 2873 656c 662c 2022 5f64 6174 6122 293a  (self, "_data"):
+0000bb50: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+0000bb60: 2073 656c 662e 5f64 6174 610a 2020 2020   self._data.    
+0000bb70: 2020 2020 6966 2068 6173 6174 7472 2873      if hasattr(s
+0000bb80: 656c 662c 2022 5f69 6e64 6963 6573 2229  elf, "_indices")
+0000bb90: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
+0000bba0: 6c20 7365 6c66 2e5f 696e 6469 6365 730a  l self._indices.
+0000bbb0: 0a20 2020 2064 6566 205f 5f65 6e74 6572  .    def __enter
+0000bbc0: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+0000bbd0: 2020 7265 7475 726e 2073 656c 660a 0a20    return self.. 
+0000bbe0: 2020 2064 6566 205f 5f65 7869 745f 5f28     def __exit__(
+0000bbf0: 7365 6c66 2c20 6578 635f 7479 7065 2c20  self, exc_type, 
+0000bc00: 6578 635f 7661 6c2c 2065 7863 5f74 6229  exc_val, exc_tb)
+0000bc10: 3a0a 2020 2020 2020 2020 2320 4865 7265  :.        # Here
+0000bc20: 2060 6465 6c60 2069 7320 7573 6564 2074   `del` is used t
+0000bc30: 6f20 6465 6c20 7468 6520 7079 6172 726f  o del the pyarro
+0000bc40: 7720 7461 626c 6573 2e20 5468 6973 2070  w tables. This p
+0000bc50: 726f 7065 726c 7920 636c 6f73 6573 2074  roperly closes t
+0000bc60: 6865 2066 696c 6573 2075 7365 6420 666f  he files used fo
+0000bc70: 7220 6d65 6d6f 7279 206d 6170 7065 6420  r memory mapped 
+0000bc80: 7461 626c 6573 0a20 2020 2020 2020 2073  tables.        s
+0000bc90: 656c 662e 5f5f 6465 6c5f 5f28 290a 0a20  elf.__del__().. 
+0000bca0: 2020 2064 6566 2073 6176 655f 746f 5f64     def save_to_d
+0000bcb0: 6973 6b28 0a20 2020 2020 2020 2073 656c  isk(.        sel
+0000bcc0: 662c 0a20 2020 2020 2020 2064 6174 6173  f,.        datas
+0000bcd0: 6574 5f70 6174 683a 2050 6174 684c 696b  et_path: PathLik
+0000bce0: 652c 0a20 2020 2020 2020 2066 733d 2264  e,.        fs="d
+0000bcf0: 6570 7265 6361 7465 6422 2c0a 2020 2020  eprecated",.    
+0000bd00: 2020 2020 6d61 785f 7368 6172 645f 7369      max_shard_si
+0000bd10: 7a65 3a20 4f70 7469 6f6e 616c 5b55 6e69  ze: Optional[Uni
+0000bd20: 6f6e 5b73 7472 2c20 696e 745d 5d20 3d20  on[str, int]] = 
+0000bd30: 4e6f 6e65 2c0a 2020 2020 2020 2020 6e75  None,.        nu
+0000bd40: 6d5f 7368 6172 6473 3a20 4f70 7469 6f6e  m_shards: Option
+0000bd50: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a  al[int] = None,.
+0000bd60: 2020 2020 2020 2020 6e75 6d5f 7072 6f63          num_proc
+0000bd70: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+0000bd80: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000bd90: 7374 6f72 6167 655f 6f70 7469 6f6e 733a  storage_options:
+0000bda0: 204f 7074 696f 6e61 6c5b 6469 6374 5d20   Optional[dict] 
+0000bdb0: 3d20 4e6f 6e65 2c0a 2020 2020 293a 0a20  = None,.    ):. 
+0000bdc0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000bdd0: 2020 2053 6176 6573 2061 2064 6174 6173     Saves a datas
+0000bde0: 6574 2074 6f20 6120 6461 7461 7365 7420  et to a dataset 
+0000bdf0: 6469 7265 6374 6f72 792c 206f 7220 696e  directory, or in
+0000be00: 2061 2066 696c 6573 7973 7465 6d20 7573   a filesystem us
+0000be10: 696e 6720 6569 7468 6572 2060 7333 6673  ing either `s3fs
+0000be20: 2e53 3346 696c 6553 7973 7465 6d60 206f  .S3FileSystem` o
+0000be30: 720a 2020 2020 2020 2020 616e 7920 696d  r.        any im
+0000be40: 706c 656d 656e 7461 7469 6f6e 206f 6620  plementation of 
+0000be50: 6066 7373 7065 632e 7370 6563 2e41 6273  `fsspec.spec.Abs
+0000be60: 7472 6163 7446 696c 6553 7973 7465 6d60  tractFileSystem`
+0000be70: 2e0a 0a20 2020 2020 2020 2046 6f72 205b  ...        For [
+0000be80: 6049 6d61 6765 605d 2061 6e64 205b 6041  `Image`] and [`A
+0000be90: 7564 696f 605d 2064 6174 613a 0a0a 2020  udio`] data:..  
+0000bea0: 2020 2020 2020 416c 6c20 7468 6520 496d        All the Im
+0000beb0: 6167 6528 2920 616e 6420 4175 6469 6f28  age() and Audio(
+0000bec0: 2920 6461 7461 2061 7265 2073 746f 7265  ) data are store
+0000bed0: 6420 696e 2074 6865 2061 7272 6f77 2066  d in the arrow f
+0000bee0: 696c 6573 2e0a 2020 2020 2020 2020 4966  iles..        If
+0000bef0: 2079 6f75 2077 616e 7420 746f 2073 746f   you want to sto
+0000bf00: 7265 2070 6174 6873 206f 7220 7572 6c73  re paths or urls
+0000bf10: 2c20 706c 6561 7365 2075 7365 2074 6865  , please use the
+0000bf20: 2056 616c 7565 2822 7374 7269 6e67 2229   Value("string")
+0000bf30: 2074 7970 652e 0a0a 2020 2020 2020 2020   type...        
+0000bf40: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+0000bf50: 2020 6461 7461 7365 745f 7061 7468 2028    dataset_path (
+0000bf60: 6073 7472 6029 3a0a 2020 2020 2020 2020  `str`):.        
+0000bf70: 2020 2020 2020 2020 5061 7468 2028 652e          Path (e.
+0000bf80: 672e 2060 6461 7461 7365 742f 7472 6169  g. `dataset/trai
+0000bf90: 6e60 2920 6f72 2072 656d 6f74 6520 5552  n`) or remote UR
+0000bfa0: 4920 2865 2e67 2e20 6073 333a 2f2f 6d79  I (e.g. `s3://my
+0000bfb0: 2d62 7563 6b65 742f 6461 7461 7365 742f  -bucket/dataset/
+0000bfc0: 7472 6169 6e60 290a 2020 2020 2020 2020  train`).        
+0000bfd0: 2020 2020 2020 2020 6f66 2074 6865 2064          of the d
+0000bfe0: 6174 6173 6574 2064 6972 6563 746f 7279  ataset directory
+0000bff0: 2077 6865 7265 2074 6865 2064 6174 6173   where the datas
+0000c000: 6574 2077 696c 6c20 6265 2073 6176 6564  et will be saved
+0000c010: 2074 6f2e 0a20 2020 2020 2020 2020 2020   to..           
+0000c020: 2066 7320 2860 6673 7370 6563 2e73 7065   fs (`fsspec.spe
+0000c030: 632e 4162 7374 7261 6374 4669 6c65 5379  c.AbstractFileSy
+0000c040: 7374 656d 602c 202a 6f70 7469 6f6e 616c  stem`, *optional
+0000c050: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
+0000c060: 2020 2020 496e 7374 616e 6365 206f 6620      Instance of 
+0000c070: 7468 6520 7265 6d6f 7465 2066 696c 6573  the remote files
+0000c080: 7973 7465 6d20 7768 6572 6520 7468 6520  ystem where the 
+0000c090: 6461 7461 7365 7420 7769 6c6c 2062 6520  dataset will be 
+0000c0a0: 7361 7665 6420 746f 2e0a 0a20 2020 2020  saved to...     
+0000c0b0: 2020 2020 2020 2020 2020 203c 4465 7072             <Depr
+0000c0c0: 6563 6174 6564 2076 6572 7369 6f6e 3d22  ecated version="
+0000c0d0: 322e 382e 3022 3e0a 0a20 2020 2020 2020  2.8.0">..       
+0000c0e0: 2020 2020 2020 2020 2060 6673 6020 7761           `fs` wa
+0000c0f0: 7320 6465 7072 6563 6174 6564 2069 6e20  s deprecated in 
+0000c100: 7665 7273 696f 6e20 322e 382e 3020 616e  version 2.8.0 an
+0000c110: 6420 7769 6c6c 2062 6520 7265 6d6f 7665  d will be remove
+0000c120: 6420 696e 2033 2e30 2e30 2e0a 2020 2020  d in 3.0.0..    
+0000c130: 2020 2020 2020 2020 2020 2020 506c 6561              Plea
+0000c140: 7365 2075 7365 2060 7374 6f72 6167 655f  se use `storage_
+0000c150: 6f70 7469 6f6e 7360 2069 6e73 7465 6164  options` instead
+0000c160: 2c20 652e 672e 2060 7374 6f72 6167 655f  , e.g. `storage_
+0000c170: 6f70 7469 6f6e 733d 6673 2e73 746f 7261  options=fs.stora
+0000c180: 6765 5f6f 7074 696f 6e73 600a 0a20 2020  ge_options`..   
+0000c190: 2020 2020 2020 2020 2020 2020 203c 2f44               </D
+0000c1a0: 6570 7265 6361 7465 643e 0a0a 2020 2020  eprecated>..    
+0000c1b0: 2020 2020 2020 2020 6d61 785f 7368 6172          max_shar
+0000c1c0: 645f 7369 7a65 2028 6069 6e74 6020 6f72  d_size (`int` or
+0000c1d0: 2060 7374 7260 2c20 2a6f 7074 696f 6e61   `str`, *optiona
+0000c1e0: 6c2a 2c20 6465 6661 756c 7473 2074 6f20  l*, defaults to 
+0000c1f0: 6022 3530 304d 4222 6029 3a0a 2020 2020  `"500MB"`):.    
+0000c200: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0000c210: 6d61 7869 6d75 6d20 7369 7a65 206f 6620  maximum size of 
+0000c220: 7468 6520 6461 7461 7365 7420 7368 6172  the dataset shar
+0000c230: 6473 2074 6f20 6265 2075 706c 6f61 6465  ds to be uploade
+0000c240: 6420 746f 2074 6865 2068 7562 2e20 4966  d to the hub. If
+0000c250: 2065 7870 7265 7373 6564 2061 7320 6120   expressed as a 
+0000c260: 7374 7269 6e67 2c20 6e65 6564 7320 746f  string, needs to
+0000c270: 2062 6520 6469 6769 7473 2066 6f6c 6c6f   be digits follo
+0000c280: 7765 6420 6279 2061 2075 6e69 740a 2020  wed by a unit.  
+0000c290: 2020 2020 2020 2020 2020 2020 2020 286c                (l
+0000c2a0: 696b 6520 6022 3530 4d42 2260 292e 0a20  ike `"50MB"`).. 
+0000c2b0: 2020 2020 2020 2020 2020 206e 756d 5f73             num_s
+0000c2c0: 6861 7264 7320 2860 696e 7460 2c20 2a6f  hards (`int`, *o
+0000c2d0: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
+0000c2e0: 2020 2020 2020 2020 2020 204e 756d 6265             Numbe
+0000c2f0: 7220 6f66 2073 6861 7264 7320 746f 2077  r of shards to w
+0000c300: 7269 7465 2e20 4279 2064 6566 6175 6c74  rite. By default
+0000c310: 2074 6865 206e 756d 6265 7220 6f66 2073   the number of s
+0000c320: 6861 7264 7320 6465 7065 6e64 7320 6f6e  hards depends on
+0000c330: 2060 6d61 785f 7368 6172 645f 7369 7a65   `max_shard_size
+0000c340: 602e 0a0a 2020 2020 2020 2020 2020 2020  `...            
+0000c350: 2020 2020 3c41 6464 6564 2076 6572 7369      <Added versi
+0000c360: 6f6e 3d22 322e 382e 3022 2f3e 0a20 2020  on="2.8.0"/>.   
+0000c370: 2020 2020 2020 2020 206e 756d 5f70 726f           num_pro
+0000c380: 6320 2860 696e 7460 2c20 2a6f 7074 696f  c (`int`, *optio
+0000c390: 6e61 6c2a 293a 0a20 2020 2020 2020 2020  nal*):.         
+0000c3a0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
+0000c3b0: 2070 726f 6365 7373 6573 2077 6865 6e20   processes when 
+0000c3c0: 646f 776e 6c6f 6164 696e 6720 616e 6420  downloading and 
+0000c3d0: 6765 6e65 7261 7469 6e67 2074 6865 2064  generating the d
+0000c3e0: 6174 6173 6574 206c 6f63 616c 6c79 2e0a  ataset locally..
+0000c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c400: 4d75 6c74 6970 726f 6365 7373 696e 6720  Multiprocessing 
+0000c410: 6973 2064 6973 6162 6c65 6420 6279 2064  is disabled by d
+0000c420: 6566 6175 6c74 2e0a 0a20 2020 2020 2020  efault...       
+0000c430: 2020 2020 2020 2020 203c 4164 6465 6420           <Added 
+0000c440: 7665 7273 696f 6e3d 2232 2e38 2e30 222f  version="2.8.0"/
+0000c450: 3e0a 2020 2020 2020 2020 2020 2020 7374  >.            st
+0000c460: 6f72 6167 655f 6f70 7469 6f6e 7320 2860  orage_options (`
+0000c470: 6469 6374 602c 202a 6f70 7469 6f6e 616c  dict`, *optional
+0000c480: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
+0000c490: 2020 2020 4b65 792f 7661 6c75 6520 7061      Key/value pa
+0000c4a0: 6972 7320 746f 2062 6520 7061 7373 6564  irs to be passed
+0000c4b0: 206f 6e20 746f 2074 6865 2066 696c 652d   on to the file-
+0000c4c0: 7379 7374 656d 2062 6163 6b65 6e64 2c20  system backend, 
+0000c4d0: 6966 2061 6e79 2e0a 0a20 2020 2020 2020  if any...       
+0000c4e0: 2020 2020 2020 2020 203c 4164 6465 6420           <Added 
+0000c4f0: 7665 7273 696f 6e3d 2232 2e38 2e30 222f  version="2.8.0"/
+0000c500: 3e0a 0a20 2020 2020 2020 2045 7861 6d70  >..        Examp
+0000c510: 6c65 3a0a 0a20 2020 2020 2020 2060 6060  le:..        ```
+0000c520: 7079 0a20 2020 2020 2020 203e 3e3e 2064  py.        >>> d
+0000c530: 732e 7361 7665 5f74 6f5f 6469 736b 2822  s.save_to_disk("
+0000c540: 7061 7468 2f74 6f2f 6461 7461 7365 742f  path/to/dataset/
+0000c550: 6469 7265 6374 6f72 7922 290a 2020 2020  directory").    
+0000c560: 2020 2020 3e3e 3e20 6473 2e73 6176 655f      >>> ds.save_
+0000c570: 746f 5f64 6973 6b28 2270 6174 682f 746f  to_disk("path/to
+0000c580: 2f64 6174 6173 6574 2f64 6972 6563 746f  /dataset/directo
+0000c590: 7279 222c 206d 6178 5f73 6861 7264 5f73  ry", max_shard_s
+0000c5a0: 697a 653d 2231 4742 2229 0a20 2020 2020  ize="1GB").     
+0000c5b0: 2020 203e 3e3e 2064 732e 7361 7665 5f74     >>> ds.save_t
+0000c5c0: 6f5f 6469 736b 2822 7061 7468 2f74 6f2f  o_disk("path/to/
+0000c5d0: 6461 7461 7365 742f 6469 7265 6374 6f72  dataset/director
+0000c5e0: 7922 2c20 6e75 6d5f 7368 6172 6473 3d31  y", num_shards=1
+0000c5f0: 3032 3429 0a20 2020 2020 2020 2060 6060  024).        ```
+0000c600: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000c610: 2020 2020 2069 6620 6d61 785f 7368 6172       if max_shar
+0000c620: 645f 7369 7a65 2069 7320 6e6f 7420 4e6f  d_size is not No
+0000c630: 6e65 2061 6e64 206e 756d 5f73 6861 7264  ne and num_shard
+0000c640: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+0000c650: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000c660: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0000c670: 2020 2020 2020 2020 2020 2020 2022 4661               "Fa
+0000c680: 696c 6564 2074 6f20 7075 7368 5f74 6f5f  iled to push_to_
+0000c690: 6875 623a 2070 6c65 6173 6520 7370 6563  hub: please spec
+0000c6a0: 6966 7920 6569 7468 6572 206d 6178 5f73  ify either max_s
+0000c6b0: 6861 7264 5f73 697a 6520 6f72 206e 756d  hard_size or num
+0000c6c0: 5f73 6861 7264 732c 2062 7574 206e 6f74  _shards, but not
+0000c6d0: 2062 6f74 682e 220a 2020 2020 2020 2020   both.".        
+0000c6e0: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
+0000c6f0: 2066 7320 213d 2022 6465 7072 6563 6174   fs != "deprecat
+0000c700: 6564 223a 0a20 2020 2020 2020 2020 2020  ed":.           
+0000c710: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
+0000c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c730: 2227 6673 2720 7761 7320 6973 2064 6570  "'fs' was is dep
+0000c740: 7265 6361 7465 6420 696e 2066 6176 6f72  recated in favor
+0000c750: 206f 6620 2773 746f 7261 6765 5f6f 7074   of 'storage_opt
+0000c760: 696f 6e73 2720 696e 2076 6572 7369 6f6e  ions' in version
+0000c770: 2032 2e38 2e30 2061 6e64 2077 696c 6c20   2.8.0 and will 
+0000c780: 6265 2072 656d 6f76 6564 2069 6e20 332e  be removed in 3.
+0000c790: 302e 302e 5c6e 220a 2020 2020 2020 2020  0.0.\n".        
+0000c7a0: 2020 2020 2020 2020 2259 6f75 2063 616e          "You can
+0000c7b0: 2072 656d 6f76 6520 7468 6973 2077 6172   remove this war
+0000c7c0: 6e69 6e67 2062 7920 7061 7373 696e 6720  ning by passing 
+0000c7d0: 2773 746f 7261 6765 5f6f 7074 696f 6e73  'storage_options
+0000c7e0: 3d66 732e 7374 6f72 6167 655f 6f70 7469  =fs.storage_opti
+0000c7f0: 6f6e 7327 2069 6e73 7465 6164 2e22 2c0a  ons' instead.",.
+0000c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c810: 4675 7475 7265 5761 726e 696e 672c 0a20  FutureWarning,. 
+0000c820: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000c830: 2020 2020 2020 2020 2073 746f 7261 6765           storage
+0000c840: 5f6f 7074 696f 6e73 203d 2066 732e 7374  _options = fs.st
+0000c850: 6f72 6167 655f 6f70 7469 6f6e 730a 0a20  orage_options.. 
+0000c860: 2020 2020 2020 2069 6620 6e75 6d5f 7368         if num_sh
+0000c870: 6172 6473 2069 7320 4e6f 6e65 3a0a 2020  ards is None:.  
+0000c880: 2020 2020 2020 2020 2020 6461 7461 7365            datase
+0000c890: 745f 6e62 7974 6573 203d 2073 656c 662e  t_nbytes = self.
+0000c8a0: 5f65 7374 696d 6174 655f 6e62 7974 6573  _estimate_nbytes
+0000c8b0: 2829 0a20 2020 2020 2020 2020 2020 206d  ().            m
+0000c8c0: 6178 5f73 6861 7264 5f73 697a 6520 3d20  ax_shard_size = 
+0000c8d0: 636f 6e76 6572 745f 6669 6c65 5f73 697a  convert_file_siz
+0000c8e0: 655f 746f 5f69 6e74 286d 6178 5f73 6861  e_to_int(max_sha
+0000c8f0: 7264 5f73 697a 6520 6f72 2063 6f6e 6669  rd_size or confi
+0000c900: 672e 4d41 585f 5348 4152 445f 5349 5a45  g.MAX_SHARD_SIZE
+0000c910: 290a 2020 2020 2020 2020 2020 2020 6e75  ).            nu
+0000c920: 6d5f 7368 6172 6473 203d 2069 6e74 2864  m_shards = int(d
+0000c930: 6174 6173 6574 5f6e 6279 7465 7320 2f20  ataset_nbytes / 
+0000c940: 6d61 785f 7368 6172 645f 7369 7a65 2920  max_shard_size) 
+0000c950: 2b20 310a 2020 2020 2020 2020 2020 2020  + 1.            
+0000c960: 6e75 6d5f 7368 6172 6473 203d 206d 6178  num_shards = max
+0000c970: 286e 756d 5f73 6861 7264 732c 206e 756d  (num_shards, num
+0000c980: 5f70 726f 6320 6f72 2031 290a 0a20 2020  _proc or 1)..   
+0000c990: 2020 2020 206e 756d 5f70 726f 6320 3d20       num_proc = 
+0000c9a0: 6e75 6d5f 7072 6f63 2069 6620 6e75 6d5f  num_proc if num_
+0000c9b0: 7072 6f63 2069 7320 6e6f 7420 4e6f 6e65  proc is not None
+0000c9c0: 2065 6c73 6520 310a 2020 2020 2020 2020   else 1.        
+0000c9d0: 6e75 6d5f 7368 6172 6473 203d 206e 756d  num_shards = num
+0000c9e0: 5f73 6861 7264 7320 6966 206e 756d 5f73  _shards if num_s
+0000c9f0: 6861 7264 7320 6973 206e 6f74 204e 6f6e  hards is not Non
+0000ca00: 6520 656c 7365 206e 756d 5f70 726f 630a  e else num_proc.
+0000ca10: 0a20 2020 2020 2020 2066 735f 746f 6b65  .        fs_toke
+0000ca20: 6e5f 7061 7468 7320 3d20 6673 7370 6563  n_paths = fsspec
+0000ca30: 2e67 6574 5f66 735f 746f 6b65 6e5f 7061  .get_fs_token_pa
+0000ca40: 7468 7328 6461 7461 7365 745f 7061 7468  ths(dataset_path
+0000ca50: 2c20 7374 6f72 6167 655f 6f70 7469 6f6e  , storage_option
+0000ca60: 733d 7374 6f72 6167 655f 6f70 7469 6f6e  s=storage_option
+0000ca70: 7329 0a20 2020 2020 2020 2066 733a 2066  s).        fs: f
+0000ca80: 7373 7065 632e 4162 7374 7261 6374 4669  sspec.AbstractFi
+0000ca90: 6c65 5379 7374 656d 203d 2066 735f 746f  leSystem = fs_to
+0000caa0: 6b65 6e5f 7061 7468 735b 305d 0a20 2020  ken_paths[0].   
+0000cab0: 2020 2020 2069 735f 6c6f 6361 6c20 3d20       is_local = 
+0000cac0: 6e6f 7420 6973 5f72 656d 6f74 655f 6669  not is_remote_fi
+0000cad0: 6c65 7379 7374 656d 2866 7329 0a20 2020  lesystem(fs).   
+0000cae0: 2020 2020 2070 6174 685f 6a6f 696e 203d       path_join =
+0000caf0: 206f 732e 7061 7468 2e6a 6f69 6e20 6966   os.path.join if
+0000cb00: 2069 735f 6c6f 6361 6c20 656c 7365 2070   is_local else p
+0000cb10: 6f73 6978 7061 7468 2e6a 6f69 6e0a 0a20  osixpath.join.. 
+0000cb20: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
+0000cb30: 6973 745f 696e 6465 7865 7328 293a 0a20  ist_indexes():. 
+0000cb40: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000cb50: 2056 616c 7565 4572 726f 7228 2270 6c65   ValueError("ple
+0000cb60: 6173 6520 7265 6d6f 7665 2061 6c6c 2074  ase remove all t
+0000cb70: 6865 2069 6e64 6578 6573 2075 7369 6e67  he indexes using
+0000cb80: 2060 6461 7461 7365 742e 6472 6f70 5f69   `dataset.drop_i
+0000cb90: 6e64 6578 6020 6265 666f 7265 2073 6176  ndex` before sav
+0000cba0: 696e 6720 6120 6461 7461 7365 7422 290a  ing a dataset").
+0000cbb0: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
+0000cbc0: 203d 2073 656c 662e 666c 6174 7465 6e5f   = self.flatten_
+0000cbd0: 696e 6469 6365 7328 6e75 6d5f 7072 6f63  indices(num_proc
+0000cbe0: 3d6e 756d 5f70 726f 6329 2069 6620 7365  =num_proc) if se
+0000cbf0: 6c66 2e5f 696e 6469 6365 7320 6973 206e  lf._indices is n
+0000cc00: 6f74 204e 6f6e 6520 656c 7365 2073 656c  ot None else sel
+0000cc10: 660a 0a20 2020 2020 2020 2069 6620 6973  f..        if is
+0000cc20: 5f6c 6f63 616c 3a0a 2020 2020 2020 2020  _local:.        
+0000cc30: 2020 2020 5061 7468 2864 6174 6173 6574      Path(dataset
+0000cc40: 5f70 6174 6829 2e72 6573 6f6c 7665 2829  _path).resolve()
+0000cc50: 2e6d 6b64 6972 2870 6172 656e 7473 3d54  .mkdir(parents=T
+0000cc60: 7275 652c 2065 7869 7374 5f6f 6b3d 5472  rue, exist_ok=Tr
+0000cc70: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+0000cc80: 7061 7265 6e74 5f63 6163 6865 5f66 696c  parent_cache_fil
+0000cc90: 6573 5f70 6174 6873 203d 2073 6574 280a  es_paths = set(.
+0000cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ccb0: 5061 7468 2863 6163 6865 5f66 696c 656e  Path(cache_filen
+0000ccc0: 616d 655b 2266 696c 656e 616d 6522 5d29  ame["filename"])
+0000ccd0: 2e72 6573 6f6c 7665 2829 2e70 6172 656e  .resolve().paren
+0000cce0: 7420 666f 7220 6361 6368 655f 6669 6c65  t for cache_file
+0000ccf0: 6e61 6d65 2069 6e20 7365 6c66 2e63 6163  name in self.cac
+0000cd00: 6865 5f66 696c 6573 0a20 2020 2020 2020  he_files.       
+0000cd10: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000cd20: 2020 2023 2043 6865 636b 2074 6861 7420     # Check that 
+0000cd30: 7468 6520 6461 7461 7365 7420 646f 6573  the dataset does
+0000cd40: 6e27 7420 6f76 6572 7772 6974 6520 6973  n't overwrite is
+0000cd50: 656c 662e 2049 7420 6361 6e20 6361 7573  elf. It can caus
+0000cd60: 6520 6120 7065 726d 6973 7369 6f6e 2065  e a permission e
+0000cd70: 7272 6f72 206f 6e20 5769 6e64 6f77 7320  rror on Windows 
+0000cd80: 616e 6420 6120 7365 6766 6175 6c74 206f  and a segfault o
+0000cd90: 6e20 6c69 6e75 782e 0a20 2020 2020 2020  n linux..       
+0000cda0: 2020 2020 2069 6620 5061 7468 2864 6174       if Path(dat
+0000cdb0: 6173 6574 5f70 6174 6829 2e72 6573 6f6c  aset_path).resol
+0000cdc0: 7665 2829 2069 6e20 7061 7265 6e74 5f63  ve() in parent_c
+0000cdd0: 6163 6865 5f66 696c 6573 5f70 6174 6873  ache_files_paths
+0000cde0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000cdf0: 2020 7261 6973 6520 5065 726d 6973 7369    raise Permissi
+0000ce00: 6f6e 4572 726f 7228 0a20 2020 2020 2020  onError(.       
+0000ce10: 2020 2020 2020 2020 2020 2020 2066 2254               f"T
+0000ce20: 7269 6564 2074 6f20 6f76 6572 7772 6974  ried to overwrit
+0000ce30: 6520 7b50 6174 6828 6461 7461 7365 745f  e {Path(dataset_
+0000ce40: 7061 7468 292e 7265 736f 6c76 6528 297d  path).resolve()}
+0000ce50: 2062 7574 2061 2064 6174 6173 6574 2063   but a dataset c
+0000ce60: 616e 2774 206f 7665 7277 7269 7465 2069  an't overwrite i
+0000ce70: 7473 656c 662e 220a 2020 2020 2020 2020  tself.".        
+0000ce80: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000ce90: 2020 2023 2047 6574 206a 736f 6e20 7365     # Get json se
+0000cea0: 7269 616c 697a 6162 6c65 2073 7461 7465  rializable state
+0000ceb0: 0a20 2020 2020 2020 2073 7461 7465 203d  .        state =
+0000cec0: 207b 0a20 2020 2020 2020 2020 2020 206b   {.            k
+0000ced0: 6579 3a20 6461 7461 7365 742e 5f5f 6469  ey: dataset.__di
+0000cee0: 6374 5f5f 5b6b 6579 5d0a 2020 2020 2020  ct__[key].      
+0000cef0: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
+0000cf00: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+0000cf10: 2020 2022 5f66 696e 6765 7270 7269 6e74     "_fingerprint
+0000cf20: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000cf30: 2020 2022 5f66 6f72 6d61 745f 636f 6c75     "_format_colu
+0000cf40: 6d6e 7322 2c0a 2020 2020 2020 2020 2020  mns",.          
+0000cf50: 2020 2020 2020 225f 666f 726d 6174 5f6b        "_format_k
+0000cf60: 7761 7267 7322 2c0a 2020 2020 2020 2020  wargs",.        
+0000cf70: 2020 2020 2020 2020 225f 666f 726d 6174          "_format
+0000cf80: 5f74 7970 6522 2c0a 2020 2020 2020 2020  _type",.        
+0000cf90: 2020 2020 2020 2020 225f 6f75 7470 7574          "_output
+0000cfa0: 5f61 6c6c 5f63 6f6c 756d 6e73 222c 0a20  _all_columns",. 
+0000cfb0: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
+0000cfc0: 2020 2020 207d 0a20 2020 2020 2020 2073       }.        s
+0000cfd0: 7461 7465 5b22 5f73 706c 6974 225d 203d  tate["_split"] =
+0000cfe0: 2073 7472 2864 6174 6173 6574 2e73 706c   str(dataset.spl
+0000cff0: 6974 2920 6966 2064 6174 6173 6574 2e73  it) if dataset.s
+0000d000: 706c 6974 2069 7320 6e6f 7420 4e6f 6e65  plit is not None
+0000d010: 2065 6c73 6520 6461 7461 7365 742e 7370   else dataset.sp
+0000d020: 6c69 740a 2020 2020 2020 2020 7374 6174  lit.        stat
+0000d030: 655b 225f 6461 7461 5f66 696c 6573 225d  e["_data_files"]
+0000d040: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+0000d050: 207b 2266 696c 656e 616d 6522 3a20 6622   {"filename": f"
+0000d060: 6461 7461 2d7b 7368 6172 645f 6964 783a  data-{shard_idx:
+0000d070: 3035 647d 2d6f 662d 7b6e 756d 5f73 6861  05d}-of-{num_sha
+0000d080: 7264 733a 3035 647d 2e61 7272 6f77 227d  rds:05d}.arrow"}
+0000d090: 2066 6f72 2073 6861 7264 5f69 6478 2069   for shard_idx i
+0000d0a0: 6e20 7261 6e67 6528 6e75 6d5f 7368 6172  n range(num_shar
+0000d0b0: 6473 290a 2020 2020 2020 2020 5d0a 2020  ds).        ].  
+0000d0c0: 2020 2020 2020 666f 7220 6b20 696e 2073        for k in s
+0000d0d0: 7461 7465 5b22 5f66 6f72 6d61 745f 6b77  tate["_format_kw
+0000d0e0: 6172 6773 225d 2e6b 6579 7328 293a 0a20  args"].keys():. 
+0000d0f0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0000d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d110: 6a73 6f6e 2e64 756d 7073 2873 7461 7465  json.dumps(state
+0000d120: 5b22 5f66 6f72 6d61 745f 6b77 6172 6773  ["_format_kwargs
+0000d130: 225d 5b6b 5d29 0a20 2020 2020 2020 2020  "][k]).         
+0000d140: 2020 2065 7863 6570 7420 5479 7065 4572     except TypeEr
+0000d150: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+0000d160: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000d170: 5479 7065 4572 726f 7228 0a20 2020 2020  TypeError(.     
+0000d180: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000d190: 7472 2865 2920 2b20 6622 5c6e 5468 6520  tr(e) + f"\nThe 
+0000d1a0: 666f 726d 6174 206b 7761 7267 7320 6d75  format kwargs mu
+0000d1b0: 7374 2062 6520 4a53 4f4e 2073 6572 6961  st be JSON seria
+0000d1c0: 6c69 7a61 626c 652c 2062 7574 206b 6579  lizable, but key
+0000d1d0: 2027 7b6b 7d27 2069 736e 2774 2e22 0a20   '{k}' isn't.". 
+0000d1e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000d1f0: 2066 726f 6d20 4e6f 6e65 0a20 2020 2020   from None.     
+0000d200: 2020 2023 2047 6574 206a 736f 6e20 7365     # Get json se
+0000d210: 7269 616c 697a 6162 6c65 2064 6174 6173  rializable datas
+0000d220: 6574 2069 6e66 6f0a 2020 2020 2020 2020  et info.        
+0000d230: 6461 7461 7365 745f 696e 666f 203d 2061  dataset_info = a
+0000d240: 7364 6963 7428 6461 7461 7365 742e 5f69  sdict(dataset._i
+0000d250: 6e66 6f29 0a0a 2020 2020 2020 2020 7368  nfo)..        sh
+0000d260: 6172 6473 5f64 6f6e 6520 3d20 300a 2020  ards_done = 0.  
+0000d270: 2020 2020 2020 7062 6172 203d 206c 6f67        pbar = log
+0000d280: 6769 6e67 2e74 7164 6d28 0a20 2020 2020  ging.tqdm(.     
+0000d290: 2020 2020 2020 2064 6973 6162 6c65 3d6e         disable=n
+0000d2a0: 6f74 206c 6f67 6769 6e67 2e69 735f 7072  ot logging.is_pr
+0000d2b0: 6f67 7265 7373 5f62 6172 5f65 6e61 626c  ogress_bar_enabl
+0000d2c0: 6564 2829 2c0a 2020 2020 2020 2020 2020  ed(),.          
+0000d2d0: 2020 756e 6974 3d22 2065 7861 6d70 6c65    unit=" example
+0000d2e0: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+0000d2f0: 746f 7461 6c3d 6c65 6e28 6461 7461 7365  total=len(datase
+0000d300: 7429 2c0a 2020 2020 2020 2020 2020 2020  t),.            
+0000d310: 6c65 6176 653d 4661 6c73 652c 0a20 2020  leave=False,.   
+0000d320: 2020 2020 2020 2020 2064 6573 633d 6622           desc=f"
+0000d330: 5361 7669 6e67 2074 6865 2064 6174 6173  Saving the datas
+0000d340: 6574 2028 7b73 6861 7264 735f 646f 6e65  et ({shards_done
+0000d350: 7d2f 7b6e 756d 5f73 6861 7264 737d 2073  }/{num_shards} s
+0000d360: 6861 7264 7329 222c 0a20 2020 2020 2020  hards)",.       
+0000d370: 2029 0a20 2020 2020 2020 206b 7761 7267   ).        kwarg
+0000d380: 735f 7065 725f 6a6f 6220 3d20 280a 2020  s_per_job = (.  
+0000d390: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
+0000d3a0: 2020 2020 2020 2020 2020 2020 226a 6f62              "job
+0000d3b0: 5f69 6422 3a20 7368 6172 645f 6964 782c  _id": shard_idx,
+0000d3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d3d0: 2022 7368 6172 6422 3a20 6461 7461 7365   "shard": datase
+0000d3e0: 742e 7368 6172 6428 6e75 6d5f 7368 6172  t.shard(num_shar
+0000d3f0: 6473 3d6e 756d 5f73 6861 7264 732c 2069  ds=num_shards, i
+0000d400: 6e64 6578 3d73 6861 7264 5f69 6478 2c20  ndex=shard_idx, 
+0000d410: 636f 6e74 6967 756f 7573 3d54 7275 6529  contiguous=True)
+0000d420: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d430: 2020 2266 7061 7468 223a 2070 6174 685f    "fpath": path_
+0000d440: 6a6f 696e 2864 6174 6173 6574 5f70 6174  join(dataset_pat
+0000d450: 682c 2066 2264 6174 612d 7b73 6861 7264  h, f"data-{shard
+0000d460: 5f69 6478 3a30 3564 7d2d 6f66 2d7b 6e75  _idx:05d}-of-{nu
+0000d470: 6d5f 7368 6172 6473 3a30 3564 7d2e 6172  m_shards:05d}.ar
+0000d480: 726f 7722 292c 0a20 2020 2020 2020 2020  row"),.         
+0000d490: 2020 2020 2020 2022 7374 6f72 6167 655f         "storage_
+0000d4a0: 6f70 7469 6f6e 7322 3a20 7374 6f72 6167  options": storag
+0000d4b0: 655f 6f70 7469 6f6e 732c 0a20 2020 2020  e_options,.     
+0000d4c0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0000d4d0: 2020 2020 2066 6f72 2073 6861 7264 5f69       for shard_i
+0000d4e0: 6478 2069 6e20 7261 6e67 6528 6e75 6d5f  dx in range(num_
+0000d4f0: 7368 6172 6473 290a 2020 2020 2020 2020  shards).        
+0000d500: 290a 2020 2020 2020 2020 7368 6172 645f  ).        shard_
+0000d510: 6c65 6e67 7468 7320 3d20 5b4e 6f6e 655d  lengths = [None]
+0000d520: 202a 206e 756d 5f73 6861 7264 730a 2020   * num_shards.  
+0000d530: 2020 2020 2020 7368 6172 645f 7369 7a65        shard_size
+0000d540: 7320 3d20 5b4e 6f6e 655d 202a 206e 756d  s = [None] * num
+0000d550: 5f73 6861 7264 730a 2020 2020 2020 2020  _shards.        
+0000d560: 6966 206e 756d 5f70 726f 6320 3e20 313a  if num_proc > 1:
+0000d570: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0000d580: 6820 506f 6f6c 286e 756d 5f70 726f 6329  h Pool(num_proc)
+0000d590: 2061 7320 706f 6f6c 3a0a 2020 2020 2020   as pool:.      
+0000d5a0: 2020 2020 2020 2020 2020 666f 7220 6a6f            for jo
+0000d5b0: 625f 6964 2c20 646f 6e65 2c20 636f 6e74  b_id, done, cont
+0000d5c0: 656e 7420 696e 2069 666c 6174 6d61 705f  ent in iflatmap_
+0000d5d0: 756e 6f72 6465 7265 6428 0a20 2020 2020  unordered(.     
+0000d5e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000d5f0: 6f6f 6c2c 2044 6174 6173 6574 2e5f 7361  ool, Dataset._sa
+0000d600: 7665 5f74 6f5f 6469 736b 5f73 696e 676c  ve_to_disk_singl
+0000d610: 652c 206b 7761 7267 735f 6974 6572 6162  e, kwargs_iterab
+0000d620: 6c65 3d6b 7761 7267 735f 7065 725f 6a6f  le=kwargs_per_jo
+0000d630: 620a 2020 2020 2020 2020 2020 2020 2020  b.              
+0000d640: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0000d650: 2020 2020 2020 2020 2069 6620 646f 6e65           if done
+0000d660: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d670: 2020 2020 2020 2020 2020 7368 6172 6473            shards
+0000d680: 5f64 6f6e 6520 2b3d 2031 0a20 2020 2020  _done += 1.     
+0000d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6a0: 2020 2070 6261 722e 7365 745f 6465 7363     pbar.set_desc
+0000d6b0: 7269 7074 696f 6e28 6622 5361 7669 6e67  ription(f"Saving
+0000d6c0: 2074 6865 2064 6174 6173 6574 2028 7b73   the dataset ({s
+0000d6d0: 6861 7264 735f 646f 6e65 7d2f 7b6e 756d  hards_done}/{num
+0000d6e0: 5f73 6861 7264 737d 2073 6861 7264 7329  _shards} shards)
+0000d6f0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000d700: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0000d710: 722e 6465 6275 6728 6622 4669 6e69 7368  r.debug(f"Finish
+0000d720: 6564 2077 7269 7469 6e67 2073 6861 7264  ed writing shard
+0000d730: 206e 756d 6265 7220 7b6a 6f62 5f69 647d   number {job_id}
+0000d740: 206f 6620 7b6e 756d 5f73 6861 7264 737d   of {num_shards}
+0000d750: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0000d760: 2020 2020 2020 2020 2020 2020 7368 6172              shar
+0000d770: 645f 6c65 6e67 7468 735b 6a6f 625f 6964  d_lengths[job_id
+0000d780: 5d2c 2073 6861 7264 5f73 697a 6573 5b6a  ], shard_sizes[j
+0000d790: 6f62 5f69 645d 203d 2063 6f6e 7465 6e74  ob_id] = content
+0000d7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d7b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d7d0: 2020 2070 6261 722e 7570 6461 7465 2863     pbar.update(c
+0000d7e0: 6f6e 7465 6e74 290a 2020 2020 2020 2020  ontent).        
+0000d7f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000d800: 2020 666f 7220 6b77 6172 6773 2069 6e20    for kwargs in 
+0000d810: 6b77 6172 6773 5f70 6572 5f6a 6f62 3a0a  kwargs_per_job:.
+0000d820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d830: 666f 7220 6a6f 625f 6964 2c20 646f 6e65  for job_id, done
+0000d840: 2c20 636f 6e74 656e 7420 696e 2044 6174  , content in Dat
+0000d850: 6173 6574 2e5f 7361 7665 5f74 6f5f 6469  aset._save_to_di
+0000d860: 736b 5f73 696e 676c 6528 2a2a 6b77 6172  sk_single(**kwar
+0000d870: 6773 293a 0a20 2020 2020 2020 2020 2020  gs):.           
+0000d880: 2020 2020 2020 2020 2069 6620 646f 6e65           if done
+0000d890: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d8a0: 2020 2020 2020 2020 2020 7368 6172 6473            shards
+0000d8b0: 5f64 6f6e 6520 2b3d 2031 0a20 2020 2020  _done += 1.     
+0000d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8d0: 2020 2070 6261 722e 7365 745f 6465 7363     pbar.set_desc
+0000d8e0: 7269 7074 696f 6e28 6622 5361 7669 6e67  ription(f"Saving
+0000d8f0: 2074 6865 2064 6174 6173 6574 2028 7b73   the dataset ({s
+0000d900: 6861 7264 735f 646f 6e65 7d2f 7b6e 756d  hards_done}/{num
+0000d910: 5f73 6861 7264 737d 2073 6861 7264 7329  _shards} shards)
+0000d920: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000d930: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0000d940: 722e 6465 6275 6728 6622 4669 6e69 7368  r.debug(f"Finish
+0000d950: 6564 2077 7269 7469 6e67 2073 6861 7264  ed writing shard
+0000d960: 206e 756d 6265 7220 7b6a 6f62 5f69 647d   number {job_id}
+0000d970: 206f 6620 7b6e 756d 5f73 6861 7264 737d   of {num_shards}
+0000d980: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0000d990: 2020 2020 2020 2020 2020 2020 7368 6172              shar
+0000d9a0: 645f 6c65 6e67 7468 735b 6a6f 625f 6964  d_lengths[job_id
+0000d9b0: 5d2c 2073 6861 7264 5f73 697a 6573 5b6a  ], shard_sizes[j
+0000d9c0: 6f62 5f69 645d 203d 2063 6f6e 7465 6e74  ob_id] = content
+0000d9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d9e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
 0000d9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da00: 2020 2020 2020 2020 7368 6172 6473 5f64          shards_d
-0000da10: 6f6e 6520 2b3d 2031 0a20 2020 2020 2020  one += 1.       
-0000da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da30: 2070 6261 722e 7365 745f 6465 7363 7269   pbar.set_descri
-0000da40: 7074 696f 6e28 6622 5361 7669 6e67 2074  ption(f"Saving t
-0000da50: 6865 2064 6174 6173 6574 2028 7b73 6861  he dataset ({sha
-0000da60: 7264 735f 646f 6e65 7d2f 7b6e 756d 5f73  rds_done}/{num_s
-0000da70: 6861 7264 737d 2073 6861 7264 7329 2229  hards} shards)")
-0000da80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000da90: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0000daa0: 6465 6275 6728 6622 4669 6e69 7368 6564  debug(f"Finished
-0000dab0: 2077 7269 7469 6e67 2073 6861 7264 206e   writing shard n
-0000dac0: 756d 6265 7220 7b6a 6f62 5f69 647d 206f  umber {job_id} o
-0000dad0: 6620 7b6e 756d 5f73 6861 7264 737d 2e22  f {num_shards}."
-0000dae0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000daf0: 2020 2020 2020 2020 2020 7368 6172 645f            shard_
-0000db00: 6c65 6e67 7468 735b 6a6f 625f 6964 5d2c  lengths[job_id],
-0000db10: 2073 6861 7264 5f73 697a 6573 5b6a 6f62   shard_sizes[job
-0000db20: 5f69 645d 203d 2063 6f6e 7465 6e74 0a20  _id] = content. 
-0000db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db40: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db60: 2070 6261 722e 7570 6461 7465 2863 6f6e   pbar.update(con
-0000db70: 7465 6e74 290a 2020 2020 2020 2020 656c  tent).        el
-0000db80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000db90: 666f 7220 6b77 6172 6773 2069 6e20 6b77  for kwargs in kw
-0000dba0: 6172 6773 5f70 6572 5f6a 6f62 3a0a 2020  args_per_job:.  
-0000dbb0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000dbc0: 7220 6a6f 625f 6964 2c20 646f 6e65 2c20  r job_id, done, 
-0000dbd0: 636f 6e74 656e 7420 696e 2044 6174 6173  content in Datas
-0000dbe0: 6574 2e5f 7361 7665 5f74 6f5f 6469 736b  et._save_to_disk
-0000dbf0: 5f73 696e 676c 6528 2a2a 6b77 6172 6773  _single(**kwargs
-0000dc00: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000dc10: 2020 2020 2020 2069 6620 646f 6e65 3a0a         if done:.
-0000dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc30: 2020 2020 2020 2020 7368 6172 6473 5f64          shards_d
-0000dc40: 6f6e 6520 2b3d 2031 0a20 2020 2020 2020  one += 1.       
-0000dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc60: 2070 6261 722e 7365 745f 6465 7363 7269   pbar.set_descri
-0000dc70: 7074 696f 6e28 6622 5361 7669 6e67 2074  ption(f"Saving t
-0000dc80: 6865 2064 6174 6173 6574 2028 7b73 6861  he dataset ({sha
-0000dc90: 7264 735f 646f 6e65 7d2f 7b6e 756d 5f73  rds_done}/{num_s
-0000dca0: 6861 7264 737d 2073 6861 7264 7329 2229  hards} shards)")
-0000dcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dcc0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0000dcd0: 6465 6275 6728 6622 4669 6e69 7368 6564  debug(f"Finished
-0000dce0: 2077 7269 7469 6e67 2073 6861 7264 206e   writing shard n
-0000dcf0: 756d 6265 7220 7b6a 6f62 5f69 647d 206f  umber {job_id} o
-0000dd00: 6620 7b6e 756d 5f73 6861 7264 737d 2e22  f {num_shards}."
-0000dd10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000dd20: 2020 2020 2020 2020 2020 7368 6172 645f            shard_
-0000dd30: 6c65 6e67 7468 735b 6a6f 625f 6964 5d2c  lengths[job_id],
-0000dd40: 2073 6861 7264 5f73 697a 6573 5b6a 6f62   shard_sizes[job
-0000dd50: 5f69 645d 203d 2063 6f6e 7465 6e74 0a20  _id] = content. 
-0000dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd70: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000dd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd90: 2070 6261 722e 7570 6461 7465 2863 6f6e   pbar.update(con
-0000dda0: 7465 6e74 290a 2020 2020 2020 2020 7769  tent).        wi
-0000ddb0: 7468 2066 732e 6f70 656e 2870 6174 685f  th fs.open(path_
-0000ddc0: 6a6f 696e 2864 6174 6173 6574 5f70 6174  join(dataset_pat
-0000ddd0: 682c 2063 6f6e 6669 672e 4441 5441 5345  h, config.DATASE
-0000dde0: 545f 5354 4154 455f 4a53 4f4e 5f46 494c  T_STATE_JSON_FIL
-0000ddf0: 454e 414d 4529 2c20 2277 222c 2065 6e63  ENAME), "w", enc
-0000de00: 6f64 696e 673d 2275 7466 2d38 2229 2061  oding="utf-8") a
-0000de10: 7320 7374 6174 655f 6669 6c65 3a0a 2020  s state_file:.  
-0000de20: 2020 2020 2020 2020 2020 6a73 6f6e 2e64            json.d
-0000de30: 756d 7028 7374 6174 652c 2073 7461 7465  ump(state, state
-0000de40: 5f66 696c 652c 2069 6e64 656e 743d 322c  _file, indent=2,
-0000de50: 2073 6f72 745f 6b65 7973 3d54 7275 6529   sort_keys=True)
-0000de60: 0a20 2020 2020 2020 2077 6974 6820 6673  .        with fs
-0000de70: 2e6f 7065 6e28 0a20 2020 2020 2020 2020  .open(.         
-0000de80: 2020 2070 6174 685f 6a6f 696e 2864 6174     path_join(dat
-0000de90: 6173 6574 5f70 6174 682c 2063 6f6e 6669  aset_path, confi
-0000dea0: 672e 4441 5441 5345 545f 494e 464f 5f46  g.DATASET_INFO_F
-0000deb0: 494c 454e 414d 4529 2c20 2277 222c 2065  ILENAME), "w", e
-0000dec0: 6e63 6f64 696e 673d 2275 7466 2d38 220a  ncoding="utf-8".
-0000ded0: 2020 2020 2020 2020 2920 6173 2064 6174          ) as dat
-0000dee0: 6173 6574 5f69 6e66 6f5f 6669 6c65 3a0a  aset_info_file:.
-0000def0: 2020 2020 2020 2020 2020 2020 2320 536f              # So
-0000df00: 7274 206f 6e6c 7920 7468 6520 6669 7273  rt only the firs
-0000df10: 7420 6c65 7665 6c20 6f66 206b 6579 732c  t level of keys,
-0000df20: 206f 7220 7765 206d 6967 6874 2073 6875   or we might shu
-0000df30: 6666 6c65 2066 6965 6c64 7320 6f66 206e  ffle fields of n
-0000df40: 6573 7465 6420 6665 6174 7572 6573 2069  ested features i
-0000df50: 6620 7765 2075 7365 2073 6f72 745f 6b65  f we use sort_ke
-0000df60: 7973 3d54 7275 650a 2020 2020 2020 2020  ys=True.        
-0000df70: 2020 2020 736f 7274 6564 5f6b 6579 735f      sorted_keys_
-0000df80: 6461 7461 7365 745f 696e 666f 203d 207b  dataset_info = {
-0000df90: 6b65 793a 2064 6174 6173 6574 5f69 6e66  key: dataset_inf
-0000dfa0: 6f5b 6b65 795d 2066 6f72 206b 6579 2069  o[key] for key i
-0000dfb0: 6e20 736f 7274 6564 2864 6174 6173 6574  n sorted(dataset
-0000dfc0: 5f69 6e66 6f29 7d0a 2020 2020 2020 2020  _info)}.        
-0000dfd0: 2020 2020 6a73 6f6e 2e64 756d 7028 736f      json.dump(so
-0000dfe0: 7274 6564 5f6b 6579 735f 6461 7461 7365  rted_keys_datase
-0000dff0: 745f 696e 666f 2c20 6461 7461 7365 745f  t_info, dataset_
-0000e000: 696e 666f 5f66 696c 652c 2069 6e64 656e  info_file, inden
-0000e010: 743d 3229 0a0a 2020 2020 4073 7461 7469  t=2)..    @stati
-0000e020: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-0000e030: 5f73 6176 655f 746f 5f64 6973 6b5f 7369  _save_to_disk_si
-0000e040: 6e67 6c65 286a 6f62 5f69 643a 2069 6e74  ngle(job_id: int
-0000e050: 2c20 7368 6172 643a 2022 4461 7461 7365  , shard: "Datase
-0000e060: 7422 2c20 6670 6174 683a 2073 7472 2c20  t", fpath: str, 
-0000e070: 7374 6f72 6167 655f 6f70 7469 6f6e 733a  storage_options:
-0000e080: 204f 7074 696f 6e61 6c5b 6469 6374 5d29   Optional[dict])
-0000e090: 3a0a 2020 2020 2020 2020 6261 7463 685f  :.        batch_
-0000e0a0: 7369 7a65 203d 2063 6f6e 6669 672e 4445  size = config.DE
-0000e0b0: 4641 554c 545f 4d41 585f 4241 5443 485f  FAULT_MAX_BATCH_
-0000e0c0: 5349 5a45 0a0a 2020 2020 2020 2020 6966  SIZE..        if
-0000e0d0: 2073 6861 7264 2e5f 696e 6469 6365 7320   shard._indices 
-0000e0e0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000e0f0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0000e100: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-0000e110: 2020 2020 2020 2020 2020 2022 605f 7361             "`_sa
-0000e120: 7665 5f74 6f5f 6469 736b 5f73 696e 676c  ve_to_disk_singl
-0000e130: 6560 206f 6e6c 7920 7375 7070 6f72 7420  e` only support 
-0000e140: 7368 6172 6473 2077 6974 6820 666c 6174  shards with flat
-0000e150: 7465 6e65 6420 696e 6469 6365 732e 2022  tened indices. "
-0000e160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e170: 2022 506c 6561 7365 2063 616c 6c20 6473   "Please call ds
-0000e180: 2e66 6c61 7474 656e 5f69 6e64 6963 6573  .flatten_indices
-0000e190: 2829 2062 6566 6f72 6520 7361 7669 6e67  () before saving
-0000e1a0: 2074 6f20 6469 736b 2e22 0a20 2020 2020   to disk.".     
-0000e1b0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000e1c0: 2020 6e75 6d5f 6578 616d 706c 6573 5f70    num_examples_p
-0000e1d0: 726f 6772 6573 735f 7570 6461 7465 203d  rogress_update =
-0000e1e0: 2030 0a20 2020 2020 2020 2077 7269 7465   0.        write
-0000e1f0: 7220 3d20 4172 726f 7757 7269 7465 7228  r = ArrowWriter(
-0000e200: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
-0000e210: 7475 7265 733d 7368 6172 642e 6665 6174  tures=shard.feat
-0000e220: 7572 6573 2c0a 2020 2020 2020 2020 2020  ures,.          
-0000e230: 2020 7061 7468 3d66 7061 7468 2c0a 2020    path=fpath,.  
-0000e240: 2020 2020 2020 2020 2020 7374 6f72 6167            storag
-0000e250: 655f 6f70 7469 6f6e 733d 7374 6f72 6167  e_options=storag
-0000e260: 655f 6f70 7469 6f6e 732c 0a20 2020 2020  e_options,.     
-0000e270: 2020 2020 2020 2065 6d62 6564 5f6c 6f63         embed_loc
-0000e280: 616c 5f66 696c 6573 3d54 7275 652c 0a20  al_files=True,. 
-0000e290: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000e2a0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000e2b0: 2020 5f74 696d 6520 3d20 7469 6d65 2e74    _time = time.t
-0000e2c0: 696d 6528 290a 2020 2020 2020 2020 2020  ime().          
-0000e2d0: 2020 666f 7220 7061 5f74 6162 6c65 2069    for pa_table i
-0000e2e0: 6e20 7461 626c 655f 6974 6572 2873 6861  n table_iter(sha
-0000e2f0: 7264 2e64 6174 612c 2062 6174 6368 5f73  rd.data, batch_s
-0000e300: 697a 653d 6261 7463 685f 7369 7a65 293a  ize=batch_size):
-0000e310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e320: 2077 7269 7465 722e 7772 6974 655f 7461   writer.write_ta
-0000e330: 626c 6528 7061 5f74 6162 6c65 290a 2020  ble(pa_table).  
-0000e340: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
-0000e350: 6d5f 6578 616d 706c 6573 5f70 726f 6772  m_examples_progr
-0000e360: 6573 735f 7570 6461 7465 202b 3d20 6c65  ess_update += le
-0000e370: 6e28 7061 5f74 6162 6c65 290a 2020 2020  n(pa_table).    
-0000e380: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-0000e390: 696d 652e 7469 6d65 2829 203e 205f 7469  ime.time() > _ti
-0000e3a0: 6d65 202b 2063 6f6e 6669 672e 5042 4152  me + config.PBAR
-0000e3b0: 5f52 4546 5245 5348 5f54 494d 455f 494e  _REFRESH_TIME_IN
-0000e3c0: 5445 5256 414c 3a0a 2020 2020 2020 2020  TERVAL:.        
-0000e3d0: 2020 2020 2020 2020 2020 2020 5f74 696d              _tim
-0000e3e0: 6520 3d20 7469 6d65 2e74 696d 6528 290a  e = time.time().
-0000e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e400: 2020 2020 7969 656c 6420 6a6f 625f 6964      yield job_id
-0000e410: 2c20 4661 6c73 652c 206e 756d 5f65 7861  , False, num_exa
-0000e420: 6d70 6c65 735f 7072 6f67 7265 7373 5f75  mples_progress_u
-0000e430: 7064 6174 650a 2020 2020 2020 2020 2020  pdate.          
-0000e440: 2020 2020 2020 2020 2020 6e75 6d5f 6578            num_ex
-0000e450: 616d 706c 6573 5f70 726f 6772 6573 735f  amples_progress_
-0000e460: 7570 6461 7465 203d 2030 0a20 2020 2020  update = 0.     
-0000e470: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
-0000e480: 2020 2020 2020 2020 7969 656c 6420 6a6f          yield jo
-0000e490: 625f 6964 2c20 4661 6c73 652c 206e 756d  b_id, False, num
-0000e4a0: 5f65 7861 6d70 6c65 735f 7072 6f67 7265  _examples_progre
-0000e4b0: 7373 5f75 7064 6174 650a 2020 2020 2020  ss_update.      
-0000e4c0: 2020 2020 2020 6e75 6d5f 6578 616d 706c        num_exampl
-0000e4d0: 6573 2c20 6e75 6d5f 6279 7465 7320 3d20  es, num_bytes = 
-0000e4e0: 7772 6974 6572 2e66 696e 616c 697a 6528  writer.finalize(
-0000e4f0: 290a 2020 2020 2020 2020 2020 2020 7772  ).            wr
-0000e500: 6974 6572 2e63 6c6f 7365 2829 0a0a 2020  iter.close()..  
-0000e510: 2020 2020 2020 7969 656c 6420 6a6f 625f        yield job_
-0000e520: 6964 2c20 5472 7565 2c20 286e 756d 5f65  id, True, (num_e
-0000e530: 7861 6d70 6c65 732c 206e 756d 5f62 7974  xamples, num_byt
-0000e540: 6573 290a 0a20 2020 2040 7374 6174 6963  es)..    @static
-0000e550: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-0000e560: 6275 696c 645f 6c6f 6361 6c5f 7465 6d70  build_local_temp
-0000e570: 5f70 6174 6828 7572 695f 6f72 5f70 6174  _path(uri_or_pat
-0000e580: 683a 2073 7472 2920 2d3e 2050 6174 683a  h: str) -> Path:
-0000e590: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000e5a0: 2020 2020 2042 7569 6c64 7320 616e 6420       Builds and 
-0000e5b0: 7265 7475 726e 7320 6120 5061 7468 2063  returns a Path c
-0000e5c0: 6f6e 6361 7465 6e61 7469 6e67 2061 206c  oncatenating a l
-0000e5d0: 6f63 616c 2074 656d 706f 7261 7279 2064  ocal temporary d
-0000e5e0: 6972 2077 6974 6820 7468 6520 6469 7220  ir with the dir 
-0000e5f0: 7061 7468 2028 6f72 2061 6273 6f6c 7574  path (or absolut
-0000e600: 652f 7265 6c61 7469 7665 0a20 2020 2020  e/relative.     
-0000e610: 2020 2070 6174 6820 6578 7472 6163 7465     path extracte
-0000e620: 6420 6672 6f6d 2074 6865 2075 7269 2920  d from the uri) 
-0000e630: 7061 7373 6564 2e0a 0a20 2020 2020 2020  passed...       
-0000e640: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-0000e650: 2020 2075 7269 5f6f 725f 7061 7468 2028     uri_or_path (
-0000e660: 6073 7472 6029 3a20 5061 7468 2028 652e  `str`): Path (e.
-0000e670: 672e 2060 2264 6174 6173 6574 2f74 7261  g. `"dataset/tra
-0000e680: 696e 2260 2920 6f72 2072 656d 6f74 6520  in"`) or remote 
-0000e690: 5552 4920 2865 2e67 2e0a 2020 2020 2020  URI (e.g..      
-0000e6a0: 2020 2020 2020 2020 2020 6022 7333 3a2f            `"s3:/
-0000e6b0: 2f6d 792d 6275 636b 6574 2f64 6174 6173  /my-bucket/datas
-0000e6c0: 6574 2f74 7261 696e 2260 2920 746f 2063  et/train"`) to c
-0000e6d0: 6f6e 6361 7465 6e61 7465 2e0a 0a20 2020  oncatenate...   
-0000e6e0: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
-0000e6f0: 2020 2020 2020 2020 2020 3a63 6c61 7373            :class
-0000e700: 3a60 5061 7468 603a 2074 6865 2063 6f6e  :`Path`: the con
-0000e710: 6361 7465 6e61 7465 6420 7061 7468 2028  catenated path (
-0000e720: 7465 6d70 2064 6972 202b 2070 6174 6829  temp dir + path)
-0000e730: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000e740: 2020 2020 2073 7263 5f64 6174 6173 6574       src_dataset
-0000e750: 5f70 6174 6820 3d20 5061 7468 2875 7269  _path = Path(uri
-0000e760: 5f6f 725f 7061 7468 290a 2020 2020 2020  _or_path).      
-0000e770: 2020 746d 705f 6469 7220 3d20 6765 745f    tmp_dir = get_
-0000e780: 7465 6d70 6f72 6172 795f 6361 6368 655f  temporary_cache_
-0000e790: 6669 6c65 735f 6469 7265 6374 6f72 7928  files_directory(
-0000e7a0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000e7b0: 2050 6174 6828 746d 705f 6469 722c 2073   Path(tmp_dir, s
-0000e7c0: 7263 5f64 6174 6173 6574 5f70 6174 682e  rc_dataset_path.
-0000e7d0: 7265 6c61 7469 7665 5f74 6f28 7372 635f  relative_to(src_
-0000e7e0: 6461 7461 7365 745f 7061 7468 2e61 6e63  dataset_path.anc
-0000e7f0: 686f 7229 290a 0a20 2020 2040 7374 6174  hor))..    @stat
-0000e800: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-0000e810: 206c 6f61 645f 6672 6f6d 5f64 6973 6b28   load_from_disk(
-0000e820: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
-0000e830: 5f70 6174 683a 2073 7472 2c0a 2020 2020  _path: str,.    
-0000e840: 2020 2020 6673 3d22 6465 7072 6563 6174      fs="deprecat
-0000e850: 6564 222c 0a20 2020 2020 2020 206b 6565  ed",.        kee
-0000e860: 705f 696e 5f6d 656d 6f72 793a 204f 7074  p_in_memory: Opt
-0000e870: 696f 6e61 6c5b 626f 6f6c 5d20 3d20 4e6f  ional[bool] = No
-0000e880: 6e65 2c0a 2020 2020 2020 2020 7374 6f72  ne,.        stor
-0000e890: 6167 655f 6f70 7469 6f6e 733a 204f 7074  age_options: Opt
-0000e8a0: 696f 6e61 6c5b 6469 6374 5d20 3d20 4e6f  ional[dict] = No
-0000e8b0: 6e65 2c0a 2020 2020 2920 2d3e 2022 4461  ne,.    ) -> "Da
-0000e8c0: 7461 7365 7422 3a0a 2020 2020 2020 2020  taset":.        
-0000e8d0: 2222 220a 2020 2020 2020 2020 4c6f 6164  """.        Load
-0000e8e0: 7320 6120 6461 7461 7365 7420 7468 6174  s a dataset that
-0000e8f0: 2077 6173 2070 7265 7669 6f75 736c 7920   was previously 
-0000e900: 7361 7665 6420 7573 696e 6720 5b60 7361  saved using [`sa
-0000e910: 7665 5f74 6f5f 6469 736b 605d 2066 726f  ve_to_disk`] fro
-0000e920: 6d20 6120 6461 7461 7365 7420 6469 7265  m a dataset dire
-0000e930: 6374 6f72 792c 206f 7220 6672 6f6d 2061  ctory, or from a
-0000e940: 0a20 2020 2020 2020 2066 696c 6573 7973  .        filesys
-0000e950: 7465 6d20 7573 696e 6720 6569 7468 6572  tem using either
-0000e960: 2060 7333 6673 2e53 3346 696c 6553 7973   `s3fs.S3FileSys
-0000e970: 7465 6d60 206f 7220 616e 7920 696d 706c  tem` or any impl
-0000e980: 656d 656e 7461 7469 6f6e 206f 660a 2020  ementation of.  
-0000e990: 2020 2020 2020 6066 7373 7065 632e 7370        `fsspec.sp
-0000e9a0: 6563 2e41 6273 7472 6163 7446 696c 6553  ec.AbstractFileS
-0000e9b0: 7973 7465 6d60 2e0a 0a20 2020 2020 2020  ystem`...       
-0000e9c0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-0000e9d0: 2020 2064 6174 6173 6574 5f70 6174 6820     dataset_path 
-0000e9e0: 2860 7374 7260 293a 0a20 2020 2020 2020  (`str`):.       
-0000e9f0: 2020 2020 2020 2020 2050 6174 6820 2865           Path (e
-0000ea00: 2e67 2e20 6022 6461 7461 7365 742f 7472  .g. `"dataset/tr
-0000ea10: 6169 6e22 6029 206f 7220 7265 6d6f 7465  ain"`) or remote
-0000ea20: 2055 5249 2028 652e 672e 2060 2273 332f   URI (e.g. `"s3/
-0000ea30: 2f6d 792d 6275 636b 6574 2f64 6174 6173  /my-bucket/datas
-0000ea40: 6574 2f74 7261 696e 2260 290a 2020 2020  et/train"`).    
-0000ea50: 2020 2020 2020 2020 2020 2020 6f66 2074              of t
-0000ea60: 6865 2064 6174 6173 6574 2064 6972 6563  he dataset direc
-0000ea70: 746f 7279 2077 6865 7265 2074 6865 2064  tory where the d
-0000ea80: 6174 6173 6574 2077 696c 6c20 6265 206c  ataset will be l
-0000ea90: 6f61 6465 6420 6672 6f6d 2e0a 2020 2020  oaded from..    
-0000eaa0: 2020 2020 2020 2020 6673 2028 6066 7373          fs (`fss
-0000eab0: 7065 632e 7370 6563 2e41 6273 7472 6163  pec.spec.Abstrac
-0000eac0: 7446 696c 6553 7973 7465 6d60 2c20 2a6f  tFileSystem`, *o
-0000ead0: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
-0000eae0: 2020 2020 2020 2020 2020 2049 6e73 7461             Insta
-0000eaf0: 6e63 6520 6f66 2074 6865 2072 656d 6f74  nce of the remot
-0000eb00: 6520 6669 6c65 7379 7374 656d 2077 6865  e filesystem whe
-0000eb10: 7265 2074 6865 2064 6174 6173 6574 2077  re the dataset w
-0000eb20: 696c 6c20 6265 2073 6176 6564 2074 6f2e  ill be saved to.
-0000eb30: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000eb40: 2020 3c44 6570 7265 6361 7465 6420 7665    <Deprecated ve
-0000eb50: 7273 696f 6e3d 2232 2e38 2e30 223e 0a0a  rsion="2.8.0">..
-0000eb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb70: 6066 7360 2077 6173 2064 6570 7265 6361  `fs` was depreca
-0000eb80: 7465 6420 696e 2076 6572 7369 6f6e 2032  ted in version 2
-0000eb90: 2e38 2e30 2061 6e64 2077 696c 6c20 6265  .8.0 and will be
-0000eba0: 2072 656d 6f76 6564 2069 6e20 332e 302e   removed in 3.0.
-0000ebb0: 302e 0a20 2020 2020 2020 2020 2020 2020  0..             
-0000ebc0: 2020 2050 6c65 6173 6520 7573 6520 6073     Please use `s
-0000ebd0: 746f 7261 6765 5f6f 7074 696f 6e73 6020  torage_options` 
-0000ebe0: 696e 7374 6561 642c 2065 2e67 2e20 6073  instead, e.g. `s
-0000ebf0: 746f 7261 6765 5f6f 7074 696f 6e73 3d66  torage_options=f
-0000ec00: 732e 7374 6f72 6167 655f 6f70 7469 6f6e  s.storage_option
-0000ec10: 7360 0a0a 2020 2020 2020 2020 2020 2020  s`..            
-0000ec20: 2020 2020 3c2f 4465 7072 6563 6174 6564      </Deprecated
-0000ec30: 3e0a 0a20 2020 2020 2020 2020 2020 206b  >..            k
-0000ec40: 6565 705f 696e 5f6d 656d 6f72 7920 2860  eep_in_memory (`
-0000ec50: 626f 6f6c 602c 2064 6566 6175 6c74 7320  bool`, defaults 
-0000ec60: 746f 2060 4e6f 6e65 6029 3a0a 2020 2020  to `None`):.    
-0000ec70: 2020 2020 2020 2020 2020 2020 5768 6574              Whet
-0000ec80: 6865 7220 746f 2063 6f70 7920 7468 6520  her to copy the 
-0000ec90: 6461 7461 7365 7420 696e 2d6d 656d 6f72  dataset in-memor
-0000eca0: 792e 2049 6620 604e 6f6e 6560 2c20 7468  y. If `None`, th
-0000ecb0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000ecc0: 2020 6461 7461 7365 7420 7769 6c6c 206e    dataset will n
-0000ecd0: 6f74 2062 6520 636f 7069 6564 2069 6e2d  ot be copied in-
-0000ece0: 6d65 6d6f 7279 2075 6e6c 6573 7320 6578  memory unless ex
-0000ecf0: 706c 6963 6974 6c79 2065 6e61 626c 6564  plicitly enabled
-0000ed00: 2062 7920 7365 7474 696e 670a 2020 2020   by setting.    
-0000ed10: 2020 2020 2020 2020 2020 2020 6064 6174              `dat
-0000ed20: 6173 6574 732e 636f 6e66 6967 2e49 4e5f  asets.config.IN_
-0000ed30: 4d45 4d4f 5259 5f4d 4158 5f53 495a 4560  MEMORY_MAX_SIZE`
-0000ed40: 2074 6f20 6e6f 6e7a 6572 6f2e 2053 6565   to nonzero. See
-0000ed50: 206d 6f72 6520 6465 7461 696c 7320 696e   more details in
-0000ed60: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-0000ed70: 2020 2020 205b 696d 7072 6f76 6520 7065       [improve pe
-0000ed80: 7266 6f72 6d61 6e63 655d 282e 2f63 6163  rformance](./cac
-0000ed90: 6865 2369 6d70 726f 7665 2d70 6572 666f  he#improve-perfo
-0000eda0: 726d 616e 6365 2920 7365 6374 696f 6e2e  rmance) section.
-0000edb0: 0a20 2020 2020 2020 2020 2020 2073 746f  .            sto
-0000edc0: 7261 6765 5f6f 7074 696f 6e73 2028 6064  rage_options (`d
-0000edd0: 6963 7460 2c20 2a6f 7074 696f 6e61 6c2a  ict`, *optional*
-0000ede0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000edf0: 2020 204b 6579 2f76 616c 7565 2070 6169     Key/value pai
-0000ee00: 7273 2074 6f20 6265 2070 6173 7365 6420  rs to be passed 
-0000ee10: 6f6e 2074 6f20 7468 6520 6669 6c65 2d73  on to the file-s
-0000ee20: 7973 7465 6d20 6261 636b 656e 642c 2069  ystem backend, i
-0000ee30: 6620 616e 792e 0a0a 2020 2020 2020 2020  f any...        
-0000ee40: 2020 2020 2020 2020 3c41 6464 6564 2076          <Added v
-0000ee50: 6572 7369 6f6e 3d22 322e 382e 3022 2f3e  ersion="2.8.0"/>
-0000ee60: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0000ee70: 733a 0a20 2020 2020 2020 2020 2020 205b  s:.            [
-0000ee80: 6044 6174 6173 6574 605d 206f 7220 5b60  `Dataset`] or [`
-0000ee90: 4461 7461 7365 7444 6963 7460 5d3a 0a20  DatasetDict`]:. 
-0000eea0: 2020 2020 2020 2020 2020 202d 2049 6620             - If 
-0000eeb0: 6064 6174 6173 6574 5f70 6174 6860 2069  `dataset_path` i
-0000eec0: 7320 6120 7061 7468 206f 6620 6120 6461  s a path of a da
-0000eed0: 7461 7365 7420 6469 7265 6374 6f72 792c  taset directory,
-0000eee0: 2074 6865 2064 6174 6173 6574 2072 6571   the dataset req
-0000eef0: 7565 7374 6564 2e0a 2020 2020 2020 2020  uested..        
-0000ef00: 2020 2020 2d20 4966 2060 6461 7461 7365      - If `datase
-0000ef10: 745f 7061 7468 6020 6973 2061 2070 6174  t_path` is a pat
-0000ef20: 6820 6f66 2061 2064 6174 6173 6574 2064  h of a dataset d
-0000ef30: 6963 7420 6469 7265 6374 6f72 792c 2061  ict directory, a
-0000ef40: 2060 6461 7461 7365 7473 2e44 6174 6173   `datasets.Datas
-0000ef50: 6574 4469 6374 6020 7769 7468 2065 6163  etDict` with eac
-0000ef60: 6820 7370 6c69 742e 0a0a 2020 2020 2020  h split...      
-0000ef70: 2020 4578 616d 706c 653a 0a0a 2020 2020    Example:..    
-0000ef80: 2020 2020 6060 6070 790a 2020 2020 2020      ```py.      
-0000ef90: 2020 3e3e 3e20 6473 203d 206c 6f61 645f    >>> ds = load_
-0000efa0: 6672 6f6d 5f64 6973 6b28 2270 6174 682f  from_disk("path/
-0000efb0: 746f 2f64 6174 6173 6574 2f64 6972 6563  to/dataset/direc
-0000efc0: 746f 7279 2229 0a20 2020 2020 2020 2060  tory").        `
-0000efd0: 6060 0a20 2020 2020 2020 2022 2222 0a20  ``.        """. 
-0000efe0: 2020 2020 2020 2069 6620 6673 2021 3d20         if fs != 
-0000eff0: 2264 6570 7265 6361 7465 6422 3a0a 2020  "deprecated":.  
-0000f000: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0000f010: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
-0000f020: 2020 2020 2020 2020 2022 2766 7327 2077           "'fs' w
-0000f030: 6173 2069 7320 6465 7072 6563 6174 6564  as is deprecated
-0000f040: 2069 6e20 6661 766f 7220 6f66 2027 7374   in favor of 'st
-0000f050: 6f72 6167 655f 6f70 7469 6f6e 7327 2069  orage_options' i
-0000f060: 6e20 7665 7273 696f 6e20 322e 382e 3020  n version 2.8.0 
-0000f070: 616e 6420 7769 6c6c 2062 6520 7265 6d6f  and will be remo
-0000f080: 7665 6420 696e 2033 2e30 2e30 2e5c 6e22  ved in 3.0.0.\n"
-0000f090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f0a0: 2022 596f 7520 6361 6e20 7265 6d6f 7665   "You can remove
-0000f0b0: 2074 6869 7320 7761 726e 696e 6720 6279   this warning by
-0000f0c0: 2070 6173 7369 6e67 2027 7374 6f72 6167   passing 'storag
-0000f0d0: 655f 6f70 7469 6f6e 733d 6673 2e73 746f  e_options=fs.sto
-0000f0e0: 7261 6765 5f6f 7074 696f 6e73 2720 696e  rage_options' in
-0000f0f0: 7374 6561 642e 222c 0a20 2020 2020 2020  stead.",.       
-0000f100: 2020 2020 2020 2020 2046 7574 7572 6557           FutureW
-0000f110: 6172 6e69 6e67 2c0a 2020 2020 2020 2020  arning,.        
-0000f120: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000f130: 2020 7374 6f72 6167 655f 6f70 7469 6f6e    storage_option
-0000f140: 7320 3d20 6673 2e73 746f 7261 6765 5f6f  s = fs.storage_o
-0000f150: 7074 696f 6e73 0a0a 2020 2020 2020 2020  ptions..        
-0000f160: 6673 5f74 6f6b 656e 5f70 6174 6873 203d  fs_token_paths =
-0000f170: 2066 7373 7065 632e 6765 745f 6673 5f74   fsspec.get_fs_t
-0000f180: 6f6b 656e 5f70 6174 6873 2864 6174 6173  oken_paths(datas
-0000f190: 6574 5f70 6174 682c 2073 746f 7261 6765  et_path, storage
-0000f1a0: 5f6f 7074 696f 6e73 3d73 746f 7261 6765  _options=storage
-0000f1b0: 5f6f 7074 696f 6e73 290a 2020 2020 2020  _options).      
-0000f1c0: 2020 6673 3a20 6673 7370 6563 2e41 6273    fs: fsspec.Abs
-0000f1d0: 7472 6163 7446 696c 6553 7973 7465 6d20  tractFileSystem 
-0000f1e0: 3d20 6673 5f74 6f6b 656e 5f70 6174 6873  = fs_token_paths
-0000f1f0: 5b30 5d0a 2020 2020 2020 2020 2320 636f  [0].        # co
-0000f200: 7069 6573 2066 696c 6520 6672 6f6d 2066  pies file from f
-0000f210: 696c 6573 7973 7465 6d20 6966 2069 7420  ilesystem if it 
-0000f220: 6973 2072 656d 6f74 6520 6669 6c65 7379  is remote filesy
-0000f230: 7374 656d 2074 6f20 6c6f 6361 6c20 6669  stem to local fi
-0000f240: 6c65 7379 7374 656d 2061 6e64 206d 6f64  lesystem and mod
-0000f250: 6966 6965 7320 6461 7461 7365 745f 7061  ifies dataset_pa
-0000f260: 7468 2074 6f20 7465 6d70 2064 6972 6563  th to temp direc
-0000f270: 746f 7279 2063 6f6e 7461 696e 696e 6720  tory containing 
-0000f280: 6c6f 6361 6c20 636f 7069 6573 0a20 2020  local copies.   
-0000f290: 2020 2020 2064 6174 6173 6574 5f64 6963       dataset_dic
-0000f2a0: 745f 6a73 6f6e 5f70 6174 6820 3d20 5061  t_json_path = Pa
-0000f2b0: 7468 2864 6174 6173 6574 5f70 6174 682c  th(dataset_path,
-0000f2c0: 2063 6f6e 6669 672e 4441 5441 5345 5444   config.DATASETD
-0000f2d0: 4943 545f 4a53 4f4e 5f46 494c 454e 414d  ICT_JSON_FILENAM
-0000f2e0: 4529 2e61 735f 706f 7369 7828 290a 2020  E).as_posix().  
-0000f2f0: 2020 2020 2020 6461 7461 7365 745f 696e        dataset_in
-0000f300: 666f 5f70 6174 6820 3d20 5061 7468 2864  fo_path = Path(d
-0000f310: 6174 6173 6574 5f70 6174 682c 2063 6f6e  ataset_path, con
-0000f320: 6669 672e 4441 5441 5345 545f 494e 464f  fig.DATASET_INFO
-0000f330: 5f46 494c 454e 414d 4529 2e61 735f 706f  _FILENAME).as_po
-0000f340: 7369 7828 290a 2020 2020 2020 2020 6966  six().        if
-0000f350: 206e 6f74 2066 732e 6973 6669 6c65 2864   not fs.isfile(d
-0000f360: 6174 6173 6574 5f69 6e66 6f5f 7061 7468  ataset_info_path
-0000f370: 2920 616e 6420 6673 2e69 7366 696c 6528  ) and fs.isfile(
-0000f380: 6461 7461 7365 745f 6469 6374 5f6a 736f  dataset_dict_jso
-0000f390: 6e5f 7061 7468 293a 0a20 2020 2020 2020  n_path):.       
-0000f3a0: 2020 2020 2072 6169 7365 2046 696c 654e       raise FileN
-0000f3b0: 6f74 466f 756e 6445 7272 6f72 280a 2020  otFoundError(.  
-0000f3c0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000f3d0: 4e6f 2073 7563 6820 6669 6c65 206f 7220  No such file or 
-0000f3e0: 6469 7265 6374 6f72 793a 2027 7b64 6174  directory: '{dat
-0000f3f0: 6173 6574 5f69 6e66 6f5f 7061 7468 7d27  aset_info_path}'
-0000f400: 2e20 4578 7065 6374 6564 2074 6f20 6c6f  . Expected to lo
-0000f410: 6164 2061 2044 6174 6173 6574 206f 626a  ad a Dataset obj
-0000f420: 6563 742c 2062 7574 2067 6f74 2061 2044  ect, but got a D
-0000f430: 6174 6173 6574 4469 6374 2e20 506c 6561  atasetDict. Plea
-0000f440: 7365 2075 7365 2064 6174 6173 6574 732e  se use datasets.
-0000f450: 6c6f 6164 5f66 726f 6d5f 6469 736b 2069  load_from_disk i
-0000f460: 6e73 7465 6164 2e22 0a20 2020 2020 2020  nstead.".       
-0000f470: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0000f480: 6966 2069 735f 7265 6d6f 7465 5f66 696c  if is_remote_fil
-0000f490: 6573 7973 7465 6d28 6673 293a 0a20 2020  esystem(fs):.   
-0000f4a0: 2020 2020 2020 2020 2073 7263 5f64 6174           src_dat
-0000f4b0: 6173 6574 5f70 6174 6820 3d20 6578 7472  aset_path = extr
-0000f4c0: 6163 745f 7061 7468 5f66 726f 6d5f 7572  act_path_from_ur
-0000f4d0: 6928 6461 7461 7365 745f 7061 7468 290a  i(dataset_path).
-0000f4e0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0000f4f0: 7365 745f 7061 7468 203d 2044 6174 6173  set_path = Datas
-0000f500: 6574 2e5f 6275 696c 645f 6c6f 6361 6c5f  et._build_local_
-0000f510: 7465 6d70 5f70 6174 6828 7372 635f 6461  temp_path(src_da
-0000f520: 7461 7365 745f 7061 7468 290a 2020 2020  taset_path).    
-0000f530: 2020 2020 2020 2020 6673 2e64 6f77 6e6c          fs.downl
-0000f540: 6f61 6428 7372 635f 6461 7461 7365 745f  oad(src_dataset_
-0000f550: 7061 7468 2c20 6461 7461 7365 745f 7061  path, dataset_pa
-0000f560: 7468 2e61 735f 706f 7369 7828 292c 2072  th.as_posix(), r
-0000f570: 6563 7572 7369 7665 3d54 7275 6529 0a0a  ecursive=True)..
-0000f580: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-0000f590: 6e28 5061 7468 2864 6174 6173 6574 5f70  n(Path(dataset_p
-0000f5a0: 6174 682c 2063 6f6e 6669 672e 4441 5441  ath, config.DATA
-0000f5b0: 5345 545f 5354 4154 455f 4a53 4f4e 5f46  SET_STATE_JSON_F
-0000f5c0: 494c 454e 414d 4529 2e61 735f 706f 7369  ILENAME).as_posi
-0000f5d0: 7828 292c 2065 6e63 6f64 696e 673d 2275  x(), encoding="u
-0000f5e0: 7466 2d38 2229 2061 7320 7374 6174 655f  tf-8") as state_
-0000f5f0: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
-0000f600: 2020 7374 6174 6520 3d20 6a73 6f6e 2e6c    state = json.l
-0000f610: 6f61 6428 7374 6174 655f 6669 6c65 290a  oad(state_file).
-0000f620: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-0000f630: 6e28 5061 7468 2864 6174 6173 6574 5f70  n(Path(dataset_p
-0000f640: 6174 682c 2063 6f6e 6669 672e 4441 5441  ath, config.DATA
-0000f650: 5345 545f 494e 464f 5f46 494c 454e 414d  SET_INFO_FILENAM
-0000f660: 4529 2e61 735f 706f 7369 7828 292c 2065  E).as_posix(), e
-0000f670: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
-0000f680: 2061 7320 6461 7461 7365 745f 696e 666f   as dataset_info
-0000f690: 5f66 696c 653a 0a20 2020 2020 2020 2020  _file:.         
-0000f6a0: 2020 2064 6174 6173 6574 5f69 6e66 6f20     dataset_info 
-0000f6b0: 3d20 4461 7461 7365 7449 6e66 6f2e 6672  = DatasetInfo.fr
-0000f6c0: 6f6d 5f64 6963 7428 6a73 6f6e 2e6c 6f61  om_dict(json.loa
-0000f6d0: 6428 6461 7461 7365 745f 696e 666f 5f66  d(dataset_info_f
-0000f6e0: 696c 6529 290a 0a20 2020 2020 2020 2064  ile))..        d
-0000f6f0: 6174 6173 6574 5f73 697a 6520 3d20 6573  ataset_size = es
-0000f700: 7469 6d61 7465 5f64 6174 6173 6574 5f73  timate_dataset_s
-0000f710: 697a 6528 0a20 2020 2020 2020 2020 2020  ize(.           
-0000f720: 2050 6174 6828 6461 7461 7365 745f 7061   Path(dataset_pa
-0000f730: 7468 2c20 6461 7461 5f66 696c 655b 2266  th, data_file["f
-0000f740: 696c 656e 616d 6522 5d29 2066 6f72 2064  ilename"]) for d
-0000f750: 6174 615f 6669 6c65 2069 6e20 7374 6174  ata_file in stat
-0000f760: 655b 225f 6461 7461 5f66 696c 6573 225d  e["_data_files"]
-0000f770: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0000f780: 2020 206b 6565 705f 696e 5f6d 656d 6f72     keep_in_memor
-0000f790: 7920 3d20 6b65 6570 5f69 6e5f 6d65 6d6f  y = keep_in_memo
-0000f7a0: 7279 2069 6620 6b65 6570 5f69 6e5f 6d65  ry if keep_in_me
-0000f7b0: 6d6f 7279 2069 7320 6e6f 7420 4e6f 6e65  mory is not None
-0000f7c0: 2065 6c73 6520 6973 5f73 6d61 6c6c 5f64   else is_small_d
-0000f7d0: 6174 6173 6574 2864 6174 6173 6574 5f73  ataset(dataset_s
-0000f7e0: 697a 6529 0a20 2020 2020 2020 2074 6162  ize).        tab
-0000f7f0: 6c65 5f63 6c73 203d 2049 6e4d 656d 6f72  le_cls = InMemor
-0000f800: 7954 6162 6c65 2069 6620 6b65 6570 5f69  yTable if keep_i
-0000f810: 6e5f 6d65 6d6f 7279 2065 6c73 6520 4d65  n_memory else Me
-0000f820: 6d6f 7279 4d61 7070 6564 5461 626c 650a  moryMappedTable.
-0000f830: 2020 2020 2020 2020 6172 726f 775f 7461          arrow_ta
-0000f840: 626c 6520 3d20 636f 6e63 6174 5f74 6162  ble = concat_tab
-0000f850: 6c65 7328 0a20 2020 2020 2020 2020 2020  les(.           
-0000f860: 2074 6162 6c65 5f63 6c73 2e66 726f 6d5f   table_cls.from_
-0000f870: 6669 6c65 2850 6174 6828 6461 7461 7365  file(Path(datase
-0000f880: 745f 7061 7468 2c20 6461 7461 5f66 696c  t_path, data_fil
-0000f890: 655b 2266 696c 656e 616d 6522 5d29 2e61  e["filename"]).a
-0000f8a0: 735f 706f 7369 7828 2929 0a20 2020 2020  s_posix()).     
-0000f8b0: 2020 2020 2020 2066 6f72 2064 6174 615f         for data_
-0000f8c0: 6669 6c65 2069 6e20 7374 6174 655b 225f  file in state["_
-0000f8d0: 6461 7461 5f66 696c 6573 225d 0a20 2020  data_files"].   
-0000f8e0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0000f8f0: 7370 6c69 7420 3d20 7374 6174 655b 225f  split = state["_
-0000f900: 7370 6c69 7422 5d0a 2020 2020 2020 2020  split"].        
-0000f910: 7370 6c69 7420 3d20 5370 6c69 7428 7370  split = Split(sp
-0000f920: 6c69 7429 2069 6620 7370 6c69 7420 6973  lit) if split is
-0000f930: 206e 6f74 204e 6f6e 6520 656c 7365 2073   not None else s
-0000f940: 706c 6974 0a0a 2020 2020 2020 2020 6461  plit..        da
-0000f950: 7461 7365 7420 3d20 4461 7461 7365 7428  taset = Dataset(
-0000f960: 0a20 2020 2020 2020 2020 2020 2061 7272  .            arr
-0000f970: 6f77 5f74 6162 6c65 3d61 7272 6f77 5f74  ow_table=arrow_t
-0000f980: 6162 6c65 2c0a 2020 2020 2020 2020 2020  able,.          
-0000f990: 2020 696e 666f 3d64 6174 6173 6574 5f69    info=dataset_i
-0000f9a0: 6e66 6f2c 0a20 2020 2020 2020 2020 2020  nfo,.           
-0000f9b0: 2073 706c 6974 3d73 706c 6974 2c0a 2020   split=split,.  
-0000f9c0: 2020 2020 2020 2020 2020 6669 6e67 6572            finger
-0000f9d0: 7072 696e 743d 7374 6174 655b 225f 6669  print=state["_fi
-0000f9e0: 6e67 6572 7072 696e 7422 5d2c 0a20 2020  ngerprint"],.   
-0000f9f0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0000fa00: 666f 726d 6174 203d 207b 0a20 2020 2020  format = {.     
-0000fa10: 2020 2020 2020 2022 7479 7065 223a 2073         "type": s
-0000fa20: 7461 7465 5b22 5f66 6f72 6d61 745f 7479  tate["_format_ty
-0000fa30: 7065 225d 2c0a 2020 2020 2020 2020 2020  pe"],.          
-0000fa40: 2020 2266 6f72 6d61 745f 6b77 6172 6773    "format_kwargs
-0000fa50: 223a 2073 7461 7465 5b22 5f66 6f72 6d61  ": state["_forma
-0000fa60: 745f 6b77 6172 6773 225d 2c0a 2020 2020  t_kwargs"],.    
-0000fa70: 2020 2020 2020 2020 2263 6f6c 756d 6e73          "columns
-0000fa80: 223a 2073 7461 7465 5b22 5f66 6f72 6d61  ": state["_forma
-0000fa90: 745f 636f 6c75 6d6e 7322 5d2c 0a20 2020  t_columns"],.   
-0000faa0: 2020 2020 2020 2020 2022 6f75 7470 7574           "output
-0000fab0: 5f61 6c6c 5f63 6f6c 756d 6e73 223a 2073  _all_columns": s
-0000fac0: 7461 7465 5b22 5f6f 7574 7075 745f 616c  tate["_output_al
-0000fad0: 6c5f 636f 6c75 6d6e 7322 5d2c 0a20 2020  l_columns"],.   
-0000fae0: 2020 2020 207d 0a20 2020 2020 2020 2064       }.        d
-0000faf0: 6174 6173 6574 203d 2064 6174 6173 6574  ataset = dataset
-0000fb00: 2e77 6974 685f 666f 726d 6174 282a 2a66  .with_format(**f
-0000fb10: 6f72 6d61 7429 0a0a 2020 2020 2020 2020  ormat)..        
-0000fb20: 7265 7475 726e 2064 6174 6173 6574 0a0a  return dataset..
-0000fb30: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-0000fb40: 2020 6465 6620 6461 7461 2873 656c 6629    def data(self)
-0000fb50: 202d 3e20 5461 626c 653a 0a20 2020 2020   -> Table:.     
-0000fb60: 2020 2022 2222 5468 6520 4170 6163 6865     """The Apache
-0000fb70: 2041 7272 6f77 2074 6162 6c65 2062 6163   Arrow table bac
-0000fb80: 6b69 6e67 2074 6865 2064 6174 6173 6574  king the dataset
-0000fb90: 2e0a 0a20 2020 2020 2020 2045 7861 6d70  ...        Examp
-0000fba0: 6c65 3a0a 0a20 2020 2020 2020 2060 6060  le:..        ```
-0000fbb0: 7079 0a20 2020 2020 2020 203e 3e3e 2066  py.        >>> f
-0000fbc0: 726f 6d20 6461 7461 7365 7473 2069 6d70  rom datasets imp
-0000fbd0: 6f72 7420 6c6f 6164 5f64 6174 6173 6574  ort load_dataset
-0000fbe0: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-0000fbf0: 3d20 6c6f 6164 5f64 6174 6173 6574 2822  = load_dataset("
-0000fc00: 726f 7474 656e 5f74 6f6d 6174 6f65 7322  rotten_tomatoes"
-0000fc10: 2c20 7370 6c69 743d 2276 616c 6964 6174  , split="validat
-0000fc20: 696f 6e22 290a 2020 2020 2020 2020 3e3e  ion").        >>
-0000fc30: 3e20 6473 2e64 6174 610a 2020 2020 2020  > ds.data.      
-0000fc40: 2020 4d65 6d6f 7279 4d61 7070 6564 5461    MemoryMappedTa
-0000fc50: 626c 650a 2020 2020 2020 2020 7465 7874  ble.        text
-0000fc60: 3a20 7374 7269 6e67 0a20 2020 2020 2020  : string.       
-0000fc70: 206c 6162 656c 3a20 696e 7436 340a 2020   label: int64.  
-0000fc80: 2020 2020 2020 2d2d 2d2d 0a20 2020 2020        ----.     
-0000fc90: 2020 2074 6578 743a 205b 5b22 636f 6d70     text: [["comp
-0000fca0: 6173 7369 6f6e 6174 656c 7920 6578 706c  assionately expl
-0000fcb0: 6f72 6573 2074 6865 2073 6565 6d69 6e67  ores the seeming
-0000fcc0: 6c79 2069 7272 6563 6f6e 6369 6c61 626c  ly irreconcilabl
-0000fcd0: 6520 7369 7475 6174 696f 6e20 6265 7477  e situation betw
-0000fce0: 6565 6e20 636f 6e73 6572 7661 7469 7665  een conservative
-0000fcf0: 2063 6872 6973 7469 616e 2070 6172 656e   christian paren
-0000fd00: 7473 2061 6e64 2074 6865 6972 2065 7374  ts and their est
-0000fd10: 7261 6e67 6564 2067 6179 2061 6e64 206c  ranged gay and l
-0000fd20: 6573 6269 616e 2063 6869 6c64 7265 6e20  esbian children 
-0000fd30: 2e22 2c22 7468 6520 736f 756e 6474 7261  .","the soundtra
-0000fd40: 636b 2061 6c6f 6e65 2069 7320 776f 7274  ck alone is wort
-0000fd50: 6820 7468 6520 7072 6963 6520 6f66 2061  h the price of a
-0000fd60: 646d 6973 7369 6f6e 202e 222c 2272 6f64  dmission .","rod
-0000fd70: 7269 6775 657a 2064 6f65 7320 6120 7370  riguez does a sp
-0000fd80: 6c65 6e64 6964 206a 6f62 206f 6620 7261  lendid job of ra
-0000fd90: 6369 616c 2070 726f 6669 6c69 6e67 2068  cial profiling h
-0000fda0: 6f6c 6c79 776f 6f64 2073 7479 6c65 2d2d  ollywood style--
-0000fdb0: 6361 7374 696e 6720 6578 6365 6c6c 656e  casting excellen
-0000fdc0: 7420 6c61 7469 6e20 6163 746f 7273 206f  t latin actors o
-0000fdd0: 6620 616c 6c20 6167 6573 2d2d 6120 7472  f all ages--a tr
-0000fde0: 656e 6420 6c6f 6e67 206f 7665 7264 7565  end long overdue
-0000fdf0: 202e 222c 2262 656e 6561 7468 2074 6865   .","beneath the
-0000fe00: 2066 696c 6d27 7320 6f62 7669 6f75 7320   film's obvious 
-0000fe10: 6465 7465 726d 696e 6174 696f 6e20 746f  determination to
-0000fe20: 2073 686f 636b 2061 7420 616e 7920 636f   shock at any co
-0000fe30: 7374 206c 6965 7320 636f 6e73 6964 6572  st lies consider
-0000fe40: 6162 6c65 2073 6b69 6c6c 2061 6e64 2064  able skill and d
-0000fe50: 6574 6572 6d69 6e61 7469 6f6e 202c 2062  etermination , b
-0000fe60: 6163 6b65 6420 6279 2073 6865 6572 206e  acked by sheer n
-0000fe70: 6572 7665 202e 222c 2262 6965 6c69 6e73  erve .","bielins
-0000fe80: 6b79 2069 7320 6120 6669 6c6d 6d61 6b65  ky is a filmmake
-0000fe90: 7220 6f66 2069 6d70 7265 7373 6976 6520  r of impressive 
-0000fea0: 7461 6c65 6e74 202e 222c 2273 6f20 6265  talent .","so be
-0000feb0: 6175 7469 6675 6c6c 7920 6163 7465 6420  autifully acted 
-0000fec0: 616e 6420 6469 7265 6374 6564 202c 2069  and directed , i
-0000fed0: 7427 7320 636c 6561 7220 7468 6174 2077  t's clear that w
-0000fee0: 6173 6869 6e67 746f 6e20 6d6f 7374 2063  ashington most c
-0000fef0: 6572 7461 696e 6c79 2068 6173 2061 206e  ertainly has a n
-0000ff00: 6577 2063 6172 6565 7220 6168 6561 6420  ew career ahead 
-0000ff10: 6f66 2068 696d 2069 6620 6865 2073 6f20  of him if he so 
-0000ff20: 6368 6f6f 7365 7320 2e22 2c22 6120 7669  chooses .","a vi
-0000ff30: 7375 616c 2073 7065 6374 6163 6c65 2066  sual spectacle f
-0000ff40: 756c 6c20 6f66 2073 7475 6e6e 696e 6720  ull of stunning 
-0000ff50: 696d 6167 6573 2061 6e64 2065 6666 6563  images and effec
-0000ff60: 7473 202e 222c 2261 2067 656e 746c 6520  ts .","a gentle 
-0000ff70: 616e 6420 656e 6772 6f73 7369 6e67 2063  and engrossing c
-0000ff80: 6861 7261 6374 6572 2073 7475 6479 202e  haracter study .
-0000ff90: 222c 2269 7427 7320 656e 6f75 6768 2074  ","it's enough t
-0000ffa0: 6f20 7761 7463 6820 6875 7070 6572 7420  o watch huppert 
-0000ffb0: 7363 6865 6d69 6e67 202c 2077 6974 6820  scheming , with 
-0000ffc0: 6865 7220 736d 616c 6c20 2c20 696e 7465  her small , inte
-0000ffd0: 6c6c 6967 656e 7420 6579 6573 2061 7320  lligent eyes as 
-0000ffe0: 7374 6561 6479 2061 7320 616e 7920 6e6f  steady as any no
-0000fff0: 6972 2076 696c 6c61 696e 202c 2061 6e64  ir villain , and
-00010000: 2074 6f20 656e 6a6f 7920 7468 6520 7065   to enjoy the pe
-00010010: 7266 6563 746c 7920 7069 7463 6865 6420  rfectly pitched 
-00010020: 7765 6220 6f66 2074 656e 7369 6f6e 2074  web of tension t
-00010030: 6861 7420 6368 6162 726f 6c20 7370 696e  hat chabrol spin
-00010040: 7320 2e22 2c22 616e 2065 6e67 726f 7373  s .","an engross
-00010050: 696e 6720 706f 7274 7261 6974 206f 6620  ing portrait of 
-00010060: 756e 636f 6d70 726f 6d69 7369 6e67 2061  uncompromising a
-00010070: 7274 6973 7473 2074 7279 696e 6720 746f  rtists trying to
-00010080: 2063 7265 6174 6520 736f 6d65 7468 696e   create somethin
-00010090: 6720 6f72 6967 696e 616c 2061 6761 696e  g original again
-000100a0: 7374 2074 6865 2062 6163 6b64 726f 7020  st the backdrop 
-000100b0: 6f66 2061 2063 6f72 706f 7261 7465 206d  of a corporate m
-000100c0: 7573 6963 2069 6e64 7573 7472 7920 7468  usic industry th
-000100d0: 6174 206f 6e6c 7920 7365 656d 7320 746f  at only seems to
-000100e0: 2063 6172 6520 6162 6f75 7420 7468 6520   care about the 
-000100f0: 626f 7474 6f6d 206c 696e 6520 2e22 2c2e  bottom line .",.
-00010100: 2e2e 2c22 756c 7469 6d61 7465 6c79 202c  ..,"ultimately ,
-00010110: 206a 616e 6520 6c65 6172 6e73 2068 6572   jane learns her
-00010120: 2070 6c61 6365 2061 7320 6120 6769 726c   place as a girl
-00010130: 202c 2073 6f66 7465 6e73 2075 7020 616e   , softens up an
-00010140: 6420 6c6f 7365 7320 736f 6d65 206f 6620  d loses some of 
-00010150: 7468 6520 696e 7465 6e73 6974 7920 7468  the intensity th
-00010160: 6174 206d 6164 6520 6865 7220 616e 2069  at made her an i
-00010170: 6e74 6572 6573 7469 6e67 2063 6861 7261  nteresting chara
-00010180: 6374 6572 2074 6f20 6265 6769 6e20 7769  cter to begin wi
-00010190: 7468 202e 222c 2261 682d 6e75 6c64 2773  th .","ah-nuld's
-000101a0: 2061 6374 696f 6e20 6865 726f 2064 6179   action hero day
-000101b0: 7320 6d69 6768 7420 6265 206f 7665 7220  s might be over 
-000101c0: 2e22 2c22 6974 2773 2063 6c65 6172 2077  .","it's clear w
-000101d0: 6879 2064 6575 6365 7320 7769 6c64 202c  hy deuces wild ,
-000101e0: 2077 6869 6368 2077 6173 2073 686f 7420   which was shot 
-000101f0: 7477 6f20 7965 6172 7320 6167 6f20 2c20  two years ago , 
-00010200: 6861 7320 6265 656e 2067 6174 6865 7269  has been gatheri
-00010210: 6e67 2064 7573 7420 6f6e 206d 676d 2773  ng dust on mgm's
-00010220: 2073 6865 6c66 202e 222c 2266 6565 6c73   shelf .","feels
-00010230: 206c 696b 6520 6e6f 7468 696e 6720 7175   like nothing qu
-00010240: 6974 6520 736f 206d 7563 6820 6173 2061  ite so much as a
-00010250: 206d 6964 646c 652d 6167 6564 206d 6f76   middle-aged mov
-00010260: 6965 6d61 6b65 7227 7320 6174 7465 6d70  iemaker's attemp
-00010270: 7420 746f 2073 7572 726f 756e 6420 6869  t to surround hi
-00010280: 6d73 656c 6620 7769 7468 2062 6561 7574  mself with beaut
-00010290: 6966 756c 202c 2068 616c 662d 6e61 6b65  iful , half-nake
-000102a0: 6420 776f 6d65 6e20 2e22 2c22 7768 656e  d women .","when
-000102b0: 2074 6865 2070 7265 6369 7365 206e 6174   the precise nat
-000102c0: 7572 6520 6f66 206d 6174 7468 6577 2773  ure of matthew's
-000102d0: 2070 7265 6469 6361 6d65 6e74 2066 696e   predicament fin
-000102e0: 616c 6c79 2063 6f6d 6573 2069 6e74 6f20  ally comes into 
-000102f0: 7368 6172 7020 666f 6375 7320 2c20 7468  sharp focus , th
-00010300: 6520 7265 7665 6c61 7469 6f6e 2066 6169  e revelation fai
-00010310: 6c73 2074 6f20 6a75 7374 6966 7920 7468  ls to justify th
-00010320: 6520 6275 696c 642d 7570 202e 222c 2274  e build-up .","t
-00010330: 6869 7320 7069 6374 7572 6520 6973 206d  his picture is m
-00010340: 7572 6465 7220 6279 206e 756d 6265 7273  urder by numbers
-00010350: 202c 2061 6e64 2061 7320 6561 7379 2074   , and as easy t
-00010360: 6f20 6265 2062 6f72 6564 2062 7920 6173  o be bored by as
-00010370: 2079 6f75 7220 6162 6327 7320 2c20 6465   your abc's , de
-00010380: 7370 6974 6520 6120 6665 7720 7768 6f70  spite a few whop
-00010390: 7069 6e67 2073 686f 6f74 6f75 7473 202e  ping shootouts .
-000103a0: 222c 2268 696c 6172 696f 7573 206d 7573  ","hilarious mus
-000103b0: 6963 616c 2063 6f6d 6564 7920 7468 6f75  ical comedy thou
-000103c0: 6768 2073 7479 6d69 6564 2062 7920 6163  gh stymied by ac
-000103d0: 6365 6e74 7320 7468 6963 6b20 6173 206d  cents thick as m
-000103e0: 7564 202e 222c 2269 6620 796f 7520 6172  ud .","if you ar
-000103f0: 6520 696e 746f 2073 706c 6174 7465 7220  e into splatter 
-00010400: 6d6f 7669 6573 202c 2074 6865 6e20 796f  movies , then yo
-00010410: 7520 7769 6c6c 2070 726f 6261 626c 7920  u will probably 
-00010420: 6861 7665 2061 2072 6561 736f 6e61 626c  have a reasonabl
-00010430: 7920 676f 6f64 2074 696d 6520 7769 7468  y good time with
-00010440: 2074 6865 2073 616c 746f 6e20 7365 6120   the salton sea 
-00010450: 2e22 2c22 6120 6475 6c6c 202c 2073 696d  .","a dull , sim
-00010460: 706c 652d 6d69 6e64 6564 2061 6e64 2073  ple-minded and s
-00010470: 7465 7265 6f74 7970 6963 616c 2074 616c  tereotypical tal
-00010480: 6520 6f66 2064 7275 6773 202c 2064 6561  e of drugs , dea
-00010490: 7468 2061 6e64 206d 696e 642d 6e75 6d62  th and mind-numb
-000104a0: 696e 6720 696e 6469 6666 6572 656e 6365  ing indifference
-000104b0: 206f 6e20 7468 6520 696e 6e65 722d 6369   on the inner-ci
-000104c0: 7479 2073 7472 6565 7473 202e 222c 2274  ty streets .","t
-000104d0: 6865 2066 6561 7475 7265 2d6c 656e 6774  he feature-lengt
-000104e0: 6820 7374 7265 7463 6820 2e20 2e20 2e20  h stretch . . . 
-000104f0: 7374 7261 696e 7320 7468 6520 7368 6f77  strains the show
-00010500: 2773 2063 6f6e 6365 7074 202e 225d 5d0a  's concept ."]].
-00010510: 2020 2020 2020 2020 6c61 6265 6c3a 205b          label: [
-00010520: 5b31 2c31 2c31 2c31 2c31 2c31 2c31 2c31  [1,1,1,1,1,1,1,1
-00010530: 2c31 2c31 2c2e 2e2e 2c30 2c30 2c30 2c30  ,1,1,...,0,0,0,0
-00010540: 2c30 2c30 2c30 2c30 2c30 2c30 5d5d 0a20  ,0,0,0,0,0,0]]. 
-00010550: 2020 2020 2020 2060 6060 0a20 2020 2020         ```.     
-00010560: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00010570: 6574 7572 6e20 7365 6c66 2e5f 6461 7461  eturn self._data
-00010580: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00010590: 2020 2020 6465 6620 6361 6368 655f 6669      def cache_fi
-000105a0: 6c65 7328 7365 6c66 2920 2d3e 204c 6973  les(self) -> Lis
-000105b0: 745b 6469 6374 5d3a 0a20 2020 2020 2020  t[dict]:.       
-000105c0: 2022 2222 5468 6520 6361 6368 6520 6669   """The cache fi
-000105d0: 6c65 7320 636f 6e74 6169 6e69 6e67 2074  les containing t
-000105e0: 6865 2041 7061 6368 6520 4172 726f 7720  he Apache Arrow 
-000105f0: 7461 626c 6520 6261 636b 696e 6720 7468  table backing th
-00010600: 6520 6461 7461 7365 742e 0a0a 2020 2020  e dataset...    
-00010610: 2020 2020 4578 616d 706c 653a 0a0a 2020      Example:..  
-00010620: 2020 2020 2020 6060 6070 790a 2020 2020        ```py.    
-00010630: 2020 2020 3e3e 3e20 6672 6f6d 2064 6174      >>> from dat
-00010640: 6173 6574 7320 696d 706f 7274 206c 6f61  asets import loa
-00010650: 645f 6461 7461 7365 740a 2020 2020 2020  d_dataset.      
-00010660: 2020 3e3e 3e20 6473 203d 206c 6f61 645f    >>> ds = load_
-00010670: 6461 7461 7365 7428 2272 6f74 7465 6e5f  dataset("rotten_
-00010680: 746f 6d61 746f 6573 222c 2073 706c 6974  tomatoes", split
-00010690: 3d22 7661 6c69 6461 7469 6f6e 2229 0a20  ="validation"). 
-000106a0: 2020 2020 2020 203e 3e3e 2064 732e 6361         >>> ds.ca
-000106b0: 6368 655f 6669 6c65 730a 2020 2020 2020  che_files.      
-000106c0: 2020 5b7b 2766 696c 656e 616d 6527 3a20    [{'filename': 
-000106d0: 272f 726f 6f74 2f2e 6361 6368 652f 6875  '/root/.cache/hu
-000106e0: 6767 696e 6766 6163 652f 6461 7461 7365  ggingface/datase
-000106f0: 7473 2f72 6f74 7465 6e5f 746f 6d61 746f  ts/rotten_tomato
-00010700: 6573 5f6d 6f76 6965 5f72 6576 6965 772f  es_movie_review/
-00010710: 6465 6661 756c 742f 312e 302e 302f 3430  default/1.0.0/40
-00010720: 6434 3131 6534 3561 3663 6533 3438 3464  d411e45a6ce3484d
-00010730: 6565 6437 6363 3135 6238 3261 3533 6461  eed7cc15b82a53da
-00010740: 6439 6137 3261 6166 6439 6638 3666 3866  d9a72aafd9f86f8f
-00010750: 3232 3731 3334 6265 6335 6361 3436 2f72  227134bec5ca46/r
-00010760: 6f74 7465 6e5f 746f 6d61 746f 6573 5f6d  otten_tomatoes_m
-00010770: 6f76 6965 5f72 6576 6965 772d 7661 6c69  ovie_review-vali
-00010780: 6461 7469 6f6e 2e61 7272 6f77 277d 5d0a  dation.arrow'}].
-00010790: 2020 2020 2020 2020 6060 600a 2020 2020          ```.    
-000107a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000107b0: 6361 6368 655f 6669 6c65 7320 3d20 6c69  cache_files = li
-000107c0: 7374 5f74 6162 6c65 5f63 6163 6865 5f66  st_table_cache_f
-000107d0: 696c 6573 2873 656c 662e 5f64 6174 6129  iles(self._data)
-000107e0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000107f0: 2e5f 696e 6469 6365 7320 6973 206e 6f74  ._indices is not
-00010800: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00010810: 2020 2063 6163 6865 5f66 696c 6573 202b     cache_files +
-00010820: 3d20 6c69 7374 5f74 6162 6c65 5f63 6163  = list_table_cac
-00010830: 6865 5f66 696c 6573 2873 656c 662e 5f69  he_files(self._i
-00010840: 6e64 6963 6573 290a 2020 2020 2020 2020  ndices).        
-00010850: 7265 7475 726e 205b 7b22 6669 6c65 6e61  return [{"filena
-00010860: 6d65 223a 2063 6163 6865 5f66 696c 656e  me": cache_filen
-00010870: 616d 657d 2066 6f72 2063 6163 6865 5f66  ame} for cache_f
-00010880: 696c 656e 616d 6520 696e 2063 6163 6865  ilename in cache
-00010890: 5f66 696c 6573 5d0a 0a20 2020 2040 7072  _files]..    @pr
-000108a0: 6f70 6572 7479 0a20 2020 2064 6566 206e  operty.    def n
-000108b0: 756d 5f63 6f6c 756d 6e73 2873 656c 6629  um_columns(self)
-000108c0: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
-000108d0: 2022 2222 4e75 6d62 6572 206f 6620 636f   """Number of co
-000108e0: 6c75 6d6e 7320 696e 2074 6865 2064 6174  lumns in the dat
-000108f0: 6173 6574 2e0a 0a20 2020 2020 2020 2045  aset...        E
-00010900: 7861 6d70 6c65 3a0a 0a20 2020 2020 2020  xample:..       
-00010910: 2060 6060 7079 0a20 2020 2020 2020 203e   ```py.        >
-00010920: 3e3e 2066 726f 6d20 6461 7461 7365 7473  >> from datasets
-00010930: 2069 6d70 6f72 7420 6c6f 6164 5f64 6174   import load_dat
-00010940: 6173 6574 0a20 2020 2020 2020 203e 3e3e  aset.        >>>
-00010950: 2064 7320 3d20 6c6f 6164 5f64 6174 6173   ds = load_datas
-00010960: 6574 2822 726f 7474 656e 5f74 6f6d 6174  et("rotten_tomat
-00010970: 6f65 7322 2c20 7370 6c69 743d 2276 616c  oes", split="val
-00010980: 6964 6174 696f 6e22 290a 2020 2020 2020  idation").      
-00010990: 2020 3e3e 3e20 6473 2e6e 756d 5f63 6f6c    >>> ds.num_col
-000109a0: 756d 6e73 0a20 2020 2020 2020 2032 0a20  umns.        2. 
-000109b0: 2020 2020 2020 2060 6060 0a20 2020 2020         ```.     
-000109c0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-000109d0: 6574 7572 6e20 7365 6c66 2e5f 6461 7461  eturn self._data
-000109e0: 2e6e 756d 5f63 6f6c 756d 6e73 0a0a 2020  .num_columns..  
-000109f0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00010a00: 6465 6620 6e75 6d5f 726f 7773 2873 656c  def num_rows(sel
-00010a10: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-00010a20: 2020 2022 2222 4e75 6d62 6572 206f 6620     """Number of 
-00010a30: 726f 7773 2069 6e20 7468 6520 6461 7461  rows in the data
-00010a40: 7365 7420 2873 616d 6520 6173 205b 6044  set (same as [`D
-00010a50: 6174 6173 6574 2e5f 5f6c 656e 5f5f 605d  ataset.__len__`]
-00010a60: 292e 0a0a 2020 2020 2020 2020 4578 616d  )...        Exam
-00010a70: 706c 653a 0a0a 2020 2020 2020 2020 6060  ple:..        ``
-00010a80: 6070 790a 2020 2020 2020 2020 3e3e 3e20  `py.        >>> 
-00010a90: 6672 6f6d 2064 6174 6173 6574 7320 696d  from datasets im
-00010aa0: 706f 7274 206c 6f61 645f 6461 7461 7365  port load_datase
-00010ab0: 740a 2020 2020 2020 2020 3e3e 3e20 6473  t.        >>> ds
-00010ac0: 203d 206c 6f61 645f 6461 7461 7365 7428   = load_dataset(
-00010ad0: 2272 6f74 7465 6e5f 746f 6d61 746f 6573  "rotten_tomatoes
-00010ae0: 222c 2073 706c 6974 3d22 7661 6c69 6461  ", split="valida
-00010af0: 7469 6f6e 2229 0a20 2020 2020 2020 203e  tion").        >
-00010b00: 3e3e 2064 732e 6e75 6d5f 726f 7773 0a20  >> ds.num_rows. 
-00010b10: 2020 2020 2020 2031 3036 360a 2020 2020         1066.    
-00010b20: 2020 2020 6060 600a 2020 2020 2020 2020      ```.        
-00010b30: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-00010b40: 656c 662e 5f69 6e64 6963 6573 2069 7320  elf._indices is 
-00010b50: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00010b60: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00010b70: 662e 5f69 6e64 6963 6573 2e6e 756d 5f72  f._indices.num_r
-00010b80: 6f77 730a 2020 2020 2020 2020 7265 7475  ows.        retu
-00010b90: 726e 2073 656c 662e 5f64 6174 612e 6e75  rn self._data.nu
-00010ba0: 6d5f 726f 7773 0a0a 2020 2020 4070 726f  m_rows..    @pro
-00010bb0: 7065 7274 790a 2020 2020 6465 6620 636f  perty.    def co
-00010bc0: 6c75 6d6e 5f6e 616d 6573 2873 656c 6629  lumn_names(self)
-00010bd0: 202d 3e20 4c69 7374 5b73 7472 5d3a 0a20   -> List[str]:. 
-00010be0: 2020 2020 2020 2022 2222 4e61 6d65 7320         """Names 
-00010bf0: 6f66 2074 6865 2063 6f6c 756d 6e73 2069  of the columns i
-00010c00: 6e20 7468 6520 6461 7461 7365 742e 0a0a  n the dataset...
-00010c10: 2020 2020 2020 2020 4578 616d 706c 653a          Example:
-00010c20: 0a0a 2020 2020 2020 2020 6060 6070 790a  ..        ```py.
-00010c30: 2020 2020 2020 2020 3e3e 3e20 6672 6f6d          >>> from
-00010c40: 2064 6174 6173 6574 7320 696d 706f 7274   datasets import
-00010c50: 206c 6f61 645f 6461 7461 7365 740a 2020   load_dataset.  
-00010c60: 2020 2020 2020 3e3e 3e20 6473 203d 206c        >>> ds = l
-00010c70: 6f61 645f 6461 7461 7365 7428 2272 6f74  oad_dataset("rot
-00010c80: 7465 6e5f 746f 6d61 746f 6573 222c 2073  ten_tomatoes", s
-00010c90: 706c 6974 3d22 7661 6c69 6461 7469 6f6e  plit="validation
-00010ca0: 2229 0a20 2020 2020 2020 203e 3e3e 2064  ").        >>> d
-00010cb0: 732e 636f 6c75 6d6e 5f6e 616d 6573 0a20  s.column_names. 
-00010cc0: 2020 2020 2020 205b 2774 6578 7427 2c20         ['text', 
-00010cd0: 276c 6162 656c 275d 0a20 2020 2020 2020  'label'].       
-00010ce0: 2060 6060 0a20 2020 2020 2020 2022 2222   ```.        """
-00010cf0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00010d00: 7365 6c66 2e5f 6461 7461 2e63 6f6c 756d  self._data.colum
-00010d10: 6e5f 6e61 6d65 730a 0a20 2020 2040 7072  n_names..    @pr
-00010d20: 6f70 6572 7479 0a20 2020 2064 6566 2073  operty.    def s
-00010d30: 6861 7065 2873 656c 6629 202d 3e20 5475  hape(self) -> Tu
-00010d40: 706c 655b 696e 742c 2069 6e74 5d3a 0a20  ple[int, int]:. 
-00010d50: 2020 2020 2020 2022 2222 5368 6170 6520         """Shape 
-00010d60: 6f66 2074 6865 2064 6174 6173 6574 2028  of the dataset (
-00010d70: 6e75 6d62 6572 206f 6620 636f 6c75 6d6e  number of column
-00010d80: 732c 206e 756d 6265 7220 6f66 2072 6f77  s, number of row
-00010d90: 7329 2e0a 0a20 2020 2020 2020 2045 7861  s)...        Exa
-00010da0: 6d70 6c65 3a0a 0a20 2020 2020 2020 2060  mple:..        `
-00010db0: 6060 7079 0a20 2020 2020 2020 203e 3e3e  ``py.        >>>
-00010dc0: 2066 726f 6d20 6461 7461 7365 7473 2069   from datasets i
-00010dd0: 6d70 6f72 7420 6c6f 6164 5f64 6174 6173  mport load_datas
-00010de0: 6574 0a20 2020 2020 2020 203e 3e3e 2064  et.        >>> d
-00010df0: 7320 3d20 6c6f 6164 5f64 6174 6173 6574  s = load_dataset
-00010e00: 2822 726f 7474 656e 5f74 6f6d 6174 6f65  ("rotten_tomatoe
-00010e10: 7322 2c20 7370 6c69 743d 2276 616c 6964  s", split="valid
-00010e20: 6174 696f 6e22 290a 2020 2020 2020 2020  ation").        
-00010e30: 3e3e 3e20 6473 2e73 6861 7065 0a20 2020  >>> ds.shape.   
-00010e40: 2020 2020 2028 3130 3636 2c20 3229 0a20       (1066, 2). 
-00010e50: 2020 2020 2020 2060 6060 0a20 2020 2020         ```.     
-00010e60: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00010e70: 6620 7365 6c66 2e5f 696e 6469 6365 7320  f self._indices 
-00010e80: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00010e90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00010ea0: 2873 656c 662e 5f69 6e64 6963 6573 2e6e  (self._indices.n
-00010eb0: 756d 5f72 6f77 732c 2073 656c 662e 5f64  um_rows, self._d
-00010ec0: 6174 612e 6e75 6d5f 636f 6c75 6d6e 7329  ata.num_columns)
-00010ed0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00010ee0: 7365 6c66 2e5f 6461 7461 2e73 6861 7065  self._data.shape
-00010ef0: 0a0a 2020 2020 6465 6620 756e 6971 7565  ..    def unique
-00010f00: 2873 656c 662c 2063 6f6c 756d 6e3a 2073  (self, column: s
-00010f10: 7472 2920 2d3e 204c 6973 743a 0a20 2020  tr) -> List:.   
-00010f20: 2020 2020 2022 2222 5265 7475 726e 2061       """Return a
-00010f30: 206c 6973 7420 6f66 2074 6865 2075 6e69   list of the uni
-00010f40: 7175 6520 656c 656d 656e 7473 2069 6e20  que elements in 
-00010f50: 6120 636f 6c75 6d6e 2e0a 0a20 2020 2020  a column...     
-00010f60: 2020 2054 6869 7320 6973 2069 6d70 6c65     This is imple
-00010f70: 6d65 6e74 6564 2069 6e20 7468 6520 6c6f  mented in the lo
-00010f80: 772d 6c65 7665 6c20 6261 636b 656e 6420  w-level backend 
-00010f90: 616e 6420 6173 2073 7563 682c 2076 6572  and as such, ver
-00010fa0: 7920 6661 7374 2e0a 0a20 2020 2020 2020  y fast...       
-00010fb0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00010fc0: 2020 2063 6f6c 756d 6e20 2860 7374 7260     column (`str`
-00010fd0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00010fe0: 2020 2043 6f6c 756d 6e20 6e61 6d65 2028     Column name (
-00010ff0: 6c69 7374 2061 6c6c 2074 6865 2063 6f6c  list all the col
-00011000: 756d 6e20 6e61 6d65 7320 7769 7468 205b  umn names with [
-00011010: 7e60 6461 7461 7365 7473 2e44 6174 6173  ~`datasets.Datas
-00011020: 6574 2e63 6f6c 756d 6e5f 6e61 6d65 7360  et.column_names`
-00011030: 5d29 2e0a 0a20 2020 2020 2020 2052 6574  ])...        Ret
-00011040: 7572 6e73 3a0a 2020 2020 2020 2020 2020  urns:.          
-00011050: 2020 606c 6973 7460 3a20 4c69 7374 206f    `list`: List o
-00011060: 6620 756e 6971 7565 2065 6c65 6d65 6e74  f unique element
-00011070: 7320 696e 2074 6865 2067 6976 656e 2063  s in the given c
-00011080: 6f6c 756d 6e2e 0a0a 2020 2020 2020 2020  olumn...        
-00011090: 4578 616d 706c 653a 0a0a 2020 2020 2020  Example:..      
-000110a0: 2020 6060 6070 790a 2020 2020 2020 2020    ```py.        
-000110b0: 3e3e 3e20 6672 6f6d 2064 6174 6173 6574  >>> from dataset
-000110c0: 7320 696d 706f 7274 206c 6f61 645f 6461  s import load_da
-000110d0: 7461 7365 740a 2020 2020 2020 2020 3e3e  taset.        >>
-000110e0: 3e20 6473 203d 206c 6f61 645f 6461 7461  > ds = load_data
-000110f0: 7365 7428 2272 6f74 7465 6e5f 746f 6d61  set("rotten_toma
-00011100: 746f 6573 222c 2073 706c 6974 3d22 7661  toes", split="va
-00011110: 6c69 6461 7469 6f6e 2229 0a20 2020 2020  lidation").     
-00011120: 2020 203e 3e3e 2064 732e 756e 6971 7565     >>> ds.unique
-00011130: 2827 6c61 6265 6c27 290a 2020 2020 2020  ('label').      
-00011140: 2020 5b31 2c20 305d 0a20 2020 2020 2020    [1, 0].       
-00011150: 2060 6060 0a20 2020 2020 2020 2022 2222   ```.        """
-00011160: 0a20 2020 2020 2020 2069 6620 636f 6c75  .        if colu
-00011170: 6d6e 206e 6f74 2069 6e20 7365 6c66 2e5f  mn not in self._
-00011180: 6461 7461 2e63 6f6c 756d 6e5f 6e61 6d65  data.column_name
-00011190: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-000111a0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000111b0: 6622 436f 6c75 6d6e 2028 7b63 6f6c 756d  f"Column ({colum
-000111c0: 6e7d 2920 6e6f 7420 696e 2074 6162 6c65  n}) not in table
-000111d0: 2063 6f6c 756d 6e73 2028 7b73 656c 662e   columns ({self.
-000111e0: 5f64 6174 612e 636f 6c75 6d6e 5f6e 616d  _data.column_nam
-000111f0: 6573 7d29 2e22 290a 0a20 2020 2020 2020  es}).")..       
-00011200: 2069 6620 7365 6c66 2e5f 696e 6469 6365   if self._indice
-00011210: 7320 6973 206e 6f74 204e 6f6e 6520 616e  s is not None an
-00011220: 6420 7365 6c66 2e5f 696e 6469 6365 732e  d self._indices.
-00011230: 6e75 6d5f 726f 7773 2021 3d20 7365 6c66  num_rows != self
-00011240: 2e5f 6461 7461 2e6e 756d 5f72 6f77 733a  ._data.num_rows:
-00011250: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00011260: 6173 6574 203d 2073 656c 662e 666c 6174  aset = self.flat
-00011270: 7465 6e5f 696e 6469 6365 7328 290a 2020  ten_indices().  
-00011280: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00011290: 2020 2020 2020 2020 6461 7461 7365 7420          dataset 
-000112a0: 3d20 7365 6c66 0a0a 2020 2020 2020 2020  = self..        
-000112b0: 7265 7475 726e 2064 6174 6173 6574 2e5f  return dataset._
-000112c0: 6461 7461 2e63 6f6c 756d 6e28 636f 6c75  data.column(colu
-000112d0: 6d6e 292e 756e 6971 7565 2829 2e74 6f5f  mn).unique().to_
-000112e0: 7079 6c69 7374 2829 0a0a 2020 2020 6465  pylist()..    de
-000112f0: 6620 636c 6173 735f 656e 636f 6465 5f63  f class_encode_c
-00011300: 6f6c 756d 6e28 7365 6c66 2c20 636f 6c75  olumn(self, colu
-00011310: 6d6e 3a20 7374 722c 2069 6e63 6c75 6465  mn: str, include
-00011320: 5f6e 756c 6c73 3a20 626f 6f6c 203d 2046  _nulls: bool = F
-00011330: 616c 7365 2920 2d3e 2022 4461 7461 7365  alse) -> "Datase
-00011340: 7422 3a0a 2020 2020 2020 2020 2222 2243  t":.        """C
-00011350: 6173 7473 2074 6865 2067 6976 656e 2063  asts the given c
-00011360: 6f6c 756d 6e20 6173 205b 7e60 6461 7461  olumn as [~`data
-00011370: 7365 7473 2e66 6561 7475 7265 732e 436c  sets.features.Cl
-00011380: 6173 734c 6162 656c 5d60 2061 6e64 2075  assLabel]` and u
-00011390: 7064 6174 6573 2074 6865 2074 6162 6c65  pdates the table
-000113a0: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-000113b0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-000113c0: 756d 6e20 2860 7374 7260 293a 0a20 2020  umn (`str`):.   
-000113d0: 2020 2020 2020 2020 2020 2020 2054 6865               The
-000113e0: 206e 616d 6520 6f66 2074 6865 2063 6f6c   name of the col
-000113f0: 756d 6e20 746f 2063 6173 7420 286c 6973  umn to cast (lis
-00011400: 7420 616c 6c20 7468 6520 636f 6c75 6d6e  t all the column
-00011410: 206e 616d 6573 2077 6974 6820 5b7e 6064   names with [~`d
-00011420: 6174 6173 6574 732e 4461 7461 7365 742e  atasets.Dataset.
-00011430: 636f 6c75 6d6e 5f6e 616d 6573 605d 290a  column_names`]).
-00011440: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-00011450: 7564 655f 6e75 6c6c 7320 2860 626f 6f6c  ude_nulls (`bool
-00011460: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
-00011470: 4661 6c73 6560 293a 0a20 2020 2020 2020  False`):.       
-00011480: 2020 2020 2020 2020 2057 6865 7468 6572           Whether
-00011490: 2074 6f20 696e 636c 7564 6520 6e75 6c6c   to include null
-000114a0: 2076 616c 7565 7320 696e 2074 6865 2063   values in the c
-000114b0: 6c61 7373 206c 6162 656c 732e 2049 6620  lass labels. If 
-000114c0: 6054 7275 6560 2c20 7468 6520 6e75 6c6c  `True`, the null
-000114d0: 2076 616c 7565 7320 7769 6c6c 2062 6520   values will be 
-000114e0: 656e 636f 6465 6420 6173 2074 6865 2060  encoded as the `
-000114f0: 224e 6f6e 6522 6020 636c 6173 7320 6c61  "None"` class la
-00011500: 6265 6c2e 0a0a 2020 2020 2020 2020 2020  bel...          
-00011510: 2020 2020 2020 3c41 6464 6564 2076 6572        <Added ver
-00011520: 7369 6f6e 3d22 312e 3134 2e32 222f 3e0a  sion="1.14.2"/>.
-00011530: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-00011540: 3a0a 0a20 2020 2020 2020 2060 6060 7079  :..        ```py
-00011550: 0a20 2020 2020 2020 203e 3e3e 2066 726f  .        >>> fro
-00011560: 6d20 6461 7461 7365 7473 2069 6d70 6f72  m datasets impor
-00011570: 7420 6c6f 6164 5f64 6174 6173 6574 0a20  t load_dataset. 
-00011580: 2020 2020 2020 203e 3e3e 2064 7320 3d20         >>> ds = 
-00011590: 6c6f 6164 5f64 6174 6173 6574 2822 626f  load_dataset("bo
-000115a0: 6f6c 7122 2c20 7370 6c69 743d 2276 616c  olq", split="val
-000115b0: 6964 6174 696f 6e22 290a 2020 2020 2020  idation").      
-000115c0: 2020 3e3e 3e20 6473 2e66 6561 7475 7265    >>> ds.feature
-000115d0: 730a 2020 2020 2020 2020 7b27 616e 7377  s.        {'answ
-000115e0: 6572 273a 2056 616c 7565 2864 7479 7065  er': Value(dtype
-000115f0: 3d27 626f 6f6c 272c 2069 643d 4e6f 6e65  ='bool', id=None
-00011600: 292c 0a20 2020 2020 2020 2020 2770 6173  ),.         'pas
-00011610: 7361 6765 273a 2056 616c 7565 2864 7479  sage': Value(dty
-00011620: 7065 3d27 7374 7269 6e67 272c 2069 643d  pe='string', id=
-00011630: 4e6f 6e65 292c 0a20 2020 2020 2020 2020  None),.         
-00011640: 2771 7565 7374 696f 6e27 3a20 5661 6c75  'question': Valu
-00011650: 6528 6474 7970 653d 2773 7472 696e 6727  e(dtype='string'
-00011660: 2c20 6964 3d4e 6f6e 6529 7d0a 2020 2020  , id=None)}.    
-00011670: 2020 2020 3e3e 3e20 6473 203d 2064 732e      >>> ds = ds.
-00011680: 636c 6173 735f 656e 636f 6465 5f63 6f6c  class_encode_col
-00011690: 756d 6e28 2761 6e73 7765 7227 290a 2020  umn('answer').  
-000116a0: 2020 2020 2020 3e3e 3e20 6473 2e66 6561        >>> ds.fea
-000116b0: 7475 7265 730a 2020 2020 2020 2020 7b27  tures.        {'
-000116c0: 616e 7377 6572 273a 2043 6c61 7373 4c61  answer': ClassLa
-000116d0: 6265 6c28 6e75 6d5f 636c 6173 7365 733d  bel(num_classes=
-000116e0: 322c 206e 616d 6573 3d5b 2746 616c 7365  2, names=['False
-000116f0: 272c 2027 5472 7565 275d 2c20 6964 3d4e  ', 'True'], id=N
-00011700: 6f6e 6529 2c0a 2020 2020 2020 2020 2027  one),.         '
-00011710: 7061 7373 6167 6527 3a20 5661 6c75 6528  passage': Value(
-00011720: 6474 7970 653d 2773 7472 696e 6727 2c20  dtype='string', 
-00011730: 6964 3d4e 6f6e 6529 2c0a 2020 2020 2020  id=None),.      
-00011740: 2020 2027 7175 6573 7469 6f6e 273a 2056     'question': V
-00011750: 616c 7565 2864 7479 7065 3d27 7374 7269  alue(dtype='stri
-00011760: 6e67 272c 2069 643d 4e6f 6e65 297d 0a20  ng', id=None)}. 
-00011770: 2020 2020 2020 2060 6060 0a20 2020 2020         ```.     
-00011780: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-00011790: 2053 616e 6974 7920 6368 6563 6b73 0a20   Sanity checks. 
-000117a0: 2020 2020 2020 2069 6620 636f 6c75 6d6e         if column
-000117b0: 206e 6f74 2069 6e20 7365 6c66 2e5f 6461   not in self._da
-000117c0: 7461 2e63 6f6c 756d 6e5f 6e61 6d65 733a  ta.column_names:
-000117d0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000117e0: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-000117f0: 436f 6c75 6d6e 2028 7b63 6f6c 756d 6e7d  Column ({column}
-00011800: 2920 6e6f 7420 696e 2074 6162 6c65 2063  ) not in table c
-00011810: 6f6c 756d 6e73 2028 7b73 656c 662e 5f64  olumns ({self._d
-00011820: 6174 612e 636f 6c75 6d6e 5f6e 616d 6573  ata.column_names
-00011830: 7d29 2e22 290a 2020 2020 2020 2020 7372  }).").        sr
-00011840: 635f 6665 6174 203d 2073 656c 662e 6665  c_feat = self.fe
-00011850: 6174 7572 6573 5b63 6f6c 756d 6e5d 0a20  atures[column]. 
-00011860: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00011870: 696e 7374 616e 6365 2873 7263 5f66 6561  instance(src_fea
-00011880: 742c 2056 616c 7565 293a 0a20 2020 2020  t, Value):.     
-00011890: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000118a0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-000118b0: 2020 2020 2020 2020 2066 2243 6c61 7373           f"Class
-000118c0: 2065 6e63 6f64 696e 6720 6973 206f 6e6c   encoding is onl
-000118d0: 7920 7375 7070 6f72 7465 6420 666f 7220  y supported for 
-000118e0: 7b56 616c 7565 2e5f 5f6e 616d 655f 5f7d  {Value.__name__}
-000118f0: 2063 6f6c 756d 6e2c 2061 6e64 2063 6f6c   column, and col
-00011900: 756d 6e20 7b63 6f6c 756d 6e7d 2069 7320  umn {column} is 
-00011910: 7b74 7970 6528 7372 635f 6665 6174 292e  {type(src_feat).
-00011920: 5f5f 6e61 6d65 5f5f 7d2e 220a 2020 2020  __name__}.".    
-00011930: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00011940: 2020 2069 6620 7372 635f 6665 6174 2e64     if src_feat.d
-00011950: 7479 7065 2021 3d20 2273 7472 696e 6722  type != "string"
-00011960: 206f 7220 2869 6e63 6c75 6465 5f6e 756c   or (include_nul
-00011970: 6c73 2061 6e64 204e 6f6e 6520 696e 2073  ls and None in s
-00011980: 656c 662e 756e 6971 7565 2863 6f6c 756d  elf.unique(colum
-00011990: 6e29 293a 0a0a 2020 2020 2020 2020 2020  n)):..          
-000119a0: 2020 6465 6620 7374 7269 6e67 6966 795f    def stringify_
-000119b0: 636f 6c75 6d6e 2862 6174 6368 293a 0a20  column(batch):. 
-000119c0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-000119d0: 6174 6368 5b63 6f6c 756d 6e5d 203d 205b  atch[column] = [
-000119e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000119f0: 2020 2020 2073 7472 2873 616d 706c 6529       str(sample)
-00011a00: 2069 6620 696e 636c 7564 655f 6e75 6c6c   if include_null
-00011a10: 7320 6f72 2073 616d 706c 6520 6973 206e  s or sample is n
-00011a20: 6f74 204e 6f6e 6520 656c 7365 204e 6f6e  ot None else Non
-00011a30: 6520 666f 7220 7361 6d70 6c65 2069 6e20  e for sample in 
-00011a40: 6261 7463 685b 636f 6c75 6d6e 5d0a 2020  batch[column].  
-00011a50: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
-00011a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a70: 7265 7475 726e 2062 6174 6368 0a0a 2020  return batch..  
-00011a80: 2020 2020 2020 2020 2020 6473 6574 203d            dset =
-00011a90: 2073 656c 662e 6d61 7028 0a20 2020 2020   self.map(.     
-00011aa0: 2020 2020 2020 2020 2020 2073 7472 696e             strin
-00011ab0: 6769 6679 5f63 6f6c 756d 6e2c 0a20 2020  gify_column,.   
-00011ac0: 2020 2020 2020 2020 2020 2020 2062 6174               bat
-00011ad0: 6368 6564 3d54 7275 652c 0a20 2020 2020  ched=True,.     
-00011ae0: 2020 2020 2020 2020 2020 2064 6573 633d             desc=
-00011af0: 2253 7472 696e 6769 6679 696e 6720 7468  "Stringifying th
-00011b00: 6520 636f 6c75 6d6e 222c 0a20 2020 2020  e column",.     
-00011b10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00011b20: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00011b30: 2020 2064 7365 7420 3d20 7365 6c66 0a0a     dset = self..
-00011b40: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
-00011b50: 2074 6865 206e 6577 2066 6561 7475 7265   the new feature
-00011b60: 0a20 2020 2020 2020 2063 6c61 7373 5f6e  .        class_n
-00011b70: 616d 6573 203d 2073 6f72 7465 6428 7374  ames = sorted(st
-00011b80: 7228 7361 6d70 6c65 2920 666f 7220 7361  r(sample) for sa
-00011b90: 6d70 6c65 2069 6e20 6473 6574 2e75 6e69  mple in dset.uni
-00011ba0: 7175 6528 636f 6c75 6d6e 2920 6966 2069  que(column) if i
-00011bb0: 6e63 6c75 6465 5f6e 756c 6c73 206f 7220  nclude_nulls or 
-00011bc0: 7361 6d70 6c65 2069 7320 6e6f 7420 4e6f  sample is not No
-00011bd0: 6e65 290a 2020 2020 2020 2020 6473 745f  ne).        dst_
-00011be0: 6665 6174 203d 2043 6c61 7373 4c61 6265  feat = ClassLabe
-00011bf0: 6c28 6e61 6d65 733d 636c 6173 735f 6e61  l(names=class_na
-00011c00: 6d65 7329 0a0a 2020 2020 2020 2020 6465  mes)..        de
-00011c10: 6620 6361 7374 5f74 6f5f 636c 6173 735f  f cast_to_class_
-00011c20: 6c61 6265 6c73 2862 6174 6368 293a 0a20  labels(batch):. 
-00011c30: 2020 2020 2020 2020 2020 2062 6174 6368             batch
-00011c40: 5b63 6f6c 756d 6e5d 203d 205b 0a20 2020  [column] = [.   
-00011c50: 2020 2020 2020 2020 2020 2020 2064 7374               dst
-00011c60: 5f66 6561 742e 7374 7232 696e 7428 7374  _feat.str2int(st
-00011c70: 7228 7361 6d70 6c65 2929 2069 6620 696e  r(sample)) if in
-00011c80: 636c 7564 655f 6e75 6c6c 7320 6f72 2073  clude_nulls or s
-00011c90: 616d 706c 6520 6973 206e 6f74 204e 6f6e  ample is not Non
-00011ca0: 6520 656c 7365 204e 6f6e 650a 2020 2020  e else None.    
-00011cb0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00011cc0: 7361 6d70 6c65 2069 6e20 6261 7463 685b  sample in batch[
-00011cd0: 636f 6c75 6d6e 5d0a 2020 2020 2020 2020  column].        
-00011ce0: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
-00011cf0: 2020 7265 7475 726e 2062 6174 6368 0a0a    return batch..
-00011d00: 2020 2020 2020 2020 6e65 775f 6665 6174          new_feat
-00011d10: 7572 6573 203d 2064 7365 742e 6665 6174  ures = dset.feat
-00011d20: 7572 6573 2e63 6f70 7928 290a 2020 2020  ures.copy().    
-00011d30: 2020 2020 6e65 775f 6665 6174 7572 6573      new_features
-00011d40: 5b63 6f6c 756d 6e5d 203d 2064 7374 5f66  [column] = dst_f
-00011d50: 6561 740a 0a20 2020 2020 2020 2064 7365  eat..        dse
-00011d60: 7420 3d20 6473 6574 2e6d 6170 280a 2020  t = dset.map(.  
-00011d70: 2020 2020 2020 2020 2020 6361 7374 5f74            cast_t
-00011d80: 6f5f 636c 6173 735f 6c61 6265 6c73 2c0a  o_class_labels,.
-00011d90: 2020 2020 2020 2020 2020 2020 6261 7463              batc
-00011da0: 6865 643d 5472 7565 2c0a 2020 2020 2020  hed=True,.      
-00011db0: 2020 2020 2020 6665 6174 7572 6573 3d6e        features=n
-00011dc0: 6577 5f66 6561 7475 7265 732c 0a20 2020  ew_features,.   
-00011dd0: 2020 2020 2020 2020 2064 6573 633d 2243           desc="C
-00011de0: 6173 7469 6e67 2074 6f20 636c 6173 7320  asting to class 
-00011df0: 6c61 6265 6c73 222c 0a20 2020 2020 2020  labels",.       
-00011e00: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
-00011e10: 726e 2064 7365 740a 0a20 2020 2040 6669  rn dset..    @fi
-00011e20: 6e67 6572 7072 696e 745f 7472 616e 7366  ngerprint_transf
-00011e30: 6f72 6d28 696e 706c 6163 653d 4661 6c73  orm(inplace=Fals
-00011e40: 6529 0a20 2020 2064 6566 2066 6c61 7474  e).    def flatt
-00011e50: 656e 2873 656c 662c 206e 6577 5f66 696e  en(self, new_fin
-00011e60: 6765 7270 7269 6e74 3a20 4f70 7469 6f6e  gerprint: Option
-00011e70: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c20  al[str] = None, 
-00011e80: 6d61 785f 6465 7074 683d 3136 2920 2d3e  max_depth=16) ->
-00011e90: 2022 4461 7461 7365 7422 3a0a 2020 2020   "Dataset":.    
-00011ea0: 2020 2020 2222 2246 6c61 7474 656e 2074      """Flatten t
-00011eb0: 6865 2074 6162 6c65 2e0a 2020 2020 2020  he table..      
-00011ec0: 2020 4561 6368 2063 6f6c 756d 6e20 7769    Each column wi
-00011ed0: 7468 2061 2073 7472 7563 7420 7479 7065  th a struct type
-00011ee0: 2069 7320 666c 6174 7465 6e65 6420 696e   is flattened in
-00011ef0: 746f 206f 6e65 2063 6f6c 756d 6e20 7065  to one column pe
-00011f00: 7220 7374 7275 6374 2066 6965 6c64 2e0a  r struct field..
-00011f10: 2020 2020 2020 2020 4f74 6865 7220 636f          Other co
-00011f20: 6c75 6d6e 7320 6172 6520 6c65 6674 2075  lumns are left u
-00011f30: 6e63 6861 6e67 6564 2e0a 0a20 2020 2020  nchanged...     
-00011f40: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00011f50: 2020 2020 206e 6577 5f66 696e 6765 7270       new_fingerp
-00011f60: 7269 6e74 2028 6073 7472 602c 202a 6f70  rint (`str`, *op
-00011f70: 7469 6f6e 616c 2a29 3a0a 2020 2020 2020  tional*):.      
-00011f80: 2020 2020 2020 2020 2020 5468 6520 6e65            The ne
-00011f90: 7720 6669 6e67 6572 7072 696e 7420 6f66  w fingerprint of
-00011fa0: 2074 6865 2064 6174 6173 6574 2061 6674   the dataset aft
-00011fb0: 6572 2074 7261 6e73 666f 726d 2e0a 2020  er transform..  
-00011fc0: 2020 2020 2020 2020 2020 2020 2020 4966                If
-00011fd0: 2060 4e6f 6e65 602c 2074 6865 206e 6577   `None`, the new
-00011fe0: 2066 696e 6765 7270 7269 6e74 2069 7320   fingerprint is 
-00011ff0: 636f 6d70 7574 6564 2075 7369 6e67 2061  computed using a
-00012000: 2068 6173 6820 6f66 2074 6865 2070 7265   hash of the pre
-00012010: 7669 6f75 7320 6669 6e67 6572 7072 696e  vious fingerprin
-00012020: 742c 2061 6e64 2074 6865 2074 7261 6e73  t, and the trans
-00012030: 666f 726d 2061 7267 756d 656e 7473 2e0a  form arguments..
-00012040: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00012050: 3a0a 2020 2020 2020 2020 2020 2020 5b60  :.            [`
-00012060: 4461 7461 7365 7460 5d3a 2041 2063 6f70  Dataset`]: A cop
-00012070: 7920 6f66 2074 6865 2064 6174 6173 6574  y of the dataset
-00012080: 2077 6974 6820 666c 6174 7465 6e65 6420   with flattened 
-00012090: 636f 6c75 6d6e 732e 0a0a 2020 2020 2020  columns...      
-000120a0: 2020 4578 616d 706c 653a 0a0a 2020 2020    Example:..    
-000120b0: 2020 2020 6060 6070 790a 2020 2020 2020      ```py.      
-000120c0: 2020 3e3e 3e20 6672 6f6d 2064 6174 6173    >>> from datas
-000120d0: 6574 7320 696d 706f 7274 206c 6f61 645f  ets import load_
-000120e0: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
-000120f0: 3e3e 3e20 6473 203d 206c 6f61 645f 6461  >>> ds = load_da
-00012100: 7461 7365 7428 2273 7175 6164 222c 2073  taset("squad", s
-00012110: 706c 6974 3d22 7472 6169 6e22 290a 2020  plit="train").  
-00012120: 2020 2020 2020 3e3e 3e20 6473 2e66 6561        >>> ds.fea
-00012130: 7475 7265 730a 2020 2020 2020 2020 7b27  tures.        {'
-00012140: 616e 7377 6572 7327 3a20 5365 7175 656e  answers': Sequen
-00012150: 6365 2866 6561 7475 7265 3d7b 2774 6578  ce(feature={'tex
-00012160: 7427 3a20 5661 6c75 6528 6474 7970 653d  t': Value(dtype=
-00012170: 2773 7472 696e 6727 2c20 6964 3d4e 6f6e  'string', id=Non
-00012180: 6529 2c20 2761 6e73 7765 725f 7374 6172  e), 'answer_star
-00012190: 7427 3a20 5661 6c75 6528 6474 7970 653d  t': Value(dtype=
-000121a0: 2769 6e74 3332 272c 2069 643d 4e6f 6e65  'int32', id=None
-000121b0: 297d 2c20 6c65 6e67 7468 3d2d 312c 2069  )}, length=-1, i
-000121c0: 643d 4e6f 6e65 292c 0a20 2020 2020 2020  d=None),.       
-000121d0: 2020 2763 6f6e 7465 7874 273a 2056 616c    'context': Val
-000121e0: 7565 2864 7479 7065 3d27 7374 7269 6e67  ue(dtype='string
-000121f0: 272c 2069 643d 4e6f 6e65 292c 0a20 2020  ', id=None),.   
-00012200: 2020 2020 2020 2769 6427 3a20 5661 6c75        'id': Valu
-00012210: 6528 6474 7970 653d 2773 7472 696e 6727  e(dtype='string'
-00012220: 2c20 6964 3d4e 6f6e 6529 2c0a 2020 2020  , id=None),.    
-00012230: 2020 2020 2027 7175 6573 7469 6f6e 273a       'question':
-00012240: 2056 616c 7565 2864 7479 7065 3d27 7374   Value(dtype='st
-00012250: 7269 6e67 272c 2069 643d 4e6f 6e65 292c  ring', id=None),
-00012260: 0a20 2020 2020 2020 2020 2774 6974 6c65  .         'title
-00012270: 273a 2056 616c 7565 2864 7479 7065 3d27  ': Value(dtype='
-00012280: 7374 7269 6e67 272c 2069 643d 4e6f 6e65  string', id=None
-00012290: 297d 0a20 2020 2020 2020 203e 3e3e 2064  )}.        >>> d
-000122a0: 732e 666c 6174 7465 6e28 290a 2020 2020  s.flatten().    
-000122b0: 2020 2020 4461 7461 7365 7428 7b0a 2020      Dataset({.  
-000122c0: 2020 2020 2020 2020 2020 6665 6174 7572            featur
-000122d0: 6573 3a20 5b27 6964 272c 2027 7469 746c  es: ['id', 'titl
-000122e0: 6527 2c20 2763 6f6e 7465 7874 272c 2027  e', 'context', '
-000122f0: 7175 6573 7469 6f6e 272c 2027 616e 7377  question', 'answ
-00012300: 6572 732e 7465 7874 272c 2027 616e 7377  ers.text', 'answ
-00012310: 6572 732e 616e 7377 6572 5f73 7461 7274  ers.answer_start
-00012320: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00012330: 6e75 6d5f 726f 7773 3a20 3837 3539 390a  num_rows: 87599.
-00012340: 2020 2020 2020 2020 7d29 0a20 2020 2020          }).     
-00012350: 2020 2060 6060 0a20 2020 2020 2020 2022     ```.        "
-00012360: 2222 0a20 2020 2020 2020 2064 6174 6173  "".        datas
-00012370: 6574 203d 2063 6f70 792e 6465 6570 636f  et = copy.deepco
-00012380: 7079 2873 656c 6629 0a20 2020 2020 2020  py(self).       
-00012390: 2066 6f72 2064 6570 7468 2069 6e20 7261   for depth in ra
-000123a0: 6e67 6528 312c 206d 6178 5f64 6570 7468  nge(1, max_depth
-000123b0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-000123c0: 6620 616e 7928 6973 696e 7374 616e 6365  f any(isinstance
-000123d0: 2866 6965 6c64 2e74 7970 652c 2070 612e  (field.type, pa.
-000123e0: 5374 7275 6374 5479 7065 2920 666f 7220  StructType) for 
-000123f0: 6669 656c 6420 696e 2064 6174 6173 6574  field in dataset
-00012400: 2e5f 6461 7461 2e73 6368 656d 6129 3a0a  ._data.schema):.
-00012410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012420: 6461 7461 7365 742e 5f64 6174 6120 3d20  dataset._data = 
-00012430: 6461 7461 7365 742e 5f64 6174 612e 666c  dataset._data.fl
-00012440: 6174 7465 6e28 290a 2020 2020 2020 2020  atten().        
-00012450: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00012460: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00012470: 2020 2020 2020 2020 6461 7461 7365 742e          dataset.
-00012480: 696e 666f 2e66 6561 7475 7265 7320 3d20  info.features = 
-00012490: 7365 6c66 2e66 6561 7475 7265 732e 666c  self.features.fl
-000124a0: 6174 7465 6e28 6d61 785f 6465 7074 683d  atten(max_depth=
-000124b0: 6d61 785f 6465 7074 6829 0a20 2020 2020  max_depth).     
-000124c0: 2020 2064 6174 6173 6574 2e5f 6461 7461     dataset._data
-000124d0: 203d 2075 7064 6174 655f 6d65 7461 6461   = update_metada
-000124e0: 7461 5f77 6974 685f 6665 6174 7572 6573  ta_with_features
-000124f0: 2864 6174 6173 6574 2e5f 6461 7461 2c20  (dataset._data, 
-00012500: 6461 7461 7365 742e 6665 6174 7572 6573  dataset.features
-00012510: 290a 2020 2020 2020 2020 6c6f 6767 6572  ).        logger
-00012520: 2e69 6e66 6f28 6627 466c 6174 7465 6e65  .info(f'Flattene
-00012530: 6420 6461 7461 7365 7420 6672 6f6d 2064  d dataset from d
-00012540: 6570 7468 207b 6465 7074 687d 2074 6f20  epth {depth} to 
-00012550: 6465 7074 6820 7b31 2069 6620 6465 7074  depth {1 if dept
-00012560: 6820 2b20 3120 3c20 6d61 785f 6465 7074  h + 1 < max_dept
-00012570: 6820 656c 7365 2022 756e 6b6e 6f77 6e22  h else "unknown"
-00012580: 7d2e 2729 0a20 2020 2020 2020 2064 6174  }.').        dat
-00012590: 6173 6574 2e5f 6669 6e67 6572 7072 696e  aset._fingerprin
-000125a0: 7420 3d20 6e65 775f 6669 6e67 6572 7072  t = new_fingerpr
-000125b0: 696e 740a 2020 2020 2020 2020 7265 7475  int.        retu
-000125c0: 726e 2064 6174 6173 6574 0a0a 2020 2020  rn dataset..    
-000125d0: 6465 6620 6361 7374 280a 2020 2020 2020  def cast(.      
-000125e0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-000125f0: 6665 6174 7572 6573 3a20 4665 6174 7572  features: Featur
-00012600: 6573 2c0a 2020 2020 2020 2020 6261 7463  es,.        batc
-00012610: 685f 7369 7a65 3a20 4f70 7469 6f6e 616c  h_size: Optional
-00012620: 5b69 6e74 5d20 3d20 3130 3030 2c0a 2020  [int] = 1000,.  
-00012630: 2020 2020 2020 6b65 6570 5f69 6e5f 6d65        keep_in_me
-00012640: 6d6f 7279 3a20 626f 6f6c 203d 2046 616c  mory: bool = Fal
-00012650: 7365 2c0a 2020 2020 2020 2020 6c6f 6164  se,.        load
-00012660: 5f66 726f 6d5f 6361 6368 655f 6669 6c65  _from_cache_file
-00012670: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-00012680: 2020 2020 2020 2063 6163 6865 5f66 696c         cache_fil
-00012690: 655f 6e61 6d65 3a20 4f70 7469 6f6e 616c  e_name: Optional
-000126a0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
-000126b0: 2020 2020 2020 7772 6974 6572 5f62 6174        writer_bat
-000126c0: 6368 5f73 697a 653a 204f 7074 696f 6e61  ch_size: Optiona
-000126d0: 6c5b 696e 745d 203d 2031 3030 302c 0a20  l[int] = 1000,. 
-000126e0: 2020 2020 2020 206e 756d 5f70 726f 633a         num_proc:
-000126f0: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-00012700: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
-00012710: 2244 6174 6173 6574 223a 0a20 2020 2020  "Dataset":.     
-00012720: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-00012730: 6173 7420 7468 6520 6461 7461 7365 7420  ast the dataset 
-00012740: 746f 2061 206e 6577 2073 6574 206f 6620  to a new set of 
-00012750: 6665 6174 7572 6573 2e0a 0a20 2020 2020  features...     
-00012760: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00012770: 2020 2020 2066 6561 7475 7265 7320 285b       features ([
-00012780: 6046 6561 7475 7265 7360 5d29 3a0a 2020  `Features`]):.  
-00012790: 2020 2020 2020 2020 2020 2020 2020 4e65                Ne
-000127a0: 7720 6665 6174 7572 6573 2074 6f20 6361  w features to ca
-000127b0: 7374 2074 6865 2064 6174 6173 6574 2074  st the dataset t
-000127c0: 6f2e 0a20 2020 2020 2020 2020 2020 2020  o..             
-000127d0: 2020 2054 6865 206e 616d 6520 6f66 2074     The name of t
-000127e0: 6865 2066 6965 6c64 7320 696e 2074 6865  he fields in the
-000127f0: 2066 6561 7475 7265 7320 6d75 7374 206d   features must m
-00012800: 6174 6368 2074 6865 2063 7572 7265 6e74  atch the current
-00012810: 2063 6f6c 756d 6e20 6e61 6d65 732e 0a20   column names.. 
-00012820: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00012830: 6865 2074 7970 6520 6f66 2074 6865 2064  he type of the d
-00012840: 6174 6120 6d75 7374 2061 6c73 6f20 6265  ata must also be
-00012850: 2063 6f6e 7665 7274 6962 6c65 2066 726f   convertible fro
-00012860: 6d20 6f6e 6520 7479 7065 2074 6f20 7468  m one type to th
-00012870: 6520 6f74 6865 722e 0a20 2020 2020 2020  e other..       
-00012880: 2020 2020 2020 2020 2046 6f72 206e 6f6e           For non
-00012890: 2d74 7269 7669 616c 2063 6f6e 7665 7273  -trivial convers
-000128a0: 696f 6e2c 2065 2e67 2e20 6073 7472 6020  ion, e.g. `str` 
-000128b0: 3c2d 3e20 6043 6c61 7373 4c61 6265 6c60  <-> `ClassLabel`
-000128c0: 2079 6f75 2073 686f 756c 6420 7573 6520   you should use 
-000128d0: 5b60 7e64 6174 6173 6574 732e 4461 7461  [`~datasets.Data
-000128e0: 7365 742e 6d61 7060 5d20 746f 2075 7064  set.map`] to upd
-000128f0: 6174 6520 7468 6520 4461 7461 7365 742e  ate the Dataset.
-00012900: 0a20 2020 2020 2020 2020 2020 2062 6174  .            bat
-00012910: 6368 5f73 697a 6520 2860 696e 7460 2c20  ch_size (`int`, 
-00012920: 6465 6661 756c 7473 2074 6f20 6031 3030  defaults to `100
-00012930: 3060 293a 0a20 2020 2020 2020 2020 2020  0`):.           
-00012940: 2020 2020 204e 756d 6265 7220 6f66 2065       Number of e
-00012950: 7861 6d70 6c65 7320 7065 7220 6261 7463  xamples per batc
-00012960: 6820 7072 6f76 6964 6564 2074 6f20 6361  h provided to ca
-00012970: 7374 2e0a 2020 2020 2020 2020 2020 2020  st..            
-00012980: 2020 2020 4966 2060 6261 7463 685f 7369      If `batch_si
-00012990: 7a65 203c 3d20 3060 206f 7220 6062 6174  ze <= 0` or `bat
-000129a0: 6368 5f73 697a 6520 3d3d 204e 6f6e 6560  ch_size == None`
-000129b0: 2074 6865 6e20 7072 6f76 6964 6520 7468   then provide th
-000129c0: 6520 6675 6c6c 2064 6174 6173 6574 2061  e full dataset a
-000129d0: 7320 6120 7369 6e67 6c65 2062 6174 6368  s a single batch
-000129e0: 2074 6f20 6361 7374 2e0a 2020 2020 2020   to cast..      
-000129f0: 2020 2020 2020 6b65 6570 5f69 6e5f 6d65        keep_in_me
-00012a00: 6d6f 7279 2028 6062 6f6f 6c60 2c20 6465  mory (`bool`, de
-00012a10: 6661 756c 7473 2074 6f20 6046 616c 7365  faults to `False
-00012a20: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
-00012a30: 2020 2020 5768 6574 6865 7220 746f 2063      Whether to c
-00012a40: 6f70 7920 7468 6520 6461 7461 2069 6e2d  opy the data in-
-00012a50: 6d65 6d6f 7279 2e0a 2020 2020 2020 2020  memory..        
-00012a60: 2020 2020 6c6f 6164 5f66 726f 6d5f 6361      load_from_ca
-00012a70: 6368 655f 6669 6c65 2028 6062 6f6f 6c60  che_file (`bool`
-00012a80: 2c20 6465 6661 756c 7473 2074 6f20 6054  , defaults to `T
-00012a90: 7275 6560 2069 6620 6361 6368 696e 6720  rue` if caching 
-00012aa0: 6973 2065 6e61 626c 6564 293a 0a20 2020  is enabled):.   
-00012ab0: 2020 2020 2020 2020 2020 2020 2049 6620               If 
-00012ac0: 6120 6361 6368 6520 6669 6c65 2073 746f  a cache file sto
-00012ad0: 7269 6e67 2074 6865 2063 7572 7265 6e74  ring the current
-00012ae0: 2063 6f6d 7075 7461 7469 6f6e 2066 726f   computation fro
-00012af0: 6d20 6066 756e 6374 696f 6e60 0a20 2020  m `function`.   
-00012b00: 2020 2020 2020 2020 2020 2020 2063 616e               can
-00012b10: 2062 6520 6964 656e 7469 6669 6564 2c20   be identified, 
-00012b20: 7573 6520 6974 2069 6e73 7465 6164 206f  use it instead o
-00012b30: 6620 7265 636f 6d70 7574 696e 672e 0a20  f recomputing.. 
-00012b40: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-00012b50: 5f66 696c 655f 6e61 6d65 2028 6073 7472  _file_name (`str
-00012b60: 602c 202a 6f70 7469 6f6e 616c 2a2c 2064  `, *optional*, d
-00012b70: 6566 6175 6c74 7320 746f 2060 4e6f 6e65  efaults to `None
-00012b80: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
-00012b90: 2020 2020 5072 6f76 6964 6520 7468 6520      Provide the 
-00012ba0: 6e61 6d65 206f 6620 6120 7061 7468 2066  name of a path f
-00012bb0: 6f72 2074 6865 2063 6163 6865 2066 696c  or the cache fil
-00012bc0: 652e 2049 7420 6973 2075 7365 6420 746f  e. It is used to
-00012bd0: 2073 746f 7265 2074 6865 0a20 2020 2020   store the.     
-00012be0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00012bf0: 7473 206f 6620 7468 6520 636f 6d70 7574  ts of the comput
-00012c00: 6174 696f 6e20 696e 7374 6561 6420 6f66  ation instead of
-00012c10: 2074 6865 2061 7574 6f6d 6174 6963 616c   the automatical
-00012c20: 6c79 2067 656e 6572 6174 6564 2063 6163  ly generated cac
-00012c30: 6865 2066 696c 6520 6e61 6d65 2e0a 2020  he file name..  
-00012c40: 2020 2020 2020 2020 2020 7772 6974 6572            writer
-00012c50: 5f62 6174 6368 5f73 697a 6520 2860 696e  _batch_size (`in
-00012c60: 7460 2c20 6465 6661 756c 7473 2074 6f20  t`, defaults to 
-00012c70: 6031 3030 3060 293a 0a20 2020 2020 2020  `1000`):.       
-00012c80: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
-00012c90: 6f66 2072 6f77 7320 7065 7220 7772 6974  of rows per writ
-00012ca0: 6520 6f70 6572 6174 696f 6e20 666f 7220  e operation for 
-00012cb0: 7468 6520 6361 6368 6520 6669 6c65 2077  the cache file w
-00012cc0: 7269 7465 722e 0a20 2020 2020 2020 2020  riter..         
-00012cd0: 2020 2020 2020 2054 6869 7320 7661 6c75         This valu
-00012ce0: 6520 6973 2061 2067 6f6f 6420 7472 6164  e is a good trad
-00012cf0: 652d 6f66 6620 6265 7477 6565 6e20 6d65  e-off between me
-00012d00: 6d6f 7279 2075 7361 6765 2064 7572 696e  mory usage durin
-00012d10: 6720 7468 6520 7072 6f63 6573 7369 6e67  g the processing
-00012d20: 2c20 616e 6420 7072 6f63 6573 7369 6e67  , and processing
-00012d30: 2073 7065 6564 2e0a 2020 2020 2020 2020   speed..        
-00012d40: 2020 2020 2020 2020 4869 6768 6572 2076          Higher v
-00012d50: 616c 7565 206d 616b 6573 2074 6865 2070  alue makes the p
-00012d60: 726f 6365 7373 696e 6720 646f 2066 6577  rocessing do few
-00012d70: 6572 206c 6f6f 6b75 7073 2c20 6c6f 7765  er lookups, lowe
-00012d80: 7220 7661 6c75 6520 636f 6e73 756d 6520  r value consume 
-00012d90: 6c65 7373 2074 656d 706f 7261 7279 206d  less temporary m
-00012da0: 656d 6f72 7920 7768 696c 6520 7275 6e6e  emory while runn
-00012db0: 696e 6720 5b60 7e64 6174 6173 6574 732e  ing [`~datasets.
-00012dc0: 4461 7461 7365 742e 6d61 7060 5d2e 0a20  Dataset.map`].. 
-00012dd0: 2020 2020 2020 2020 2020 206e 756d 5f70             num_p
-00012de0: 726f 6320 2860 696e 7460 2c20 2a6f 7074  roc (`int`, *opt
-00012df0: 696f 6e61 6c2a 2c20 6465 6661 756c 7473  ional*, defaults
-00012e00: 2074 6f20 604e 6f6e 6560 293a 0a20 2020   to `None`):.   
-00012e10: 2020 2020 2020 2020 2020 2020 204e 756d               Num
-00012e20: 6265 7220 6f66 2070 726f 6365 7373 6573  ber of processes
-00012e30: 2066 6f72 206d 756c 7469 7072 6f63 6573   for multiproces
-00012e40: 7369 6e67 2e20 4279 2064 6566 6175 6c74  sing. By default
-00012e50: 2069 7420 646f 6573 6e27 740a 2020 2020   it doesn't.    
-00012e60: 2020 2020 2020 2020 2020 2020 7573 6520              use 
-00012e70: 6d75 6c74 6970 726f 6365 7373 696e 672e  multiprocessing.
-00012e80: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00012e90: 733a 0a20 2020 2020 2020 2020 2020 205b  s:.            [
-00012ea0: 6044 6174 6173 6574 605d 3a20 4120 636f  `Dataset`]: A co
-00012eb0: 7079 206f 6620 7468 6520 6461 7461 7365  py of the datase
-00012ec0: 7420 7769 7468 2063 6173 7465 6420 6665  t with casted fe
-00012ed0: 6174 7572 6573 2e0a 0a20 2020 2020 2020  atures...       
-00012ee0: 2045 7861 6d70 6c65 3a0a 0a20 2020 2020   Example:..     
-00012ef0: 2020 2060 6060 7079 0a20 2020 2020 2020     ```py.       
-00012f00: 203e 3e3e 2066 726f 6d20 6461 7461 7365   >>> from datase
-00012f10: 7473 2069 6d70 6f72 7420 6c6f 6164 5f64  ts import load_d
-00012f20: 6174 6173 6574 2c20 436c 6173 734c 6162  ataset, ClassLab
-00012f30: 656c 2c20 5661 6c75 650a 2020 2020 2020  el, Value.      
-00012f40: 2020 3e3e 3e20 6473 203d 206c 6f61 645f    >>> ds = load_
-00012f50: 6461 7461 7365 7428 2272 6f74 7465 6e5f  dataset("rotten_
-00012f60: 746f 6d61 746f 6573 222c 2073 706c 6974  tomatoes", split
-00012f70: 3d22 7661 6c69 6461 7469 6f6e 2229 0a20  ="validation"). 
-00012f80: 2020 2020 2020 203e 3e3e 2064 732e 6665         >>> ds.fe
-00012f90: 6174 7572 6573 0a20 2020 2020 2020 207b  atures.        {
-00012fa0: 276c 6162 656c 273a 2043 6c61 7373 4c61  'label': ClassLa
-00012fb0: 6265 6c28 6e75 6d5f 636c 6173 7365 733d  bel(num_classes=
-00012fc0: 322c 206e 616d 6573 3d5b 276e 6567 272c  2, names=['neg',
-00012fd0: 2027 706f 7327 5d2c 2069 643d 4e6f 6e65   'pos'], id=None
-00012fe0: 292c 0a20 2020 2020 2020 2020 2774 6578  ),.         'tex
-00012ff0: 7427 3a20 5661 6c75 6528 6474 7970 653d  t': Value(dtype=
-00013000: 2773 7472 696e 6727 2c20 6964 3d4e 6f6e  'string', id=Non
-00013010: 6529 7d0a 2020 2020 2020 2020 3e3e 3e20  e)}.        >>> 
-00013020: 6e65 775f 6665 6174 7572 6573 203d 2064  new_features = d
-00013030: 732e 6665 6174 7572 6573 2e63 6f70 7928  s.features.copy(
-00013040: 290a 2020 2020 2020 2020 3e3e 3e20 6e65  ).        >>> ne
-00013050: 775f 6665 6174 7572 6573 5b27 6c61 6265  w_features['labe
-00013060: 6c27 5d20 3d20 436c 6173 734c 6162 656c  l'] = ClassLabel
-00013070: 286e 616d 6573 3d5b 2762 6164 272c 2027  (names=['bad', '
-00013080: 676f 6f64 275d 290a 2020 2020 2020 2020  good']).        
-00013090: 3e3e 3e20 6e65 775f 6665 6174 7572 6573  >>> new_features
-000130a0: 5b27 7465 7874 275d 203d 2056 616c 7565  ['text'] = Value
-000130b0: 2827 6c61 7267 655f 7374 7269 6e67 2729  ('large_string')
-000130c0: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-000130d0: 3d20 6473 2e63 6173 7428 6e65 775f 6665  = ds.cast(new_fe
-000130e0: 6174 7572 6573 290a 2020 2020 2020 2020  atures).        
-000130f0: 3e3e 3e20 6473 2e66 6561 7475 7265 730a  >>> ds.features.
-00013100: 2020 2020 2020 2020 7b27 6c61 6265 6c27          {'label'
-00013110: 3a20 436c 6173 734c 6162 656c 286e 756d  : ClassLabel(num
-00013120: 5f63 6c61 7373 6573 3d32 2c20 6e61 6d65  _classes=2, name
-00013130: 733d 5b27 6261 6427 2c20 2767 6f6f 6427  s=['bad', 'good'
-00013140: 5d2c 2069 643d 4e6f 6e65 292c 0a20 2020  ], id=None),.   
-00013150: 2020 2020 2020 2774 6578 7427 3a20 5661        'text': Va
-00013160: 6c75 6528 6474 7970 653d 276c 6172 6765  lue(dtype='large
-00013170: 5f73 7472 696e 6727 2c20 6964 3d4e 6f6e  _string', id=Non
-00013180: 6529 7d0a 2020 2020 2020 2020 6060 600a  e)}.        ```.
-00013190: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000131a0: 2020 2020 6966 2073 6f72 7465 6428 6665      if sorted(fe
-000131b0: 6174 7572 6573 2920 213d 2073 6f72 7465  atures) != sorte
-000131c0: 6428 7365 6c66 2e5f 6461 7461 2e63 6f6c  d(self._data.col
-000131d0: 756d 6e5f 6e61 6d65 7329 3a0a 2020 2020  umn_names):.    
-000131e0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-000131f0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00013200: 2020 2020 2020 2020 2020 6622 5468 6520            f"The 
-00013210: 636f 6c75 6d6e 7320 696e 2066 6561 7475  columns in featu
-00013220: 7265 7320 287b 6c69 7374 2866 6561 7475  res ({list(featu
-00013230: 7265 7329 7d29 206d 7573 7420 6265 2069  res)}) must be i
-00013240: 6465 6e74 6963 616c 2022 0a20 2020 2020  dentical ".     
-00013250: 2020 2020 2020 2020 2020 2066 2261 7320             f"as 
-00013260: 7468 6520 636f 6c75 6d6e 7320 696e 2074  the columns in t
-00013270: 6865 2064 6174 6173 6574 3a20 7b73 656c  he dataset: {sel
-00013280: 662e 5f64 6174 612e 636f 6c75 6d6e 5f6e  f._data.column_n
-00013290: 616d 6573 7d22 0a20 2020 2020 2020 2020  ames}".         
-000132a0: 2020 2029 0a0a 2020 2020 2020 2020 7363     )..        sc
-000132b0: 6865 6d61 203d 2066 6561 7475 7265 732e  hema = features.
-000132c0: 6172 726f 775f 7363 6865 6d61 0a20 2020  arrow_schema.   
-000132d0: 2020 2020 2066 6f72 6d61 7420 3d20 7365       format = se
-000132e0: 6c66 2e66 6f72 6d61 740a 2020 2020 2020  lf.format.      
-000132f0: 2020 6461 7461 7365 7420 3d20 7365 6c66    dataset = self
-00013300: 2e77 6974 685f 666f 726d 6174 2822 6172  .with_format("ar
-00013310: 726f 7722 290a 2020 2020 2020 2020 2320  row").        # 
-00013320: 6361 7074 7572 6520 7468 6520 5079 4172  capture the PyAr
-00013330: 726f 7720 7665 7273 696f 6e20 6865 7265  row version here
-00013340: 2074 6f20 6d61 6b65 2074 6865 206c 616d   to make the lam
-00013350: 6264 6120 7365 7269 616c 697a 6162 6c65  bda serializable
-00013360: 206f 6e20 5769 6e64 6f77 730a 2020 2020   on Windows.    
-00013370: 2020 2020 6461 7461 7365 7420 3d20 6461      dataset = da
-00013380: 7461 7365 742e 6d61 7028 0a20 2020 2020  taset.map(.     
-00013390: 2020 2020 2020 2070 6172 7469 616c 2874         partial(t
-000133a0: 6162 6c65 5f63 6173 742c 2073 6368 656d  able_cast, schem
-000133b0: 613d 7363 6865 6d61 292c 0a20 2020 2020  a=schema),.     
-000133c0: 2020 2020 2020 2062 6174 6368 6564 3d54         batched=T
-000133d0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-000133e0: 2062 6174 6368 5f73 697a 653d 6261 7463   batch_size=batc
-000133f0: 685f 7369 7a65 2c0a 2020 2020 2020 2020  h_size,.        
-00013400: 2020 2020 6b65 6570 5f69 6e5f 6d65 6d6f      keep_in_memo
-00013410: 7279 3d6b 6565 705f 696e 5f6d 656d 6f72  ry=keep_in_memor
-00013420: 792c 0a20 2020 2020 2020 2020 2020 206c  y,.            l
-00013430: 6f61 645f 6672 6f6d 5f63 6163 6865 5f66  oad_from_cache_f
-00013440: 696c 653d 6c6f 6164 5f66 726f 6d5f 6361  ile=load_from_ca
-00013450: 6368 655f 6669 6c65 2c0a 2020 2020 2020  che_file,.      
-00013460: 2020 2020 2020 6361 6368 655f 6669 6c65        cache_file
-00013470: 5f6e 616d 653d 6361 6368 655f 6669 6c65  _name=cache_file
-00013480: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00013490: 2020 2077 7269 7465 725f 6261 7463 685f     writer_batch_
-000134a0: 7369 7a65 3d77 7269 7465 725f 6261 7463  size=writer_batc
-000134b0: 685f 7369 7a65 2c0a 2020 2020 2020 2020  h_size,.        
-000134c0: 2020 2020 6e75 6d5f 7072 6f63 3d6e 756d      num_proc=num
-000134d0: 5f70 726f 632c 0a20 2020 2020 2020 2020  _proc,.         
-000134e0: 2020 2066 6561 7475 7265 733d 6665 6174     features=feat
-000134f0: 7572 6573 2c0a 2020 2020 2020 2020 2020  ures,.          
-00013500: 2020 6465 7363 3d22 4361 7374 696e 6720    desc="Casting 
-00013510: 7468 6520 6461 7461 7365 7422 2c0a 2020  the dataset",.  
-00013520: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00013530: 6461 7461 7365 7420 3d20 6461 7461 7365  dataset = datase
-00013540: 742e 7769 7468 5f66 6f72 6d61 7428 2a2a  t.with_format(**
-00013550: 666f 726d 6174 290a 2020 2020 2020 2020  format).        
-00013560: 7265 7475 726e 2064 6174 6173 6574 0a0a  return dataset..
-00013570: 2020 2020 4066 696e 6765 7270 7269 6e74      @fingerprint
-00013580: 5f74 7261 6e73 666f 726d 2869 6e70 6c61  _transform(inpla
-00013590: 6365 3d46 616c 7365 290a 2020 2020 6465  ce=False).    de
-000135a0: 6620 6361 7374 5f63 6f6c 756d 6e28 7365  f cast_column(se
-000135b0: 6c66 2c20 636f 6c75 6d6e 3a20 7374 722c  lf, column: str,
-000135c0: 2066 6561 7475 7265 3a20 4665 6174 7572   feature: Featur
-000135d0: 6554 7970 652c 206e 6577 5f66 696e 6765  eType, new_finge
-000135e0: 7270 7269 6e74 3a20 4f70 7469 6f6e 616c  rprint: Optional
-000135f0: 5b73 7472 5d20 3d20 4e6f 6e65 2920 2d3e  [str] = None) ->
-00013600: 2022 4461 7461 7365 7422 3a0a 2020 2020   "Dataset":.    
-00013610: 2020 2020 2222 2243 6173 7420 636f 6c75      """Cast colu
-00013620: 6d6e 2074 6f20 6665 6174 7572 6520 666f  mn to feature fo
-00013630: 7220 6465 636f 6469 6e67 2e0a 0a20 2020  r decoding...   
-00013640: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00013650: 2020 2020 2020 2063 6f6c 756d 6e20 2860         column (`
-00013660: 7374 7260 293a 0a20 2020 2020 2020 2020  str`):.         
-00013670: 2020 2020 2020 2043 6f6c 756d 6e20 6e61         Column na
-00013680: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
-00013690: 6665 6174 7572 6520 2860 4665 6174 7572  feature (`Featur
-000136a0: 6554 7970 6560 293a 0a20 2020 2020 2020  eType`):.       
-000136b0: 2020 2020 2020 2020 2054 6172 6765 7420           Target 
-000136c0: 6665 6174 7572 652e 0a20 2020 2020 2020  feature..       
-000136d0: 2020 2020 206e 6577 5f66 696e 6765 7270       new_fingerp
-000136e0: 7269 6e74 2028 6073 7472 602c 202a 6f70  rint (`str`, *op
-000136f0: 7469 6f6e 616c 2a29 3a0a 2020 2020 2020  tional*):.      
-00013700: 2020 2020 2020 2020 2020 5468 6520 6e65            The ne
-00013710: 7720 6669 6e67 6572 7072 696e 7420 6f66  w fingerprint of
-00013720: 2074 6865 2064 6174 6173 6574 2061 6674   the dataset aft
-00013730: 6572 2074 7261 6e73 666f 726d 2e0a 2020  er transform..  
-00013740: 2020 2020 2020 2020 2020 2020 2020 4966                If
-00013750: 2060 4e6f 6e65 602c 2074 6865 206e 6577   `None`, the new
-00013760: 2066 696e 6765 7270 7269 6e74 2069 7320   fingerprint is 
-00013770: 636f 6d70 7574 6564 2075 7369 6e67 2061  computed using a
-00013780: 2068 6173 6820 6f66 2074 6865 2070 7265   hash of the pre
-00013790: 7669 6f75 7320 6669 6e67 6572 7072 696e  vious fingerprin
-000137a0: 742c 2061 6e64 2074 6865 2074 7261 6e73  t, and the trans
-000137b0: 666f 726d 2061 7267 756d 656e 7473 2e0a  form arguments..
-000137c0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-000137d0: 3a0a 2020 2020 2020 2020 2020 2020 5b60  :.            [`
-000137e0: 4461 7461 7365 7460 5d0a 0a20 2020 2020  Dataset`]..     
-000137f0: 2020 2045 7861 6d70 6c65 3a0a 0a20 2020     Example:..   
-00013800: 2020 2020 2060 6060 7079 0a20 2020 2020       ```py.     
-00013810: 2020 203e 3e3e 2066 726f 6d20 6461 7461     >>> from data
-00013820: 7365 7473 2069 6d70 6f72 7420 6c6f 6164  sets import load
-00013830: 5f64 6174 6173 6574 0a20 2020 2020 2020  _dataset.       
-00013840: 203e 3e3e 2064 7320 3d20 6c6f 6164 5f64   >>> ds = load_d
-00013850: 6174 6173 6574 2822 726f 7474 656e 5f74  ataset("rotten_t
-00013860: 6f6d 6174 6f65 7322 2c20 7370 6c69 743d  omatoes", split=
-00013870: 2276 616c 6964 6174 696f 6e22 290a 2020  "validation").  
-00013880: 2020 2020 2020 3e3e 3e20 6473 2e66 6561        >>> ds.fea
-00013890: 7475 7265 730a 2020 2020 2020 2020 7b27  tures.        {'
-000138a0: 6c61 6265 6c27 3a20 436c 6173 734c 6162  label': ClassLab
-000138b0: 656c 286e 756d 5f63 6c61 7373 6573 3d32  el(num_classes=2
-000138c0: 2c20 6e61 6d65 733d 5b27 6e65 6727 2c20  , names=['neg', 
-000138d0: 2770 6f73 275d 2c20 6964 3d4e 6f6e 6529  'pos'], id=None)
-000138e0: 2c0a 2020 2020 2020 2020 2027 7465 7874  ,.         'text
-000138f0: 273a 2056 616c 7565 2864 7479 7065 3d27  ': Value(dtype='
-00013900: 7374 7269 6e67 272c 2069 643d 4e6f 6e65  string', id=None
-00013910: 297d 0a20 2020 2020 2020 203e 3e3e 2064  )}.        >>> d
-00013920: 7320 3d20 6473 2e63 6173 745f 636f 6c75  s = ds.cast_colu
-00013930: 6d6e 2827 6c61 6265 6c27 2c20 436c 6173  mn('label', Clas
-00013940: 734c 6162 656c 286e 616d 6573 3d5b 2762  sLabel(names=['b
-00013950: 6164 272c 2027 676f 6f64 275d 2929 0a20  ad', 'good'])). 
-00013960: 2020 2020 2020 203e 3e3e 2064 732e 6665         >>> ds.fe
-00013970: 6174 7572 6573 0a20 2020 2020 2020 207b  atures.        {
-00013980: 276c 6162 656c 273a 2043 6c61 7373 4c61  'label': ClassLa
-00013990: 6265 6c28 6e75 6d5f 636c 6173 7365 733d  bel(num_classes=
-000139a0: 322c 206e 616d 6573 3d5b 2762 6164 272c  2, names=['bad',
-000139b0: 2027 676f 6f64 275d 2c20 6964 3d4e 6f6e   'good'], id=Non
-000139c0: 6529 2c0a 2020 2020 2020 2020 2027 7465  e),.         'te
-000139d0: 7874 273a 2056 616c 7565 2864 7479 7065  xt': Value(dtype
-000139e0: 3d27 7374 7269 6e67 272c 2069 643d 4e6f  ='string', id=No
-000139f0: 6e65 297d 0a20 2020 2020 2020 2060 6060  ne)}.        ```
-00013a00: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00013a10: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
-00013a20: 6665 6174 7572 652c 2022 6465 636f 6465  feature, "decode
-00013a30: 5f65 7861 6d70 6c65 2229 3a0a 2020 2020  _example"):.    
-00013a40: 2020 2020 2020 2020 6461 7461 7365 7420          dataset 
-00013a50: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-00013a60: 7365 6c66 290a 2020 2020 2020 2020 2020  self).          
-00013a70: 2020 6461 7461 7365 742e 6665 6174 7572    dataset.featur
-00013a80: 6573 5b63 6f6c 756d 6e5d 203d 2066 6561  es[column] = fea
-00013a90: 7475 7265 0a20 2020 2020 2020 2020 2020  ture.           
-00013aa0: 2064 6174 6173 6574 2e5f 6669 6e67 6572   dataset._finger
-00013ab0: 7072 696e 7420 3d20 6e65 775f 6669 6e67  print = new_fing
-00013ac0: 6572 7072 696e 740a 2020 2020 2020 2020  erprint.        
-00013ad0: 2020 2020 6461 7461 7365 742e 5f64 6174      dataset._dat
-00013ae0: 6120 3d20 6461 7461 7365 742e 5f64 6174  a = dataset._dat
-00013af0: 612e 6361 7374 2864 6174 6173 6574 2e66  a.cast(dataset.f
-00013b00: 6561 7475 7265 732e 6172 726f 775f 7363  eatures.arrow_sc
-00013b10: 6865 6d61 290a 2020 2020 2020 2020 2020  hema).          
-00013b20: 2020 6461 7461 7365 742e 5f64 6174 6120    dataset._data 
-00013b30: 3d20 7570 6461 7465 5f6d 6574 6164 6174  = update_metadat
-00013b40: 615f 7769 7468 5f66 6561 7475 7265 7328  a_with_features(
-00013b50: 6461 7461 7365 742e 5f64 6174 612c 2064  dataset._data, d
-00013b60: 6174 6173 6574 2e66 6561 7475 7265 7329  ataset.features)
-00013b70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00013b80: 7572 6e20 6461 7461 7365 740a 2020 2020  urn dataset.    
-00013b90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00013ba0: 2020 2020 2020 6665 6174 7572 6573 203d        features =
-00013bb0: 2073 656c 662e 6665 6174 7572 6573 2e63   self.features.c
-00013bc0: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-00013bd0: 2020 6665 6174 7572 6573 5b63 6f6c 756d    features[colum
-00013be0: 6e5d 203d 2066 6561 7475 7265 0a20 2020  n] = feature.   
-00013bf0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00013c00: 7365 6c66 2e63 6173 7428 6665 6174 7572  self.cast(featur
-00013c10: 6573 290a 0a20 2020 2040 7472 616e 736d  es)..    @transm
-00013c20: 6974 5f74 6173 6b73 0a20 2020 2040 7472  it_tasks.    @tr
-00013c30: 616e 736d 6974 5f66 6f72 6d61 740a 2020  ansmit_format.  
-00013c40: 2020 4066 696e 6765 7270 7269 6e74 5f74    @fingerprint_t
-00013c50: 7261 6e73 666f 726d 2869 6e70 6c61 6365  ransform(inplace
-00013c60: 3d46 616c 7365 290a 2020 2020 6465 6620  =False).    def 
-00013c70: 7265 6d6f 7665 5f63 6f6c 756d 6e73 2873  remove_columns(s
-00013c80: 656c 662c 2063 6f6c 756d 6e5f 6e61 6d65  elf, column_name
-00013c90: 733a 2055 6e69 6f6e 5b73 7472 2c20 4c69  s: Union[str, Li
-00013ca0: 7374 5b73 7472 5d5d 2c20 6e65 775f 6669  st[str]], new_fi
-00013cb0: 6e67 6572 7072 696e 743a 204f 7074 696f  ngerprint: Optio
-00013cc0: 6e61 6c5b 7374 725d 203d 204e 6f6e 6529  nal[str] = None)
-00013cd0: 202d 3e20 2244 6174 6173 6574 223a 0a20   -> "Dataset":. 
-00013ce0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00013cf0: 2020 2052 656d 6f76 6520 6f6e 6520 6f72     Remove one or
-00013d00: 2073 6576 6572 616c 2063 6f6c 756d 6e28   several column(
-00013d10: 7329 2069 6e20 7468 6520 6461 7461 7365  s) in the datase
-00013d20: 7420 616e 6420 7468 6520 6665 6174 7572  t and the featur
-00013d30: 6573 2061 7373 6f63 6961 7465 6420 746f  es associated to
-00013d40: 2074 6865 6d2e 0a0a 2020 2020 2020 2020   them...        
-00013d50: 596f 7520 6361 6e20 616c 736f 2072 656d  You can also rem
-00013d60: 6f76 6520 6120 636f 6c75 6d6e 2075 7369  ove a column usi
-00013d70: 6e67 205b 607e 6461 7461 7365 7473 2e44  ng [`~datasets.D
-00013d80: 6174 6173 6574 2e6d 6170 605d 2077 6974  ataset.map`] wit
-00013d90: 6820 6072 656d 6f76 655f 636f 6c75 6d6e  h `remove_column
-00013da0: 7360 2062 7574 2074 6865 2070 7265 7365  s` but the prese
-00013db0: 6e74 206d 6574 686f 640a 2020 2020 2020  nt method.      
-00013dc0: 2020 6973 2069 6e2d 706c 6163 6520 2864    is in-place (d
-00013dd0: 6f65 736e 2774 2063 6f70 7920 7468 6520  oesn't copy the 
-00013de0: 6461 7461 2074 6f20 6120 6e65 7720 6461  data to a new da
-00013df0: 7461 7365 7429 2061 6e64 2069 7320 7468  taset) and is th
-00013e00: 7573 2066 6173 7465 722e 0a0a 2020 2020  us faster...    
-00013e10: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00013e20: 2020 2020 2020 636f 6c75 6d6e 5f6e 616d        column_nam
-00013e30: 6573 2028 6055 6e69 6f6e 5b73 7472 2c20  es (`Union[str, 
-00013e40: 4c69 7374 5b73 7472 5d5d 6029 3a0a 2020  List[str]]`):.  
-00013e50: 2020 2020 2020 2020 2020 2020 2020 4e61                Na
-00013e60: 6d65 206f 6620 7468 6520 636f 6c75 6d6e  me of the column
-00013e70: 2873 2920 746f 2072 656d 6f76 652e 0a20  (s) to remove.. 
-00013e80: 2020 2020 2020 2020 2020 206e 6577 5f66             new_f
-00013e90: 696e 6765 7270 7269 6e74 2028 6073 7472  ingerprint (`str
-00013ea0: 602c 202a 6f70 7469 6f6e 616c 2a29 3a0a  `, *optional*):.
-00013eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ec0: 5468 6520 6e65 7720 6669 6e67 6572 7072  The new fingerpr
-00013ed0: 696e 7420 6f66 2074 6865 2064 6174 6173  int of the datas
-00013ee0: 6574 2061 6674 6572 2074 7261 6e73 666f  et after transfo
-00013ef0: 726d 2e0a 2020 2020 2020 2020 2020 2020  rm..            
-00013f00: 2020 2020 4966 2060 4e6f 6e65 602c 2074      If `None`, t
-00013f10: 6865 206e 6577 2066 696e 6765 7270 7269  he new fingerpri
-00013f20: 6e74 2069 7320 636f 6d70 7574 6564 2075  nt is computed u
-00013f30: 7369 6e67 2061 2068 6173 6820 6f66 2074  sing a hash of t
-00013f40: 6865 2070 7265 7669 6f75 7320 6669 6e67  he previous fing
-00013f50: 6572 7072 696e 742c 2061 6e64 2074 6865  erprint, and the
-00013f60: 2074 7261 6e73 666f 726d 2061 7267 756d   transform argum
-00013f70: 656e 7473 2e0a 0a20 2020 2020 2020 2052  ents...        R
-00013f80: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-00013f90: 2020 2020 5b60 4461 7461 7365 7460 5d3a      [`Dataset`]:
-00013fa0: 2041 2063 6f70 7920 6f66 2074 6865 2064   A copy of the d
-00013fb0: 6174 6173 6574 206f 626a 6563 7420 7769  ataset object wi
-00013fc0: 7468 6f75 7420 7468 6520 636f 6c75 6d6e  thout the column
-00013fd0: 7320 746f 2072 656d 6f76 652e 0a0a 2020  s to remove...  
-00013fe0: 2020 2020 2020 4578 616d 706c 653a 0a0a        Example:..
-00013ff0: 2020 2020 2020 2020 6060 6070 790a 2020          ```py.  
-00014000: 2020 2020 2020 3e3e 3e20 6672 6f6d 2064        >>> from d
-00014010: 6174 6173 6574 7320 696d 706f 7274 206c  atasets import l
-00014020: 6f61 645f 6461 7461 7365 740a 2020 2020  oad_dataset.    
-00014030: 2020 2020 3e3e 3e20 6473 203d 206c 6f61      >>> ds = loa
-00014040: 645f 6461 7461 7365 7428 2272 6f74 7465  d_dataset("rotte
-00014050: 6e5f 746f 6d61 746f 6573 222c 2073 706c  n_tomatoes", spl
-00014060: 6974 3d22 7661 6c69 6461 7469 6f6e 2229  it="validation")
-00014070: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
-00014080: 7265 6d6f 7665 5f63 6f6c 756d 6e73 2827  remove_columns('
-00014090: 6c61 6265 6c27 290a 2020 2020 2020 2020  label').        
-000140a0: 4461 7461 7365 7428 7b0a 2020 2020 2020  Dataset({.      
-000140b0: 2020 2020 2020 6665 6174 7572 6573 3a20        features: 
-000140c0: 5b27 7465 7874 275d 2c0a 2020 2020 2020  ['text'],.      
-000140d0: 2020 2020 2020 6e75 6d5f 726f 7773 3a20        num_rows: 
-000140e0: 3130 3636 0a20 2020 2020 2020 207d 290a  1066.        }).
-000140f0: 2020 2020 2020 2020 6060 600a 2020 2020          ```.    
-00014100: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00014110: 6461 7461 7365 7420 3d20 636f 7079 2e64  dataset = copy.d
-00014120: 6565 7063 6f70 7928 7365 6c66 290a 2020  eepcopy(self).  
-00014130: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00014140: 6e63 6528 636f 6c75 6d6e 5f6e 616d 6573  nce(column_names
-00014150: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-00014160: 2020 2020 636f 6c75 6d6e 5f6e 616d 6573      column_names
-00014170: 203d 205b 636f 6c75 6d6e 5f6e 616d 6573   = [column_names
-00014180: 5d0a 0a20 2020 2020 2020 2066 6f72 2063  ]..        for c
-00014190: 6f6c 756d 6e5f 6e61 6d65 2069 6e20 636f  olumn_name in co
-000141a0: 6c75 6d6e 5f6e 616d 6573 3a0a 2020 2020  lumn_names:.    
-000141b0: 2020 2020 2020 2020 6966 2063 6f6c 756d          if colum
-000141c0: 6e5f 6e61 6d65 206e 6f74 2069 6e20 6461  n_name not in da
-000141d0: 7461 7365 742e 5f64 6174 612e 636f 6c75  taset._data.colu
-000141e0: 6d6e 5f6e 616d 6573 3a0a 2020 2020 2020  mn_names:.      
-000141f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00014200: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00014210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014220: 6622 436f 6c75 6d6e 206e 616d 6520 7b63  f"Column name {c
-00014230: 6f6c 756d 6e5f 6e61 6d65 7d20 6e6f 7420  olumn_name} not 
-00014240: 696e 2074 6865 2064 6174 6173 6574 2e20  in the dataset. 
-00014250: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00014260: 2020 2020 2020 6622 4375 7272 656e 7420        f"Current 
-00014270: 636f 6c75 6d6e 7320 696e 2074 6865 2064  columns in the d
-00014280: 6174 6173 6574 3a20 7b64 6174 6173 6574  ataset: {dataset
-00014290: 2e5f 6461 7461 2e63 6f6c 756d 6e5f 6e61  ._data.column_na
-000142a0: 6d65 737d 220a 2020 2020 2020 2020 2020  mes}".          
-000142b0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000142c0: 2066 6f72 2063 6f6c 756d 6e5f 6e61 6d65   for column_name
-000142d0: 2069 6e20 636f 6c75 6d6e 5f6e 616d 6573   in column_names
-000142e0: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-000142f0: 6c20 6461 7461 7365 742e 5f69 6e66 6f2e  l dataset._info.
-00014300: 6665 6174 7572 6573 5b63 6f6c 756d 6e5f  features[column_
-00014310: 6e61 6d65 5d0a 0a20 2020 2020 2020 2064  name]..        d
-00014320: 6174 6173 6574 2e5f 6461 7461 203d 2064  ataset._data = d
-00014330: 6174 6173 6574 2e5f 6461 7461 2e64 726f  ataset._data.dro
-00014340: 7028 636f 6c75 6d6e 5f6e 616d 6573 290a  p(column_names).
-00014350: 2020 2020 2020 2020 6461 7461 7365 742e          dataset.
-00014360: 5f64 6174 6120 3d20 7570 6461 7465 5f6d  _data = update_m
-00014370: 6574 6164 6174 615f 7769 7468 5f66 6561  etadata_with_fea
-00014380: 7475 7265 7328 6461 7461 7365 742e 5f64  tures(dataset._d
-00014390: 6174 612c 2064 6174 6173 6574 2e66 6561  ata, dataset.fea
-000143a0: 7475 7265 7329 0a20 2020 2020 2020 2064  tures).        d
-000143b0: 6174 6173 6574 2e5f 6669 6e67 6572 7072  ataset._fingerpr
-000143c0: 696e 7420 3d20 6e65 775f 6669 6e67 6572  int = new_finger
-000143d0: 7072 696e 740a 2020 2020 2020 2020 7265  print.        re
-000143e0: 7475 726e 2064 6174 6173 6574 0a0a 2020  turn dataset..  
-000143f0: 2020 4074 7261 6e73 6d69 745f 7461 736b    @transmit_task
-00014400: 730a 2020 2020 4066 696e 6765 7270 7269  s.    @fingerpri
-00014410: 6e74 5f74 7261 6e73 666f 726d 2869 6e70  nt_transform(inp
-00014420: 6c61 6365 3d46 616c 7365 290a 2020 2020  lace=False).    
-00014430: 6465 6620 7265 6e61 6d65 5f63 6f6c 756d  def rename_colum
-00014440: 6e28 0a20 2020 2020 2020 2073 656c 662c  n(.        self,
-00014450: 206f 7269 6769 6e61 6c5f 636f 6c75 6d6e   original_column
-00014460: 5f6e 616d 653a 2073 7472 2c20 6e65 775f  _name: str, new_
-00014470: 636f 6c75 6d6e 5f6e 616d 653a 2073 7472  column_name: str
-00014480: 2c20 6e65 775f 6669 6e67 6572 7072 696e  , new_fingerprin
-00014490: 743a 204f 7074 696f 6e61 6c5b 7374 725d  t: Optional[str]
-000144a0: 203d 204e 6f6e 650a 2020 2020 2920 2d3e   = None.    ) ->
-000144b0: 2022 4461 7461 7365 7422 3a0a 2020 2020   "Dataset":.    
-000144c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000144d0: 5265 6e61 6d65 2061 2063 6f6c 756d 6e20  Rename a column 
-000144e0: 696e 2074 6865 2064 6174 6173 6574 2c20  in the dataset, 
-000144f0: 616e 6420 6d6f 7665 2074 6865 2066 6561  and move the fea
-00014500: 7475 7265 7320 6173 736f 6369 6174 6564  tures associated
-00014510: 2074 6f20 7468 6520 6f72 6967 696e 616c   to the original
-00014520: 2063 6f6c 756d 6e20 756e 6465 7220 7468   column under th
-00014530: 6520 6e65 7720 636f 6c75 6d6e 0a20 2020  e new column.   
-00014540: 2020 2020 206e 616d 652e 0a0a 2020 2020       name...    
-00014550: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00014560: 2020 2020 2020 6f72 6967 696e 616c 5f63        original_c
-00014570: 6f6c 756d 6e5f 6e61 6d65 2028 6073 7472  olumn_name (`str
-00014580: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
-00014590: 2020 2020 4e61 6d65 206f 6620 7468 6520      Name of the 
-000145a0: 636f 6c75 6d6e 2074 6f20 7265 6e61 6d65  column to rename
-000145b0: 2e0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-000145c0: 775f 636f 6c75 6d6e 5f6e 616d 6520 2860  w_column_name (`
-000145d0: 7374 7260 293a 0a20 2020 2020 2020 2020  str`):.         
-000145e0: 2020 2020 2020 204e 6577 206e 616d 6520         New name 
-000145f0: 666f 7220 7468 6520 636f 6c75 6d6e 2e0a  for the column..
-00014600: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00014610: 6669 6e67 6572 7072 696e 7420 2860 7374  fingerprint (`st
-00014620: 7260 2c20 2a6f 7074 696f 6e61 6c2a 293a  r`, *optional*):
-00014630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014640: 2054 6865 206e 6577 2066 696e 6765 7270   The new fingerp
-00014650: 7269 6e74 206f 6620 7468 6520 6461 7461  rint of the data
-00014660: 7365 7420 6166 7465 7220 7472 616e 7366  set after transf
-00014670: 6f72 6d2e 0a20 2020 2020 2020 2020 2020  orm..           
-00014680: 2020 2020 2049 6620 604e 6f6e 6560 2c20       If `None`, 
-00014690: 7468 6520 6e65 7720 6669 6e67 6572 7072  the new fingerpr
-000146a0: 696e 7420 6973 2063 6f6d 7075 7465 6420  int is computed 
-000146b0: 7573 696e 6720 6120 6861 7368 206f 6620  using a hash of 
-000146c0: 7468 6520 7072 6576 696f 7573 2066 696e  the previous fin
-000146d0: 6765 7270 7269 6e74 2c20 616e 6420 7468  gerprint, and th
-000146e0: 6520 7472 616e 7366 6f72 6d20 6172 6775  e transform argu
-000146f0: 6d65 6e74 732e 0a0a 2020 2020 2020 2020  ments...        
-00014700: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
-00014710: 2020 2020 205b 6044 6174 6173 6574 605d       [`Dataset`]
-00014720: 3a20 4120 636f 7079 206f 6620 7468 6520  : A copy of the 
-00014730: 6461 7461 7365 7420 7769 7468 2061 2072  dataset with a r
-00014740: 656e 616d 6564 2063 6f6c 756d 6e2e 0a0a  enamed column...
-00014750: 2020 2020 2020 2020 4578 616d 706c 653a          Example:
-00014760: 0a0a 2020 2020 2020 2020 6060 6070 790a  ..        ```py.
-00014770: 2020 2020 2020 2020 3e3e 3e20 6672 6f6d          >>> from
-00014780: 2064 6174 6173 6574 7320 696d 706f 7274   datasets import
-00014790: 206c 6f61 645f 6461 7461 7365 740a 2020   load_dataset.  
-000147a0: 2020 2020 2020 3e3e 3e20 6473 203d 206c        >>> ds = l
-000147b0: 6f61 645f 6461 7461 7365 7428 2272 6f74  oad_dataset("rot
-000147c0: 7465 6e5f 746f 6d61 746f 6573 222c 2073  ten_tomatoes", s
-000147d0: 706c 6974 3d22 7661 6c69 6461 7469 6f6e  plit="validation
-000147e0: 2229 0a20 2020 2020 2020 203e 3e3e 2064  ").        >>> d
-000147f0: 732e 7265 6e61 6d65 5f63 6f6c 756d 6e28  s.rename_column(
-00014800: 276c 6162 656c 272c 2027 6c61 6265 6c5f  'label', 'label_
-00014810: 6e65 7727 290a 2020 2020 2020 2020 4461  new').        Da
-00014820: 7461 7365 7428 7b0a 2020 2020 2020 2020  taset({.        
-00014830: 2020 2020 6665 6174 7572 6573 3a20 5b27      features: ['
-00014840: 7465 7874 272c 2027 6c61 6265 6c5f 6e65  text', 'label_ne
-00014850: 7727 5d2c 0a20 2020 2020 2020 2020 2020  w'],.           
-00014860: 206e 756d 5f72 6f77 733a 2031 3036 360a   num_rows: 1066.
-00014870: 2020 2020 2020 2020 7d29 0a20 2020 2020          }).     
-00014880: 2020 2060 6060 0a20 2020 2020 2020 2022     ```.        "
-00014890: 2222 0a20 2020 2020 2020 2064 6174 6173  "".        datas
-000148a0: 6574 203d 2063 6f70 792e 6465 6570 636f  et = copy.deepco
-000148b0: 7079 2873 656c 6629 0a20 2020 2020 2020  py(self).       
-000148c0: 2069 6620 6f72 6967 696e 616c 5f63 6f6c   if original_col
-000148d0: 756d 6e5f 6e61 6d65 206e 6f74 2069 6e20  umn_name not in 
-000148e0: 6461 7461 7365 742e 5f64 6174 612e 636f  dataset._data.co
-000148f0: 6c75 6d6e 5f6e 616d 6573 3a0a 2020 2020  lumn_names:.    
-00014900: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00014910: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00014920: 2020 2020 2020 2020 2020 6622 4f72 6967            f"Orig
-00014930: 696e 616c 2063 6f6c 756d 6e20 6e61 6d65  inal column name
-00014940: 207b 6f72 6967 696e 616c 5f63 6f6c 756d   {original_colum
-00014950: 6e5f 6e61 6d65 7d20 6e6f 7420 696e 2074  n_name} not in t
-00014960: 6865 2064 6174 6173 6574 2e20 220a 2020  he dataset. ".  
-00014970: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00014980: 4375 7272 656e 7420 636f 6c75 6d6e 7320  Current columns 
-00014990: 696e 2074 6865 2064 6174 6173 6574 3a20  in the dataset: 
-000149a0: 7b64 6174 6173 6574 2e5f 6461 7461 2e63  {dataset._data.c
-000149b0: 6f6c 756d 6e5f 6e61 6d65 737d 220a 2020  olumn_names}".  
-000149c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000149d0: 2020 2020 6966 206e 6577 5f63 6f6c 756d      if new_colum
-000149e0: 6e5f 6e61 6d65 2069 6e20 6461 7461 7365  n_name in datase
-000149f0: 742e 5f64 6174 612e 636f 6c75 6d6e 5f6e  t._data.column_n
-00014a00: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
-00014a10: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00014a20: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00014a30: 2020 2020 6622 4e65 7720 636f 6c75 6d6e      f"New column
-00014a40: 206e 616d 6520 7b6e 6577 5f63 6f6c 756d   name {new_colum
-00014a50: 6e5f 6e61 6d65 7d20 616c 7265 6164 7920  n_name} already 
-00014a60: 696e 2074 6865 2064 6174 6173 6574 2e20  in the dataset. 
-00014a70: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00014a80: 2020 6622 506c 6561 7365 2063 686f 6f73    f"Please choos
-00014a90: 6520 6120 636f 6c75 6d6e 206e 616d 6520  e a column name 
-00014aa0: 7768 6963 6820 6973 206e 6f74 2061 6c72  which is not alr
-00014ab0: 6561 6479 2069 6e20 7468 6520 6461 7461  eady in the data
-00014ac0: 7365 742e 2022 0a20 2020 2020 2020 2020  set. ".         
-00014ad0: 2020 2020 2020 2066 2243 7572 7265 6e74         f"Current
-00014ae0: 2063 6f6c 756d 6e73 2069 6e20 7468 6520   columns in the 
-00014af0: 6461 7461 7365 743a 207b 6461 7461 7365  dataset: {datase
-00014b00: 742e 5f64 6174 612e 636f 6c75 6d6e 5f6e  t._data.column_n
-00014b10: 616d 6573 7d22 0a20 2020 2020 2020 2020  ames}".         
-00014b20: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
-00014b30: 6e6f 7420 6e65 775f 636f 6c75 6d6e 5f6e  not new_column_n
-00014b40: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
-00014b50: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00014b60: 7228 224e 6577 2063 6f6c 756d 6e20 6e61  r("New column na
-00014b70: 6d65 2069 7320 656d 7074 792e 2229 0a0a  me is empty.")..
-00014b80: 2020 2020 2020 2020 6465 6620 7265 6e61          def rena
-00014b90: 6d65 2863 6f6c 756d 6e73 293a 0a20 2020  me(columns):.   
-00014ba0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00014bb0: 5b6e 6577 5f63 6f6c 756d 6e5f 6e61 6d65  [new_column_name
-00014bc0: 2069 6620 636f 6c20 3d3d 206f 7269 6769   if col == origi
-00014bd0: 6e61 6c5f 636f 6c75 6d6e 5f6e 616d 6520  nal_column_name 
-00014be0: 656c 7365 2063 6f6c 2066 6f72 2063 6f6c  else col for col
-00014bf0: 2069 6e20 636f 6c75 6d6e 735d 0a0a 2020   in columns]..  
-00014c00: 2020 2020 2020 6e65 775f 636f 6c75 6d6e        new_column
-00014c10: 5f6e 616d 6573 203d 2072 656e 616d 6528  _names = rename(
-00014c20: 7365 6c66 2e5f 6461 7461 2e63 6f6c 756d  self._data.colum
-00014c30: 6e5f 6e61 6d65 7329 0a20 2020 2020 2020  n_names).       
-00014c40: 2069 6620 7365 6c66 2e5f 666f 726d 6174   if self._format
-00014c50: 5f63 6f6c 756d 6e73 2069 7320 6e6f 7420  _columns is not 
-00014c60: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00014c70: 2020 6461 7461 7365 742e 5f66 6f72 6d61    dataset._forma
-00014c80: 745f 636f 6c75 6d6e 7320 3d20 7265 6e61  t_columns = rena
-00014c90: 6d65 2873 656c 662e 5f66 6f72 6d61 745f  me(self._format_
-00014ca0: 636f 6c75 6d6e 7329 0a0a 2020 2020 2020  columns)..      
-00014cb0: 2020 6461 7461 7365 742e 5f69 6e66 6f2e    dataset._info.
-00014cc0: 6665 6174 7572 6573 203d 2046 6561 7475  features = Featu
-00014cd0: 7265 7328 0a20 2020 2020 2020 2020 2020  res(.           
-00014ce0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00014cf0: 2020 206e 6577 5f63 6f6c 756d 6e5f 6e61     new_column_na
-00014d00: 6d65 2069 6620 636f 6c20 3d3d 206f 7269  me if col == ori
-00014d10: 6769 6e61 6c5f 636f 6c75 6d6e 5f6e 616d  ginal_column_nam
-00014d20: 6520 656c 7365 2063 6f6c 3a20 6665 6174  e else col: feat
-00014d30: 7572 650a 2020 2020 2020 2020 2020 2020  ure.            
-00014d40: 2020 2020 666f 7220 636f 6c2c 2066 6561      for col, fea
-00014d50: 7475 7265 2069 6e20 7365 6c66 2e5f 696e  ture in self._in
-00014d60: 666f 2e66 6561 7475 7265 732e 6974 656d  fo.features.item
-00014d70: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-00014d80: 7d0a 2020 2020 2020 2020 290a 0a20 2020  }.        )..   
-00014d90: 2020 2020 2064 6174 6173 6574 2e5f 6461       dataset._da
-00014da0: 7461 203d 2064 6174 6173 6574 2e5f 6461  ta = dataset._da
-00014db0: 7461 2e72 656e 616d 655f 636f 6c75 6d6e  ta.rename_column
-00014dc0: 7328 6e65 775f 636f 6c75 6d6e 5f6e 616d  s(new_column_nam
-00014dd0: 6573 290a 2020 2020 2020 2020 6461 7461  es).        data
-00014de0: 7365 742e 5f64 6174 6120 3d20 7570 6461  set._data = upda
-00014df0: 7465 5f6d 6574 6164 6174 615f 7769 7468  te_metadata_with
-00014e00: 5f66 6561 7475 7265 7328 6461 7461 7365  _features(datase
-00014e10: 742e 5f64 6174 612c 2064 6174 6173 6574  t._data, dataset
-00014e20: 2e66 6561 7475 7265 7329 0a20 2020 2020  .features).     
-00014e30: 2020 2064 6174 6173 6574 2e5f 6669 6e67     dataset._fing
-00014e40: 6572 7072 696e 7420 3d20 6e65 775f 6669  erprint = new_fi
-00014e50: 6e67 6572 7072 696e 740a 2020 2020 2020  ngerprint.      
-00014e60: 2020 7265 7475 726e 2064 6174 6173 6574    return dataset
-00014e70: 0a0a 2020 2020 4074 7261 6e73 6d69 745f  ..    @transmit_
-00014e80: 7461 736b 730a 2020 2020 4066 696e 6765  tasks.    @finge
-00014e90: 7270 7269 6e74 5f74 7261 6e73 666f 726d  rprint_transform
-00014ea0: 2869 6e70 6c61 6365 3d46 616c 7365 290a  (inplace=False).
-00014eb0: 2020 2020 6465 6620 7265 6e61 6d65 5f63      def rename_c
-00014ec0: 6f6c 756d 6e73 2873 656c 662c 2063 6f6c  olumns(self, col
-00014ed0: 756d 6e5f 6d61 7070 696e 673a 2044 6963  umn_mapping: Dic
-00014ee0: 745b 7374 722c 2073 7472 5d2c 206e 6577  t[str, str], new
-00014ef0: 5f66 696e 6765 7270 7269 6e74 3a20 4f70  _fingerprint: Op
-00014f00: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-00014f10: 6e65 2920 2d3e 2022 4461 7461 7365 7422  ne) -> "Dataset"
-00014f20: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00014f30: 2020 2020 2020 5265 6e61 6d65 2073 6576        Rename sev
-00014f40: 6572 616c 2063 6f6c 756d 6e73 2069 6e20  eral columns in 
-00014f50: 7468 6520 6461 7461 7365 742c 2061 6e64  the dataset, and
-00014f60: 206d 6f76 6520 7468 6520 6665 6174 7572   move the featur
-00014f70: 6573 2061 7373 6f63 6961 7465 6420 746f  es associated to
-00014f80: 2074 6865 206f 7269 6769 6e61 6c20 636f   the original co
-00014f90: 6c75 6d6e 7320 756e 6465 720a 2020 2020  lumns under.    
-00014fa0: 2020 2020 7468 6520 6e65 7720 636f 6c75      the new colu
-00014fb0: 6d6e 206e 616d 6573 2e0a 0a20 2020 2020  mn names...     
-00014fc0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00014fd0: 2020 2020 2063 6f6c 756d 6e5f 6d61 7070       column_mapp
-00014fe0: 696e 6720 2860 4469 6374 5b73 7472 2c20  ing (`Dict[str, 
-00014ff0: 7374 725d 6029 3a0a 2020 2020 2020 2020  str]`):.        
-00015000: 2020 2020 2020 2020 4120 6d61 7070 696e          A mappin
-00015010: 6720 6f66 2063 6f6c 756d 6e73 2074 6f20  g of columns to 
-00015020: 7265 6e61 6d65 2074 6f20 7468 6569 7220  rename to their 
-00015030: 6e65 7720 6e61 6d65 730a 2020 2020 2020  new names.      
-00015040: 2020 2020 2020 6e65 775f 6669 6e67 6572        new_finger
-00015050: 7072 696e 7420 2860 7374 7260 2c20 2a6f  print (`str`, *o
-00015060: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
-00015070: 2020 2020 2020 2020 2020 2054 6865 206e             The n
-00015080: 6577 2066 696e 6765 7270 7269 6e74 206f  ew fingerprint o
-00015090: 6620 7468 6520 6461 7461 7365 7420 6166  f the dataset af
-000150a0: 7465 7220 7472 616e 7366 6f72 6d2e 0a20  ter transform.. 
-000150b0: 2020 2020 2020 2020 2020 2020 2020 2049                 I
-000150c0: 6620 604e 6f6e 6560 2c20 7468 6520 6e65  f `None`, the ne
-000150d0: 7720 6669 6e67 6572 7072 696e 7420 6973  w fingerprint is
-000150e0: 2063 6f6d 7075 7465 6420 7573 696e 6720   computed using 
-000150f0: 6120 6861 7368 206f 6620 7468 6520 7072  a hash of the pr
-00015100: 6576 696f 7573 2066 696e 6765 7270 7269  evious fingerpri
-00015110: 6e74 2c20 616e 6420 7468 6520 7472 616e  nt, and the tran
-00015120: 7366 6f72 6d20 6172 6775 6d65 6e74 732e  sform arguments.
-00015130: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00015140: 733a 0a20 2020 2020 2020 2020 2020 205b  s:.            [
-00015150: 6044 6174 6173 6574 605d 3a20 4120 636f  `Dataset`]: A co
-00015160: 7079 206f 6620 7468 6520 6461 7461 7365  py of the datase
-00015170: 7420 7769 7468 2072 656e 616d 6564 2063  t with renamed c
-00015180: 6f6c 756d 6e73 0a0a 2020 2020 2020 2020  olumns..        
-00015190: 4578 616d 706c 653a 0a0a 2020 2020 2020  Example:..      
-000151a0: 2020 6060 6070 790a 2020 2020 2020 2020    ```py.        
-000151b0: 3e3e 3e20 6672 6f6d 2064 6174 6173 6574  >>> from dataset
-000151c0: 7320 696d 706f 7274 206c 6f61 645f 6461  s import load_da
-000151d0: 7461 7365 740a 2020 2020 2020 2020 3e3e  taset.        >>
-000151e0: 3e20 6473 203d 206c 6f61 645f 6461 7461  > ds = load_data
-000151f0: 7365 7428 2272 6f74 7465 6e5f 746f 6d61  set("rotten_toma
-00015200: 746f 6573 222c 2073 706c 6974 3d22 7661  toes", split="va
-00015210: 6c69 6461 7469 6f6e 2229 0a20 2020 2020  lidation").     
-00015220: 2020 203e 3e3e 2064 732e 7265 6e61 6d65     >>> ds.rename
-00015230: 5f63 6f6c 756d 6e73 287b 2774 6578 7427  _columns({'text'
-00015240: 3a20 2774 6578 745f 6e65 7727 2c20 276c  : 'text_new', 'l
-00015250: 6162 656c 273a 2027 6c61 6265 6c5f 6e65  abel': 'label_ne
-00015260: 7727 7d29 0a20 2020 2020 2020 2044 6174  w'}).        Dat
-00015270: 6173 6574 287b 0a20 2020 2020 2020 2020  aset({.         
-00015280: 2020 2066 6561 7475 7265 733a 205b 2774     features: ['t
-00015290: 6578 745f 6e65 7727 2c20 276c 6162 656c  ext_new', 'label
-000152a0: 5f6e 6577 275d 2c0a 2020 2020 2020 2020  _new'],.        
-000152b0: 2020 2020 6e75 6d5f 726f 7773 3a20 3130      num_rows: 10
-000152c0: 3636 0a20 2020 2020 2020 207d 290a 2020  66.        }).  
-000152d0: 2020 2020 2020 6060 600a 2020 2020 2020        ```.      
-000152e0: 2020 2222 220a 2020 2020 2020 2020 6461    """.        da
-000152f0: 7461 7365 7420 3d20 636f 7079 2e64 6565  taset = copy.dee
-00015300: 7063 6f70 7928 7365 6c66 290a 0a20 2020  pcopy(self)..   
-00015310: 2020 2020 2065 7874 7261 5f63 6f6c 756d       extra_colum
-00015320: 6e73 203d 2073 6574 2863 6f6c 756d 6e5f  ns = set(column_
-00015330: 6d61 7070 696e 672e 6b65 7973 2829 2920  mapping.keys()) 
-00015340: 2d20 7365 7428 6461 7461 7365 742e 636f  - set(dataset.co
-00015350: 6c75 6d6e 5f6e 616d 6573 290a 2020 2020  lumn_names).    
-00015360: 2020 2020 6966 2065 7874 7261 5f63 6f6c      if extra_col
-00015370: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
-00015380: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00015390: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-000153a0: 2020 2020 6622 4f72 6967 696e 616c 2063      f"Original c
-000153b0: 6f6c 756d 6e20 6e61 6d65 7320 7b65 7874  olumn names {ext
-000153c0: 7261 5f63 6f6c 756d 6e73 7d20 6e6f 7420  ra_columns} not 
-000153d0: 696e 2074 6865 2064 6174 6173 6574 2e20  in the dataset. 
-000153e0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000153f0: 2020 6622 4375 7272 656e 7420 636f 6c75    f"Current colu
-00015400: 6d6e 7320 696e 2074 6865 2064 6174 6173  mns in the datas
-00015410: 6574 3a20 7b64 6174 6173 6574 2e5f 6461  et: {dataset._da
-00015420: 7461 2e63 6f6c 756d 6e5f 6e61 6d65 737d  ta.column_names}
-00015430: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00015440: 0a20 2020 2020 2020 206e 756d 6265 725f  .        number_
-00015450: 6f66 5f64 7570 6c69 6361 7465 735f 696e  of_duplicates_in
-00015460: 5f6e 6577 5f63 6f6c 756d 6e73 203d 206c  _new_columns = l
-00015470: 656e 2863 6f6c 756d 6e5f 6d61 7070 696e  en(column_mappin
-00015480: 672e 7661 6c75 6573 2829 2920 2d20 6c65  g.values()) - le
-00015490: 6e28 7365 7428 636f 6c75 6d6e 5f6d 6170  n(set(column_map
-000154a0: 7069 6e67 2e76 616c 7565 7328 2929 290a  ping.values())).
-000154b0: 2020 2020 2020 2020 6966 206e 756d 6265          if numbe
-000154c0: 725f 6f66 5f64 7570 6c69 6361 7465 735f  r_of_duplicates_
-000154d0: 696e 5f6e 6577 5f63 6f6c 756d 6e73 2021  in_new_columns !
-000154e0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-000154f0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00015500: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00015510: 2020 2022 4e65 7720 636f 6c75 6d6e 206e     "New column n
-00015520: 616d 6573 206d 7573 7420 616c 6c20 6265  ames must all be
-00015530: 2064 6966 6665 7265 6e74 2c20 6275 7420   different, but 
-00015540: 7468 6973 2063 6f6c 756d 6e20 6d61 7070  this column mapp
-00015550: 696e 6720 220a 2020 2020 2020 2020 2020  ing ".          
-00015560: 2020 2020 2020 6622 6861 7320 7b6e 756d        f"has {num
-00015570: 6265 725f 6f66 5f64 7570 6c69 6361 7465  ber_of_duplicate
-00015580: 735f 696e 5f6e 6577 5f63 6f6c 756d 6e73  s_in_new_columns
-00015590: 7d20 6475 706c 6963 6174 6573 220a 2020  } duplicates".  
-000155a0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-000155b0: 2020 2020 2065 6d70 7479 5f6e 6577 5f63       empty_new_c
-000155c0: 6f6c 756d 6e73 203d 205b 6e65 775f 636f  olumns = [new_co
-000155d0: 6c20 666f 7220 6e65 775f 636f 6c20 696e  l for new_col in
-000155e0: 2063 6f6c 756d 6e5f 6d61 7070 696e 672e   column_mapping.
-000155f0: 7661 6c75 6573 2829 2069 6620 6e6f 7420  values() if not 
-00015600: 6e65 775f 636f 6c5d 0a20 2020 2020 2020  new_col].       
-00015610: 2069 6620 656d 7074 795f 6e65 775f 636f   if empty_new_co
-00015620: 6c75 6d6e 733a 0a20 2020 2020 2020 2020  lumns:.         
-00015630: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00015640: 726f 7228 6622 4e65 7720 636f 6c75 6d6e  ror(f"New column
-00015650: 206e 616d 6573 207b 656d 7074 795f 6e65   names {empty_ne
-00015660: 775f 636f 6c75 6d6e 737d 2061 7265 2065  w_columns} are e
-00015670: 6d70 7479 2e22 290a 0a20 2020 2020 2020  mpty.")..       
-00015680: 2064 6566 2072 656e 616d 6528 636f 6c75   def rename(colu
-00015690: 6d6e 7329 3a0a 2020 2020 2020 2020 2020  mns):.          
-000156a0: 2020 7265 7475 726e 205b 636f 6c75 6d6e    return [column
-000156b0: 5f6d 6170 7069 6e67 5b63 6f6c 5d20 6966  _mapping[col] if
-000156c0: 2063 6f6c 2069 6e20 636f 6c75 6d6e 5f6d   col in column_m
-000156d0: 6170 7069 6e67 2065 6c73 6520 636f 6c20  apping else col 
-000156e0: 666f 7220 636f 6c20 696e 2063 6f6c 756d  for col in colum
-000156f0: 6e73 5d0a 0a20 2020 2020 2020 206e 6577  ns]..        new
-00015700: 5f63 6f6c 756d 6e5f 6e61 6d65 7320 3d20  _column_names = 
-00015710: 7265 6e61 6d65 2873 656c 662e 5f64 6174  rename(self._dat
-00015720: 612e 636f 6c75 6d6e 5f6e 616d 6573 290a  a.column_names).
-00015730: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00015740: 5f66 6f72 6d61 745f 636f 6c75 6d6e 7320  _format_columns 
-00015750: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00015760: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
-00015770: 2e5f 666f 726d 6174 5f63 6f6c 756d 6e73  ._format_columns
-00015780: 203d 2072 656e 616d 6528 7365 6c66 2e5f   = rename(self._
-00015790: 666f 726d 6174 5f63 6f6c 756d 6e73 290a  format_columns).
-000157a0: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
-000157b0: 2e5f 696e 666f 2e66 6561 7475 7265 7320  ._info.features 
-000157c0: 3d20 4665 6174 7572 6573 280a 2020 2020  = Features(.    
-000157d0: 2020 2020 2020 2020 7b0a 2020 2020 2020          {.      
-000157e0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-000157f0: 5f6d 6170 7069 6e67 5b63 6f6c 5d20 6966  _mapping[col] if
-00015800: 2063 6f6c 2069 6e20 636f 6c75 6d6e 5f6d   col in column_m
-00015810: 6170 7069 6e67 2065 6c73 6520 636f 6c3a  apping else col:
-00015820: 2066 6561 7475 7265 0a20 2020 2020 2020   feature.       
-00015830: 2020 2020 2020 2020 2066 6f72 2063 6f6c           for col
-00015840: 2c20 6665 6174 7572 6520 696e 2028 7365  , feature in (se
-00015850: 6c66 2e5f 696e 666f 2e66 6561 7475 7265  lf._info.feature
-00015860: 7320 6f72 207b 7d29 2e69 7465 6d73 2829  s or {}).items()
-00015870: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-00015880: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00015890: 2020 6461 7461 7365 742e 5f64 6174 6120    dataset._data 
-000158a0: 3d20 6461 7461 7365 742e 5f64 6174 612e  = dataset._data.
-000158b0: 7265 6e61 6d65 5f63 6f6c 756d 6e73 286e  rename_columns(n
-000158c0: 6577 5f63 6f6c 756d 6e5f 6e61 6d65 7329  ew_column_names)
-000158d0: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
-000158e0: 2e5f 6461 7461 203d 2075 7064 6174 655f  ._data = update_
-000158f0: 6d65 7461 6461 7461 5f77 6974 685f 6665  metadata_with_fe
-00015900: 6174 7572 6573 2864 6174 6173 6574 2e5f  atures(dataset._
-00015910: 6461 7461 2c20 6461 7461 7365 742e 6665  data, dataset.fe
-00015920: 6174 7572 6573 290a 2020 2020 2020 2020  atures).        
-00015930: 6461 7461 7365 742e 5f66 696e 6765 7270  dataset._fingerp
-00015940: 7269 6e74 203d 206e 6577 5f66 696e 6765  rint = new_finge
-00015950: 7270 7269 6e74 0a20 2020 2020 2020 2072  rprint.        r
-00015960: 6574 7572 6e20 6461 7461 7365 740a 0a20  eturn dataset.. 
-00015970: 2020 2064 6566 205f 5f6c 656e 5f5f 2873     def __len__(s
-00015980: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00015990: 224e 756d 6265 7220 6f66 2072 6f77 7320  "Number of rows 
-000159a0: 696e 2074 6865 2064 6174 6173 6574 2e0a  in the dataset..
-000159b0: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-000159c0: 3a0a 0a20 2020 2020 2020 2060 6060 7079  :..        ```py
-000159d0: 0a20 2020 2020 2020 203e 3e3e 2066 726f  .        >>> fro
-000159e0: 6d20 6461 7461 7365 7473 2069 6d70 6f72  m datasets impor
-000159f0: 7420 6c6f 6164 5f64 6174 6173 6574 0a20  t load_dataset. 
-00015a00: 2020 2020 2020 203e 3e3e 2064 7320 3d20         >>> ds = 
-00015a10: 6c6f 6164 5f64 6174 6173 6574 2822 726f  load_dataset("ro
-00015a20: 7474 656e 5f74 6f6d 6174 6f65 7322 2c20  tten_tomatoes", 
-00015a30: 7370 6c69 743d 2276 616c 6964 6174 696f  split="validatio
-00015a40: 6e22 290a 2020 2020 2020 2020 3e3e 3e20  n").        >>> 
-00015a50: 6473 2e5f 5f6c 656e 5f5f 0a20 2020 2020  ds.__len__.     
-00015a60: 2020 203c 626f 756e 6420 6d65 7468 6f64     <bound method
-00015a70: 2044 6174 6173 6574 2e5f 5f6c 656e 5f5f   Dataset.__len__
-00015a80: 206f 6620 4461 7461 7365 7428 7b0a 2020   of Dataset({.  
-00015a90: 2020 2020 2020 2020 2020 6665 6174 7572            featur
-00015aa0: 6573 3a20 5b27 7465 7874 272c 2027 6c61  es: ['text', 'la
-00015ab0: 6265 6c27 5d2c 0a20 2020 2020 2020 2020  bel'],.         
-00015ac0: 2020 206e 756d 5f72 6f77 733a 2031 3036     num_rows: 106
-00015ad0: 360a 2020 2020 2020 2020 7d29 3e0a 2020  6.        })>.  
-00015ae0: 2020 2020 2020 6060 600a 2020 2020 2020        ```.      
-00015af0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00015b00: 7475 726e 2073 656c 662e 6e75 6d5f 726f  turn self.num_ro
-00015b10: 7773 0a0a 2020 2020 6465 6620 5f5f 6974  ws..    def __it
-00015b20: 6572 5f5f 2873 656c 6629 3a0a 2020 2020  er__(self):.    
-00015b30: 2020 2020 2222 2249 7465 7261 7465 2074      """Iterate t
-00015b40: 6872 6f75 6768 2074 6865 2065 7861 6d70  hrough the examp
-00015b50: 6c65 732e 0a0a 2020 2020 2020 2020 4966  les...        If
-00015b60: 2061 2066 6f72 6d61 7474 696e 6720 6973   a formatting is
-00015b70: 2073 6574 2077 6974 6820 3a6d 6574 683a   set with :meth:
-00015b80: 6044 6174 6173 6574 2e73 6574 5f66 6f72  `Dataset.set_for
-00015b90: 6d61 7460 2072 6f77 7320 7769 6c6c 2062  mat` rows will b
-00015ba0: 6520 7265 7475 726e 6564 2077 6974 6820  e returned with 
-00015bb0: 7468 650a 2020 2020 2020 2020 7365 6c65  the.        sele
-00015bc0: 6374 6564 2066 6f72 6d61 742e 0a20 2020  cted format..   
-00015bd0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00015be0: 2069 6620 7365 6c66 2e5f 696e 6469 6365   if self._indice
-00015bf0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00015c00: 2020 2020 2020 2023 2046 6173 7420 6974         # Fast it
-00015c10: 6572 6174 696f 6e0a 2020 2020 2020 2020  eration.        
-00015c20: 2020 2020 2320 4265 6e63 686d 6172 6b3a      # Benchmark:
-00015c30: 2068 7474 7073 3a2f 2f67 6973 742e 6769   https://gist.gi
-00015c40: 7468 7562 2e63 6f6d 2f6d 6172 696f 7361  thub.com/mariosa
-00015c50: 736b 6f2f 3032 3438 3238 3861 3265 3361  sko/0248288a2e3a
-00015c60: 3735 3536 3837 3339 3639 3731 3763 3166  7556873969717c1f
-00015c70: 6535 3262 2028 6661 7374 5f69 7465 725f  e52b (fast_iter_
-00015c80: 6261 7463 6829 0a20 2020 2020 2020 2020  batch).         
-00015c90: 2020 2066 6f72 6d61 745f 6b77 6172 6773     format_kwargs
-00015ca0: 203d 2073 656c 662e 5f66 6f72 6d61 745f   = self._format_
-00015cb0: 6b77 6172 6773 2069 6620 7365 6c66 2e5f  kwargs if self._
-00015cc0: 666f 726d 6174 5f6b 7761 7267 7320 6973  format_kwargs is
-00015cd0: 206e 6f74 204e 6f6e 6520 656c 7365 207b   not None else {
-00015ce0: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
-00015cf0: 726d 6174 7465 7220 3d20 6765 745f 666f  rmatter = get_fo
-00015d00: 726d 6174 7465 7228 7365 6c66 2e5f 666f  rmatter(self._fo
-00015d10: 726d 6174 5f74 7970 652c 2066 6561 7475  rmat_type, featu
-00015d20: 7265 733d 7365 6c66 2e66 6561 7475 7265  res=self.feature
-00015d30: 732c 202a 2a66 6f72 6d61 745f 6b77 6172  s, **format_kwar
-00015d40: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
-00015d50: 6261 7463 685f 7369 7a65 203d 2063 6f6e  batch_size = con
-00015d60: 6669 672e 4152 524f 575f 5245 4144 4552  fig.ARROW_READER
-00015d70: 5f42 4154 4348 5f53 495a 455f 494e 5f44  _BATCH_SIZE_IN_D
-00015d80: 4154 4153 4554 5f49 5445 520a 2020 2020  ATASET_ITER.    
-00015d90: 2020 2020 2020 2020 666f 7220 7061 5f73          for pa_s
-00015da0: 7562 7461 626c 6520 696e 2074 6162 6c65  ubtable in table
-00015db0: 5f69 7465 7228 7365 6c66 2e64 6174 612c  _iter(self.data,
-00015dc0: 2062 6174 6368 5f73 697a 653d 6261 7463   batch_size=batc
-00015dd0: 685f 7369 7a65 293a 0a20 2020 2020 2020  h_size):.       
-00015de0: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00015df0: 6e20 7261 6e67 6528 7061 5f73 7562 7461  n range(pa_subta
-00015e00: 626c 652e 6e75 6d5f 726f 7773 293a 0a20  ble.num_rows):. 
-00015e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e20: 2020 2070 615f 7375 6274 6162 6c65 5f65     pa_subtable_e
-00015e30: 7820 3d20 7061 5f73 7562 7461 626c 652e  x = pa_subtable.
-00015e40: 736c 6963 6528 692c 2031 290a 2020 2020  slice(i, 1).    
-00015e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e60: 666f 726d 6174 7465 645f 6f75 7470 7574  formatted_output
-00015e70: 203d 2066 6f72 6d61 745f 7461 626c 6528   = format_table(
-00015e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015e90: 2020 2020 2020 2020 2070 615f 7375 6274           pa_subt
-00015ea0: 6162 6c65 5f65 782c 0a20 2020 2020 2020  able_ex,.       
-00015eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ec0: 2030 2c0a 2020 2020 2020 2020 2020 2020   0,.            
-00015ed0: 2020 2020 2020 2020 2020 2020 666f 726d              form
-00015ee0: 6174 7465 723d 666f 726d 6174 7465 722c  atter=formatter,
-00015ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015f00: 2020 2020 2020 2020 2066 6f72 6d61 745f           format_
-00015f10: 636f 6c75 6d6e 733d 7365 6c66 2e5f 666f  columns=self._fo
-00015f20: 726d 6174 5f63 6f6c 756d 6e73 2c0a 2020  rmat_columns,.  
-00015f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f40: 2020 2020 2020 6f75 7470 7574 5f61 6c6c        output_all
-00015f50: 5f63 6f6c 756d 6e73 3d73 656c 662e 5f6f  _columns=self._o
-00015f60: 7574 7075 745f 616c 6c5f 636f 6c75 6d6e  utput_all_column
-00015f70: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00015f80: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00015f90: 2020 2020 2020 2020 2020 2020 2079 6965               yie
-00015fa0: 6c64 2066 6f72 6d61 7474 6564 5f6f 7574  ld formatted_out
-00015fb0: 7075 740a 2020 2020 2020 2020 656c 7365  put.        else
-00015fc0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00015fd0: 7220 6920 696e 2072 616e 6765 2873 656c  r i in range(sel
-00015fe0: 662e 6e75 6d5f 726f 7773 293a 0a20 2020  f.num_rows):.   
-00015ff0: 2020 2020 2020 2020 2020 2020 2079 6965               yie
-00016000: 6c64 2073 656c 662e 5f67 6574 6974 656d  ld self._getitem
-00016010: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00016020: 2020 2020 2020 692c 0a20 2020 2020 2020        i,.       
-00016030: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00016040: 6465 6620 6974 6572 2873 656c 662c 2062  def iter(self, b
-00016050: 6174 6368 5f73 697a 653a 2069 6e74 2c20  atch_size: int, 
-00016060: 6472 6f70 5f6c 6173 745f 6261 7463 683a  drop_last_batch:
-00016070: 2062 6f6f 6c20 3d20 4661 6c73 6529 3a0a   bool = False):.
-00016080: 2020 2020 2020 2020 2222 2249 7465 7261          """Itera
-00016090: 7465 2074 6872 6f75 6768 2074 6865 2062  te through the b
-000160a0: 6174 6368 6573 206f 6620 7369 7a65 2060  atches of size `
-000160b0: 6261 7463 685f 7369 7a65 602e 0a0a 2020  batch_size`...  
-000160c0: 2020 2020 2020 4966 2061 2066 6f72 6d61        If a forma
-000160d0: 7474 696e 6720 6973 2073 6574 2077 6974  tting is set wit
-000160e0: 6820 5b60 7e64 6174 6173 6574 732e 4461  h [`~datasets.Da
-000160f0: 7461 7365 742e 7365 745f 666f 726d 6174  taset.set_format
-00016100: 605d 2072 6f77 7320 7769 6c6c 2062 6520  `] rows will be 
-00016110: 7265 7475 726e 6564 2077 6974 6820 7468  returned with th
-00016120: 650a 2020 2020 2020 2020 7365 6c65 6374  e.        select
-00016130: 6564 2066 6f72 6d61 742e 0a0a 2020 2020  ed format...    
-00016140: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00016150: 2020 2020 2020 6261 7463 685f 7369 7a65        batch_size
-00016160: 2028 3a6f 626a 3a60 696e 7460 293a 2073   (:obj:`int`): s
-00016170: 697a 6520 6f66 2065 6163 6820 6261 7463  ize of each batc
-00016180: 6820 746f 2079 6965 6c64 2e0a 2020 2020  h to yield..    
-00016190: 2020 2020 2020 2020 6472 6f70 5f6c 6173          drop_las
-000161a0: 745f 6261 7463 6820 283a 6f62 6a3a 6062  t_batch (:obj:`b
-000161b0: 6f6f 6c60 2c20 6465 6661 756c 7420 6046  ool`, default `F
-000161c0: 616c 7365 6029 3a20 5768 6574 6865 7220  alse`): Whether 
-000161d0: 6120 6c61 7374 2062 6174 6368 2073 6d61  a last batch sma
-000161e0: 6c6c 6572 2074 6861 6e20 7468 6520 6261  ller than the ba
-000161f0: 7463 685f 7369 7a65 2073 686f 756c 6420  tch_size should 
-00016200: 6265 0a20 2020 2020 2020 2020 2020 2020  be.             
-00016210: 2020 2064 726f 7070 6564 0a20 2020 2020     dropped.     
-00016220: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00016230: 6620 7365 6c66 2e5f 696e 6469 6365 7320  f self._indices 
-00016240: 6973 204e 6f6e 6520 616e 6420 636f 6e66  is None and conf
-00016250: 6967 2e50 5941 5252 4f57 5f56 4552 5349  ig.PYARROW_VERSI
-00016260: 4f4e 2e6d 616a 6f72 203e 3d20 383a 0a20  ON.major >= 8:. 
-00016270: 2020 2020 2020 2020 2020 2023 2046 6173             # Fas
-00016280: 7420 6974 6572 6174 696f 6e0a 2020 2020  t iteration.    
-00016290: 2020 2020 2020 2020 2320 4265 6e63 686d          # Benchm
-000162a0: 6172 6b3a 2068 7474 7073 3a2f 2f67 6973  ark: https://gis
-000162b0: 742e 6769 7468 7562 2e63 6f6d 2f6d 6172  t.github.com/mar
-000162c0: 696f 7361 736b 6f2f 3032 3438 3238 3861  iosasko/0248288a
-000162d0: 3265 3361 3735 3536 3837 3339 3639 3731  2e3a755687396971
-000162e0: 3763 3166 6535 3262 2028 6661 7374 5f69  7c1fe52b (fast_i
-000162f0: 7465 725f 6261 7463 6829 0a20 2020 2020  ter_batch).     
-00016300: 2020 2020 2020 2066 6f72 6d61 745f 6b77         format_kw
-00016310: 6172 6773 203d 2073 656c 662e 5f66 6f72  args = self._for
-00016320: 6d61 745f 6b77 6172 6773 2069 6620 7365  mat_kwargs if se
-00016330: 6c66 2e5f 666f 726d 6174 5f6b 7761 7267  lf._format_kwarg
-00016340: 7320 6973 206e 6f74 204e 6f6e 6520 656c  s is not None el
-00016350: 7365 207b 7d0a 2020 2020 2020 2020 2020  se {}.          
-00016360: 2020 666f 726d 6174 7465 7220 3d20 6765    formatter = ge
-00016370: 745f 666f 726d 6174 7465 7228 7365 6c66  t_formatter(self
-00016380: 2e5f 666f 726d 6174 5f74 7970 652c 2066  ._format_type, f
-00016390: 6561 7475 7265 733d 7365 6c66 2e66 6561  eatures=self.fea
-000163a0: 7475 7265 732c 202a 2a66 6f72 6d61 745f  tures, **format_
-000163b0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-000163c0: 2020 2020 666f 7220 7061 5f73 7562 7461      for pa_subta
-000163d0: 626c 6520 696e 2074 6162 6c65 5f69 7465  ble in table_ite
-000163e0: 7228 7365 6c66 2e64 6174 612c 2062 6174  r(self.data, bat
-000163f0: 6368 5f73 697a 653d 6261 7463 685f 7369  ch_size=batch_si
-00016400: 7a65 2c20 6472 6f70 5f6c 6173 745f 6261  ze, drop_last_ba
-00016410: 7463 683d 6472 6f70 5f6c 6173 745f 6261  tch=drop_last_ba
-00016420: 7463 6829 3a0a 2020 2020 2020 2020 2020  tch):.          
-00016430: 2020 2020 2020 666f 726d 6174 7465 645f        formatted_
-00016440: 6261 7463 6820 3d20 666f 726d 6174 5f74  batch = format_t
-00016450: 6162 6c65 280a 2020 2020 2020 2020 2020  able(.          
-00016460: 2020 2020 2020 2020 2020 7061 5f73 7562            pa_sub
-00016470: 7461 626c 652c 0a20 2020 2020 2020 2020  table,.         
-00016480: 2020 2020 2020 2020 2020 2072 616e 6765             range
-00016490: 2870 615f 7375 6274 6162 6c65 2e6e 756d  (pa_subtable.num
-000164a0: 5f72 6f77 7329 2c0a 2020 2020 2020 2020  _rows),.        
-000164b0: 2020 2020 2020 2020 2020 2020 666f 726d              form
-000164c0: 6174 7465 723d 666f 726d 6174 7465 722c  atter=formatter,
-000164d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000164e0: 2020 2020 2066 6f72 6d61 745f 636f 6c75       format_colu
-000164f0: 6d6e 733d 7365 6c66 2e5f 666f 726d 6174  mns=self._format
-00016500: 5f63 6f6c 756d 6e73 2c0a 2020 2020 2020  _columns,.      
-00016510: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00016520: 7470 7574 5f61 6c6c 5f63 6f6c 756d 6e73  tput_all_columns
-00016530: 3d73 656c 662e 5f6f 7574 7075 745f 616c  =self._output_al
-00016540: 6c5f 636f 6c75 6d6e 732c 0a20 2020 2020  l_columns,.     
-00016550: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00016560: 2020 2020 2020 2020 2020 2020 2079 6965               yie
-00016570: 6c64 2066 6f72 6d61 7474 6564 5f62 6174  ld formatted_bat
-00016580: 6368 0a20 2020 2020 2020 2065 6c73 653a  ch.        else:
-00016590: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
-000165a0: 5f72 6f77 7320 3d20 7365 6c66 2e6e 756d  _rows = self.num
-000165b0: 5f72 6f77 7320 6966 206e 6f74 2064 726f  _rows if not dro
-000165c0: 705f 6c61 7374 5f62 6174 6368 2065 6c73  p_last_batch els
-000165d0: 6520 7365 6c66 2e6e 756d 5f72 6f77 7320  e self.num_rows 
-000165e0: 2f2f 2062 6174 6368 5f73 697a 6520 2a20  // batch_size * 
-000165f0: 6261 7463 685f 7369 7a65 0a20 2020 2020  batch_size.     
-00016600: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00016610: 7261 6e67 6528 302c 206e 756d 5f72 6f77  range(0, num_row
-00016620: 732c 2062 6174 6368 5f73 697a 6529 3a0a  s, batch_size):.
-00016630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016640: 7969 656c 6420 7365 6c66 2e5f 6765 7469  yield self._geti
-00016650: 7465 6d28 0a20 2020 2020 2020 2020 2020  tem(.           
-00016660: 2020 2020 2020 2020 2073 6c69 6365 2869           slice(i
-00016670: 2c20 6920 2b20 6261 7463 685f 7369 7a65  , i + batch_size
-00016680: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00016690: 2020 2029 0a0a 2020 2020 6465 6620 5f5f     )..    def __
-000166a0: 7265 7072 5f5f 2873 656c 6629 3a0a 2020  repr__(self):.  
-000166b0: 2020 2020 2020 7265 7475 726e 2066 2244        return f"D
-000166c0: 6174 6173 6574 287b 7b5c 6e20 2020 2066  ataset({{\n    f
-000166d0: 6561 7475 7265 733a 207b 6c69 7374 2873  eatures: {list(s
-000166e0: 656c 662e 6665 6174 7572 6573 2e6b 6579  elf.features.key
-000166f0: 7328 2929 7d2c 5c6e 2020 2020 6e75 6d5f  s())},\n    num_
-00016700: 726f 7773 3a20 7b73 656c 662e 6e75 6d5f  rows: {self.num_
-00016710: 726f 7773 7d5c 6e7d 7d29 220a 0a20 2020  rows}\n}})"..   
-00016720: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00016730: 6566 2066 6f72 6d61 7428 7365 6c66 293a  ef format(self):
-00016740: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00016750: 7b0a 2020 2020 2020 2020 2020 2020 2274  {.            "t
-00016760: 7970 6522 3a20 7365 6c66 2e5f 666f 726d  ype": self._form
-00016770: 6174 5f74 7970 652c 0a20 2020 2020 2020  at_type,.       
-00016780: 2020 2020 2022 666f 726d 6174 5f6b 7761       "format_kwa
-00016790: 7267 7322 3a20 7365 6c66 2e5f 666f 726d  rgs": self._form
-000167a0: 6174 5f6b 7761 7267 732c 0a20 2020 2020  at_kwargs,.     
-000167b0: 2020 2020 2020 2022 636f 6c75 6d6e 7322         "columns"
-000167c0: 3a20 7365 6c66 2e63 6f6c 756d 6e5f 6e61  : self.column_na
-000167d0: 6d65 7320 6966 2073 656c 662e 5f66 6f72  mes if self._for
-000167e0: 6d61 745f 636f 6c75 6d6e 7320 6973 204e  mat_columns is N
-000167f0: 6f6e 6520 656c 7365 2073 656c 662e 5f66  one else self._f
-00016800: 6f72 6d61 745f 636f 6c75 6d6e 732c 0a20  ormat_columns,. 
-00016810: 2020 2020 2020 2020 2020 2022 6f75 7470             "outp
-00016820: 7574 5f61 6c6c 5f63 6f6c 756d 6e73 223a  ut_all_columns":
-00016830: 2073 656c 662e 5f6f 7574 7075 745f 616c   self._output_al
-00016840: 6c5f 636f 6c75 6d6e 732c 0a20 2020 2020  l_columns,.     
-00016850: 2020 207d 0a0a 2020 2020 4063 6f6e 7465     }..    @conte
-00016860: 7874 6c69 622e 636f 6e74 6578 746d 616e  xtlib.contextman
-00016870: 6167 6572 0a20 2020 2064 6566 2066 6f72  ager.    def for
-00016880: 6d61 7474 6564 5f61 7328 0a20 2020 2020  matted_as(.     
-00016890: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000168a0: 2074 7970 653a 204f 7074 696f 6e61 6c5b   type: Optional[
-000168b0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-000168c0: 2020 2020 2063 6f6c 756d 6e73 3a20 4f70       columns: Op
-000168d0: 7469 6f6e 616c 5b4c 6973 745d 203d 204e  tional[List] = N
-000168e0: 6f6e 652c 0a20 2020 2020 2020 206f 7574  one,.        out
-000168f0: 7075 745f 616c 6c5f 636f 6c75 6d6e 733a  put_all_columns:
-00016900: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-00016910: 2020 2020 2020 202a 2a66 6f72 6d61 745f         **format_
-00016920: 6b77 6172 6773 2c0a 2020 2020 293a 0a20  kwargs,.    ):. 
-00016930: 2020 2020 2020 2022 2222 546f 2062 6520         """To be 
-00016940: 7573 6564 2069 6e20 6120 6077 6974 6860  used in a `with`
-00016950: 2073 7461 7465 6d65 6e74 2e20 5365 7420   statement. Set 
-00016960: 605f 5f67 6574 6974 656d 5f5f 6020 7265  `__getitem__` re
-00016970: 7475 726e 2066 6f72 6d61 7420 2874 7970  turn format (typ
-00016980: 6520 616e 6420 636f 6c75 6d6e 7329 2e0a  e and columns)..
-00016990: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-000169a0: 2020 2020 2020 2020 2020 2074 7970 6520             type 
-000169b0: 2860 7374 7260 2c20 2a6f 7074 696f 6e61  (`str`, *optiona
-000169c0: 6c2a 293a 0a20 2020 2020 2020 2020 2020  l*):.           
-000169d0: 2020 2020 204f 7574 7075 7420 7479 7065       Output type
-000169e0: 2073 656c 6563 7465 6420 696e 2060 5b4e   selected in `[N
-000169f0: 6f6e 652c 2027 6e75 6d70 7927 2c20 2774  one, 'numpy', 't
-00016a00: 6f72 6368 272c 2027 7465 6e73 6f72 666c  orch', 'tensorfl
-00016a10: 6f77 272c 2027 7061 6e64 6173 272c 2027  ow', 'pandas', '
-00016a20: 6172 726f 7727 5d60 2e0a 2020 2020 2020  arrow']`..      
-00016a30: 2020 2020 2020 2020 2020 604e 6f6e 6560            `None`
-00016a40: 206d 6561 6e73 2060 5f5f 6765 7469 7465   means `__getite
-00016a50: 6d5f 5f60 6020 7265 7475 726e 7320 7079  m__`` returns py
-00016a60: 7468 6f6e 206f 626a 6563 7473 2028 6465  thon objects (de
-00016a70: 6661 756c 7429 2e0a 2020 2020 2020 2020  fault)..        
-00016a80: 2020 2020 636f 6c75 6d6e 7320 2860 4c69      columns (`Li
-00016a90: 7374 5b73 7472 5d60 2c20 2a6f 7074 696f  st[str]`, *optio
-00016aa0: 6e61 6c2a 293a 0a20 2020 2020 2020 2020  nal*):.         
-00016ab0: 2020 2020 2020 2043 6f6c 756d 6e73 2074         Columns t
-00016ac0: 6f20 666f 726d 6174 2069 6e20 7468 6520  o format in the 
-00016ad0: 6f75 7470 7574 2e0a 2020 2020 2020 2020  output..        
-00016ae0: 2020 2020 2020 2020 604e 6f6e 6560 206d          `None` m
-00016af0: 6561 6e73 2060 5f5f 6765 7469 7465 6d5f  eans `__getitem_
-00016b00: 5f60 2072 6574 7572 6e73 2061 6c6c 2063  _` returns all c
-00016b10: 6f6c 756d 6e73 2028 6465 6661 756c 7429  olumns (default)
-00016b20: 2e0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
-00016b30: 7470 7574 5f61 6c6c 5f63 6f6c 756d 6e73  tput_all_columns
-00016b40: 2028 6062 6f6f 6c60 2c20 6465 6661 756c   (`bool`, defaul
-00016b50: 7473 2074 6f20 6046 616c 7365 6029 3a0a  ts to `False`):.
-00016b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b70: 4b65 6570 2075 6e2d 666f 726d 6174 7465  Keep un-formatte
-00016b80: 6420 636f 6c75 6d6e 7320 6173 2077 656c  d columns as wel
-00016b90: 6c20 696e 2074 6865 206f 7574 7075 7420  l in the output 
-00016ba0: 2861 7320 7079 7468 6f6e 206f 626a 6563  (as python objec
-00016bb0: 7473 292e 0a20 2020 2020 2020 2020 2020  ts)..           
-00016bc0: 202a 2a66 6f72 6d61 745f 6b77 6172 6773   **format_kwargs
-00016bd0: 2028 6164 6469 7469 6f6e 616c 206b 6579   (additional key
-00016be0: 776f 7264 2061 7267 756d 656e 7473 293a  word arguments):
-00016bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016c00: 204b 6579 776f 7264 7320 6172 6775 6d65   Keywords argume
-00016c10: 6e74 7320 7061 7373 6564 2074 6f20 7468  nts passed to th
-00016c20: 6520 636f 6e76 6572 7420 6675 6e63 7469  e convert functi
-00016c30: 6f6e 206c 696b 6520 606e 702e 6172 7261  on like `np.arra
-00016c40: 7960 2c20 6074 6f72 6368 2e74 656e 736f  y`, `torch.tenso
-00016c50: 7260 206f 7220 6074 656e 736f 7266 6c6f  r` or `tensorflo
-00016c60: 772e 7261 6767 6564 2e63 6f6e 7374 616e  w.ragged.constan
-00016c70: 7460 2e0a 2020 2020 2020 2020 2222 220a  t`..        """.
-00016c80: 2020 2020 2020 2020 6f6c 645f 666f 726d          old_form
-00016c90: 6174 5f74 7970 6520 3d20 7365 6c66 2e5f  at_type = self._
-00016ca0: 666f 726d 6174 5f74 7970 650a 2020 2020  format_type.    
-00016cb0: 2020 2020 6f6c 645f 666f 726d 6174 5f6b      old_format_k
-00016cc0: 7761 7267 7320 3d20 7365 6c66 2e5f 666f  wargs = self._fo
-00016cd0: 726d 6174 5f6b 7761 7267 730a 2020 2020  rmat_kwargs.    
-00016ce0: 2020 2020 6f6c 645f 666f 726d 6174 5f63      old_format_c
-00016cf0: 6f6c 756d 6e73 203d 2073 656c 662e 5f66  olumns = self._f
-00016d00: 6f72 6d61 745f 636f 6c75 6d6e 730a 2020  ormat_columns.  
-00016d10: 2020 2020 2020 6f6c 645f 6f75 7470 7574        old_output
-00016d20: 5f61 6c6c 5f63 6f6c 756d 6e73 203d 2073  _all_columns = s
-00016d30: 656c 662e 5f6f 7574 7075 745f 616c 6c5f  elf._output_all_
-00016d40: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
-00016d50: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00016d60: 2073 656c 662e 7365 745f 666f 726d 6174   self.set_format
-00016d70: 2874 7970 652c 2063 6f6c 756d 6e73 2c20  (type, columns, 
-00016d80: 6f75 7470 7574 5f61 6c6c 5f63 6f6c 756d  output_all_colum
-00016d90: 6e73 2c20 2a2a 666f 726d 6174 5f6b 7761  ns, **format_kwa
-00016da0: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-00016db0: 2079 6965 6c64 0a20 2020 2020 2020 2066   yield.        f
-00016dc0: 696e 616c 6c79 3a0a 2020 2020 2020 2020  inally:.        
-00016dd0: 2020 2020 7365 6c66 2e73 6574 5f66 6f72      self.set_for
-00016de0: 6d61 7428 6f6c 645f 666f 726d 6174 5f74  mat(old_format_t
-00016df0: 7970 652c 206f 6c64 5f66 6f72 6d61 745f  ype, old_format_
-00016e00: 636f 6c75 6d6e 732c 206f 6c64 5f6f 7574  columns, old_out
-00016e10: 7075 745f 616c 6c5f 636f 6c75 6d6e 732c  put_all_columns,
-00016e20: 202a 2a6f 6c64 5f66 6f72 6d61 745f 6b77   **old_format_kw
-00016e30: 6172 6773 290a 0a20 2020 2040 6669 6e67  args)..    @fing
-00016e40: 6572 7072 696e 745f 7472 616e 7366 6f72  erprint_transfor
-00016e50: 6d28 696e 706c 6163 653d 5472 7565 290a  m(inplace=True).
-00016e60: 2020 2020 6465 6620 7365 745f 666f 726d      def set_form
-00016e70: 6174 280a 2020 2020 2020 2020 7365 6c66  at(.        self
-00016e80: 2c0a 2020 2020 2020 2020 7479 7065 3a20  ,.        type: 
-00016e90: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-00016ea0: 4e6f 6e65 2c0a 2020 2020 2020 2020 636f  None,.        co
-00016eb0: 6c75 6d6e 733a 204f 7074 696f 6e61 6c5b  lumns: Optional[
-00016ec0: 4c69 7374 5d20 3d20 4e6f 6e65 2c0a 2020  List] = None,.  
-00016ed0: 2020 2020 2020 6f75 7470 7574 5f61 6c6c        output_all
-00016ee0: 5f63 6f6c 756d 6e73 3a20 626f 6f6c 203d  _columns: bool =
-00016ef0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00016f00: 2a2a 666f 726d 6174 5f6b 7761 7267 732c  **format_kwargs,
-00016f10: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00016f20: 2222 2253 6574 2060 5f5f 6765 7469 7465  """Set `__getite
-00016f30: 6d5f 5f60 2072 6574 7572 6e20 666f 726d  m__` return form
-00016f40: 6174 2028 7479 7065 2061 6e64 2063 6f6c  at (type and col
-00016f50: 756d 6e73 292e 2054 6865 2064 6174 6120  umns). The data 
-00016f60: 666f 726d 6174 7469 6e67 2069 7320 6170  formatting is ap
-00016f70: 706c 6965 6420 6f6e 2d74 6865 2d66 6c79  plied on-the-fly
-00016f80: 2e0a 2020 2020 2020 2020 5468 6520 666f  ..        The fo
-00016f90: 726d 6174 2060 7479 7065 6020 2866 6f72  rmat `type` (for
-00016fa0: 2065 7861 6d70 6c65 2022 6e75 6d70 7922   example "numpy"
-00016fb0: 2920 6973 2075 7365 6420 746f 2066 6f72  ) is used to for
-00016fc0: 6d61 7420 6261 7463 6865 7320 7768 656e  mat batches when
-00016fd0: 2075 7369 6e67 2060 5f5f 6765 7469 7465   using `__getite
-00016fe0: 6d5f 5f60 2e0a 2020 2020 2020 2020 4974  m__`..        It
-00016ff0: 2773 2061 6c73 6f20 706f 7373 6962 6c65  's also possible
-00017000: 2074 6f20 7573 6520 6375 7374 6f6d 2074   to use custom t
-00017010: 7261 6e73 666f 726d 7320 666f 7220 666f  ransforms for fo
-00017020: 726d 6174 7469 6e67 2075 7369 6e67 205b  rmatting using [
-00017030: 607e 6461 7461 7365 7473 2e44 6174 6173  `~datasets.Datas
-00017040: 6574 2e73 6574 5f74 7261 6e73 666f 726d  et.set_transform
-00017050: 605d 2e0a 0a20 2020 2020 2020 2041 7267  `]...        Arg
-00017060: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
-00017070: 7970 6520 2860 7374 7260 2c20 2a6f 7074  ype (`str`, *opt
-00017080: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
-00017090: 2020 2020 2020 2020 2045 6974 6865 7220           Either 
-000170a0: 6f75 7470 7574 2074 7970 6520 7365 6c65  output type sele
-000170b0: 6374 6564 2069 6e20 605b 4e6f 6e65 2c20  cted in `[None, 
-000170c0: 276e 756d 7079 272c 2027 746f 7263 6827  'numpy', 'torch'
-000170d0: 2c20 2774 656e 736f 7266 6c6f 7727 2c20  , 'tensorflow', 
-000170e0: 2770 616e 6461 7327 2c20 2761 7272 6f77  'pandas', 'arrow
-000170f0: 275d 602e 0a20 2020 2020 2020 2020 2020  ']`..           
-00017100: 2020 2020 2060 4e6f 6e65 6020 6d65 616e       `None` mean
-00017110: 7320 605f 5f67 6574 6974 656d 5f5f 6020  s `__getitem__` 
-00017120: 7265 7475 726e 7320 7079 7468 6f6e 206f  returns python o
-00017130: 626a 6563 7473 2028 6465 6661 756c 7429  bjects (default)
-00017140: 2e0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00017150: 6c75 6d6e 7320 2860 4c69 7374 5b73 7472  lumns (`List[str
-00017160: 5d60 2c20 2a6f 7074 696f 6e61 6c2a 293a  ]`, *optional*):
-00017170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017180: 2043 6f6c 756d 6e73 2074 6f20 666f 726d   Columns to form
-00017190: 6174 2069 6e20 7468 6520 6f75 7470 7574  at in the output
-000171a0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000171b0: 2020 604e 6f6e 6560 206d 6561 6e73 2060    `None` means `
-000171c0: 5f5f 6765 7469 7465 6d5f 5f60 2072 6574  __getitem__` ret
-000171d0: 7572 6e73 2061 6c6c 2063 6f6c 756d 6e73  urns all columns
-000171e0: 2028 6465 6661 756c 7429 2e0a 2020 2020   (default)..    
-000171f0: 2020 2020 2020 2020 6f75 7470 7574 5f61          output_a
-00017200: 6c6c 5f63 6f6c 756d 6e73 2028 6062 6f6f  ll_columns (`boo
-00017210: 6c60 2c20 6465 6661 756c 7473 2074 6f20  l`, defaults to 
-00017220: 6046 616c 7365 6029 3a0a 2020 2020 2020  `False`):.      
-00017230: 2020 2020 2020 2020 2020 4b65 6570 2075            Keep u
-00017240: 6e2d 666f 726d 6174 7465 6420 636f 6c75  n-formatted colu
-00017250: 6d6e 7320 6173 2077 656c 6c20 696e 2074  mns as well in t
-00017260: 6865 206f 7574 7075 7420 2861 7320 7079  he output (as py
-00017270: 7468 6f6e 206f 626a 6563 7473 292e 0a20  thon objects).. 
-00017280: 2020 2020 2020 2020 2020 202a 2a66 6f72             **for
-00017290: 6d61 745f 6b77 6172 6773 2028 6164 6469  mat_kwargs (addi
-000172a0: 7469 6f6e 616c 206b 6579 776f 7264 2061  tional keyword a
-000172b0: 7267 756d 656e 7473 293a 0a20 2020 2020  rguments):.     
-000172c0: 2020 2020 2020 2020 2020 204b 6579 776f             Keywo
-000172d0: 7264 7320 6172 6775 6d65 6e74 7320 7061  rds arguments pa
-000172e0: 7373 6564 2074 6f20 7468 6520 636f 6e76  ssed to the conv
-000172f0: 6572 7420 6675 6e63 7469 6f6e 206c 696b  ert function lik
-00017300: 6520 606e 702e 6172 7261 7960 2c20 6074  e `np.array`, `t
-00017310: 6f72 6368 2e74 656e 736f 7260 206f 7220  orch.tensor` or 
-00017320: 6074 656e 736f 7266 6c6f 772e 7261 6767  `tensorflow.ragg
-00017330: 6564 2e63 6f6e 7374 616e 7460 2e0a 0a20  ed.constant`... 
-00017340: 2020 2020 2020 2049 7420 6973 2070 6f73         It is pos
-00017350: 7369 626c 6520 746f 2063 616c 6c20 5b60  sible to call [`
-00017360: 7e64 6174 6173 6574 732e 4461 7461 7365  ~datasets.Datase
-00017370: 742e 6d61 7060 5d20 6166 7465 7220 6361  t.map`] after ca
-00017380: 6c6c 696e 6720 6073 6574 5f66 6f72 6d61  lling `set_forma
-00017390: 7460 2e20 5369 6e63 6520 606d 6170 6020  t`. Since `map` 
-000173a0: 6d61 7920 6164 6420 6e65 7720 636f 6c75  may add new colu
-000173b0: 6d6e 732c 2074 6865 6e20 7468 6520 6c69  mns, then the li
-000173c0: 7374 206f 6620 666f 726d 6174 7465 6420  st of formatted 
-000173d0: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
-000173e0: 6765 7473 2075 7064 6174 6564 2e20 496e  gets updated. In
-000173f0: 2074 6869 7320 6361 7365 2c20 6966 2079   this case, if y
-00017400: 6f75 2061 7070 6c79 2060 6d61 7060 206f  ou apply `map` o
-00017410: 6e20 6120 6461 7461 7365 7420 746f 2061  n a dataset to a
-00017420: 6464 2061 206e 6577 2063 6f6c 756d 6e2c  dd a new column,
-00017430: 2074 6865 6e20 7468 6973 2063 6f6c 756d   then this colum
-00017440: 6e20 7769 6c6c 2062 6520 666f 726d 6174  n will be format
-00017450: 7465 6420 6173 3a0a 0a20 2020 2020 2020  ted as:..       
-00017460: 2020 2020 2060 6060 0a20 2020 2020 2020       ```.       
-00017470: 2020 2020 206e 6577 2066 6f72 6d61 7474       new formatt
-00017480: 6564 2063 6f6c 756d 6e73 203d 2028 616c  ed columns = (al
-00017490: 6c20 636f 6c75 6d6e 7320 2d20 7072 6576  l columns - prev
-000174a0: 696f 7573 6c79 2075 6e66 6f72 6d61 7474  iously unformatt
-000174b0: 6564 2063 6f6c 756d 6e73 290a 2020 2020  ed columns).    
-000174c0: 2020 2020 2020 2020 6060 600a 0a20 2020          ```..   
-000174d0: 2020 2020 2045 7861 6d70 6c65 3a0a 0a20       Example:.. 
-000174e0: 2020 2020 2020 2060 6060 7079 0a20 2020         ```py.   
-000174f0: 2020 2020 203e 3e3e 2066 726f 6d20 6461       >>> from da
-00017500: 7461 7365 7473 2069 6d70 6f72 7420 6c6f  tasets import lo
-00017510: 6164 5f64 6174 6173 6574 0a20 2020 2020  ad_dataset.     
-00017520: 2020 203e 3e3e 2066 726f 6d20 7472 616e     >>> from tran
-00017530: 7366 6f72 6d65 7273 2069 6d70 6f72 7420  sformers import 
-00017540: 4175 746f 546f 6b65 6e69 7a65 720a 2020  AutoTokenizer.  
-00017550: 2020 2020 2020 3e3e 3e20 6473 203d 206c        >>> ds = l
-00017560: 6f61 645f 6461 7461 7365 7428 2272 6f74  oad_dataset("rot
-00017570: 7465 6e5f 746f 6d61 746f 6573 222c 2073  ten_tomatoes", s
-00017580: 706c 6974 3d22 7661 6c69 6461 7469 6f6e  plit="validation
-00017590: 2229 0a20 2020 2020 2020 203e 3e3e 2074  ").        >>> t
-000175a0: 6f6b 656e 697a 6572 203d 2041 7574 6f54  okenizer = AutoT
-000175b0: 6f6b 656e 697a 6572 2e66 726f 6d5f 7072  okenizer.from_pr
-000175c0: 6574 7261 696e 6564 2822 6265 7274 2d62  etrained("bert-b
-000175d0: 6173 652d 6361 7365 6422 290a 2020 2020  ase-cased").    
-000175e0: 2020 2020 3e3e 3e20 6473 203d 2064 732e      >>> ds = ds.
-000175f0: 6d61 7028 6c61 6d62 6461 2078 3a20 746f  map(lambda x: to
-00017600: 6b65 6e69 7a65 7228 785b 2774 6578 7427  kenizer(x['text'
-00017610: 5d2c 2074 7275 6e63 6174 696f 6e3d 5472  ], truncation=Tr
-00017620: 7565 2c20 7061 6464 696e 673d 5472 7565  ue, padding=True
-00017630: 292c 2062 6174 6368 6564 3d54 7275 6529  ), batched=True)
-00017640: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
-00017650: 7365 745f 666f 726d 6174 2874 7970 653d  set_format(type=
-00017660: 276e 756d 7079 272c 2063 6f6c 756d 6e73  'numpy', columns
-00017670: 3d5b 2774 6578 7427 2c20 276c 6162 656c  =['text', 'label
-00017680: 275d 290a 2020 2020 2020 2020 3e3e 3e20  ']).        >>> 
-00017690: 6473 2e66 6f72 6d61 740a 2020 2020 2020  ds.format.      
-000176a0: 2020 7b27 636f 6c75 6d6e 7327 3a20 5b27    {'columns': ['
-000176b0: 696e 7075 745f 6964 7327 2c20 2774 6f6b  input_ids', 'tok
-000176c0: 656e 5f74 7970 655f 6964 7327 2c20 2761  en_type_ids', 'a
-000176d0: 7474 656e 7469 6f6e 5f6d 6173 6b27 2c20  ttention_mask', 
-000176e0: 276c 6162 656c 275d 2c0a 2020 2020 2020  'label'],.      
-000176f0: 2020 2027 666f 726d 6174 5f6b 7761 7267     'format_kwarg
-00017700: 7327 3a20 7b7d 2c0a 2020 2020 2020 2020  s': {},.        
-00017710: 2027 6f75 7470 7574 5f61 6c6c 5f63 6f6c   'output_all_col
-00017720: 756d 6e73 273a 2046 616c 7365 2c0a 2020  umns': False,.  
-00017730: 2020 2020 2020 2027 7479 7065 273a 2027         'type': '
-00017740: 6e75 6d70 7927 7d0a 2020 2020 2020 2020  numpy'}.        
-00017750: 6060 600a 2020 2020 2020 2020 2222 220a  ```.        """.
-00017760: 2020 2020 2020 2020 666f 726d 6174 5f6b          format_k
-00017770: 7761 7267 732e 7570 6461 7465 2866 6f72  wargs.update(for
-00017780: 6d61 745f 6b77 6172 6773 2e70 6f70 2822  mat_kwargs.pop("
-00017790: 666f 726d 6174 5f6b 7761 7267 7322 2c20  format_kwargs", 
-000177a0: 7b7d 2929 2020 2320 616c 6c6f 7720 746f  {}))  # allow to
-000177b0: 2075 7365 2073 656c 662e 7365 745f 666f   use self.set_fo
-000177c0: 726d 6174 2873 656c 662e 666f 726d 6174  rmat(self.format
-000177d0: 290a 0a20 2020 2020 2020 2023 2043 6865  )..        # Che
-000177e0: 636b 2074 6861 7420 7468 6520 666f 726d  ck that the form
-000177f0: 6174 5f74 7970 6520 616e 6420 666f 726d  at_type and form
-00017800: 6174 5f6b 7761 7267 7320 6172 6520 7661  at_kwargs are va
-00017810: 6c69 6420 616e 6420 6d61 6b65 2069 7420  lid and make it 
-00017820: 706f 7373 6962 6c65 2074 6f20 6861 7665  possible to have
-00017830: 2061 2046 6f72 6d61 7474 6572 0a20 2020   a Formatter.   
-00017840: 2020 2020 2074 7970 6520 3d20 6765 745f       type = get_
-00017850: 666f 726d 6174 5f74 7970 655f 6672 6f6d  format_type_from
-00017860: 5f61 6c69 6173 2874 7970 6529 0a20 2020  _alias(type).   
-00017870: 2020 2020 205f 203d 2067 6574 5f66 6f72       _ = get_for
-00017880: 6d61 7474 6572 2874 7970 652c 2066 6561  matter(type, fea
-00017890: 7475 7265 733d 7365 6c66 2e66 6561 7475  tures=self.featu
-000178a0: 7265 732c 202a 2a66 6f72 6d61 745f 6b77  res, **format_kw
-000178b0: 6172 6773 290a 0a20 2020 2020 2020 2023  args)..        #
-000178c0: 2043 6865 636b 2066 696c 7465 7220 636f   Check filter co
-000178d0: 6c75 6d6e 0a20 2020 2020 2020 2069 6620  lumn.        if 
-000178e0: 6973 696e 7374 616e 6365 2863 6f6c 756d  isinstance(colum
-000178f0: 6e73 2c20 7374 7229 3a0a 2020 2020 2020  ns, str):.      
-00017900: 2020 2020 2020 636f 6c75 6d6e 7320 3d20        columns = 
-00017910: 5b63 6f6c 756d 6e73 5d0a 2020 2020 2020  [columns].      
-00017920: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00017930: 636f 6c75 6d6e 732c 2074 7570 6c65 293a  columns, tuple):
-00017940: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00017950: 756d 6e73 203d 206c 6973 7428 636f 6c75  umns = list(colu
-00017960: 6d6e 7329 0a20 2020 2020 2020 2069 6620  mns).        if 
-00017970: 636f 6c75 6d6e 7320 6973 206e 6f74 204e  columns is not N
-00017980: 6f6e 6520 616e 6420 616e 7928 636f 6c20  one and any(col 
-00017990: 6e6f 7420 696e 2073 656c 662e 5f64 6174  not in self._dat
-000179a0: 612e 636f 6c75 6d6e 5f6e 616d 6573 2066  a.column_names f
-000179b0: 6f72 2063 6f6c 2069 6e20 636f 6c75 6d6e  or col in column
-000179c0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-000179d0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000179e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000179f0: 2020 6622 436f 6c75 6d6e 7320 7b6c 6973    f"Columns {lis
-00017a00: 7428 6669 6c74 6572 286c 616d 6264 6120  t(filter(lambda 
-00017a10: 636f 6c3a 2063 6f6c 206e 6f74 2069 6e20  col: col not in 
-00017a20: 7365 6c66 2e5f 6461 7461 2e63 6f6c 756d  self._data.colum
-00017a30: 6e5f 6e61 6d65 732c 2063 6f6c 756d 6e73  n_names, columns
-00017a40: 2929 7d20 6e6f 7420 696e 2074 6865 2064  ))} not in the d
-00017a50: 6174 6173 6574 2e20 4375 7272 656e 7420  ataset. Current 
-00017a60: 636f 6c75 6d6e 7320 696e 2074 6865 2064  columns in the d
-00017a70: 6174 6173 6574 3a20 7b73 656c 662e 5f64  ataset: {self._d
-00017a80: 6174 612e 636f 6c75 6d6e 5f6e 616d 6573  ata.column_names
-00017a90: 7d22 0a20 2020 2020 2020 2020 2020 2029  }".            )
-00017aa0: 0a20 2020 2020 2020 2069 6620 636f 6c75  .        if colu
-00017ab0: 6d6e 7320 6973 206e 6f74 204e 6f6e 653a  mns is not None:
-00017ac0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00017ad0: 756d 6e73 203d 2063 6f6c 756d 6e73 2e63  umns = columns.c
-00017ae0: 6f70 7928 2920 2023 2045 6e73 7572 6573  opy()  # Ensures
-00017af0: 206d 6f64 6966 6963 6174 696f 6e73 206d   modifications m
-00017b00: 6164 6520 746f 2074 6865 206c 6973 7420  ade to the list 
-00017b10: 6166 7465 7220 7468 6973 2063 616c 6c20  after this call 
-00017b20: 646f 6e27 7420 6361 7573 6520 6275 6773  don't cause bugs
-00017b30: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00017b40: 666f 726d 6174 5f74 7970 6520 3d20 7479  format_type = ty
-00017b50: 7065 0a20 2020 2020 2020 2073 656c 662e  pe.        self.
-00017b60: 5f66 6f72 6d61 745f 6b77 6172 6773 203d  _format_kwargs =
-00017b70: 2066 6f72 6d61 745f 6b77 6172 6773 0a20   format_kwargs. 
-00017b80: 2020 2020 2020 2073 656c 662e 5f66 6f72         self._for
-00017b90: 6d61 745f 636f 6c75 6d6e 7320 3d20 636f  mat_columns = co
-00017ba0: 6c75 6d6e 730a 2020 2020 2020 2020 7365  lumns.        se
-00017bb0: 6c66 2e5f 6f75 7470 7574 5f61 6c6c 5f63  lf._output_all_c
-00017bc0: 6f6c 756d 6e73 203d 206f 7574 7075 745f  olumns = output_
-00017bd0: 616c 6c5f 636f 6c75 6d6e 730a 2020 2020  all_columns.    
-00017be0: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
-00017bf0: 280a 2020 2020 2020 2020 2020 2020 2253  (.            "S
-00017c00: 6574 205f 5f67 6574 6974 656d 5f5f 286b  et __getitem__(k
-00017c10: 6579 2920 6f75 7470 7574 2074 7970 6520  ey) output type 
-00017c20: 746f 2025 7320 666f 7220 2573 2063 6f6c  to %s for %s col
-00017c30: 756d 6e73 2022 0a20 2020 2020 2020 2020  umns ".         
-00017c40: 2020 2022 2028 7768 656e 206b 6579 2069     " (when key i
-00017c50: 7320 696e 7420 6f72 2073 6c69 6365 2920  s int or slice) 
-00017c60: 616e 6420 2573 206f 7574 7075 7420 6f74  and %s output ot
-00017c70: 6865 7220 2875 6e2d 666f 726d 6174 7465  her (un-formatte
-00017c80: 6429 2063 6f6c 756d 6e73 2e22 2c0a 2020  d) columns.",.  
-00017c90: 2020 2020 2020 2020 2020 2270 7974 686f            "pytho
-00017ca0: 6e20 6f62 6a65 6374 7322 2069 6620 7479  n objects" if ty
-00017cb0: 7065 2069 7320 4e6f 6e65 2065 6c73 6520  pe is None else 
-00017cc0: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-00017cd0: 2020 226e 6f22 2069 6620 636f 6c75 6d6e    "no" if column
-00017ce0: 7320 6973 204e 6f6e 6520 656c 7365 2073  s is None else s
-00017cf0: 7472 2863 6f6c 756d 6e73 292c 0a20 2020  tr(columns),.   
-00017d00: 2020 2020 2020 2020 2022 646f 2220 6966           "do" if
-00017d10: 206f 7574 7075 745f 616c 6c5f 636f 6c75   output_all_colu
-00017d20: 6d6e 7320 656c 7365 2022 646f 6e27 7422  mns else "don't"
-00017d30: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00017d40: 2064 6566 2072 6573 6574 5f66 6f72 6d61   def reset_forma
-00017d50: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
-00017d60: 2022 2222 5265 7365 7420 605f 5f67 6574   """Reset `__get
-00017d70: 6974 656d 5f5f 6020 7265 7475 726e 2066  item__` return f
-00017d80: 6f72 6d61 7420 746f 2070 7974 686f 6e20  ormat to python 
-00017d90: 6f62 6a65 6374 7320 616e 6420 616c 6c20  objects and all 
-00017da0: 636f 6c75 6d6e 732e 0a0a 2020 2020 2020  columns...      
-00017db0: 2020 5361 6d65 2061 7320 6073 656c 662e    Same as `self.
-00017dc0: 7365 745f 666f 726d 6174 2829 600a 0a20  set_format()`.. 
-00017dd0: 2020 2020 2020 2045 7861 6d70 6c65 3a0a         Example:.
-00017de0: 0a20 2020 2020 2020 2060 6060 7079 0a20  .        ```py. 
-00017df0: 2020 2020 2020 203e 3e3e 2066 726f 6d20         >>> from 
-00017e00: 6461 7461 7365 7473 2069 6d70 6f72 7420  datasets import 
-00017e10: 6c6f 6164 5f64 6174 6173 6574 0a20 2020  load_dataset.   
-00017e20: 2020 2020 203e 3e3e 2066 726f 6d20 7472       >>> from tr
-00017e30: 616e 7366 6f72 6d65 7273 2069 6d70 6f72  ansformers impor
-00017e40: 7420 4175 746f 546f 6b65 6e69 7a65 720a  t AutoTokenizer.
-00017e50: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
-00017e60: 206c 6f61 645f 6461 7461 7365 7428 2272   load_dataset("r
-00017e70: 6f74 7465 6e5f 746f 6d61 746f 6573 222c  otten_tomatoes",
-00017e80: 2073 706c 6974 3d22 7661 6c69 6461 7469   split="validati
-00017e90: 6f6e 2229 0a20 2020 2020 2020 203e 3e3e  on").        >>>
-00017ea0: 2074 6f6b 656e 697a 6572 203d 2041 7574   tokenizer = Aut
-00017eb0: 6f54 6f6b 656e 697a 6572 2e66 726f 6d5f  oTokenizer.from_
-00017ec0: 7072 6574 7261 696e 6564 2822 6265 7274  pretrained("bert
-00017ed0: 2d62 6173 652d 6361 7365 6422 290a 2020  -base-cased").  
-00017ee0: 2020 2020 2020 3e3e 3e20 6473 203d 2064        >>> ds = d
-00017ef0: 732e 6d61 7028 6c61 6d62 6461 2078 3a20  s.map(lambda x: 
-00017f00: 746f 6b65 6e69 7a65 7228 785b 2774 6578  tokenizer(x['tex
-00017f10: 7427 5d2c 2074 7275 6e63 6174 696f 6e3d  t'], truncation=
-00017f20: 5472 7565 2c20 7061 6464 696e 673d 5472  True, padding=Tr
-00017f30: 7565 292c 2062 6174 6368 6564 3d54 7275  ue), batched=Tru
-00017f40: 6529 0a20 2020 2020 2020 203e 3e3e 2064  e).        >>> d
-00017f50: 732e 7365 745f 666f 726d 6174 2874 7970  s.set_format(typ
-00017f60: 653d 276e 756d 7079 272c 2063 6f6c 756d  e='numpy', colum
-00017f70: 6e73 3d5b 2769 6e70 7574 5f69 6473 272c  ns=['input_ids',
-00017f80: 2027 746f 6b65 6e5f 7479 7065 5f69 6473   'token_type_ids
-00017f90: 272c 2027 6174 7465 6e74 696f 6e5f 6d61  ', 'attention_ma
-00017fa0: 736b 272c 2027 6c61 6265 6c27 5d29 0a20  sk', 'label']). 
-00017fb0: 2020 2020 2020 203e 3e3e 2064 732e 666f         >>> ds.fo
-00017fc0: 726d 6174 0a20 2020 2020 2020 207b 2763  rmat.        {'c
-00017fd0: 6f6c 756d 6e73 273a 205b 2769 6e70 7574  olumns': ['input
-00017fe0: 5f69 6473 272c 2027 746f 6b65 6e5f 7479  _ids', 'token_ty
-00017ff0: 7065 5f69 6473 272c 2027 6174 7465 6e74  pe_ids', 'attent
-00018000: 696f 6e5f 6d61 736b 272c 2027 6c61 6265  ion_mask', 'labe
-00018010: 6c27 5d2c 0a20 2020 2020 2020 2020 2766  l'],.         'f
-00018020: 6f72 6d61 745f 6b77 6172 6773 273a 207b  ormat_kwargs': {
-00018030: 7d2c 0a20 2020 2020 2020 2020 276f 7574  },.         'out
-00018040: 7075 745f 616c 6c5f 636f 6c75 6d6e 7327  put_all_columns'
-00018050: 3a20 4661 6c73 652c 0a20 2020 2020 2020  : False,.       
-00018060: 2020 2774 7970 6527 3a20 276e 756d 7079    'type': 'numpy
-00018070: 277d 0a20 2020 2020 2020 203e 3e3e 2064  '}.        >>> d
-00018080: 732e 7265 7365 745f 666f 726d 6174 2829  s.reset_format()
-00018090: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
-000180a0: 666f 726d 6174 0a20 2020 2020 2020 207b  format.        {
-000180b0: 2763 6f6c 756d 6e73 273a 205b 2774 6578  'columns': ['tex
-000180c0: 7427 2c20 276c 6162 656c 272c 2027 696e  t', 'label', 'in
-000180d0: 7075 745f 6964 7327 2c20 2774 6f6b 656e  put_ids', 'token
-000180e0: 5f74 7970 655f 6964 7327 2c20 2761 7474  _type_ids', 'att
-000180f0: 656e 7469 6f6e 5f6d 6173 6b27 5d2c 0a20  ention_mask'],. 
-00018100: 2020 2020 2020 2020 2766 6f72 6d61 745f          'format_
-00018110: 6b77 6172 6773 273a 207b 7d2c 0a20 2020  kwargs': {},.   
-00018120: 2020 2020 2020 276f 7574 7075 745f 616c        'output_al
-00018130: 6c5f 636f 6c75 6d6e 7327 3a20 4661 6c73  l_columns': Fals
-00018140: 652c 0a20 2020 2020 2020 2020 2774 7970  e,.         'typ
-00018150: 6527 3a20 4e6f 6e65 7d0a 2020 2020 2020  e': None}.      
-00018160: 2020 6060 600a 2020 2020 2020 2020 2222    ```.        ""
-00018170: 220a 2020 2020 2020 2020 7365 6c66 2e73  ".        self.s
-00018180: 6574 5f66 6f72 6d61 7428 290a 0a20 2020  et_format()..   
-00018190: 2064 6566 2073 6574 5f74 7261 6e73 666f   def set_transfo
-000181a0: 726d 280a 2020 2020 2020 2020 7365 6c66  rm(.        self
-000181b0: 2c0a 2020 2020 2020 2020 7472 616e 7366  ,.        transf
-000181c0: 6f72 6d3a 204f 7074 696f 6e61 6c5b 4361  orm: Optional[Ca
-000181d0: 6c6c 6162 6c65 5d2c 0a20 2020 2020 2020  llable],.       
-000181e0: 2063 6f6c 756d 6e73 3a20 4f70 7469 6f6e   columns: Option
-000181f0: 616c 5b4c 6973 745d 203d 204e 6f6e 652c  al[List] = None,
-00018200: 0a20 2020 2020 2020 206f 7574 7075 745f  .        output_
-00018210: 616c 6c5f 636f 6c75 6d6e 733a 2062 6f6f  all_columns: boo
-00018220: 6c20 3d20 4661 6c73 652c 0a20 2020 2029  l = False,.    )
-00018230: 3a0a 2020 2020 2020 2020 2222 2253 6574  :.        """Set
-00018240: 2060 5f5f 6765 7469 7465 6d5f 5f60 2072   `__getitem__` r
-00018250: 6574 7572 6e20 666f 726d 6174 2075 7369  eturn format usi
-00018260: 6e67 2074 6869 7320 7472 616e 7366 6f72  ng this transfor
-00018270: 6d2e 2054 6865 2074 7261 6e73 666f 726d  m. The transform
-00018280: 2069 7320 6170 706c 6965 6420 6f6e 2d74   is applied on-t
-00018290: 6865 2d66 6c79 206f 6e20 6261 7463 6865  he-fly on batche
-000182a0: 7320 7768 656e 2060 5f5f 6765 7469 7465  s when `__getite
-000182b0: 6d5f 5f60 2069 7320 6361 6c6c 6564 2e0a  m__` is called..
-000182c0: 2020 2020 2020 2020 4173 205b 607e 6461          As [`~da
-000182d0: 7461 7365 7473 2e44 6174 6173 6574 2e73  tasets.Dataset.s
-000182e0: 6574 5f66 6f72 6d61 7460 5d2c 2074 6869  et_format`], thi
-000182f0: 7320 6361 6e20 6265 2072 6573 6574 2075  s can be reset u
-00018300: 7369 6e67 205b 607e 6461 7461 7365 7473  sing [`~datasets
-00018310: 2e44 6174 6173 6574 2e72 6573 6574 5f66  .Dataset.reset_f
-00018320: 6f72 6d61 7460 5d2e 0a0a 2020 2020 2020  ormat`]...      
-00018330: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00018340: 2020 2020 7472 616e 7366 6f72 6d20 2860      transform (`
-00018350: 4361 6c6c 6162 6c65 602c 202a 6f70 7469  Callable`, *opti
-00018360: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
-00018370: 2020 2020 2020 2020 5573 6572 2d64 6566          User-def
-00018380: 696e 6564 2066 6f72 6d61 7474 696e 6720  ined formatting 
-00018390: 7472 616e 7366 6f72 6d2c 2072 6570 6c61  transform, repla
-000183a0: 6365 7320 7468 6520 666f 726d 6174 2064  ces the format d
-000183b0: 6566 696e 6564 2062 7920 5b60 7e64 6174  efined by [`~dat
-000183c0: 6173 6574 732e 4461 7461 7365 742e 7365  asets.Dataset.se
-000183d0: 745f 666f 726d 6174 605d 2e0a 2020 2020  t_format`]..    
-000183e0: 2020 2020 2020 2020 2020 2020 4120 666f              A fo
-000183f0: 726d 6174 7469 6e67 2066 756e 6374 696f  rmatting functio
-00018400: 6e20 6973 2061 2063 616c 6c61 626c 6520  n is a callable 
-00018410: 7468 6174 2074 616b 6573 2061 2062 6174  that takes a bat
-00018420: 6368 2028 6173 2061 2060 6469 6374 6029  ch (as a `dict`)
-00018430: 2061 7320 696e 7075 7420 616e 6420 7265   as input and re
-00018440: 7475 726e 7320 6120 6261 7463 682e 0a20  turns a batch.. 
-00018450: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00018460: 6869 7320 6675 6e63 7469 6f6e 2069 7320  his function is 
-00018470: 6170 706c 6965 6420 7269 6768 7420 6265  applied right be
-00018480: 666f 7265 2072 6574 7572 6e69 6e67 2074  fore returning t
-00018490: 6865 206f 626a 6563 7473 2069 6e20 605f  he objects in `_
-000184a0: 5f67 6574 6974 656d 5f5f 602e 0a20 2020  _getitem__`..   
-000184b0: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
-000184c0: 2028 604c 6973 745b 7374 725d 602c 202a   (`List[str]`, *
-000184d0: 6f70 7469 6f6e 616c 2a29 3a0a 2020 2020  optional*):.    
-000184e0: 2020 2020 2020 2020 2020 2020 436f 6c75              Colu
-000184f0: 6d6e 7320 746f 2066 6f72 6d61 7420 696e  mns to format in
-00018500: 2074 6865 206f 7574 7075 742e 0a20 2020   the output..   
-00018510: 2020 2020 2020 2020 2020 2020 2049 6620               If 
-00018520: 7370 6563 6966 6965 642c 2074 6865 6e20  specified, then 
-00018530: 7468 6520 696e 7075 7420 6261 7463 6820  the input batch 
-00018540: 6f66 2074 6865 2074 7261 6e73 666f 726d  of the transform
-00018550: 206f 6e6c 7920 636f 6e74 6169 6e73 2074   only contains t
-00018560: 686f 7365 2063 6f6c 756d 6e73 2e0a 2020  hose columns..  
-00018570: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-00018580: 5f61 6c6c 5f63 6f6c 756d 6e73 2028 6062  _all_columns (`b
-00018590: 6f6f 6c60 2c20 6465 6661 756c 7473 2074  ool`, defaults t
-000185a0: 6f20 6046 616c 7365 6029 3a0a 2020 2020  o `False`):.    
-000185b0: 2020 2020 2020 2020 2020 2020 4b65 6570              Keep
-000185c0: 2075 6e2d 666f 726d 6174 7465 6420 636f   un-formatted co
-000185d0: 6c75 6d6e 7320 6173 2077 656c 6c20 696e  lumns as well in
-000185e0: 2074 6865 206f 7574 7075 7420 2861 7320   the output (as 
-000185f0: 7079 7468 6f6e 206f 626a 6563 7473 292e  python objects).
-00018600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018610: 2049 6620 7365 7420 746f 2054 7275 652c   If set to True,
-00018620: 2074 6865 6e20 7468 6520 6f74 6865 7220   then the other 
-00018630: 756e 2d66 6f72 6d61 7474 6564 2063 6f6c  un-formatted col
-00018640: 756d 6e73 2061 7265 206b 6570 7420 7769  umns are kept wi
-00018650: 7468 2074 6865 206f 7574 7075 7420 6f66  th the output of
-00018660: 2074 6865 2074 7261 6e73 666f 726d 2e0a   the transform..
-00018670: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-00018680: 3a0a 0a20 2020 2020 2020 2060 6060 7079  :..        ```py
-00018690: 0a20 2020 2020 2020 203e 3e3e 2066 726f  .        >>> fro
-000186a0: 6d20 6461 7461 7365 7473 2069 6d70 6f72  m datasets impor
-000186b0: 7420 6c6f 6164 5f64 6174 6173 6574 0a20  t load_dataset. 
-000186c0: 2020 2020 2020 203e 3e3e 2066 726f 6d20         >>> from 
-000186d0: 7472 616e 7366 6f72 6d65 7273 2069 6d70  transformers imp
-000186e0: 6f72 7420 4175 746f 546f 6b65 6e69 7a65  ort AutoTokenize
-000186f0: 720a 2020 2020 2020 2020 3e3e 3e20 6473  r.        >>> ds
-00018700: 203d 206c 6f61 645f 6461 7461 7365 7428   = load_dataset(
-00018710: 2272 6f74 7465 6e5f 746f 6d61 746f 6573  "rotten_tomatoes
-00018720: 222c 2073 706c 6974 3d22 7661 6c69 6461  ", split="valida
-00018730: 7469 6f6e 2229 0a20 2020 2020 2020 203e  tion").        >
-00018740: 3e3e 2074 6f6b 656e 697a 6572 203d 2041  >> tokenizer = A
-00018750: 7574 6f54 6f6b 656e 697a 6572 2e66 726f  utoTokenizer.fro
-00018760: 6d5f 7072 6574 7261 696e 6564 2827 6265  m_pretrained('be
-00018770: 7274 2d62 6173 652d 756e 6361 7365 6427  rt-base-uncased'
-00018780: 290a 2020 2020 2020 2020 3e3e 3e20 6465  ).        >>> de
-00018790: 6620 656e 636f 6465 2862 6174 6368 293a  f encode(batch):
-000187a0: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
-000187b0: 2072 6574 7572 6e20 746f 6b65 6e69 7a65   return tokenize
-000187c0: 7228 6261 7463 685b 2774 6578 7427 5d2c  r(batch['text'],
-000187d0: 2070 6164 6469 6e67 3d54 7275 652c 2074   padding=True, t
-000187e0: 7275 6e63 6174 696f 6e3d 5472 7565 2c20  runcation=True, 
-000187f0: 7265 7475 726e 5f74 656e 736f 7273 3d27  return_tensors='
-00018800: 7074 2729 0a20 2020 2020 2020 203e 3e3e  pt').        >>>
-00018810: 2064 732e 7365 745f 7472 616e 7366 6f72   ds.set_transfor
-00018820: 6d28 656e 636f 6465 290a 2020 2020 2020  m(encode).      
-00018830: 2020 3e3e 3e20 6473 5b30 5d0a 2020 2020    >>> ds[0].    
-00018840: 2020 2020 7b27 6174 7465 6e74 696f 6e5f      {'attention_
-00018850: 6d61 736b 273a 2074 656e 736f 7228 5b31  mask': tensor([1
-00018860: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00018870: 2031 2c20 312c 2031 2c20 312c 2031 2c20   1, 1, 1, 1, 1, 
-00018880: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
-00018890: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-000188a0: 2031 2c20 312c 0a20 2020 2020 2020 2020   1, 1,.         
-000188b0: 312c 2031 5d29 2c0a 2020 2020 2020 2020  1, 1]),.        
-000188c0: 2027 696e 7075 745f 6964 7327 3a20 7465   'input_ids': te
-000188d0: 6e73 6f72 285b 2020 3130 312c 2032 3933  nsor([  101, 293
-000188e0: 3533 2c20 2032 3133 352c 2031 3531 3032  53,  2135, 15102
-000188f0: 2c20 2031 3939 362c 2020 3934 3238 2c20  ,  1996,  9428, 
-00018900: 3230 3836 382c 2020 3238 3930 2c20 2038  20868,  2890,  8
-00018910: 3636 332c 2020 3638 3935 2c0a 2020 2020  663,  6895,.    
-00018920: 2020 2020 2020 2020 2020 2020 2032 3034               204
-00018930: 3730 2c20 2032 3537 312c 2020 3336 3633  70,  2571,  3663
-00018940: 2c20 2032 3039 302c 2020 3436 3033 2c20  ,  2090,  4603, 
-00018950: 2033 3031 372c 2020 3330 3038 2c20 2031   3017,  3008,  1
-00018960: 3939 382c 2020 3230 3337 2c20 3234 3231  998,  2037, 2421
-00018970: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
-00018980: 2020 2020 3536 3337 2c20 2031 3939 382c      5637,  1998,
-00018990: 2031 3136 3930 2c20 2032 3333 362c 2020   11690,  2336,  
-000189a0: 3130 3132 2c20 2020 3130 325d 292c 0a20  1012,   102]),. 
-000189b0: 2020 2020 2020 2020 2774 6f6b 656e 5f74          'token_t
-000189c0: 7970 655f 6964 7327 3a20 7465 6e73 6f72  ype_ids': tensor
-000189d0: 285b 302c 2030 2c20 302c 2030 2c20 302c  ([0, 0, 0, 0, 0,
-000189e0: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-000189f0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00018a00: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00018a10: 2030 2c20 302c 2030 2c0a 2020 2020 2020   0, 0, 0,.      
-00018a20: 2020 2020 2020 2020 2020 2030 2c20 305d             0, 0]
-00018a30: 297d 0a20 2020 2020 2020 2060 6060 0a20  )}.        ```. 
-00018a40: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00018a50: 2020 2073 656c 662e 7365 745f 666f 726d     self.set_form
-00018a60: 6174 2822 6375 7374 6f6d 222c 2063 6f6c  at("custom", col
-00018a70: 756d 6e73 3d63 6f6c 756d 6e73 2c20 6f75  umns=columns, ou
-00018a80: 7470 7574 5f61 6c6c 5f63 6f6c 756d 6e73  tput_all_columns
-00018a90: 3d6f 7574 7075 745f 616c 6c5f 636f 6c75  =output_all_colu
-00018aa0: 6d6e 732c 2074 7261 6e73 666f 726d 3d74  mns, transform=t
-00018ab0: 7261 6e73 666f 726d 290a 0a20 2020 2064  ransform)..    d
-00018ac0: 6566 2077 6974 685f 666f 726d 6174 280a  ef with_format(.
-00018ad0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00018ae0: 2020 2020 2020 7479 7065 3a20 4f70 7469        type: Opti
-00018af0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-00018b00: 2c0a 2020 2020 2020 2020 636f 6c75 6d6e  ,.        column
-00018b10: 733a 204f 7074 696f 6e61 6c5b 4c69 7374  s: Optional[List
-00018b20: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00018b30: 2020 6f75 7470 7574 5f61 6c6c 5f63 6f6c    output_all_col
-00018b40: 756d 6e73 3a20 626f 6f6c 203d 2046 616c  umns: bool = Fal
-00018b50: 7365 2c0a 2020 2020 2020 2020 2a2a 666f  se,.        **fo
-00018b60: 726d 6174 5f6b 7761 7267 732c 0a20 2020  rmat_kwargs,.   
-00018b70: 2029 3a0a 2020 2020 2020 2020 2222 2253   ):.        """S
-00018b80: 6574 2060 5f5f 6765 7469 7465 6d5f 5f60  et `__getitem__`
-00018b90: 2072 6574 7572 6e20 666f 726d 6174 2028   return format (
-00018ba0: 7479 7065 2061 6e64 2063 6f6c 756d 6e73  type and columns
-00018bb0: 292e 2054 6865 2064 6174 6120 666f 726d  ). The data form
-00018bc0: 6174 7469 6e67 2069 7320 6170 706c 6965  atting is applie
-00018bd0: 6420 6f6e 2d74 6865 2d66 6c79 2e0a 2020  d on-the-fly..  
-00018be0: 2020 2020 2020 5468 6520 666f 726d 6174        The format
-00018bf0: 2060 7479 7065 6020 2866 6f72 2065 7861   `type` (for exa
-00018c00: 6d70 6c65 2022 6e75 6d70 7922 2920 6973  mple "numpy") is
-00018c10: 2075 7365 6420 746f 2066 6f72 6d61 7420   used to format 
-00018c20: 6261 7463 6865 7320 7768 656e 2075 7369  batches when usi
-00018c30: 6e67 2060 5f5f 6765 7469 7465 6d5f 5f60  ng `__getitem__`
-00018c40: 2e0a 0a20 2020 2020 2020 2049 7427 7320  ...        It's 
-00018c50: 616c 736f 2070 6f73 7369 626c 6520 746f  also possible to
-00018c60: 2075 7365 2063 7573 746f 6d20 7472 616e   use custom tran
-00018c70: 7366 6f72 6d73 2066 6f72 2066 6f72 6d61  sforms for forma
-00018c80: 7474 696e 6720 7573 696e 6720 5b60 7e64  tting using [`~d
-00018c90: 6174 6173 6574 732e 4461 7461 7365 742e  atasets.Dataset.
-00018ca0: 7769 7468 5f74 7261 6e73 666f 726d 605d  with_transform`]
-00018cb0: 2e0a 0a20 2020 2020 2020 2043 6f6e 7472  ...        Contr
-00018cc0: 6172 7920 746f 205b 607e 6461 7461 7365  ary to [`~datase
-00018cd0: 7473 2e44 6174 6173 6574 2e73 6574 5f66  ts.Dataset.set_f
-00018ce0: 6f72 6d61 7460 5d2c 2060 7769 7468 5f66  ormat`], `with_f
-00018cf0: 6f72 6d61 7460 2072 6574 7572 6e73 2061  ormat` returns a
-00018d00: 206e 6577 205b 6044 6174 6173 6574 605d   new [`Dataset`]
-00018d10: 206f 626a 6563 742e 0a0a 2020 2020 2020   object...      
-00018d20: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00018d30: 2020 2020 7479 7065 2028 6073 7472 602c      type (`str`,
-00018d40: 202a 6f70 7469 6f6e 616c 2a29 3a0a 2020   *optional*):.  
-00018d50: 2020 2020 2020 2020 2020 2020 2020 4569                Ei
-00018d60: 7468 6572 206f 7574 7075 7420 7479 7065  ther output type
-00018d70: 2073 656c 6563 7465 6420 696e 2060 5b4e   selected in `[N
-00018d80: 6f6e 652c 2027 6e75 6d70 7927 2c20 2774  one, 'numpy', 't
-00018d90: 6f72 6368 272c 2027 7465 6e73 6f72 666c  orch', 'tensorfl
-00018da0: 6f77 272c 2027 7061 6e64 6173 272c 2027  ow', 'pandas', '
-00018db0: 6172 726f 7727 5d60 2e0a 2020 2020 2020  arrow']`..      
-00018dc0: 2020 2020 2020 2020 2020 604e 6f6e 6560            `None`
-00018dd0: 206d 6561 6e73 2060 5f5f 6765 7469 7465   means `__getite
-00018de0: 6d5f 5f60 2072 6574 7572 6e73 2070 7974  m__` returns pyt
-00018df0: 686f 6e20 6f62 6a65 6374 7320 2864 6566  hon objects (def
-00018e00: 6175 6c74 292e 0a20 2020 2020 2020 2020  ault)..         
-00018e10: 2020 2063 6f6c 756d 6e73 2028 604c 6973     columns (`Lis
-00018e20: 745b 7374 725d 602c 202a 6f70 7469 6f6e  t[str]`, *option
-00018e30: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
-00018e40: 2020 2020 2020 436f 6c75 6d6e 7320 746f        Columns to
-00018e50: 2066 6f72 6d61 7420 696e 2074 6865 206f   format in the o
-00018e60: 7574 7075 742e 0a20 2020 2020 2020 2020  utput..         
-00018e70: 2020 2020 2020 2060 4e6f 6e65 6020 6d65         `None` me
-00018e80: 616e 7320 605f 5f67 6574 6974 656d 5f5f  ans `__getitem__
-00018e90: 6020 7265 7475 726e 7320 616c 6c20 636f  ` returns all co
-00018ea0: 6c75 6d6e 7320 2864 6566 6175 6c74 292e  lumns (default).
-00018eb0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-00018ec0: 7075 745f 616c 6c5f 636f 6c75 6d6e 7320  put_all_columns 
-00018ed0: 2860 626f 6f6c 602c 2064 6566 6175 6c74  (`bool`, default
-00018ee0: 7320 746f 2060 4661 6c73 6560 293a 0a20  s to `False`):. 
-00018ef0: 2020 2020 2020 2020 2020 2020 2020 204b                 K
-00018f00: 6565 7020 756e 2d66 6f72 6d61 7474 6564  eep un-formatted
-00018f10: 2063 6f6c 756d 6e73 2061 7320 7765 6c6c   columns as well
-00018f20: 2069 6e20 7468 6520 6f75 7470 7574 2028   in the output (
-00018f30: 6173 2070 7974 686f 6e20 6f62 6a65 6374  as python object
-00018f40: 7329 2e0a 2020 2020 2020 2020 2020 2020  s)..            
-00018f50: 2a2a 666f 726d 6174 5f6b 7761 7267 7320  **format_kwargs 
-00018f60: 2861 6464 6974 696f 6e61 6c20 6b65 7977  (additional keyw
-00018f70: 6f72 6420 6172 6775 6d65 6e74 7329 3a0a  ord arguments):.
-00018f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f90: 4b65 7977 6f72 6473 2061 7267 756d 656e  Keywords argumen
-00018fa0: 7473 2070 6173 7365 6420 746f 2074 6865  ts passed to the
-00018fb0: 2063 6f6e 7665 7274 2066 756e 6374 696f   convert functio
-00018fc0: 6e20 6c69 6b65 2060 6e70 2e61 7272 6179  n like `np.array
-00018fd0: 602c 2060 746f 7263 682e 7465 6e73 6f72  `, `torch.tensor
-00018fe0: 6020 6f72 2060 7465 6e73 6f72 666c 6f77  ` or `tensorflow
-00018ff0: 2e72 6167 6765 642e 636f 6e73 7461 6e74  .ragged.constant
-00019000: 602e 0a0a 2020 2020 2020 2020 4578 616d  `...        Exam
-00019010: 706c 653a 0a0a 2020 2020 2020 2020 6060  ple:..        ``
-00019020: 6070 790a 2020 2020 2020 2020 3e3e 3e20  `py.        >>> 
-00019030: 6672 6f6d 2064 6174 6173 6574 7320 696d  from datasets im
-00019040: 706f 7274 206c 6f61 645f 6461 7461 7365  port load_datase
-00019050: 740a 2020 2020 2020 2020 3e3e 3e20 6672  t.        >>> fr
-00019060: 6f6d 2074 7261 6e73 666f 726d 6572 7320  om transformers 
-00019070: 696d 706f 7274 2041 7574 6f54 6f6b 656e  import AutoToken
-00019080: 697a 6572 0a20 2020 2020 2020 203e 3e3e  izer.        >>>
-00019090: 2064 7320 3d20 6c6f 6164 5f64 6174 6173   ds = load_datas
-000190a0: 6574 2822 726f 7474 656e 5f74 6f6d 6174  et("rotten_tomat
-000190b0: 6f65 7322 2c20 7370 6c69 743d 2276 616c  oes", split="val
-000190c0: 6964 6174 696f 6e22 290a 2020 2020 2020  idation").      
-000190d0: 2020 3e3e 3e20 746f 6b65 6e69 7a65 7220    >>> tokenizer 
-000190e0: 3d20 4175 746f 546f 6b65 6e69 7a65 722e  = AutoTokenizer.
-000190f0: 6672 6f6d 5f70 7265 7472 6169 6e65 6428  from_pretrained(
-00019100: 2262 6572 742d 6261 7365 2d63 6173 6564  "bert-base-cased
-00019110: 2229 0a20 2020 2020 2020 203e 3e3e 2064  ").        >>> d
-00019120: 7320 3d20 6473 2e6d 6170 286c 616d 6264  s = ds.map(lambd
-00019130: 6120 783a 2074 6f6b 656e 697a 6572 2878  a x: tokenizer(x
-00019140: 5b27 7465 7874 275d 2c20 7472 756e 6361  ['text'], trunca
-00019150: 7469 6f6e 3d54 7275 652c 2070 6164 6469  tion=True, paddi
-00019160: 6e67 3d54 7275 6529 2c20 6261 7463 6865  ng=True), batche
-00019170: 643d 5472 7565 290a 2020 2020 2020 2020  d=True).        
-00019180: 3e3e 3e20 6473 2e66 6f72 6d61 740a 2020  >>> ds.format.  
-00019190: 2020 2020 2020 7b27 636f 6c75 6d6e 7327        {'columns'
-000191a0: 3a20 5b27 7465 7874 272c 2027 6c61 6265  : ['text', 'labe
-000191b0: 6c27 2c20 2769 6e70 7574 5f69 6473 272c  l', 'input_ids',
-000191c0: 2027 746f 6b65 6e5f 7479 7065 5f69 6473   'token_type_ids
-000191d0: 272c 2027 6174 7465 6e74 696f 6e5f 6d61  ', 'attention_ma
-000191e0: 736b 275d 2c0a 2020 2020 2020 2020 2027  sk'],.         '
-000191f0: 666f 726d 6174 5f6b 7761 7267 7327 3a20  format_kwargs': 
-00019200: 7b7d 2c0a 2020 2020 2020 2020 2027 6f75  {},.         'ou
-00019210: 7470 7574 5f61 6c6c 5f63 6f6c 756d 6e73  tput_all_columns
-00019220: 273a 2046 616c 7365 2c0a 2020 2020 2020  ': False,.      
-00019230: 2020 2027 7479 7065 273a 204e 6f6e 657d     'type': None}
-00019240: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-00019250: 3d20 6473 2e77 6974 685f 666f 726d 6174  = ds.with_format
-00019260: 2874 7970 653d 2774 656e 736f 7266 6c6f  (type='tensorflo
-00019270: 7727 2c20 636f 6c75 6d6e 733d 5b27 696e  w', columns=['in
-00019280: 7075 745f 6964 7327 2c20 2774 6f6b 656e  put_ids', 'token
-00019290: 5f74 7970 655f 6964 7327 2c20 2761 7474  _type_ids', 'att
-000192a0: 656e 7469 6f6e 5f6d 6173 6b27 2c20 276c  ention_mask', 'l
-000192b0: 6162 656c 275d 290a 2020 2020 2020 2020  abel']).        
-000192c0: 3e3e 3e20 6473 2e66 6f72 6d61 740a 2020  >>> ds.format.  
-000192d0: 2020 2020 2020 7b27 636f 6c75 6d6e 7327        {'columns'
-000192e0: 3a20 5b27 696e 7075 745f 6964 7327 2c20  : ['input_ids', 
-000192f0: 2774 6f6b 656e 5f74 7970 655f 6964 7327  'token_type_ids'
-00019300: 2c20 2761 7474 656e 7469 6f6e 5f6d 6173  , 'attention_mas
-00019310: 6b27 2c20 276c 6162 656c 275d 2c0a 2020  k', 'label'],.  
-00019320: 2020 2020 2020 2027 666f 726d 6174 5f6b         'format_k
-00019330: 7761 7267 7327 3a20 7b7d 2c0a 2020 2020  wargs': {},.    
-00019340: 2020 2020 2027 6f75 7470 7574 5f61 6c6c       'output_all
-00019350: 5f63 6f6c 756d 6e73 273a 2046 616c 7365  _columns': False
-00019360: 2c0a 2020 2020 2020 2020 2027 7479 7065  ,.         'type
-00019370: 273a 2027 7465 6e73 6f72 666c 6f77 277d  ': 'tensorflow'}
-00019380: 0a20 2020 2020 2020 2060 6060 0a20 2020  .        ```.   
-00019390: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000193a0: 2064 6174 6173 6574 203d 2063 6f70 792e   dataset = copy.
-000193b0: 6465 6570 636f 7079 2873 656c 6629 0a20  deepcopy(self). 
-000193c0: 2020 2020 2020 2064 6174 6173 6574 2e73         dataset.s
-000193d0: 6574 5f66 6f72 6d61 7428 7479 7065 3d74  et_format(type=t
-000193e0: 7970 652c 2063 6f6c 756d 6e73 3d63 6f6c  ype, columns=col
-000193f0: 756d 6e73 2c20 6f75 7470 7574 5f61 6c6c  umns, output_all
-00019400: 5f63 6f6c 756d 6e73 3d6f 7574 7075 745f  _columns=output_
-00019410: 616c 6c5f 636f 6c75 6d6e 732c 202a 2a66  all_columns, **f
-00019420: 6f72 6d61 745f 6b77 6172 6773 290a 2020  ormat_kwargs).  
-00019430: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
-00019440: 6173 6574 0a0a 2020 2020 6465 6620 7769  aset..    def wi
-00019450: 7468 5f74 7261 6e73 666f 726d 280a 2020  th_transform(.  
-00019460: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00019470: 2020 2020 7472 616e 7366 6f72 6d3a 204f      transform: O
-00019480: 7074 696f 6e61 6c5b 4361 6c6c 6162 6c65  ptional[Callable
-00019490: 5d2c 0a20 2020 2020 2020 2063 6f6c 756d  ],.        colum
-000194a0: 6e73 3a20 4f70 7469 6f6e 616c 5b4c 6973  ns: Optional[Lis
-000194b0: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
-000194c0: 2020 206f 7574 7075 745f 616c 6c5f 636f     output_all_co
-000194d0: 6c75 6d6e 733a 2062 6f6f 6c20 3d20 4661  lumns: bool = Fa
-000194e0: 6c73 652c 0a20 2020 2029 3a0a 2020 2020  lse,.    ):.    
-000194f0: 2020 2020 2222 2253 6574 2060 5f5f 6765      """Set `__ge
-00019500: 7469 7465 6d5f 5f60 2072 6574 7572 6e20  titem__` return 
-00019510: 666f 726d 6174 2075 7369 6e67 2074 6869  format using thi
-00019520: 7320 7472 616e 7366 6f72 6d2e 2054 6865  s transform. The
-00019530: 2074 7261 6e73 666f 726d 2069 7320 6170   transform is ap
-00019540: 706c 6965 6420 6f6e 2d74 6865 2d66 6c79  plied on-the-fly
-00019550: 206f 6e20 6261 7463 6865 7320 7768 656e   on batches when
-00019560: 2060 5f5f 6765 7469 7465 6d5f 5f60 2069   `__getitem__` i
-00019570: 7320 6361 6c6c 6564 2e0a 0a20 2020 2020  s called...     
-00019580: 2020 2041 7320 5b60 7e64 6174 6173 6574     As [`~dataset
-00019590: 732e 4461 7461 7365 742e 7365 745f 666f  s.Dataset.set_fo
-000195a0: 726d 6174 605d 2c20 7468 6973 2063 616e  rmat`], this can
-000195b0: 2062 6520 7265 7365 7420 7573 696e 6720   be reset using 
-000195c0: 5b60 7e64 6174 6173 6574 732e 4461 7461  [`~datasets.Data
-000195d0: 7365 742e 7265 7365 745f 666f 726d 6174  set.reset_format
-000195e0: 605d 2e0a 0a20 2020 2020 2020 2043 6f6e  `]...        Con
-000195f0: 7472 6172 7920 746f 205b 607e 6461 7461  trary to [`~data
-00019600: 7365 7473 2e44 6174 6173 6574 2e73 6574  sets.Dataset.set
-00019610: 5f74 7261 6e73 666f 726d 605d 2c20 6077  _transform`], `w
-00019620: 6974 685f 7472 616e 7366 6f72 6d60 2072  ith_transform` r
-00019630: 6574 7572 6e73 2061 206e 6577 205b 6044  eturns a new [`D
-00019640: 6174 6173 6574 605d 206f 626a 6563 742e  ataset`] object.
-00019650: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-00019660: 2020 2020 2020 2020 2020 2020 7472 616e              tran
-00019670: 7366 6f72 6d20 2860 4361 6c6c 6162 6c65  sform (`Callable
-00019680: 602c 2060 6f70 7469 6f6e 616c 6029 3a0a  `, `optional`):.
-00019690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196a0: 5573 6572 2d64 6566 696e 6564 2066 6f72  User-defined for
-000196b0: 6d61 7474 696e 6720 7472 616e 7366 6f72  matting transfor
-000196c0: 6d2c 2072 6570 6c61 6365 7320 7468 6520  m, replaces the 
-000196d0: 666f 726d 6174 2064 6566 696e 6564 2062  format defined b
-000196e0: 7920 5b60 7e64 6174 6173 6574 732e 4461  y [`~datasets.Da
-000196f0: 7461 7365 742e 7365 745f 666f 726d 6174  taset.set_format
-00019700: 605d 2e0a 2020 2020 2020 2020 2020 2020  `]..            
-00019710: 2020 2020 4120 666f 726d 6174 7469 6e67      A formatting
-00019720: 2066 756e 6374 696f 6e20 6973 2061 2063   function is a c
-00019730: 616c 6c61 626c 6520 7468 6174 2074 616b  allable that tak
-00019740: 6573 2061 2062 6174 6368 2028 6173 2061  es a batch (as a
-00019750: 2060 6469 6374 6029 2061 7320 696e 7075   `dict`) as inpu
-00019760: 7420 616e 6420 7265 7475 726e 7320 6120  t and returns a 
-00019770: 6261 7463 682e 0a20 2020 2020 2020 2020  batch..         
-00019780: 2020 2020 2020 2054 6869 7320 6675 6e63         This func
-00019790: 7469 6f6e 2069 7320 6170 706c 6965 6420  tion is applied 
-000197a0: 7269 6768 7420 6265 666f 7265 2072 6574  right before ret
-000197b0: 7572 6e69 6e67 2074 6865 206f 626a 6563  urning the objec
-000197c0: 7473 2069 6e20 605f 5f67 6574 6974 656d  ts in `__getitem
-000197d0: 5f5f 602e 0a20 2020 2020 2020 2020 2020  __`..           
-000197e0: 2063 6f6c 756d 6e73 2028 604c 6973 745b   columns (`List[
-000197f0: 7374 725d 602c 2060 6f70 7469 6f6e 616c  str]`, `optional
-00019800: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
-00019810: 2020 2020 436f 6c75 6d6e 7320 746f 2066      Columns to f
-00019820: 6f72 6d61 7420 696e 2074 6865 206f 7574  ormat in the out
-00019830: 7075 742e 0a20 2020 2020 2020 2020 2020  put..           
-00019840: 2020 2020 2049 6620 7370 6563 6966 6965       If specifie
-00019850: 642c 2074 6865 6e20 7468 6520 696e 7075  d, then the inpu
-00019860: 7420 6261 7463 6820 6f66 2074 6865 2074  t batch of the t
-00019870: 7261 6e73 666f 726d 206f 6e6c 7920 636f  ransform only co
-00019880: 6e74 6169 6e73 2074 686f 7365 2063 6f6c  ntains those col
-00019890: 756d 6e73 2e0a 2020 2020 2020 2020 2020  umns..          
-000198a0: 2020 6f75 7470 7574 5f61 6c6c 5f63 6f6c    output_all_col
-000198b0: 756d 6e73 2028 6062 6f6f 6c60 2c20 6465  umns (`bool`, de
-000198c0: 6661 756c 7473 2074 6f20 6046 616c 7365  faults to `False
-000198d0: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
-000198e0: 2020 2020 4b65 6570 2075 6e2d 666f 726d      Keep un-form
-000198f0: 6174 7465 6420 636f 6c75 6d6e 7320 6173  atted columns as
-00019900: 2077 656c 6c20 696e 2074 6865 206f 7574   well in the out
-00019910: 7075 7420 2861 7320 7079 7468 6f6e 206f  put (as python o
-00019920: 626a 6563 7473 292e 0a20 2020 2020 2020  bjects)..       
-00019930: 2020 2020 2020 2020 2049 6620 7365 7420           If set 
-00019940: 746f 2060 5472 7565 602c 2074 6865 6e20  to `True`, then 
-00019950: 7468 6520 6f74 6865 7220 756e 2d66 6f72  the other un-for
-00019960: 6d61 7474 6564 2063 6f6c 756d 6e73 2061  matted columns a
-00019970: 7265 206b 6570 7420 7769 7468 2074 6865  re kept with the
-00019980: 206f 7574 7075 7420 6f66 2074 6865 2074   output of the t
-00019990: 7261 6e73 666f 726d 2e0a 0a20 2020 2020  ransform...     
-000199a0: 2020 2045 7861 6d70 6c65 3a0a 0a20 2020     Example:..   
-000199b0: 2020 2020 2060 6060 7079 0a20 2020 2020       ```py.     
-000199c0: 2020 203e 3e3e 2066 726f 6d20 6461 7461     >>> from data
-000199d0: 7365 7473 2069 6d70 6f72 7420 6c6f 6164  sets import load
-000199e0: 5f64 6174 6173 6574 0a20 2020 2020 2020  _dataset.       
-000199f0: 203e 3e3e 2066 726f 6d20 7472 616e 7366   >>> from transf
-00019a00: 6f72 6d65 7273 2069 6d70 6f72 7420 4175  ormers import Au
-00019a10: 746f 546f 6b65 6e69 7a65 720a 2020 2020  toTokenizer.    
-00019a20: 2020 2020 3e3e 3e20 6473 203d 206c 6f61      >>> ds = loa
-00019a30: 645f 6461 7461 7365 7428 2272 6f74 7465  d_dataset("rotte
-00019a40: 6e5f 746f 6d61 746f 6573 222c 2073 706c  n_tomatoes", spl
-00019a50: 6974 3d22 7661 6c69 6461 7469 6f6e 2229  it="validation")
-00019a60: 0a20 2020 2020 2020 203e 3e3e 2074 6f6b  .        >>> tok
-00019a70: 656e 697a 6572 203d 2041 7574 6f54 6f6b  enizer = AutoTok
-00019a80: 656e 697a 6572 2e66 726f 6d5f 7072 6574  enizer.from_pret
-00019a90: 7261 696e 6564 2822 6265 7274 2d62 6173  rained("bert-bas
-00019aa0: 652d 6361 7365 6422 290a 2020 2020 2020  e-cased").      
-00019ab0: 2020 3e3e 3e20 6465 6620 656e 636f 6465    >>> def encode
-00019ac0: 2865 7861 6d70 6c65 293a 0a20 2020 2020  (example):.     
-00019ad0: 2020 202e 2e2e 2020 2020 2072 6574 7572     ...     retur
-00019ae0: 6e20 746f 6b65 6e69 7a65 7228 6578 616d  n tokenizer(exam
-00019af0: 706c 655b 2274 6578 7422 5d2c 2070 6164  ple["text"], pad
-00019b00: 6469 6e67 3d54 7275 652c 2074 7275 6e63  ding=True, trunc
-00019b10: 6174 696f 6e3d 5472 7565 2c20 7265 7475  ation=True, retu
-00019b20: 726e 5f74 656e 736f 7273 3d27 7074 2729  rn_tensors='pt')
-00019b30: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-00019b40: 3d20 6473 2e77 6974 685f 7472 616e 7366  = ds.with_transf
-00019b50: 6f72 6d28 656e 636f 6465 290a 2020 2020  orm(encode).    
-00019b60: 2020 2020 3e3e 3e20 6473 5b30 5d0a 2020      >>> ds[0].  
-00019b70: 2020 2020 2020 7b27 6174 7465 6e74 696f        {'attentio
-00019b80: 6e5f 6d61 736b 273a 2074 656e 736f 7228  n_mask': tensor(
-00019b90: 5b31 2c20 312c 2031 2c20 312c 2031 2c20  [1, 1, 1, 1, 1, 
-00019ba0: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
-00019bb0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-00019bc0: 2031 2c20 312c 2031 2c20 312c 2031 2c20   1, 1, 1, 1, 1, 
-00019bd0: 312c 2031 2c20 312c 0a20 2020 2020 2020  1, 1, 1,.       
-00019be0: 2020 312c 2031 2c20 312c 2031 2c20 315d    1, 1, 1, 1, 1]
-00019bf0: 292c 0a20 2020 2020 2020 2020 2769 6e70  ),.         'inp
-00019c00: 7574 5f69 6473 273a 2074 656e 736f 7228  ut_ids': tensor(
-00019c10: 5b20 2031 3031 2c20 3138 3032 372c 2031  [  101, 18027, 1
-00019c20: 3633 3130 2c20 3136 3030 312c 2020 3131  6310, 16001,  11
-00019c30: 3033 2c20 2039 3332 312c 2020 2031 3738  03,  9321,   178
-00019c40: 2c20 3131 3630 342c 2020 3732 3335 2c20  , 11604,  7235, 
-00019c50: 2036 3631 372c 0a20 2020 2020 2020 2020   6617,.         
-00019c60: 2020 2020 2020 2020 3137 3432 2c20 2032          1742,  2
-00019c70: 3136 352c 2020 3238 3230 2c20 2031 3230  165,  2820,  120
-00019c80: 362c 2020 3635 3838 2c20 3232 3537 322c  6,  6588, 22572,
-00019c90: 2031 3239 3337 2c20 2031 3831 312c 2020   12937,  1811,  
-00019ca0: 3231 3533 2c20 2031 3130 352c 0a20 2020  2153,  1105,.   
-00019cb0: 2020 2020 2020 2020 2020 2020 2020 3131                11
-00019cc0: 3437 2c20 3132 3839 302c 2031 3935 3837  47, 12890, 19587
-00019cd0: 2c20 2036 3436 332c 2020 3131 3035 2c20  ,  6463,  1105, 
-00019ce0: 3135 3032 362c 2020 3134 3832 2c20 2020  15026,  1482,   
-00019cf0: 3131 392c 2020 2031 3032 5d29 2c0a 2020  119,   102]),.  
-00019d00: 2020 2020 2020 2027 746f 6b65 6e5f 7479         'token_ty
-00019d10: 7065 5f69 6473 273a 2074 656e 736f 7228  pe_ids': tensor(
-00019d20: 5b30 2c20 302c 2030 2c20 302c 2030 2c20  [0, 0, 0, 0, 0, 
-00019d30: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
-00019d40: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
-00019d50: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
-00019d60: 302c 2030 2c20 302c 0a20 2020 2020 2020  0, 0, 0,.       
-00019d70: 2020 2020 2020 2020 2020 302c 2030 2c20            0, 0, 
-00019d80: 302c 2030 2c20 305d 297d 0a20 2020 2020  0, 0, 0])}.     
-00019d90: 2020 2060 6060 0a20 2020 2020 2020 2022     ```.        "
-00019da0: 2222 0a20 2020 2020 2020 2064 6174 6173  "".        datas
-00019db0: 6574 203d 2063 6f70 792e 6465 6570 636f  et = copy.deepco
-00019dc0: 7079 2873 656c 6629 0a20 2020 2020 2020  py(self).       
-00019dd0: 2064 6174 6173 6574 2e73 6574 5f74 7261   dataset.set_tra
-00019de0: 6e73 666f 726d 2874 7261 6e73 666f 726d  nsform(transform
-00019df0: 3d74 7261 6e73 666f 726d 2c20 636f 6c75  =transform, colu
-00019e00: 6d6e 733d 636f 6c75 6d6e 732c 206f 7574  mns=columns, out
-00019e10: 7075 745f 616c 6c5f 636f 6c75 6d6e 733d  put_all_columns=
-00019e20: 6f75 7470 7574 5f61 6c6c 5f63 6f6c 756d  output_all_colum
-00019e30: 6e73 290a 2020 2020 2020 2020 7265 7475  ns).        retu
-00019e40: 726e 2064 6174 6173 6574 0a0a 2020 2020  rn dataset..    
-00019e50: 6465 6620 7072 6570 6172 655f 666f 725f  def prepare_for_
-00019e60: 7461 736b 2873 656c 662c 2074 6173 6b3a  task(self, task:
-00019e70: 2055 6e69 6f6e 5b73 7472 2c20 5461 736b   Union[str, Task
-00019e80: 5465 6d70 6c61 7465 5d2c 2069 643a 2069  Template], id: i
-00019e90: 6e74 203d 2030 2920 2d3e 2022 4461 7461  nt = 0) -> "Data
-00019ea0: 7365 7422 3a0a 2020 2020 2020 2020 2222  set":.        ""
-00019eb0: 220a 2020 2020 2020 2020 5072 6570 6172  ".        Prepar
-00019ec0: 6520 6120 6461 7461 7365 7420 666f 7220  e a dataset for 
-00019ed0: 7468 6520 6769 7665 6e20 7461 736b 2062  the given task b
-00019ee0: 7920 6361 7374 696e 6720 7468 6520 6461  y casting the da
-00019ef0: 7461 7365 7427 7320 5b60 4665 6174 7572  taset's [`Featur
-00019f00: 6573 605d 2074 6f20 7374 616e 6461 7264  es`] to standard
-00019f10: 697a 6564 2063 6f6c 756d 6e20 6e61 6d65  ized column name
-00019f20: 7320 616e 6420 7479 7065 7320 6173 2064  s and types as d
-00019f30: 6574 6169 6c65 6420 696e 205b 6064 6174  etailed in [`dat
-00019f40: 6173 6574 732e 7461 736b 7360 5d28 2e2f  asets.tasks`](./
-00019f50: 7061 636b 6167 655f 7265 6665 7265 6e63  package_referenc
-00019f60: 652f 7461 736b 5f74 656d 706c 6174 6573  e/task_templates
-00019f70: 292e 0a0a 2020 2020 2020 2020 4361 7374  )...        Cast
-00019f80: 7320 5b60 6461 7461 7365 7473 2e44 6174  s [`datasets.Dat
-00019f90: 6173 6574 496e 666f 2e66 6561 7475 7265  asetInfo.feature
-00019fa0: 7360 5d20 6163 636f 7264 696e 6720 746f  s`] according to
-00019fb0: 2061 2074 6173 6b2d 7370 6563 6966 6963   a task-specific
-00019fc0: 2073 6368 656d 612e 2049 6e74 656e 6465   schema. Intende
-00019fd0: 6420 666f 7220 7369 6e67 6c65 2d75 7365  d for single-use
-00019fe0: 206f 6e6c 792c 2073 6f20 616c 6c20 7461   only, so all ta
-00019ff0: 736b 2074 656d 706c 6174 6573 2061 7265  sk templates are
-0001a000: 2072 656d 6f76 6564 2066 726f 6d20 5b60   removed from [`
-0001a010: 6461 7461 7365 7473 2e44 6174 6173 6574  datasets.Dataset
-0001a020: 496e 666f 2e74 6173 6b5f 7465 6d70 6c61  Info.task_templa
-0001a030: 7465 7360 5d20 6166 7465 7220 6361 7374  tes`] after cast
-0001a040: 696e 672e 0a0a 2020 2020 2020 2020 4172  ing...        Ar
-0001a050: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0001a060: 7461 736b 2028 6055 6e69 6f6e 5b73 7472  task (`Union[str
-0001a070: 2c20 5461 736b 5465 6d70 6c61 7465 5d60  , TaskTemplate]`
-0001a080: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001a090: 2020 2054 6865 2074 6173 6b20 746f 2070     The task to p
-0001a0a0: 7265 7061 7265 2074 6865 2064 6174 6173  repare the datas
-0001a0b0: 6574 2066 6f72 2064 7572 696e 6720 7472  et for during tr
-0001a0c0: 6169 6e69 6e67 2061 6e64 2065 7661 6c75  aining and evalu
-0001a0d0: 6174 696f 6e2e 2049 6620 6073 7472 602c  ation. If `str`,
-0001a0e0: 2073 7570 706f 7274 6564 2074 6173 6b73   supported tasks
-0001a0f0: 2069 6e63 6c75 6465 3a0a 0a20 2020 2020   include:..     
-0001a100: 2020 2020 2020 2020 2020 202d 2060 2274             - `"t
-0001a110: 6578 742d 636c 6173 7369 6669 6361 7469  ext-classificati
-0001a120: 6f6e 2260 0a20 2020 2020 2020 2020 2020  on"`.           
-0001a130: 2020 2020 202d 2060 2271 7565 7374 696f       - `"questio
-0001a140: 6e2d 616e 7377 6572 696e 6722 600a 0a20  n-answering"`.. 
-0001a150: 2020 2020 2020 2020 2020 2020 2020 2049                 I
-0001a160: 6620 5b60 5461 736b 5465 6d70 6c61 7465  f [`TaskTemplate
-0001a170: 605d 2c20 6d75 7374 2062 6520 6f6e 6520  `], must be one 
-0001a180: 6f66 2074 6865 2074 6173 6b20 7465 6d70  of the task temp
-0001a190: 6c61 7465 7320 696e 205b 6064 6174 6173  lates in [`datas
-0001a1a0: 6574 732e 7461 736b 7360 5d28 2e2f 7061  ets.tasks`](./pa
-0001a1b0: 636b 6167 655f 7265 6665 7265 6e63 652f  ckage_reference/
-0001a1c0: 7461 736b 5f74 656d 706c 6174 6573 292e  task_templates).
-0001a1d0: 0a20 2020 2020 2020 2020 2020 2069 6420  .            id 
-0001a1e0: 2860 696e 7460 2c20 6465 6661 756c 7473  (`int`, defaults
-0001a1f0: 2074 6f20 6030 6029 3a0a 2020 2020 2020   to `0`):.      
-0001a200: 2020 2020 2020 2020 2020 5468 6520 6964            The id
-0001a210: 2072 6571 7569 7265 6420 746f 2075 6e61   required to una
-0001a220: 6d62 6967 756f 7573 6c79 2069 6465 6e74  mbiguously ident
-0001a230: 6966 7920 7468 6520 7461 736b 2074 656d  ify the task tem
-0001a240: 706c 6174 6520 7768 656e 206d 756c 7469  plate when multi
-0001a250: 706c 6520 7461 736b 2074 656d 706c 6174  ple task templat
-0001a260: 6573 206f 6620 7468 6520 7361 6d65 2074  es of the same t
-0001a270: 7970 6520 6172 6520 7375 7070 6f72 7465  ype are supporte
-0001a280: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-0001a290: 2020 2020 2020 2023 2054 4f44 4f28 6c65         # TODO(le
-0001a2a0: 7774 756e 293a 2041 6464 2073 7570 706f  wtun): Add suppo
-0001a2b0: 7274 2066 6f72 2063 6173 7469 6e67 206e  rt for casting n
-0001a2c0: 6573 7465 6420 6665 6174 7572 6573 206c  ested features l
-0001a2d0: 696b 6520 616e 7377 6572 732e 7465 7874  ike answers.text
-0001a2e0: 2061 6e64 2061 6e73 7765 7273 2e61 6e73   and answers.ans
-0001a2f0: 7765 725f 7374 6172 7420 696e 2053 5175  wer_start in SQu
-0001a300: 4144 0a20 2020 2020 2020 2069 6620 6973  AD.        if is
-0001a310: 696e 7374 616e 6365 2874 6173 6b2c 2073  instance(task, s
-0001a320: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-0001a330: 2074 6173 6b73 203d 205b 7465 6d70 6c61   tasks = [templa
-0001a340: 7465 2e74 6173 6b20 666f 7220 7465 6d70  te.task for temp
-0001a350: 6c61 7465 2069 6e20 2873 656c 662e 696e  late in (self.in
-0001a360: 666f 2e74 6173 6b5f 7465 6d70 6c61 7465  fo.task_template
-0001a370: 7320 6f72 205b 5d29 5d0a 2020 2020 2020  s or [])].      
-0001a380: 2020 2020 2020 636f 6d70 6174 6962 6c65        compatible
-0001a390: 5f74 656d 706c 6174 6573 203d 205b 7465  _templates = [te
-0001a3a0: 6d70 6c61 7465 2066 6f72 2074 656d 706c  mplate for templ
-0001a3b0: 6174 6520 696e 2028 7365 6c66 2e69 6e66  ate in (self.inf
-0001a3c0: 6f2e 7461 736b 5f74 656d 706c 6174 6573  o.task_templates
-0001a3d0: 206f 7220 5b5d 2920 6966 2074 656d 706c   or []) if templ
-0001a3e0: 6174 652e 7461 736b 203d 3d20 7461 736b  ate.task == task
-0001a3f0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-0001a400: 206e 6f74 2063 6f6d 7061 7469 626c 655f   not compatible_
-0001a410: 7465 6d70 6c61 7465 733a 0a20 2020 2020  templates:.     
-0001a420: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001a430: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-0001a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a450: 2066 2254 6173 6b20 7b74 6173 6b7d 2069   f"Task {task} i
-0001a460: 7320 6e6f 7420 636f 6d70 6174 6962 6c65  s not compatible
-0001a470: 2077 6974 6820 7468 6973 2064 6174 6173   with this datas
-0001a480: 6574 2120 4176 6169 6c61 626c 6520 7461  et! Available ta
-0001a490: 736b 733a 207b 6c69 7374 2875 6e69 7175  sks: {list(uniqu
-0001a4a0: 655f 7661 6c75 6573 2874 6173 6b73 2929  e_values(tasks))
-0001a4b0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0001a4c0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-0001a4d0: 2020 6966 206e 6f74 2030 203c 3d20 6964    if not 0 <= id
-0001a4e0: 203c 206c 656e 2863 6f6d 7061 7469 626c   < len(compatibl
-0001a4f0: 655f 7465 6d70 6c61 7465 7329 3a0a 2020  e_templates):.  
-0001a500: 2020 2020 2020 2020 2020 2020 2020 7465                te
-0001a510: 6d70 6c61 7465 735f 6c69 7374 5f73 7472  mplates_list_str
-0001a520: 203d 2022 5c6e 222e 6a6f 696e 280a 2020   = "\n".join(.  
-0001a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a540: 2020 6622 2d20 607b 6964 787d 6020 666f    f"- `{idx}` fo
-0001a550: 7220 7461 736b 207b 7465 6d70 6c61 7465  r task {template
-0001a560: 7d22 2066 6f72 2069 6478 2c20 7465 6d70  }" for idx, temp
-0001a570: 6c61 7465 2069 6e20 656e 756d 6572 6174  late in enumerat
-0001a580: 6528 636f 6d70 6174 6962 6c65 5f74 656d  e(compatible_tem
-0001a590: 706c 6174 6573 290a 2020 2020 2020 2020  plates).        
-0001a5a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001a5b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001a5c0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-0001a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5e0: 6622 4964 207b 6964 7d20 666f 7220 7461  f"Id {id} for ta
-0001a5f0: 736b 207b 7461 736b 7d20 6973 206e 6f74  sk {task} is not
-0001a600: 2069 6e20 6120 7661 6c69 6420 7261 6e67   in a valid rang
-0001a610: 652e 2053 7570 706f 7274 6564 2069 6473  e. Supported ids
-0001a620: 3a5c 6e7b 7465 6d70 6c61 7465 735f 6c69  :\n{templates_li
-0001a630: 7374 5f73 7472 7d22 0a20 2020 2020 2020  st_str}".       
-0001a640: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001a650: 2020 2020 2020 2074 656d 706c 6174 6520         template 
-0001a660: 3d20 636f 6d70 6174 6962 6c65 5f74 656d  = compatible_tem
-0001a670: 706c 6174 6573 5b69 645d 0a20 2020 2020  plates[id].     
-0001a680: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0001a690: 6365 2874 6173 6b2c 2054 6173 6b54 656d  ce(task, TaskTem
-0001a6a0: 706c 6174 6529 3a0a 2020 2020 2020 2020  plate):.        
-0001a6b0: 2020 2020 7465 6d70 6c61 7465 203d 2074      template = t
-0001a6c0: 6173 6b0a 2020 2020 2020 2020 656c 7365  ask.        else
-0001a6d0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0001a6e0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-0001a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a700: 6622 4578 7065 6374 6564 2061 2060 7374  f"Expected a `st
-0001a710: 7260 206f 7220 6064 6174 6173 6574 732e  r` or `datasets.
-0001a720: 5461 736b 5465 6d70 6c61 7465 6020 6f62  TaskTemplate` ob
-0001a730: 6a65 6374 2062 7574 2067 6f74 2074 6173  ject but got tas
-0001a740: 6b20 7b74 6173 6b7d 2077 6974 6820 7479  k {task} with ty
-0001a750: 7065 207b 7479 7065 2874 6173 6b29 7d2e  pe {type(task)}.
-0001a760: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-0001a770: 2020 2020 2020 2020 7465 6d70 6c61 7465          template
-0001a780: 203d 2074 656d 706c 6174 652e 616c 6967   = template.alig
-0001a790: 6e5f 7769 7468 5f66 6561 7475 7265 7328  n_with_features(
-0001a7a0: 7365 6c66 2e69 6e66 6f2e 6665 6174 7572  self.info.featur
-0001a7b0: 6573 290a 2020 2020 2020 2020 636f 6c75  es).        colu
-0001a7c0: 6d6e 5f6d 6170 7069 6e67 203d 2074 656d  mn_mapping = tem
-0001a7d0: 706c 6174 652e 636f 6c75 6d6e 5f6d 6170  plate.column_map
-0001a7e0: 7069 6e67 0a20 2020 2020 2020 2063 6f6c  ping.        col
-0001a7f0: 756d 6e73 5f74 6f5f 6472 6f70 203d 205b  umns_to_drop = [
-0001a800: 636f 6c75 6d6e 2066 6f72 2063 6f6c 756d  column for colum
-0001a810: 6e20 696e 2073 656c 662e 636f 6c75 6d6e  n in self.column
-0001a820: 5f6e 616d 6573 2069 6620 636f 6c75 6d6e  _names if column
-0001a830: 206e 6f74 2069 6e20 636f 6c75 6d6e 5f6d   not in column_m
-0001a840: 6170 7069 6e67 5d0a 2020 2020 2020 2020  apping].        
-0001a850: 6461 7461 7365 7420 3d20 7365 6c66 2e72  dataset = self.r
-0001a860: 656d 6f76 655f 636f 6c75 6d6e 7328 636f  emove_columns(co
-0001a870: 6c75 6d6e 735f 746f 5f64 726f 7029 0a20  lumns_to_drop). 
-0001a880: 2020 2020 2020 2064 6174 6173 6574 203d         dataset =
-0001a890: 2064 6174 6173 6574 2e72 656e 616d 655f   dataset.rename_
-0001a8a0: 636f 6c75 6d6e 7328 636f 6c75 6d6e 5f6d  columns(column_m
-0001a8b0: 6170 7069 6e67 290a 2020 2020 2020 2020  apping).        
-0001a8c0: 2320 5765 2066 6f75 6e64 2061 2074 656d  # We found a tem
-0001a8d0: 706c 6174 6520 736f 206e 6f77 2066 6c75  plate so now flu
-0001a8e0: 7368 2060 4461 7461 7365 7449 6e66 6f60  sh `DatasetInfo`
-0001a8f0: 2074 6f20 736b 6970 2074 6865 2074 656d   to skip the tem
-0001a900: 706c 6174 6520 7570 6461 7465 2069 6e20  plate update in 
-0001a910: 6044 6174 6173 6574 496e 666f 2e5f 5f70  `DatasetInfo.__p
-0001a920: 6f73 745f 696e 6974 5f5f 600a 2020 2020  ost_init__`.    
-0001a930: 2020 2020 6461 7461 7365 742e 696e 666f      dataset.info
-0001a940: 2e74 6173 6b5f 7465 6d70 6c61 7465 7320  .task_templates 
-0001a950: 3d20 4e6f 6e65 0a20 2020 2020 2020 2064  = None.        d
-0001a960: 6174 6173 6574 203d 2064 6174 6173 6574  ataset = dataset
-0001a970: 2e63 6173 7428 6665 6174 7572 6573 3d74  .cast(features=t
-0001a980: 656d 706c 6174 652e 6665 6174 7572 6573  emplate.features
-0001a990: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001a9a0: 2064 6174 6173 6574 0a0a 2020 2020 6465   dataset..    de
-0001a9b0: 6620 5f67 6574 6974 656d 2873 656c 662c  f _getitem(self,
-0001a9c0: 206b 6579 3a20 556e 696f 6e5b 696e 742c   key: Union[int,
-0001a9d0: 2073 6c69 6365 2c20 7374 725d 2c20 2a2a   slice, str], **
-0001a9e0: 6b77 6172 6773 2920 2d3e 2055 6e69 6f6e  kwargs) -> Union
-0001a9f0: 5b44 6963 742c 204c 6973 745d 3a0a 2020  [Dict, List]:.  
-0001aa00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001aa10: 2020 4361 6e20 6265 2075 7365 6420 746f    Can be used to
-0001aa20: 2069 6e64 6578 2063 6f6c 756d 6e73 2028   index columns (
-0001aa30: 6279 2073 7472 696e 6720 6e61 6d65 7329  by string names)
-0001aa40: 206f 7220 726f 7773 2028 6279 2069 6e74   or rows (by int
-0001aa50: 6567 6572 2069 6e64 6578 2c20 736c 6963  eger index, slic
-0001aa60: 6573 2c20 6f72 2069 7465 7220 6f66 2069  es, or iter of i
-0001aa70: 6e64 6963 6573 206f 7220 626f 6f6c 7329  ndices or bools)
-0001aa80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001aa90: 2020 2020 2066 6f72 6d61 745f 7479 7065       format_type
-0001aaa0: 203d 206b 7761 7267 735b 2266 6f72 6d61   = kwargs["forma
-0001aab0: 745f 7479 7065 225d 2069 6620 2266 6f72  t_type"] if "for
-0001aac0: 6d61 745f 7479 7065 2220 696e 206b 7761  mat_type" in kwa
-0001aad0: 7267 7320 656c 7365 2073 656c 662e 5f66  rgs else self._f
-0001aae0: 6f72 6d61 745f 7479 7065 0a20 2020 2020  ormat_type.     
-0001aaf0: 2020 2066 6f72 6d61 745f 636f 6c75 6d6e     format_column
-0001ab00: 7320 3d20 6b77 6172 6773 5b22 666f 726d  s = kwargs["form
-0001ab10: 6174 5f63 6f6c 756d 6e73 225d 2069 6620  at_columns"] if 
-0001ab20: 2266 6f72 6d61 745f 636f 6c75 6d6e 7322  "format_columns"
-0001ab30: 2069 6e20 6b77 6172 6773 2065 6c73 6520   in kwargs else 
-0001ab40: 7365 6c66 2e5f 666f 726d 6174 5f63 6f6c  self._format_col
-0001ab50: 756d 6e73 0a20 2020 2020 2020 206f 7574  umns.        out
-0001ab60: 7075 745f 616c 6c5f 636f 6c75 6d6e 7320  put_all_columns 
-0001ab70: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0001ab80: 6b77 6172 6773 5b22 6f75 7470 7574 5f61  kwargs["output_a
-0001ab90: 6c6c 5f63 6f6c 756d 6e73 225d 2069 6620  ll_columns"] if 
-0001aba0: 226f 7574 7075 745f 616c 6c5f 636f 6c75  "output_all_colu
-0001abb0: 6d6e 7322 2069 6e20 6b77 6172 6773 2065  mns" in kwargs e
-0001abc0: 6c73 6520 7365 6c66 2e5f 6f75 7470 7574  lse self._output
-0001abd0: 5f61 6c6c 5f63 6f6c 756d 6e73 0a20 2020  _all_columns.   
-0001abe0: 2020 2020 2029 0a20 2020 2020 2020 2066       ).        f
-0001abf0: 6f72 6d61 745f 6b77 6172 6773 203d 206b  ormat_kwargs = k
-0001ac00: 7761 7267 735b 2266 6f72 6d61 745f 6b77  wargs["format_kw
-0001ac10: 6172 6773 225d 2069 6620 2266 6f72 6d61  args"] if "forma
-0001ac20: 745f 6b77 6172 6773 2220 696e 206b 7761  t_kwargs" in kwa
-0001ac30: 7267 7320 656c 7365 2073 656c 662e 5f66  rgs else self._f
-0001ac40: 6f72 6d61 745f 6b77 6172 6773 0a20 2020  ormat_kwargs.   
-0001ac50: 2020 2020 2066 6f72 6d61 745f 6b77 6172       format_kwar
-0001ac60: 6773 203d 2066 6f72 6d61 745f 6b77 6172  gs = format_kwar
-0001ac70: 6773 2069 6620 666f 726d 6174 5f6b 7761  gs if format_kwa
-0001ac80: 7267 7320 6973 206e 6f74 204e 6f6e 6520  rgs is not None 
-0001ac90: 656c 7365 207b 7d0a 2020 2020 2020 2020  else {}.        
-0001aca0: 666f 726d 6174 7465 7220 3d20 6765 745f  formatter = get_
-0001acb0: 666f 726d 6174 7465 7228 666f 726d 6174  formatter(format
-0001acc0: 5f74 7970 652c 2066 6561 7475 7265 733d  _type, features=
-0001acd0: 7365 6c66 2e66 6561 7475 7265 732c 202a  self.features, *
-0001ace0: 2a66 6f72 6d61 745f 6b77 6172 6773 290a  *format_kwargs).
-0001acf0: 2020 2020 2020 2020 7061 5f73 7562 7461          pa_subta
-0001ad00: 626c 6520 3d20 7175 6572 795f 7461 626c  ble = query_tabl
-0001ad10: 6528 7365 6c66 2e5f 6461 7461 2c20 6b65  e(self._data, ke
-0001ad20: 792c 2069 6e64 6963 6573 3d73 656c 662e  y, indices=self.
-0001ad30: 5f69 6e64 6963 6573 2069 6620 7365 6c66  _indices if self
-0001ad40: 2e5f 696e 6469 6365 7320 6973 206e 6f74  ._indices is not
-0001ad50: 204e 6f6e 6520 656c 7365 204e 6f6e 6529   None else None)
-0001ad60: 0a20 2020 2020 2020 2066 6f72 6d61 7474  .        formatt
-0001ad70: 6564 5f6f 7574 7075 7420 3d20 666f 726d  ed_output = form
-0001ad80: 6174 5f74 6162 6c65 280a 2020 2020 2020  at_table(.      
-0001ad90: 2020 2020 2020 7061 5f73 7562 7461 626c        pa_subtabl
-0001ada0: 652c 206b 6579 2c20 666f 726d 6174 7465  e, key, formatte
-0001adb0: 723d 666f 726d 6174 7465 722c 2066 6f72  r=formatter, for
-0001adc0: 6d61 745f 636f 6c75 6d6e 733d 666f 726d  mat_columns=form
-0001add0: 6174 5f63 6f6c 756d 6e73 2c20 6f75 7470  at_columns, outp
-0001ade0: 7574 5f61 6c6c 5f63 6f6c 756d 6e73 3d6f  ut_all_columns=o
-0001adf0: 7574 7075 745f 616c 6c5f 636f 6c75 6d6e  utput_all_column
-0001ae00: 730a 2020 2020 2020 2020 290a 2020 2020  s.        ).    
-0001ae10: 2020 2020 7265 7475 726e 2066 6f72 6d61      return forma
-0001ae20: 7474 6564 5f6f 7574 7075 740a 0a20 2020  tted_output..   
-0001ae30: 2040 6f76 6572 6c6f 6164 0a20 2020 2064   @overload.    d
-0001ae40: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
-0001ae50: 656c 662c 206b 6579 3a20 556e 696f 6e5b  elf, key: Union[
-0001ae60: 696e 742c 2073 6c69 6365 2c20 4974 6572  int, slice, Iter
-0001ae70: 6162 6c65 5b69 6e74 5d5d 2920 2d3e 2044  able[int]]) -> D
-0001ae80: 6963 743a 2020 2320 6e6f 7161 3a20 4638  ict:  # noqa: F8
-0001ae90: 3131 0a20 2020 2020 2020 202e 2e2e 0a0a  11.        .....
-0001aea0: 2020 2020 406f 7665 726c 6f61 640a 2020      @overload.  
-0001aeb0: 2020 6465 6620 5f5f 6765 7469 7465 6d5f    def __getitem_
-0001aec0: 5f28 7365 6c66 2c20 6b65 793a 2073 7472  _(self, key: str
-0001aed0: 2920 2d3e 204c 6973 743a 2020 2320 6e6f  ) -> List:  # no
-0001aee0: 7161 3a20 4638 3131 0a20 2020 2020 2020  qa: F811.       
-0001aef0: 202e 2e2e 0a0a 2020 2020 6465 6620 5f5f   .....    def __
-0001af00: 6765 7469 7465 6d5f 5f28 7365 6c66 2c20  getitem__(self, 
-0001af10: 6b65 7929 3a20 2023 206e 6f71 613a 2046  key):  # noqa: F
-0001af20: 3831 310a 2020 2020 2020 2020 2222 2243  811.        """C
-0001af30: 616e 2062 6520 7573 6564 2074 6f20 696e  an be used to in
-0001af40: 6465 7820 636f 6c75 6d6e 7320 2862 7920  dex columns (by 
-0001af50: 7374 7269 6e67 206e 616d 6573 2920 6f72  string names) or
-0001af60: 2072 6f77 7320 2862 7920 696e 7465 6765   rows (by intege
-0001af70: 7220 696e 6465 7820 6f72 2069 7465 7261  r index or itera
-0001af80: 626c 6520 6f66 2069 6e64 6963 6573 206f  ble of indices o
-0001af90: 7220 626f 6f6c 7329 2e22 2222 0a20 2020  r bools).""".   
-0001afa0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001afb0: 2e5f 6765 7469 7465 6d28 0a20 2020 2020  ._getitem(.     
-0001afc0: 2020 2020 2020 206b 6579 2c0a 2020 2020         key,.    
-0001afd0: 2020 2020 290a 0a20 2020 2064 6566 2063      )..    def c
-0001afe0: 6c65 616e 7570 5f63 6163 6865 5f66 696c  leanup_cache_fil
-0001aff0: 6573 2873 656c 6629 202d 3e20 696e 743a  es(self) -> int:
-0001b000: 0a20 2020 2020 2020 2022 2222 436c 6561  .        """Clea
-0001b010: 6e20 7570 2061 6c6c 2063 6163 6865 2066  n up all cache f
-0001b020: 696c 6573 2069 6e20 7468 6520 6461 7461  iles in the data
-0001b030: 7365 7420 6361 6368 6520 6469 7265 6374  set cache direct
-0001b040: 6f72 792c 2065 7863 6570 7465 6420 7468  ory, excepted th
-0001b050: 6520 6375 7272 656e 746c 7920 7573 6564  e currently used
-0001b060: 2063 6163 6865 2066 696c 6520 6966 2074   cache file if t
-0001b070: 6865 7265 2069 730a 2020 2020 2020 2020  here is.        
-0001b080: 6f6e 652e 0a0a 2020 2020 2020 2020 4265  one...        Be
-0001b090: 2063 6172 6566 756c 2077 6865 6e20 7275   careful when ru
-0001b0a0: 6e6e 696e 6720 7468 6973 2063 6f6d 6d61  nning this comma
-0001b0b0: 6e64 2074 6861 7420 6e6f 206f 7468 6572  nd that no other
-0001b0c0: 2070 726f 6365 7373 2069 7320 6375 7272   process is curr
-0001b0d0: 656e 746c 7920 7573 696e 6720 6f74 6865  ently using othe
-0001b0e0: 7220 6361 6368 6520 6669 6c65 732e 0a0a  r cache files...
-0001b0f0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-0001b100: 0a20 2020 2020 2020 2020 2020 2060 696e  .            `in
-0001b110: 7460 3a20 4e75 6d62 6572 206f 6620 7265  t`: Number of re
-0001b120: 6d6f 7665 6420 6669 6c65 732e 0a0a 2020  moved files...  
-0001b130: 2020 2020 2020 4578 616d 706c 653a 0a0a        Example:..
-0001b140: 2020 2020 2020 2020 6060 6070 790a 2020          ```py.  
-0001b150: 2020 2020 2020 3e3e 3e20 6672 6f6d 2064        >>> from d
-0001b160: 6174 6173 6574 7320 696d 706f 7274 206c  atasets import l
-0001b170: 6f61 645f 6461 7461 7365 740a 2020 2020  oad_dataset.    
-0001b180: 2020 2020 3e3e 3e20 6473 203d 206c 6f61      >>> ds = loa
-0001b190: 645f 6461 7461 7365 7428 2272 6f74 7465  d_dataset("rotte
-0001b1a0: 6e5f 746f 6d61 746f 6573 222c 2073 706c  n_tomatoes", spl
-0001b1b0: 6974 3d22 7661 6c69 6461 7469 6f6e 2229  it="validation")
-0001b1c0: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
-0001b1d0: 636c 6561 6e75 705f 6361 6368 655f 6669  cleanup_cache_fi
-0001b1e0: 6c65 7328 290a 2020 2020 2020 2020 3130  les().        10
-0001b1f0: 0a20 2020 2020 2020 2060 6060 0a20 2020  .        ```.   
-0001b200: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001b210: 2063 7572 7265 6e74 5f63 6163 6865 5f66   current_cache_f
-0001b220: 696c 6573 203d 205b 6f73 2e70 6174 682e  iles = [os.path.
-0001b230: 6162 7370 6174 6828 6361 6368 655f 6669  abspath(cache_fi
-0001b240: 6c65 5b22 6669 6c65 6e61 6d65 225d 2920  le["filename"]) 
-0001b250: 666f 7220 6361 6368 655f 6669 6c65 2069  for cache_file i
-0001b260: 6e20 7365 6c66 2e63 6163 6865 5f66 696c  n self.cache_fil
-0001b270: 6573 5d0a 2020 2020 2020 2020 6966 206e  es].        if n
-0001b280: 6f74 2063 7572 7265 6e74 5f63 6163 6865  ot current_cache
-0001b290: 5f66 696c 6573 3a0a 2020 2020 2020 2020  _files:.        
-0001b2a0: 2020 2020 7265 7475 726e 2030 0a20 2020      return 0.   
-0001b2b0: 2020 2020 2063 6163 6865 5f64 6972 6563       cache_direc
-0001b2c0: 746f 7279 203d 206f 732e 7061 7468 2e64  tory = os.path.d
-0001b2d0: 6972 6e61 6d65 2863 7572 7265 6e74 5f63  irname(current_c
-0001b2e0: 6163 6865 5f66 696c 6573 5b30 5d29 0a20  ache_files[0]). 
-0001b2f0: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
-0001b300: 666f 2866 224c 6973 7469 6e67 2066 696c  fo(f"Listing fil
-0001b310: 6573 2069 6e20 7b63 6163 6865 5f64 6972  es in {cache_dir
-0001b320: 6563 746f 7279 7d22 290a 2020 2020 2020  ectory}").      
-0001b330: 2020 6669 6c65 733a 204c 6973 745b 7374    files: List[st
-0001b340: 725d 203d 206f 732e 6c69 7374 6469 7228  r] = os.listdir(
-0001b350: 6361 6368 655f 6469 7265 6374 6f72 7929  cache_directory)
-0001b360: 0a20 2020 2020 2020 2066 696c 6573 5f74  .        files_t
-0001b370: 6f5f 7265 6d6f 7665 203d 205b 5d0a 2020  o_remove = [].  
-0001b380: 2020 2020 2020 666f 7220 665f 6e61 6d65        for f_name
-0001b390: 2069 6e20 6669 6c65 733a 0a20 2020 2020   in files:.     
-0001b3a0: 2020 2020 2020 2066 756c 6c5f 6e61 6d65         full_name
-0001b3b0: 203d 206f 732e 7061 7468 2e61 6273 7061   = os.path.abspa
-0001b3c0: 7468 286f 732e 7061 7468 2e6a 6f69 6e28  th(os.path.join(
-0001b3d0: 6361 6368 655f 6469 7265 6374 6f72 792c  cache_directory,
-0001b3e0: 2066 5f6e 616d 6529 290a 2020 2020 2020   f_name)).      
-0001b3f0: 2020 2020 2020 6966 2066 5f6e 616d 652e        if f_name.
-0001b400: 7374 6172 7473 7769 7468 2822 6361 6368  startswith("cach
-0001b410: 652d 2229 2061 6e64 2066 5f6e 616d 652e  e-") and f_name.
-0001b420: 656e 6473 7769 7468 2822 2e61 7272 6f77  endswith(".arrow
-0001b430: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-0001b440: 2020 2020 6966 2066 756c 6c5f 6e61 6d65      if full_name
-0001b450: 2069 6e20 6375 7272 656e 745f 6361 6368   in current_cach
-0001b460: 655f 6669 6c65 733a 0a20 2020 2020 2020  e_files:.       
-0001b470: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-0001b480: 6765 722e 696e 666f 2866 224b 6565 7069  ger.info(f"Keepi
-0001b490: 6e67 2063 7572 7265 6e74 6c79 2075 7365  ng currently use
-0001b4a0: 6420 6361 6368 6520 6669 6c65 2061 7420  d cache file at 
-0001b4b0: 7b66 756c 6c5f 6e61 6d65 7d22 290a 2020  {full_name}").  
-0001b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4d0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0001b4e0: 2020 2020 2020 2020 2020 2066 696c 6573             files
-0001b4f0: 5f74 6f5f 7265 6d6f 7665 2e61 7070 656e  _to_remove.appen
-0001b500: 6428 6675 6c6c 5f6e 616d 6529 0a20 2020  d(full_name).   
-0001b510: 2020 2020 2066 6f72 2066 696c 655f 7061       for file_pa
-0001b520: 7468 2069 6e20 6669 6c65 735f 746f 5f72  th in files_to_r
-0001b530: 656d 6f76 653a 0a20 2020 2020 2020 2020  emove:.         
-0001b540: 2020 206c 6f67 6765 722e 696e 666f 2866     logger.info(f
-0001b550: 2252 656d 6f76 696e 6720 7b66 696c 655f  "Removing {file_
-0001b560: 7061 7468 7d22 290a 2020 2020 2020 2020  path}").        
-0001b570: 2020 2020 6f73 2e72 656d 6f76 6528 6669      os.remove(fi
-0001b580: 6c65 5f70 6174 6829 0a20 2020 2020 2020  le_path).       
-0001b590: 2072 6574 7572 6e20 6c65 6e28 6669 6c65   return len(file
-0001b5a0: 735f 746f 5f72 656d 6f76 6529 0a0a 2020  s_to_remove)..  
-0001b5b0: 2020 6465 6620 5f67 6574 5f63 6163 6865    def _get_cache
-0001b5c0: 5f66 696c 655f 7061 7468 2873 656c 662c  _file_path(self,
-0001b5d0: 2066 696e 6765 7270 7269 6e74 293a 0a20   fingerprint):. 
-0001b5e0: 2020 2020 2020 2069 6620 6973 5f63 6163         if is_cac
-0001b5f0: 6869 6e67 5f65 6e61 626c 6564 2829 2061  hing_enabled() a
-0001b600: 6e64 2073 656c 662e 6361 6368 655f 6669  nd self.cache_fi
-0001b610: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
-0001b620: 2063 6163 6865 5f66 696c 655f 6e61 6d65   cache_file_name
-0001b630: 203d 2022 6361 6368 652d 2220 2b20 6669   = "cache-" + fi
-0001b640: 6e67 6572 7072 696e 7420 2b20 222e 6172  ngerprint + ".ar
-0001b650: 726f 7722 0a20 2020 2020 2020 2020 2020  row".           
-0001b660: 2063 6163 6865 5f64 6972 6563 746f 7279   cache_directory
-0001b670: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-0001b680: 6d65 2873 656c 662e 6361 6368 655f 6669  me(self.cache_fi
-0001b690: 6c65 735b 305d 5b22 6669 6c65 6e61 6d65  les[0]["filename
-0001b6a0: 225d 290a 2020 2020 2020 2020 656c 7365  "]).        else
-0001b6b0: 3a0a 2020 2020 2020 2020 2020 2020 6361  :.            ca
-0001b6c0: 6368 655f 6669 6c65 5f6e 616d 6520 3d20  che_file_name = 
-0001b6d0: 2263 6163 6865 2d22 202b 2067 656e 6572  "cache-" + gener
-0001b6e0: 6174 655f 7261 6e64 6f6d 5f66 696e 6765  ate_random_finge
-0001b6f0: 7270 7269 6e74 2829 202b 2022 2e61 7272  rprint() + ".arr
-0001b700: 6f77 220a 2020 2020 2020 2020 2020 2020  ow".            
-0001b710: 6361 6368 655f 6469 7265 6374 6f72 7920  cache_directory 
-0001b720: 3d20 6765 745f 7465 6d70 6f72 6172 795f  = get_temporary_
-0001b730: 6361 6368 655f 6669 6c65 735f 6469 7265  cache_files_dire
-0001b740: 6374 6f72 7928 290a 2020 2020 2020 2020  ctory().        
-0001b750: 6361 6368 655f 6669 6c65 5f70 6174 6820  cache_file_path 
-0001b760: 3d20 6f73 2e70 6174 682e 6a6f 696e 2863  = os.path.join(c
-0001b770: 6163 6865 5f64 6972 6563 746f 7279 2c20  ache_directory, 
-0001b780: 6361 6368 655f 6669 6c65 5f6e 616d 6529  cache_file_name)
-0001b790: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001b7a0: 6361 6368 655f 6669 6c65 5f70 6174 680a  cache_file_path.
-0001b7b0: 0a20 2020 2064 6566 206d 6170 280a 2020  .    def map(.  
-0001b7c0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0001b7d0: 2020 2020 6675 6e63 7469 6f6e 3a20 4f70      function: Op
-0001b7e0: 7469 6f6e 616c 5b43 616c 6c61 626c 655d  tional[Callable]
-0001b7f0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0001b800: 2077 6974 685f 696e 6469 6365 733a 2062   with_indices: b
-0001b810: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0001b820: 2020 2020 2077 6974 685f 7261 6e6b 3a20       with_rank: 
-0001b830: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0001b840: 2020 2020 2020 696e 7075 745f 636f 6c75        input_colu
-0001b850: 6d6e 733a 204f 7074 696f 6e61 6c5b 556e  mns: Optional[Un
-0001b860: 696f 6e5b 7374 722c 204c 6973 745b 7374  ion[str, List[st
-0001b870: 725d 5d5d 203d 204e 6f6e 652c 0a20 2020  r]]] = None,.   
-0001b880: 2020 2020 2062 6174 6368 6564 3a20 626f       batched: bo
-0001b890: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0001b8a0: 2020 2020 6261 7463 685f 7369 7a65 3a20      batch_size: 
-0001b8b0: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
-0001b8c0: 3130 3030 2c0a 2020 2020 2020 2020 6472  1000,.        dr
-0001b8d0: 6f70 5f6c 6173 745f 6261 7463 683a 2062  op_last_batch: b
-0001b8e0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0001b8f0: 2020 2020 2072 656d 6f76 655f 636f 6c75       remove_colu
-0001b900: 6d6e 733a 204f 7074 696f 6e61 6c5b 556e  mns: Optional[Un
-0001b910: 696f 6e5b 7374 722c 204c 6973 745b 7374  ion[str, List[st
-0001b920: 725d 5d5d 203d 204e 6f6e 652c 0a20 2020  r]]] = None,.   
-0001b930: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
-0001b940: 6f72 793a 2062 6f6f 6c20 3d20 4661 6c73  ory: bool = Fals
-0001b950: 652c 0a20 2020 2020 2020 206c 6f61 645f  e,.        load_
-0001b960: 6672 6f6d 5f63 6163 6865 5f66 696c 653a  from_cache_file:
-0001b970: 2062 6f6f 6c20 3d20 4e6f 6e65 2c0a 2020   bool = None,.  
-0001b980: 2020 2020 2020 6361 6368 655f 6669 6c65        cache_file
-0001b990: 5f6e 616d 653a 204f 7074 696f 6e61 6c5b  _name: Optional[
-0001b9a0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-0001b9b0: 2020 2020 2077 7269 7465 725f 6261 7463       writer_batc
-0001b9c0: 685f 7369 7a65 3a20 4f70 7469 6f6e 616c  h_size: Optional
-0001b9d0: 5b69 6e74 5d20 3d20 3130 3030 2c0a 2020  [int] = 1000,.  
-0001b9e0: 2020 2020 2020 6665 6174 7572 6573 3a20        features: 
-0001b9f0: 4f70 7469 6f6e 616c 5b46 6561 7475 7265  Optional[Feature
-0001ba00: 735d 203d 204e 6f6e 652c 0a20 2020 2020  s] = None,.     
-0001ba10: 2020 2064 6973 6162 6c65 5f6e 756c 6c61     disable_nulla
-0001ba20: 626c 653a 2062 6f6f 6c20 3d20 4661 6c73  ble: bool = Fals
-0001ba30: 652c 0a20 2020 2020 2020 2066 6e5f 6b77  e,.        fn_kw
-0001ba40: 6172 6773 3a20 4f70 7469 6f6e 616c 5b64  args: Optional[d
-0001ba50: 6963 745d 203d 204e 6f6e 652c 0a20 2020  ict] = None,.   
-0001ba60: 2020 2020 206e 756d 5f70 726f 633a 204f       num_proc: O
-0001ba70: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
-0001ba80: 6f6e 652c 0a20 2020 2020 2020 2073 7566  one,.        suf
-0001ba90: 6669 785f 7465 6d70 6c61 7465 3a20 7374  fix_template: st
-0001baa0: 7220 3d20 225f 7b72 616e 6b3a 3035 647d  r = "_{rank:05d}
-0001bab0: 5f6f 665f 7b6e 756d 5f70 726f 633a 3035  _of_{num_proc:05
-0001bac0: 647d 222c 0a20 2020 2020 2020 206e 6577  d}",.        new
-0001bad0: 5f66 696e 6765 7270 7269 6e74 3a20 4f70  _fingerprint: Op
-0001bae0: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-0001baf0: 6e65 2c0a 2020 2020 2020 2020 6465 7363  ne,.        desc
-0001bb00: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-0001bb10: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
-0001bb20: 2022 4461 7461 7365 7422 3a0a 2020 2020   "Dataset":.    
-0001bb30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001bb40: 4170 706c 7920 6120 6675 6e63 7469 6f6e  Apply a function
-0001bb50: 2074 6f20 616c 6c20 7468 6520 6578 616d   to all the exam
-0001bb60: 706c 6573 2069 6e20 7468 6520 7461 626c  ples in the tabl
-0001bb70: 6520 2869 6e64 6976 6964 7561 6c6c 7920  e (individually 
-0001bb80: 6f72 2069 6e20 6261 7463 6865 7329 2061  or in batches) a
-0001bb90: 6e64 2075 7064 6174 6520 7468 6520 7461  nd update the ta
-0001bba0: 626c 652e 0a20 2020 2020 2020 2049 6620  ble..        If 
-0001bbb0: 796f 7572 2066 756e 6374 696f 6e20 7265  your function re
-0001bbc0: 7475 726e 7320 6120 636f 6c75 6d6e 2074  turns a column t
-0001bbd0: 6861 7420 616c 7265 6164 7920 6578 6973  hat already exis
-0001bbe0: 7473 2c20 7468 656e 2069 7420 6f76 6572  ts, then it over
-0001bbf0: 7772 6974 6573 2069 742e 0a0a 2020 2020  writes it...    
-0001bc00: 2020 2020 596f 7520 6361 6e20 7370 6563      You can spec
-0001bc10: 6966 7920 7768 6574 6865 7220 7468 6520  ify whether the 
-0001bc20: 6675 6e63 7469 6f6e 2073 686f 756c 6420  function should 
-0001bc30: 6265 2062 6174 6368 6564 206f 7220 6e6f  be batched or no
-0001bc40: 7420 7769 7468 2074 6865 2060 6261 7463  t with the `batc
-0001bc50: 6865 6460 2070 6172 616d 6574 6572 3a0a  hed` parameter:.
-0001bc60: 0a20 2020 2020 2020 202d 2049 6620 6261  .        - If ba
-0001bc70: 7463 6865 6420 6973 2060 4661 6c73 6560  tched is `False`
-0001bc80: 2c20 7468 656e 2074 6865 2066 756e 6374  , then the funct
-0001bc90: 696f 6e20 7461 6b65 7320 3120 6578 616d  ion takes 1 exam
-0001bca0: 706c 6520 696e 2061 6e64 2073 686f 756c  ple in and shoul
-0001bcb0: 6420 7265 7475 726e 2031 2065 7861 6d70  d return 1 examp
-0001bcc0: 6c65 2e0a 2020 2020 2020 2020 2020 416e  le..          An
-0001bcd0: 2065 7861 6d70 6c65 2069 7320 6120 6469   example is a di
-0001bce0: 6374 696f 6e61 7279 2c20 652e 672e 2060  ctionary, e.g. `
-0001bcf0: 7b22 7465 7874 223a 2022 4865 6c6c 6f20  {"text": "Hello 
-0001bd00: 7468 6572 6520 2122 7d60 2e0a 2020 2020  there !"}`..    
-0001bd10: 2020 2020 2d20 4966 2062 6174 6368 6564      - If batched
-0001bd20: 2069 7320 6054 7275 6560 2061 6e64 2060   is `True` and `
-0001bd30: 6261 7463 685f 7369 7a65 6020 6973 2031  batch_size` is 1
-0001bd40: 2c20 7468 656e 2074 6865 2066 756e 6374  , then the funct
-0001bd50: 696f 6e20 7461 6b65 7320 6120 6261 7463  ion takes a batc
-0001bd60: 6820 6f66 2031 2065 7861 6d70 6c65 2061  h of 1 example a
-0001bd70: 7320 696e 7075 7420 616e 6420 6361 6e20  s input and can 
-0001bd80: 7265 7475 726e 2061 2062 6174 6368 2077  return a batch w
-0001bd90: 6974 6820 3120 6f72 206d 6f72 6520 6578  ith 1 or more ex
-0001bda0: 616d 706c 6573 2e0a 2020 2020 2020 2020  amples..        
-0001bdb0: 2020 4120 6261 7463 6820 6973 2061 2064    A batch is a d
-0001bdc0: 6963 7469 6f6e 6172 792c 2065 2e67 2e20  ictionary, e.g. 
-0001bdd0: 6120 6261 7463 6820 6f66 2031 2065 7861  a batch of 1 exa
-0001bde0: 6d70 6c65 2069 7320 607b 2274 6578 7422  mple is `{"text"
-0001bdf0: 3a20 5b22 4865 6c6c 6f20 7468 6572 6520  : ["Hello there 
-0001be00: 2122 5d7d 602e 0a20 2020 2020 2020 202d  !"]}`..        -
-0001be10: 2049 6620 6261 7463 6865 6420 6973 2060   If batched is `
-0001be20: 5472 7565 6020 616e 6420 6062 6174 6368  True` and `batch
-0001be30: 5f73 697a 6560 2069 7320 606e 203e 2031  _size` is `n > 1
-0001be40: 602c 2074 6865 6e20 7468 6520 6675 6e63  `, then the func
-0001be50: 7469 6f6e 2074 616b 6573 2061 2062 6174  tion takes a bat
-0001be60: 6368 206f 6620 606e 6020 6578 616d 706c  ch of `n` exampl
-0001be70: 6573 2061 7320 696e 7075 7420 616e 6420  es as input and 
-0001be80: 6361 6e20 7265 7475 726e 2061 2062 6174  can return a bat
-0001be90: 6368 2077 6974 6820 606e 6020 6578 616d  ch with `n` exam
-0001bea0: 706c 6573 2c20 6f72 2077 6974 6820 616e  ples, or with an
-0001beb0: 2061 7262 6974 7261 7279 206e 756d 6265   arbitrary numbe
-0001bec0: 7220 6f66 2065 7861 6d70 6c65 732e 0a20  r of examples.. 
-0001bed0: 2020 2020 2020 2020 204e 6f74 6520 7468           Note th
-0001bee0: 6174 2074 6865 206c 6173 7420 6261 7463  at the last batc
-0001bef0: 6820 6d61 7920 6861 7665 206c 6573 7320  h may have less 
-0001bf00: 7468 616e 2060 6e60 2065 7861 6d70 6c65  than `n` example
-0001bf10: 732e 0a20 2020 2020 2020 2020 2041 2062  s..          A b
-0001bf20: 6174 6368 2069 7320 6120 6469 6374 696f  atch is a dictio
-0001bf30: 6e61 7279 2c20 652e 672e 2061 2062 6174  nary, e.g. a bat
-0001bf40: 6368 206f 6620 606e 6020 6578 616d 706c  ch of `n` exampl
-0001bf50: 6573 2069 7320 607b 2274 6578 7422 3a20  es is `{"text": 
-0001bf60: 5b22 4865 6c6c 6f20 7468 6572 6520 2122  ["Hello there !"
-0001bf70: 5d20 2a20 6e7d 602e 0a0a 2020 2020 2020  ] * n}`...      
-0001bf80: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-0001bf90: 2020 2020 6675 6e63 7469 6f6e 2028 6043      function (`C
-0001bfa0: 616c 6c61 626c 6560 293a 2046 756e 6374  allable`): Funct
-0001bfb0: 696f 6e20 7769 7468 206f 6e65 206f 6620  ion with one of 
-0001bfc0: 7468 6520 666f 6c6c 6f77 696e 6720 7369  the following si
-0001bfd0: 676e 6174 7572 6573 3a0a 0a20 2020 2020  gnatures:..     
-0001bfe0: 2020 2020 2020 2020 2020 202d 2060 6675             - `fu
-0001bff0: 6e63 7469 6f6e 2865 7861 6d70 6c65 3a20  nction(example: 
-0001c000: 4469 6374 5b73 7472 2c20 416e 795d 2920  Dict[str, Any]) 
-0001c010: 2d3e 2044 6963 745b 7374 722c 2041 6e79  -> Dict[str, Any
-0001c020: 5d60 2069 6620 6062 6174 6368 6564 3d46  ]` if `batched=F
-0001c030: 616c 7365 6020 616e 6420 6077 6974 685f  alse` and `with_
-0001c040: 696e 6469 6365 733d 4661 6c73 6560 2061  indices=False` a
-0001c050: 6e64 2060 7769 7468 5f72 616e 6b3d 4661  nd `with_rank=Fa
-0001c060: 6c73 6560 0a20 2020 2020 2020 2020 2020  lse`.           
-0001c070: 2020 2020 202d 2060 6675 6e63 7469 6f6e       - `function
-0001c080: 2865 7861 6d70 6c65 3a20 4469 6374 5b73  (example: Dict[s
-0001c090: 7472 2c20 416e 795d 2c20 2a65 7874 7261  tr, Any], *extra
-0001c0a0: 5f61 7267 7329 202d 3e20 4469 6374 5b73  _args) -> Dict[s
-0001c0b0: 7472 2c20 416e 795d 6020 6966 2060 6261  tr, Any]` if `ba
-0001c0c0: 7463 6865 643d 4661 6c73 6560 2061 6e64  tched=False` and
-0001c0d0: 2060 7769 7468 5f69 6e64 6963 6573 3d54   `with_indices=T
-0001c0e0: 7275 6560 2061 6e64 2f6f 7220 6077 6974  rue` and/or `wit
-0001c0f0: 685f 7261 6e6b 3d54 7275 6560 2028 6f6e  h_rank=True` (on
-0001c100: 6520 6578 7472 6120 6172 6720 666f 7220  e extra arg for 
-0001c110: 6561 6368 290a 2020 2020 2020 2020 2020  each).          
-0001c120: 2020 2020 2020 2d20 6066 756e 6374 696f        - `functio
-0001c130: 6e28 6261 7463 683a 2044 6963 745b 7374  n(batch: Dict[st
-0001c140: 722c 204c 6973 745d 2920 2d3e 2044 6963  r, List]) -> Dic
-0001c150: 745b 7374 722c 204c 6973 745d 6020 6966  t[str, List]` if
-0001c160: 2060 6261 7463 6865 643d 5472 7565 6020   `batched=True` 
-0001c170: 616e 6420 6077 6974 685f 696e 6469 6365  and `with_indice
-0001c180: 733d 4661 6c73 6560 2061 6e64 2060 7769  s=False` and `wi
-0001c190: 7468 5f72 616e 6b3d 4661 6c73 6560 0a20  th_rank=False`. 
-0001c1a0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-0001c1b0: 2060 6675 6e63 7469 6f6e 2862 6174 6368   `function(batch
-0001c1c0: 3a20 4469 6374 5b73 7472 2c20 4c69 7374  : Dict[str, List
-0001c1d0: 5d2c 202a 6578 7472 615f 6172 6773 2920  ], *extra_args) 
-0001c1e0: 2d3e 2044 6963 745b 7374 722c 204c 6973  -> Dict[str, Lis
-0001c1f0: 745d 6020 6966 2060 6261 7463 6865 643d  t]` if `batched=
-0001c200: 5472 7565 6020 616e 6420 6077 6974 685f  True` and `with_
-0001c210: 696e 6469 6365 733d 5472 7565 6020 616e  indices=True` an
-0001c220: 642f 6f72 2060 7769 7468 5f72 616e 6b3d  d/or `with_rank=
-0001c230: 5472 7565 6020 286f 6e65 2065 7874 7261  True` (one extra
-0001c240: 2061 7267 2066 6f72 2065 6163 6829 0a0a   arg for each)..
-0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c260: 466f 7220 6164 7661 6e63 6564 2075 7361  For advanced usa
-0001c270: 6765 2c20 7468 6520 6675 6e63 7469 6f6e  ge, the function
-0001c280: 2063 616e 2061 6c73 6f20 7265 7475 726e   can also return
-0001c290: 2061 2060 7079 6172 726f 772e 5461 626c   a `pyarrow.Tabl
-0001c2a0: 6560 2e0a 2020 2020 2020 2020 2020 2020  e`..            
-0001c2b0: 2020 2020 4d6f 7265 6f76 6572 2069 6620      Moreover if 
-0001c2c0: 796f 7572 2066 756e 6374 696f 6e20 7265  your function re
-0001c2d0: 7475 726e 7320 6e6f 7468 696e 6720 2860  turns nothing (`
-0001c2e0: 4e6f 6e65 6029 2c20 7468 656e 2060 6d61  None`), then `ma
-0001c2f0: 7060 2077 696c 6c20 7275 6e20 796f 7572  p` will run your
-0001c300: 2066 756e 6374 696f 6e20 616e 6420 7265   function and re
-0001c310: 7475 726e 2074 6865 2064 6174 6173 6574  turn the dataset
-0001c320: 2075 6e63 6861 6e67 6564 2e0a 2020 2020   unchanged..    
-0001c330: 2020 2020 2020 2020 2020 2020 4966 206e              If n
-0001c340: 6f20 6675 6e63 7469 6f6e 2069 7320 7072  o function is pr
-0001c350: 6f76 6964 6564 2c20 6465 6661 756c 7420  ovided, default 
-0001c360: 746f 2069 6465 6e74 6974 7920 6675 6e63  to identity func
-0001c370: 7469 6f6e 3a20 606c 616d 6264 6120 783a  tion: `lambda x:
-0001c380: 2078 602e 0a20 2020 2020 2020 2020 2020   x`..           
-0001c390: 2077 6974 685f 696e 6469 6365 7320 2860   with_indices (`
-0001c3a0: 626f 6f6c 602c 2064 6566 6175 6c74 7320  bool`, defaults 
-0001c3b0: 746f 2060 4661 6c73 6560 293a 0a20 2020  to `False`):.   
-0001c3c0: 2020 2020 2020 2020 2020 2020 2050 726f               Pro
-0001c3d0: 7669 6465 2065 7861 6d70 6c65 2069 6e64  vide example ind
-0001c3e0: 6963 6573 2074 6f20 6066 756e 6374 696f  ices to `functio
-0001c3f0: 6e60 2e20 4e6f 7465 2074 6861 7420 696e  n`. Note that in
-0001c400: 2074 6869 7320 6361 7365 2074 6865 0a20   this case the. 
-0001c410: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001c420: 6967 6e61 7475 7265 206f 6620 6066 756e  ignature of `fun
-0001c430: 6374 696f 6e60 2073 686f 756c 6420 6265  ction` should be
-0001c440: 2060 6465 6620 6675 6e63 7469 6f6e 2865   `def function(e
-0001c450: 7861 6d70 6c65 2c20 6964 785b 2c20 7261  xample, idx[, ra
-0001c460: 6e6b 5d29 3a20 2e2e 2e60 2e0a 2020 2020  nk]): ...`..    
-0001c470: 2020 2020 2020 2020 7769 7468 5f72 616e          with_ran
-0001c480: 6b20 2860 626f 6f6c 602c 2064 6566 6175  k (`bool`, defau
-0001c490: 6c74 7320 746f 2060 4661 6c73 6560 293a  lts to `False`):
-0001c4a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c4b0: 2050 726f 7669 6465 2070 726f 6365 7373   Provide process
-0001c4c0: 2072 616e 6b20 746f 2060 6675 6e63 7469   rank to `functi
-0001c4d0: 6f6e 602e 204e 6f74 6520 7468 6174 2069  on`. Note that i
-0001c4e0: 6e20 7468 6973 2063 6173 6520 7468 650a  n this case the.
-0001c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c500: 7369 676e 6174 7572 6520 6f66 2060 6675  signature of `fu
-0001c510: 6e63 7469 6f6e 6020 7368 6f75 6c64 2062  nction` should b
-0001c520: 6520 6064 6566 2066 756e 6374 696f 6e28  e `def function(
-0001c530: 6578 616d 706c 655b 2c20 6964 785d 2c20  example[, idx], 
-0001c540: 7261 6e6b 293a 202e 2e2e 602e 0a20 2020  rank): ...`..   
-0001c550: 2020 2020 2020 2020 2069 6e70 7574 5f63           input_c
-0001c560: 6f6c 756d 6e73 2028 604f 7074 696f 6e61  olumns (`Optiona
-0001c570: 6c5b 556e 696f 6e5b 7374 722c 204c 6973  l[Union[str, Lis
-0001c580: 745b 7374 725d 5d5d 602c 2064 6566 6175  t[str]]]`, defau
-0001c590: 6c74 7320 746f 2060 4e6f 6e65 6029 3a0a  lts to `None`):.
-0001c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5b0: 5468 6520 636f 6c75 6d6e 7320 746f 2062  The columns to b
-0001c5c0: 6520 7061 7373 6564 2069 6e74 6f20 6066  e passed into `f
-0001c5d0: 756e 6374 696f 6e60 0a20 2020 2020 2020  unction`.       
-0001c5e0: 2020 2020 2020 2020 2061 7320 706f 7369           as posi
-0001c5f0: 7469 6f6e 616c 2061 7267 756d 656e 7473  tional arguments
-0001c600: 2e20 4966 2060 4e6f 6e65 602c 2061 2060  . If `None`, a `
-0001c610: 6469 6374 6020 6d61 7070 696e 6720 746f  dict` mapping to
-0001c620: 2061 6c6c 2066 6f72 6d61 7474 6564 2063   all formatted c
-0001c630: 6f6c 756d 6e73 2069 7320 7061 7373 6564  olumns is passed
-0001c640: 2061 7320 6f6e 6520 6172 6775 6d65 6e74   as one argument
-0001c650: 2e0a 2020 2020 2020 2020 2020 2020 6261  ..            ba
-0001c660: 7463 6865 6420 2860 626f 6f6c 602c 2064  tched (`bool`, d
-0001c670: 6566 6175 6c74 7320 746f 2060 4661 6c73  efaults to `Fals
-0001c680: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
-0001c690: 2020 2020 2050 726f 7669 6465 2062 6174       Provide bat
-0001c6a0: 6368 206f 6620 6578 616d 706c 6573 2074  ch of examples t
-0001c6b0: 6f20 6066 756e 6374 696f 6e60 2e0a 2020  o `function`..  
-0001c6c0: 2020 2020 2020 2020 2020 6261 7463 685f            batch_
-0001c6d0: 7369 7a65 2028 6069 6e74 602c 202a 6f70  size (`int`, *op
-0001c6e0: 7469 6f6e 616c 2a2c 2064 6566 6175 6c74  tional*, default
-0001c6f0: 7320 746f 2060 3130 3030 6029 3a0a 2020  s to `1000`):.  
-0001c700: 2020 2020 2020 2020 2020 2020 2020 4e75                Nu
-0001c710: 6d62 6572 206f 6620 6578 616d 706c 6573  mber of examples
-0001c720: 2070 6572 2062 6174 6368 2070 726f 7669   per batch provi
-0001c730: 6465 6420 746f 2060 6675 6e63 7469 6f6e  ded to `function
-0001c740: 6020 6966 2060 6261 7463 6865 643d 5472  ` if `batched=Tr
-0001c750: 7565 602e 0a20 2020 2020 2020 2020 2020  ue`..           
-0001c760: 2020 2020 2049 6620 6062 6174 6368 5f73       If `batch_s
-0001c770: 697a 6520 3c3d 2030 6020 6f72 2060 6261  ize <= 0` or `ba
-0001c780: 7463 685f 7369 7a65 203d 3d20 4e6f 6e65  tch_size == None
-0001c790: 602c 2070 726f 7669 6465 2074 6865 2066  `, provide the f
-0001c7a0: 756c 6c20 6461 7461 7365 7420 6173 2061  ull dataset as a
-0001c7b0: 2073 696e 676c 6520 6261 7463 6820 746f   single batch to
-0001c7c0: 2060 6675 6e63 7469 6f6e 602e 0a20 2020   `function`..   
-0001c7d0: 2020 2020 2020 2020 2064 726f 705f 6c61           drop_la
-0001c7e0: 7374 5f62 6174 6368 2028 6062 6f6f 6c60  st_batch (`bool`
-0001c7f0: 2c20 6465 6661 756c 7473 2074 6f20 6046  , defaults to `F
-0001c800: 616c 7365 6029 3a0a 2020 2020 2020 2020  alse`):.        
-0001c810: 2020 2020 2020 2020 5768 6574 6865 7220          Whether 
-0001c820: 6120 6c61 7374 2062 6174 6368 2073 6d61  a last batch sma
-0001c830: 6c6c 6572 2074 6861 6e20 7468 6520 6261  ller than the ba
-0001c840: 7463 685f 7369 7a65 2073 686f 756c 6420  tch_size should 
-0001c850: 6265 0a20 2020 2020 2020 2020 2020 2020  be.             
-0001c860: 2020 2064 726f 7070 6564 2069 6e73 7465     dropped inste
-0001c870: 6164 206f 6620 6265 696e 6720 7072 6f63  ad of being proc
-0001c880: 6573 7365 6420 6279 2074 6865 2066 756e  essed by the fun
-0001c890: 6374 696f 6e2e 0a20 2020 2020 2020 2020  ction..         
-0001c8a0: 2020 2072 656d 6f76 655f 636f 6c75 6d6e     remove_column
-0001c8b0: 7320 2860 4f70 7469 6f6e 616c 5b55 6e69  s (`Optional[Uni
-0001c8c0: 6f6e 5b73 7472 2c20 4c69 7374 5b73 7472  on[str, List[str
-0001c8d0: 5d5d 5d60 2c20 6465 6661 756c 7473 2074  ]]]`, defaults t
-0001c8e0: 6f20 604e 6f6e 6560 293a 0a20 2020 2020  o `None`):.     
-0001c8f0: 2020 2020 2020 2020 2020 2052 656d 6f76             Remov
-0001c900: 6520 6120 7365 6c65 6374 696f 6e20 6f66  e a selection of
-0001c910: 2063 6f6c 756d 6e73 2077 6869 6c65 2064   columns while d
-0001c920: 6f69 6e67 2074 6865 206d 6170 7069 6e67  oing the mapping
-0001c930: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001c940: 2020 436f 6c75 6d6e 7320 7769 6c6c 2062    Columns will b
-0001c950: 6520 7265 6d6f 7665 6420 6265 666f 7265  e removed before
-0001c960: 2075 7064 6174 696e 6720 7468 6520 6578   updating the ex
-0001c970: 616d 706c 6573 2077 6974 6820 7468 6520  amples with the 
-0001c980: 6f75 7470 7574 206f 6620 6066 756e 6374  output of `funct
-0001c990: 696f 6e60 2c20 692e 652e 2069 6620 6066  ion`, i.e. if `f
-0001c9a0: 756e 6374 696f 6e60 2069 7320 6164 6469  unction` is addi
-0001c9b0: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
-0001c9c0: 2020 2063 6f6c 756d 6e73 2077 6974 6820     columns with 
-0001c9d0: 6e61 6d65 7320 696e 2060 7265 6d6f 7665  names in `remove
-0001c9e0: 5f63 6f6c 756d 6e73 602c 2074 6865 7365  _columns`, these
-0001c9f0: 2063 6f6c 756d 6e73 2077 696c 6c20 6265   columns will be
-0001ca00: 206b 6570 742e 0a20 2020 2020 2020 2020   kept..         
-0001ca10: 2020 206b 6565 705f 696e 5f6d 656d 6f72     keep_in_memor
-0001ca20: 7920 2860 626f 6f6c 602c 2064 6566 6175  y (`bool`, defau
-0001ca30: 6c74 7320 746f 2060 4661 6c73 6560 293a  lts to `False`):
-0001ca40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ca50: 204b 6565 7020 7468 6520 6461 7461 7365   Keep the datase
-0001ca60: 7420 696e 206d 656d 6f72 7920 696e 7374  t in memory inst
-0001ca70: 6561 6420 6f66 2077 7269 7469 6e67 2069  ead of writing i
-0001ca80: 7420 746f 2061 2063 6163 6865 2066 696c  t to a cache fil
-0001ca90: 652e 0a20 2020 2020 2020 2020 2020 206c  e..            l
-0001caa0: 6f61 645f 6672 6f6d 5f63 6163 6865 5f66  oad_from_cache_f
-0001cab0: 696c 6520 2860 626f 6f6c 602c 2064 6566  ile (`bool`, def
-0001cac0: 6175 6c74 7320 746f 2060 5472 7565 6020  aults to `True` 
-0001cad0: 6966 2063 6163 6869 6e67 2069 7320 656e  if caching is en
-0001cae0: 6162 6c65 6429 3a0a 2020 2020 2020 2020  abled):.        
-0001caf0: 2020 2020 2020 2020 4966 2061 2063 6163          If a cac
-0001cb00: 6865 2066 696c 6520 7374 6f72 696e 6720  he file storing 
-0001cb10: 7468 6520 6375 7272 656e 7420 636f 6d70  the current comp
-0001cb20: 7574 6174 696f 6e20 6672 6f6d 2060 6675  utation from `fu
-0001cb30: 6e63 7469 6f6e 600a 2020 2020 2020 2020  nction`.        
-0001cb40: 2020 2020 2020 2020 6361 6e20 6265 2069          can be i
-0001cb50: 6465 6e74 6966 6965 642c 2075 7365 2069  dentified, use i
-0001cb60: 7420 696e 7374 6561 6420 6f66 2072 6563  t instead of rec
-0001cb70: 6f6d 7075 7469 6e67 2e0a 2020 2020 2020  omputing..      
-0001cb80: 2020 2020 2020 6361 6368 655f 6669 6c65        cache_file
-0001cb90: 5f6e 616d 6520 2860 7374 7260 2c20 2a6f  _name (`str`, *o
-0001cba0: 7074 696f 6e61 6c2a 2c20 6465 6661 756c  ptional*, defaul
-0001cbb0: 7473 2074 6f20 604e 6f6e 6560 293a 0a20  ts to `None`):. 
-0001cbc0: 2020 2020 2020 2020 2020 2020 2020 2050                 P
-0001cbd0: 726f 7669 6465 2074 6865 206e 616d 6520  rovide the name 
-0001cbe0: 6f66 2061 2070 6174 6820 666f 7220 7468  of a path for th
-0001cbf0: 6520 6361 6368 6520 6669 6c65 2e20 4974  e cache file. It
-0001cc00: 2069 7320 7573 6564 2074 6f20 7374 6f72   is used to stor
-0001cc10: 6520 7468 650a 2020 2020 2020 2020 2020  e the.          
-0001cc20: 2020 2020 2020 7265 7375 6c74 7320 6f66        results of
-0001cc30: 2074 6865 2063 6f6d 7075 7461 7469 6f6e   the computation
-0001cc40: 2069 6e73 7465 6164 206f 6620 7468 6520   instead of the 
-0001cc50: 6175 746f 6d61 7469 6361 6c6c 7920 6765  automatically ge
-0001cc60: 6e65 7261 7465 6420 6361 6368 6520 6669  nerated cache fi
-0001cc70: 6c65 206e 616d 652e 0a20 2020 2020 2020  le name..       
-0001cc80: 2020 2020 2077 7269 7465 725f 6261 7463       writer_batc
-0001cc90: 685f 7369 7a65 2028 6069 6e74 602c 2064  h_size (`int`, d
-0001cca0: 6566 6175 6c74 7320 746f 2060 3130 3030  efaults to `1000
-0001ccb0: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
-0001ccc0: 2020 2020 4e75 6d62 6572 206f 6620 726f      Number of ro
-0001ccd0: 7773 2070 6572 2077 7269 7465 206f 7065  ws per write ope
-0001cce0: 7261 7469 6f6e 2066 6f72 2074 6865 2063  ration for the c
-0001ccf0: 6163 6865 2066 696c 6520 7772 6974 6572  ache file writer
-0001cd00: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001cd10: 2020 5468 6973 2076 616c 7565 2069 7320    This value is 
-0001cd20: 6120 676f 6f64 2074 7261 6465 2d6f 6666  a good trade-off
-0001cd30: 2062 6574 7765 656e 206d 656d 6f72 7920   between memory 
-0001cd40: 7573 6167 6520 6475 7269 6e67 2074 6865  usage during the
-0001cd50: 2070 726f 6365 7373 696e 672c 2061 6e64   processing, and
-0001cd60: 2070 726f 6365 7373 696e 6720 7370 6565   processing spee
-0001cd70: 642e 0a20 2020 2020 2020 2020 2020 2020  d..             
-0001cd80: 2020 2048 6967 6865 7220 7661 6c75 6520     Higher value 
-0001cd90: 6d61 6b65 7320 7468 6520 7072 6f63 6573  makes the proces
-0001cda0: 7369 6e67 2064 6f20 6665 7765 7220 6c6f  sing do fewer lo
-0001cdb0: 6f6b 7570 732c 206c 6f77 6572 2076 616c  okups, lower val
-0001cdc0: 7565 2063 6f6e 7375 6d65 206c 6573 7320  ue consume less 
-0001cdd0: 7465 6d70 6f72 6172 7920 6d65 6d6f 7279  temporary memory
-0001cde0: 2077 6869 6c65 2072 756e 6e69 6e67 2060   while running `
-0001cdf0: 6d61 7060 2e0a 2020 2020 2020 2020 2020  map`..          
-0001ce00: 2020 6665 6174 7572 6573 2028 604f 7074    features (`Opt
-0001ce10: 696f 6e61 6c5b 6461 7461 7365 7473 2e46  ional[datasets.F
-0001ce20: 6561 7475 7265 735d 602c 2064 6566 6175  eatures]`, defau
-0001ce30: 6c74 7320 746f 2060 4e6f 6e65 6029 3a0a  lts to `None`):.
-0001ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce50: 5573 6520 6120 7370 6563 6966 6963 2046  Use a specific F
-0001ce60: 6561 7475 7265 7320 746f 2073 746f 7265  eatures to store
-0001ce70: 2074 6865 2063 6163 6865 2066 696c 650a   the cache file.
-0001ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce90: 696e 7374 6561 6420 6f66 2074 6865 2061  instead of the a
-0001cea0: 7574 6f6d 6174 6963 616c 6c79 2067 656e  utomatically gen
-0001ceb0: 6572 6174 6564 206f 6e65 2e0a 2020 2020  erated one..    
-0001cec0: 2020 2020 2020 2020 6469 7361 626c 655f          disable_
-0001ced0: 6e75 6c6c 6162 6c65 2028 6062 6f6f 6c60  nullable (`bool`
-0001cee0: 2c20 6465 6661 756c 7473 2074 6f20 6046  , defaults to `F
-0001cef0: 616c 7365 6029 3a0a 2020 2020 2020 2020  alse`):.        
-0001cf00: 2020 2020 2020 2020 4469 7361 6c6c 6f77          Disallow
-0001cf10: 206e 756c 6c20 7661 6c75 6573 2069 6e20   null values in 
-0001cf20: 7468 6520 7461 626c 652e 0a20 2020 2020  the table..     
-0001cf30: 2020 2020 2020 2066 6e5f 6b77 6172 6773         fn_kwargs
-0001cf40: 2028 6044 6963 7460 2c20 2a6f 7074 696f   (`Dict`, *optio
-0001cf50: 6e61 6c2a 2c20 6465 6661 756c 7473 2074  nal*, defaults t
-0001cf60: 6f20 604e 6f6e 6560 293a 0a20 2020 2020  o `None`):.     
-0001cf70: 2020 2020 2020 2020 2020 204b 6579 776f             Keywo
-0001cf80: 7264 2061 7267 756d 656e 7473 2074 6f20  rd arguments to 
-0001cf90: 6265 2070 6173 7365 6420 746f 2060 6675  be passed to `fu
-0001cfa0: 6e63 7469 6f6e 602e 0a20 2020 2020 2020  nction`..       
-0001cfb0: 2020 2020 206e 756d 5f70 726f 6320 2860       num_proc (`
-0001cfc0: 696e 7460 2c20 2a6f 7074 696f 6e61 6c2a  int`, *optional*
-0001cfd0: 2c20 6465 6661 756c 7473 2074 6f20 604e  , defaults to `N
-0001cfe0: 6f6e 6560 293a 0a20 2020 2020 2020 2020  one`):.         
-0001cff0: 2020 2020 2020 204d 6178 206e 756d 6265         Max numbe
-0001d000: 7220 6f66 2070 726f 6365 7373 6573 2077  r of processes w
-0001d010: 6865 6e20 6765 6e65 7261 7469 6e67 2063  hen generating c
-0001d020: 6163 6865 2e20 416c 7265 6164 7920 6361  ache. Already ca
-0001d030: 6368 6564 2073 6861 7264 7320 6172 6520  ched shards are 
-0001d040: 6c6f 6164 6564 2073 6571 7565 6e74 6961  loaded sequentia
-0001d050: 6c6c 792e 0a20 2020 2020 2020 2020 2020  lly..           
-0001d060: 2073 7566 6669 785f 7465 6d70 6c61 7465   suffix_template
-0001d070: 2028 6073 7472 6029 3a0a 2020 2020 2020   (`str`):.      
-0001d080: 2020 2020 2020 2020 2020 4966 2060 6361            If `ca
-0001d090: 6368 655f 6669 6c65 5f6e 616d 6560 2069  che_file_name` i
-0001d0a0: 7320 7370 6563 6966 6965 642c 2074 6865  s specified, the
-0001d0b0: 6e20 7468 6973 2073 7566 6669 780a 2020  n this suffix.  
-0001d0c0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-0001d0d0: 6c6c 2062 6520 6164 6465 6420 6174 2074  ll be added at t
-0001d0e0: 6865 2065 6e64 206f 6620 7468 6520 6261  he end of the ba
-0001d0f0: 7365 206e 616d 6520 6f66 2065 6163 682e  se name of each.
-0001d100: 2044 6566 6175 6c74 7320 746f 2060 225f   Defaults to `"_
-0001d110: 7b72 616e 6b3a 3035 647d 5f6f 665f 7b6e  {rank:05d}_of_{n
-0001d120: 756d 5f70 726f 633a 3035 647d 2260 2e20  um_proc:05d}"`. 
-0001d130: 466f 7220 6578 616d 706c 652c 2069 6620  For example, if 
-0001d140: 6063 6163 6865 5f66 696c 655f 6e61 6d65  `cache_file_name
-0001d150: 6020 6973 2022 7072 6f63 6573 7365 642e  ` is "processed.
-0001d160: 6172 726f 7722 2c20 7468 656e 2066 6f72  arrow", then for
-0001d170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d180: 2060 7261 6e6b 3d31 6020 616e 6420 606e   `rank=1` and `n
-0001d190: 756d 5f70 726f 633d 3460 2c20 7468 6520  um_proc=4`, the 
-0001d1a0: 7265 7375 6c74 696e 6720 6669 6c65 2077  resulting file w
-0001d1b0: 6f75 6c64 2062 6520 6022 7072 6f63 6573  ould be `"proces
-0001d1c0: 7365 645f 3030 3030 315f 6f66 5f30 3030  sed_00001_of_000
-0001d1d0: 3034 2e61 7272 6f77 2260 2066 6f72 2074  04.arrow"` for t
-0001d1e0: 6865 2064 6566 6175 6c74 2073 7566 6669  he default suffi
-0001d1f0: 782e 0a20 2020 2020 2020 2020 2020 206e  x..            n
-0001d200: 6577 5f66 696e 6765 7270 7269 6e74 2028  ew_fingerprint (
-0001d210: 6073 7472 602c 202a 6f70 7469 6f6e 616c  `str`, *optional
-0001d220: 2a2c 2064 6566 6175 6c74 7320 746f 2060  *, defaults to `
-0001d230: 4e6f 6e65 6029 3a0a 2020 2020 2020 2020  None`):.        
-0001d240: 2020 2020 2020 2020 5468 6520 6e65 7720          The new 
-0001d250: 6669 6e67 6572 7072 696e 7420 6f66 2074  fingerprint of t
-0001d260: 6865 2064 6174 6173 6574 2061 6674 6572  he dataset after
-0001d270: 2074 7261 6e73 666f 726d 2e0a 2020 2020   transform..    
-0001d280: 2020 2020 2020 2020 2020 2020 4966 2060              If `
-0001d290: 4e6f 6e65 602c 2074 6865 206e 6577 2066  None`, the new f
-0001d2a0: 696e 6765 7270 7269 6e74 2069 7320 636f  ingerprint is co
-0001d2b0: 6d70 7574 6564 2075 7369 6e67 2061 2068  mputed using a h
-0001d2c0: 6173 6820 6f66 2074 6865 2070 7265 7669  ash of the previ
-0001d2d0: 6f75 7320 6669 6e67 6572 7072 696e 742c  ous fingerprint,
-0001d2e0: 2061 6e64 2074 6865 2074 7261 6e73 666f   and the transfo
-0001d2f0: 726d 2061 7267 756d 656e 7473 2e0a 2020  rm arguments..  
-0001d300: 2020 2020 2020 2020 2020 6465 7363 2028            desc (
-0001d310: 6073 7472 602c 202a 6f70 7469 6f6e 616c  `str`, *optional
-0001d320: 2a2c 2064 6566 6175 6c74 7320 746f 2060  *, defaults to `
-0001d330: 4e6f 6e65 6029 3a0a 2020 2020 2020 2020  None`):.        
-0001d340: 2020 2020 2020 2020 4d65 616e 696e 6766          Meaningf
-0001d350: 756c 2064 6573 6372 6970 7469 6f6e 2074  ul description t
-0001d360: 6f20 6265 2064 6973 706c 6179 6564 2061  o be displayed a
-0001d370: 6c6f 6e67 7369 6465 2077 6974 6820 7468  longside with th
-0001d380: 6520 7072 6f67 7265 7373 2062 6172 2077  e progress bar w
-0001d390: 6869 6c65 206d 6170 7069 6e67 2065 7861  hile mapping exa
-0001d3a0: 6d70 6c65 732e 0a0a 2020 2020 2020 2020  mples...        
-0001d3b0: 4578 616d 706c 653a 0a0a 2020 2020 2020  Example:..      
-0001d3c0: 2020 6060 6070 790a 2020 2020 2020 2020    ```py.        
-0001d3d0: 3e3e 3e20 6672 6f6d 2064 6174 6173 6574  >>> from dataset
-0001d3e0: 7320 696d 706f 7274 206c 6f61 645f 6461  s import load_da
-0001d3f0: 7461 7365 740a 2020 2020 2020 2020 3e3e  taset.        >>
-0001d400: 3e20 6473 203d 206c 6f61 645f 6461 7461  > ds = load_data
-0001d410: 7365 7428 2272 6f74 7465 6e5f 746f 6d61  set("rotten_toma
-0001d420: 746f 6573 222c 2073 706c 6974 3d22 7661  toes", split="va
-0001d430: 6c69 6461 7469 6f6e 2229 0a20 2020 2020  lidation").     
-0001d440: 2020 203e 3e3e 2064 6566 2061 6464 5f70     >>> def add_p
-0001d450: 7265 6669 7828 6578 616d 706c 6529 3a0a  refix(example):.
-0001d460: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-0001d470: 6578 616d 706c 655b 2274 6578 7422 5d20  example["text"] 
-0001d480: 3d20 2252 6576 6965 773a 2022 202b 2065  = "Review: " + e
-0001d490: 7861 6d70 6c65 5b22 7465 7874 225d 0a20  xample["text"]. 
-0001d4a0: 2020 2020 2020 202e 2e2e 2020 2020 2072         ...     r
-0001d4b0: 6574 7572 6e20 6578 616d 706c 650a 2020  eturn example.  
-0001d4c0: 2020 2020 2020 3e3e 3e20 6473 203d 2064        >>> ds = d
-0001d4d0: 732e 6d61 7028 6164 645f 7072 6566 6978  s.map(add_prefix
-0001d4e0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
-0001d4f0: 5b30 3a33 5d5b 2274 6578 7422 5d0a 2020  [0:3]["text"].  
-0001d500: 2020 2020 2020 5b27 5265 7669 6577 3a20        ['Review: 
-0001d510: 636f 6d70 6173 7369 6f6e 6174 656c 7920  compassionately 
-0001d520: 6578 706c 6f72 6573 2074 6865 2073 6565  explores the see
-0001d530: 6d69 6e67 6c79 2069 7272 6563 6f6e 6369  mingly irreconci
-0001d540: 6c61 626c 6520 7369 7475 6174 696f 6e20  lable situation 
-0001d550: 6265 7477 6565 6e20 636f 6e73 6572 7661  between conserva
-0001d560: 7469 7665 2063 6872 6973 7469 616e 2070  tive christian p
-0001d570: 6172 656e 7473 2061 6e64 2074 6865 6972  arents and their
-0001d580: 2065 7374 7261 6e67 6564 2067 6179 2061   estranged gay a
-0001d590: 6e64 206c 6573 6269 616e 2063 6869 6c64  nd lesbian child
-0001d5a0: 7265 6e20 2e27 2c0a 2020 2020 2020 2020  ren .',.        
-0001d5b0: 2027 5265 7669 6577 3a20 7468 6520 736f   'Review: the so
-0001d5c0: 756e 6474 7261 636b 2061 6c6f 6e65 2069  undtrack alone i
-0001d5d0: 7320 776f 7274 6820 7468 6520 7072 6963  s worth the pric
-0001d5e0: 6520 6f66 2061 646d 6973 7369 6f6e 202e  e of admission .
-0001d5f0: 272c 0a20 2020 2020 2020 2020 2752 6576  ',.         'Rev
-0001d600: 6965 773a 2072 6f64 7269 6775 657a 2064  iew: rodriguez d
-0001d610: 6f65 7320 6120 7370 6c65 6e64 6964 206a  oes a splendid j
-0001d620: 6f62 206f 6620 7261 6369 616c 2070 726f  ob of racial pro
-0001d630: 6669 6c69 6e67 2068 6f6c 6c79 776f 6f64  filing hollywood
-0001d640: 2073 7479 6c65 2d2d 6361 7374 696e 6720   style--casting 
-0001d650: 6578 6365 6c6c 656e 7420 6c61 7469 6e20  excellent latin 
-0001d660: 6163 746f 7273 206f 6620 616c 6c20 6167  actors of all ag
-0001d670: 6573 2d2d 6120 7472 656e 6420 6c6f 6e67  es--a trend long
-0001d680: 206f 7665 7264 7565 202e 275d 0a0a 2020   overdue .']..  
-0001d690: 2020 2020 2020 2320 7072 6f63 6573 7320        # process 
-0001d6a0: 6120 6261 7463 6820 6f66 2065 7861 6d70  a batch of examp
-0001d6b0: 6c65 730a 2020 2020 2020 2020 3e3e 3e20  les.        >>> 
-0001d6c0: 6473 203d 2064 732e 6d61 7028 6c61 6d62  ds = ds.map(lamb
-0001d6d0: 6461 2065 7861 6d70 6c65 3a20 746f 6b65  da example: toke
-0001d6e0: 6e69 7a65 7228 6578 616d 706c 655b 2274  nizer(example["t
-0001d6f0: 6578 7422 5d29 2c20 6261 7463 6865 643d  ext"]), batched=
-0001d700: 5472 7565 290a 2020 2020 2020 2020 2320  True).        # 
-0001d710: 7365 7420 6e75 6d62 6572 206f 6620 7072  set number of pr
-0001d720: 6f63 6573 736f 7273 0a20 2020 2020 2020  ocessors.       
-0001d730: 203e 3e3e 2064 7320 3d20 6473 2e6d 6170   >>> ds = ds.map
-0001d740: 2861 6464 5f70 7265 6669 782c 206e 756d  (add_prefix, num
-0001d750: 5f70 726f 633d 3429 0a20 2020 2020 2020  _proc=4).       
-0001d760: 2060 6060 0a20 2020 2020 2020 2022 2222   ```.        """
-0001d770: 0a20 2020 2020 2020 2069 6620 6b65 6570  .        if keep
-0001d780: 5f69 6e5f 6d65 6d6f 7279 2061 6e64 2063  _in_memory and c
-0001d790: 6163 6865 5f66 696c 655f 6e61 6d65 2069  ache_file_name i
-0001d7a0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0001d7b0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0001d7c0: 6c75 6545 7272 6f72 2822 506c 6561 7365  lueError("Please
-0001d7d0: 2075 7365 2065 6974 6865 7220 606b 6565   use either `kee
-0001d7e0: 705f 696e 5f6d 656d 6f72 7960 206f 7220  p_in_memory` or 
-0001d7f0: 6063 6163 6865 5f66 696c 655f 6e61 6d65  `cache_file_name
-0001d800: 6020 6275 7420 6e6f 7420 626f 7468 2e22  ` but not both."
-0001d810: 290a 0a20 2020 2020 2020 2069 6620 6e75  )..        if nu
-0001d820: 6d5f 7072 6f63 2069 7320 6e6f 7420 4e6f  m_proc is not No
-0001d830: 6e65 2061 6e64 206e 756d 5f70 726f 6320  ne and num_proc 
-0001d840: 3c3d 2030 3a0a 2020 2020 2020 2020 2020  <= 0:.          
-0001d850: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0001d860: 6f72 2822 6e75 6d5f 7072 6f63 206d 7573  or("num_proc mus
-0001d870: 7420 6265 2061 6e20 696e 7465 6765 7220  t be an integer 
-0001d880: 3e20 302e 2229 0a0a 2020 2020 2020 2020  > 0.")..        
-0001d890: 2320 4966 2074 6865 2061 7272 6179 2069  # If the array i
-0001d8a0: 7320 656d 7074 7920 7765 2064 6f20 6e6f  s empty we do no
-0001d8b0: 7468 696e 6720 2862 7574 2077 6520 6d61  thing (but we ma
-0001d8c0: 6b65 2073 7572 6520 746f 2068 616e 646c  ke sure to handl
-0001d8d0: 6520 616e 2065 6d70 7479 2069 6e64 6963  e an empty indic
-0001d8e0: 6573 206d 6170 7069 6e67 2061 6e64 2072  es mapping and r
-0001d8f0: 656d 6f76 6520 7468 6520 7265 7175 6573  emove the reques
-0001d900: 7465 6420 636f 6c75 6d6e 7320 616e 7977  ted columns anyw
-0001d910: 6179 290a 2020 2020 2020 2020 6966 206c  ay).        if l
-0001d920: 656e 2873 656c 6629 203d 3d20 303a 0a20  en(self) == 0:. 
-0001d930: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0001d940: 6c66 2e5f 696e 6469 6365 7320 6973 206e  lf._indices is n
-0001d950: 6f74 204e 6f6e 653a 2020 2320 656d 7074  ot None:  # empt
-0001d960: 7920 696e 6469 6365 7320 6d61 7070 696e  y indices mappin
-0001d970: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-0001d980: 2020 7365 6c66 203d 2044 6174 6173 6574    self = Dataset
-0001d990: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001d9a0: 2020 2020 2020 7365 6c66 2e64 6174 612e        self.data.
-0001d9b0: 736c 6963 6528 302c 2030 292c 0a20 2020  slice(0, 0),.   
-0001d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9d0: 2069 6e66 6f3d 7365 6c66 2e69 6e66 6f2e   info=self.info.
-0001d9e0: 636f 7079 2829 2c0a 2020 2020 2020 2020  copy(),.        
-0001d9f0: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
-0001da00: 743d 7365 6c66 2e73 706c 6974 2c0a 2020  t=self.split,.  
-0001da10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da20: 2020 6669 6e67 6572 7072 696e 743d 6e65    fingerprint=ne
-0001da30: 775f 6669 6e67 6572 7072 696e 742c 0a20  w_fingerprint,. 
-0001da40: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001da50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001da60: 7265 6d6f 7665 5f63 6f6c 756d 6e73 3a0a  remove_columns:.
-0001da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da80: 7265 7475 726e 2073 656c 662e 7265 6d6f  return self.remo
-0001da90: 7665 5f63 6f6c 756d 6e73 2872 656d 6f76  ve_columns(remov
-0001daa0: 655f 636f 6c75 6d6e 7329 0a20 2020 2020  e_columns).     
-0001dab0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001dac0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001dad0: 7572 6e20 7365 6c66 0a0a 2020 2020 2020  urn self..      
-0001dae0: 2020 6966 2066 756e 6374 696f 6e20 6973    if function is
-0001daf0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001db00: 2020 2066 756e 6374 696f 6e20 3d20 6c61     function = la
-0001db10: 6d62 6461 2078 3a20 7820 2023 206e 6f71  mbda x: x  # noq
-0001db20: 613a 2045 3733 310a 0a20 2020 2020 2020  a: E731..       
-0001db30: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
-0001db40: 6e70 7574 5f63 6f6c 756d 6e73 2c20 7374  nput_columns, st
-0001db50: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-0001db60: 696e 7075 745f 636f 6c75 6d6e 7320 3d20  input_columns = 
-0001db70: 5b69 6e70 7574 5f63 6f6c 756d 6e73 5d0a  [input_columns].
-0001db80: 0a20 2020 2020 2020 2069 6620 696e 7075  .        if inpu
-0001db90: 745f 636f 6c75 6d6e 7320 6973 206e 6f74  t_columns is not
-0001dba0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001dbb0: 2020 2066 6f72 2069 6e70 7574 5f63 6f6c     for input_col
-0001dbc0: 756d 6e20 696e 2069 6e70 7574 5f63 6f6c  umn in input_col
-0001dbd0: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
-0001dbe0: 2020 2020 2020 6966 2069 6e70 7574 5f63        if input_c
-0001dbf0: 6f6c 756d 6e20 6e6f 7420 696e 2073 656c  olumn not in sel
-0001dc00: 662e 5f64 6174 612e 636f 6c75 6d6e 5f6e  f._data.column_n
-0001dc10: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
-0001dc20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001dc30: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-0001dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc50: 2020 2020 6622 496e 7075 7420 636f 6c75      f"Input colu
-0001dc60: 6d6e 207b 696e 7075 745f 636f 6c75 6d6e  mn {input_column
-0001dc70: 7d20 6e6f 7420 696e 2074 6865 2064 6174  } not in the dat
-0001dc80: 6173 6574 2e20 4375 7272 656e 7420 636f  aset. Current co
-0001dc90: 6c75 6d6e 7320 696e 2074 6865 2064 6174  lumns in the dat
-0001dca0: 6173 6574 3a20 7b73 656c 662e 5f64 6174  aset: {self._dat
-0001dcb0: 612e 636f 6c75 6d6e 5f6e 616d 6573 7d22  a.column_names}"
-0001dcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dcd0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0001dce0: 6966 2069 7369 6e73 7461 6e63 6528 7265  if isinstance(re
-0001dcf0: 6d6f 7665 5f63 6f6c 756d 6e73 2c20 7374  move_columns, st
-0001dd00: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-0001dd10: 7265 6d6f 7665 5f63 6f6c 756d 6e73 203d  remove_columns =
-0001dd20: 205b 7265 6d6f 7665 5f63 6f6c 756d 6e73   [remove_columns
-0001dd30: 5d0a 0a20 2020 2020 2020 2069 6620 7265  ]..        if re
-0001dd40: 6d6f 7665 5f63 6f6c 756d 6e73 2069 7320  move_columns is 
-0001dd50: 6e6f 7420 4e6f 6e65 2061 6e64 2061 6e79  not None and any
-0001dd60: 2863 6f6c 206e 6f74 2069 6e20 7365 6c66  (col not in self
-0001dd70: 2e5f 6461 7461 2e63 6f6c 756d 6e5f 6e61  ._data.column_na
-0001dd80: 6d65 7320 666f 7220 636f 6c20 696e 2072  mes for col in r
-0001dd90: 656d 6f76 655f 636f 6c75 6d6e 7329 3a0a  emove_columns):.
-0001dda0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001ddb0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-0001ddc0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0001ddd0: 436f 6c75 6d6e 2074 6f20 7265 6d6f 7665  Column to remove
-0001dde0: 207b 6c69 7374 2866 696c 7465 7228 6c61   {list(filter(la
-0001ddf0: 6d62 6461 2063 6f6c 3a20 636f 6c20 6e6f  mbda col: col no
-0001de00: 7420 696e 2073 656c 662e 5f64 6174 612e  t in self._data.
-0001de10: 636f 6c75 6d6e 5f6e 616d 6573 2c20 7265  column_names, re
-0001de20: 6d6f 7665 5f63 6f6c 756d 6e73 2929 7d20  move_columns))} 
-0001de30: 6e6f 7420 696e 2074 6865 2064 6174 6173  not in the datas
-0001de40: 6574 2e20 4375 7272 656e 7420 636f 6c75  et. Current colu
-0001de50: 6d6e 7320 696e 2074 6865 2064 6174 6173  mns in the datas
-0001de60: 6574 3a20 7b73 656c 662e 5f64 6174 612e  et: {self._data.
-0001de70: 636f 6c75 6d6e 5f6e 616d 6573 7d22 0a20  column_names}". 
-0001de80: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0001de90: 2020 2020 2020 6c6f 6164 5f66 726f 6d5f        load_from_
-0001dea0: 6361 6368 655f 6669 6c65 203d 206c 6f61  cache_file = loa
-0001deb0: 645f 6672 6f6d 5f63 6163 6865 5f66 696c  d_from_cache_fil
-0001dec0: 6520 6966 206c 6f61 645f 6672 6f6d 5f63  e if load_from_c
-0001ded0: 6163 6865 5f66 696c 6520 6973 206e 6f74  ache_file is not
-0001dee0: 204e 6f6e 6520 656c 7365 2069 735f 6361   None else is_ca
-0001def0: 6368 696e 675f 656e 6162 6c65 6428 290a  ching_enabled().
-0001df00: 0a20 2020 2020 2020 2069 6620 666e 5f6b  .        if fn_k
-0001df10: 7761 7267 7320 6973 204e 6f6e 653a 0a20  wargs is None:. 
-0001df20: 2020 2020 2020 2020 2020 2066 6e5f 6b77             fn_kw
-0001df30: 6172 6773 203d 207b 7d0a 0a20 2020 2020  args = {}..     
-0001df40: 2020 2069 6620 6e75 6d5f 7072 6f63 2069     if num_proc i
-0001df50: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206e  s not None and n
-0001df60: 756d 5f70 726f 6320 3e20 6c65 6e28 7365  um_proc > len(se
-0001df70: 6c66 293a 0a20 2020 2020 2020 2020 2020  lf):.           
-0001df80: 206e 756d 5f70 726f 6320 3d20 6c65 6e28   num_proc = len(
-0001df90: 7365 6c66 290a 2020 2020 2020 2020 2020  self).          
-0001dfa0: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
-0001dfb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001dfc0: 2020 6622 6e75 6d5f 7072 6f63 206d 7573    f"num_proc mus
-0001dfd0: 7420 6265 203c 3d20 7b6c 656e 2873 656c  t be <= {len(sel
-0001dfe0: 6629 7d2e 2052 6564 7563 696e 6720 6e75  f)}. Reducing nu
-0001dff0: 6d5f 7072 6f63 2074 6f20 7b6e 756d 5f70  m_proc to {num_p
-0001e000: 726f 637d 2066 6f72 2064 6174 6173 6574  roc} for dataset
-0001e010: 206f 6620 7369 7a65 207b 6c65 6e28 7365   of size {len(se
-0001e020: 6c66 297d 2e22 0a20 2020 2020 2020 2020  lf)}.".         
-0001e030: 2020 2029 0a0a 2020 2020 2020 2020 6469     )..        di
-0001e040: 7361 626c 655f 7471 646d 203d 206e 6f74  sable_tqdm = not
-0001e050: 206c 6f67 6769 6e67 2e69 735f 7072 6f67   logging.is_prog
-0001e060: 7265 7373 5f62 6172 5f65 6e61 626c 6564  ress_bar_enabled
-0001e070: 2829 0a0a 2020 2020 2020 2020 6966 206e  ()..        if n
-0001e080: 756d 5f70 726f 6320 6973 204e 6f6e 6520  um_proc is None 
-0001e090: 6f72 206e 756d 5f70 726f 6320 3d3d 2031  or num_proc == 1
-0001e0a0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001e0b0: 7475 726e 2073 656c 662e 5f6d 6170 5f73  turn self._map_s
-0001e0c0: 696e 676c 6528 0a20 2020 2020 2020 2020  ingle(.         
-0001e0d0: 2020 2020 2020 2066 756e 6374 696f 6e3d         function=
-0001e0e0: 6675 6e63 7469 6f6e 2c0a 2020 2020 2020  function,.      
-0001e0f0: 2020 2020 2020 2020 2020 7769 7468 5f69            with_i
-0001e100: 6e64 6963 6573 3d77 6974 685f 696e 6469  ndices=with_indi
-0001e110: 6365 732c 0a20 2020 2020 2020 2020 2020  ces,.           
-0001e120: 2020 2020 2077 6974 685f 7261 6e6b 3d77       with_rank=w
-0001e130: 6974 685f 7261 6e6b 2c0a 2020 2020 2020  ith_rank,.      
-0001e140: 2020 2020 2020 2020 2020 696e 7075 745f            input_
-0001e150: 636f 6c75 6d6e 733d 696e 7075 745f 636f  columns=input_co
-0001e160: 6c75 6d6e 732c 0a20 2020 2020 2020 2020  lumns,.         
-0001e170: 2020 2020 2020 2062 6174 6368 6564 3d62         batched=b
-0001e180: 6174 6368 6564 2c0a 2020 2020 2020 2020  atched,.        
-0001e190: 2020 2020 2020 2020 6261 7463 685f 7369          batch_si
-0001e1a0: 7a65 3d62 6174 6368 5f73 697a 652c 0a20  ze=batch_size,. 
-0001e1b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001e1c0: 726f 705f 6c61 7374 5f62 6174 6368 3d64  rop_last_batch=d
-0001e1d0: 726f 705f 6c61 7374 5f62 6174 6368 2c0a  rop_last_batch,.
-0001e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1f0: 7265 6d6f 7665 5f63 6f6c 756d 6e73 3d72  remove_columns=r
-0001e200: 656d 6f76 655f 636f 6c75 6d6e 732c 0a20  emove_columns,. 
-0001e210: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0001e220: 6565 705f 696e 5f6d 656d 6f72 793d 6b65  eep_in_memory=ke
-0001e230: 6570 5f69 6e5f 6d65 6d6f 7279 2c0a 2020  ep_in_memory,.  
-0001e240: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0001e250: 6164 5f66 726f 6d5f 6361 6368 655f 6669  ad_from_cache_fi
-0001e260: 6c65 3d6c 6f61 645f 6672 6f6d 5f63 6163  le=load_from_cac
-0001e270: 6865 5f66 696c 652c 0a20 2020 2020 2020  he_file,.       
-0001e280: 2020 2020 2020 2020 2063 6163 6865 5f66           cache_f
-0001e290: 696c 655f 6e61 6d65 3d63 6163 6865 5f66  ile_name=cache_f
-0001e2a0: 696c 655f 6e61 6d65 2c0a 2020 2020 2020  ile_name,.      
-0001e2b0: 2020 2020 2020 2020 2020 7772 6974 6572            writer
-0001e2c0: 5f62 6174 6368 5f73 697a 653d 7772 6974  _batch_size=writ
-0001e2d0: 6572 5f62 6174 6368 5f73 697a 652c 0a20  er_batch_size,. 
-0001e2e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001e2f0: 6561 7475 7265 733d 6665 6174 7572 6573  eatures=features
-0001e300: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001e310: 2020 6469 7361 626c 655f 6e75 6c6c 6162    disable_nullab
-0001e320: 6c65 3d64 6973 6162 6c65 5f6e 756c 6c61  le=disable_nulla
-0001e330: 626c 652c 0a20 2020 2020 2020 2020 2020  ble,.           
-0001e340: 2020 2020 2066 6e5f 6b77 6172 6773 3d66       fn_kwargs=f
-0001e350: 6e5f 6b77 6172 6773 2c0a 2020 2020 2020  n_kwargs,.      
-0001e360: 2020 2020 2020 2020 2020 6e65 775f 6669            new_fi
-0001e370: 6e67 6572 7072 696e 743d 6e65 775f 6669  ngerprint=new_fi
-0001e380: 6e67 6572 7072 696e 742c 0a20 2020 2020  ngerprint,.     
-0001e390: 2020 2020 2020 2020 2020 2064 6973 6162             disab
-0001e3a0: 6c65 5f74 7164 6d3d 6469 7361 626c 655f  le_tqdm=disable_
-0001e3b0: 7471 646d 2c0a 2020 2020 2020 2020 2020  tqdm,.          
-0001e3c0: 2020 2020 2020 6465 7363 3d64 6573 632c        desc=desc,
-0001e3d0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001e3e0: 2020 2020 2020 2065 6c73 653a 0a0a 2020         else:..  
-0001e3f0: 2020 2020 2020 2020 2020 6465 6620 666f            def fo
-0001e400: 726d 6174 5f63 6163 6865 5f66 696c 655f  rmat_cache_file_
-0001e410: 6e61 6d65 2863 6163 6865 5f66 696c 655f  name(cache_file_
-0001e420: 6e61 6d65 2c20 7261 6e6b 293a 0a20 2020  name, rank):.   
-0001e430: 2020 2020 2020 2020 2020 2020 2073 6570               sep
-0001e440: 203d 2063 6163 6865 5f66 696c 655f 6e61   = cache_file_na
-0001e450: 6d65 2e72 696e 6465 7828 222e 2229 0a20  me.rindex("."). 
-0001e460: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001e470: 6173 655f 6e61 6d65 2c20 6578 7465 6e73  ase_name, extens
-0001e480: 696f 6e20 3d20 6361 6368 655f 6669 6c65  ion = cache_file
-0001e490: 5f6e 616d 655b 3a73 6570 5d2c 2063 6163  _name[:sep], cac
-0001e4a0: 6865 5f66 696c 655f 6e61 6d65 5b73 6570  he_file_name[sep
-0001e4b0: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
-0001e4c0: 2020 2063 6163 6865 5f66 696c 655f 6e61     cache_file_na
-0001e4d0: 6d65 203d 2062 6173 655f 6e61 6d65 202b  me = base_name +
-0001e4e0: 2073 7566 6669 785f 7465 6d70 6c61 7465   suffix_template
-0001e4f0: 2e66 6f72 6d61 7428 7261 6e6b 3d72 616e  .format(rank=ran
-0001e500: 6b2c 206e 756d 5f70 726f 633d 6e75 6d5f  k, num_proc=num_
-0001e510: 7072 6f63 2920 2b20 6578 7465 6e73 696f  proc) + extensio
-0001e520: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-0001e530: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
-0001e540: 5072 6f63 6573 7320 237b 7261 6e6b 7d20  Process #{rank} 
-0001e550: 7769 6c6c 2077 7269 7465 2061 7420 7b63  will write at {c
-0001e560: 6163 6865 5f66 696c 655f 6e61 6d65 7d22  ache_file_name}"
-0001e570: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e580: 2020 7265 7475 726e 2063 6163 6865 5f66    return cache_f
-0001e590: 696c 655f 6e61 6d65 0a0a 2020 2020 2020  ile_name..      
-0001e5a0: 2020 2020 2020 6465 6620 666f 726d 6174        def format
-0001e5b0: 5f6e 6577 5f66 696e 6765 7270 7269 6e74  _new_fingerprint
-0001e5c0: 286e 6577 5f66 696e 6765 7270 7269 6e74  (new_fingerprint
-0001e5d0: 2c20 7261 6e6b 293a 0a20 2020 2020 2020  , rank):.       
-0001e5e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001e5f0: 6e65 775f 6669 6e67 6572 7072 696e 7420  new_fingerprint 
-0001e600: 2b20 7375 6666 6978 5f74 656d 706c 6174  + suffix_templat
-0001e610: 652e 666f 726d 6174 2872 616e 6b3d 7261  e.format(rank=ra
-0001e620: 6e6b 2c20 6e75 6d5f 7072 6f63 3d6e 756d  nk, num_proc=num
-0001e630: 5f70 726f 6329 0a0a 2020 2020 2020 2020  _proc)..        
-0001e640: 2020 2020 7072 6576 5f65 6e76 203d 2064      prev_env = d
-0001e650: 6565 7063 6f70 7928 6f73 2e65 6e76 6972  eepcopy(os.envir
-0001e660: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
-0001e670: 2320 6368 6563 6b20 6966 2070 6172 616c  # check if paral
-0001e680: 6c65 6c69 736d 2069 6620 6f66 660a 2020  lelism if off.  
-0001e690: 2020 2020 2020 2020 2020 2320 6672 6f6d            # from
-0001e6a0: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-0001e6b0: 636f 6d2f 6875 6767 696e 6766 6163 652f  com/huggingface/
-0001e6c0: 746f 6b65 6e69 7a65 7273 2f62 6c6f 622f  tokenizers/blob/
-0001e6d0: 6262 3636 3862 6334 3339 6463 3334 3338  bb668bc439dc3438
-0001e6e0: 3962 3731 6462 6238 6365 3063 3539 3766  9b71dbb8ce0c597f
-0001e6f0: 3135 3730 3762 3533 2f74 6f6b 656e 697a  15707b53/tokeniz
-0001e700: 6572 732f 7372 632f 7574 696c 732f 7061  ers/src/utils/pa
-0001e710: 7261 6c6c 656c 6973 6d2e 7273 234c 3232  rallelism.rs#L22
-0001e720: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001e730: 7072 6576 5f65 6e76 2e67 6574 2822 544f  prev_env.get("TO
-0001e740: 4b45 4e49 5a45 5253 5f50 4152 414c 4c45  KENIZERS_PARALLE
-0001e750: 4c49 534d 222c 2022 6661 6c73 6522 292e  LISM", "false").
-0001e760: 6c6f 7765 7228 2920 6e6f 7420 696e 2028  lower() not in (
-0001e770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e780: 2022 222c 0a20 2020 2020 2020 2020 2020   "",.           
-0001e790: 2020 2020 2022 6f66 6622 2c0a 2020 2020       "off",.    
-0001e7a0: 2020 2020 2020 2020 2020 2020 2266 616c              "fal
-0001e7b0: 7365 222c 0a20 2020 2020 2020 2020 2020  se",.           
-0001e7c0: 2020 2020 2022 6622 2c0a 2020 2020 2020       "f",.      
-0001e7d0: 2020 2020 2020 2020 2020 226e 6f22 2c0a            "no",.
-0001e7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e7f0: 226e 222c 0a20 2020 2020 2020 2020 2020  "n",.           
-0001e800: 2020 2020 2022 3022 2c0a 2020 2020 2020       "0",.      
-0001e810: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-0001e820: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0001e830: 7761 726e 696e 6728 2253 6574 7469 6e67  warning("Setting
-0001e840: 2054 4f4b 454e 495a 4552 535f 5041 5241   TOKENIZERS_PARA
-0001e850: 4c4c 454c 4953 4d3d 6661 6c73 6520 666f  LLELISM=false fo
-0001e860: 7220 666f 726b 6564 2070 726f 6365 7373  r forked process
-0001e870: 6573 2e22 290a 2020 2020 2020 2020 2020  es.").          
-0001e880: 2020 6f73 2e65 6e76 6972 6f6e 5b22 544f    os.environ["TO
-0001e890: 4b45 4e49 5a45 5253 5f50 4152 414c 4c45  KENIZERS_PARALLE
-0001e8a0: 4c49 534d 225d 203d 2022 6661 6c73 6522  LISM"] = "false"
-0001e8b0: 0a20 2020 2020 2020 2020 2020 2069 6e69  .            ini
-0001e8c0: 7461 7267 732c 2069 6e69 7469 616c 697a  targs, initializ
-0001e8d0: 6572 203d 204e 6f6e 652c 204e 6f6e 650a  er = None, None.
-0001e8e0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001e8f0: 6f74 2064 6973 6162 6c65 5f74 7164 6d3a  ot disable_tqdm:
-0001e900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e910: 2069 6e69 7461 7267 732c 2069 6e69 7469   initargs, initi
-0001e920: 616c 697a 6572 203d 2028 524c 6f63 6b28  alizer = (RLock(
-0001e930: 292c 292c 2074 7164 6d2e 7365 745f 6c6f  ),), tqdm.set_lo
-0001e940: 636b 0a0a 2020 2020 2020 2020 2020 2020  ck..            
-0001e950: 7368 6172 6473 203d 205b 0a20 2020 2020  shards = [.     
-0001e960: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001e970: 7368 6172 6428 6e75 6d5f 7368 6172 6473  shard(num_shards
-0001e980: 3d6e 756d 5f70 726f 632c 2069 6e64 6578  =num_proc, index
-0001e990: 3d72 616e 6b2c 2063 6f6e 7469 6775 6f75  =rank, contiguou
-0001e9a0: 733d 5472 7565 2c20 6b65 6570 5f69 6e5f  s=True, keep_in_
-0001e9b0: 6d65 6d6f 7279 3d6b 6565 705f 696e 5f6d  memory=keep_in_m
-0001e9c0: 656d 6f72 7929 0a20 2020 2020 2020 2020  emory).         
-0001e9d0: 2020 2020 2020 2066 6f72 2072 616e 6b20         for rank 
-0001e9e0: 696e 2072 616e 6765 286e 756d 5f70 726f  in range(num_pro
-0001e9f0: 6329 0a20 2020 2020 2020 2020 2020 205d  c).            ]
-0001ea00: 0a20 2020 2020 2020 2020 2020 206b 7764  .            kwd
-0001ea10: 735f 7065 725f 7368 6172 6420 3d20 5b0a  s_per_shard = [.
-0001ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea30: 6469 6374 280a 2020 2020 2020 2020 2020  dict(.          
-0001ea40: 2020 2020 2020 2020 2020 7365 6c66 3d73            self=s
-0001ea50: 6861 7264 735b 7261 6e6b 5d2c 0a20 2020  hards[rank],.   
-0001ea60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea70: 2066 756e 6374 696f 6e3d 6675 6e63 7469   function=functi
-0001ea80: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-0001ea90: 2020 2020 2020 2020 7769 7468 5f69 6e64          with_ind
-0001eaa0: 6963 6573 3d77 6974 685f 696e 6469 6365  ices=with_indice
-0001eab0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0001eac0: 2020 2020 2020 2077 6974 685f 7261 6e6b         with_rank
-0001ead0: 3d77 6974 685f 7261 6e6b 2c0a 2020 2020  =with_rank,.    
-0001eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eaf0: 696e 7075 745f 636f 6c75 6d6e 733d 696e  input_columns=in
-0001eb00: 7075 745f 636f 6c75 6d6e 732c 0a20 2020  put_columns,.   
-0001eb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb20: 2062 6174 6368 6564 3d62 6174 6368 6564   batched=batched
-0001eb30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001eb40: 2020 2020 2020 6261 7463 685f 7369 7a65        batch_size
-0001eb50: 3d62 6174 6368 5f73 697a 652c 0a20 2020  =batch_size,.   
-0001eb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb70: 2064 726f 705f 6c61 7374 5f62 6174 6368   drop_last_batch
-0001eb80: 3d64 726f 705f 6c61 7374 5f62 6174 6368  =drop_last_batch
-0001eb90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001eba0: 2020 2020 2020 7265 6d6f 7665 5f63 6f6c        remove_col
-0001ebb0: 756d 6e73 3d72 656d 6f76 655f 636f 6c75  umns=remove_colu
-0001ebc0: 6d6e 732c 0a20 2020 2020 2020 2020 2020  mns,.           
-0001ebd0: 2020 2020 2020 2020 206b 6565 705f 696e           keep_in
-0001ebe0: 5f6d 656d 6f72 793d 6b65 6570 5f69 6e5f  _memory=keep_in_
-0001ebf0: 6d65 6d6f 7279 2c0a 2020 2020 2020 2020  memory,.        
-0001ec00: 2020 2020 2020 2020 2020 2020 6c6f 6164              load
-0001ec10: 5f66 726f 6d5f 6361 6368 655f 6669 6c65  _from_cache_file
-0001ec20: 3d6c 6f61 645f 6672 6f6d 5f63 6163 6865  =load_from_cache
-0001ec30: 5f66 696c 652c 0a20 2020 2020 2020 2020  _file,.         
-0001ec40: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-0001ec50: 5f66 696c 655f 6e61 6d65 3d66 6f72 6d61  _file_name=forma
-0001ec60: 745f 6361 6368 655f 6669 6c65 5f6e 616d  t_cache_file_nam
-0001ec70: 6528 6361 6368 655f 6669 6c65 5f6e 616d  e(cache_file_nam
-0001ec80: 652c 2072 616e 6b29 0a20 2020 2020 2020  e, rank).       
-0001ec90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001eca0: 6361 6368 655f 6669 6c65 5f6e 616d 6520  cache_file_name 
-0001ecb0: 6973 206e 6f74 204e 6f6e 650a 2020 2020  is not None.    
-0001ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ecd0: 656c 7365 204e 6f6e 652c 0a20 2020 2020  else None,.     
-0001ece0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001ecf0: 7269 7465 725f 6261 7463 685f 7369 7a65  riter_batch_size
-0001ed00: 3d77 7269 7465 725f 6261 7463 685f 7369  =writer_batch_si
-0001ed10: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-0001ed20: 2020 2020 2020 2020 6665 6174 7572 6573          features
-0001ed30: 3d66 6561 7475 7265 732e 636f 7079 2829  =features.copy()
-0001ed40: 2069 6620 6665 6174 7572 6573 2069 7320   if features is 
-0001ed50: 6e6f 7420 4e6f 6e65 2065 6c73 6520 4e6f  not None else No
-0001ed60: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-0001ed70: 2020 2020 2020 2020 6469 7361 626c 655f          disable_
-0001ed80: 6e75 6c6c 6162 6c65 3d64 6973 6162 6c65  nullable=disable
-0001ed90: 5f6e 756c 6c61 626c 652c 0a20 2020 2020  _nullable,.     
-0001eda0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001edb0: 6e5f 6b77 6172 6773 3d66 6e5f 6b77 6172  n_kwargs=fn_kwar
-0001edc0: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
-0001edd0: 2020 2020 2020 2020 7261 6e6b 3d72 616e          rank=ran
-0001ede0: 6b2c 0a20 2020 2020 2020 2020 2020 2020  k,.             
-0001edf0: 2020 2020 2020 206f 6666 7365 743d 7375         offset=su
-0001ee00: 6d28 6c65 6e28 7329 2066 6f72 2073 2069  m(len(s) for s i
-0001ee10: 6e20 7368 6172 6473 5b3a 7261 6e6b 5d29  n shards[:rank])
-0001ee20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001ee30: 2020 2020 2020 6469 7361 626c 655f 7471        disable_tq
-0001ee40: 646d 3d64 6973 6162 6c65 5f74 7164 6d2c  dm=disable_tqdm,
-0001ee50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ee60: 2020 2020 206e 6577 5f66 696e 6765 7270       new_fingerp
-0001ee70: 7269 6e74 3d66 6f72 6d61 745f 6e65 775f  rint=format_new_
-0001ee80: 6669 6e67 6572 7072 696e 7428 6e65 775f  fingerprint(new_
-0001ee90: 6669 6e67 6572 7072 696e 742c 2072 616e  fingerprint, ran
-0001eea0: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
-0001eeb0: 2020 2020 2020 2069 6620 6e65 775f 6669         if new_fi
-0001eec0: 6e67 6572 7072 696e 7420 6973 206e 6f74  ngerprint is not
-0001eed0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-0001eee0: 2020 2020 2020 2020 2020 656c 7365 204e            else N
-0001eef0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-0001ef00: 2020 2020 2020 2020 2064 6573 633d 6465           desc=de
-0001ef10: 7363 2c0a 2020 2020 2020 2020 2020 2020  sc,.            
-0001ef20: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0001ef30: 2020 2020 2020 666f 7220 7261 6e6b 2069        for rank i
-0001ef40: 6e20 7261 6e67 6528 6e75 6d5f 7072 6f63  n range(num_proc
-0001ef50: 290a 2020 2020 2020 2020 2020 2020 5d0a  ).            ].
-0001ef60: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
-0001ef70: 6520 7365 6172 6368 2066 6f72 2061 6c72  e search for alr
-0001ef80: 6561 6479 2063 6163 6865 6420 7368 6172  eady cached shar
-0001ef90: 6473 0a20 2020 2020 2020 2020 2020 2064  ds.            d
-0001efa0: 6566 2063 6174 6368 5f6e 6f6e 5f65 7869  ef catch_non_exi
-0001efb0: 7374 656e 745f 6572 726f 7228 6675 6e63  stent_error(func
-0001efc0: 2c20 6b77 6172 6773 293a 0a20 2020 2020  , kwargs):.     
-0001efd0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0001efe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eff0: 2020 2020 7265 7475 726e 2066 756e 6328      return func(
-0001f000: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-0001f010: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0001f020: 204e 6f6e 4578 6973 7465 6e74 4461 7461   NonExistentData
-0001f030: 7365 7445 7272 6f72 3a0a 2020 2020 2020  setError:.      
-0001f040: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001f050: 7475 726e 204e 6f6e 650a 0a20 2020 2020  turn None..     
-0001f060: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
-0001f070: 6564 5f73 6861 7264 7320 3d20 5b0a 2020  ed_shards = [.  
-0001f080: 2020 2020 2020 2020 2020 2020 2020 6361                ca
-0001f090: 7463 685f 6e6f 6e5f 6578 6973 7465 6e74  tch_non_existent
-0001f0a0: 5f65 7272 6f72 2873 656c 662e 5f5f 636c  _error(self.__cl
-0001f0b0: 6173 735f 5f2e 5f6d 6170 5f73 696e 676c  ass__._map_singl
-0001f0c0: 652c 2064 6963 7428 6361 6368 655f 6f6e  e, dict(cache_on
-0001f0d0: 6c79 3d54 7275 652c 202a 2a6b 7764 7329  ly=True, **kwds)
-0001f0e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001f0f0: 2020 666f 7220 6b77 6473 2069 6e20 6b77    for kwds in kw
-0001f100: 6473 5f70 6572 5f73 6861 7264 0a20 2020  ds_per_shard.   
-0001f110: 2020 2020 2020 2020 205d 0a0a 2020 2020           ]..    
-0001f120: 2020 2020 2020 2020 2320 5765 2074 7279          # We try
-0001f130: 2074 6f20 6372 6561 7465 2061 2070 6f6f   to create a poo
-0001f140: 6c20 7769 7468 2061 7320 6d61 6e79 2077  l with as many w
-0001f150: 6f72 6b65 7273 2061 7320 6461 7461 7365  orkers as datase
-0001f160: 7420 6e6f 7420 7965 7420 6361 6368 6564  t not yet cached
-0001f170: 2e0a 2020 2020 2020 2020 2020 2020 6e62  ..            nb
-0001f180: 5f6f 665f 6d69 7373 696e 675f 7368 6172  _of_missing_shar
-0001f190: 6473 203d 2074 7261 6e73 666f 726d 6564  ds = transformed
-0001f1a0: 5f73 6861 7264 732e 636f 756e 7428 4e6f  _shards.count(No
-0001f1b0: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-0001f1c0: 6966 206e 625f 6f66 5f6d 6973 7369 6e67  if nb_of_missing
-0001f1d0: 5f73 6861 7264 7320 3e20 303a 0a20 2020  _shards > 0:.   
-0001f1e0: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0001f1f0: 6820 506f 6f6c 286e 625f 6f66 5f6d 6973  h Pool(nb_of_mis
-0001f200: 7369 6e67 5f73 6861 7264 732c 2069 6e69  sing_shards, ini
-0001f210: 7461 7267 733d 696e 6974 6172 6773 2c20  targs=initargs, 
-0001f220: 696e 6974 6961 6c69 7a65 723d 696e 6974  initializer=init
-0001f230: 6961 6c69 7a65 7229 2061 7320 706f 6f6c  ializer) as pool
-0001f240: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001f250: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-0001f260: 203d 2070 7265 765f 656e 760a 2020 2020   = prev_env.    
-0001f270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f280: 6c6f 6767 6572 2e69 6e66 6f28 6622 5370  logger.info(f"Sp
-0001f290: 6177 6e69 6e67 207b 6e75 6d5f 7072 6f63  awning {num_proc
-0001f2a0: 7d20 7072 6f63 6573 7365 7322 290a 2020  } processes").  
-0001f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f2c0: 2020 7265 7375 6c74 7320 3d20 7b0a 2020    results = {.  
-0001f2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f2e0: 2020 2020 2020 693a 2070 6f6f 6c2e 6170        i: pool.ap
-0001f2f0: 706c 795f 6173 796e 6328 7365 6c66 2e5f  ply_async(self._
-0001f300: 5f63 6c61 7373 5f5f 2e5f 6d61 705f 7369  _class__._map_si
-0001f310: 6e67 6c65 2c20 6b77 6473 3d6b 7764 7329  ngle, kwds=kwds)
-0001f320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f330: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-0001f340: 286b 7764 732c 2063 6163 6865 645f 7368  (kwds, cached_sh
-0001f350: 6172 6429 2069 6e20 656e 756d 6572 6174  ard) in enumerat
-0001f360: 6528 7a69 7028 6b77 6473 5f70 6572 5f73  e(zip(kwds_per_s
-0001f370: 6861 7264 2c20 7472 616e 7366 6f72 6d65  hard, transforme
-0001f380: 645f 7368 6172 6473 2929 0a20 2020 2020  d_shards)).     
-0001f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f3a0: 2020 2069 6620 6361 6368 6564 5f73 6861     if cached_sha
-0001f3b0: 7264 2069 7320 4e6f 6e65 0a20 2020 2020  rd is None.     
-0001f3c0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-0001f3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f3e0: 2020 2020 2061 7373 6572 7420 280a 2020       assert (.  
-0001f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f400: 2020 2020 2020 6c65 6e28 7265 7375 6c74        len(result
-0001f410: 7329 203d 3d20 6e62 5f6f 665f 6d69 7373  s) == nb_of_miss
-0001f420: 696e 675f 7368 6172 6473 0a20 2020 2020  ing_shards.     
-0001f430: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001f440: 2c20 2254 6865 206e 756d 6265 7220 6f66  , "The number of
-0001f450: 206d 6973 7369 6e67 2063 6163 6865 6420   missing cached 
-0001f460: 7368 6172 6473 206e 6565 6473 2074 6f20  shards needs to 
-0001f470: 636f 7272 6573 706f 6e64 2074 6f20 7468  correspond to th
-0001f480: 6520 6e75 6d62 6572 206f 6620 605f 6d61  e number of `_ma
-0001f490: 705f 7369 6e67 6c65 6020 7765 2772 6520  p_single` we're 
-0001f4a0: 7275 6e6e 696e 6722 0a0a 2020 2020 2020  running"..      
-0001f4b0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001f4c0: 7220 696e 6465 782c 2061 7379 6e63 5f72  r index, async_r
-0001f4d0: 6573 756c 7420 696e 2072 6573 756c 7473  esult in results
-0001f4e0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0001f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f500: 2020 7472 616e 7366 6f72 6d65 645f 7368    transformed_sh
-0001f510: 6172 6473 5b69 6e64 6578 5d20 3d20 6173  ards[index] = as
-0001f520: 796e 635f 7265 7375 6c74 2e67 6574 2829  ync_result.get()
-0001f530: 0a0a 2020 2020 2020 2020 2020 2020 6173  ..            as
-0001f540: 7365 7274 2028 0a20 2020 2020 2020 2020  sert (.         
-0001f550: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
-0001f560: 6564 5f73 6861 7264 732e 636f 756e 7428  ed_shards.count(
-0001f570: 4e6f 6e65 2920 3d3d 2030 0a20 2020 2020  None) == 0.     
-0001f580: 2020 2020 2020 2029 2c20 2241 6c6c 2073         ), "All s
-0001f590: 6861 7264 7320 6861 7665 2074 6f20 6265  hards have to be
-0001f5a0: 2064 6566 696e 6564 2044 6174 6173 6574   defined Dataset
-0001f5b0: 732c 206e 6f6e 6520 7368 6f75 6c64 2073  s, none should s
-0001f5c0: 7469 6c6c 2062 6520 6d69 7373 696e 672e  till be missing.
-0001f5d0: 220a 0a20 2020 2020 2020 2020 2020 206c  "..            l
-0001f5e0: 6f67 6765 722e 696e 666f 2866 2243 6f6e  ogger.info(f"Con
-0001f5f0: 6361 7465 6e61 7469 6e67 207b 6e75 6d5f  catenating {num_
-0001f600: 7072 6f63 7d20 7368 6172 6473 2229 0a20  proc} shards"). 
-0001f610: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0001f620: 7420 3d20 5f63 6f6e 6361 7465 6e61 7465  t = _concatenate
-0001f630: 5f6d 6170 5f73 7479 6c65 5f64 6174 6173  _map_style_datas
-0001f640: 6574 7328 7472 616e 7366 6f72 6d65 645f  ets(transformed_
-0001f650: 7368 6172 6473 290a 2020 2020 2020 2020  shards).        
-0001f660: 2020 2020 6966 206e 6577 5f66 696e 6765      if new_finge
-0001f670: 7270 7269 6e74 2069 7320 6e6f 7420 4e6f  rprint is not No
-0001f680: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001f690: 2020 2020 7265 7375 6c74 2e5f 6669 6e67      result._fing
-0001f6a0: 6572 7072 696e 7420 3d20 6e65 775f 6669  erprint = new_fi
-0001f6b0: 6e67 6572 7072 696e 740a 2020 2020 2020  ngerprint.      
-0001f6c0: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-0001f6d0: 756c 740a 0a20 2020 2040 7472 616e 736d  ult..    @transm
-0001f6e0: 6974 5f74 6173 6b73 0a20 2020 2040 7472  it_tasks.    @tr
-0001f6f0: 616e 736d 6974 5f66 6f72 6d61 740a 2020  ansmit_format.  
-0001f700: 2020 4066 696e 6765 7270 7269 6e74 5f74    @fingerprint_t
-0001f710: 7261 6e73 666f 726d 280a 2020 2020 2020  ransform(.      
-0001f720: 2020 696e 706c 6163 653d 4661 6c73 652c    inplace=False,
-0001f730: 2069 676e 6f72 655f 6b77 6172 6773 3d5b   ignore_kwargs=[
-0001f740: 226c 6f61 645f 6672 6f6d 5f63 6163 6865  "load_from_cache
-0001f750: 5f66 696c 6522 2c20 2263 6163 6865 5f66  _file", "cache_f
-0001f760: 696c 655f 6e61 6d65 222c 2022 6469 7361  ile_name", "disa
-0001f770: 626c 655f 7471 646d 222c 2022 6465 7363  ble_tqdm", "desc
-0001f780: 222c 2022 6361 6368 655f 6f6e 6c79 225d  ", "cache_only"]
-0001f790: 0a20 2020 2029 0a20 2020 2064 6566 205f  .    ).    def _
-0001f7a0: 6d61 705f 7369 6e67 6c65 280a 2020 2020  map_single(.    
-0001f7b0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0001f7c0: 2020 6675 6e63 7469 6f6e 3a20 4f70 7469    function: Opti
-0001f7d0: 6f6e 616c 5b43 616c 6c61 626c 655d 203d  onal[Callable] =
-0001f7e0: 204e 6f6e 652c 0a20 2020 2020 2020 2077   None,.        w
-0001f7f0: 6974 685f 696e 6469 6365 733a 2062 6f6f  ith_indices: boo
-0001f800: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-0001f810: 2020 2077 6974 685f 7261 6e6b 3a20 626f     with_rank: bo
-0001f820: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0001f830: 2020 2020 696e 7075 745f 636f 6c75 6d6e      input_column
-0001f840: 733a 204f 7074 696f 6e61 6c5b 4c69 7374  s: Optional[List
-0001f850: 5b73 7472 5d5d 203d 204e 6f6e 652c 0a20  [str]] = None,. 
-0001f860: 2020 2020 2020 2062 6174 6368 6564 3a20         batched: 
-0001f870: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0001f880: 2020 2020 2020 6261 7463 685f 7369 7a65        batch_size
-0001f890: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
-0001f8a0: 3d20 3130 3030 2c0a 2020 2020 2020 2020  = 1000,.        
-0001f8b0: 6472 6f70 5f6c 6173 745f 6261 7463 683a  drop_last_batch:
-0001f8c0: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-0001f8d0: 2020 2020 2020 2072 656d 6f76 655f 636f         remove_co
-0001f8e0: 6c75 6d6e 733a 204f 7074 696f 6e61 6c5b  lumns: Optional[
-0001f8f0: 4c69 7374 5b73 7472 5d5d 203d 204e 6f6e  List[str]] = Non
-0001f900: 652c 0a20 2020 2020 2020 206b 6565 705f  e,.        keep_
-0001f910: 696e 5f6d 656d 6f72 793a 2062 6f6f 6c20  in_memory: bool 
-0001f920: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-0001f930: 206c 6f61 645f 6672 6f6d 5f63 6163 6865   load_from_cache
-0001f940: 5f66 696c 653a 2062 6f6f 6c20 3d20 4e6f  _file: bool = No
-0001f950: 6e65 2c0a 2020 2020 2020 2020 6361 6368  ne,.        cach
-0001f960: 655f 6669 6c65 5f6e 616d 653a 204f 7074  e_file_name: Opt
-0001f970: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-0001f980: 652c 0a20 2020 2020 2020 2077 7269 7465  e,.        write
-0001f990: 725f 6261 7463 685f 7369 7a65 3a20 4f70  r_batch_size: Op
-0001f9a0: 7469 6f6e 616c 5b69 6e74 5d20 3d20 3130  tional[int] = 10
-0001f9b0: 3030 2c0a 2020 2020 2020 2020 6665 6174  00,.        feat
-0001f9c0: 7572 6573 3a20 4f70 7469 6f6e 616c 5b46  ures: Optional[F
-0001f9d0: 6561 7475 7265 735d 203d 204e 6f6e 652c  eatures] = None,
-0001f9e0: 0a20 2020 2020 2020 2064 6973 6162 6c65  .        disable
-0001f9f0: 5f6e 756c 6c61 626c 653a 2062 6f6f 6c20  _nullable: bool 
-0001fa00: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-0001fa10: 2066 6e5f 6b77 6172 6773 3a20 4f70 7469   fn_kwargs: Opti
-0001fa20: 6f6e 616c 5b64 6963 745d 203d 204e 6f6e  onal[dict] = Non
-0001fa30: 652c 0a20 2020 2020 2020 206e 6577 5f66  e,.        new_f
-0001fa40: 696e 6765 7270 7269 6e74 3a20 4f70 7469  ingerprint: Opti
-0001fa50: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-0001fa60: 2c0a 2020 2020 2020 2020 7261 6e6b 3a20  ,.        rank: 
-0001fa70: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
-0001fa80: 4e6f 6e65 2c0a 2020 2020 2020 2020 6f66  None,.        of
-0001fa90: 6673 6574 3a20 696e 7420 3d20 302c 0a20  fset: int = 0,. 
-0001faa0: 2020 2020 2020 2064 6973 6162 6c65 5f74         disable_t
-0001fab0: 7164 6d3a 2062 6f6f 6c20 3d20 4661 6c73  qdm: bool = Fals
-0001fac0: 652c 0a20 2020 2020 2020 2064 6573 633a  e,.        desc:
-0001fad0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-0001fae0: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
-0001faf0: 6163 6865 5f6f 6e6c 793a 2062 6f6f 6c20  ache_only: bool 
-0001fb00: 3d20 4661 6c73 652c 0a20 2020 2029 202d  = False,.    ) -
-0001fb10: 3e20 2244 6174 6173 6574 223a 0a20 2020  > "Dataset":.   
-0001fb20: 2020 2020 2022 2222 4170 706c 7920 6120       """Apply a 
-0001fb30: 6675 6e63 7469 6f6e 2074 6f20 616c 6c20  function to all 
-0001fb40: 7468 6520 656c 656d 656e 7473 2069 6e20  the elements in 
-0001fb50: 7468 6520 7461 626c 6520 2869 6e64 6976  the table (indiv
-0001fb60: 6964 7561 6c6c 7920 6f72 2069 6e20 6261  idually or in ba
-0001fb70: 7463 6865 7329 0a20 2020 2020 2020 2061  tches).        a
-0001fb80: 6e64 2075 7064 6174 6520 7468 6520 7461  nd update the ta
-0001fb90: 626c 6520 2869 6620 6675 6e63 7469 6f6e  ble (if function
-0001fba0: 2064 6f65 7320 7570 6461 7465 2065 7861   does update exa
-0001fbb0: 6d70 6c65 7329 2e0a 0a20 2020 2020 2020  mples)...       
-0001fbc0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-0001fbd0: 2020 2066 756e 6374 696f 6e20 2860 4361     function (`Ca
-0001fbe0: 6c6c 6162 6c65 6029 3a20 7769 7468 206f  llable`): with o
-0001fbf0: 6e65 206f 6620 7468 6520 666f 6c6c 6f77  ne of the follow
-0001fc00: 696e 6720 7369 676e 6174 7572 653a 0a20  ing signature:. 
-0001fc10: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-0001fc20: 2060 6675 6e63 7469 6f6e 2865 7861 6d70   `function(examp
-0001fc30: 6c65 3a20 4469 6374 5b73 7472 2c20 416e  le: Dict[str, An
-0001fc40: 795d 2920 2d3e 2044 6963 745b 7374 722c  y]) -> Dict[str,
-0001fc50: 2041 6e79 5d60 2069 6620 6062 6174 6368   Any]` if `batch
-0001fc60: 6564 3d46 616c 7365 6020 616e 6420 6077  ed=False` and `w
-0001fc70: 6974 685f 696e 6469 6365 733d 4661 6c73  ith_indices=Fals
-0001fc80: 6560 2061 6e64 2060 7769 7468 5f72 616e  e` and `with_ran
-0001fc90: 6b3d 4661 6c73 6560 0a20 2020 2020 2020  k=False`.       
-0001fca0: 2020 2020 2020 2020 202d 2060 6675 6e63           - `func
-0001fcb0: 7469 6f6e 2865 7861 6d70 6c65 3a20 4469  tion(example: Di
-0001fcc0: 6374 5b73 7472 2c20 416e 795d 2c20 2a65  ct[str, Any], *e
-0001fcd0: 7874 7261 5f61 7267 7329 202d 3e20 4469  xtra_args) -> Di
-0001fce0: 6374 5b73 7472 2c20 416e 795d 6020 6966  ct[str, Any]` if
-0001fcf0: 2060 6261 7463 6865 643d 4661 6c73 6560   `batched=False`
-0001fd00: 2061 6e64 2060 7769 7468 5f69 6e64 6963   and `with_indic
-0001fd10: 6573 3d54 7275 6560 2061 6e64 2f6f 7220  es=True` and/or 
-0001fd20: 6077 6974 685f 7261 6e6b 3d54 7275 6560  `with_rank=True`
-0001fd30: 2028 6f6e 6520 6578 7472 6120 6172 6720   (one extra arg 
-0001fd40: 666f 7220 6561 6368 290a 2020 2020 2020  for each).      
-0001fd50: 2020 2020 2020 2020 2020 2d20 6066 756e            - `fun
-0001fd60: 6374 696f 6e28 6261 7463 683a 2044 6963  ction(batch: Dic
-0001fd70: 745b 7374 722c 204c 6973 745d 2920 2d3e  t[str, List]) ->
-0001fd80: 2044 6963 745b 7374 722c 204c 6973 745d   Dict[str, List]
-0001fd90: 6020 6966 2060 6261 7463 6865 643d 5472  ` if `batched=Tr
-0001fda0: 7565 6020 616e 6420 6077 6974 685f 696e  ue` and `with_in
-0001fdb0: 6469 6365 733d 4661 6c73 6560 2061 6e64  dices=False` and
-0001fdc0: 2060 7769 7468 5f72 616e 6b3d 4661 6c73   `with_rank=Fals
-0001fdd0: 6560 0a20 2020 2020 2020 2020 2020 2020  e`.             
-0001fde0: 2020 202d 2060 6675 6e63 7469 6f6e 2862     - `function(b
-0001fdf0: 6174 6368 3a20 4469 6374 5b73 7472 2c20  atch: Dict[str, 
-0001fe00: 4c69 7374 5d2c 202a 6578 7472 615f 6172  List], *extra_ar
-0001fe10: 6773 2920 2d3e 2044 6963 745b 7374 722c  gs) -> Dict[str,
-0001fe20: 204c 6973 745d 6020 6966 2060 6261 7463   List]` if `batc
-0001fe30: 6865 643d 5472 7565 6020 616e 6420 6077  hed=True` and `w
-0001fe40: 6974 685f 696e 6469 6365 733d 5472 7565  ith_indices=True
-0001fe50: 6020 616e 642f 6f72 2060 7769 7468 5f72  ` and/or `with_r
-0001fe60: 616e 6b3d 5472 7565 6020 286f 6e65 2065  ank=True` (one e
-0001fe70: 7874 7261 2061 7267 2066 6f72 2065 6163  xtra arg for eac
-0001fe80: 6829 0a0a 2020 2020 2020 2020 2020 2020  h)..            
-0001fe90: 2020 2020 466f 7220 6164 7661 6e63 6564      For advanced
-0001fea0: 2075 7361 6765 2c20 7468 6520 6675 6e63   usage, the func
-0001feb0: 7469 6f6e 2063 616e 2061 6c73 6f20 7265  tion can also re
-0001fec0: 7475 726e 2061 2060 7079 6172 726f 772e  turn a `pyarrow.
-0001fed0: 5461 626c 6560 2e0a 2020 2020 2020 2020  Table`..        
-0001fee0: 2020 2020 2020 2020 4d6f 7265 6f76 6572          Moreover
-0001fef0: 2069 6620 796f 7572 2066 756e 6374 696f   if your functio
-0001ff00: 6e20 7265 7475 726e 7320 6e6f 7468 696e  n returns nothin
-0001ff10: 6720 2860 4e6f 6e65 6029 2c20 7468 656e  g (`None`), then
-0001ff20: 2060 6d61 7060 2077 696c 6c20 7275 6e20   `map` will run 
-0001ff30: 796f 7572 2066 756e 6374 696f 6e20 616e  your function an
-0001ff40: 6420 7265 7475 726e 2074 6865 2064 6174  d return the dat
-0001ff50: 6173 6574 2075 6e63 6861 6e67 6564 2e0a  aset unchanged..
-0001ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff70: 4966 206e 6f20 6675 6e63 7469 6f6e 2069  If no function i
-0001ff80: 7320 7072 6f76 6964 6564 2c20 6465 6661  s provided, defa
-0001ff90: 756c 7420 746f 2069 6465 6e74 6974 7920  ult to identity 
-0001ffa0: 6675 6e63 7469 6f6e 3a20 6c61 6d62 6461  function: lambda
-0001ffb0: 2078 3a20 780a 2020 2020 2020 2020 2020   x: x.          
-0001ffc0: 2020 7769 7468 5f69 6e64 6963 6573 2028    with_indices (
-0001ffd0: 6062 6f6f 6c60 2c20 6465 6661 756c 7473  `bool`, defaults
-0001ffe0: 2074 6f20 6046 616c 7365 6029 3a20 5072   to `False`): Pr
-0001fff0: 6f76 6964 6520 6578 616d 706c 6520 696e  ovide example in
-00020000: 6469 6365 7320 746f 2060 6675 6e63 7469  dices to `functi
-00020010: 6f6e 602e 204e 6f74 6520 7468 6174 2069  on`. Note that i
-00020020: 6e20 7468 6973 2063 6173 6520 7468 6520  n this case the 
-00020030: 7369 676e 6174 7572 6520 6f66 2060 6675  signature of `fu
-00020040: 6e63 7469 6f6e 6020 7368 6f75 6c64 2062  nction` should b
-00020050: 6520 6064 6566 2066 756e 6374 696f 6e28  e `def function(
-00020060: 6578 616d 706c 652c 2069 6478 5b2c 2072  example, idx[, r
-00020070: 616e 6b5d 293a 202e 2e2e 602e 0a20 2020  ank]): ...`..   
-00020080: 2020 2020 2020 2020 2077 6974 685f 7261           with_ra
-00020090: 6e6b 2028 6062 6f6f 6c60 2c20 6465 6661  nk (`bool`, defa
-000200a0: 756c 7420 6046 616c 7365 6029 3a20 5072  ult `False`): Pr
-000200b0: 6f76 6964 6520 7072 6f63 6573 7320 7261  ovide process ra
-000200c0: 6e6b 2074 6f20 6066 756e 6374 696f 6e60  nk to `function`
-000200d0: 2e20 4e6f 7465 2074 6861 7420 696e 2074  . Note that in t
-000200e0: 6869 7320 6361 7365 2074 6865 2073 6967  his case the sig
-000200f0: 6e61 7475 7265 206f 6620 6066 756e 6374  nature of `funct
-00020100: 696f 6e60 2073 686f 756c 6420 6265 2060  ion` should be `
-00020110: 6465 6620 6675 6e63 7469 6f6e 2865 7861  def function(exa
-00020120: 6d70 6c65 5b2c 2069 6478 5d2c 2072 616e  mple[, idx], ran
-00020130: 6b29 3a20 2e2e 2e60 2e0a 2020 2020 2020  k): ...`..      
-00020140: 2020 2020 2020 696e 7075 745f 636f 6c75        input_colu
-00020150: 6d6e 7320 2860 4f70 7469 6f6e 616c 5b4c  mns (`Optional[L
-00020160: 6973 745b 7374 725d 5d60 2c20 6465 6661  ist[str]]`, defa
-00020170: 756c 7473 2074 6f20 604e 6f6e 6560 293a  ults to `None`):
-00020180: 2054 6865 2063 6f6c 756d 6e73 2074 6f20   The columns to 
-00020190: 6265 2070 6173 7365 6420 696e 746f 2060  be passed into `
-000201a0: 6675 6e63 7469 6f6e 6020 6173 0a20 2020  function` as.   
-000201b0: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-000201c0: 6974 696f 6e61 6c20 6172 6775 6d65 6e74  itional argument
-000201d0: 732e 2049 6620 604e 6f6e 6560 2c20 6120  s. If `None`, a 
-000201e0: 6469 6374 206d 6170 7069 6e67 2074 6f20  dict mapping to 
-000201f0: 616c 6c20 666f 726d 6174 7465 6420 636f  all formatted co
-00020200: 6c75 6d6e 7320 6973 2070 6173 7365 6420  lumns is passed 
-00020210: 6173 206f 6e65 2061 7267 756d 656e 742e  as one argument.
-00020220: 0a20 2020 2020 2020 2020 2020 2062 6174  .            bat
-00020230: 6368 6564 2028 6062 6f6f 6c60 2c20 6465  ched (`bool`, de
-00020240: 6661 756c 7473 2074 6f20 6046 616c 7365  faults to `False
-00020250: 6029 3a20 5072 6f76 6964 6520 6261 7463  `): Provide batc
-00020260: 6820 6f66 2065 7861 6d70 6c65 7320 746f  h of examples to
-00020270: 2060 6675 6e63 7469 6f6e 600a 2020 2020   `function`.    
-00020280: 2020 2020 2020 2020 6261 7463 685f 7369          batch_si
-00020290: 7a65 2028 6069 6e74 602c 206f 7074 696f  ze (`int`, optio
-000202a0: 6e61 6c2c 2064 6566 6175 6c74 7320 746f  nal, defaults to
-000202b0: 2060 3130 3030 6029 3a20 4e75 6d62 6572   `1000`): Number
-000202c0: 206f 6620 6578 616d 706c 6573 2070 6572   of examples per
-000202d0: 2062 6174 6368 2070 726f 7669 6465 6420   batch provided 
-000202e0: 746f 2060 6675 6e63 7469 6f6e 6020 6966  to `function` if
-000202f0: 2060 6261 7463 6865 643d 5472 7565 600a   `batched=True`.
-00020300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020310: 6062 6174 6368 5f73 697a 6520 3c3d 2030  `batch_size <= 0
-00020320: 6020 6f72 2060 6261 7463 685f 7369 7a65  ` or `batch_size
-00020330: 203d 3d20 4e6f 6e65 603a 2050 726f 7669   == None`: Provi
-00020340: 6465 2074 6865 2066 756c 6c20 6461 7461  de the full data
-00020350: 7365 7420 6173 2061 2073 696e 676c 6520  set as a single 
-00020360: 6261 7463 6820 746f 2060 6675 6e63 7469  batch to `functi
-00020370: 6f6e 600a 2020 2020 2020 2020 2020 2020  on`.            
-00020380: 6472 6f70 5f6c 6173 745f 6261 7463 6820  drop_last_batch 
-00020390: 2860 626f 6f6c 602c 2064 6566 6175 6c74  (`bool`, default
-000203a0: 3a20 6046 616c 7365 6029 3a20 5768 6574  : `False`): Whet
-000203b0: 6865 7220 6120 6c61 7374 2062 6174 6368  her a last batch
-000203c0: 2073 6d61 6c6c 6572 2074 6861 6e20 7468   smaller than th
-000203d0: 6520 6261 7463 685f 7369 7a65 2073 686f  e batch_size sho
-000203e0: 756c 6420 6265 0a20 2020 2020 2020 2020  uld be.         
-000203f0: 2020 2020 2020 2064 726f 7070 6564 2069         dropped i
-00020400: 6e73 7465 6164 206f 6620 6265 696e 6720  nstead of being 
-00020410: 7072 6f63 6573 7365 6420 6279 2074 6865  processed by the
-00020420: 2066 756e 6374 696f 6e2e 0a20 2020 2020   function..     
-00020430: 2020 2020 2020 2072 656d 6f76 655f 636f         remove_co
-00020440: 6c75 6d6e 7320 2860 4f70 7469 6f6e 616c  lumns (`Optional
-00020450: 5b4c 6973 745b 7374 725d 5d60 2c20 6465  [List[str]]`, de
-00020460: 6661 756c 7473 2074 6f20 604e 6f6e 6560  faults to `None`
-00020470: 293a 2052 656d 6f76 6520 6120 7365 6c65  ): Remove a sele
-00020480: 6374 696f 6e20 6f66 2063 6f6c 756d 6e73  ction of columns
-00020490: 2077 6869 6c65 2064 6f69 6e67 2074 6865   while doing the
-000204a0: 206d 6170 7069 6e67 2e0a 2020 2020 2020   mapping..      
-000204b0: 2020 2020 2020 2020 2020 436f 6c75 6d6e            Column
-000204c0: 7320 7769 6c6c 2062 6520 7265 6d6f 7665  s will be remove
-000204d0: 6420 6265 666f 7265 2075 7064 6174 696e  d before updatin
-000204e0: 6720 7468 6520 6578 616d 706c 6573 2077  g the examples w
-000204f0: 6974 6820 7468 6520 6f75 7470 7574 206f  ith the output o
-00020500: 6620 6066 756e 6374 696f 6e60 2c20 692e  f `function`, i.
-00020510: 652e 2069 6620 6066 756e 6374 696f 6e60  e. if `function`
-00020520: 2069 7320 6164 6469 6e67 0a20 2020 2020   is adding.     
-00020530: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-00020540: 6e73 2077 6974 6820 6e61 6d65 7320 696e  ns with names in
-00020550: 2060 7265 6d6f 7665 5f63 6f6c 756d 6e73   `remove_columns
-00020560: 602c 2074 6865 7365 2063 6f6c 756d 6e73  `, these columns
-00020570: 2077 696c 6c20 6265 206b 6570 742e 0a20   will be kept.. 
-00020580: 2020 2020 2020 2020 2020 206b 6565 705f             keep_
-00020590: 696e 5f6d 656d 6f72 7920 2860 626f 6f6c  in_memory (`bool
-000205a0: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
-000205b0: 4661 6c73 6560 293a 204b 6565 7020 7468  False`): Keep th
-000205c0: 6520 6461 7461 7365 7420 696e 206d 656d  e dataset in mem
-000205d0: 6f72 7920 696e 7374 6561 6420 6f66 2077  ory instead of w
-000205e0: 7269 7469 6e67 2069 7420 746f 2061 2063  riting it to a c
-000205f0: 6163 6865 2066 696c 652e 0a20 2020 2020  ache file..     
-00020600: 2020 2020 2020 206c 6f61 645f 6672 6f6d         load_from
-00020610: 5f63 6163 6865 5f66 696c 6520 2860 626f  _cache_file (`bo
-00020620: 6f6c 602c 2064 6566 6175 6c74 7320 746f  ol`, defaults to
-00020630: 2060 5472 7565 6020 6966 2063 6163 6869   `True` if cachi
-00020640: 6e67 2069 7320 656e 6162 6c65 6429 3a20  ng is enabled): 
-00020650: 4966 2061 2063 6163 6865 2066 696c 6520  If a cache file 
-00020660: 7374 6f72 696e 6720 7468 6520 6375 7272  storing the curr
-00020670: 656e 7420 636f 6d70 7574 6174 696f 6e20  ent computation 
-00020680: 6672 6f6d 2060 6675 6e63 7469 6f6e 600a  from `function`.
-00020690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000206a0: 6361 6e20 6265 2069 6465 6e74 6966 6965  can be identifie
-000206b0: 642c 2075 7365 2069 7420 696e 7374 6561  d, use it instea
-000206c0: 6420 6f66 2072 6563 6f6d 7075 7469 6e67  d of recomputing
-000206d0: 2e0a 2020 2020 2020 2020 2020 2020 6361  ..            ca
-000206e0: 6368 655f 6669 6c65 5f6e 616d 6520 2860  che_file_name (`
-000206f0: 7374 7260 2c20 6f70 7469 6f6e 616c 2c20  str`, optional, 
-00020700: 6465 6661 756c 7473 2074 6f20 604e 6f6e  defaults to `Non
-00020710: 6560 293a 2050 726f 7669 6465 2074 6865  e`): Provide the
-00020720: 206e 616d 6520 6f66 2061 2070 6174 6820   name of a path 
-00020730: 666f 7220 7468 6520 6361 6368 6520 6669  for the cache fi
-00020740: 6c65 2e20 4974 2069 7320 7573 6564 2074  le. It is used t
-00020750: 6f20 7374 6f72 6520 7468 650a 2020 2020  o store the.    
-00020760: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00020770: 6c74 7320 6f66 2074 6865 2063 6f6d 7075  lts of the compu
-00020780: 7461 7469 6f6e 2069 6e73 7465 6164 206f  tation instead o
-00020790: 6620 7468 6520 6175 746f 6d61 7469 6361  f the automatica
-000207a0: 6c6c 7920 6765 6e65 7261 7465 6420 6361  lly generated ca
-000207b0: 6368 6520 6669 6c65 206e 616d 652e 0a20  che file name.. 
-000207c0: 2020 2020 2020 2020 2020 2077 7269 7465             write
-000207d0: 725f 6261 7463 685f 7369 7a65 2028 6069  r_batch_size (`i
-000207e0: 6e74 602c 2064 6566 6175 6c74 2060 3130  nt`, default `10
-000207f0: 3030 6029 3a20 4e75 6d62 6572 206f 6620  00`): Number of 
-00020800: 726f 7773 2070 6572 2077 7269 7465 206f  rows per write o
-00020810: 7065 7261 7469 6f6e 2066 6f72 2074 6865  peration for the
-00020820: 2063 6163 6865 2066 696c 6520 7772 6974   cache file writ
-00020830: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
-00020840: 2020 2020 5468 6973 2076 616c 7565 2069      This value i
-00020850: 7320 6120 676f 6f64 2074 7261 6465 2d6f  s a good trade-o
-00020860: 6666 2062 6574 7765 656e 206d 656d 6f72  ff between memor
-00020870: 7920 7573 6167 6520 6475 7269 6e67 2074  y usage during t
-00020880: 6865 2070 726f 6365 7373 696e 672c 2061  he processing, a
-00020890: 6e64 2070 726f 6365 7373 696e 6720 7370  nd processing sp
-000208a0: 6565 642e 0a20 2020 2020 2020 2020 2020  eed..           
-000208b0: 2020 2020 2048 6967 6865 7220 7661 6c75       Higher valu
-000208c0: 6520 6d61 6b65 7320 7468 6520 7072 6f63  e makes the proc
-000208d0: 6573 7369 6e67 2064 6f20 6665 7765 7220  essing do fewer 
-000208e0: 6c6f 6f6b 7570 732c 206c 6f77 6572 2076  lookups, lower v
-000208f0: 616c 7565 2063 6f6e 7375 6d65 206c 6573  alue consume les
-00020900: 7320 7465 6d70 6f72 6172 7920 6d65 6d6f  s temporary memo
-00020910: 7279 2077 6869 6c65 2072 756e 6e69 6e67  ry while running
-00020920: 2060 2e6d 6170 2829 602e 0a20 2020 2020   `.map()`..     
-00020930: 2020 2020 2020 2066 6561 7475 7265 7320         features 
-00020940: 2860 4f70 7469 6f6e 616c 5b64 6174 6173  (`Optional[datas
-00020950: 6574 732e 4665 6174 7572 6573 5d60 2c20  ets.Features]`, 
-00020960: 6465 6661 756c 7473 2074 6f20 604e 6f6e  defaults to `Non
-00020970: 6560 293a 2055 7365 2061 2073 7065 6369  e`): Use a speci
-00020980: 6669 6320 4665 6174 7572 6573 2074 6f20  fic Features to 
-00020990: 7374 6f72 6520 7468 6520 6361 6368 6520  store the cache 
-000209a0: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-000209b0: 2020 2020 2069 6e73 7465 6164 206f 6620       instead of 
-000209c0: 7468 6520 6175 746f 6d61 7469 6361 6c6c  the automaticall
-000209d0: 7920 6765 6e65 7261 7465 6420 6f6e 652e  y generated one.
-000209e0: 0a20 2020 2020 2020 2020 2020 2064 6973  .            dis
-000209f0: 6162 6c65 5f6e 756c 6c61 626c 6520 2860  able_nullable (`
-00020a00: 626f 6f6c 602c 2064 6566 6175 6c74 7320  bool`, defaults 
-00020a10: 746f 2060 4661 6c73 6560 293a 2044 6973  to `False`): Dis
-00020a20: 616c 6c6f 7720 6e75 6c6c 2076 616c 7565  allow null value
-00020a30: 7320 696e 2074 6865 2074 6162 6c65 2e0a  s in the table..
-00020a40: 2020 2020 2020 2020 2020 2020 666e 5f6b              fn_k
-00020a50: 7761 7267 7320 2860 4469 6374 602c 206f  wargs (`Dict`, o
-00020a60: 7074 696f 6e61 6c2c 2064 6566 6175 6c74  ptional, default
-00020a70: 7320 746f 2060 4e6f 6e65 6029 3a20 4b65  s to `None`): Ke
-00020a80: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-00020a90: 746f 2062 6520 7061 7373 6564 2074 6f20  to be passed to 
-00020aa0: 6066 756e 6374 696f 6e60 0a20 2020 2020  `function`.     
-00020ab0: 2020 2020 2020 206e 6577 5f66 696e 6765         new_finge
-00020ac0: 7270 7269 6e74 2028 6073 7472 602c 206f  rprint (`str`, o
-00020ad0: 7074 696f 6e61 6c2c 2064 6566 6175 6c74  ptional, default
-00020ae0: 7320 746f 2060 4e6f 6e65 6029 3a20 7468  s to `None`): th
-00020af0: 6520 6e65 7720 6669 6e67 6572 7072 696e  e new fingerprin
-00020b00: 7420 6f66 2074 6865 2064 6174 6173 6574  t of the dataset
-00020b10: 2061 6674 6572 2074 7261 6e73 666f 726d   after transform
-00020b20: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00020b30: 2020 4966 2060 4e6f 6e65 602c 2074 6865    If `None`, the
-00020b40: 206e 6577 2066 696e 6765 7270 7269 6e74   new fingerprint
-00020b50: 2069 7320 636f 6d70 7574 6564 2075 7369   is computed usi
-00020b60: 6e67 2061 2068 6173 6820 6f66 2074 6865  ng a hash of the
-00020b70: 2070 7265 7669 6f75 7320 6669 6e67 6572   previous finger
-00020b80: 7072 696e 742c 2061 6e64 2074 6865 2074  print, and the t
-00020b90: 7261 6e73 666f 726d 2061 7267 756d 656e  ransform argumen
-00020ba0: 7473 0a20 2020 2020 2020 2020 2020 2072  ts.            r
-00020bb0: 616e 6b3a 2028 6069 6e74 602c 206f 7074  ank: (`int`, opt
-00020bc0: 696f 6e61 6c2c 2064 6566 6175 6c74 7320  ional, defaults 
-00020bd0: 746f 2060 4e6f 6e65 6029 3a20 4966 2073  to `None`): If s
-00020be0: 7065 6369 6669 6564 2c20 7468 6973 2069  pecified, this i
-00020bf0: 7320 7468 6520 7072 6f63 6573 7320 7261  s the process ra
-00020c00: 6e6b 2077 6865 6e20 646f 696e 6720 6d75  nk when doing mu
-00020c10: 6c74 6970 726f 6365 7373 696e 670a 2020  ltiprocessing.  
-00020c20: 2020 2020 2020 2020 2020 6f66 6673 6574            offset
-00020c30: 3a20 2860 696e 7460 2c20 6465 6661 756c  : (`int`, defaul
-00020c40: 7473 2074 6f20 3029 3a20 4966 2073 7065  ts to 0): If spe
-00020c50: 6369 6669 6564 2c20 7468 6973 2069 7320  cified, this is 
-00020c60: 616e 206f 6666 7365 7420 6170 706c 6965  an offset applie
-00020c70: 6420 746f 2074 6865 2069 6e64 6963 6573  d to the indices
-00020c80: 2070 6173 7365 6420 746f 2060 6675 6e63   passed to `func
-00020c90: 7469 6f6e 6020 6966 2060 7769 7468 5f69  tion` if `with_i
-00020ca0: 6e64 6963 6573 3d54 7275 6560 2e0a 2020  ndices=True`..  
-00020cb0: 2020 2020 2020 2020 2020 6469 7361 626c            disabl
-00020cc0: 655f 7471 646d 2028 6062 6f6f 6c60 2c20  e_tqdm (`bool`, 
-00020cd0: 6465 6661 756c 7473 2074 6f20 6046 616c  defaults to `Fal
-00020ce0: 7365 6029 3a20 5768 6574 6865 7220 746f  se`): Whether to
-00020cf0: 2073 696c 656e 6365 2074 7164 6d27 7320   silence tqdm's 
-00020d00: 6f75 7470 7574 2e0a 2020 2020 2020 2020  output..        
-00020d10: 2020 2020 6465 7363 2028 6073 7472 602c      desc (`str`,
-00020d20: 206f 7074 696f 6e61 6c2c 2064 6566 6175   optional, defau
-00020d30: 6c74 7320 746f 2060 4e6f 6e65 6029 3a20  lts to `None`): 
-00020d40: 4d65 616e 696e 6766 756c 2064 6573 6372  Meaningful descr
-00020d50: 6970 7469 6f6e 2074 6f20 6265 2064 6973  iption to be dis
-00020d60: 706c 6179 6564 2061 6c6f 6e67 7369 6465  played alongside
-00020d70: 2077 6974 6820 7468 6520 7072 6f67 7265   with the progre
-00020d80: 7373 2062 6172 2077 6869 6c65 206d 6170  ss bar while map
-00020d90: 7069 6e67 2065 7861 6d70 6c65 732e 0a20  ping examples.. 
-00020da0: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-00020db0: 5f6f 6e6c 7920 2860 626f 6f6c 602c 2064  _only (`bool`, d
-00020dc0: 6566 6175 6c74 7320 746f 2060 4661 6c73  efaults to `Fals
-00020dd0: 6560 293a 2046 6c61 6720 696e 206f 7264  e`): Flag in ord
-00020de0: 6572 2074 6f20 6e6f 7469 6669 7920 7468  er to notifiy th
-00020df0: 6520 6d65 7468 6f64 2077 696c 6c20 6569  e method will ei
-00020e00: 7468 6572 2066 696e 6420 6120 6361 6368  ther find a cach
-00020e10: 6564 2064 6174 6173 6574 206f 7220 7261  ed dataset or ra
-00020e20: 6973 6520 604e 6f6e 4578 6973 7465 6e74  ise `NonExistent
-00020e30: 4461 7461 7365 7445 7272 6f72 6020 6578  DatasetError` ex
-00020e40: 6365 7074 696f 6e2c 0a20 2020 2020 2020  ception,.       
-00020e50: 2022 2222 0a20 2020 2020 2020 2023 2052   """.        # R
-00020e60: 6564 7563 6520 6c6f 6767 696e 6720 746f  educe logging to
-00020e70: 206b 6565 7020 7468 696e 6773 2072 6561   keep things rea
-00020e80: 6461 626c 6520 696e 206d 756c 7469 7072  dable in multipr
-00020e90: 6f63 6573 7369 6e67 2077 6974 6820 7471  ocessing with tq
-00020ea0: 646d 0a20 2020 2020 2020 2069 6620 7261  dm.        if ra
-00020eb0: 6e6b 2069 7320 6e6f 7420 4e6f 6e65 2061  nk is not None a
-00020ec0: 6e64 206c 6f67 6769 6e67 2e67 6574 5f76  nd logging.get_v
-00020ed0: 6572 626f 7369 7479 2829 203c 206c 6f67  erbosity() < log
-00020ee0: 6769 6e67 2e57 4152 4e49 4e47 3a0a 2020  ging.WARNING:.  
-00020ef0: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
-00020f00: 672e 7365 745f 7665 7262 6f73 6974 795f  g.set_verbosity_
-00020f10: 7761 726e 696e 6728 290a 2020 2020 2020  warning().      
-00020f20: 2020 2320 5072 696e 7420 6174 206c 6561    # Print at lea
-00020f30: 7374 206f 6e65 2074 6869 6e67 2074 6f20  st one thing to 
-00020f40: 6669 7820 7471 646d 2069 6e20 6e6f 7465  fix tqdm in note
-00020f50: 626f 6f6b 7320 696e 206d 756c 7469 7072  books in multipr
-00020f60: 6f63 6573 7369 6e67 0a20 2020 2020 2020  ocessing.       
-00020f70: 2023 2073 6565 2068 7474 7073 3a2f 2f67   # see https://g
-00020f80: 6974 6875 622e 636f 6d2f 7471 646d 2f74  ithub.com/tqdm/t
-00020f90: 7164 6d2f 6973 7375 6573 2f34 3835 2369  qdm/issues/485#i
-00020fa0: 7373 7565 636f 6d6d 656e 742d 3437 3333  ssuecomment-4733
-00020fb0: 3338 3330 380a 2020 2020 2020 2020 6966  38308.        if
-00020fc0: 2072 616e 6b20 6973 206e 6f74 204e 6f6e   rank is not Non
-00020fd0: 6520 616e 6420 6e6f 7420 6469 7361 626c  e and not disabl
-00020fe0: 655f 7471 646d 2061 6e64 2061 6e79 2822  e_tqdm and any("
-00020ff0: 6e6f 7465 626f 6f6b 2220 696e 2074 7164  notebook" in tqd
-00021000: 6d5f 636c 732e 5f5f 6e61 6d65 5f5f 2066  m_cls.__name__ f
-00021010: 6f72 2074 7164 6d5f 636c 7320 696e 2074  or tqdm_cls in t
-00021020: 7164 6d2e 5f5f 6d72 6f5f 5f29 3a0a 2020  qdm.__mro__):.  
-00021030: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00021040: 2220 222c 2065 6e64 3d22 222c 2066 6c75  " ", end="", flu
-00021050: 7368 3d54 7275 6529 0a0a 2020 2020 2020  sh=True)..      
-00021060: 2020 6966 2066 6e5f 6b77 6172 6773 2069    if fn_kwargs i
-00021070: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00021080: 2020 2020 666e 5f6b 7761 7267 7320 3d20      fn_kwargs = 
-00021090: 7b7d 0a0a 2020 2020 2020 2020 2320 4966  {}..        # If
-000210a0: 2077 6520 646f 2062 6174 6368 2063 6f6d   we do batch com
-000210b0: 7075 7461 7469 6f6e 2062 7574 206e 6f20  putation but no 
-000210c0: 6261 7463 6820 7369 7a65 2069 7320 7072  batch size is pr
-000210d0: 6f76 6964 6564 2c20 6465 6661 756c 7420  ovided, default 
-000210e0: 746f 2074 6865 2066 756c 6c20 6461 7461  to the full data
-000210f0: 7365 740a 2020 2020 2020 2020 6966 2062  set.        if b
-00021100: 6174 6368 6564 2061 6e64 2028 6261 7463  atched and (batc
-00021110: 685f 7369 7a65 2069 7320 4e6f 6e65 206f  h_size is None o
-00021120: 7220 6261 7463 685f 7369 7a65 203c 3d20  r batch_size <= 
-00021130: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
-00021140: 6261 7463 685f 7369 7a65 203d 2073 656c  batch_size = sel
-00021150: 662e 6e75 6d5f 726f 7773 0a0a 2020 2020  f.num_rows..    
-00021160: 2020 2020 2320 4368 6563 6b20 6966 2077      # Check if w
-00021170: 6527 7665 2061 6c72 6561 6479 2063 6163  e've already cac
-00021180: 6865 6420 7468 6973 2063 6f6d 7075 7461  hed this computa
-00021190: 7469 6f6e 2028 696e 6465 7865 6420 6279  tion (indexed by
-000211a0: 2061 2068 6173 6829 0a20 2020 2020 2020   a hash).       
-000211b0: 2069 6620 7365 6c66 2e63 6163 6865 5f66   if self.cache_f
-000211c0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
-000211d0: 2020 6966 2063 6163 6865 5f66 696c 655f    if cache_file_
-000211e0: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
-000211f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00021200: 7765 2063 7265 6174 6520 6120 756e 6971  we create a uniq
-00021210: 7565 2068 6173 6820 6672 6f6d 2074 6865  ue hash from the
-00021220: 2066 756e 6374 696f 6e2c 0a20 2020 2020   function,.     
-00021230: 2020 2020 2020 2020 2020 2023 2063 7572             # cur
-00021240: 7265 6e74 2064 6174 6173 6574 2066 696c  rent dataset fil
-00021250: 6520 616e 6420 7468 6520 6d61 7070 696e  e and the mappin
-00021260: 6720 6172 6773 0a20 2020 2020 2020 2020  g args.         
-00021270: 2020 2020 2020 2063 6163 6865 5f66 696c         cache_fil
-00021280: 655f 6e61 6d65 203d 2073 656c 662e 5f67  e_name = self._g
-00021290: 6574 5f63 6163 6865 5f66 696c 655f 7061  et_cache_file_pa
-000212a0: 7468 286e 6577 5f66 696e 6765 7270 7269  th(new_fingerpri
-000212b0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
-000212c0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-000212d0: 7328 6361 6368 655f 6669 6c65 5f6e 616d  s(cache_file_nam
-000212e0: 6529 2061 6e64 206c 6f61 645f 6672 6f6d  e) and load_from
-000212f0: 5f63 6163 6865 5f66 696c 653a 0a20 2020  _cache_file:.   
-00021300: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-00021310: 6765 722e 7761 726e 696e 6728 6622 4c6f  ger.warning(f"Lo
-00021320: 6164 696e 6720 6361 6368 6564 2070 726f  ading cached pro
-00021330: 6365 7373 6564 2064 6174 6173 6574 2061  cessed dataset a
-00021340: 7420 7b63 6163 6865 5f66 696c 655f 6e61  t {cache_file_na
-00021350: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
-00021360: 2020 2020 2020 696e 666f 203d 2073 656c        info = sel
-00021370: 662e 696e 666f 2e63 6f70 7928 290a 2020  f.info.copy().  
-00021380: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00021390: 666f 2e66 6561 7475 7265 7320 3d20 6665  fo.features = fe
-000213a0: 6174 7572 6573 0a20 2020 2020 2020 2020  atures.         
-000213b0: 2020 2020 2020 2069 6e66 6f2e 7461 736b         info.task
-000213c0: 5f74 656d 706c 6174 6573 203d 204e 6f6e  _templates = Non
-000213d0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000213e0: 2020 7265 7475 726e 2044 6174 6173 6574    return Dataset
-000213f0: 2e66 726f 6d5f 6669 6c65 2863 6163 6865  .from_file(cache
-00021400: 5f66 696c 655f 6e61 6d65 2c20 696e 666f  _file_name, info
-00021410: 3d69 6e66 6f2c 2073 706c 6974 3d73 656c  =info, split=sel
-00021420: 662e 7370 6c69 7429 0a0a 2020 2020 2020  f.split)..      
-00021430: 2020 2320 5261 6973 6520 616e 2065 7272    # Raise an err
-00021440: 6f72 2069 6620 7765 2077 6572 6520 7375  or if we were su
-00021450: 7070 6f73 6564 2074 6f20 7265 7475 726e  pposed to return
-00021460: 2061 2063 6163 6865 6420 6461 7461 7365   a cached datase
-00021470: 7420 616e 6420 6e6f 6e65 2077 6173 2066  t and none was f
-00021480: 6f75 6e64 0a20 2020 2020 2020 2069 6620  ound.        if 
-00021490: 6361 6368 655f 6f6e 6c79 3a0a 2020 2020  cache_only:.    
-000214a0: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
-000214b0: 6e45 7869 7374 656e 7444 6174 6173 6574  nExistentDataset
-000214c0: 4572 726f 720a 0a20 2020 2020 2020 2023  Error..        #
-000214d0: 2057 6520 7365 7420 7468 6973 2076 6172   We set this var
-000214e0: 6961 626c 6520 746f 2054 7275 6520 6166  iable to True af
-000214f0: 7465 7220 7072 6f63 6573 7369 6e67 2074  ter processing t
-00021500: 6865 2066 6972 7374 2065 7861 6d70 6c65  he first example
-00021510: 2f62 6174 6368 2069 6e0a 2020 2020 2020  /batch in.      
-00021520: 2020 2320 6061 7070 6c79 5f66 756e 6374    # `apply_funct
-00021530: 696f 6e5f 6f6e 5f66 696c 7465 7265 645f  ion_on_filtered_
-00021540: 696e 7075 7473 6020 6966 2074 6865 206d  inputs` if the m
-00021550: 6170 2066 756e 6374 696f 6e20 7265 7475  ap function retu
-00021560: 726e 7320 6120 6469 6374 2e0a 2020 2020  rns a dict..    
-00021570: 2020 2020 2320 4966 2073 6574 2074 6f20      # If set to 
-00021580: 4661 6c73 652c 206e 6f20 6e65 7720 6172  False, no new ar
-00021590: 726f 7720 7461 626c 6520 7769 6c6c 2062  row table will b
-000215a0: 6520 6372 6561 7465 640a 0a20 2020 2020  e created..     
-000215b0: 2020 2075 7064 6174 655f 6461 7461 203d     update_data =
-000215c0: 204e 6f6e 650a 0a20 2020 2020 2020 2066   None..        f
-000215d0: 6f72 6d61 745f 6b77 6172 6773 203d 2073  ormat_kwargs = s
-000215e0: 656c 662e 5f66 6f72 6d61 745f 6b77 6172  elf._format_kwar
-000215f0: 6773 2e63 6f70 7928 290a 2020 2020 2020  gs.copy().      
-00021600: 2020 2320 4c61 7a79 2066 6f72 6d61 7474    # Lazy formatt
-00021610: 696e 6720 6973 206f 6e6c 7920 6176 6169  ing is only avai
-00021620: 6c61 626c 6520 666f 7220 7468 6520 6465  lable for the de
-00021630: 6661 756c 7420 666f 726d 6174 2028 4e6f  fault format (No
-00021640: 6e65 2f70 7974 686f 6e29 0a20 2020 2020  ne/python).     
-00021650: 2020 2069 6620 6e6f 7420 696e 7075 745f     if not input_
-00021660: 636f 6c75 6d6e 7320 616e 6420 7365 6c66  columns and self
-00021670: 2e5f 666f 726d 6174 5f74 7970 6520 6973  ._format_type is
-00021680: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00021690: 2020 2066 6f72 6d61 745f 6b77 6172 6773     format_kwargs
-000216a0: 5b22 6c61 7a79 225d 203d 2054 7275 650a  ["lazy"] = True.
-000216b0: 2020 2020 2020 2020 696e 7075 745f 666f          input_fo
-000216c0: 726d 6174 7465 7220 3d20 6765 745f 666f  rmatter = get_fo
-000216d0: 726d 6174 7465 7228 0a20 2020 2020 2020  rmatter(.       
-000216e0: 2020 2020 2073 656c 662e 5f66 6f72 6d61       self._forma
-000216f0: 745f 7479 7065 2c0a 2020 2020 2020 2020  t_type,.        
-00021700: 2020 2020 6665 6174 7572 6573 3d73 656c      features=sel
-00021710: 662e 6665 6174 7572 6573 2c0a 2020 2020  f.features,.    
-00021720: 2020 2020 2020 2020 2a2a 666f 726d 6174          **format
-00021730: 5f6b 7761 7267 732c 0a20 2020 2020 2020  _kwargs,.       
-00021740: 2029 0a0a 2020 2020 2020 2020 636c 6173   )..        clas
-00021750: 7320 4e75 6d45 7861 6d70 6c65 734d 6973  s NumExamplesMis
-00021760: 6d61 7463 6845 7272 6f72 2845 7863 6570  matchError(Excep
-00021770: 7469 6f6e 293a 0a20 2020 2020 2020 2020  tion):.         
-00021780: 2020 2070 6173 730a 0a20 2020 2020 2020     pass..       
-00021790: 2064 6566 2076 616c 6964 6174 655f 6675   def validate_fu
-000217a0: 6e63 7469 6f6e 5f6f 7574 7075 7428 7072  nction_output(pr
-000217b0: 6f63 6573 7365 645f 696e 7075 7473 2c20  ocessed_inputs, 
-000217c0: 696e 6469 6365 7329 3a0a 2020 2020 2020  indices):.      
-000217d0: 2020 2020 2020 2222 2256 616c 6964 6174        """Validat
-000217e0: 6520 6f75 7470 7574 206f 6620 7468 6520  e output of the 
-000217f0: 6d61 7020 6675 6e63 7469 6f6e 2e22 2222  map function."""
-00021800: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00021810: 7072 6f63 6573 7365 645f 696e 7075 7473  processed_inputs
-00021820: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00021830: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00021840: 7072 6f63 6573 7365 645f 696e 7075 7473  processed_inputs
-00021850: 2c20 284d 6170 7069 6e67 2c20 7061 2e54  , (Mapping, pa.T
-00021860: 6162 6c65 2929 3a0a 2020 2020 2020 2020  able)):.        
-00021870: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-00021880: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
-00021890: 2020 2020 2020 2020 2020 2020 2066 2250               f"P
-000218a0: 726f 7669 6465 6420 6066 756e 6374 696f  rovided `functio
-000218b0: 6e60 2077 6869 6368 2069 7320 6170 706c  n` which is appl
-000218c0: 6965 6420 746f 2061 6c6c 2065 6c65 6d65  ied to all eleme
-000218d0: 6e74 7320 6f66 2074 6162 6c65 2072 6574  nts of table ret
-000218e0: 7572 6e73 2061 2076 6172 6961 626c 6520  urns a variable 
-000218f0: 6f66 2074 7970 6520 7b74 7970 6528 7072  of type {type(pr
-00021900: 6f63 6573 7365 645f 696e 7075 7473 297d  ocessed_inputs)}
-00021910: 2e20 4d61 6b65 2073 7572 6520 7072 6f76  . Make sure prov
-00021920: 6964 6564 2060 6675 6e63 7469 6f6e 6020  ided `function` 
-00021930: 7265 7475 726e 7320 6120 7661 7269 6162  returns a variab
-00021940: 6c65 206f 6620 7479 7065 2060 6469 6374  le of type `dict
-00021950: 6020 286f 7220 6120 7079 6172 726f 7720  ` (or a pyarrow 
-00021960: 7461 626c 6529 2074 6f20 7570 6461 7465  table) to update
-00021970: 2074 6865 2064 6174 6173 6574 206f 7220   the dataset or 
-00021980: 604e 6f6e 6560 2069 6620 796f 7520 6172  `None` if you ar
-00021990: 6520 6f6e 6c79 2069 6e74 6572 6573 7465  e only intereste
-000219a0: 6420 696e 2073 6964 6520 6566 6665 6374  d in side effect
-000219b0: 732e 220a 2020 2020 2020 2020 2020 2020  s.".            
-000219c0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000219d0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-000219e0: 6528 696e 6469 6365 732c 206c 6973 7429  e(indices, list)
-000219f0: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
-00021a00: 7072 6f63 6573 7365 645f 696e 7075 7473  processed_inputs
-00021a10: 2c20 4d61 7070 696e 6729 3a0a 2020 2020  , Mapping):.    
-00021a20: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
-00021a30: 7765 645f 6261 7463 685f 7265 7475 726e  wed_batch_return
-00021a40: 5f74 7970 6573 203d 2028 6c69 7374 2c20  _types = (list, 
-00021a50: 6e70 2e6e 6461 7272 6179 2c20 7064 2e53  np.ndarray, pd.S
-00021a60: 6572 6965 7329 0a20 2020 2020 2020 2020  eries).         
-00021a70: 2020 2020 2020 2069 6620 636f 6e66 6967         if config
-00021a80: 2e54 465f 4156 4149 4c41 424c 4520 616e  .TF_AVAILABLE an
-00021a90: 6420 2274 656e 736f 7266 6c6f 7722 2069  d "tensorflow" i
-00021aa0: 6e20 7379 732e 6d6f 6475 6c65 733a 0a20  n sys.modules:. 
-00021ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ac0: 2020 2069 6d70 6f72 7420 7465 6e73 6f72     import tensor
-00021ad0: 666c 6f77 2061 7320 7466 0a0a 2020 2020  flow as tf..    
-00021ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021af0: 616c 6c6f 7765 645f 6261 7463 685f 7265  allowed_batch_re
-00021b00: 7475 726e 5f74 7970 6573 202b 3d20 2874  turn_types += (t
-00021b10: 662e 5465 6e73 6f72 2c29 0a20 2020 2020  f.Tensor,).     
-00021b20: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-00021b30: 6e66 6967 2e54 4f52 4348 5f41 5641 494c  nfig.TORCH_AVAIL
-00021b40: 4142 4c45 2061 6e64 2022 746f 7263 6822  ABLE and "torch"
-00021b50: 2069 6e20 7379 732e 6d6f 6475 6c65 733a   in sys.modules:
-00021b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021b70: 2020 2020 2069 6d70 6f72 7420 746f 7263       import torc
-00021b80: 680a 0a20 2020 2020 2020 2020 2020 2020  h..             
-00021b90: 2020 2020 2020 2061 6c6c 6f77 6564 5f62         allowed_b
-00021ba0: 6174 6368 5f72 6574 7572 6e5f 7479 7065  atch_return_type
-00021bb0: 7320 2b3d 2028 746f 7263 682e 5465 6e73  s += (torch.Tens
-00021bc0: 6f72 2c29 0a20 2020 2020 2020 2020 2020  or,).           
-00021bd0: 2020 2020 2069 6620 636f 6e66 6967 2e4a       if config.J
-00021be0: 4158 5f41 5641 494c 4142 4c45 2061 6e64  AX_AVAILABLE and
-00021bf0: 2022 6a61 7822 2069 6e20 7379 732e 6d6f   "jax" in sys.mo
-00021c00: 6475 6c65 733a 0a20 2020 2020 2020 2020  dules:.         
-00021c10: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
-00021c20: 7420 6a61 782e 6e75 6d70 7920 6173 206a  t jax.numpy as j
-00021c30: 6e70 0a0a 2020 2020 2020 2020 2020 2020  np..            
-00021c40: 2020 2020 2020 2020 616c 6c6f 7765 645f          allowed_
-00021c50: 6261 7463 685f 7265 7475 726e 5f74 7970  batch_return_typ
-00021c60: 6573 202b 3d20 286a 6e70 2e6e 6461 7272  es += (jnp.ndarr
-00021c70: 6179 2c29 0a20 2020 2020 2020 2020 2020  ay,).           
-00021c80: 2020 2020 2061 6c6c 5f64 6963 745f 7661       all_dict_va
-00021c90: 6c75 6573 5f61 7265 5f6c 6973 7473 203d  lues_are_lists =
-00021ca0: 2061 6c6c 280a 2020 2020 2020 2020 2020   all(.          
-00021cb0: 2020 2020 2020 2020 2020 6973 696e 7374            isinst
-00021cc0: 616e 6365 2876 616c 7565 2c20 616c 6c6f  ance(value, allo
-00021cd0: 7765 645f 6261 7463 685f 7265 7475 726e  wed_batch_return
-00021ce0: 5f74 7970 6573 2920 666f 7220 7661 6c75  _types) for valu
-00021cf0: 6520 696e 2070 726f 6365 7373 6564 5f69  e in processed_i
-00021d00: 6e70 7574 732e 7661 6c75 6573 2829 0a20  nputs.values(). 
-00021d10: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00021d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021d30: 2069 6620 616c 6c5f 6469 6374 5f76 616c   if all_dict_val
-00021d40: 7565 735f 6172 655f 6c69 7374 7320 6973  ues_are_lists is
-00021d50: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
-00021d60: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00021d70: 6520 5479 7065 4572 726f 7228 0a20 2020  e TypeError(.   
-00021d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021d90: 2020 2020 2066 2250 726f 7669 6465 6420       f"Provided 
-00021da0: 6066 756e 6374 696f 6e60 2077 6869 6368  `function` which
-00021db0: 2069 7320 6170 706c 6965 6420 746f 2061   is applied to a
-00021dc0: 6c6c 2065 6c65 6d65 6e74 7320 6f66 2074  ll elements of t
-00021dd0: 6162 6c65 2072 6574 7572 6e73 2061 2060  able returns a `
-00021de0: 6469 6374 6020 6f66 2074 7970 6573 207b  dict` of types {
-00021df0: 5b74 7970 6528 7829 2066 6f72 2078 2069  [type(x) for x i
-00021e00: 6e20 7072 6f63 6573 7365 645f 696e 7075  n processed_inpu
-00021e10: 7473 2e76 616c 7565 7328 295d 7d2e 2057  ts.values()]}. W
-00021e20: 6865 6e20 7573 696e 6720 6062 6174 6368  hen using `batch
-00021e30: 6564 3d54 7275 6560 2c20 6d61 6b65 2073  ed=True`, make s
-00021e40: 7572 6520 7072 6f76 6964 6564 2060 6675  ure provided `fu
-00021e50: 6e63 7469 6f6e 6020 7265 7475 726e 7320  nction` returns 
-00021e60: 6120 6064 6963 7460 206f 6620 7479 7065  a `dict` of type
-00021e70: 7320 6c69 6b65 2060 7b61 6c6c 6f77 6564  s like `{allowed
-00021e80: 5f62 6174 6368 5f72 6574 7572 6e5f 7479  _batch_return_ty
-00021e90: 7065 737d 602e 220a 2020 2020 2020 2020  pes}`.".        
-00021ea0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00021eb0: 2020 2020 2020 2064 6566 2061 7070 6c79         def apply
-00021ec0: 5f66 756e 6374 696f 6e5f 6f6e 5f66 696c  _function_on_fil
-00021ed0: 7465 7265 645f 696e 7075 7473 2870 615f  tered_inputs(pa_
-00021ee0: 696e 7075 7473 2c20 696e 6469 6365 732c  inputs, indices,
-00021ef0: 2063 6865 636b 5f73 616d 655f 6e75 6d5f   check_same_num_
-00021f00: 6578 616d 706c 6573 3d46 616c 7365 2c20  examples=False, 
-00021f10: 6f66 6673 6574 3d30 293a 0a20 2020 2020  offset=0):.     
-00021f20: 2020 2020 2020 2022 2222 5574 696c 6974         """Utilit
-00021f30: 7920 746f 2061 7070 6c79 2074 6865 2066  y to apply the f
-00021f40: 756e 6374 696f 6e20 6f6e 2061 2073 656c  unction on a sel
-00021f50: 6563 7469 6f6e 206f 6620 636f 6c75 6d6e  ection of column
-00021f60: 732e 2222 220a 2020 2020 2020 2020 2020  s.""".          
-00021f70: 2020 6e6f 6e6c 6f63 616c 2075 7064 6174    nonlocal updat
-00021f80: 655f 6461 7461 0a20 2020 2020 2020 2020  e_data.         
-00021f90: 2020 2069 6e70 7574 7320 3d20 666f 726d     inputs = form
-00021fa0: 6174 5f74 6162 6c65 280a 2020 2020 2020  at_table(.      
-00021fb0: 2020 2020 2020 2020 2020 7061 5f69 6e70            pa_inp
-00021fc0: 7574 732c 0a20 2020 2020 2020 2020 2020  uts,.           
-00021fd0: 2020 2020 2030 2069 6620 6e6f 7420 6261       0 if not ba
-00021fe0: 7463 6865 6420 656c 7365 2072 616e 6765  tched else range
-00021ff0: 2870 615f 696e 7075 7473 2e6e 756d 5f72  (pa_inputs.num_r
-00022000: 6f77 7329 2c0a 2020 2020 2020 2020 2020  ows),.          
-00022010: 2020 2020 2020 666f 726d 6174 5f63 6f6c        format_col
-00022020: 756d 6e73 3d69 6e70 7574 5f63 6f6c 756d  umns=input_colum
-00022030: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
-00022040: 2020 2020 666f 726d 6174 7465 723d 696e      formatter=in
-00022050: 7075 745f 666f 726d 6174 7465 722c 0a20  put_formatter,. 
-00022060: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00022070: 2020 2020 2020 2020 2066 6e5f 6172 6773           fn_args
-00022080: 203d 205b 696e 7075 7473 5d20 6966 2069   = [inputs] if i
-00022090: 6e70 7574 5f63 6f6c 756d 6e73 2069 7320  nput_columns is 
-000220a0: 4e6f 6e65 2065 6c73 6520 5b69 6e70 7574  None else [input
-000220b0: 735b 636f 6c5d 2066 6f72 2063 6f6c 2069  s[col] for col i
-000220c0: 6e20 696e 7075 745f 636f 6c75 6d6e 735d  n input_columns]
-000220d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000220e0: 6f66 6673 6574 203d 3d20 303a 0a20 2020  offset == 0:.   
-000220f0: 2020 2020 2020 2020 2020 2020 2065 6666               eff
-00022100: 6563 7469 7665 5f69 6e64 6963 6573 203d  ective_indices =
-00022110: 2069 6e64 6963 6573 0a20 2020 2020 2020   indices.       
-00022120: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00022130: 2020 2020 2020 2020 2020 2065 6666 6563             effec
-00022140: 7469 7665 5f69 6e64 6963 6573 203d 205b  tive_indices = [
-00022150: 6920 2b20 6f66 6673 6574 2066 6f72 2069  i + offset for i
-00022160: 2069 6e20 696e 6469 6365 735d 2069 6620   in indices] if 
-00022170: 6973 696e 7374 616e 6365 2869 6e64 6963  isinstance(indic
-00022180: 6573 2c20 6c69 7374 2920 656c 7365 2069  es, list) else i
-00022190: 6e64 6963 6573 202b 206f 6666 7365 740a  ndices + offset.
-000221a0: 2020 2020 2020 2020 2020 2020 6164 6469              addi
-000221b0: 7469 6f6e 616c 5f61 7267 7320 3d20 2829  tional_args = ()
-000221c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000221d0: 7769 7468 5f69 6e64 6963 6573 3a0a 2020  with_indices:.  
-000221e0: 2020 2020 2020 2020 2020 2020 2020 6164                ad
-000221f0: 6469 7469 6f6e 616c 5f61 7267 7320 2b3d  ditional_args +=
-00022200: 2028 6566 6665 6374 6976 655f 696e 6469   (effective_indi
-00022210: 6365 732c 290a 2020 2020 2020 2020 2020  ces,).          
-00022220: 2020 6966 2077 6974 685f 7261 6e6b 3a0a    if with_rank:.
-00022230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022240: 6164 6469 7469 6f6e 616c 5f61 7267 7320  additional_args 
-00022250: 2b3d 2028 7261 6e6b 2c29 0a20 2020 2020  += (rank,).     
-00022260: 2020 2020 2020 2070 726f 6365 7373 6564         processed
-00022270: 5f69 6e70 7574 7320 3d20 6675 6e63 7469  _inputs = functi
-00022280: 6f6e 282a 666e 5f61 7267 732c 202a 6164  on(*fn_args, *ad
-00022290: 6469 7469 6f6e 616c 5f61 7267 732c 202a  ditional_args, *
-000222a0: 2a66 6e5f 6b77 6172 6773 290a 2020 2020  *fn_kwargs).    
-000222b0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000222c0: 7461 6e63 6528 7072 6f63 6573 7365 645f  tance(processed_
-000222d0: 696e 7075 7473 2c20 4c61 7a79 4469 6374  inputs, LazyDict
-000222e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000222f0: 2020 2070 726f 6365 7373 6564 5f69 6e70     processed_inp
-00022300: 7574 7320 3d20 7b0a 2020 2020 2020 2020  uts = {.        
-00022310: 2020 2020 2020 2020 2020 2020 6b3a 2076              k: v
-00022320: 2066 6f72 206b 2c20 7620 696e 2070 726f   for k, v in pro
-00022330: 6365 7373 6564 5f69 6e70 7574 732e 6461  cessed_inputs.da
-00022340: 7461 2e69 7465 6d73 2829 2069 6620 6b20  ta.items() if k 
-00022350: 6e6f 7420 696e 2070 726f 6365 7373 6564  not in processed
-00022360: 5f69 6e70 7574 732e 6b65 7973 5f74 6f5f  _inputs.keys_to_
-00022370: 666f 726d 6174 0a20 2020 2020 2020 2020  format.         
-00022380: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00022390: 2020 2020 2020 2020 2072 6574 7572 6e65           returne
-000223a0: 645f 6c61 7a79 5f64 6963 7420 3d20 5472  d_lazy_dict = Tr
-000223b0: 7565 0a20 2020 2020 2020 2020 2020 2065  ue.            e
-000223c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000223d0: 2020 2020 2072 6574 7572 6e65 645f 6c61       returned_la
-000223e0: 7a79 5f64 6963 7420 3d20 4661 6c73 650a  zy_dict = False.
-000223f0: 2020 2020 2020 2020 2020 2020 6966 2075              if u
-00022400: 7064 6174 655f 6461 7461 2069 7320 4e6f  pdate_data is No
-00022410: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00022420: 2020 2020 2320 4368 6563 6b20 6966 2074      # Check if t
-00022430: 6865 2066 756e 6374 696f 6e20 7265 7475  he function retu
-00022440: 726e 7320 7570 6461 7465 6420 6578 616d  rns updated exam
-00022450: 706c 6573 0a20 2020 2020 2020 2020 2020  ples.           
-00022460: 2020 2020 2075 7064 6174 655f 6461 7461       update_data
-00022470: 203d 2069 7369 6e73 7461 6e63 6528 7072   = isinstance(pr
-00022480: 6f63 6573 7365 645f 696e 7075 7473 2c20  ocessed_inputs, 
-00022490: 284d 6170 7069 6e67 2c20 7061 2e54 6162  (Mapping, pa.Tab
-000224a0: 6c65 2929 0a20 2020 2020 2020 2020 2020  le)).           
-000224b0: 2020 2020 2076 616c 6964 6174 655f 6675       validate_fu
-000224c0: 6e63 7469 6f6e 5f6f 7574 7075 7428 7072  nction_output(pr
-000224d0: 6f63 6573 7365 645f 696e 7075 7473 2c20  ocessed_inputs, 
-000224e0: 696e 6469 6365 7329 0a20 2020 2020 2020  indices).       
-000224f0: 2020 2020 2069 6620 6e6f 7420 7570 6461       if not upda
-00022500: 7465 5f64 6174 613a 0a20 2020 2020 2020  te_data:.       
-00022510: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00022520: 4e6f 6e65 2020 2320 4e6f 7468 696e 6720  None  # Nothing 
-00022530: 746f 2075 7064 6174 652c 206c 6574 2773  to update, let's
-00022540: 206d 6f76 6520 6f6e 0a20 2020 2020 2020   move on.       
-00022550: 2020 2020 2069 6620 7365 6c66 2e5f 666f       if self._fo
-00022560: 726d 6174 5f74 7970 6520 6f72 2069 6e70  rmat_type or inp
-00022570: 7574 5f63 6f6c 756d 6e73 3a0a 2020 2020  ut_columns:.    
-00022580: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
-00022590: 444f 2851 4c2c 204d 5329 3a20 6964 6561  DO(QL, MS): idea
-000225a0: 6c6c 7920 7468 6520 6265 6861 7669 6f72  lly the behavior
-000225b0: 2073 686f 756c 6420 6265 2074 6865 2073   should be the s
-000225c0: 616d 6520 6576 656e 2069 6620 7468 6520  ame even if the 
-000225d0: 6461 7461 7365 7420 6973 2066 6f72 6d61  dataset is forma
-000225e0: 7474 6564 2028 6d61 7920 7265 7175 6972  tted (may requir
-000225f0: 6520 6d61 6a6f 7220 7265 6c65 6173 6529  e major release)
-00022600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022610: 2069 6e70 7574 735f 746f 5f6d 6572 6765   inputs_to_merge
-00022620: 203d 207b 6b3a 2076 2066 6f72 206b 2c20   = {k: v for k, 
-00022630: 7620 696e 207a 6970 2870 615f 696e 7075  v in zip(pa_inpu
-00022640: 7473 2e63 6f6c 756d 6e5f 6e61 6d65 732c  ts.column_names,
-00022650: 2070 615f 696e 7075 7473 2e69 7465 7263   pa_inputs.iterc
-00022660: 6f6c 756d 6e73 2829 297d 0a20 2020 2020  olumns())}.     
-00022670: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-00022680: 7374 616e 6365 2869 6e70 7574 732c 204c  stance(inputs, L
-00022690: 617a 7944 6963 7429 3a0a 2020 2020 2020  azyDict):.      
-000226a0: 2020 2020 2020 2020 2020 696e 7075 7473            inputs
-000226b0: 5f74 6f5f 6d65 7267 6520 3d20 7b0a 2020  _to_merge = {.  
-000226c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000226d0: 2020 6b3a 2028 7620 6966 206b 206e 6f74    k: (v if k not
-000226e0: 2069 6e20 696e 7075 7473 2e6b 6579 735f   in inputs.keys_
-000226f0: 746f 5f66 6f72 6d61 7420 656c 7365 2070  to_format else p
-00022700: 615f 696e 7075 7473 5b6b 5d29 2066 6f72  a_inputs[k]) for
-00022710: 206b 2c20 7620 696e 2069 6e70 7574 732e   k, v in inputs.
-00022720: 6461 7461 2e69 7465 6d73 2829 0a20 2020  data.items().   
-00022730: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-00022740: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00022750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022760: 2069 6e70 7574 735f 746f 5f6d 6572 6765   inputs_to_merge
-00022770: 203d 2069 6e70 7574 730a 2020 2020 2020   = inputs.      
-00022780: 2020 2020 2020 6966 2072 656d 6f76 655f        if remove_
-00022790: 636f 6c75 6d6e 7320 6973 206e 6f74 204e  columns is not N
-000227a0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000227b0: 2020 2020 2066 6f72 2063 6f6c 756d 6e20       for column 
-000227c0: 696e 2072 656d 6f76 655f 636f 6c75 6d6e  in remove_column
-000227d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000227e0: 2020 2020 2020 2023 2060 6675 6e63 7469         # `functi
-000227f0: 6f6e 6020 6361 6e20 6d6f 6469 6679 2069  on` can modify i
-00022800: 6e70 7574 2069 6e2d 706c 6163 6520 6361  nput in-place ca
-00022810: 7573 696e 6720 636f 6c75 6d6e 2074 6f20  using column to 
-00022820: 6265 2061 6c72 6561 6479 2072 656d 6f76  be already remov
-00022830: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-00022840: 2020 2020 2020 2020 6966 2063 6f6c 756d          if colum
-00022850: 6e20 696e 2069 6e70 7574 735f 746f 5f6d  n in inputs_to_m
-00022860: 6572 6765 3a0a 2020 2020 2020 2020 2020  erge:.          
-00022870: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00022880: 7075 7473 5f74 6f5f 6d65 7267 652e 706f  puts_to_merge.po
-00022890: 7028 636f 6c75 6d6e 290a 2020 2020 2020  p(column).      
-000228a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000228b0: 2072 6574 7572 6e65 645f 6c61 7a79 5f64   returned_lazy_d
-000228c0: 6963 7420 616e 6420 636f 6c75 6d6e 2069  ict and column i
-000228d0: 6e20 7072 6f63 6573 7365 645f 696e 7075  n processed_inpu
-000228e0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-000228f0: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
-00022900: 6573 7365 645f 696e 7075 7473 2e70 6f70  essed_inputs.pop
-00022910: 2863 6f6c 756d 6e29 0a20 2020 2020 2020  (column).       
-00022920: 2020 2020 2069 6620 6368 6563 6b5f 7361       if check_sa
-00022930: 6d65 5f6e 756d 5f65 7861 6d70 6c65 733a  me_num_examples:
-00022940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022950: 2069 6e70 7574 5f6e 756d 5f65 7861 6d70   input_num_examp
-00022960: 6c65 7320 3d20 6c65 6e28 7061 5f69 6e70  les = len(pa_inp
-00022970: 7574 7329 0a20 2020 2020 2020 2020 2020  uts).           
-00022980: 2020 2020 2070 726f 6365 7373 6564 5f69       processed_i
-00022990: 6e70 7574 735f 6e75 6d5f 6578 616d 706c  nputs_num_exampl
-000229a0: 6573 203d 206c 656e 2870 726f 6365 7373  es = len(process
-000229b0: 6564 5f69 6e70 7574 735b 6e65 7874 2869  ed_inputs[next(i
-000229c0: 7465 7228 7072 6f63 6573 7365 645f 696e  ter(processed_in
-000229d0: 7075 7473 2e6b 6579 7328 2929 295d 290a  puts.keys()))]).
-000229e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000229f0: 6966 2069 6e70 7574 5f6e 756d 5f65 7861  if input_num_exa
-00022a00: 6d70 6c65 7320 213d 2070 726f 6365 7373  mples != process
-00022a10: 6564 5f69 6e70 7574 735f 6e75 6d5f 6578  ed_inputs_num_ex
-00022a20: 616d 706c 6573 3a0a 2020 2020 2020 2020  amples:.        
-00022a30: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00022a40: 6520 4e75 6d45 7861 6d70 6c65 734d 6973  e NumExamplesMis
-00022a50: 6d61 7463 6845 7272 6f72 2829 0a20 2020  matchError().   
-00022a60: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00022a70: 7374 616e 6365 2869 6e70 7574 732c 204d  stance(inputs, M
-00022a80: 6170 7069 6e67 2920 616e 6420 6973 696e  apping) and isin
-00022a90: 7374 616e 6365 2870 726f 6365 7373 6564  stance(processed
-00022aa0: 5f69 6e70 7574 732c 204d 6170 7069 6e67  _inputs, Mapping
-00022ab0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00022ac0: 2020 2023 2054 6865 202e 6d61 7028 2920     # The .map() 
-00022ad0: 7472 616e 7366 6f72 6d20 2a75 7064 6174  transform *updat
-00022ae0: 6573 2a20 7468 6520 6461 7461 7365 743a  es* the dataset:
-00022af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022b00: 2023 2074 6865 206f 7574 7075 7420 6469   # the output di
-00022b10: 6374 696f 6e61 7279 2063 6f6e 7461 696e  ctionary contain
-00022b20: 7320 626f 7468 2074 6865 2074 6865 2069  s both the the i
-00022b30: 6e70 7574 2064 6174 6120 616e 6420 7468  nput data and th
-00022b40: 6520 6f75 7470 7574 2064 6174 612e 0a20  e output data.. 
-00022b50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00022b60: 2054 6865 206f 7574 7075 7420 6469 6374   The output dict
-00022b70: 696f 6e61 7279 206d 6179 2063 6f6e 7461  ionary may conta
-00022b80: 696e 2041 7272 6f77 2076 616c 7565 7320  in Arrow values 
-00022b90: 6672 6f6d 2060 696e 7075 7473 5f74 6f5f  from `inputs_to_
-00022ba0: 6d65 7267 6560 2073 6f20 7468 6174 2077  merge` so that w
-00022bb0: 6520 6361 6e20 7265 2d77 7269 7465 2074  e can re-write t
-00022bc0: 6865 6d20 6566 6669 6369 656e 746c 792e  hem efficiently.
-00022bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022be0: 2072 6574 7572 6e20 7b2a 2a69 6e70 7574   return {**input
-00022bf0: 735f 746f 5f6d 6572 6765 2c20 2a2a 7072  s_to_merge, **pr
-00022c00: 6f63 6573 7365 645f 696e 7075 7473 7d0a  ocessed_inputs}.
-00022c10: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00022c20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00022c30: 2020 7265 7475 726e 2070 726f 6365 7373    return process
-00022c40: 6564 5f69 6e70 7574 730a 0a20 2020 2020  ed_inputs..     
-00022c50: 2020 2064 6566 2069 6e69 745f 6275 6666     def init_buff
-00022c60: 6572 5f61 6e64 5f77 7269 7465 7228 293a  er_and_writer():
-00022c70: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
-00022c80: 7265 7061 7265 206f 7574 7075 7420 6275  repare output bu
-00022c90: 6666 6572 2061 6e64 2062 6174 6368 6564  ffer and batched
-00022ca0: 2077 7269 7465 7220 696e 206d 656d 6f72   writer in memor
-00022cb0: 7920 6f72 206f 6e20 6669 6c65 2069 6620  y or on file if 
-00022cc0: 7765 2075 7064 6174 6520 7468 6520 7461  we update the ta
-00022cd0: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
-00022ce0: 7772 6974 6572 5f66 6561 7475 7265 7320  writer_features 
-00022cf0: 3d20 6665 6174 7572 6573 0a20 2020 2020  = features.     
-00022d00: 2020 2020 2020 2069 6620 7772 6974 6572         if writer
-00022d10: 5f66 6561 7475 7265 7320 6973 204e 6f6e  _features is Non
-00022d20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00022d30: 2020 2077 7269 7465 725f 6665 6174 7572     writer_featur
-00022d40: 6573 203d 2073 656c 662e 6665 6174 7572  es = self.featur
-00022d50: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00022d60: 2020 2075 7064 6174 655f 6665 6174 7572     update_featur
-00022d70: 6573 203d 2054 7275 650a 2020 2020 2020  es = True.      
-00022d80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00022d90: 2020 2020 2020 2020 2020 2020 7570 6461              upda
-00022da0: 7465 5f66 6561 7475 7265 7320 3d20 4661  te_features = Fa
-00022db0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00022dc0: 6966 206b 6565 705f 696e 5f6d 656d 6f72  if keep_in_memor
-00022dd0: 7920 6f72 2063 6163 6865 5f66 696c 655f  y or cache_file_
-00022de0: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
-00022df0: 2020 2020 2020 2020 2020 2020 2020 6275                bu
-00022e00: 665f 7772 6974 6572 203d 2070 612e 4275  f_writer = pa.Bu
-00022e10: 6666 6572 4f75 7470 7574 5374 7265 616d  fferOutputStream
-00022e20: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00022e30: 2020 2074 6d70 5f66 696c 6520 3d20 4e6f     tmp_file = No
-00022e40: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-00022e50: 2020 2077 7269 7465 7220 3d20 4172 726f     writer = Arro
-00022e60: 7757 7269 7465 7228 0a20 2020 2020 2020  wWriter(.       
-00022e70: 2020 2020 2020 2020 2020 2020 2066 6561               fea
-00022e80: 7475 7265 733d 7772 6974 6572 5f66 6561  tures=writer_fea
-00022e90: 7475 7265 732c 0a20 2020 2020 2020 2020  tures,.         
-00022ea0: 2020 2020 2020 2020 2020 2073 7472 6561             strea
-00022eb0: 6d3d 6275 665f 7772 6974 6572 2c0a 2020  m=buf_writer,.  
-00022ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ed0: 2020 7772 6974 6572 5f62 6174 6368 5f73    writer_batch_s
-00022ee0: 697a 653d 7772 6974 6572 5f62 6174 6368  ize=writer_batch
-00022ef0: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-00022f00: 2020 2020 2020 2020 2020 2075 7064 6174             updat
-00022f10: 655f 6665 6174 7572 6573 3d75 7064 6174  e_features=updat
-00022f20: 655f 6665 6174 7572 6573 2c0a 2020 2020  e_features,.    
-00022f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f40: 6669 6e67 6572 7072 696e 743d 6e65 775f  fingerprint=new_
-00022f50: 6669 6e67 6572 7072 696e 742c 0a20 2020  fingerprint,.   
-00022f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f70: 2064 6973 6162 6c65 5f6e 756c 6c61 626c   disable_nullabl
-00022f80: 653d 6469 7361 626c 655f 6e75 6c6c 6162  e=disable_nullab
-00022f90: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-00022fa0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00022fb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00022fc0: 2020 2020 2020 2020 6275 665f 7772 6974          buf_writ
-00022fd0: 6572 203d 204e 6f6e 650a 2020 2020 2020  er = None.      
-00022fe0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00022ff0: 2e69 6e66 6f28 6622 4361 6368 696e 6720  .info(f"Caching 
-00023000: 7072 6f63 6573 7365 6420 6461 7461 7365  processed datase
-00023010: 7420 6174 207b 6361 6368 655f 6669 6c65  t at {cache_file
-00023020: 5f6e 616d 657d 2229 0a20 2020 2020 2020  _name}").       
-00023030: 2020 2020 2020 2020 2074 6d70 5f66 696c           tmp_fil
-00023040: 6520 3d20 7465 6d70 6669 6c65 2e4e 616d  e = tempfile.Nam
-00023050: 6564 5465 6d70 6f72 6172 7946 696c 6528  edTemporaryFile(
-00023060: 2277 6222 2c20 6469 723d 6f73 2e70 6174  "wb", dir=os.pat
-00023070: 682e 6469 726e 616d 6528 6361 6368 655f  h.dirname(cache_
-00023080: 6669 6c65 5f6e 616d 6529 2c20 6465 6c65  file_name), dele
-00023090: 7465 3d46 616c 7365 290a 2020 2020 2020  te=False).      
-000230a0: 2020 2020 2020 2020 2020 7772 6974 6572            writer
-000230b0: 203d 2041 7272 6f77 5772 6974 6572 280a   = ArrowWriter(.
-000230c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000230d0: 2020 2020 6665 6174 7572 6573 3d77 7269      features=wri
-000230e0: 7465 725f 6665 6174 7572 6573 2c0a 2020  ter_features,.  
-000230f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023100: 2020 7061 7468 3d74 6d70 5f66 696c 652e    path=tmp_file.
-00023110: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00023120: 2020 2020 2020 2020 2020 7772 6974 6572            writer
-00023130: 5f62 6174 6368 5f73 697a 653d 7772 6974  _batch_size=writ
-00023140: 6572 5f62 6174 6368 5f73 697a 652c 0a20  er_batch_size,. 
-00023150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023160: 2020 2075 7064 6174 655f 6665 6174 7572     update_featur
-00023170: 6573 3d75 7064 6174 655f 6665 6174 7572  es=update_featur
-00023180: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-00023190: 2020 2020 2020 2020 6669 6e67 6572 7072          fingerpr
-000231a0: 696e 743d 6e65 775f 6669 6e67 6572 7072  int=new_fingerpr
-000231b0: 696e 742c 0a20 2020 2020 2020 2020 2020  int,.           
-000231c0: 2020 2020 2020 2020 2064 6973 6162 6c65           disable
-000231d0: 5f6e 756c 6c61 626c 653d 6469 7361 626c  _nullable=disabl
-000231e0: 655f 6e75 6c6c 6162 6c65 2c0a 2020 2020  e_nullable,.    
-000231f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00023200: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00023210: 2062 7566 5f77 7269 7465 722c 2077 7269   buf_writer, wri
-00023220: 7465 722c 2074 6d70 5f66 696c 650a 0a20  ter, tmp_file.. 
-00023230: 2020 2020 2020 2023 2049 6620 6075 7064         # If `upd
-00023240: 6174 655f 6461 7461 6020 6973 2054 7275  ate_data` is Tru
-00023250: 6520 6166 7465 7220 7072 6f63 6573 7369  e after processi
-00023260: 6e67 2074 6865 2066 6972 7374 2065 7861  ng the first exa
-00023270: 6d70 6c65 2f62 6174 6368 2c20 696e 6974  mple/batch, init
-00023280: 616c 697a 6520 7468 6573 6520 7265 736f  alize these reso
-00023290: 7572 6365 7320 7769 7468 2060 696e 6974  urces with `init
-000232a0: 5f62 7566 6665 725f 616e 645f 7772 6974  _buffer_and_writ
-000232b0: 6572 600a 2020 2020 2020 2020 6275 665f  er`.        buf_
-000232c0: 7772 6974 6572 2c20 7772 6974 6572 2c20  writer, writer, 
-000232d0: 746d 705f 6669 6c65 203d 204e 6f6e 652c  tmp_file = None,
-000232e0: 204e 6f6e 652c 204e 6f6e 650a 0a20 2020   None, None..   
-000232f0: 2020 2020 2023 204f 7074 696f 6e61 6c6c       # Optionall
-00023300: 7920 696e 6974 6961 6c69 7a65 2074 6865  y initialize the
-00023310: 2077 7269 7465 7220 6173 2061 2063 6f6e   writer as a con
-00023320: 7465 7874 206d 616e 6167 6572 0a20 2020  text manager.   
-00023330: 2020 2020 2077 6974 6820 636f 6e74 6578       with contex
-00023340: 746c 6962 2e45 7869 7453 7461 636b 2829  tlib.ExitStack()
-00023350: 2061 7320 7374 6163 6b3a 0a20 2020 2020   as stack:.     
-00023360: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00023370: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-00023380: 745f 6461 7461 7365 7420 3d20 7365 6c66  t_dataset = self
-00023390: 2e77 6974 685f 666f 726d 6174 2822 6172  .with_format("ar
-000233a0: 726f 7722 290a 0a20 2020 2020 2020 2020  row")..         
-000233b0: 2020 2020 2020 2023 204c 6f6f 7020 6f76         # Loop ov
-000233c0: 6572 2073 696e 676c 6520 6578 616d 706c  er single exampl
-000233d0: 6573 206f 7220 6261 7463 6865 7320 616e  es or batches an
-000233e0: 6420 7772 6974 6520 746f 2062 7566 6665  d write to buffe
-000233f0: 722f 6669 6c65 2069 6620 6578 616d 706c  r/file if exampl
-00023400: 6573 2061 7265 2074 6f20 6265 2075 7064  es are to be upd
-00023410: 6174 6564 0a20 2020 2020 2020 2020 2020  ated.           
-00023420: 2020 2020 2069 6620 6e6f 7420 6261 7463       if not batc
-00023430: 6865 643a 0a20 2020 2020 2020 2020 2020  hed:.           
-00023440: 2020 2020 2020 2020 2070 6261 725f 746f           pbar_to
-00023450: 7461 6c20 3d20 6c65 6e28 696e 7075 745f  tal = len(input_
-00023460: 6461 7461 7365 7429 0a20 2020 2020 2020  dataset).       
-00023470: 2020 2020 2020 2020 2020 2020 2070 6261               pba
-00023480: 725f 6974 6572 6162 6c65 203d 2065 6e75  r_iterable = enu
-00023490: 6d65 7261 7465 2869 6e70 7574 5f64 6174  merate(input_dat
-000234a0: 6173 6574 290a 2020 2020 2020 2020 2020  aset).          
-000234b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000234c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000234d0: 6e75 6d5f 726f 7773 203d 2028 0a20 2020  num_rows = (.   
-000234e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000234f0: 2020 2020 206c 656e 2869 6e70 7574 5f64       len(input_d
-00023500: 6174 6173 6574 2920 6966 206e 6f74 2064  ataset) if not d
-00023510: 726f 705f 6c61 7374 5f62 6174 6368 2065  rop_last_batch e
-00023520: 6c73 6520 6c65 6e28 696e 7075 745f 6461  lse len(input_da
-00023530: 7461 7365 7429 202f 2f20 6261 7463 685f  taset) // batch_
-00023540: 7369 7a65 202a 2062 6174 6368 5f73 697a  size * batch_siz
-00023550: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00023560: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00023570: 2020 2020 2020 2020 2020 2020 7062 6172              pbar
-00023580: 5f74 6f74 616c 203d 2028 6e75 6d5f 726f  _total = (num_ro
-00023590: 7773 202f 2f20 6261 7463 685f 7369 7a65  ws // batch_size
-000235a0: 2920 2b20 3120 6966 206e 756d 5f72 6f77  ) + 1 if num_row
-000235b0: 7320 2520 6261 7463 685f 7369 7a65 2065  s % batch_size e
-000235c0: 6c73 6520 6e75 6d5f 726f 7773 202f 2f20  lse num_rows // 
-000235d0: 6261 7463 685f 7369 7a65 0a20 2020 2020  batch_size.     
-000235e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000235f0: 6261 725f 6974 6572 6162 6c65 203d 207a  bar_iterable = z
-00023600: 6970 280a 2020 2020 2020 2020 2020 2020  ip(.            
-00023610: 2020 2020 2020 2020 2020 2020 7261 6e67              rang
-00023620: 6528 302c 206e 756d 5f72 6f77 732c 2062  e(0, num_rows, b
-00023630: 6174 6368 5f73 697a 6529 2c0a 2020 2020  atch_size),.    
-00023640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023650: 2020 2020 696e 7075 745f 6461 7461 7365      input_datase
-00023660: 742e 6974 6572 2862 6174 6368 5f73 697a  t.iter(batch_siz
-00023670: 652c 2064 726f 705f 6c61 7374 5f62 6174  e, drop_last_bat
-00023680: 6368 3d64 726f 705f 6c61 7374 5f62 6174  ch=drop_last_bat
-00023690: 6368 292c 0a20 2020 2020 2020 2020 2020  ch),.           
-000236a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000236b0: 2020 2020 2020 2020 2020 2070 6261 725f             pbar_
-000236c0: 756e 6974 203d 2022 6578 2220 6966 206e  unit = "ex" if n
-000236d0: 6f74 2062 6174 6368 6564 2065 6c73 6520  ot batched else 
-000236e0: 2262 6122 0a20 2020 2020 2020 2020 2020  "ba".           
-000236f0: 2020 2020 2070 6261 725f 6465 7363 203d       pbar_desc =
-00023700: 2028 6465 7363 202b 2022 2022 2069 6620   (desc + " " if 
-00023710: 6465 7363 2069 7320 6e6f 7420 4e6f 6e65  desc is not None
-00023720: 2065 6c73 6520 2222 2920 2b20 2223 2220   else "") + "#" 
-00023730: 2b20 7374 7228 7261 6e6b 2920 6966 2072  + str(rank) if r
-00023740: 616e 6b20 6973 206e 6f74 204e 6f6e 6520  ank is not None 
-00023750: 656c 7365 2064 6573 630a 2020 2020 2020  else desc.      
-00023760: 2020 2020 2020 2020 2020 7062 6172 203d            pbar =
-00023770: 206c 6f67 6769 6e67 2e74 7164 6d28 0a20   logging.tqdm(. 
-00023780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023790: 2020 2070 6261 725f 6974 6572 6162 6c65     pbar_iterable
-000237a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000237b0: 2020 2020 2020 746f 7461 6c3d 7062 6172        total=pbar
-000237c0: 5f74 6f74 616c 2c0a 2020 2020 2020 2020  _total,.        
-000237d0: 2020 2020 2020 2020 2020 2020 6469 7361              disa
-000237e0: 626c 653d 6469 7361 626c 655f 7471 646d  ble=disable_tqdm
-000237f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00023800: 2020 2020 2020 706f 7369 7469 6f6e 3d72        position=r
-00023810: 616e 6b2c 0a20 2020 2020 2020 2020 2020  ank,.           
-00023820: 2020 2020 2020 2020 2075 6e69 743d 7062           unit=pb
-00023830: 6172 5f75 6e69 742c 0a20 2020 2020 2020  ar_unit,.       
-00023840: 2020 2020 2020 2020 2020 2020 2064 6573               des
-00023850: 633d 7062 6172 5f64 6573 632c 0a20 2020  c=pbar_desc,.   
-00023860: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00023870: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023880: 6620 6e6f 7420 6261 7463 6865 643a 0a20  f not batched:. 
-00023890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000238a0: 2020 2066 6f72 2069 2c20 6578 616d 706c     for i, exampl
-000238b0: 6520 696e 2070 6261 723a 0a20 2020 2020  e in pbar:.     
-000238c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000238d0: 2020 2065 7861 6d70 6c65 203d 2061 7070     example = app
-000238e0: 6c79 5f66 756e 6374 696f 6e5f 6f6e 5f66  ly_function_on_f
-000238f0: 696c 7465 7265 645f 696e 7075 7473 2865  iltered_inputs(e
-00023900: 7861 6d70 6c65 2c20 692c 206f 6666 7365  xample, i, offse
-00023910: 743d 6f66 6673 6574 290a 2020 2020 2020  t=offset).      
+0000da00: 2020 2070 6261 722e 7570 6461 7465 2863     pbar.update(c
+0000da10: 6f6e 7465 6e74 290a 2020 2020 2020 2020  ontent).        
+0000da20: 7769 7468 2066 732e 6f70 656e 2870 6174  with fs.open(pat
+0000da30: 685f 6a6f 696e 2864 6174 6173 6574 5f70  h_join(dataset_p
+0000da40: 6174 682c 2063 6f6e 6669 672e 4441 5441  ath, config.DATA
+0000da50: 5345 545f 5354 4154 455f 4a53 4f4e 5f46  SET_STATE_JSON_F
+0000da60: 494c 454e 414d 4529 2c20 2277 222c 2065  ILENAME), "w", e
+0000da70: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
+0000da80: 2061 7320 7374 6174 655f 6669 6c65 3a0a   as state_file:.
+0000da90: 2020 2020 2020 2020 2020 2020 6a73 6f6e              json
+0000daa0: 2e64 756d 7028 7374 6174 652c 2073 7461  .dump(state, sta
+0000dab0: 7465 5f66 696c 652c 2069 6e64 656e 743d  te_file, indent=
+0000dac0: 322c 2073 6f72 745f 6b65 7973 3d54 7275  2, sort_keys=Tru
+0000dad0: 6529 0a20 2020 2020 2020 2077 6974 6820  e).        with 
+0000dae0: 6673 2e6f 7065 6e28 0a20 2020 2020 2020  fs.open(.       
+0000daf0: 2020 2020 2070 6174 685f 6a6f 696e 2864       path_join(d
+0000db00: 6174 6173 6574 5f70 6174 682c 2063 6f6e  ataset_path, con
+0000db10: 6669 672e 4441 5441 5345 545f 494e 464f  fig.DATASET_INFO
+0000db20: 5f46 494c 454e 414d 4529 2c20 2277 222c  _FILENAME), "w",
+0000db30: 2065 6e63 6f64 696e 673d 2275 7466 2d38   encoding="utf-8
+0000db40: 220a 2020 2020 2020 2020 2920 6173 2064  ".        ) as d
+0000db50: 6174 6173 6574 5f69 6e66 6f5f 6669 6c65  ataset_info_file
+0000db60: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0000db70: 536f 7274 206f 6e6c 7920 7468 6520 6669  Sort only the fi
+0000db80: 7273 7420 6c65 7665 6c20 6f66 206b 6579  rst level of key
+0000db90: 732c 206f 7220 7765 206d 6967 6874 2073  s, or we might s
+0000dba0: 6875 6666 6c65 2066 6965 6c64 7320 6f66  huffle fields of
+0000dbb0: 206e 6573 7465 6420 6665 6174 7572 6573   nested features
+0000dbc0: 2069 6620 7765 2075 7365 2073 6f72 745f   if we use sort_
+0000dbd0: 6b65 7973 3d54 7275 650a 2020 2020 2020  keys=True.      
+0000dbe0: 2020 2020 2020 736f 7274 6564 5f6b 6579        sorted_key
+0000dbf0: 735f 6461 7461 7365 745f 696e 666f 203d  s_dataset_info =
+0000dc00: 207b 6b65 793a 2064 6174 6173 6574 5f69   {key: dataset_i
+0000dc10: 6e66 6f5b 6b65 795d 2066 6f72 206b 6579  nfo[key] for key
+0000dc20: 2069 6e20 736f 7274 6564 2864 6174 6173   in sorted(datas
+0000dc30: 6574 5f69 6e66 6f29 7d0a 2020 2020 2020  et_info)}.      
+0000dc40: 2020 2020 2020 6a73 6f6e 2e64 756d 7028        json.dump(
+0000dc50: 736f 7274 6564 5f6b 6579 735f 6461 7461  sorted_keys_data
+0000dc60: 7365 745f 696e 666f 2c20 6461 7461 7365  set_info, datase
+0000dc70: 745f 696e 666f 5f66 696c 652c 2069 6e64  t_info_file, ind
+0000dc80: 656e 743d 3229 0a0a 2020 2020 4073 7461  ent=2)..    @sta
+0000dc90: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+0000dca0: 6620 5f73 6176 655f 746f 5f64 6973 6b5f  f _save_to_disk_
+0000dcb0: 7369 6e67 6c65 286a 6f62 5f69 643a 2069  single(job_id: i
+0000dcc0: 6e74 2c20 7368 6172 643a 2022 4461 7461  nt, shard: "Data
+0000dcd0: 7365 7422 2c20 6670 6174 683a 2073 7472  set", fpath: str
+0000dce0: 2c20 7374 6f72 6167 655f 6f70 7469 6f6e  , storage_option
+0000dcf0: 733a 204f 7074 696f 6e61 6c5b 6469 6374  s: Optional[dict
+0000dd00: 5d29 3a0a 2020 2020 2020 2020 6261 7463  ]):.        batc
+0000dd10: 685f 7369 7a65 203d 2063 6f6e 6669 672e  h_size = config.
+0000dd20: 4445 4641 554c 545f 4d41 585f 4241 5443  DEFAULT_MAX_BATC
+0000dd30: 485f 5349 5a45 0a0a 2020 2020 2020 2020  H_SIZE..        
+0000dd40: 6966 2073 6861 7264 2e5f 696e 6469 6365  if shard._indice
+0000dd50: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+0000dd60: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000dd70: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0000dd80: 2020 2020 2020 2020 2020 2020 2022 605f               "`_
+0000dd90: 7361 7665 5f74 6f5f 6469 736b 5f73 696e  save_to_disk_sin
+0000dda0: 676c 6560 206f 6e6c 7920 7375 7070 6f72  gle` only suppor
+0000ddb0: 7420 7368 6172 6473 2077 6974 6820 666c  t shards with fl
+0000ddc0: 6174 7465 6e65 6420 696e 6469 6365 732e  attened indices.
+0000ddd0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0000dde0: 2020 2022 506c 6561 7365 2063 616c 6c20     "Please call 
+0000ddf0: 6473 2e66 6c61 7474 656e 5f69 6e64 6963  ds.flatten_indic
+0000de00: 6573 2829 2062 6566 6f72 6520 7361 7669  es() before savi
+0000de10: 6e67 2074 6f20 6469 736b 2e22 0a20 2020  ng to disk.".   
+0000de20: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000de30: 2020 2020 6e75 6d5f 6578 616d 706c 6573      num_examples
+0000de40: 5f70 726f 6772 6573 735f 7570 6461 7465  _progress_update
+0000de50: 203d 2030 0a20 2020 2020 2020 2077 7269   = 0.        wri
+0000de60: 7465 7220 3d20 4172 726f 7757 7269 7465  ter = ArrowWrite
+0000de70: 7228 0a20 2020 2020 2020 2020 2020 2066  r(.            f
+0000de80: 6561 7475 7265 733d 7368 6172 642e 6665  eatures=shard.fe
+0000de90: 6174 7572 6573 2c0a 2020 2020 2020 2020  atures,.        
+0000dea0: 2020 2020 7061 7468 3d66 7061 7468 2c0a      path=fpath,.
+0000deb0: 2020 2020 2020 2020 2020 2020 7374 6f72              stor
+0000dec0: 6167 655f 6f70 7469 6f6e 733d 7374 6f72  age_options=stor
+0000ded0: 6167 655f 6f70 7469 6f6e 732c 0a20 2020  age_options,.   
+0000dee0: 2020 2020 2020 2020 2065 6d62 6564 5f6c           embed_l
+0000def0: 6f63 616c 5f66 696c 6573 3d54 7275 652c  ocal_files=True,
+0000df00: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0000df10: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000df20: 2020 2020 5f74 696d 6520 3d20 7469 6d65      _time = time
+0000df30: 2e74 696d 6528 290a 2020 2020 2020 2020  .time().        
+0000df40: 2020 2020 666f 7220 7061 5f74 6162 6c65      for pa_table
+0000df50: 2069 6e20 7461 626c 655f 6974 6572 2873   in table_iter(s
+0000df60: 6861 7264 2e64 6174 612c 2062 6174 6368  hard.data, batch
+0000df70: 5f73 697a 653d 6261 7463 685f 7369 7a65  _size=batch_size
+0000df80: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000df90: 2020 2077 7269 7465 722e 7772 6974 655f     writer.write_
+0000dfa0: 7461 626c 6528 7061 5f74 6162 6c65 290a  table(pa_table).
+0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfc0: 6e75 6d5f 6578 616d 706c 6573 5f70 726f  num_examples_pro
+0000dfd0: 6772 6573 735f 7570 6461 7465 202b 3d20  gress_update += 
+0000dfe0: 6c65 6e28 7061 5f74 6162 6c65 290a 2020  len(pa_table).  
+0000dff0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000e000: 2074 696d 652e 7469 6d65 2829 203e 205f   time.time() > _
+0000e010: 7469 6d65 202b 2063 6f6e 6669 672e 5042  time + config.PB
+0000e020: 4152 5f52 4546 5245 5348 5f54 494d 455f  AR_REFRESH_TIME_
+0000e030: 494e 5445 5256 414c 3a0a 2020 2020 2020  INTERVAL:.      
+0000e040: 2020 2020 2020 2020 2020 2020 2020 5f74                _t
+0000e050: 696d 6520 3d20 7469 6d65 2e74 696d 6528  ime = time.time(
+0000e060: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e070: 2020 2020 2020 7969 656c 6420 6a6f 625f        yield job_
+0000e080: 6964 2c20 4661 6c73 652c 206e 756d 5f65  id, False, num_e
+0000e090: 7861 6d70 6c65 735f 7072 6f67 7265 7373  xamples_progress
+0000e0a0: 5f75 7064 6174 650a 2020 2020 2020 2020  _update.        
+0000e0b0: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+0000e0c0: 6578 616d 706c 6573 5f70 726f 6772 6573  examples_progres
+0000e0d0: 735f 7570 6461 7465 203d 2030 0a20 2020  s_update = 0.   
+0000e0e0: 2020 2020 2066 696e 616c 6c79 3a0a 2020       finally:.  
+0000e0f0: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
+0000e100: 6a6f 625f 6964 2c20 4661 6c73 652c 206e  job_id, False, n
+0000e110: 756d 5f65 7861 6d70 6c65 735f 7072 6f67  um_examples_prog
+0000e120: 7265 7373 5f75 7064 6174 650a 2020 2020  ress_update.    
+0000e130: 2020 2020 2020 2020 6e75 6d5f 6578 616d          num_exam
+0000e140: 706c 6573 2c20 6e75 6d5f 6279 7465 7320  ples, num_bytes 
+0000e150: 3d20 7772 6974 6572 2e66 696e 616c 697a  = writer.finaliz
+0000e160: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+0000e170: 7772 6974 6572 2e63 6c6f 7365 2829 0a0a  writer.close()..
+0000e180: 2020 2020 2020 2020 7969 656c 6420 6a6f          yield jo
+0000e190: 625f 6964 2c20 5472 7565 2c20 286e 756d  b_id, True, (num
+0000e1a0: 5f65 7861 6d70 6c65 732c 206e 756d 5f62  _examples, num_b
+0000e1b0: 7974 6573 290a 0a20 2020 2040 7374 6174  ytes)..    @stat
+0000e1c0: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+0000e1d0: 205f 6275 696c 645f 6c6f 6361 6c5f 7465   _build_local_te
+0000e1e0: 6d70 5f70 6174 6828 7572 695f 6f72 5f70  mp_path(uri_or_p
+0000e1f0: 6174 683a 2073 7472 2920 2d3e 2050 6174  ath: str) -> Pat
+0000e200: 683a 0a20 2020 2020 2020 2022 2222 0a20  h:.        """. 
+0000e210: 2020 2020 2020 2042 7569 6c64 7320 616e         Builds an
+0000e220: 6420 7265 7475 726e 7320 6120 5061 7468  d returns a Path
+0000e230: 2063 6f6e 6361 7465 6e61 7469 6e67 2061   concatenating a
+0000e240: 206c 6f63 616c 2074 656d 706f 7261 7279   local temporary
+0000e250: 2064 6972 2077 6974 6820 7468 6520 6469   dir with the di
+0000e260: 7220 7061 7468 2028 6f72 2061 6273 6f6c  r path (or absol
+0000e270: 7574 652f 7265 6c61 7469 7665 0a20 2020  ute/relative.   
+0000e280: 2020 2020 2070 6174 6820 6578 7472 6163       path extrac
+0000e290: 7465 6420 6672 6f6d 2074 6865 2075 7269  ted from the uri
+0000e2a0: 2920 7061 7373 6564 2e0a 0a20 2020 2020  ) passed...     
+0000e2b0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+0000e2c0: 2020 2020 2075 7269 5f6f 725f 7061 7468       uri_or_path
+0000e2d0: 2028 6073 7472 6029 3a20 5061 7468 2028   (`str`): Path (
+0000e2e0: 652e 672e 2060 2264 6174 6173 6574 2f74  e.g. `"dataset/t
+0000e2f0: 7261 696e 2260 2920 6f72 2072 656d 6f74  rain"`) or remot
+0000e300: 6520 5552 4920 2865 2e67 2e0a 2020 2020  e URI (e.g..    
+0000e310: 2020 2020 2020 2020 2020 2020 6022 7333              `"s3
+0000e320: 3a2f 2f6d 792d 6275 636b 6574 2f64 6174  ://my-bucket/dat
+0000e330: 6173 6574 2f74 7261 696e 2260 2920 746f  aset/train"`) to
+0000e340: 2063 6f6e 6361 7465 6e61 7465 2e0a 0a20   concatenate... 
+0000e350: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
+0000e360: 2020 2020 2020 2020 2020 2020 3a63 6c61              :cla
+0000e370: 7373 3a60 5061 7468 603a 2074 6865 2063  ss:`Path`: the c
+0000e380: 6f6e 6361 7465 6e61 7465 6420 7061 7468  oncatenated path
+0000e390: 2028 7465 6d70 2064 6972 202b 2070 6174   (temp dir + pat
+0000e3a0: 6829 0a20 2020 2020 2020 2022 2222 0a20  h).        """. 
+0000e3b0: 2020 2020 2020 2073 7263 5f64 6174 6173         src_datas
+0000e3c0: 6574 5f70 6174 6820 3d20 5061 7468 2875  et_path = Path(u
+0000e3d0: 7269 5f6f 725f 7061 7468 290a 2020 2020  ri_or_path).    
+0000e3e0: 2020 2020 746d 705f 6469 7220 3d20 6765      tmp_dir = ge
+0000e3f0: 745f 7465 6d70 6f72 6172 795f 6361 6368  t_temporary_cach
+0000e400: 655f 6669 6c65 735f 6469 7265 6374 6f72  e_files_director
+0000e410: 7928 290a 2020 2020 2020 2020 7265 7475  y().        retu
+0000e420: 726e 2050 6174 6828 746d 705f 6469 722c  rn Path(tmp_dir,
+0000e430: 2073 7263 5f64 6174 6173 6574 5f70 6174   src_dataset_pat
+0000e440: 682e 7265 6c61 7469 7665 5f74 6f28 7372  h.relative_to(sr
+0000e450: 635f 6461 7461 7365 745f 7061 7468 2e61  c_dataset_path.a
+0000e460: 6e63 686f 7229 290a 0a20 2020 2040 7374  nchor))..    @st
+0000e470: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+0000e480: 6566 206c 6f61 645f 6672 6f6d 5f64 6973  ef load_from_dis
+0000e490: 6b28 0a20 2020 2020 2020 2064 6174 6173  k(.        datas
+0000e4a0: 6574 5f70 6174 683a 2073 7472 2c0a 2020  et_path: str,.  
+0000e4b0: 2020 2020 2020 6673 3d22 6465 7072 6563        fs="deprec
+0000e4c0: 6174 6564 222c 0a20 2020 2020 2020 206b  ated",.        k
+0000e4d0: 6565 705f 696e 5f6d 656d 6f72 793a 204f  eep_in_memory: O
+0000e4e0: 7074 696f 6e61 6c5b 626f 6f6c 5d20 3d20  ptional[bool] = 
+0000e4f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7374  None,.        st
+0000e500: 6f72 6167 655f 6f70 7469 6f6e 733a 204f  orage_options: O
+0000e510: 7074 696f 6e61 6c5b 6469 6374 5d20 3d20  ptional[dict] = 
+0000e520: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 2022  None,.    ) -> "
+0000e530: 4461 7461 7365 7422 3a0a 2020 2020 2020  Dataset":.      
+0000e540: 2020 2222 220a 2020 2020 2020 2020 4c6f    """.        Lo
+0000e550: 6164 7320 6120 6461 7461 7365 7420 7468  ads a dataset th
+0000e560: 6174 2077 6173 2070 7265 7669 6f75 736c  at was previousl
+0000e570: 7920 7361 7665 6420 7573 696e 6720 5b60  y saved using [`
+0000e580: 7361 7665 5f74 6f5f 6469 736b 605d 2066  save_to_disk`] f
+0000e590: 726f 6d20 6120 6461 7461 7365 7420 6469  rom a dataset di
+0000e5a0: 7265 6374 6f72 792c 206f 7220 6672 6f6d  rectory, or from
+0000e5b0: 2061 0a20 2020 2020 2020 2066 696c 6573   a.        files
+0000e5c0: 7973 7465 6d20 7573 696e 6720 6569 7468  ystem using eith
+0000e5d0: 6572 2060 7333 6673 2e53 3346 696c 6553  er `s3fs.S3FileS
+0000e5e0: 7973 7465 6d60 206f 7220 616e 7920 696d  ystem` or any im
+0000e5f0: 706c 656d 656e 7461 7469 6f6e 206f 660a  plementation of.
+0000e600: 2020 2020 2020 2020 6066 7373 7065 632e          `fsspec.
+0000e610: 7370 6563 2e41 6273 7472 6163 7446 696c  spec.AbstractFil
+0000e620: 6553 7973 7465 6d60 2e0a 0a20 2020 2020  eSystem`...     
+0000e630: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+0000e640: 2020 2020 2064 6174 6173 6574 5f70 6174       dataset_pat
+0000e650: 6820 2860 7374 7260 293a 0a20 2020 2020  h (`str`):.     
+0000e660: 2020 2020 2020 2020 2020 2050 6174 6820             Path 
+0000e670: 2865 2e67 2e20 6022 6461 7461 7365 742f  (e.g. `"dataset/
+0000e680: 7472 6169 6e22 6029 206f 7220 7265 6d6f  train"`) or remo
+0000e690: 7465 2055 5249 2028 652e 672e 2060 2273  te URI (e.g. `"s
+0000e6a0: 332f 2f6d 792d 6275 636b 6574 2f64 6174  3//my-bucket/dat
+0000e6b0: 6173 6574 2f74 7261 696e 2260 290a 2020  aset/train"`).  
+0000e6c0: 2020 2020 2020 2020 2020 2020 2020 6f66                of
+0000e6d0: 2074 6865 2064 6174 6173 6574 2064 6972   the dataset dir
+0000e6e0: 6563 746f 7279 2077 6865 7265 2074 6865  ectory where the
+0000e6f0: 2064 6174 6173 6574 2077 696c 6c20 6265   dataset will be
+0000e700: 206c 6f61 6465 6420 6672 6f6d 2e0a 2020   loaded from..  
+0000e710: 2020 2020 2020 2020 2020 6673 2028 6066            fs (`f
+0000e720: 7373 7065 632e 7370 6563 2e41 6273 7472  sspec.spec.Abstr
+0000e730: 6163 7446 696c 6553 7973 7465 6d60 2c20  actFileSystem`, 
+0000e740: 2a6f 7074 696f 6e61 6c2a 293a 0a20 2020  *optional*):.   
+0000e750: 2020 2020 2020 2020 2020 2020 2049 6e73               Ins
+0000e760: 7461 6e63 6520 6f66 2074 6865 2072 656d  tance of the rem
+0000e770: 6f74 6520 6669 6c65 7379 7374 656d 2077  ote filesystem w
+0000e780: 6865 7265 2074 6865 2064 6174 6173 6574  here the dataset
+0000e790: 2077 696c 6c20 6265 2073 6176 6564 2074   will be saved t
+0000e7a0: 6f2e 0a0a 2020 2020 2020 2020 2020 2020  o...            
+0000e7b0: 2020 2020 3c44 6570 7265 6361 7465 6420      <Deprecated 
+0000e7c0: 7665 7273 696f 6e3d 2232 2e38 2e30 223e  version="2.8.0">
+0000e7d0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e7e0: 2020 6066 7360 2077 6173 2064 6570 7265    `fs` was depre
+0000e7f0: 6361 7465 6420 696e 2076 6572 7369 6f6e  cated in version
+0000e800: 2032 2e38 2e30 2061 6e64 2077 696c 6c20   2.8.0 and will 
+0000e810: 6265 2072 656d 6f76 6564 2069 6e20 332e  be removed in 3.
+0000e820: 302e 302e 0a20 2020 2020 2020 2020 2020  0.0..           
+0000e830: 2020 2020 2050 6c65 6173 6520 7573 6520       Please use 
+0000e840: 6073 746f 7261 6765 5f6f 7074 696f 6e73  `storage_options
+0000e850: 6020 696e 7374 6561 642c 2065 2e67 2e20  ` instead, e.g. 
+0000e860: 6073 746f 7261 6765 5f6f 7074 696f 6e73  `storage_options
+0000e870: 3d66 732e 7374 6f72 6167 655f 6f70 7469  =fs.storage_opti
+0000e880: 6f6e 7360 0a0a 2020 2020 2020 2020 2020  ons`..          
+0000e890: 2020 2020 2020 3c2f 4465 7072 6563 6174        </Deprecat
+0000e8a0: 6564 3e0a 0a20 2020 2020 2020 2020 2020  ed>..           
+0000e8b0: 206b 6565 705f 696e 5f6d 656d 6f72 7920   keep_in_memory 
+0000e8c0: 2860 626f 6f6c 602c 2064 6566 6175 6c74  (`bool`, default
+0000e8d0: 7320 746f 2060 4e6f 6e65 6029 3a0a 2020  s to `None`):.  
+0000e8e0: 2020 2020 2020 2020 2020 2020 2020 5768                Wh
+0000e8f0: 6574 6865 7220 746f 2063 6f70 7920 7468  ether to copy th
+0000e900: 6520 6461 7461 7365 7420 696e 2d6d 656d  e dataset in-mem
+0000e910: 6f72 792e 2049 6620 604e 6f6e 6560 2c20  ory. If `None`, 
+0000e920: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+0000e930: 2020 2020 6461 7461 7365 7420 7769 6c6c      dataset will
+0000e940: 206e 6f74 2062 6520 636f 7069 6564 2069   not be copied i
+0000e950: 6e2d 6d65 6d6f 7279 2075 6e6c 6573 7320  n-memory unless 
+0000e960: 6578 706c 6963 6974 6c79 2065 6e61 626c  explicitly enabl
+0000e970: 6564 2062 7920 7365 7474 696e 670a 2020  ed by setting.  
+0000e980: 2020 2020 2020 2020 2020 2020 2020 6064                `d
+0000e990: 6174 6173 6574 732e 636f 6e66 6967 2e49  atasets.config.I
+0000e9a0: 4e5f 4d45 4d4f 5259 5f4d 4158 5f53 495a  N_MEMORY_MAX_SIZ
+0000e9b0: 4560 2074 6f20 6e6f 6e7a 6572 6f2e 2053  E` to nonzero. S
+0000e9c0: 6565 206d 6f72 6520 6465 7461 696c 7320  ee more details 
+0000e9d0: 696e 2074 6865 0a20 2020 2020 2020 2020  in the.         
+0000e9e0: 2020 2020 2020 205b 696d 7072 6f76 6520         [improve 
+0000e9f0: 7065 7266 6f72 6d61 6e63 655d 282e 2e2f  performance](../
+0000ea00: 6361 6368 6523 696d 7072 6f76 652d 7065  cache#improve-pe
+0000ea10: 7266 6f72 6d61 6e63 6529 2073 6563 7469  rformance) secti
+0000ea20: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
+0000ea30: 7374 6f72 6167 655f 6f70 7469 6f6e 7320  storage_options 
+0000ea40: 2860 6469 6374 602c 202a 6f70 7469 6f6e  (`dict`, *option
+0000ea50: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
+0000ea60: 2020 2020 2020 4b65 792f 7661 6c75 6520        Key/value 
+0000ea70: 7061 6972 7320 746f 2062 6520 7061 7373  pairs to be pass
+0000ea80: 6564 206f 6e20 746f 2074 6865 2066 696c  ed on to the fil
+0000ea90: 652d 7379 7374 656d 2062 6163 6b65 6e64  e-system backend
+0000eaa0: 2c20 6966 2061 6e79 2e0a 0a20 2020 2020  , if any...     
+0000eab0: 2020 2020 2020 2020 2020 203c 4164 6465             <Adde
+0000eac0: 6420 7665 7273 696f 6e3d 2232 2e38 2e30  d version="2.8.0
+0000ead0: 222f 3e0a 0a20 2020 2020 2020 2052 6574  "/>..        Ret
+0000eae0: 7572 6e73 3a0a 2020 2020 2020 2020 2020  urns:.          
+0000eaf0: 2020 5b60 4461 7461 7365 7460 5d20 6f72    [`Dataset`] or
+0000eb00: 205b 6044 6174 6173 6574 4469 6374 605d   [`DatasetDict`]
+0000eb10: 3a0a 2020 2020 2020 2020 2020 2020 2d20  :.            - 
+0000eb20: 4966 2060 6461 7461 7365 745f 7061 7468  If `dataset_path
+0000eb30: 6020 6973 2061 2070 6174 6820 6f66 2061  ` is a path of a
+0000eb40: 2064 6174 6173 6574 2064 6972 6563 746f   dataset directo
+0000eb50: 7279 2c20 7468 6520 6461 7461 7365 7420  ry, the dataset 
+0000eb60: 7265 7175 6573 7465 642e 0a20 2020 2020  requested..     
+0000eb70: 2020 2020 2020 202d 2049 6620 6064 6174         - If `dat
+0000eb80: 6173 6574 5f70 6174 6860 2069 7320 6120  aset_path` is a 
+0000eb90: 7061 7468 206f 6620 6120 6461 7461 7365  path of a datase
+0000eba0: 7420 6469 6374 2064 6972 6563 746f 7279  t dict directory
+0000ebb0: 2c20 6120 6064 6174 6173 6574 732e 4461  , a `datasets.Da
+0000ebc0: 7461 7365 7444 6963 7460 2077 6974 6820  tasetDict` with 
+0000ebd0: 6561 6368 2073 706c 6974 2e0a 0a20 2020  each split...   
+0000ebe0: 2020 2020 2045 7861 6d70 6c65 3a0a 0a20       Example:.. 
+0000ebf0: 2020 2020 2020 2060 6060 7079 0a20 2020         ```py.   
+0000ec00: 2020 2020 203e 3e3e 2064 7320 3d20 6c6f       >>> ds = lo
+0000ec10: 6164 5f66 726f 6d5f 6469 736b 2822 7061  ad_from_disk("pa
+0000ec20: 7468 2f74 6f2f 6461 7461 7365 742f 6469  th/to/dataset/di
+0000ec30: 7265 6374 6f72 7922 290a 2020 2020 2020  rectory").      
+0000ec40: 2020 6060 600a 2020 2020 2020 2020 2222    ```.        ""
+0000ec50: 220a 2020 2020 2020 2020 6966 2066 7320  ".        if fs 
+0000ec60: 213d 2022 6465 7072 6563 6174 6564 223a  != "deprecated":
+0000ec70: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
+0000ec80: 6e69 6e67 732e 7761 726e 280a 2020 2020  nings.warn(.    
+0000ec90: 2020 2020 2020 2020 2020 2020 2227 6673              "'fs
+0000eca0: 2720 7761 7320 6973 2064 6570 7265 6361  ' was is depreca
+0000ecb0: 7465 6420 696e 2066 6176 6f72 206f 6620  ted in favor of 
+0000ecc0: 2773 746f 7261 6765 5f6f 7074 696f 6e73  'storage_options
+0000ecd0: 2720 696e 2076 6572 7369 6f6e 2032 2e38  ' in version 2.8
+0000ece0: 2e30 2061 6e64 2077 696c 6c20 6265 2072  .0 and will be r
+0000ecf0: 656d 6f76 6564 2069 6e20 332e 302e 302e  emoved in 3.0.0.
+0000ed00: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
+0000ed10: 2020 2020 2259 6f75 2063 616e 2072 656d      "You can rem
+0000ed20: 6f76 6520 7468 6973 2077 6172 6e69 6e67  ove this warning
+0000ed30: 2062 7920 7061 7373 696e 6720 2773 746f   by passing 'sto
+0000ed40: 7261 6765 5f6f 7074 696f 6e73 3d66 732e  rage_options=fs.
+0000ed50: 7374 6f72 6167 655f 6f70 7469 6f6e 7327  storage_options'
+0000ed60: 2069 6e73 7465 6164 2e22 2c0a 2020 2020   instead.",.    
+0000ed70: 2020 2020 2020 2020 2020 2020 4675 7475              Futu
+0000ed80: 7265 5761 726e 696e 672c 0a20 2020 2020  reWarning,.     
+0000ed90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000eda0: 2020 2020 2073 746f 7261 6765 5f6f 7074       storage_opt
+0000edb0: 696f 6e73 203d 2066 732e 7374 6f72 6167  ions = fs.storag
+0000edc0: 655f 6f70 7469 6f6e 730a 0a20 2020 2020  e_options..     
+0000edd0: 2020 2066 735f 746f 6b65 6e5f 7061 7468     fs_token_path
+0000ede0: 7320 3d20 6673 7370 6563 2e67 6574 5f66  s = fsspec.get_f
+0000edf0: 735f 746f 6b65 6e5f 7061 7468 7328 6461  s_token_paths(da
+0000ee00: 7461 7365 745f 7061 7468 2c20 7374 6f72  taset_path, stor
+0000ee10: 6167 655f 6f70 7469 6f6e 733d 7374 6f72  age_options=stor
+0000ee20: 6167 655f 6f70 7469 6f6e 7329 0a20 2020  age_options).   
+0000ee30: 2020 2020 2066 733a 2066 7373 7065 632e       fs: fsspec.
+0000ee40: 4162 7374 7261 6374 4669 6c65 5379 7374  AbstractFileSyst
+0000ee50: 656d 203d 2066 735f 746f 6b65 6e5f 7061  em = fs_token_pa
+0000ee60: 7468 735b 305d 0a20 2020 2020 2020 2023  ths[0].        #
+0000ee70: 2063 6f70 6965 7320 6669 6c65 2066 726f   copies file fro
+0000ee80: 6d20 6669 6c65 7379 7374 656d 2069 6620  m filesystem if 
+0000ee90: 6974 2069 7320 7265 6d6f 7465 2066 696c  it is remote fil
+0000eea0: 6573 7973 7465 6d20 746f 206c 6f63 616c  esystem to local
+0000eeb0: 2066 696c 6573 7973 7465 6d20 616e 6420   filesystem and 
+0000eec0: 6d6f 6469 6669 6573 2064 6174 6173 6574  modifies dataset
+0000eed0: 5f70 6174 6820 746f 2074 656d 7020 6469  _path to temp di
+0000eee0: 7265 6374 6f72 7920 636f 6e74 6169 6e69  rectory containi
+0000eef0: 6e67 206c 6f63 616c 2063 6f70 6965 730a  ng local copies.
+0000ef00: 2020 2020 2020 2020 6461 7461 7365 745f          dataset_
+0000ef10: 6469 6374 5f6a 736f 6e5f 7061 7468 203d  dict_json_path =
+0000ef20: 2050 6174 6828 6461 7461 7365 745f 7061   Path(dataset_pa
+0000ef30: 7468 2c20 636f 6e66 6967 2e44 4154 4153  th, config.DATAS
+0000ef40: 4554 4449 4354 5f4a 534f 4e5f 4649 4c45  ETDICT_JSON_FILE
+0000ef50: 4e41 4d45 292e 6173 5f70 6f73 6978 2829  NAME).as_posix()
+0000ef60: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
+0000ef70: 5f69 6e66 6f5f 7061 7468 203d 2050 6174  _info_path = Pat
+0000ef80: 6828 6461 7461 7365 745f 7061 7468 2c20  h(dataset_path, 
+0000ef90: 636f 6e66 6967 2e44 4154 4153 4554 5f49  config.DATASET_I
+0000efa0: 4e46 4f5f 4649 4c45 4e41 4d45 292e 6173  NFO_FILENAME).as
+0000efb0: 5f70 6f73 6978 2829 0a20 2020 2020 2020  _posix().       
+0000efc0: 2069 6620 6e6f 7420 6673 2e69 7366 696c   if not fs.isfil
+0000efd0: 6528 6461 7461 7365 745f 696e 666f 5f70  e(dataset_info_p
+0000efe0: 6174 6829 2061 6e64 2066 732e 6973 6669  ath) and fs.isfi
+0000eff0: 6c65 2864 6174 6173 6574 5f64 6963 745f  le(dataset_dict_
+0000f000: 6a73 6f6e 5f70 6174 6829 3a0a 2020 2020  json_path):.    
+0000f010: 2020 2020 2020 2020 7261 6973 6520 4669          raise Fi
+0000f020: 6c65 4e6f 7446 6f75 6e64 4572 726f 7228  leNotFoundError(
+0000f030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f040: 2066 224e 6f20 7375 6368 2066 696c 6520   f"No such file 
+0000f050: 6f72 2064 6972 6563 746f 7279 3a20 277b  or directory: '{
+0000f060: 6461 7461 7365 745f 696e 666f 5f70 6174  dataset_info_pat
+0000f070: 687d 272e 2045 7870 6563 7465 6420 746f  h}'. Expected to
+0000f080: 206c 6f61 6420 6120 4461 7461 7365 7420   load a Dataset 
+0000f090: 6f62 6a65 6374 2c20 6275 7420 676f 7420  object, but got 
+0000f0a0: 6120 4461 7461 7365 7444 6963 742e 2050  a DatasetDict. P
+0000f0b0: 6c65 6173 6520 7573 6520 6461 7461 7365  lease use datase
+0000f0c0: 7473 2e6c 6f61 645f 6672 6f6d 5f64 6973  ts.load_from_dis
+0000f0d0: 6b20 696e 7374 6561 642e 220a 2020 2020  k instead.".    
+0000f0e0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000f0f0: 2020 2069 6620 6973 5f72 656d 6f74 655f     if is_remote_
+0000f100: 6669 6c65 7379 7374 656d 2866 7329 3a0a  filesystem(fs):.
+0000f110: 2020 2020 2020 2020 2020 2020 7372 635f              src_
+0000f120: 6461 7461 7365 745f 7061 7468 203d 2065  dataset_path = e
+0000f130: 7874 7261 6374 5f70 6174 685f 6672 6f6d  xtract_path_from
+0000f140: 5f75 7269 2864 6174 6173 6574 5f70 6174  _uri(dataset_pat
+0000f150: 6829 0a20 2020 2020 2020 2020 2020 2064  h).            d
+0000f160: 6174 6173 6574 5f70 6174 6820 3d20 4461  ataset_path = Da
+0000f170: 7461 7365 742e 5f62 7569 6c64 5f6c 6f63  taset._build_loc
+0000f180: 616c 5f74 656d 705f 7061 7468 2873 7263  al_temp_path(src
+0000f190: 5f64 6174 6173 6574 5f70 6174 6829 0a20  _dataset_path). 
+0000f1a0: 2020 2020 2020 2020 2020 2066 732e 646f             fs.do
+0000f1b0: 776e 6c6f 6164 2873 7263 5f64 6174 6173  wnload(src_datas
+0000f1c0: 6574 5f70 6174 682c 2064 6174 6173 6574  et_path, dataset
+0000f1d0: 5f70 6174 682e 6173 5f70 6f73 6978 2829  _path.as_posix()
+0000f1e0: 2c20 7265 6375 7273 6976 653d 5472 7565  , recursive=True
+0000f1f0: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
+0000f200: 6f70 656e 2850 6174 6828 6461 7461 7365  open(Path(datase
+0000f210: 745f 7061 7468 2c20 636f 6e66 6967 2e44  t_path, config.D
+0000f220: 4154 4153 4554 5f53 5441 5445 5f4a 534f  ATASET_STATE_JSO
+0000f230: 4e5f 4649 4c45 4e41 4d45 292e 6173 5f70  N_FILENAME).as_p
+0000f240: 6f73 6978 2829 2c20 656e 636f 6469 6e67  osix(), encoding
+0000f250: 3d22 7574 662d 3822 2920 6173 2073 7461  ="utf-8") as sta
+0000f260: 7465 5f66 696c 653a 0a20 2020 2020 2020  te_file:.       
+0000f270: 2020 2020 2073 7461 7465 203d 206a 736f       state = jso
+0000f280: 6e2e 6c6f 6164 2873 7461 7465 5f66 696c  n.load(state_fil
+0000f290: 6529 0a20 2020 2020 2020 2077 6974 6820  e).        with 
+0000f2a0: 6f70 656e 2850 6174 6828 6461 7461 7365  open(Path(datase
+0000f2b0: 745f 7061 7468 2c20 636f 6e66 6967 2e44  t_path, config.D
+0000f2c0: 4154 4153 4554 5f49 4e46 4f5f 4649 4c45  ATASET_INFO_FILE
+0000f2d0: 4e41 4d45 292e 6173 5f70 6f73 6978 2829  NAME).as_posix()
+0000f2e0: 2c20 656e 636f 6469 6e67 3d22 7574 662d  , encoding="utf-
+0000f2f0: 3822 2920 6173 2064 6174 6173 6574 5f69  8") as dataset_i
+0000f300: 6e66 6f5f 6669 6c65 3a0a 2020 2020 2020  nfo_file:.      
+0000f310: 2020 2020 2020 6461 7461 7365 745f 696e        dataset_in
+0000f320: 666f 203d 2044 6174 6173 6574 496e 666f  fo = DatasetInfo
+0000f330: 2e66 726f 6d5f 6469 6374 286a 736f 6e2e  .from_dict(json.
+0000f340: 6c6f 6164 2864 6174 6173 6574 5f69 6e66  load(dataset_inf
+0000f350: 6f5f 6669 6c65 2929 0a0a 2020 2020 2020  o_file))..      
+0000f360: 2020 6461 7461 7365 745f 7369 7a65 203d    dataset_size =
+0000f370: 2065 7374 696d 6174 655f 6461 7461 7365   estimate_datase
+0000f380: 745f 7369 7a65 280a 2020 2020 2020 2020  t_size(.        
+0000f390: 2020 2020 5061 7468 2864 6174 6173 6574      Path(dataset
+0000f3a0: 5f70 6174 682c 2064 6174 615f 6669 6c65  _path, data_file
+0000f3b0: 5b22 6669 6c65 6e61 6d65 225d 2920 666f  ["filename"]) fo
+0000f3c0: 7220 6461 7461 5f66 696c 6520 696e 2073  r data_file in s
+0000f3d0: 7461 7465 5b22 5f64 6174 615f 6669 6c65  tate["_data_file
+0000f3e0: 7322 5d0a 2020 2020 2020 2020 290a 2020  s"].        ).  
+0000f3f0: 2020 2020 2020 6b65 6570 5f69 6e5f 6d65        keep_in_me
+0000f400: 6d6f 7279 203d 206b 6565 705f 696e 5f6d  mory = keep_in_m
+0000f410: 656d 6f72 7920 6966 206b 6565 705f 696e  emory if keep_in
+0000f420: 5f6d 656d 6f72 7920 6973 206e 6f74 204e  _memory is not N
+0000f430: 6f6e 6520 656c 7365 2069 735f 736d 616c  one else is_smal
+0000f440: 6c5f 6461 7461 7365 7428 6461 7461 7365  l_dataset(datase
+0000f450: 745f 7369 7a65 290a 2020 2020 2020 2020  t_size).        
+0000f460: 7461 626c 655f 636c 7320 3d20 496e 4d65  table_cls = InMe
+0000f470: 6d6f 7279 5461 626c 6520 6966 206b 6565  moryTable if kee
+0000f480: 705f 696e 5f6d 656d 6f72 7920 656c 7365  p_in_memory else
+0000f490: 204d 656d 6f72 794d 6170 7065 6454 6162   MemoryMappedTab
+0000f4a0: 6c65 0a20 2020 2020 2020 2061 7272 6f77  le.        arrow
+0000f4b0: 5f74 6162 6c65 203d 2063 6f6e 6361 745f  _table = concat_
+0000f4c0: 7461 626c 6573 280a 2020 2020 2020 2020  tables(.        
+0000f4d0: 2020 2020 7461 626c 655f 636c 732e 6672      table_cls.fr
+0000f4e0: 6f6d 5f66 696c 6528 5061 7468 2864 6174  om_file(Path(dat
+0000f4f0: 6173 6574 5f70 6174 682c 2064 6174 615f  aset_path, data_
+0000f500: 6669 6c65 5b22 6669 6c65 6e61 6d65 225d  file["filename"]
+0000f510: 292e 6173 5f70 6f73 6978 2829 290a 2020  ).as_posix()).  
+0000f520: 2020 2020 2020 2020 2020 666f 7220 6461            for da
+0000f530: 7461 5f66 696c 6520 696e 2073 7461 7465  ta_file in state
+0000f540: 5b22 5f64 6174 615f 6669 6c65 7322 5d0a  ["_data_files"].
+0000f550: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000f560: 2020 2073 706c 6974 203d 2073 7461 7465     split = state
+0000f570: 5b22 5f73 706c 6974 225d 0a20 2020 2020  ["_split"].     
+0000f580: 2020 2073 706c 6974 203d 2053 706c 6974     split = Split
+0000f590: 2873 706c 6974 2920 6966 2073 706c 6974  (split) if split
+0000f5a0: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+0000f5b0: 6520 7370 6c69 740a 0a20 2020 2020 2020  e split..       
+0000f5c0: 2064 6174 6173 6574 203d 2044 6174 6173   dataset = Datas
+0000f5d0: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
+0000f5e0: 6172 726f 775f 7461 626c 653d 6172 726f  arrow_table=arro
+0000f5f0: 775f 7461 626c 652c 0a20 2020 2020 2020  w_table,.       
+0000f600: 2020 2020 2069 6e66 6f3d 6461 7461 7365       info=datase
+0000f610: 745f 696e 666f 2c0a 2020 2020 2020 2020  t_info,.        
+0000f620: 2020 2020 7370 6c69 743d 7370 6c69 742c      split=split,
+0000f630: 0a20 2020 2020 2020 2020 2020 2066 696e  .            fin
+0000f640: 6765 7270 7269 6e74 3d73 7461 7465 5b22  gerprint=state["
+0000f650: 5f66 696e 6765 7270 7269 6e74 225d 2c0a  _fingerprint"],.
+0000f660: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000f670: 2020 2066 6f72 6d61 7420 3d20 7b0a 2020     format = {.  
+0000f680: 2020 2020 2020 2020 2020 2274 7970 6522            "type"
+0000f690: 3a20 7374 6174 655b 225f 666f 726d 6174  : state["_format
+0000f6a0: 5f74 7970 6522 5d2c 0a20 2020 2020 2020  _type"],.       
+0000f6b0: 2020 2020 2022 666f 726d 6174 5f6b 7761       "format_kwa
+0000f6c0: 7267 7322 3a20 7374 6174 655b 225f 666f  rgs": state["_fo
+0000f6d0: 726d 6174 5f6b 7761 7267 7322 5d2c 0a20  rmat_kwargs"],. 
+0000f6e0: 2020 2020 2020 2020 2020 2022 636f 6c75             "colu
+0000f6f0: 6d6e 7322 3a20 7374 6174 655b 225f 666f  mns": state["_fo
+0000f700: 726d 6174 5f63 6f6c 756d 6e73 225d 2c0a  rmat_columns"],.
+0000f710: 2020 2020 2020 2020 2020 2020 226f 7574              "out
+0000f720: 7075 745f 616c 6c5f 636f 6c75 6d6e 7322  put_all_columns"
+0000f730: 3a20 7374 6174 655b 225f 6f75 7470 7574  : state["_output
+0000f740: 5f61 6c6c 5f63 6f6c 756d 6e73 225d 2c0a  _all_columns"],.
+0000f750: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+0000f760: 2020 6461 7461 7365 7420 3d20 6461 7461    dataset = data
+0000f770: 7365 742e 7769 7468 5f66 6f72 6d61 7428  set.with_format(
+0000f780: 2a2a 666f 726d 6174 290a 0a20 2020 2020  **format)..     
+0000f790: 2020 2072 6574 7572 6e20 6461 7461 7365     return datase
+0000f7a0: 740a 0a20 2020 2040 7072 6f70 6572 7479  t..    @property
+0000f7b0: 0a20 2020 2064 6566 2064 6174 6128 7365  .    def data(se
+0000f7c0: 6c66 2920 2d3e 2054 6162 6c65 3a0a 2020  lf) -> Table:.  
+0000f7d0: 2020 2020 2020 2222 2254 6865 2041 7061        """The Apa
+0000f7e0: 6368 6520 4172 726f 7720 7461 626c 6520  che Arrow table 
+0000f7f0: 6261 636b 696e 6720 7468 6520 6461 7461  backing the data
+0000f800: 7365 742e 0a0a 2020 2020 2020 2020 4578  set...        Ex
+0000f810: 616d 706c 653a 0a0a 2020 2020 2020 2020  ample:..        
+0000f820: 6060 6070 790a 2020 2020 2020 2020 3e3e  ```py.        >>
+0000f830: 3e20 6672 6f6d 2064 6174 6173 6574 7320  > from datasets 
+0000f840: 696d 706f 7274 206c 6f61 645f 6461 7461  import load_data
+0000f850: 7365 740a 2020 2020 2020 2020 3e3e 3e20  set.        >>> 
+0000f860: 6473 203d 206c 6f61 645f 6461 7461 7365  ds = load_datase
+0000f870: 7428 2272 6f74 7465 6e5f 746f 6d61 746f  t("rotten_tomato
+0000f880: 6573 222c 2073 706c 6974 3d22 7661 6c69  es", split="vali
+0000f890: 6461 7469 6f6e 2229 0a20 2020 2020 2020  dation").       
+0000f8a0: 203e 3e3e 2064 732e 6461 7461 0a20 2020   >>> ds.data.   
+0000f8b0: 2020 2020 204d 656d 6f72 794d 6170 7065       MemoryMappe
+0000f8c0: 6454 6162 6c65 0a20 2020 2020 2020 2074  dTable.        t
+0000f8d0: 6578 743a 2073 7472 696e 670a 2020 2020  ext: string.    
+0000f8e0: 2020 2020 6c61 6265 6c3a 2069 6e74 3634      label: int64
+0000f8f0: 0a20 2020 2020 2020 202d 2d2d 2d0a 2020  .        ----.  
+0000f900: 2020 2020 2020 7465 7874 3a20 5b5b 2263        text: [["c
+0000f910: 6f6d 7061 7373 696f 6e61 7465 6c79 2065  ompassionately e
+0000f920: 7870 6c6f 7265 7320 7468 6520 7365 656d  xplores the seem
+0000f930: 696e 676c 7920 6972 7265 636f 6e63 696c  ingly irreconcil
+0000f940: 6162 6c65 2073 6974 7561 7469 6f6e 2062  able situation b
+0000f950: 6574 7765 656e 2063 6f6e 7365 7276 6174  etween conservat
+0000f960: 6976 6520 6368 7269 7374 6961 6e20 7061  ive christian pa
+0000f970: 7265 6e74 7320 616e 6420 7468 6569 7220  rents and their 
+0000f980: 6573 7472 616e 6765 6420 6761 7920 616e  estranged gay an
+0000f990: 6420 6c65 7362 6961 6e20 6368 696c 6472  d lesbian childr
+0000f9a0: 656e 202e 222c 2274 6865 2073 6f75 6e64  en .","the sound
+0000f9b0: 7472 6163 6b20 616c 6f6e 6520 6973 2077  track alone is w
+0000f9c0: 6f72 7468 2074 6865 2070 7269 6365 206f  orth the price o
+0000f9d0: 6620 6164 6d69 7373 696f 6e20 2e22 2c22  f admission .","
+0000f9e0: 726f 6472 6967 7565 7a20 646f 6573 2061  rodriguez does a
+0000f9f0: 2073 706c 656e 6469 6420 6a6f 6220 6f66   splendid job of
+0000fa00: 2072 6163 6961 6c20 7072 6f66 696c 696e   racial profilin
+0000fa10: 6720 686f 6c6c 7977 6f6f 6420 7374 796c  g hollywood styl
+0000fa20: 652d 2d63 6173 7469 6e67 2065 7863 656c  e--casting excel
+0000fa30: 6c65 6e74 206c 6174 696e 2061 6374 6f72  lent latin actor
+0000fa40: 7320 6f66 2061 6c6c 2061 6765 732d 2d61  s of all ages--a
+0000fa50: 2074 7265 6e64 206c 6f6e 6720 6f76 6572   trend long over
+0000fa60: 6475 6520 2e22 2c22 6265 6e65 6174 6820  due .","beneath 
+0000fa70: 7468 6520 6669 6c6d 2773 206f 6276 696f  the film's obvio
+0000fa80: 7573 2064 6574 6572 6d69 6e61 7469 6f6e  us determination
+0000fa90: 2074 6f20 7368 6f63 6b20 6174 2061 6e79   to shock at any
+0000faa0: 2063 6f73 7420 6c69 6573 2063 6f6e 7369   cost lies consi
+0000fab0: 6465 7261 626c 6520 736b 696c 6c20 616e  derable skill an
+0000fac0: 6420 6465 7465 726d 696e 6174 696f 6e20  d determination 
+0000fad0: 2c20 6261 636b 6564 2062 7920 7368 6565  , backed by shee
+0000fae0: 7220 6e65 7276 6520 2e22 2c22 6269 656c  r nerve .","biel
+0000faf0: 696e 736b 7920 6973 2061 2066 696c 6d6d  insky is a filmm
+0000fb00: 616b 6572 206f 6620 696d 7072 6573 7369  aker of impressi
+0000fb10: 7665 2074 616c 656e 7420 2e22 2c22 736f  ve talent .","so
+0000fb20: 2062 6561 7574 6966 756c 6c79 2061 6374   beautifully act
+0000fb30: 6564 2061 6e64 2064 6972 6563 7465 6420  ed and directed 
+0000fb40: 2c20 6974 2773 2063 6c65 6172 2074 6861  , it's clear tha
+0000fb50: 7420 7761 7368 696e 6774 6f6e 206d 6f73  t washington mos
+0000fb60: 7420 6365 7274 6169 6e6c 7920 6861 7320  t certainly has 
+0000fb70: 6120 6e65 7720 6361 7265 6572 2061 6865  a new career ahe
+0000fb80: 6164 206f 6620 6869 6d20 6966 2068 6520  ad of him if he 
+0000fb90: 736f 2063 686f 6f73 6573 202e 222c 2261  so chooses .","a
+0000fba0: 2076 6973 7561 6c20 7370 6563 7461 636c   visual spectacl
+0000fbb0: 6520 6675 6c6c 206f 6620 7374 756e 6e69  e full of stunni
+0000fbc0: 6e67 2069 6d61 6765 7320 616e 6420 6566  ng images and ef
+0000fbd0: 6665 6374 7320 2e22 2c22 6120 6765 6e74  fects .","a gent
+0000fbe0: 6c65 2061 6e64 2065 6e67 726f 7373 696e  le and engrossin
+0000fbf0: 6720 6368 6172 6163 7465 7220 7374 7564  g character stud
+0000fc00: 7920 2e22 2c22 6974 2773 2065 6e6f 7567  y .","it's enoug
+0000fc10: 6820 746f 2077 6174 6368 2068 7570 7065  h to watch huppe
+0000fc20: 7274 2073 6368 656d 696e 6720 2c20 7769  rt scheming , wi
+0000fc30: 7468 2068 6572 2073 6d61 6c6c 202c 2069  th her small , i
+0000fc40: 6e74 656c 6c69 6765 6e74 2065 7965 7320  ntelligent eyes 
+0000fc50: 6173 2073 7465 6164 7920 6173 2061 6e79  as steady as any
+0000fc60: 206e 6f69 7220 7669 6c6c 6169 6e20 2c20   noir villain , 
+0000fc70: 616e 6420 746f 2065 6e6a 6f79 2074 6865  and to enjoy the
+0000fc80: 2070 6572 6665 6374 6c79 2070 6974 6368   perfectly pitch
+0000fc90: 6564 2077 6562 206f 6620 7465 6e73 696f  ed web of tensio
+0000fca0: 6e20 7468 6174 2063 6861 6272 6f6c 2073  n that chabrol s
+0000fcb0: 7069 6e73 202e 222c 2261 6e20 656e 6772  pins .","an engr
+0000fcc0: 6f73 7369 6e67 2070 6f72 7472 6169 7420  ossing portrait 
+0000fcd0: 6f66 2075 6e63 6f6d 7072 6f6d 6973 696e  of uncompromisin
+0000fce0: 6720 6172 7469 7374 7320 7472 7969 6e67  g artists trying
+0000fcf0: 2074 6f20 6372 6561 7465 2073 6f6d 6574   to create somet
+0000fd00: 6869 6e67 206f 7269 6769 6e61 6c20 6167  hing original ag
+0000fd10: 6169 6e73 7420 7468 6520 6261 636b 6472  ainst the backdr
+0000fd20: 6f70 206f 6620 6120 636f 7270 6f72 6174  op of a corporat
+0000fd30: 6520 6d75 7369 6320 696e 6475 7374 7279  e music industry
+0000fd40: 2074 6861 7420 6f6e 6c79 2073 6565 6d73   that only seems
+0000fd50: 2074 6f20 6361 7265 2061 626f 7574 2074   to care about t
+0000fd60: 6865 2062 6f74 746f 6d20 6c69 6e65 202e  he bottom line .
+0000fd70: 222c 2e2e 2e2c 2275 6c74 696d 6174 656c  ",...,"ultimatel
+0000fd80: 7920 2c20 6a61 6e65 206c 6561 726e 7320  y , jane learns 
+0000fd90: 6865 7220 706c 6163 6520 6173 2061 2067  her place as a g
+0000fda0: 6972 6c20 2c20 736f 6674 656e 7320 7570  irl , softens up
+0000fdb0: 2061 6e64 206c 6f73 6573 2073 6f6d 6520   and loses some 
+0000fdc0: 6f66 2074 6865 2069 6e74 656e 7369 7479  of the intensity
+0000fdd0: 2074 6861 7420 6d61 6465 2068 6572 2061   that made her a
+0000fde0: 6e20 696e 7465 7265 7374 696e 6720 6368  n interesting ch
+0000fdf0: 6172 6163 7465 7220 746f 2062 6567 696e  aracter to begin
+0000fe00: 2077 6974 6820 2e22 2c22 6168 2d6e 756c   with .","ah-nul
+0000fe10: 6427 7320 6163 7469 6f6e 2068 6572 6f20  d's action hero 
+0000fe20: 6461 7973 206d 6967 6874 2062 6520 6f76  days might be ov
+0000fe30: 6572 202e 222c 2269 7427 7320 636c 6561  er .","it's clea
+0000fe40: 7220 7768 7920 6465 7563 6573 2077 696c  r why deuces wil
+0000fe50: 6420 2c20 7768 6963 6820 7761 7320 7368  d , which was sh
+0000fe60: 6f74 2074 776f 2079 6561 7273 2061 676f  ot two years ago
+0000fe70: 202c 2068 6173 2062 6565 6e20 6761 7468   , has been gath
+0000fe80: 6572 696e 6720 6475 7374 206f 6e20 6d67  ering dust on mg
+0000fe90: 6d27 7320 7368 656c 6620 2e22 2c22 6665  m's shelf .","fe
+0000fea0: 656c 7320 6c69 6b65 206e 6f74 6869 6e67  els like nothing
+0000feb0: 2071 7569 7465 2073 6f20 6d75 6368 2061   quite so much a
+0000fec0: 7320 6120 6d69 6464 6c65 2d61 6765 6420  s a middle-aged 
+0000fed0: 6d6f 7669 656d 616b 6572 2773 2061 7474  moviemaker's att
+0000fee0: 656d 7074 2074 6f20 7375 7272 6f75 6e64  empt to surround
+0000fef0: 2068 696d 7365 6c66 2077 6974 6820 6265   himself with be
+0000ff00: 6175 7469 6675 6c20 2c20 6861 6c66 2d6e  autiful , half-n
+0000ff10: 616b 6564 2077 6f6d 656e 202e 222c 2277  aked women .","w
+0000ff20: 6865 6e20 7468 6520 7072 6563 6973 6520  hen the precise 
+0000ff30: 6e61 7475 7265 206f 6620 6d61 7474 6865  nature of matthe
+0000ff40: 7727 7320 7072 6564 6963 616d 656e 7420  w's predicament 
+0000ff50: 6669 6e61 6c6c 7920 636f 6d65 7320 696e  finally comes in
+0000ff60: 746f 2073 6861 7270 2066 6f63 7573 202c  to sharp focus ,
+0000ff70: 2074 6865 2072 6576 656c 6174 696f 6e20   the revelation 
+0000ff80: 6661 696c 7320 746f 206a 7573 7469 6679  fails to justify
+0000ff90: 2074 6865 2062 7569 6c64 2d75 7020 2e22   the build-up ."
+0000ffa0: 2c22 7468 6973 2070 6963 7475 7265 2069  ,"this picture i
+0000ffb0: 7320 6d75 7264 6572 2062 7920 6e75 6d62  s murder by numb
+0000ffc0: 6572 7320 2c20 616e 6420 6173 2065 6173  ers , and as eas
+0000ffd0: 7920 746f 2062 6520 626f 7265 6420 6279  y to be bored by
+0000ffe0: 2061 7320 796f 7572 2061 6263 2773 202c   as your abc's ,
+0000fff0: 2064 6573 7069 7465 2061 2066 6577 2077   despite a few w
+00010000: 686f 7070 696e 6720 7368 6f6f 746f 7574  hopping shootout
+00010010: 7320 2e22 2c22 6869 6c61 7269 6f75 7320  s .","hilarious 
+00010020: 6d75 7369 6361 6c20 636f 6d65 6479 2074  musical comedy t
+00010030: 686f 7567 6820 7374 796d 6965 6420 6279  hough stymied by
+00010040: 2061 6363 656e 7473 2074 6869 636b 2061   accents thick a
+00010050: 7320 6d75 6420 2e22 2c22 6966 2079 6f75  s mud .","if you
+00010060: 2061 7265 2069 6e74 6f20 7370 6c61 7474   are into splatt
+00010070: 6572 206d 6f76 6965 7320 2c20 7468 656e  er movies , then
+00010080: 2079 6f75 2077 696c 6c20 7072 6f62 6162   you will probab
+00010090: 6c79 2068 6176 6520 6120 7265 6173 6f6e  ly have a reason
+000100a0: 6162 6c79 2067 6f6f 6420 7469 6d65 2077  ably good time w
+000100b0: 6974 6820 7468 6520 7361 6c74 6f6e 2073  ith the salton s
+000100c0: 6561 202e 222c 2261 2064 756c 6c20 2c20  ea .","a dull , 
+000100d0: 7369 6d70 6c65 2d6d 696e 6465 6420 616e  simple-minded an
+000100e0: 6420 7374 6572 656f 7479 7069 6361 6c20  d stereotypical 
+000100f0: 7461 6c65 206f 6620 6472 7567 7320 2c20  tale of drugs , 
+00010100: 6465 6174 6820 616e 6420 6d69 6e64 2d6e  death and mind-n
+00010110: 756d 6269 6e67 2069 6e64 6966 6665 7265  umbing indiffere
+00010120: 6e63 6520 6f6e 2074 6865 2069 6e6e 6572  nce on the inner
+00010130: 2d63 6974 7920 7374 7265 6574 7320 2e22  -city streets ."
+00010140: 2c22 7468 6520 6665 6174 7572 652d 6c65  ,"the feature-le
+00010150: 6e67 7468 2073 7472 6574 6368 202e 202e  ngth stretch . .
+00010160: 202e 2073 7472 6169 6e73 2074 6865 2073   . strains the s
+00010170: 686f 7727 7320 636f 6e63 6570 7420 2e22  how's concept ."
+00010180: 5d5d 0a20 2020 2020 2020 206c 6162 656c  ]].        label
+00010190: 3a20 5b5b 312c 312c 312c 312c 312c 312c  : [[1,1,1,1,1,1,
+000101a0: 312c 312c 312c 312c 2e2e 2e2c 302c 302c  1,1,1,1,...,0,0,
+000101b0: 302c 302c 302c 302c 302c 302c 302c 305d  0,0,0,0,0,0,0,0]
+000101c0: 5d0a 2020 2020 2020 2020 6060 600a 2020  ].        ```.  
+000101d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000101e0: 2020 7265 7475 726e 2073 656c 662e 5f64    return self._d
+000101f0: 6174 610a 0a20 2020 2040 7072 6f70 6572  ata..    @proper
+00010200: 7479 0a20 2020 2064 6566 2063 6163 6865  ty.    def cache
+00010210: 5f66 696c 6573 2873 656c 6629 202d 3e20  _files(self) -> 
+00010220: 4c69 7374 5b64 6963 745d 3a0a 2020 2020  List[dict]:.    
+00010230: 2020 2020 2222 2254 6865 2063 6163 6865      """The cache
+00010240: 2066 696c 6573 2063 6f6e 7461 696e 696e   files containin
+00010250: 6720 7468 6520 4170 6163 6865 2041 7272  g the Apache Arr
+00010260: 6f77 2074 6162 6c65 2062 6163 6b69 6e67  ow table backing
+00010270: 2074 6865 2064 6174 6173 6574 2e0a 0a20   the dataset... 
+00010280: 2020 2020 2020 2045 7861 6d70 6c65 3a0a         Example:.
+00010290: 0a20 2020 2020 2020 2060 6060 7079 0a20  .        ```py. 
+000102a0: 2020 2020 2020 203e 3e3e 2066 726f 6d20         >>> from 
+000102b0: 6461 7461 7365 7473 2069 6d70 6f72 7420  datasets import 
+000102c0: 6c6f 6164 5f64 6174 6173 6574 0a20 2020  load_dataset.   
+000102d0: 2020 2020 203e 3e3e 2064 7320 3d20 6c6f       >>> ds = lo
+000102e0: 6164 5f64 6174 6173 6574 2822 726f 7474  ad_dataset("rott
+000102f0: 656e 5f74 6f6d 6174 6f65 7322 2c20 7370  en_tomatoes", sp
+00010300: 6c69 743d 2276 616c 6964 6174 696f 6e22  lit="validation"
+00010310: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+00010320: 2e63 6163 6865 5f66 696c 6573 0a20 2020  .cache_files.   
+00010330: 2020 2020 205b 7b27 6669 6c65 6e61 6d65       [{'filename
+00010340: 273a 2027 2f72 6f6f 742f 2e63 6163 6865  ': '/root/.cache
+00010350: 2f68 7567 6769 6e67 6661 6365 2f64 6174  /huggingface/dat
+00010360: 6173 6574 732f 726f 7474 656e 5f74 6f6d  asets/rotten_tom
+00010370: 6174 6f65 735f 6d6f 7669 655f 7265 7669  atoes_movie_revi
+00010380: 6577 2f64 6566 6175 6c74 2f31 2e30 2e30  ew/default/1.0.0
+00010390: 2f34 3064 3431 3165 3435 6136 6365 3334  /40d411e45a6ce34
+000103a0: 3834 6465 6564 3763 6331 3562 3832 6135  84deed7cc15b82a5
+000103b0: 3364 6164 3961 3732 6161 6664 3966 3836  3dad9a72aafd9f86
+000103c0: 6638 6632 3237 3133 3462 6563 3563 6134  f8f227134bec5ca4
+000103d0: 362f 726f 7474 656e 5f74 6f6d 6174 6f65  6/rotten_tomatoe
+000103e0: 735f 6d6f 7669 655f 7265 7669 6577 2d76  s_movie_review-v
+000103f0: 616c 6964 6174 696f 6e2e 6172 726f 7727  alidation.arrow'
+00010400: 7d5d 0a20 2020 2020 2020 2060 6060 0a20  }].        ```. 
+00010410: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00010420: 2020 2063 6163 6865 5f66 696c 6573 203d     cache_files =
+00010430: 206c 6973 745f 7461 626c 655f 6361 6368   list_table_cach
+00010440: 655f 6669 6c65 7328 7365 6c66 2e5f 6461  e_files(self._da
+00010450: 7461 290a 2020 2020 2020 2020 6966 2073  ta).        if s
+00010460: 656c 662e 5f69 6e64 6963 6573 2069 7320  elf._indices is 
+00010470: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00010480: 2020 2020 2020 6361 6368 655f 6669 6c65        cache_file
+00010490: 7320 2b3d 206c 6973 745f 7461 626c 655f  s += list_table_
+000104a0: 6361 6368 655f 6669 6c65 7328 7365 6c66  cache_files(self
+000104b0: 2e5f 696e 6469 6365 7329 0a20 2020 2020  ._indices).     
+000104c0: 2020 2072 6574 7572 6e20 5b7b 2266 696c     return [{"fil
+000104d0: 656e 616d 6522 3a20 6361 6368 655f 6669  ename": cache_fi
+000104e0: 6c65 6e61 6d65 7d20 666f 7220 6361 6368  lename} for cach
+000104f0: 655f 6669 6c65 6e61 6d65 2069 6e20 6361  e_filename in ca
+00010500: 6368 655f 6669 6c65 735d 0a0a 2020 2020  che_files]..    
+00010510: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00010520: 6620 6e75 6d5f 636f 6c75 6d6e 7328 7365  f num_columns(se
+00010530: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
+00010540: 2020 2020 2222 224e 756d 6265 7220 6f66      """Number of
+00010550: 2063 6f6c 756d 6e73 2069 6e20 7468 6520   columns in the 
+00010560: 6461 7461 7365 742e 0a0a 2020 2020 2020  dataset...      
+00010570: 2020 4578 616d 706c 653a 0a0a 2020 2020    Example:..    
+00010580: 2020 2020 6060 6070 790a 2020 2020 2020      ```py.      
+00010590: 2020 3e3e 3e20 6672 6f6d 2064 6174 6173    >>> from datas
+000105a0: 6574 7320 696d 706f 7274 206c 6f61 645f  ets import load_
+000105b0: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
+000105c0: 3e3e 3e20 6473 203d 206c 6f61 645f 6461  >>> ds = load_da
+000105d0: 7461 7365 7428 2272 6f74 7465 6e5f 746f  taset("rotten_to
+000105e0: 6d61 746f 6573 222c 2073 706c 6974 3d22  matoes", split="
+000105f0: 7661 6c69 6461 7469 6f6e 2229 0a20 2020  validation").   
+00010600: 2020 2020 203e 3e3e 2064 732e 6e75 6d5f       >>> ds.num_
+00010610: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
+00010620: 320a 2020 2020 2020 2020 6060 600a 2020  2.        ```.  
+00010630: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00010640: 2020 7265 7475 726e 2073 656c 662e 5f64    return self._d
+00010650: 6174 612e 6e75 6d5f 636f 6c75 6d6e 730a  ata.num_columns.
+00010660: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00010670: 2020 2064 6566 206e 756d 5f72 6f77 7328     def num_rows(
+00010680: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
+00010690: 2020 2020 2020 2222 224e 756d 6265 7220        """Number 
+000106a0: 6f66 2072 6f77 7320 696e 2074 6865 2064  of rows in the d
+000106b0: 6174 6173 6574 2028 7361 6d65 2061 7320  ataset (same as 
+000106c0: 5b60 4461 7461 7365 742e 5f5f 6c65 6e5f  [`Dataset.__len_
+000106d0: 5f60 5d29 2e0a 0a20 2020 2020 2020 2045  _`])...        E
+000106e0: 7861 6d70 6c65 3a0a 0a20 2020 2020 2020  xample:..       
+000106f0: 2060 6060 7079 0a20 2020 2020 2020 203e   ```py.        >
+00010700: 3e3e 2066 726f 6d20 6461 7461 7365 7473  >> from datasets
+00010710: 2069 6d70 6f72 7420 6c6f 6164 5f64 6174   import load_dat
+00010720: 6173 6574 0a20 2020 2020 2020 203e 3e3e  aset.        >>>
+00010730: 2064 7320 3d20 6c6f 6164 5f64 6174 6173   ds = load_datas
+00010740: 6574 2822 726f 7474 656e 5f74 6f6d 6174  et("rotten_tomat
+00010750: 6f65 7322 2c20 7370 6c69 743d 2276 616c  oes", split="val
+00010760: 6964 6174 696f 6e22 290a 2020 2020 2020  idation").      
+00010770: 2020 3e3e 3e20 6473 2e6e 756d 5f72 6f77    >>> ds.num_row
+00010780: 730a 2020 2020 2020 2020 3130 3636 0a20  s.        1066. 
+00010790: 2020 2020 2020 2060 6060 0a20 2020 2020         ```.     
+000107a0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+000107b0: 6620 7365 6c66 2e5f 696e 6469 6365 7320  f self._indices 
+000107c0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000107d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000107e0: 7365 6c66 2e5f 696e 6469 6365 732e 6e75  self._indices.nu
+000107f0: 6d5f 726f 7773 0a20 2020 2020 2020 2072  m_rows.        r
+00010800: 6574 7572 6e20 7365 6c66 2e5f 6461 7461  eturn self._data
+00010810: 2e6e 756d 5f72 6f77 730a 0a20 2020 2040  .num_rows..    @
+00010820: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00010830: 2063 6f6c 756d 6e5f 6e61 6d65 7328 7365   column_names(se
+00010840: 6c66 2920 2d3e 204c 6973 745b 7374 725d  lf) -> List[str]
+00010850: 3a0a 2020 2020 2020 2020 2222 224e 616d  :.        """Nam
+00010860: 6573 206f 6620 7468 6520 636f 6c75 6d6e  es of the column
+00010870: 7320 696e 2074 6865 2064 6174 6173 6574  s in the dataset
+00010880: 2e0a 0a20 2020 2020 2020 2045 7861 6d70  ...        Examp
+00010890: 6c65 3a0a 0a20 2020 2020 2020 2060 6060  le:..        ```
+000108a0: 7079 0a20 2020 2020 2020 203e 3e3e 2066  py.        >>> f
+000108b0: 726f 6d20 6461 7461 7365 7473 2069 6d70  rom datasets imp
+000108c0: 6f72 7420 6c6f 6164 5f64 6174 6173 6574  ort load_dataset
+000108d0: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
+000108e0: 3d20 6c6f 6164 5f64 6174 6173 6574 2822  = load_dataset("
+000108f0: 726f 7474 656e 5f74 6f6d 6174 6f65 7322  rotten_tomatoes"
+00010900: 2c20 7370 6c69 743d 2276 616c 6964 6174  , split="validat
+00010910: 696f 6e22 290a 2020 2020 2020 2020 3e3e  ion").        >>
+00010920: 3e20 6473 2e63 6f6c 756d 6e5f 6e61 6d65  > ds.column_name
+00010930: 730a 2020 2020 2020 2020 5b27 7465 7874  s.        ['text
+00010940: 272c 2027 6c61 6265 6c27 5d0a 2020 2020  ', 'label'].    
+00010950: 2020 2020 6060 600a 2020 2020 2020 2020      ```.        
+00010960: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00010970: 726e 2073 656c 662e 5f64 6174 612e 636f  rn self._data.co
+00010980: 6c75 6d6e 5f6e 616d 6573 0a0a 2020 2020  lumn_names..    
+00010990: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+000109a0: 6620 7368 6170 6528 7365 6c66 2920 2d3e  f shape(self) ->
+000109b0: 2054 7570 6c65 5b69 6e74 2c20 696e 745d   Tuple[int, int]
+000109c0: 3a0a 2020 2020 2020 2020 2222 2253 6861  :.        """Sha
+000109d0: 7065 206f 6620 7468 6520 6461 7461 7365  pe of the datase
+000109e0: 7420 286e 756d 6265 7220 6f66 2063 6f6c  t (number of col
+000109f0: 756d 6e73 2c20 6e75 6d62 6572 206f 6620  umns, number of 
+00010a00: 726f 7773 292e 0a0a 2020 2020 2020 2020  rows)...        
+00010a10: 4578 616d 706c 653a 0a0a 2020 2020 2020  Example:..      
+00010a20: 2020 6060 6070 790a 2020 2020 2020 2020    ```py.        
+00010a30: 3e3e 3e20 6672 6f6d 2064 6174 6173 6574  >>> from dataset
+00010a40: 7320 696d 706f 7274 206c 6f61 645f 6461  s import load_da
+00010a50: 7461 7365 740a 2020 2020 2020 2020 3e3e  taset.        >>
+00010a60: 3e20 6473 203d 206c 6f61 645f 6461 7461  > ds = load_data
+00010a70: 7365 7428 2272 6f74 7465 6e5f 746f 6d61  set("rotten_toma
+00010a80: 746f 6573 222c 2073 706c 6974 3d22 7661  toes", split="va
+00010a90: 6c69 6461 7469 6f6e 2229 0a20 2020 2020  lidation").     
+00010aa0: 2020 203e 3e3e 2064 732e 7368 6170 650a     >>> ds.shape.
+00010ab0: 2020 2020 2020 2020 2831 3036 362c 2032          (1066, 2
+00010ac0: 290a 2020 2020 2020 2020 6060 600a 2020  ).        ```.  
+00010ad0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00010ae0: 2020 6966 2073 656c 662e 5f69 6e64 6963    if self._indic
+00010af0: 6573 2069 7320 6e6f 7420 4e6f 6e65 3a0a  es is not None:.
+00010b00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00010b10: 726e 2028 7365 6c66 2e5f 696e 6469 6365  rn (self._indice
+00010b20: 732e 6e75 6d5f 726f 7773 2c20 7365 6c66  s.num_rows, self
+00010b30: 2e5f 6461 7461 2e6e 756d 5f63 6f6c 756d  ._data.num_colum
+00010b40: 6e73 290a 2020 2020 2020 2020 7265 7475  ns).        retu
+00010b50: 726e 2073 656c 662e 5f64 6174 612e 7368  rn self._data.sh
+00010b60: 6170 650a 0a20 2020 2064 6566 2075 6e69  ape..    def uni
+00010b70: 7175 6528 7365 6c66 2c20 636f 6c75 6d6e  que(self, column
+00010b80: 3a20 7374 7229 202d 3e20 4c69 7374 3a0a  : str) -> List:.
+00010b90: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00010ba0: 6e20 6120 6c69 7374 206f 6620 7468 6520  n a list of the 
+00010bb0: 756e 6971 7565 2065 6c65 6d65 6e74 7320  unique elements 
+00010bc0: 696e 2061 2063 6f6c 756d 6e2e 0a0a 2020  in a column...  
+00010bd0: 2020 2020 2020 5468 6973 2069 7320 696d        This is im
+00010be0: 706c 656d 656e 7465 6420 696e 2074 6865  plemented in the
+00010bf0: 206c 6f77 2d6c 6576 656c 2062 6163 6b65   low-level backe
+00010c00: 6e64 2061 6e64 2061 7320 7375 6368 2c20  nd and as such, 
+00010c10: 7665 7279 2066 6173 742e 0a0a 2020 2020  very fast...    
+00010c20: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00010c30: 2020 2020 2020 636f 6c75 6d6e 2028 6073        column (`s
+00010c40: 7472 6029 3a0a 2020 2020 2020 2020 2020  tr`):.          
+00010c50: 2020 2020 2020 436f 6c75 6d6e 206e 616d        Column nam
+00010c60: 6520 286c 6973 7420 616c 6c20 7468 6520  e (list all the 
+00010c70: 636f 6c75 6d6e 206e 616d 6573 2077 6974  column names wit
+00010c80: 6820 5b7e 6064 6174 6173 6574 732e 4461  h [~`datasets.Da
+00010c90: 7461 7365 742e 636f 6c75 6d6e 5f6e 616d  taset.column_nam
+00010ca0: 6573 605d 292e 0a0a 2020 2020 2020 2020  es`])...        
+00010cb0: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
+00010cc0: 2020 2020 2060 6c69 7374 603a 204c 6973       `list`: Lis
+00010cd0: 7420 6f66 2075 6e69 7175 6520 656c 656d  t of unique elem
+00010ce0: 656e 7473 2069 6e20 7468 6520 6769 7665  ents in the give
+00010cf0: 6e20 636f 6c75 6d6e 2e0a 0a20 2020 2020  n column...     
+00010d00: 2020 2045 7861 6d70 6c65 3a0a 0a20 2020     Example:..   
+00010d10: 2020 2020 2060 6060 7079 0a20 2020 2020       ```py.     
+00010d20: 2020 203e 3e3e 2066 726f 6d20 6461 7461     >>> from data
+00010d30: 7365 7473 2069 6d70 6f72 7420 6c6f 6164  sets import load
+00010d40: 5f64 6174 6173 6574 0a20 2020 2020 2020  _dataset.       
+00010d50: 203e 3e3e 2064 7320 3d20 6c6f 6164 5f64   >>> ds = load_d
+00010d60: 6174 6173 6574 2822 726f 7474 656e 5f74  ataset("rotten_t
+00010d70: 6f6d 6174 6f65 7322 2c20 7370 6c69 743d  omatoes", split=
+00010d80: 2276 616c 6964 6174 696f 6e22 290a 2020  "validation").  
+00010d90: 2020 2020 2020 3e3e 3e20 6473 2e75 6e69        >>> ds.uni
+00010da0: 7175 6528 276c 6162 656c 2729 0a20 2020  que('label').   
+00010db0: 2020 2020 205b 312c 2030 5d0a 2020 2020       [1, 0].    
+00010dc0: 2020 2020 6060 600a 2020 2020 2020 2020      ```.        
+00010dd0: 2222 220a 2020 2020 2020 2020 6966 2063  """.        if c
+00010de0: 6f6c 756d 6e20 6e6f 7420 696e 2073 656c  olumn not in sel
+00010df0: 662e 5f64 6174 612e 636f 6c75 6d6e 5f6e  f._data.column_n
+00010e00: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+00010e10: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00010e20: 6f72 2866 2243 6f6c 756d 6e20 287b 636f  or(f"Column ({co
+00010e30: 6c75 6d6e 7d29 206e 6f74 2069 6e20 7461  lumn}) not in ta
+00010e40: 626c 6520 636f 6c75 6d6e 7320 287b 7365  ble columns ({se
+00010e50: 6c66 2e5f 6461 7461 2e63 6f6c 756d 6e5f  lf._data.column_
+00010e60: 6e61 6d65 737d 292e 2229 0a0a 2020 2020  names}).")..    
+00010e70: 2020 2020 6966 2073 656c 662e 5f69 6e64      if self._ind
+00010e80: 6963 6573 2069 7320 6e6f 7420 4e6f 6e65  ices is not None
+00010e90: 2061 6e64 2073 656c 662e 5f69 6e64 6963   and self._indic
+00010ea0: 6573 2e6e 756d 5f72 6f77 7320 213d 2073  es.num_rows != s
+00010eb0: 656c 662e 5f64 6174 612e 6e75 6d5f 726f  elf._data.num_ro
+00010ec0: 7773 3a0a 2020 2020 2020 2020 2020 2020  ws:.            
+00010ed0: 6461 7461 7365 7420 3d20 7365 6c66 2e66  dataset = self.f
+00010ee0: 6c61 7474 656e 5f69 6e64 6963 6573 2829  latten_indices()
+00010ef0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00010f00: 2020 2020 2020 2020 2020 2064 6174 6173             datas
+00010f10: 6574 203d 2073 656c 660a 0a20 2020 2020  et = self..     
+00010f20: 2020 2072 6574 7572 6e20 6461 7461 7365     return datase
+00010f30: 742e 5f64 6174 612e 636f 6c75 6d6e 2863  t._data.column(c
+00010f40: 6f6c 756d 6e29 2e75 6e69 7175 6528 292e  olumn).unique().
+00010f50: 746f 5f70 796c 6973 7428 290a 0a20 2020  to_pylist()..   
+00010f60: 2064 6566 2063 6c61 7373 5f65 6e63 6f64   def class_encod
+00010f70: 655f 636f 6c75 6d6e 2873 656c 662c 2063  e_column(self, c
+00010f80: 6f6c 756d 6e3a 2073 7472 2c20 696e 636c  olumn: str, incl
+00010f90: 7564 655f 6e75 6c6c 733a 2062 6f6f 6c20  ude_nulls: bool 
+00010fa0: 3d20 4661 6c73 6529 202d 3e20 2244 6174  = False) -> "Dat
+00010fb0: 6173 6574 223a 0a20 2020 2020 2020 2022  aset":.        "
+00010fc0: 2222 4361 7374 7320 7468 6520 6769 7665  ""Casts the give
+00010fd0: 6e20 636f 6c75 6d6e 2061 7320 5b7e 6064  n column as [~`d
+00010fe0: 6174 6173 6574 732e 6665 6174 7572 6573  atasets.features
+00010ff0: 2e43 6c61 7373 4c61 6265 6c5d 6020 616e  .ClassLabel]` an
+00011000: 6420 7570 6461 7465 7320 7468 6520 7461  d updates the ta
+00011010: 626c 652e 0a0a 2020 2020 2020 2020 4172  ble...        Ar
+00011020: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00011030: 636f 6c75 6d6e 2028 6073 7472 6029 3a0a  column (`str`):.
+00011040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011050: 5468 6520 6e61 6d65 206f 6620 7468 6520  The name of the 
+00011060: 636f 6c75 6d6e 2074 6f20 6361 7374 2028  column to cast (
+00011070: 6c69 7374 2061 6c6c 2074 6865 2063 6f6c  list all the col
+00011080: 756d 6e20 6e61 6d65 7320 7769 7468 205b  umn names with [
+00011090: 7e60 6461 7461 7365 7473 2e44 6174 6173  ~`datasets.Datas
+000110a0: 6574 2e63 6f6c 756d 6e5f 6e61 6d65 7360  et.column_names`
+000110b0: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
+000110c0: 6e63 6c75 6465 5f6e 756c 6c73 2028 6062  nclude_nulls (`b
+000110d0: 6f6f 6c60 2c20 6465 6661 756c 7473 2074  ool`, defaults t
+000110e0: 6f20 6046 616c 7365 6029 3a0a 2020 2020  o `False`):.    
+000110f0: 2020 2020 2020 2020 2020 2020 5768 6574              Whet
+00011100: 6865 7220 746f 2069 6e63 6c75 6465 206e  her to include n
+00011110: 756c 6c20 7661 6c75 6573 2069 6e20 7468  ull values in th
+00011120: 6520 636c 6173 7320 6c61 6265 6c73 2e20  e class labels. 
+00011130: 4966 2060 5472 7565 602c 2074 6865 206e  If `True`, the n
+00011140: 756c 6c20 7661 6c75 6573 2077 696c 6c20  ull values will 
+00011150: 6265 2065 6e63 6f64 6564 2061 7320 7468  be encoded as th
+00011160: 6520 6022 4e6f 6e65 2260 2063 6c61 7373  e `"None"` class
+00011170: 206c 6162 656c 2e0a 0a20 2020 2020 2020   label...       
+00011180: 2020 2020 2020 2020 203c 4164 6465 6420           <Added 
+00011190: 7665 7273 696f 6e3d 2231 2e31 342e 3222  version="1.14.2"
+000111a0: 2f3e 0a0a 2020 2020 2020 2020 4578 616d  />..        Exam
+000111b0: 706c 653a 0a0a 2020 2020 2020 2020 6060  ple:..        ``
+000111c0: 6070 790a 2020 2020 2020 2020 3e3e 3e20  `py.        >>> 
+000111d0: 6672 6f6d 2064 6174 6173 6574 7320 696d  from datasets im
+000111e0: 706f 7274 206c 6f61 645f 6461 7461 7365  port load_datase
+000111f0: 740a 2020 2020 2020 2020 3e3e 3e20 6473  t.        >>> ds
+00011200: 203d 206c 6f61 645f 6461 7461 7365 7428   = load_dataset(
+00011210: 2262 6f6f 6c71 222c 2073 706c 6974 3d22  "boolq", split="
+00011220: 7661 6c69 6461 7469 6f6e 2229 0a20 2020  validation").   
+00011230: 2020 2020 203e 3e3e 2064 732e 6665 6174       >>> ds.feat
+00011240: 7572 6573 0a20 2020 2020 2020 207b 2761  ures.        {'a
+00011250: 6e73 7765 7227 3a20 5661 6c75 6528 6474  nswer': Value(dt
+00011260: 7970 653d 2762 6f6f 6c27 2c20 6964 3d4e  ype='bool', id=N
+00011270: 6f6e 6529 2c0a 2020 2020 2020 2020 2027  one),.         '
+00011280: 7061 7373 6167 6527 3a20 5661 6c75 6528  passage': Value(
+00011290: 6474 7970 653d 2773 7472 696e 6727 2c20  dtype='string', 
+000112a0: 6964 3d4e 6f6e 6529 2c0a 2020 2020 2020  id=None),.      
+000112b0: 2020 2027 7175 6573 7469 6f6e 273a 2056     'question': V
+000112c0: 616c 7565 2864 7479 7065 3d27 7374 7269  alue(dtype='stri
+000112d0: 6e67 272c 2069 643d 4e6f 6e65 297d 0a20  ng', id=None)}. 
+000112e0: 2020 2020 2020 203e 3e3e 2064 7320 3d20         >>> ds = 
+000112f0: 6473 2e63 6c61 7373 5f65 6e63 6f64 655f  ds.class_encode_
+00011300: 636f 6c75 6d6e 2827 616e 7377 6572 2729  column('answer')
+00011310: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
+00011320: 6665 6174 7572 6573 0a20 2020 2020 2020  features.       
+00011330: 207b 2761 6e73 7765 7227 3a20 436c 6173   {'answer': Clas
+00011340: 734c 6162 656c 286e 756d 5f63 6c61 7373  sLabel(num_class
+00011350: 6573 3d32 2c20 6e61 6d65 733d 5b27 4661  es=2, names=['Fa
+00011360: 6c73 6527 2c20 2754 7275 6527 5d2c 2069  lse', 'True'], i
+00011370: 643d 4e6f 6e65 292c 0a20 2020 2020 2020  d=None),.       
+00011380: 2020 2770 6173 7361 6765 273a 2056 616c    'passage': Val
+00011390: 7565 2864 7479 7065 3d27 7374 7269 6e67  ue(dtype='string
+000113a0: 272c 2069 643d 4e6f 6e65 292c 0a20 2020  ', id=None),.   
+000113b0: 2020 2020 2020 2771 7565 7374 696f 6e27        'question'
+000113c0: 3a20 5661 6c75 6528 6474 7970 653d 2773  : Value(dtype='s
+000113d0: 7472 696e 6727 2c20 6964 3d4e 6f6e 6529  tring', id=None)
+000113e0: 7d0a 2020 2020 2020 2020 6060 600a 2020  }.        ```.  
+000113f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00011400: 2020 2320 5361 6e69 7479 2063 6865 636b    # Sanity check
+00011410: 730a 2020 2020 2020 2020 6966 2063 6f6c  s.        if col
+00011420: 756d 6e20 6e6f 7420 696e 2073 656c 662e  umn not in self.
+00011430: 5f64 6174 612e 636f 6c75 6d6e 5f6e 616d  _data.column_nam
+00011440: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00011450: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00011460: 2866 2243 6f6c 756d 6e20 287b 636f 6c75  (f"Column ({colu
+00011470: 6d6e 7d29 206e 6f74 2069 6e20 7461 626c  mn}) not in tabl
+00011480: 6520 636f 6c75 6d6e 7320 287b 7365 6c66  e columns ({self
+00011490: 2e5f 6461 7461 2e63 6f6c 756d 6e5f 6e61  ._data.column_na
+000114a0: 6d65 737d 292e 2229 0a20 2020 2020 2020  mes}).").       
+000114b0: 2073 7263 5f66 6561 7420 3d20 7365 6c66   src_feat = self
+000114c0: 2e66 6561 7475 7265 735b 636f 6c75 6d6e  .features[column
+000114d0: 5d0a 2020 2020 2020 2020 6966 206e 6f74  ].        if not
+000114e0: 2069 7369 6e73 7461 6e63 6528 7372 635f   isinstance(src_
+000114f0: 6665 6174 2c20 5661 6c75 6529 3a0a 2020  feat, Value):.  
+00011500: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00011510: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00011520: 2020 2020 2020 2020 2020 2020 6622 436c              f"Cl
+00011530: 6173 7320 656e 636f 6469 6e67 2069 7320  ass encoding is 
+00011540: 6f6e 6c79 2073 7570 706f 7274 6564 2066  only supported f
+00011550: 6f72 207b 5661 6c75 652e 5f5f 6e61 6d65  or {Value.__name
+00011560: 5f5f 7d20 636f 6c75 6d6e 2c20 616e 6420  __} column, and 
+00011570: 636f 6c75 6d6e 207b 636f 6c75 6d6e 7d20  column {column} 
+00011580: 6973 207b 7479 7065 2873 7263 5f66 6561  is {type(src_fea
+00011590: 7429 2e5f 5f6e 616d 655f 5f7d 2e22 0a20  t).__name__}.". 
+000115a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+000115b0: 2020 2020 2020 6966 2073 7263 5f66 6561        if src_fea
+000115c0: 742e 6474 7970 6520 213d 2022 7374 7269  t.dtype != "stri
+000115d0: 6e67 2220 6f72 2028 696e 636c 7564 655f  ng" or (include_
+000115e0: 6e75 6c6c 7320 616e 6420 4e6f 6e65 2069  nulls and None i
+000115f0: 6e20 7365 6c66 2e75 6e69 7175 6528 636f  n self.unique(co
+00011600: 6c75 6d6e 2929 3a0a 0a20 2020 2020 2020  lumn)):..       
+00011610: 2020 2020 2064 6566 2073 7472 696e 6769       def stringi
+00011620: 6679 5f63 6f6c 756d 6e28 6261 7463 6829  fy_column(batch)
+00011630: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011640: 2020 6261 7463 685b 636f 6c75 6d6e 5d20    batch[column] 
+00011650: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+00011660: 2020 2020 2020 2020 7374 7228 7361 6d70          str(samp
+00011670: 6c65 2920 6966 2069 6e63 6c75 6465 5f6e  le) if include_n
+00011680: 756c 6c73 206f 7220 7361 6d70 6c65 2069  ulls or sample i
+00011690: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
+000116a0: 4e6f 6e65 2066 6f72 2073 616d 706c 6520  None for sample 
+000116b0: 696e 2062 6174 6368 5b63 6f6c 756d 6e5d  in batch[column]
+000116c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000116d0: 205d 0a20 2020 2020 2020 2020 2020 2020   ].             
+000116e0: 2020 2072 6574 7572 6e20 6261 7463 680a     return batch.
+000116f0: 0a20 2020 2020 2020 2020 2020 2064 7365  .            dse
+00011700: 7420 3d20 7365 6c66 2e6d 6170 280a 2020  t = self.map(.  
+00011710: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00011720: 7269 6e67 6966 795f 636f 6c75 6d6e 2c0a  ringify_column,.
+00011730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011740: 6261 7463 6865 643d 5472 7565 2c0a 2020  batched=True,.  
+00011750: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00011760: 7363 3d22 5374 7269 6e67 6966 7969 6e67  sc="Stringifying
+00011770: 2074 6865 2063 6f6c 756d 6e22 2c0a 2020   the column",.  
+00011780: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00011790: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000117a0: 2020 2020 2020 6473 6574 203d 2073 656c        dset = sel
+000117b0: 660a 0a20 2020 2020 2020 2023 2043 7265  f..        # Cre
+000117c0: 6174 6520 7468 6520 6e65 7720 6665 6174  ate the new feat
+000117d0: 7572 650a 2020 2020 2020 2020 636c 6173  ure.        clas
+000117e0: 735f 6e61 6d65 7320 3d20 736f 7274 6564  s_names = sorted
+000117f0: 2873 7472 2873 616d 706c 6529 2066 6f72  (str(sample) for
+00011800: 2073 616d 706c 6520 696e 2064 7365 742e   sample in dset.
+00011810: 756e 6971 7565 2863 6f6c 756d 6e29 2069  unique(column) i
+00011820: 6620 696e 636c 7564 655f 6e75 6c6c 7320  f include_nulls 
+00011830: 6f72 2073 616d 706c 6520 6973 206e 6f74  or sample is not
+00011840: 204e 6f6e 6529 0a20 2020 2020 2020 2064   None).        d
+00011850: 7374 5f66 6561 7420 3d20 436c 6173 734c  st_feat = ClassL
+00011860: 6162 656c 286e 616d 6573 3d63 6c61 7373  abel(names=class
+00011870: 5f6e 616d 6573 290a 0a20 2020 2020 2020  _names)..       
+00011880: 2064 6566 2063 6173 745f 746f 5f63 6c61   def cast_to_cla
+00011890: 7373 5f6c 6162 656c 7328 6261 7463 6829  ss_labels(batch)
+000118a0: 3a0a 2020 2020 2020 2020 2020 2020 6261  :.            ba
+000118b0: 7463 685b 636f 6c75 6d6e 5d20 3d20 5b0a  tch[column] = [.
+000118c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118d0: 6473 745f 6665 6174 2e73 7472 3269 6e74  dst_feat.str2int
+000118e0: 2873 7472 2873 616d 706c 6529 2920 6966  (str(sample)) if
+000118f0: 2069 6e63 6c75 6465 5f6e 756c 6c73 206f   include_nulls o
+00011900: 7220 7361 6d70 6c65 2069 7320 6e6f 7420  r sample is not 
+00011910: 4e6f 6e65 2065 6c73 6520 4e6f 6e65 0a20  None else None. 
+00011920: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00011930: 6f72 2073 616d 706c 6520 696e 2062 6174  or sample in bat
+00011940: 6368 5b63 6f6c 756d 6e5d 0a20 2020 2020  ch[column].     
+00011950: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00011960: 2020 2020 2072 6574 7572 6e20 6261 7463       return batc
+00011970: 680a 0a20 2020 2020 2020 206e 6577 5f66  h..        new_f
+00011980: 6561 7475 7265 7320 3d20 6473 6574 2e66  eatures = dset.f
+00011990: 6561 7475 7265 732e 636f 7079 2829 0a20  eatures.copy(). 
+000119a0: 2020 2020 2020 206e 6577 5f66 6561 7475         new_featu
+000119b0: 7265 735b 636f 6c75 6d6e 5d20 3d20 6473  res[column] = ds
+000119c0: 745f 6665 6174 0a0a 2020 2020 2020 2020  t_feat..        
+000119d0: 6473 6574 203d 2064 7365 742e 6d61 7028  dset = dset.map(
+000119e0: 0a20 2020 2020 2020 2020 2020 2063 6173  .            cas
+000119f0: 745f 746f 5f63 6c61 7373 5f6c 6162 656c  t_to_class_label
+00011a00: 732c 0a20 2020 2020 2020 2020 2020 2062  s,.            b
+00011a10: 6174 6368 6564 3d54 7275 652c 0a20 2020  atched=True,.   
+00011a20: 2020 2020 2020 2020 2066 6561 7475 7265           feature
+00011a30: 733d 6e65 775f 6665 6174 7572 6573 2c0a  s=new_features,.
+00011a40: 2020 2020 2020 2020 2020 2020 6465 7363              desc
+00011a50: 3d22 4361 7374 696e 6720 746f 2063 6c61  ="Casting to cla
+00011a60: 7373 206c 6162 656c 7322 2c0a 2020 2020  ss labels",.    
+00011a70: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
+00011a80: 6574 7572 6e20 6473 6574 0a0a 2020 2020  eturn dset..    
+00011a90: 4066 696e 6765 7270 7269 6e74 5f74 7261  @fingerprint_tra
+00011aa0: 6e73 666f 726d 2869 6e70 6c61 6365 3d46  nsform(inplace=F
+00011ab0: 616c 7365 290a 2020 2020 6465 6620 666c  alse).    def fl
+00011ac0: 6174 7465 6e28 7365 6c66 2c20 6e65 775f  atten(self, new_
+00011ad0: 6669 6e67 6572 7072 696e 743a 204f 7074  fingerprint: Opt
+00011ae0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+00011af0: 652c 206d 6178 5f64 6570 7468 3d31 3629  e, max_depth=16)
+00011b00: 202d 3e20 2244 6174 6173 6574 223a 0a20   -> "Dataset":. 
+00011b10: 2020 2020 2020 2022 2222 466c 6174 7465         """Flatte
+00011b20: 6e20 7468 6520 7461 626c 652e 0a20 2020  n the table..   
+00011b30: 2020 2020 2045 6163 6820 636f 6c75 6d6e       Each column
+00011b40: 2077 6974 6820 6120 7374 7275 6374 2074   with a struct t
+00011b50: 7970 6520 6973 2066 6c61 7474 656e 6564  ype is flattened
+00011b60: 2069 6e74 6f20 6f6e 6520 636f 6c75 6d6e   into one column
+00011b70: 2070 6572 2073 7472 7563 7420 6669 656c   per struct fiel
+00011b80: 642e 0a20 2020 2020 2020 204f 7468 6572  d..        Other
+00011b90: 2063 6f6c 756d 6e73 2061 7265 206c 6566   columns are lef
+00011ba0: 7420 756e 6368 616e 6765 642e 0a0a 2020  t unchanged...  
+00011bb0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+00011bc0: 2020 2020 2020 2020 6e65 775f 6669 6e67          new_fing
+00011bd0: 6572 7072 696e 7420 2860 7374 7260 2c20  erprint (`str`, 
+00011be0: 2a6f 7074 696f 6e61 6c2a 293a 0a20 2020  *optional*):.   
+00011bf0: 2020 2020 2020 2020 2020 2020 2054 6865               The
+00011c00: 206e 6577 2066 696e 6765 7270 7269 6e74   new fingerprint
+00011c10: 206f 6620 7468 6520 6461 7461 7365 7420   of the dataset 
+00011c20: 6166 7465 7220 7472 616e 7366 6f72 6d2e  after transform.
+00011c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011c40: 2049 6620 604e 6f6e 6560 2c20 7468 6520   If `None`, the 
+00011c50: 6e65 7720 6669 6e67 6572 7072 696e 7420  new fingerprint 
+00011c60: 6973 2063 6f6d 7075 7465 6420 7573 696e  is computed usin
+00011c70: 6720 6120 6861 7368 206f 6620 7468 6520  g a hash of the 
+00011c80: 7072 6576 696f 7573 2066 696e 6765 7270  previous fingerp
+00011c90: 7269 6e74 2c20 616e 6420 7468 6520 7472  rint, and the tr
+00011ca0: 616e 7366 6f72 6d20 6172 6775 6d65 6e74  ansform argument
+00011cb0: 732e 0a0a 2020 2020 2020 2020 5265 7475  s...        Retu
+00011cc0: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
+00011cd0: 205b 6044 6174 6173 6574 605d 3a20 4120   [`Dataset`]: A 
+00011ce0: 636f 7079 206f 6620 7468 6520 6461 7461  copy of the data
+00011cf0: 7365 7420 7769 7468 2066 6c61 7474 656e  set with flatten
+00011d00: 6564 2063 6f6c 756d 6e73 2e0a 0a20 2020  ed columns...   
+00011d10: 2020 2020 2045 7861 6d70 6c65 3a0a 0a20       Example:.. 
+00011d20: 2020 2020 2020 2060 6060 7079 0a20 2020         ```py.   
+00011d30: 2020 2020 203e 3e3e 2066 726f 6d20 6461       >>> from da
+00011d40: 7461 7365 7473 2069 6d70 6f72 7420 6c6f  tasets import lo
+00011d50: 6164 5f64 6174 6173 6574 0a20 2020 2020  ad_dataset.     
+00011d60: 2020 203e 3e3e 2064 7320 3d20 6c6f 6164     >>> ds = load
+00011d70: 5f64 6174 6173 6574 2822 7371 7561 6422  _dataset("squad"
+00011d80: 2c20 7370 6c69 743d 2274 7261 696e 2229  , split="train")
+00011d90: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
+00011da0: 6665 6174 7572 6573 0a20 2020 2020 2020  features.       
+00011db0: 207b 2761 6e73 7765 7273 273a 2053 6571   {'answers': Seq
+00011dc0: 7565 6e63 6528 6665 6174 7572 653d 7b27  uence(feature={'
+00011dd0: 7465 7874 273a 2056 616c 7565 2864 7479  text': Value(dty
+00011de0: 7065 3d27 7374 7269 6e67 272c 2069 643d  pe='string', id=
+00011df0: 4e6f 6e65 292c 2027 616e 7377 6572 5f73  None), 'answer_s
+00011e00: 7461 7274 273a 2056 616c 7565 2864 7479  tart': Value(dty
+00011e10: 7065 3d27 696e 7433 3227 2c20 6964 3d4e  pe='int32', id=N
+00011e20: 6f6e 6529 7d2c 206c 656e 6774 683d 2d31  one)}, length=-1
+00011e30: 2c20 6964 3d4e 6f6e 6529 2c0a 2020 2020  , id=None),.    
+00011e40: 2020 2020 2027 636f 6e74 6578 7427 3a20       'context': 
+00011e50: 5661 6c75 6528 6474 7970 653d 2773 7472  Value(dtype='str
+00011e60: 696e 6727 2c20 6964 3d4e 6f6e 6529 2c0a  ing', id=None),.
+00011e70: 2020 2020 2020 2020 2027 6964 273a 2056           'id': V
+00011e80: 616c 7565 2864 7479 7065 3d27 7374 7269  alue(dtype='stri
+00011e90: 6e67 272c 2069 643d 4e6f 6e65 292c 0a20  ng', id=None),. 
+00011ea0: 2020 2020 2020 2020 2771 7565 7374 696f          'questio
+00011eb0: 6e27 3a20 5661 6c75 6528 6474 7970 653d  n': Value(dtype=
+00011ec0: 2773 7472 696e 6727 2c20 6964 3d4e 6f6e  'string', id=Non
+00011ed0: 6529 2c0a 2020 2020 2020 2020 2027 7469  e),.         'ti
+00011ee0: 746c 6527 3a20 5661 6c75 6528 6474 7970  tle': Value(dtyp
+00011ef0: 653d 2773 7472 696e 6727 2c20 6964 3d4e  e='string', id=N
+00011f00: 6f6e 6529 7d0a 2020 2020 2020 2020 3e3e  one)}.        >>
+00011f10: 3e20 6473 2e66 6c61 7474 656e 2829 0a20  > ds.flatten(). 
+00011f20: 2020 2020 2020 2044 6174 6173 6574 287b         Dataset({
+00011f30: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
+00011f40: 7475 7265 733a 205b 2769 6427 2c20 2774  tures: ['id', 't
+00011f50: 6974 6c65 272c 2027 636f 6e74 6578 7427  itle', 'context'
+00011f60: 2c20 2771 7565 7374 696f 6e27 2c20 2761  , 'question', 'a
+00011f70: 6e73 7765 7273 2e74 6578 7427 2c20 2761  nswers.text', 'a
+00011f80: 6e73 7765 7273 2e61 6e73 7765 725f 7374  nswers.answer_st
+00011f90: 6172 7427 5d2c 0a20 2020 2020 2020 2020  art'],.         
+00011fa0: 2020 206e 756d 5f72 6f77 733a 2038 3735     num_rows: 875
+00011fb0: 3939 0a20 2020 2020 2020 207d 290a 2020  99.        }).  
+00011fc0: 2020 2020 2020 6060 600a 2020 2020 2020        ```.      
+00011fd0: 2020 2222 220a 2020 2020 2020 2020 6461    """.        da
+00011fe0: 7461 7365 7420 3d20 636f 7079 2e64 6565  taset = copy.dee
+00011ff0: 7063 6f70 7928 7365 6c66 290a 2020 2020  pcopy(self).    
+00012000: 2020 2020 666f 7220 6465 7074 6820 696e      for depth in
+00012010: 2072 616e 6765 2831 2c20 6d61 785f 6465   range(1, max_de
+00012020: 7074 6829 3a0a 2020 2020 2020 2020 2020  pth):.          
+00012030: 2020 6966 2061 6e79 2869 7369 6e73 7461    if any(isinsta
+00012040: 6e63 6528 6669 656c 642e 7479 7065 2c20  nce(field.type, 
+00012050: 7061 2e53 7472 7563 7454 7970 6529 2066  pa.StructType) f
+00012060: 6f72 2066 6965 6c64 2069 6e20 6461 7461  or field in data
+00012070: 7365 742e 5f64 6174 612e 7363 6865 6d61  set._data.schema
+00012080: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00012090: 2020 2064 6174 6173 6574 2e5f 6461 7461     dataset._data
+000120a0: 203d 2064 6174 6173 6574 2e5f 6461 7461   = dataset._data
+000120b0: 2e66 6c61 7474 656e 2829 0a20 2020 2020  .flatten().     
+000120c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000120d0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+000120e0: 616b 0a20 2020 2020 2020 2064 6174 6173  ak.        datas
+000120f0: 6574 2e69 6e66 6f2e 6665 6174 7572 6573  et.info.features
+00012100: 203d 2073 656c 662e 6665 6174 7572 6573   = self.features
+00012110: 2e66 6c61 7474 656e 286d 6178 5f64 6570  .flatten(max_dep
+00012120: 7468 3d6d 6178 5f64 6570 7468 290a 2020  th=max_depth).  
+00012130: 2020 2020 2020 6461 7461 7365 742e 5f64        dataset._d
+00012140: 6174 6120 3d20 7570 6461 7465 5f6d 6574  ata = update_met
+00012150: 6164 6174 615f 7769 7468 5f66 6561 7475  adata_with_featu
+00012160: 7265 7328 6461 7461 7365 742e 5f64 6174  res(dataset._dat
+00012170: 612c 2064 6174 6173 6574 2e66 6561 7475  a, dataset.featu
+00012180: 7265 7329 0a20 2020 2020 2020 206c 6f67  res).        log
+00012190: 6765 722e 696e 666f 2866 2746 6c61 7474  ger.info(f'Flatt
+000121a0: 656e 6564 2064 6174 6173 6574 2066 726f  ened dataset fro
+000121b0: 6d20 6465 7074 6820 7b64 6570 7468 7d20  m depth {depth} 
+000121c0: 746f 2064 6570 7468 207b 3120 6966 2064  to depth {1 if d
+000121d0: 6570 7468 202b 2031 203c 206d 6178 5f64  epth + 1 < max_d
+000121e0: 6570 7468 2065 6c73 6520 2275 6e6b 6e6f  epth else "unkno
+000121f0: 776e 227d 2e27 290a 2020 2020 2020 2020  wn"}.').        
+00012200: 6461 7461 7365 742e 5f66 696e 6765 7270  dataset._fingerp
+00012210: 7269 6e74 203d 206e 6577 5f66 696e 6765  rint = new_finge
+00012220: 7270 7269 6e74 0a20 2020 2020 2020 2072  rprint.        r
+00012230: 6574 7572 6e20 6461 7461 7365 740a 0a20  eturn dataset.. 
+00012240: 2020 2064 6566 2063 6173 7428 0a20 2020     def cast(.   
+00012250: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00012260: 2020 2066 6561 7475 7265 733a 2046 6561     features: Fea
+00012270: 7475 7265 732c 0a20 2020 2020 2020 2062  tures,.        b
+00012280: 6174 6368 5f73 697a 653a 204f 7074 696f  atch_size: Optio
+00012290: 6e61 6c5b 696e 745d 203d 2031 3030 302c  nal[int] = 1000,
+000122a0: 0a20 2020 2020 2020 206b 6565 705f 696e  .        keep_in
+000122b0: 5f6d 656d 6f72 793a 2062 6f6f 6c20 3d20  _memory: bool = 
+000122c0: 4661 6c73 652c 0a20 2020 2020 2020 206c  False,.        l
+000122d0: 6f61 645f 6672 6f6d 5f63 6163 6865 5f66  oad_from_cache_f
+000122e0: 696c 653a 2062 6f6f 6c20 3d20 5472 7565  ile: bool = True
+000122f0: 2c0a 2020 2020 2020 2020 6361 6368 655f  ,.        cache_
+00012300: 6669 6c65 5f6e 616d 653a 204f 7074 696f  file_name: Optio
+00012310: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+00012320: 0a20 2020 2020 2020 2077 7269 7465 725f  .        writer_
+00012330: 6261 7463 685f 7369 7a65 3a20 4f70 7469  batch_size: Opti
+00012340: 6f6e 616c 5b69 6e74 5d20 3d20 3130 3030  onal[int] = 1000
+00012350: 2c0a 2020 2020 2020 2020 6e75 6d5f 7072  ,.        num_pr
+00012360: 6f63 3a20 4f70 7469 6f6e 616c 5b69 6e74  oc: Optional[int
+00012370: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2920  ] = None,.    ) 
+00012380: 2d3e 2022 4461 7461 7365 7422 3a0a 2020  -> "Dataset":.  
+00012390: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000123a0: 2020 4361 7374 2074 6865 2064 6174 6173    Cast the datas
+000123b0: 6574 2074 6f20 6120 6e65 7720 7365 7420  et to a new set 
+000123c0: 6f66 2066 6561 7475 7265 732e 0a0a 2020  of features...  
+000123d0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+000123e0: 2020 2020 2020 2020 6665 6174 7572 6573          features
+000123f0: 2028 5b60 4665 6174 7572 6573 605d 293a   ([`Features`]):
+00012400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012410: 204e 6577 2066 6561 7475 7265 7320 746f   New features to
+00012420: 2063 6173 7420 7468 6520 6461 7461 7365   cast the datase
+00012430: 7420 746f 2e0a 2020 2020 2020 2020 2020  t to..          
+00012440: 2020 2020 2020 5468 6520 6e61 6d65 206f        The name o
+00012450: 6620 7468 6520 6669 656c 6473 2069 6e20  f the fields in 
+00012460: 7468 6520 6665 6174 7572 6573 206d 7573  the features mus
+00012470: 7420 6d61 7463 6820 7468 6520 6375 7272  t match the curr
+00012480: 656e 7420 636f 6c75 6d6e 206e 616d 6573  ent column names
+00012490: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000124a0: 2020 5468 6520 7479 7065 206f 6620 7468    The type of th
+000124b0: 6520 6461 7461 206d 7573 7420 616c 736f  e data must also
+000124c0: 2062 6520 636f 6e76 6572 7469 626c 6520   be convertible 
+000124d0: 6672 6f6d 206f 6e65 2074 7970 6520 746f  from one type to
+000124e0: 2074 6865 206f 7468 6572 2e0a 2020 2020   the other..    
+000124f0: 2020 2020 2020 2020 2020 2020 466f 7220              For 
+00012500: 6e6f 6e2d 7472 6976 6961 6c20 636f 6e76  non-trivial conv
+00012510: 6572 7369 6f6e 2c20 652e 672e 2060 7374  ersion, e.g. `st
+00012520: 7260 203c 2d3e 2060 436c 6173 734c 6162  r` <-> `ClassLab
+00012530: 656c 6020 796f 7520 7368 6f75 6c64 2075  el` you should u
+00012540: 7365 205b 607e 6461 7461 7365 7473 2e44  se [`~datasets.D
+00012550: 6174 6173 6574 2e6d 6170 605d 2074 6f20  ataset.map`] to 
+00012560: 7570 6461 7465 2074 6865 2044 6174 6173  update the Datas
+00012570: 6574 2e0a 2020 2020 2020 2020 2020 2020  et..            
+00012580: 6261 7463 685f 7369 7a65 2028 6069 6e74  batch_size (`int
+00012590: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
+000125a0: 3130 3030 6029 3a0a 2020 2020 2020 2020  1000`):.        
+000125b0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+000125c0: 6620 6578 616d 706c 6573 2070 6572 2062  f examples per b
+000125d0: 6174 6368 2070 726f 7669 6465 6420 746f  atch provided to
+000125e0: 2063 6173 742e 0a20 2020 2020 2020 2020   cast..         
+000125f0: 2020 2020 2020 2049 6620 6062 6174 6368         If `batch
+00012600: 5f73 697a 6520 3c3d 2030 6020 6f72 2060  _size <= 0` or `
+00012610: 6261 7463 685f 7369 7a65 203d 3d20 4e6f  batch_size == No
+00012620: 6e65 6020 7468 656e 2070 726f 7669 6465  ne` then provide
+00012630: 2074 6865 2066 756c 6c20 6461 7461 7365   the full datase
+00012640: 7420 6173 2061 2073 696e 676c 6520 6261  t as a single ba
+00012650: 7463 6820 746f 2063 6173 742e 0a20 2020  tch to cast..   
+00012660: 2020 2020 2020 2020 206b 6565 705f 696e           keep_in
+00012670: 5f6d 656d 6f72 7920 2860 626f 6f6c 602c  _memory (`bool`,
+00012680: 2064 6566 6175 6c74 7320 746f 2060 4661   defaults to `Fa
+00012690: 6c73 6560 293a 0a20 2020 2020 2020 2020  lse`):.         
+000126a0: 2020 2020 2020 2057 6865 7468 6572 2074         Whether t
+000126b0: 6f20 636f 7079 2074 6865 2064 6174 6120  o copy the data 
+000126c0: 696e 2d6d 656d 6f72 792e 0a20 2020 2020  in-memory..     
+000126d0: 2020 2020 2020 206c 6f61 645f 6672 6f6d         load_from
+000126e0: 5f63 6163 6865 5f66 696c 6520 2860 626f  _cache_file (`bo
+000126f0: 6f6c 602c 2064 6566 6175 6c74 7320 746f  ol`, defaults to
+00012700: 2060 5472 7565 6020 6966 2063 6163 6869   `True` if cachi
+00012710: 6e67 2069 7320 656e 6162 6c65 6429 3a0a  ng is enabled):.
+00012720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012730: 4966 2061 2063 6163 6865 2066 696c 6520  If a cache file 
+00012740: 7374 6f72 696e 6720 7468 6520 6375 7272  storing the curr
+00012750: 656e 7420 636f 6d70 7574 6174 696f 6e20  ent computation 
+00012760: 6672 6f6d 2060 6675 6e63 7469 6f6e 600a  from `function`.
+00012770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012780: 6361 6e20 6265 2069 6465 6e74 6966 6965  can be identifie
+00012790: 642c 2075 7365 2069 7420 696e 7374 6561  d, use it instea
+000127a0: 6420 6f66 2072 6563 6f6d 7075 7469 6e67  d of recomputing
+000127b0: 2e0a 2020 2020 2020 2020 2020 2020 6361  ..            ca
+000127c0: 6368 655f 6669 6c65 5f6e 616d 6520 2860  che_file_name (`
+000127d0: 7374 7260 2c20 2a6f 7074 696f 6e61 6c2a  str`, *optional*
+000127e0: 2c20 6465 6661 756c 7473 2074 6f20 604e  , defaults to `N
+000127f0: 6f6e 6560 293a 0a20 2020 2020 2020 2020  one`):.         
+00012800: 2020 2020 2020 2050 726f 7669 6465 2074         Provide t
+00012810: 6865 206e 616d 6520 6f66 2061 2070 6174  he name of a pat
+00012820: 6820 666f 7220 7468 6520 6361 6368 6520  h for the cache 
+00012830: 6669 6c65 2e20 4974 2069 7320 7573 6564  file. It is used
+00012840: 2074 6f20 7374 6f72 6520 7468 650a 2020   to store the.  
+00012850: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00012860: 7375 6c74 7320 6f66 2074 6865 2063 6f6d  sults of the com
+00012870: 7075 7461 7469 6f6e 2069 6e73 7465 6164  putation instead
+00012880: 206f 6620 7468 6520 6175 746f 6d61 7469   of the automati
+00012890: 6361 6c6c 7920 6765 6e65 7261 7465 6420  cally generated 
+000128a0: 6361 6368 6520 6669 6c65 206e 616d 652e  cache file name.
+000128b0: 0a20 2020 2020 2020 2020 2020 2077 7269  .            wri
+000128c0: 7465 725f 6261 7463 685f 7369 7a65 2028  ter_batch_size (
+000128d0: 6069 6e74 602c 2064 6566 6175 6c74 7320  `int`, defaults 
+000128e0: 746f 2060 3130 3030 6029 3a0a 2020 2020  to `1000`):.    
+000128f0: 2020 2020 2020 2020 2020 2020 4e75 6d62              Numb
+00012900: 6572 206f 6620 726f 7773 2070 6572 2077  er of rows per w
+00012910: 7269 7465 206f 7065 7261 7469 6f6e 2066  rite operation f
+00012920: 6f72 2074 6865 2063 6163 6865 2066 696c  or the cache fil
+00012930: 6520 7772 6974 6572 2e0a 2020 2020 2020  e writer..      
+00012940: 2020 2020 2020 2020 2020 5468 6973 2076            This v
+00012950: 616c 7565 2069 7320 6120 676f 6f64 2074  alue is a good t
+00012960: 7261 6465 2d6f 6666 2062 6574 7765 656e  rade-off between
+00012970: 206d 656d 6f72 7920 7573 6167 6520 6475   memory usage du
+00012980: 7269 6e67 2074 6865 2070 726f 6365 7373  ring the process
+00012990: 696e 672c 2061 6e64 2070 726f 6365 7373  ing, and process
+000129a0: 696e 6720 7370 6565 642e 0a20 2020 2020  ing speed..     
+000129b0: 2020 2020 2020 2020 2020 2048 6967 6865             Highe
+000129c0: 7220 7661 6c75 6520 6d61 6b65 7320 7468  r value makes th
+000129d0: 6520 7072 6f63 6573 7369 6e67 2064 6f20  e processing do 
+000129e0: 6665 7765 7220 6c6f 6f6b 7570 732c 206c  fewer lookups, l
+000129f0: 6f77 6572 2076 616c 7565 2063 6f6e 7375  ower value consu
+00012a00: 6d65 206c 6573 7320 7465 6d70 6f72 6172  me less temporar
+00012a10: 7920 6d65 6d6f 7279 2077 6869 6c65 2072  y memory while r
+00012a20: 756e 6e69 6e67 205b 607e 6461 7461 7365  unning [`~datase
+00012a30: 7473 2e44 6174 6173 6574 2e6d 6170 605d  ts.Dataset.map`]
+00012a40: 2e0a 2020 2020 2020 2020 2020 2020 6e75  ..            nu
+00012a50: 6d5f 7072 6f63 2028 6069 6e74 602c 202a  m_proc (`int`, *
+00012a60: 6f70 7469 6f6e 616c 2a2c 2064 6566 6175  optional*, defau
+00012a70: 6c74 7320 746f 2060 4e6f 6e65 6029 3a0a  lts to `None`):.
+00012a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a90: 4e75 6d62 6572 206f 6620 7072 6f63 6573  Number of proces
+00012aa0: 7365 7320 666f 7220 6d75 6c74 6970 726f  ses for multipro
+00012ab0: 6365 7373 696e 672e 2042 7920 6465 6661  cessing. By defa
+00012ac0: 756c 7420 6974 2064 6f65 736e 2774 0a20  ult it doesn't. 
+00012ad0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00012ae0: 7365 206d 756c 7469 7072 6f63 6573 7369  se multiprocessi
+00012af0: 6e67 2e0a 0a20 2020 2020 2020 2052 6574  ng...        Ret
+00012b00: 7572 6e73 3a0a 2020 2020 2020 2020 2020  urns:.          
+00012b10: 2020 5b60 4461 7461 7365 7460 5d3a 2041    [`Dataset`]: A
+00012b20: 2063 6f70 7920 6f66 2074 6865 2064 6174   copy of the dat
+00012b30: 6173 6574 2077 6974 6820 6361 7374 6564  aset with casted
+00012b40: 2066 6561 7475 7265 732e 0a0a 2020 2020   features...    
+00012b50: 2020 2020 4578 616d 706c 653a 0a0a 2020      Example:..  
+00012b60: 2020 2020 2020 6060 6070 790a 2020 2020        ```py.    
+00012b70: 2020 2020 3e3e 3e20 6672 6f6d 2064 6174      >>> from dat
+00012b80: 6173 6574 7320 696d 706f 7274 206c 6f61  asets import loa
+00012b90: 645f 6461 7461 7365 742c 2043 6c61 7373  d_dataset, Class
+00012ba0: 4c61 6265 6c2c 2056 616c 7565 0a20 2020  Label, Value.   
+00012bb0: 2020 2020 203e 3e3e 2064 7320 3d20 6c6f       >>> ds = lo
+00012bc0: 6164 5f64 6174 6173 6574 2822 726f 7474  ad_dataset("rott
+00012bd0: 656e 5f74 6f6d 6174 6f65 7322 2c20 7370  en_tomatoes", sp
+00012be0: 6c69 743d 2276 616c 6964 6174 696f 6e22  lit="validation"
+00012bf0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+00012c00: 2e66 6561 7475 7265 730a 2020 2020 2020  .features.      
+00012c10: 2020 7b27 6c61 6265 6c27 3a20 436c 6173    {'label': Clas
+00012c20: 734c 6162 656c 286e 756d 5f63 6c61 7373  sLabel(num_class
+00012c30: 6573 3d32 2c20 6e61 6d65 733d 5b27 6e65  es=2, names=['ne
+00012c40: 6727 2c20 2770 6f73 275d 2c20 6964 3d4e  g', 'pos'], id=N
+00012c50: 6f6e 6529 2c0a 2020 2020 2020 2020 2027  one),.         '
+00012c60: 7465 7874 273a 2056 616c 7565 2864 7479  text': Value(dty
+00012c70: 7065 3d27 7374 7269 6e67 272c 2069 643d  pe='string', id=
+00012c80: 4e6f 6e65 297d 0a20 2020 2020 2020 203e  None)}.        >
+00012c90: 3e3e 206e 6577 5f66 6561 7475 7265 7320  >> new_features 
+00012ca0: 3d20 6473 2e66 6561 7475 7265 732e 636f  = ds.features.co
+00012cb0: 7079 2829 0a20 2020 2020 2020 203e 3e3e  py().        >>>
+00012cc0: 206e 6577 5f66 6561 7475 7265 735b 276c   new_features['l
+00012cd0: 6162 656c 275d 203d 2043 6c61 7373 4c61  abel'] = ClassLa
+00012ce0: 6265 6c28 6e61 6d65 733d 5b27 6261 6427  bel(names=['bad'
+00012cf0: 2c20 2767 6f6f 6427 5d29 0a20 2020 2020  , 'good']).     
+00012d00: 2020 203e 3e3e 206e 6577 5f66 6561 7475     >>> new_featu
+00012d10: 7265 735b 2774 6578 7427 5d20 3d20 5661  res['text'] = Va
+00012d20: 6c75 6528 276c 6172 6765 5f73 7472 696e  lue('large_strin
+00012d30: 6727 290a 2020 2020 2020 2020 3e3e 3e20  g').        >>> 
+00012d40: 6473 203d 2064 732e 6361 7374 286e 6577  ds = ds.cast(new
+00012d50: 5f66 6561 7475 7265 7329 0a20 2020 2020  _features).     
+00012d60: 2020 203e 3e3e 2064 732e 6665 6174 7572     >>> ds.featur
+00012d70: 6573 0a20 2020 2020 2020 207b 276c 6162  es.        {'lab
+00012d80: 656c 273a 2043 6c61 7373 4c61 6265 6c28  el': ClassLabel(
+00012d90: 6e75 6d5f 636c 6173 7365 733d 322c 206e  num_classes=2, n
+00012da0: 616d 6573 3d5b 2762 6164 272c 2027 676f  ames=['bad', 'go
+00012db0: 6f64 275d 2c20 6964 3d4e 6f6e 6529 2c0a  od'], id=None),.
+00012dc0: 2020 2020 2020 2020 2027 7465 7874 273a           'text':
+00012dd0: 2056 616c 7565 2864 7479 7065 3d27 6c61   Value(dtype='la
+00012de0: 7267 655f 7374 7269 6e67 272c 2069 643d  rge_string', id=
+00012df0: 4e6f 6e65 297d 0a20 2020 2020 2020 2060  None)}.        `
+00012e00: 6060 0a20 2020 2020 2020 2022 2222 0a20  ``.        """. 
+00012e10: 2020 2020 2020 2069 6620 736f 7274 6564         if sorted
+00012e20: 2866 6561 7475 7265 7329 2021 3d20 736f  (features) != so
+00012e30: 7274 6564 2873 656c 662e 5f64 6174 612e  rted(self._data.
+00012e40: 636f 6c75 6d6e 5f6e 616d 6573 293a 0a20  column_names):. 
+00012e50: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00012e60: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00012e70: 2020 2020 2020 2020 2020 2020 2066 2254               f"T
+00012e80: 6865 2063 6f6c 756d 6e73 2069 6e20 6665  he columns in fe
+00012e90: 6174 7572 6573 2028 7b6c 6973 7428 6665  atures ({list(fe
+00012ea0: 6174 7572 6573 297d 2920 6d75 7374 2062  atures)}) must b
+00012eb0: 6520 6964 656e 7469 6361 6c20 220a 2020  e identical ".  
+00012ec0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00012ed0: 6173 2074 6865 2063 6f6c 756d 6e73 2069  as the columns i
+00012ee0: 6e20 7468 6520 6461 7461 7365 743a 207b  n the dataset: {
+00012ef0: 7365 6c66 2e5f 6461 7461 2e63 6f6c 756d  self._data.colum
+00012f00: 6e5f 6e61 6d65 737d 220a 2020 2020 2020  n_names}".      
+00012f10: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00012f20: 2073 6368 656d 6120 3d20 6665 6174 7572   schema = featur
+00012f30: 6573 2e61 7272 6f77 5f73 6368 656d 610a  es.arrow_schema.
+00012f40: 2020 2020 2020 2020 666f 726d 6174 203d          format =
+00012f50: 2073 656c 662e 666f 726d 6174 0a20 2020   self.format.   
+00012f60: 2020 2020 2064 6174 6173 6574 203d 2073       dataset = s
+00012f70: 656c 662e 7769 7468 5f66 6f72 6d61 7428  elf.with_format(
+00012f80: 2261 7272 6f77 2229 0a20 2020 2020 2020  "arrow").       
+00012f90: 2023 2063 6170 7475 7265 2074 6865 2050   # capture the P
+00012fa0: 7941 7272 6f77 2076 6572 7369 6f6e 2068  yArrow version h
+00012fb0: 6572 6520 746f 206d 616b 6520 7468 6520  ere to make the 
+00012fc0: 6c61 6d62 6461 2073 6572 6961 6c69 7a61  lambda serializa
+00012fd0: 626c 6520 6f6e 2057 696e 646f 7773 0a20  ble on Windows. 
+00012fe0: 2020 2020 2020 2064 6174 6173 6574 203d         dataset =
+00012ff0: 2064 6174 6173 6574 2e6d 6170 280a 2020   dataset.map(.  
+00013000: 2020 2020 2020 2020 2020 7061 7274 6961            partia
+00013010: 6c28 7461 626c 655f 6361 7374 2c20 7363  l(table_cast, sc
+00013020: 6865 6d61 3d73 6368 656d 6129 2c0a 2020  hema=schema),.  
+00013030: 2020 2020 2020 2020 2020 6261 7463 6865            batche
+00013040: 643d 5472 7565 2c0a 2020 2020 2020 2020  d=True,.        
+00013050: 2020 2020 6261 7463 685f 7369 7a65 3d62      batch_size=b
+00013060: 6174 6368 5f73 697a 652c 0a20 2020 2020  atch_size,.     
+00013070: 2020 2020 2020 206b 6565 705f 696e 5f6d         keep_in_m
+00013080: 656d 6f72 793d 6b65 6570 5f69 6e5f 6d65  emory=keep_in_me
+00013090: 6d6f 7279 2c0a 2020 2020 2020 2020 2020  mory,.          
+000130a0: 2020 6c6f 6164 5f66 726f 6d5f 6361 6368    load_from_cach
+000130b0: 655f 6669 6c65 3d6c 6f61 645f 6672 6f6d  e_file=load_from
+000130c0: 5f63 6163 6865 5f66 696c 652c 0a20 2020  _cache_file,.   
+000130d0: 2020 2020 2020 2020 2063 6163 6865 5f66           cache_f
+000130e0: 696c 655f 6e61 6d65 3d63 6163 6865 5f66  ile_name=cache_f
+000130f0: 696c 655f 6e61 6d65 2c0a 2020 2020 2020  ile_name,.      
+00013100: 2020 2020 2020 7772 6974 6572 5f62 6174        writer_bat
+00013110: 6368 5f73 697a 653d 7772 6974 6572 5f62  ch_size=writer_b
+00013120: 6174 6368 5f73 697a 652c 0a20 2020 2020  atch_size,.     
+00013130: 2020 2020 2020 206e 756d 5f70 726f 633d         num_proc=
+00013140: 6e75 6d5f 7072 6f63 2c0a 2020 2020 2020  num_proc,.      
+00013150: 2020 2020 2020 6665 6174 7572 6573 3d66        features=f
+00013160: 6561 7475 7265 732c 0a20 2020 2020 2020  eatures,.       
+00013170: 2020 2020 2064 6573 633d 2243 6173 7469       desc="Casti
+00013180: 6e67 2074 6865 2064 6174 6173 6574 222c  ng the dataset",
+00013190: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+000131a0: 2020 2064 6174 6173 6574 203d 2064 6174     dataset = dat
+000131b0: 6173 6574 2e77 6974 685f 666f 726d 6174  aset.with_format
+000131c0: 282a 2a66 6f72 6d61 7429 0a20 2020 2020  (**format).     
+000131d0: 2020 2072 6574 7572 6e20 6461 7461 7365     return datase
+000131e0: 740a 0a20 2020 2040 6669 6e67 6572 7072  t..    @fingerpr
+000131f0: 696e 745f 7472 616e 7366 6f72 6d28 696e  int_transform(in
+00013200: 706c 6163 653d 4661 6c73 6529 0a20 2020  place=False).   
+00013210: 2064 6566 2063 6173 745f 636f 6c75 6d6e   def cast_column
+00013220: 2873 656c 662c 2063 6f6c 756d 6e3a 2073  (self, column: s
+00013230: 7472 2c20 6665 6174 7572 653a 2046 6561  tr, feature: Fea
+00013240: 7475 7265 5479 7065 2c20 6e65 775f 6669  tureType, new_fi
+00013250: 6e67 6572 7072 696e 743a 204f 7074 696f  ngerprint: Optio
+00013260: 6e61 6c5b 7374 725d 203d 204e 6f6e 6529  nal[str] = None)
+00013270: 202d 3e20 2244 6174 6173 6574 223a 0a20   -> "Dataset":. 
+00013280: 2020 2020 2020 2022 2222 4361 7374 2063         """Cast c
+00013290: 6f6c 756d 6e20 746f 2066 6561 7475 7265  olumn to feature
+000132a0: 2066 6f72 2064 6563 6f64 696e 672e 0a0a   for decoding...
+000132b0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+000132c0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
+000132d0: 2028 6073 7472 6029 3a0a 2020 2020 2020   (`str`):.      
+000132e0: 2020 2020 2020 2020 2020 436f 6c75 6d6e            Column
+000132f0: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
+00013300: 2020 2066 6561 7475 7265 2028 6046 6561     feature (`Fea
+00013310: 7475 7265 5479 7065 6029 3a0a 2020 2020  tureType`):.    
+00013320: 2020 2020 2020 2020 2020 2020 5461 7267              Targ
+00013330: 6574 2066 6561 7475 7265 2e0a 2020 2020  et feature..    
+00013340: 2020 2020 2020 2020 6e65 775f 6669 6e67          new_fing
+00013350: 6572 7072 696e 7420 2860 7374 7260 2c20  erprint (`str`, 
+00013360: 2a6f 7074 696f 6e61 6c2a 293a 0a20 2020  *optional*):.   
+00013370: 2020 2020 2020 2020 2020 2020 2054 6865               The
+00013380: 206e 6577 2066 696e 6765 7270 7269 6e74   new fingerprint
+00013390: 206f 6620 7468 6520 6461 7461 7365 7420   of the dataset 
+000133a0: 6166 7465 7220 7472 616e 7366 6f72 6d2e  after transform.
+000133b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000133c0: 2049 6620 604e 6f6e 6560 2c20 7468 6520   If `None`, the 
+000133d0: 6e65 7720 6669 6e67 6572 7072 696e 7420  new fingerprint 
+000133e0: 6973 2063 6f6d 7075 7465 6420 7573 696e  is computed usin
+000133f0: 6720 6120 6861 7368 206f 6620 7468 6520  g a hash of the 
+00013400: 7072 6576 696f 7573 2066 696e 6765 7270  previous fingerp
+00013410: 7269 6e74 2c20 616e 6420 7468 6520 7472  rint, and the tr
+00013420: 616e 7366 6f72 6d20 6172 6775 6d65 6e74  ansform argument
+00013430: 732e 0a0a 2020 2020 2020 2020 5265 7475  s...        Retu
+00013440: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
+00013450: 205b 6044 6174 6173 6574 605d 0a0a 2020   [`Dataset`]..  
+00013460: 2020 2020 2020 4578 616d 706c 653a 0a0a        Example:..
+00013470: 2020 2020 2020 2020 6060 6070 790a 2020          ```py.  
+00013480: 2020 2020 2020 3e3e 3e20 6672 6f6d 2064        >>> from d
+00013490: 6174 6173 6574 7320 696d 706f 7274 206c  atasets import l
+000134a0: 6f61 645f 6461 7461 7365 740a 2020 2020  oad_dataset.    
+000134b0: 2020 2020 3e3e 3e20 6473 203d 206c 6f61      >>> ds = loa
+000134c0: 645f 6461 7461 7365 7428 2272 6f74 7465  d_dataset("rotte
+000134d0: 6e5f 746f 6d61 746f 6573 222c 2073 706c  n_tomatoes", spl
+000134e0: 6974 3d22 7661 6c69 6461 7469 6f6e 2229  it="validation")
+000134f0: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
+00013500: 6665 6174 7572 6573 0a20 2020 2020 2020  features.       
+00013510: 207b 276c 6162 656c 273a 2043 6c61 7373   {'label': Class
+00013520: 4c61 6265 6c28 6e75 6d5f 636c 6173 7365  Label(num_classe
+00013530: 733d 322c 206e 616d 6573 3d5b 276e 6567  s=2, names=['neg
+00013540: 272c 2027 706f 7327 5d2c 2069 643d 4e6f  ', 'pos'], id=No
+00013550: 6e65 292c 0a20 2020 2020 2020 2020 2774  ne),.         't
+00013560: 6578 7427 3a20 5661 6c75 6528 6474 7970  ext': Value(dtyp
+00013570: 653d 2773 7472 696e 6727 2c20 6964 3d4e  e='string', id=N
+00013580: 6f6e 6529 7d0a 2020 2020 2020 2020 3e3e  one)}.        >>
+00013590: 3e20 6473 203d 2064 732e 6361 7374 5f63  > ds = ds.cast_c
+000135a0: 6f6c 756d 6e28 276c 6162 656c 272c 2043  olumn('label', C
+000135b0: 6c61 7373 4c61 6265 6c28 6e61 6d65 733d  lassLabel(names=
+000135c0: 5b27 6261 6427 2c20 2767 6f6f 6427 5d29  ['bad', 'good'])
+000135d0: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+000135e0: 2e66 6561 7475 7265 730a 2020 2020 2020  .features.      
+000135f0: 2020 7b27 6c61 6265 6c27 3a20 436c 6173    {'label': Clas
+00013600: 734c 6162 656c 286e 756d 5f63 6c61 7373  sLabel(num_class
+00013610: 6573 3d32 2c20 6e61 6d65 733d 5b27 6261  es=2, names=['ba
+00013620: 6427 2c20 2767 6f6f 6427 5d2c 2069 643d  d', 'good'], id=
+00013630: 4e6f 6e65 292c 0a20 2020 2020 2020 2020  None),.         
+00013640: 2774 6578 7427 3a20 5661 6c75 6528 6474  'text': Value(dt
+00013650: 7970 653d 2773 7472 696e 6727 2c20 6964  ype='string', id
+00013660: 3d4e 6f6e 6529 7d0a 2020 2020 2020 2020  =None)}.        
+00013670: 6060 600a 2020 2020 2020 2020 2222 220a  ```.        """.
+00013680: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+00013690: 7472 2866 6561 7475 7265 2c20 2264 6563  tr(feature, "dec
+000136a0: 6f64 655f 6578 616d 706c 6522 293a 0a20  ode_example"):. 
+000136b0: 2020 2020 2020 2020 2020 2064 6174 6173             datas
+000136c0: 6574 203d 2063 6f70 792e 6465 6570 636f  et = copy.deepco
+000136d0: 7079 2873 656c 6629 0a20 2020 2020 2020  py(self).       
+000136e0: 2020 2020 2064 6174 6173 6574 2e66 6561       dataset.fea
+000136f0: 7475 7265 735b 636f 6c75 6d6e 5d20 3d20  tures[column] = 
+00013700: 6665 6174 7572 650a 2020 2020 2020 2020  feature.        
+00013710: 2020 2020 6461 7461 7365 742e 5f66 696e      dataset._fin
+00013720: 6765 7270 7269 6e74 203d 206e 6577 5f66  gerprint = new_f
+00013730: 696e 6765 7270 7269 6e74 0a20 2020 2020  ingerprint.     
+00013740: 2020 2020 2020 2064 6174 6173 6574 2e5f         dataset._
+00013750: 6461 7461 203d 2064 6174 6173 6574 2e5f  data = dataset._
+00013760: 6461 7461 2e63 6173 7428 6461 7461 7365  data.cast(datase
+00013770: 742e 6665 6174 7572 6573 2e61 7272 6f77  t.features.arrow
+00013780: 5f73 6368 656d 6129 0a20 2020 2020 2020  _schema).       
+00013790: 2020 2020 2064 6174 6173 6574 2e5f 6461       dataset._da
+000137a0: 7461 203d 2075 7064 6174 655f 6d65 7461  ta = update_meta
+000137b0: 6461 7461 5f77 6974 685f 6665 6174 7572  data_with_featur
+000137c0: 6573 2864 6174 6173 6574 2e5f 6461 7461  es(dataset._data
+000137d0: 2c20 6461 7461 7365 742e 6665 6174 7572  , dataset.featur
+000137e0: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+000137f0: 7265 7475 726e 2064 6174 6173 6574 0a20  return dataset. 
+00013800: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00013810: 2020 2020 2020 2020 2066 6561 7475 7265           feature
+00013820: 7320 3d20 7365 6c66 2e66 6561 7475 7265  s = self.feature
+00013830: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
+00013840: 2020 2020 2066 6561 7475 7265 735b 636f       features[co
+00013850: 6c75 6d6e 5d20 3d20 6665 6174 7572 650a  lumn] = feature.
+00013860: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013870: 726e 2073 656c 662e 6361 7374 2866 6561  rn self.cast(fea
+00013880: 7475 7265 7329 0a0a 2020 2020 4074 7261  tures)..    @tra
+00013890: 6e73 6d69 745f 7461 736b 730a 2020 2020  nsmit_tasks.    
+000138a0: 4074 7261 6e73 6d69 745f 666f 726d 6174  @transmit_format
+000138b0: 0a20 2020 2040 6669 6e67 6572 7072 696e  .    @fingerprin
+000138c0: 745f 7472 616e 7366 6f72 6d28 696e 706c  t_transform(inpl
+000138d0: 6163 653d 4661 6c73 6529 0a20 2020 2064  ace=False).    d
+000138e0: 6566 2072 656d 6f76 655f 636f 6c75 6d6e  ef remove_column
+000138f0: 7328 7365 6c66 2c20 636f 6c75 6d6e 5f6e  s(self, column_n
+00013900: 616d 6573 3a20 556e 696f 6e5b 7374 722c  ames: Union[str,
+00013910: 204c 6973 745b 7374 725d 5d2c 206e 6577   List[str]], new
+00013920: 5f66 696e 6765 7270 7269 6e74 3a20 4f70  _fingerprint: Op
+00013930: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+00013940: 6e65 2920 2d3e 2022 4461 7461 7365 7422  ne) -> "Dataset"
+00013950: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00013960: 2020 2020 2020 5265 6d6f 7665 206f 6e65        Remove one
+00013970: 206f 7220 7365 7665 7261 6c20 636f 6c75   or several colu
+00013980: 6d6e 2873 2920 696e 2074 6865 2064 6174  mn(s) in the dat
+00013990: 6173 6574 2061 6e64 2074 6865 2066 6561  aset and the fea
+000139a0: 7475 7265 7320 6173 736f 6369 6174 6564  tures associated
+000139b0: 2074 6f20 7468 656d 2e0a 0a20 2020 2020   to them...     
+000139c0: 2020 2059 6f75 2063 616e 2061 6c73 6f20     You can also 
+000139d0: 7265 6d6f 7665 2061 2063 6f6c 756d 6e20  remove a column 
+000139e0: 7573 696e 6720 5b60 7e64 6174 6173 6574  using [`~dataset
+000139f0: 732e 4461 7461 7365 742e 6d61 7060 5d20  s.Dataset.map`] 
+00013a00: 7769 7468 2060 7265 6d6f 7665 5f63 6f6c  with `remove_col
+00013a10: 756d 6e73 6020 6275 7420 7468 6520 7072  umns` but the pr
+00013a20: 6573 656e 7420 6d65 7468 6f64 0a20 2020  esent method.   
+00013a30: 2020 2020 2069 7320 696e 2d70 6c61 6365       is in-place
+00013a40: 2028 646f 6573 6e27 7420 636f 7079 2074   (doesn't copy t
+00013a50: 6865 2064 6174 6120 746f 2061 206e 6577  he data to a new
+00013a60: 2064 6174 6173 6574 2920 616e 6420 6973   dataset) and is
+00013a70: 2074 6875 7320 6661 7374 6572 2e0a 0a20   thus faster... 
+00013a80: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00013a90: 2020 2020 2020 2020 2063 6f6c 756d 6e5f           column_
+00013aa0: 6e61 6d65 7320 2860 556e 696f 6e5b 7374  names (`Union[st
+00013ab0: 722c 204c 6973 745b 7374 725d 5d60 293a  r, List[str]]`):
+00013ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013ad0: 204e 616d 6520 6f66 2074 6865 2063 6f6c   Name of the col
+00013ae0: 756d 6e28 7329 2074 6f20 7265 6d6f 7665  umn(s) to remove
+00013af0: 2e0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+00013b00: 775f 6669 6e67 6572 7072 696e 7420 2860  w_fingerprint (`
+00013b10: 7374 7260 2c20 2a6f 7074 696f 6e61 6c2a  str`, *optional*
+00013b20: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00013b30: 2020 2054 6865 206e 6577 2066 696e 6765     The new finge
+00013b40: 7270 7269 6e74 206f 6620 7468 6520 6461  rprint of the da
+00013b50: 7461 7365 7420 6166 7465 7220 7472 616e  taset after tran
+00013b60: 7366 6f72 6d2e 0a20 2020 2020 2020 2020  sform..         
+00013b70: 2020 2020 2020 2049 6620 604e 6f6e 6560         If `None`
+00013b80: 2c20 7468 6520 6e65 7720 6669 6e67 6572  , the new finger
+00013b90: 7072 696e 7420 6973 2063 6f6d 7075 7465  print is compute
+00013ba0: 6420 7573 696e 6720 6120 6861 7368 206f  d using a hash o
+00013bb0: 6620 7468 6520 7072 6576 696f 7573 2066  f the previous f
+00013bc0: 696e 6765 7270 7269 6e74 2c20 616e 6420  ingerprint, and 
+00013bd0: 7468 6520 7472 616e 7366 6f72 6d20 6172  the transform ar
+00013be0: 6775 6d65 6e74 732e 0a0a 2020 2020 2020  guments...      
+00013bf0: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+00013c00: 2020 2020 2020 205b 6044 6174 6173 6574         [`Dataset
+00013c10: 605d 3a20 4120 636f 7079 206f 6620 7468  `]: A copy of th
+00013c20: 6520 6461 7461 7365 7420 6f62 6a65 6374  e dataset object
+00013c30: 2077 6974 686f 7574 2074 6865 2063 6f6c   without the col
+00013c40: 756d 6e73 2074 6f20 7265 6d6f 7665 2e0a  umns to remove..
+00013c50: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
+00013c60: 3a0a 0a20 2020 2020 2020 2060 6060 7079  :..        ```py
+00013c70: 0a20 2020 2020 2020 203e 3e3e 2066 726f  .        >>> fro
+00013c80: 6d20 6461 7461 7365 7473 2069 6d70 6f72  m datasets impor
+00013c90: 7420 6c6f 6164 5f64 6174 6173 6574 0a20  t load_dataset. 
+00013ca0: 2020 2020 2020 203e 3e3e 2064 7320 3d20         >>> ds = 
+00013cb0: 6c6f 6164 5f64 6174 6173 6574 2822 726f  load_dataset("ro
+00013cc0: 7474 656e 5f74 6f6d 6174 6f65 7322 2c20  tten_tomatoes", 
+00013cd0: 7370 6c69 743d 2276 616c 6964 6174 696f  split="validatio
+00013ce0: 6e22 290a 2020 2020 2020 2020 3e3e 3e20  n").        >>> 
+00013cf0: 6473 2e72 656d 6f76 655f 636f 6c75 6d6e  ds.remove_column
+00013d00: 7328 276c 6162 656c 2729 0a20 2020 2020  s('label').     
+00013d10: 2020 2044 6174 6173 6574 287b 0a20 2020     Dataset({.   
+00013d20: 2020 2020 2020 2020 2066 6561 7475 7265           feature
+00013d30: 733a 205b 2774 6578 7427 5d2c 0a20 2020  s: ['text'],.   
+00013d40: 2020 2020 2020 2020 206e 756d 5f72 6f77           num_row
+00013d50: 733a 2031 3036 360a 2020 2020 2020 2020  s: 1066.        
+00013d60: 7d29 0a20 2020 2020 2020 203e 3e3e 2064  }).        >>> d
+00013d70: 732e 7265 6d6f 7665 5f63 6f6c 756d 6e73  s.remove_columns
+00013d80: 2863 6f6c 756d 6e5f 6e61 6d65 733d 6473  (column_names=ds
+00013d90: 2e63 6f6c 756d 6e5f 6e61 6d65 7329 2023  .column_names) #
+00013da0: 2052 656d 6f76 696e 6720 616c 6c20 7468   Removing all th
+00013db0: 6520 636f 6c75 6d6e 7320 7265 7475 726e  e columns return
+00013dc0: 7320 616e 2065 6d70 7479 2064 6174 6173  s an empty datas
+00013dd0: 6574 2077 6974 6820 7468 6520 606e 756d  et with the `num
+00013de0: 5f72 6f77 7360 2070 726f 7065 7274 7920  _rows` property 
+00013df0: 7365 7420 746f 2030 0a20 2020 2020 2020  set to 0.       
+00013e00: 2044 6174 6173 6574 287b 0a20 2020 2020   Dataset({.     
+00013e10: 2020 2020 2020 2066 6561 7475 7265 733a         features:
+00013e20: 205b 5d2c 0a20 2020 2020 2020 2020 2020   [],.           
+00013e30: 206e 756d 5f72 6f77 733a 2030 0a20 2020   num_rows: 0.   
+00013e40: 2020 2020 207d 290a 2020 2020 2020 2020       }).        
+00013e50: 6060 600a 2020 2020 2020 2020 2222 220a  ```.        """.
+00013e60: 2020 2020 2020 2020 6461 7461 7365 7420          dataset 
+00013e70: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
+00013e80: 7365 6c66 290a 2020 2020 2020 2020 6966  self).        if
+00013e90: 2069 7369 6e73 7461 6e63 6528 636f 6c75   isinstance(colu
+00013ea0: 6d6e 5f6e 616d 6573 2c20 7374 7229 3a0a  mn_names, str):.
+00013eb0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+00013ec0: 6d6e 5f6e 616d 6573 203d 205b 636f 6c75  mn_names = [colu
+00013ed0: 6d6e 5f6e 616d 6573 5d0a 0a20 2020 2020  mn_names]..     
+00013ee0: 2020 2066 6f72 2063 6f6c 756d 6e5f 6e61     for column_na
+00013ef0: 6d65 2069 6e20 636f 6c75 6d6e 5f6e 616d  me in column_nam
+00013f00: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00013f10: 6966 2063 6f6c 756d 6e5f 6e61 6d65 206e  if column_name n
+00013f20: 6f74 2069 6e20 6461 7461 7365 742e 5f64  ot in dataset._d
+00013f30: 6174 612e 636f 6c75 6d6e 5f6e 616d 6573  ata.column_names
+00013f40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013f50: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00013f60: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00013f70: 2020 2020 2020 2020 6622 436f 6c75 6d6e          f"Column
+00013f80: 206e 616d 6520 7b63 6f6c 756d 6e5f 6e61   name {column_na
+00013f90: 6d65 7d20 6e6f 7420 696e 2074 6865 2064  me} not in the d
+00013fa0: 6174 6173 6574 2e20 220a 2020 2020 2020  ataset. ".      
+00013fb0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00013fc0: 4375 7272 656e 7420 636f 6c75 6d6e 7320  Current columns 
+00013fd0: 696e 2074 6865 2064 6174 6173 6574 3a20  in the dataset: 
+00013fe0: 7b64 6174 6173 6574 2e5f 6461 7461 2e63  {dataset._data.c
+00013ff0: 6f6c 756d 6e5f 6e61 6d65 737d 220a 2020  olumn_names}".  
+00014000: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00014010: 0a20 2020 2020 2020 2066 6f72 2063 6f6c  .        for col
+00014020: 756d 6e5f 6e61 6d65 2069 6e20 636f 6c75  umn_name in colu
+00014030: 6d6e 5f6e 616d 6573 3a0a 2020 2020 2020  mn_names:.      
+00014040: 2020 2020 2020 6465 6c20 6461 7461 7365        del datase
+00014050: 742e 5f69 6e66 6f2e 6665 6174 7572 6573  t._info.features
+00014060: 5b63 6f6c 756d 6e5f 6e61 6d65 5d0a 0a20  [column_name].. 
+00014070: 2020 2020 2020 2064 6174 6173 6574 2e5f         dataset._
+00014080: 6461 7461 203d 2064 6174 6173 6574 2e5f  data = dataset._
+00014090: 6461 7461 2e64 726f 7028 636f 6c75 6d6e  data.drop(column
+000140a0: 5f6e 616d 6573 290a 2020 2020 2020 2020  _names).        
+000140b0: 6461 7461 7365 742e 5f64 6174 6120 3d20  dataset._data = 
+000140c0: 7570 6461 7465 5f6d 6574 6164 6174 615f  update_metadata_
+000140d0: 7769 7468 5f66 6561 7475 7265 7328 6461  with_features(da
+000140e0: 7461 7365 742e 5f64 6174 612c 2064 6174  taset._data, dat
+000140f0: 6173 6574 2e66 6561 7475 7265 7329 0a20  aset.features). 
+00014100: 2020 2020 2020 2064 6174 6173 6574 2e5f         dataset._
+00014110: 6669 6e67 6572 7072 696e 7420 3d20 6e65  fingerprint = ne
+00014120: 775f 6669 6e67 6572 7072 696e 740a 2020  w_fingerprint.  
+00014130: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
+00014140: 6173 6574 0a0a 2020 2020 4074 7261 6e73  aset..    @trans
+00014150: 6d69 745f 7461 736b 730a 2020 2020 4066  mit_tasks.    @f
+00014160: 696e 6765 7270 7269 6e74 5f74 7261 6e73  ingerprint_trans
+00014170: 666f 726d 2869 6e70 6c61 6365 3d46 616c  form(inplace=Fal
+00014180: 7365 290a 2020 2020 6465 6620 7265 6e61  se).    def rena
+00014190: 6d65 5f63 6f6c 756d 6e28 0a20 2020 2020  me_column(.     
+000141a0: 2020 2073 656c 662c 206f 7269 6769 6e61     self, origina
+000141b0: 6c5f 636f 6c75 6d6e 5f6e 616d 653a 2073  l_column_name: s
+000141c0: 7472 2c20 6e65 775f 636f 6c75 6d6e 5f6e  tr, new_column_n
+000141d0: 616d 653a 2073 7472 2c20 6e65 775f 6669  ame: str, new_fi
+000141e0: 6e67 6572 7072 696e 743a 204f 7074 696f  ngerprint: Optio
+000141f0: 6e61 6c5b 7374 725d 203d 204e 6f6e 650a  nal[str] = None.
+00014200: 2020 2020 2920 2d3e 2022 4461 7461 7365      ) -> "Datase
+00014210: 7422 3a0a 2020 2020 2020 2020 2222 220a  t":.        """.
+00014220: 2020 2020 2020 2020 5265 6e61 6d65 2061          Rename a
+00014230: 2063 6f6c 756d 6e20 696e 2074 6865 2064   column in the d
+00014240: 6174 6173 6574 2c20 616e 6420 6d6f 7665  ataset, and move
+00014250: 2074 6865 2066 6561 7475 7265 7320 6173   the features as
+00014260: 736f 6369 6174 6564 2074 6f20 7468 6520  sociated to the 
+00014270: 6f72 6967 696e 616c 2063 6f6c 756d 6e20  original column 
+00014280: 756e 6465 7220 7468 6520 6e65 7720 636f  under the new co
+00014290: 6c75 6d6e 0a20 2020 2020 2020 206e 616d  lumn.        nam
+000142a0: 652e 0a0a 2020 2020 2020 2020 4172 6773  e...        Args
+000142b0: 3a0a 2020 2020 2020 2020 2020 2020 6f72  :.            or
+000142c0: 6967 696e 616c 5f63 6f6c 756d 6e5f 6e61  iginal_column_na
+000142d0: 6d65 2028 6073 7472 6029 3a0a 2020 2020  me (`str`):.    
+000142e0: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
+000142f0: 206f 6620 7468 6520 636f 6c75 6d6e 2074   of the column t
+00014300: 6f20 7265 6e61 6d65 2e0a 2020 2020 2020  o rename..      
+00014310: 2020 2020 2020 6e65 775f 636f 6c75 6d6e        new_column
+00014320: 5f6e 616d 6520 2860 7374 7260 293a 0a20  _name (`str`):. 
+00014330: 2020 2020 2020 2020 2020 2020 2020 204e                 N
+00014340: 6577 206e 616d 6520 666f 7220 7468 6520  ew name for the 
+00014350: 636f 6c75 6d6e 2e0a 2020 2020 2020 2020  column..        
+00014360: 2020 2020 6e65 775f 6669 6e67 6572 7072      new_fingerpr
+00014370: 696e 7420 2860 7374 7260 2c20 2a6f 7074  int (`str`, *opt
+00014380: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
+00014390: 2020 2020 2020 2020 2054 6865 206e 6577           The new
+000143a0: 2066 696e 6765 7270 7269 6e74 206f 6620   fingerprint of 
+000143b0: 7468 6520 6461 7461 7365 7420 6166 7465  the dataset afte
+000143c0: 7220 7472 616e 7366 6f72 6d2e 0a20 2020  r transform..   
+000143d0: 2020 2020 2020 2020 2020 2020 2049 6620               If 
+000143e0: 604e 6f6e 6560 2c20 7468 6520 6e65 7720  `None`, the new 
+000143f0: 6669 6e67 6572 7072 696e 7420 6973 2063  fingerprint is c
+00014400: 6f6d 7075 7465 6420 7573 696e 6720 6120  omputed using a 
+00014410: 6861 7368 206f 6620 7468 6520 7072 6576  hash of the prev
+00014420: 696f 7573 2066 696e 6765 7270 7269 6e74  ious fingerprint
+00014430: 2c20 616e 6420 7468 6520 7472 616e 7366  , and the transf
+00014440: 6f72 6d20 6172 6775 6d65 6e74 732e 0a0a  orm arguments...
+00014450: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
+00014460: 0a20 2020 2020 2020 2020 2020 205b 6044  .            [`D
+00014470: 6174 6173 6574 605d 3a20 4120 636f 7079  ataset`]: A copy
+00014480: 206f 6620 7468 6520 6461 7461 7365 7420   of the dataset 
+00014490: 7769 7468 2061 2072 656e 616d 6564 2063  with a renamed c
+000144a0: 6f6c 756d 6e2e 0a0a 2020 2020 2020 2020  olumn...        
+000144b0: 4578 616d 706c 653a 0a0a 2020 2020 2020  Example:..      
+000144c0: 2020 6060 6070 790a 2020 2020 2020 2020    ```py.        
+000144d0: 3e3e 3e20 6672 6f6d 2064 6174 6173 6574  >>> from dataset
+000144e0: 7320 696d 706f 7274 206c 6f61 645f 6461  s import load_da
+000144f0: 7461 7365 740a 2020 2020 2020 2020 3e3e  taset.        >>
+00014500: 3e20 6473 203d 206c 6f61 645f 6461 7461  > ds = load_data
+00014510: 7365 7428 2272 6f74 7465 6e5f 746f 6d61  set("rotten_toma
+00014520: 746f 6573 222c 2073 706c 6974 3d22 7661  toes", split="va
+00014530: 6c69 6461 7469 6f6e 2229 0a20 2020 2020  lidation").     
+00014540: 2020 203e 3e3e 2064 732e 7265 6e61 6d65     >>> ds.rename
+00014550: 5f63 6f6c 756d 6e28 276c 6162 656c 272c  _column('label',
+00014560: 2027 6c61 6265 6c5f 6e65 7727 290a 2020   'label_new').  
+00014570: 2020 2020 2020 4461 7461 7365 7428 7b0a        Dataset({.
+00014580: 2020 2020 2020 2020 2020 2020 6665 6174              feat
+00014590: 7572 6573 3a20 5b27 7465 7874 272c 2027  ures: ['text', '
+000145a0: 6c61 6265 6c5f 6e65 7727 5d2c 0a20 2020  label_new'],.   
+000145b0: 2020 2020 2020 2020 206e 756d 5f72 6f77           num_row
+000145c0: 733a 2031 3036 360a 2020 2020 2020 2020  s: 1066.        
+000145d0: 7d29 0a20 2020 2020 2020 2060 6060 0a20  }).        ```. 
+000145e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000145f0: 2020 2064 6174 6173 6574 203d 2063 6f70     dataset = cop
+00014600: 792e 6465 6570 636f 7079 2873 656c 6629  y.deepcopy(self)
+00014610: 0a20 2020 2020 2020 2069 6620 6f72 6967  .        if orig
+00014620: 696e 616c 5f63 6f6c 756d 6e5f 6e61 6d65  inal_column_name
+00014630: 206e 6f74 2069 6e20 6461 7461 7365 742e   not in dataset.
+00014640: 5f64 6174 612e 636f 6c75 6d6e 5f6e 616d  _data.column_nam
+00014650: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00014660: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00014670: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00014680: 2020 6622 4f72 6967 696e 616c 2063 6f6c    f"Original col
+00014690: 756d 6e20 6e61 6d65 207b 6f72 6967 696e  umn name {origin
+000146a0: 616c 5f63 6f6c 756d 6e5f 6e61 6d65 7d20  al_column_name} 
+000146b0: 6e6f 7420 696e 2074 6865 2064 6174 6173  not in the datas
+000146c0: 6574 2e20 220a 2020 2020 2020 2020 2020  et. ".          
+000146d0: 2020 2020 2020 6622 4375 7272 656e 7420        f"Current 
+000146e0: 636f 6c75 6d6e 7320 696e 2074 6865 2064  columns in the d
+000146f0: 6174 6173 6574 3a20 7b64 6174 6173 6574  ataset: {dataset
+00014700: 2e5f 6461 7461 2e63 6f6c 756d 6e5f 6e61  ._data.column_na
+00014710: 6d65 737d 220a 2020 2020 2020 2020 2020  mes}".          
+00014720: 2020 290a 2020 2020 2020 2020 6966 206e    ).        if n
+00014730: 6577 5f63 6f6c 756d 6e5f 6e61 6d65 2069  ew_column_name i
+00014740: 6e20 6461 7461 7365 742e 5f64 6174 612e  n dataset._data.
+00014750: 636f 6c75 6d6e 5f6e 616d 6573 3a0a 2020  column_names:.  
+00014760: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00014770: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00014780: 2020 2020 2020 2020 2020 2020 6622 4e65              f"Ne
+00014790: 7720 636f 6c75 6d6e 206e 616d 6520 7b6e  w column name {n
+000147a0: 6577 5f63 6f6c 756d 6e5f 6e61 6d65 7d20  ew_column_name} 
+000147b0: 616c 7265 6164 7920 696e 2074 6865 2064  already in the d
+000147c0: 6174 6173 6574 2e20 220a 2020 2020 2020  ataset. ".      
+000147d0: 2020 2020 2020 2020 2020 6622 506c 6561            f"Plea
+000147e0: 7365 2063 686f 6f73 6520 6120 636f 6c75  se choose a colu
+000147f0: 6d6e 206e 616d 6520 7768 6963 6820 6973  mn name which is
+00014800: 206e 6f74 2061 6c72 6561 6479 2069 6e20   not already in 
+00014810: 7468 6520 6461 7461 7365 742e 2022 0a20  the dataset. ". 
+00014820: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00014830: 2243 7572 7265 6e74 2063 6f6c 756d 6e73  "Current columns
+00014840: 2069 6e20 7468 6520 6461 7461 7365 743a   in the dataset:
+00014850: 207b 6461 7461 7365 742e 5f64 6174 612e   {dataset._data.
+00014860: 636f 6c75 6d6e 5f6e 616d 6573 7d22 0a20  column_names}". 
+00014870: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00014880: 2020 2020 2069 6620 6e6f 7420 6e65 775f       if not new_
+00014890: 636f 6c75 6d6e 5f6e 616d 653a 0a20 2020  column_name:.   
+000148a0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000148b0: 616c 7565 4572 726f 7228 224e 6577 2063  alueError("New c
+000148c0: 6f6c 756d 6e20 6e61 6d65 2069 7320 656d  olumn name is em
+000148d0: 7074 792e 2229 0a0a 2020 2020 2020 2020  pty.")..        
+000148e0: 6465 6620 7265 6e61 6d65 2863 6f6c 756d  def rename(colum
+000148f0: 6e73 293a 0a20 2020 2020 2020 2020 2020  ns):.           
+00014900: 2072 6574 7572 6e20 5b6e 6577 5f63 6f6c   return [new_col
+00014910: 756d 6e5f 6e61 6d65 2069 6620 636f 6c20  umn_name if col 
+00014920: 3d3d 206f 7269 6769 6e61 6c5f 636f 6c75  == original_colu
+00014930: 6d6e 5f6e 616d 6520 656c 7365 2063 6f6c  mn_name else col
+00014940: 2066 6f72 2063 6f6c 2069 6e20 636f 6c75   for col in colu
+00014950: 6d6e 735d 0a0a 2020 2020 2020 2020 6e65  mns]..        ne
+00014960: 775f 636f 6c75 6d6e 5f6e 616d 6573 203d  w_column_names =
+00014970: 2072 656e 616d 6528 7365 6c66 2e5f 6461   rename(self._da
+00014980: 7461 2e63 6f6c 756d 6e5f 6e61 6d65 7329  ta.column_names)
+00014990: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000149a0: 2e5f 666f 726d 6174 5f63 6f6c 756d 6e73  ._format_columns
+000149b0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000149c0: 2020 2020 2020 2020 2020 6461 7461 7365            datase
+000149d0: 742e 5f66 6f72 6d61 745f 636f 6c75 6d6e  t._format_column
+000149e0: 7320 3d20 7265 6e61 6d65 2873 656c 662e  s = rename(self.
+000149f0: 5f66 6f72 6d61 745f 636f 6c75 6d6e 7329  _format_columns)
+00014a00: 0a0a 2020 2020 2020 2020 6461 7461 7365  ..        datase
+00014a10: 742e 5f69 6e66 6f2e 6665 6174 7572 6573  t._info.features
+00014a20: 203d 2046 6561 7475 7265 7328 0a20 2020   = Features(.   
+00014a30: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
+00014a40: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
+00014a50: 6f6c 756d 6e5f 6e61 6d65 2069 6620 636f  olumn_name if co
+00014a60: 6c20 3d3d 206f 7269 6769 6e61 6c5f 636f  l == original_co
+00014a70: 6c75 6d6e 5f6e 616d 6520 656c 7365 2063  lumn_name else c
+00014a80: 6f6c 3a20 6665 6174 7572 650a 2020 2020  ol: feature.    
+00014a90: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00014aa0: 636f 6c2c 2066 6561 7475 7265 2069 6e20  col, feature in 
+00014ab0: 7365 6c66 2e5f 696e 666f 2e66 6561 7475  self._info.featu
+00014ac0: 7265 732e 6974 656d 7328 290a 2020 2020  res.items().    
+00014ad0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00014ae0: 2020 290a 0a20 2020 2020 2020 2064 6174    )..        dat
+00014af0: 6173 6574 2e5f 6461 7461 203d 2064 6174  aset._data = dat
+00014b00: 6173 6574 2e5f 6461 7461 2e72 656e 616d  aset._data.renam
+00014b10: 655f 636f 6c75 6d6e 7328 6e65 775f 636f  e_columns(new_co
+00014b20: 6c75 6d6e 5f6e 616d 6573 290a 2020 2020  lumn_names).    
+00014b30: 2020 2020 6461 7461 7365 742e 5f64 6174      dataset._dat
+00014b40: 6120 3d20 7570 6461 7465 5f6d 6574 6164  a = update_metad
+00014b50: 6174 615f 7769 7468 5f66 6561 7475 7265  ata_with_feature
+00014b60: 7328 6461 7461 7365 742e 5f64 6174 612c  s(dataset._data,
+00014b70: 2064 6174 6173 6574 2e66 6561 7475 7265   dataset.feature
+00014b80: 7329 0a20 2020 2020 2020 2064 6174 6173  s).        datas
+00014b90: 6574 2e5f 6669 6e67 6572 7072 696e 7420  et._fingerprint 
+00014ba0: 3d20 6e65 775f 6669 6e67 6572 7072 696e  = new_fingerprin
+00014bb0: 740a 2020 2020 2020 2020 7265 7475 726e  t.        return
+00014bc0: 2064 6174 6173 6574 0a0a 2020 2020 4074   dataset..    @t
+00014bd0: 7261 6e73 6d69 745f 7461 736b 730a 2020  ransmit_tasks.  
+00014be0: 2020 4066 696e 6765 7270 7269 6e74 5f74    @fingerprint_t
+00014bf0: 7261 6e73 666f 726d 2869 6e70 6c61 6365  ransform(inplace
+00014c00: 3d46 616c 7365 290a 2020 2020 6465 6620  =False).    def 
+00014c10: 7265 6e61 6d65 5f63 6f6c 756d 6e73 2873  rename_columns(s
+00014c20: 656c 662c 2063 6f6c 756d 6e5f 6d61 7070  elf, column_mapp
+00014c30: 696e 673a 2044 6963 745b 7374 722c 2073  ing: Dict[str, s
+00014c40: 7472 5d2c 206e 6577 5f66 696e 6765 7270  tr], new_fingerp
+00014c50: 7269 6e74 3a20 4f70 7469 6f6e 616c 5b73  rint: Optional[s
+00014c60: 7472 5d20 3d20 4e6f 6e65 2920 2d3e 2022  tr] = None) -> "
+00014c70: 4461 7461 7365 7422 3a0a 2020 2020 2020  Dataset":.      
+00014c80: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+00014c90: 6e61 6d65 2073 6576 6572 616c 2063 6f6c  name several col
+00014ca0: 756d 6e73 2069 6e20 7468 6520 6461 7461  umns in the data
+00014cb0: 7365 742c 2061 6e64 206d 6f76 6520 7468  set, and move th
+00014cc0: 6520 6665 6174 7572 6573 2061 7373 6f63  e features assoc
+00014cd0: 6961 7465 6420 746f 2074 6865 206f 7269  iated to the ori
+00014ce0: 6769 6e61 6c20 636f 6c75 6d6e 7320 756e  ginal columns un
+00014cf0: 6465 720a 2020 2020 2020 2020 7468 6520  der.        the 
+00014d00: 6e65 7720 636f 6c75 6d6e 206e 616d 6573  new column names
+00014d10: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00014d20: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+00014d30: 756d 6e5f 6d61 7070 696e 6720 2860 4469  umn_mapping (`Di
+00014d40: 6374 5b73 7472 2c20 7374 725d 6029 3a0a  ct[str, str]`):.
+00014d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d60: 4120 6d61 7070 696e 6720 6f66 2063 6f6c  A mapping of col
+00014d70: 756d 6e73 2074 6f20 7265 6e61 6d65 2074  umns to rename t
+00014d80: 6f20 7468 6569 7220 6e65 7720 6e61 6d65  o their new name
+00014d90: 730a 2020 2020 2020 2020 2020 2020 6e65  s.            ne
+00014da0: 775f 6669 6e67 6572 7072 696e 7420 2860  w_fingerprint (`
+00014db0: 7374 7260 2c20 2a6f 7074 696f 6e61 6c2a  str`, *optional*
+00014dc0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00014dd0: 2020 2054 6865 206e 6577 2066 696e 6765     The new finge
+00014de0: 7270 7269 6e74 206f 6620 7468 6520 6461  rprint of the da
+00014df0: 7461 7365 7420 6166 7465 7220 7472 616e  taset after tran
+00014e00: 7366 6f72 6d2e 0a20 2020 2020 2020 2020  sform..         
+00014e10: 2020 2020 2020 2049 6620 604e 6f6e 6560         If `None`
+00014e20: 2c20 7468 6520 6e65 7720 6669 6e67 6572  , the new finger
+00014e30: 7072 696e 7420 6973 2063 6f6d 7075 7465  print is compute
+00014e40: 6420 7573 696e 6720 6120 6861 7368 206f  d using a hash o
+00014e50: 6620 7468 6520 7072 6576 696f 7573 2066  f the previous f
+00014e60: 696e 6765 7270 7269 6e74 2c20 616e 6420  ingerprint, and 
+00014e70: 7468 6520 7472 616e 7366 6f72 6d20 6172  the transform ar
+00014e80: 6775 6d65 6e74 732e 0a0a 2020 2020 2020  guments...      
+00014e90: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+00014ea0: 2020 2020 2020 205b 6044 6174 6173 6574         [`Dataset
+00014eb0: 605d 3a20 4120 636f 7079 206f 6620 7468  `]: A copy of th
+00014ec0: 6520 6461 7461 7365 7420 7769 7468 2072  e dataset with r
+00014ed0: 656e 616d 6564 2063 6f6c 756d 6e73 0a0a  enamed columns..
+00014ee0: 2020 2020 2020 2020 4578 616d 706c 653a          Example:
+00014ef0: 0a0a 2020 2020 2020 2020 6060 6070 790a  ..        ```py.
+00014f00: 2020 2020 2020 2020 3e3e 3e20 6672 6f6d          >>> from
+00014f10: 2064 6174 6173 6574 7320 696d 706f 7274   datasets import
+00014f20: 206c 6f61 645f 6461 7461 7365 740a 2020   load_dataset.  
+00014f30: 2020 2020 2020 3e3e 3e20 6473 203d 206c        >>> ds = l
+00014f40: 6f61 645f 6461 7461 7365 7428 2272 6f74  oad_dataset("rot
+00014f50: 7465 6e5f 746f 6d61 746f 6573 222c 2073  ten_tomatoes", s
+00014f60: 706c 6974 3d22 7661 6c69 6461 7469 6f6e  plit="validation
+00014f70: 2229 0a20 2020 2020 2020 203e 3e3e 2064  ").        >>> d
+00014f80: 732e 7265 6e61 6d65 5f63 6f6c 756d 6e73  s.rename_columns
+00014f90: 287b 2774 6578 7427 3a20 2774 6578 745f  ({'text': 'text_
+00014fa0: 6e65 7727 2c20 276c 6162 656c 273a 2027  new', 'label': '
+00014fb0: 6c61 6265 6c5f 6e65 7727 7d29 0a20 2020  label_new'}).   
+00014fc0: 2020 2020 2044 6174 6173 6574 287b 0a20       Dataset({. 
+00014fd0: 2020 2020 2020 2020 2020 2066 6561 7475             featu
+00014fe0: 7265 733a 205b 2774 6578 745f 6e65 7727  res: ['text_new'
+00014ff0: 2c20 276c 6162 656c 5f6e 6577 275d 2c0a  , 'label_new'],.
+00015000: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+00015010: 726f 7773 3a20 3130 3636 0a20 2020 2020  rows: 1066.     
+00015020: 2020 207d 290a 2020 2020 2020 2020 6060     }).        ``
+00015030: 600a 2020 2020 2020 2020 2222 220a 2020  `.        """.  
+00015040: 2020 2020 2020 6461 7461 7365 7420 3d20        dataset = 
+00015050: 636f 7079 2e64 6565 7063 6f70 7928 7365  copy.deepcopy(se
+00015060: 6c66 290a 0a20 2020 2020 2020 2065 7874  lf)..        ext
+00015070: 7261 5f63 6f6c 756d 6e73 203d 2073 6574  ra_columns = set
+00015080: 2863 6f6c 756d 6e5f 6d61 7070 696e 672e  (column_mapping.
+00015090: 6b65 7973 2829 2920 2d20 7365 7428 6461  keys()) - set(da
+000150a0: 7461 7365 742e 636f 6c75 6d6e 5f6e 616d  taset.column_nam
+000150b0: 6573 290a 2020 2020 2020 2020 6966 2065  es).        if e
+000150c0: 7874 7261 5f63 6f6c 756d 6e73 3a0a 2020  xtra_columns:.  
+000150d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000150e0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+000150f0: 2020 2020 2020 2020 2020 2020 6622 4f72              f"Or
+00015100: 6967 696e 616c 2063 6f6c 756d 6e20 6e61  iginal column na
+00015110: 6d65 7320 7b65 7874 7261 5f63 6f6c 756d  mes {extra_colum
+00015120: 6e73 7d20 6e6f 7420 696e 2074 6865 2064  ns} not in the d
+00015130: 6174 6173 6574 2e20 220a 2020 2020 2020  ataset. ".      
+00015140: 2020 2020 2020 2020 2020 6622 4375 7272            f"Curr
+00015150: 656e 7420 636f 6c75 6d6e 7320 696e 2074  ent columns in t
+00015160: 6865 2064 6174 6173 6574 3a20 7b64 6174  he dataset: {dat
+00015170: 6173 6574 2e5f 6461 7461 2e63 6f6c 756d  aset._data.colum
+00015180: 6e5f 6e61 6d65 737d 220a 2020 2020 2020  n_names}".      
+00015190: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000151a0: 206e 756d 6265 725f 6f66 5f64 7570 6c69   number_of_dupli
+000151b0: 6361 7465 735f 696e 5f6e 6577 5f63 6f6c  cates_in_new_col
+000151c0: 756d 6e73 203d 206c 656e 2863 6f6c 756d  umns = len(colum
+000151d0: 6e5f 6d61 7070 696e 672e 7661 6c75 6573  n_mapping.values
+000151e0: 2829 2920 2d20 6c65 6e28 7365 7428 636f  ()) - len(set(co
+000151f0: 6c75 6d6e 5f6d 6170 7069 6e67 2e76 616c  lumn_mapping.val
+00015200: 7565 7328 2929 290a 2020 2020 2020 2020  ues())).        
+00015210: 6966 206e 756d 6265 725f 6f66 5f64 7570  if number_of_dup
+00015220: 6c69 6361 7465 735f 696e 5f6e 6577 5f63  licates_in_new_c
+00015230: 6f6c 756d 6e73 2021 3d20 303a 0a20 2020  olumns != 0:.   
+00015240: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00015250: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00015260: 2020 2020 2020 2020 2020 2022 4e65 7720             "New 
+00015270: 636f 6c75 6d6e 206e 616d 6573 206d 7573  column names mus
+00015280: 7420 616c 6c20 6265 2064 6966 6665 7265  t all be differe
+00015290: 6e74 2c20 6275 7420 7468 6973 2063 6f6c  nt, but this col
+000152a0: 756d 6e20 6d61 7070 696e 6720 220a 2020  umn mapping ".  
+000152b0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+000152c0: 6861 7320 7b6e 756d 6265 725f 6f66 5f64  has {number_of_d
+000152d0: 7570 6c69 6361 7465 735f 696e 5f6e 6577  uplicates_in_new
+000152e0: 5f63 6f6c 756d 6e73 7d20 6475 706c 6963  _columns} duplic
+000152f0: 6174 6573 220a 2020 2020 2020 2020 2020  ates".          
+00015300: 2020 290a 0a20 2020 2020 2020 2065 6d70    )..        emp
+00015310: 7479 5f6e 6577 5f63 6f6c 756d 6e73 203d  ty_new_columns =
+00015320: 205b 6e65 775f 636f 6c20 666f 7220 6e65   [new_col for ne
+00015330: 775f 636f 6c20 696e 2063 6f6c 756d 6e5f  w_col in column_
+00015340: 6d61 7070 696e 672e 7661 6c75 6573 2829  mapping.values()
+00015350: 2069 6620 6e6f 7420 6e65 775f 636f 6c5d   if not new_col]
+00015360: 0a20 2020 2020 2020 2069 6620 656d 7074  .        if empt
+00015370: 795f 6e65 775f 636f 6c75 6d6e 733a 0a20  y_new_columns:. 
+00015380: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00015390: 2056 616c 7565 4572 726f 7228 6622 4e65   ValueError(f"Ne
+000153a0: 7720 636f 6c75 6d6e 206e 616d 6573 207b  w column names {
+000153b0: 656d 7074 795f 6e65 775f 636f 6c75 6d6e  empty_new_column
+000153c0: 737d 2061 7265 2065 6d70 7479 2e22 290a  s} are empty.").
+000153d0: 0a20 2020 2020 2020 2064 6566 2072 656e  .        def ren
+000153e0: 616d 6528 636f 6c75 6d6e 7329 3a0a 2020  ame(columns):.  
+000153f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00015400: 205b 636f 6c75 6d6e 5f6d 6170 7069 6e67   [column_mapping
+00015410: 5b63 6f6c 5d20 6966 2063 6f6c 2069 6e20  [col] if col in 
+00015420: 636f 6c75 6d6e 5f6d 6170 7069 6e67 2065  column_mapping e
+00015430: 6c73 6520 636f 6c20 666f 7220 636f 6c20  lse col for col 
+00015440: 696e 2063 6f6c 756d 6e73 5d0a 0a20 2020  in columns]..   
+00015450: 2020 2020 206e 6577 5f63 6f6c 756d 6e5f       new_column_
+00015460: 6e61 6d65 7320 3d20 7265 6e61 6d65 2873  names = rename(s
+00015470: 656c 662e 5f64 6174 612e 636f 6c75 6d6e  elf._data.column
+00015480: 5f6e 616d 6573 290a 2020 2020 2020 2020  _names).        
+00015490: 6966 2073 656c 662e 5f66 6f72 6d61 745f  if self._format_
+000154a0: 636f 6c75 6d6e 7320 6973 206e 6f74 204e  columns is not N
+000154b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000154c0: 2064 6174 6173 6574 2e5f 666f 726d 6174   dataset._format
+000154d0: 5f63 6f6c 756d 6e73 203d 2072 656e 616d  _columns = renam
+000154e0: 6528 7365 6c66 2e5f 666f 726d 6174 5f63  e(self._format_c
+000154f0: 6f6c 756d 6e73 290a 0a20 2020 2020 2020  olumns)..       
+00015500: 2064 6174 6173 6574 2e5f 696e 666f 2e66   dataset._info.f
+00015510: 6561 7475 7265 7320 3d20 4665 6174 7572  eatures = Featur
+00015520: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+00015530: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00015540: 2020 636f 6c75 6d6e 5f6d 6170 7069 6e67    column_mapping
+00015550: 5b63 6f6c 5d20 6966 2063 6f6c 2069 6e20  [col] if col in 
+00015560: 636f 6c75 6d6e 5f6d 6170 7069 6e67 2065  column_mapping e
+00015570: 6c73 6520 636f 6c3a 2066 6561 7475 7265  lse col: feature
+00015580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015590: 2066 6f72 2063 6f6c 2c20 6665 6174 7572   for col, featur
+000155a0: 6520 696e 2028 7365 6c66 2e5f 696e 666f  e in (self._info
+000155b0: 2e66 6561 7475 7265 7320 6f72 207b 7d29  .features or {})
+000155c0: 2e69 7465 6d73 2829 0a20 2020 2020 2020  .items().       
+000155d0: 2020 2020 207d 0a20 2020 2020 2020 2029       }.        )
+000155e0: 0a0a 2020 2020 2020 2020 6461 7461 7365  ..        datase
+000155f0: 742e 5f64 6174 6120 3d20 6461 7461 7365  t._data = datase
+00015600: 742e 5f64 6174 612e 7265 6e61 6d65 5f63  t._data.rename_c
+00015610: 6f6c 756d 6e73 286e 6577 5f63 6f6c 756d  olumns(new_colum
+00015620: 6e5f 6e61 6d65 7329 0a20 2020 2020 2020  n_names).       
+00015630: 2064 6174 6173 6574 2e5f 6461 7461 203d   dataset._data =
+00015640: 2075 7064 6174 655f 6d65 7461 6461 7461   update_metadata
+00015650: 5f77 6974 685f 6665 6174 7572 6573 2864  _with_features(d
+00015660: 6174 6173 6574 2e5f 6461 7461 2c20 6461  ataset._data, da
+00015670: 7461 7365 742e 6665 6174 7572 6573 290a  taset.features).
+00015680: 2020 2020 2020 2020 6461 7461 7365 742e          dataset.
+00015690: 5f66 696e 6765 7270 7269 6e74 203d 206e  _fingerprint = n
+000156a0: 6577 5f66 696e 6765 7270 7269 6e74 0a20  ew_fingerprint. 
+000156b0: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
+000156c0: 7461 7365 740a 0a20 2020 2064 6566 205f  taset..    def _
+000156d0: 5f6c 656e 5f5f 2873 656c 6629 3a0a 2020  _len__(self):.  
+000156e0: 2020 2020 2020 2222 224e 756d 6265 7220        """Number 
+000156f0: 6f66 2072 6f77 7320 696e 2074 6865 2064  of rows in the d
+00015700: 6174 6173 6574 2e0a 0a20 2020 2020 2020  ataset...       
+00015710: 2045 7861 6d70 6c65 3a0a 0a20 2020 2020   Example:..     
+00015720: 2020 2060 6060 7079 0a20 2020 2020 2020     ```py.       
+00015730: 203e 3e3e 2066 726f 6d20 6461 7461 7365   >>> from datase
+00015740: 7473 2069 6d70 6f72 7420 6c6f 6164 5f64  ts import load_d
+00015750: 6174 6173 6574 0a20 2020 2020 2020 203e  ataset.        >
+00015760: 3e3e 2064 7320 3d20 6c6f 6164 5f64 6174  >> ds = load_dat
+00015770: 6173 6574 2822 726f 7474 656e 5f74 6f6d  aset("rotten_tom
+00015780: 6174 6f65 7322 2c20 7370 6c69 743d 2276  atoes", split="v
+00015790: 616c 6964 6174 696f 6e22 290a 2020 2020  alidation").    
+000157a0: 2020 2020 3e3e 3e20 6473 2e5f 5f6c 656e      >>> ds.__len
+000157b0: 5f5f 0a20 2020 2020 2020 203c 626f 756e  __.        <boun
+000157c0: 6420 6d65 7468 6f64 2044 6174 6173 6574  d method Dataset
+000157d0: 2e5f 5f6c 656e 5f5f 206f 6620 4461 7461  .__len__ of Data
+000157e0: 7365 7428 7b0a 2020 2020 2020 2020 2020  set({.          
+000157f0: 2020 6665 6174 7572 6573 3a20 5b27 7465    features: ['te
+00015800: 7874 272c 2027 6c61 6265 6c27 5d2c 0a20  xt', 'label'],. 
+00015810: 2020 2020 2020 2020 2020 206e 756d 5f72             num_r
+00015820: 6f77 733a 2031 3036 360a 2020 2020 2020  ows: 1066.      
+00015830: 2020 7d29 3e0a 2020 2020 2020 2020 6060    })>.        ``
+00015840: 600a 2020 2020 2020 2020 2222 220a 2020  `.        """.  
+00015850: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00015860: 662e 6e75 6d5f 726f 7773 0a0a 2020 2020  f.num_rows..    
+00015870: 6465 6620 5f5f 6974 6572 5f5f 2873 656c  def __iter__(sel
+00015880: 6629 3a0a 2020 2020 2020 2020 2222 2249  f):.        """I
+00015890: 7465 7261 7465 2074 6872 6f75 6768 2074  terate through t
+000158a0: 6865 2065 7861 6d70 6c65 732e 0a0a 2020  he examples...  
+000158b0: 2020 2020 2020 4966 2061 2066 6f72 6d61        If a forma
+000158c0: 7474 696e 6720 6973 2073 6574 2077 6974  tting is set wit
+000158d0: 6820 3a6d 6574 683a 6044 6174 6173 6574  h :meth:`Dataset
+000158e0: 2e73 6574 5f66 6f72 6d61 7460 2072 6f77  .set_format` row
+000158f0: 7320 7769 6c6c 2062 6520 7265 7475 726e  s will be return
+00015900: 6564 2077 6974 6820 7468 650a 2020 2020  ed with the.    
+00015910: 2020 2020 7365 6c65 6374 6564 2066 6f72      selected for
+00015920: 6d61 742e 0a20 2020 2020 2020 2022 2222  mat..        """
+00015930: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00015940: 2e5f 696e 6469 6365 7320 6973 204e 6f6e  ._indices is Non
+00015950: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+00015960: 2046 6173 7420 6974 6572 6174 696f 6e0a   Fast iteration.
+00015970: 2020 2020 2020 2020 2020 2020 2320 4265              # Be
+00015980: 6e63 686d 6172 6b3a 2068 7474 7073 3a2f  nchmark: https:/
+00015990: 2f67 6973 742e 6769 7468 7562 2e63 6f6d  /gist.github.com
+000159a0: 2f6d 6172 696f 7361 736b 6f2f 3032 3438  /mariosasko/0248
+000159b0: 3238 3861 3265 3361 3735 3536 3837 3339  288a2e3a75568739
+000159c0: 3639 3731 3763 3166 6535 3262 2028 6661  69717c1fe52b (fa
+000159d0: 7374 5f69 7465 725f 6261 7463 6829 0a20  st_iter_batch). 
+000159e0: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
+000159f0: 745f 6b77 6172 6773 203d 2073 656c 662e  t_kwargs = self.
+00015a00: 5f66 6f72 6d61 745f 6b77 6172 6773 2069  _format_kwargs i
+00015a10: 6620 7365 6c66 2e5f 666f 726d 6174 5f6b  f self._format_k
+00015a20: 7761 7267 7320 6973 206e 6f74 204e 6f6e  wargs is not Non
+00015a30: 6520 656c 7365 207b 7d0a 2020 2020 2020  e else {}.      
+00015a40: 2020 2020 2020 666f 726d 6174 7465 7220        formatter 
+00015a50: 3d20 6765 745f 666f 726d 6174 7465 7228  = get_formatter(
+00015a60: 7365 6c66 2e5f 666f 726d 6174 5f74 7970  self._format_typ
+00015a70: 652c 2066 6561 7475 7265 733d 7365 6c66  e, features=self
+00015a80: 2e66 6561 7475 7265 732c 202a 2a66 6f72  .features, **for
+00015a90: 6d61 745f 6b77 6172 6773 290a 2020 2020  mat_kwargs).    
+00015aa0: 2020 2020 2020 2020 6261 7463 685f 7369          batch_si
+00015ab0: 7a65 203d 2063 6f6e 6669 672e 4152 524f  ze = config.ARRO
+00015ac0: 575f 5245 4144 4552 5f42 4154 4348 5f53  W_READER_BATCH_S
+00015ad0: 495a 455f 494e 5f44 4154 4153 4554 5f49  IZE_IN_DATASET_I
+00015ae0: 5445 520a 2020 2020 2020 2020 2020 2020  TER.            
+00015af0: 666f 7220 7061 5f73 7562 7461 626c 6520  for pa_subtable 
+00015b00: 696e 2074 6162 6c65 5f69 7465 7228 7365  in table_iter(se
+00015b10: 6c66 2e64 6174 612c 2062 6174 6368 5f73  lf.data, batch_s
+00015b20: 697a 653d 6261 7463 685f 7369 7a65 293a  ize=batch_size):
+00015b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015b40: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00015b50: 7061 5f73 7562 7461 626c 652e 6e75 6d5f  pa_subtable.num_
+00015b60: 726f 7773 293a 0a20 2020 2020 2020 2020  rows):.         
+00015b70: 2020 2020 2020 2020 2020 2070 615f 7375             pa_su
+00015b80: 6274 6162 6c65 5f65 7820 3d20 7061 5f73  btable_ex = pa_s
+00015b90: 7562 7461 626c 652e 736c 6963 6528 692c  ubtable.slice(i,
+00015ba0: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
+00015bb0: 2020 2020 2020 2020 666f 726d 6174 7465          formatte
+00015bc0: 645f 6f75 7470 7574 203d 2066 6f72 6d61  d_output = forma
+00015bd0: 745f 7461 626c 6528 0a20 2020 2020 2020  t_table(.       
+00015be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015bf0: 2070 615f 7375 6274 6162 6c65 5f65 782c   pa_subtable_ex,
+00015c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015c10: 2020 2020 2020 2020 2030 2c0a 2020 2020           0,.    
+00015c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c30: 2020 2020 666f 726d 6174 7465 723d 666f      formatter=fo
+00015c40: 726d 6174 7465 722c 0a20 2020 2020 2020  rmatter,.       
+00015c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c60: 2066 6f72 6d61 745f 636f 6c75 6d6e 733d   format_columns=
+00015c70: 7365 6c66 2e5f 666f 726d 6174 5f63 6f6c  self._format_col
+00015c80: 756d 6e73 2c0a 2020 2020 2020 2020 2020  umns,.          
+00015c90: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+00015ca0: 7470 7574 5f61 6c6c 5f63 6f6c 756d 6e73  tput_all_columns
+00015cb0: 3d73 656c 662e 5f6f 7574 7075 745f 616c  =self._output_al
+00015cc0: 6c5f 636f 6c75 6d6e 732c 0a20 2020 2020  l_columns,.     
+00015cd0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00015ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015cf0: 2020 2020 2079 6965 6c64 2066 6f72 6d61       yield forma
+00015d00: 7474 6564 5f6f 7574 7075 740a 2020 2020  tted_output.    
+00015d10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00015d20: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00015d30: 616e 6765 2873 656c 662e 6e75 6d5f 726f  ange(self.num_ro
+00015d40: 7773 293a 0a20 2020 2020 2020 2020 2020  ws):.           
+00015d50: 2020 2020 2079 6965 6c64 2073 656c 662e       yield self.
+00015d60: 5f67 6574 6974 656d 280a 2020 2020 2020  _getitem(.      
+00015d70: 2020 2020 2020 2020 2020 2020 2020 692c                i,
+00015d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015d90: 2029 0a0a 2020 2020 6465 6620 6974 6572   )..    def iter
+00015da0: 2873 656c 662c 2062 6174 6368 5f73 697a  (self, batch_siz
+00015db0: 653a 2069 6e74 2c20 6472 6f70 5f6c 6173  e: int, drop_las
+00015dc0: 745f 6261 7463 683a 2062 6f6f 6c20 3d20  t_batch: bool = 
+00015dd0: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+00015de0: 2222 2249 7465 7261 7465 2074 6872 6f75  """Iterate throu
+00015df0: 6768 2074 6865 2062 6174 6368 6573 206f  gh the batches o
+00015e00: 6620 7369 7a65 2060 6261 7463 685f 7369  f size `batch_si
+00015e10: 7a65 602e 0a0a 2020 2020 2020 2020 4966  ze`...        If
+00015e20: 2061 2066 6f72 6d61 7474 696e 6720 6973   a formatting is
+00015e30: 2073 6574 2077 6974 6820 5b60 7e64 6174   set with [`~dat
+00015e40: 6173 6574 732e 4461 7461 7365 742e 7365  asets.Dataset.se
+00015e50: 745f 666f 726d 6174 605d 2072 6f77 7320  t_format`] rows 
+00015e60: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
+00015e70: 2077 6974 6820 7468 650a 2020 2020 2020   with the.      
+00015e80: 2020 7365 6c65 6374 6564 2066 6f72 6d61    selected forma
+00015e90: 742e 0a0a 2020 2020 2020 2020 4172 6773  t...        Args
+00015ea0: 3a0a 2020 2020 2020 2020 2020 2020 6261  :.            ba
+00015eb0: 7463 685f 7369 7a65 2028 3a6f 626a 3a60  tch_size (:obj:`
+00015ec0: 696e 7460 293a 2073 697a 6520 6f66 2065  int`): size of e
+00015ed0: 6163 6820 6261 7463 6820 746f 2079 6965  ach batch to yie
+00015ee0: 6c64 2e0a 2020 2020 2020 2020 2020 2020  ld..            
+00015ef0: 6472 6f70 5f6c 6173 745f 6261 7463 6820  drop_last_batch 
+00015f00: 283a 6f62 6a3a 6062 6f6f 6c60 2c20 6465  (:obj:`bool`, de
+00015f10: 6661 756c 7420 6046 616c 7365 6029 3a20  fault `False`): 
+00015f20: 5768 6574 6865 7220 6120 6c61 7374 2062  Whether a last b
+00015f30: 6174 6368 2073 6d61 6c6c 6572 2074 6861  atch smaller tha
+00015f40: 6e20 7468 6520 6261 7463 685f 7369 7a65  n the batch_size
+00015f50: 2073 686f 756c 6420 6265 0a20 2020 2020   should be.     
+00015f60: 2020 2020 2020 2020 2020 2064 726f 7070             dropp
+00015f70: 6564 0a20 2020 2020 2020 2022 2222 0a20  ed.        """. 
+00015f80: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00015f90: 696e 6469 6365 7320 6973 204e 6f6e 6520  indices is None 
+00015fa0: 616e 6420 636f 6e66 6967 2e50 5941 5252  and config.PYARR
+00015fb0: 4f57 5f56 4552 5349 4f4e 2e6d 616a 6f72  OW_VERSION.major
+00015fc0: 203e 3d20 383a 0a20 2020 2020 2020 2020   >= 8:.         
+00015fd0: 2020 2023 2046 6173 7420 6974 6572 6174     # Fast iterat
+00015fe0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00015ff0: 2320 4265 6e63 686d 6172 6b3a 2068 7474  # Benchmark: htt
+00016000: 7073 3a2f 2f67 6973 742e 6769 7468 7562  ps://gist.github
+00016010: 2e63 6f6d 2f6d 6172 696f 7361 736b 6f2f  .com/mariosasko/
+00016020: 3032 3438 3238 3861 3265 3361 3735 3536  0248288a2e3a7556
+00016030: 3837 3339 3639 3731 3763 3166 6535 3262  873969717c1fe52b
+00016040: 2028 6661 7374 5f69 7465 725f 6261 7463   (fast_iter_batc
+00016050: 6829 0a20 2020 2020 2020 2020 2020 2066  h).            f
+00016060: 6f72 6d61 745f 6b77 6172 6773 203d 2073  ormat_kwargs = s
+00016070: 656c 662e 5f66 6f72 6d61 745f 6b77 6172  elf._format_kwar
+00016080: 6773 2069 6620 7365 6c66 2e5f 666f 726d  gs if self._form
+00016090: 6174 5f6b 7761 7267 7320 6973 206e 6f74  at_kwargs is not
+000160a0: 204e 6f6e 6520 656c 7365 207b 7d0a 2020   None else {}.  
+000160b0: 2020 2020 2020 2020 2020 666f 726d 6174            format
+000160c0: 7465 7220 3d20 6765 745f 666f 726d 6174  ter = get_format
+000160d0: 7465 7228 7365 6c66 2e5f 666f 726d 6174  ter(self._format
+000160e0: 5f74 7970 652c 2066 6561 7475 7265 733d  _type, features=
+000160f0: 7365 6c66 2e66 6561 7475 7265 732c 202a  self.features, *
+00016100: 2a66 6f72 6d61 745f 6b77 6172 6773 290a  *format_kwargs).
+00016110: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00016120: 7061 5f73 7562 7461 626c 6520 696e 2074  pa_subtable in t
+00016130: 6162 6c65 5f69 7465 7228 7365 6c66 2e64  able_iter(self.d
+00016140: 6174 612c 2062 6174 6368 5f73 697a 653d  ata, batch_size=
+00016150: 6261 7463 685f 7369 7a65 2c20 6472 6f70  batch_size, drop
+00016160: 5f6c 6173 745f 6261 7463 683d 6472 6f70  _last_batch=drop
+00016170: 5f6c 6173 745f 6261 7463 6829 3a0a 2020  _last_batch):.  
+00016180: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00016190: 726d 6174 7465 645f 6261 7463 6820 3d20  rmatted_batch = 
+000161a0: 666f 726d 6174 5f74 6162 6c65 280a 2020  format_table(.  
+000161b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161c0: 2020 7061 5f73 7562 7461 626c 652c 0a20    pa_subtable,. 
+000161d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161e0: 2020 2072 616e 6765 2870 615f 7375 6274     range(pa_subt
+000161f0: 6162 6c65 2e6e 756d 5f72 6f77 7329 2c0a  able.num_rows),.
+00016200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016210: 2020 2020 666f 726d 6174 7465 723d 666f      formatter=fo
+00016220: 726d 6174 7465 722c 0a20 2020 2020 2020  rmatter,.       
+00016230: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00016240: 6d61 745f 636f 6c75 6d6e 733d 7365 6c66  mat_columns=self
+00016250: 2e5f 666f 726d 6174 5f63 6f6c 756d 6e73  ._format_columns
+00016260: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016270: 2020 2020 2020 6f75 7470 7574 5f61 6c6c        output_all
+00016280: 5f63 6f6c 756d 6e73 3d73 656c 662e 5f6f  _columns=self._o
+00016290: 7574 7075 745f 616c 6c5f 636f 6c75 6d6e  utput_all_column
+000162a0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+000162b0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000162c0: 2020 2020 2079 6965 6c64 2066 6f72 6d61       yield forma
+000162d0: 7474 6564 5f62 6174 6368 0a20 2020 2020  tted_batch.     
+000162e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000162f0: 2020 2020 206e 756d 5f72 6f77 7320 3d20       num_rows = 
+00016300: 7365 6c66 2e6e 756d 5f72 6f77 7320 6966  self.num_rows if
+00016310: 206e 6f74 2064 726f 705f 6c61 7374 5f62   not drop_last_b
+00016320: 6174 6368 2065 6c73 6520 7365 6c66 2e6e  atch else self.n
+00016330: 756d 5f72 6f77 7320 2f2f 2062 6174 6368  um_rows // batch
+00016340: 5f73 697a 6520 2a20 6261 7463 685f 7369  _size * batch_si
+00016350: 7a65 0a20 2020 2020 2020 2020 2020 2066  ze.            f
+00016360: 6f72 2069 2069 6e20 7261 6e67 6528 302c  or i in range(0,
+00016370: 206e 756d 5f72 6f77 732c 2062 6174 6368   num_rows, batch
+00016380: 5f73 697a 6529 3a0a 2020 2020 2020 2020  _size):.        
+00016390: 2020 2020 2020 2020 7969 656c 6420 7365          yield se
+000163a0: 6c66 2e5f 6765 7469 7465 6d28 0a20 2020  lf._getitem(.   
+000163b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163c0: 2073 6c69 6365 2869 2c20 6920 2b20 6261   slice(i, i + ba
+000163d0: 7463 685f 7369 7a65 292c 0a20 2020 2020  tch_size),.     
+000163e0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+000163f0: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
+00016400: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+00016410: 7475 726e 2066 2244 6174 6173 6574 287b  turn f"Dataset({
+00016420: 7b5c 6e20 2020 2066 6561 7475 7265 733a  {\n    features:
+00016430: 207b 6c69 7374 2873 656c 662e 6665 6174   {list(self.feat
+00016440: 7572 6573 2e6b 6579 7328 2929 7d2c 5c6e  ures.keys())},\n
+00016450: 2020 2020 6e75 6d5f 726f 7773 3a20 7b73      num_rows: {s
+00016460: 656c 662e 6e75 6d5f 726f 7773 7d5c 6e7d  elf.num_rows}\n}
+00016470: 7d29 220a 0a20 2020 2040 7072 6f70 6572  })"..    @proper
+00016480: 7479 0a20 2020 2064 6566 2066 6f72 6d61  ty.    def forma
+00016490: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
+000164a0: 2072 6574 7572 6e20 7b0a 2020 2020 2020   return {.      
+000164b0: 2020 2020 2020 2274 7970 6522 3a20 7365        "type": se
+000164c0: 6c66 2e5f 666f 726d 6174 5f74 7970 652c  lf._format_type,
+000164d0: 0a20 2020 2020 2020 2020 2020 2022 666f  .            "fo
+000164e0: 726d 6174 5f6b 7761 7267 7322 3a20 7365  rmat_kwargs": se
+000164f0: 6c66 2e5f 666f 726d 6174 5f6b 7761 7267  lf._format_kwarg
+00016500: 732c 0a20 2020 2020 2020 2020 2020 2022  s,.            "
+00016510: 636f 6c75 6d6e 7322 3a20 7365 6c66 2e63  columns": self.c
+00016520: 6f6c 756d 6e5f 6e61 6d65 7320 6966 2073  olumn_names if s
+00016530: 656c 662e 5f66 6f72 6d61 745f 636f 6c75  elf._format_colu
+00016540: 6d6e 7320 6973 204e 6f6e 6520 656c 7365  mns is None else
+00016550: 2073 656c 662e 5f66 6f72 6d61 745f 636f   self._format_co
+00016560: 6c75 6d6e 732c 0a20 2020 2020 2020 2020  lumns,.         
+00016570: 2020 2022 6f75 7470 7574 5f61 6c6c 5f63     "output_all_c
+00016580: 6f6c 756d 6e73 223a 2073 656c 662e 5f6f  olumns": self._o
+00016590: 7574 7075 745f 616c 6c5f 636f 6c75 6d6e  utput_all_column
+000165a0: 732c 0a20 2020 2020 2020 207d 0a0a 2020  s,.        }..  
+000165b0: 2020 4063 6f6e 7465 7874 6c69 622e 636f    @contextlib.co
+000165c0: 6e74 6578 746d 616e 6167 6572 0a20 2020  ntextmanager.   
+000165d0: 2064 6566 2066 6f72 6d61 7474 6564 5f61   def formatted_a
+000165e0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+000165f0: 0a20 2020 2020 2020 2074 7970 653a 204f  .        type: O
+00016600: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+00016610: 6f6e 652c 0a20 2020 2020 2020 2063 6f6c  one,.        col
+00016620: 756d 6e73 3a20 4f70 7469 6f6e 616c 5b4c  umns: Optional[L
+00016630: 6973 745d 203d 204e 6f6e 652c 0a20 2020  ist] = None,.   
+00016640: 2020 2020 206f 7574 7075 745f 616c 6c5f       output_all_
+00016650: 636f 6c75 6d6e 733a 2062 6f6f 6c20 3d20  columns: bool = 
+00016660: 4661 6c73 652c 0a20 2020 2020 2020 202a  False,.        *
+00016670: 2a66 6f72 6d61 745f 6b77 6172 6773 2c0a  *format_kwargs,.
+00016680: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+00016690: 2222 546f 2062 6520 7573 6564 2069 6e20  ""To be used in 
+000166a0: 6120 6077 6974 6860 2073 7461 7465 6d65  a `with` stateme
+000166b0: 6e74 2e20 5365 7420 605f 5f67 6574 6974  nt. Set `__getit
+000166c0: 656d 5f5f 6020 7265 7475 726e 2066 6f72  em__` return for
+000166d0: 6d61 7420 2874 7970 6520 616e 6420 636f  mat (type and co
+000166e0: 6c75 6d6e 7329 2e0a 0a20 2020 2020 2020  lumns)...       
+000166f0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00016700: 2020 2074 7970 6520 2860 7374 7260 2c20     type (`str`, 
+00016710: 2a6f 7074 696f 6e61 6c2a 293a 0a20 2020  *optional*):.   
+00016720: 2020 2020 2020 2020 2020 2020 204f 7574               Out
+00016730: 7075 7420 7479 7065 2073 656c 6563 7465  put type selecte
+00016740: 6420 696e 2060 5b4e 6f6e 652c 2027 6e75  d in `[None, 'nu
+00016750: 6d70 7927 2c20 2774 6f72 6368 272c 2027  mpy', 'torch', '
+00016760: 7465 6e73 6f72 666c 6f77 272c 2027 7061  tensorflow', 'pa
+00016770: 6e64 6173 272c 2027 6172 726f 7727 5d60  ndas', 'arrow']`
+00016780: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016790: 2020 604e 6f6e 6560 206d 6561 6e73 2060    `None` means `
+000167a0: 5f5f 6765 7469 7465 6d5f 5f60 6020 7265  __getitem__`` re
+000167b0: 7475 726e 7320 7079 7468 6f6e 206f 626a  turns python obj
+000167c0: 6563 7473 2028 6465 6661 756c 7429 2e0a  ects (default)..
+000167d0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+000167e0: 6d6e 7320 2860 4c69 7374 5b73 7472 5d60  mns (`List[str]`
+000167f0: 2c20 2a6f 7074 696f 6e61 6c2a 293a 0a20  , *optional*):. 
+00016800: 2020 2020 2020 2020 2020 2020 2020 2043                 C
+00016810: 6f6c 756d 6e73 2074 6f20 666f 726d 6174  olumns to format
+00016820: 2069 6e20 7468 6520 6f75 7470 7574 2e0a   in the output..
+00016830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016840: 604e 6f6e 6560 206d 6561 6e73 2060 5f5f  `None` means `__
+00016850: 6765 7469 7465 6d5f 5f60 2072 6574 7572  getitem__` retur
+00016860: 6e73 2061 6c6c 2063 6f6c 756d 6e73 2028  ns all columns (
+00016870: 6465 6661 756c 7429 2e0a 2020 2020 2020  default)..      
+00016880: 2020 2020 2020 6f75 7470 7574 5f61 6c6c        output_all
+00016890: 5f63 6f6c 756d 6e73 2028 6062 6f6f 6c60  _columns (`bool`
+000168a0: 2c20 6465 6661 756c 7473 2074 6f20 6046  , defaults to `F
+000168b0: 616c 7365 6029 3a0a 2020 2020 2020 2020  alse`):.        
+000168c0: 2020 2020 2020 2020 4b65 6570 2075 6e2d          Keep un-
+000168d0: 666f 726d 6174 7465 6420 636f 6c75 6d6e  formatted column
+000168e0: 7320 6173 2077 656c 6c20 696e 2074 6865  s as well in the
+000168f0: 206f 7574 7075 7420 2861 7320 7079 7468   output (as pyth
+00016900: 6f6e 206f 626a 6563 7473 292e 0a20 2020  on objects)..   
+00016910: 2020 2020 2020 2020 202a 2a66 6f72 6d61           **forma
+00016920: 745f 6b77 6172 6773 2028 6164 6469 7469  t_kwargs (additi
+00016930: 6f6e 616c 206b 6579 776f 7264 2061 7267  onal keyword arg
+00016940: 756d 656e 7473 293a 0a20 2020 2020 2020  uments):.       
+00016950: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
+00016960: 7320 6172 6775 6d65 6e74 7320 7061 7373  s arguments pass
+00016970: 6564 2074 6f20 7468 6520 636f 6e76 6572  ed to the conver
+00016980: 7420 6675 6e63 7469 6f6e 206c 696b 6520  t function like 
+00016990: 606e 702e 6172 7261 7960 2c20 6074 6f72  `np.array`, `tor
+000169a0: 6368 2e74 656e 736f 7260 206f 7220 6074  ch.tensor` or `t
+000169b0: 656e 736f 7266 6c6f 772e 7261 6767 6564  ensorflow.ragged
+000169c0: 2e63 6f6e 7374 616e 7460 2e0a 2020 2020  .constant`..    
+000169d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000169e0: 6f6c 645f 666f 726d 6174 5f74 7970 6520  old_format_type 
+000169f0: 3d20 7365 6c66 2e5f 666f 726d 6174 5f74  = self._format_t
+00016a00: 7970 650a 2020 2020 2020 2020 6f6c 645f  ype.        old_
+00016a10: 666f 726d 6174 5f6b 7761 7267 7320 3d20  format_kwargs = 
+00016a20: 7365 6c66 2e5f 666f 726d 6174 5f6b 7761  self._format_kwa
+00016a30: 7267 730a 2020 2020 2020 2020 6f6c 645f  rgs.        old_
+00016a40: 666f 726d 6174 5f63 6f6c 756d 6e73 203d  format_columns =
+00016a50: 2073 656c 662e 5f66 6f72 6d61 745f 636f   self._format_co
+00016a60: 6c75 6d6e 730a 2020 2020 2020 2020 6f6c  lumns.        ol
+00016a70: 645f 6f75 7470 7574 5f61 6c6c 5f63 6f6c  d_output_all_col
+00016a80: 756d 6e73 203d 2073 656c 662e 5f6f 7574  umns = self._out
+00016a90: 7075 745f 616c 6c5f 636f 6c75 6d6e 730a  put_all_columns.
+00016aa0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00016ab0: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
+00016ac0: 745f 666f 726d 6174 2874 7970 652c 2063  t_format(type, c
+00016ad0: 6f6c 756d 6e73 2c20 6f75 7470 7574 5f61  olumns, output_a
+00016ae0: 6c6c 5f63 6f6c 756d 6e73 2c20 2a2a 666f  ll_columns, **fo
+00016af0: 726d 6174 5f6b 7761 7267 7329 0a20 2020  rmat_kwargs).   
+00016b00: 2020 2020 2020 2020 2079 6965 6c64 0a20           yield. 
+00016b10: 2020 2020 2020 2066 696e 616c 6c79 3a0a         finally:.
+00016b20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016b30: 2e73 6574 5f66 6f72 6d61 7428 6f6c 645f  .set_format(old_
+00016b40: 666f 726d 6174 5f74 7970 652c 206f 6c64  format_type, old
+00016b50: 5f66 6f72 6d61 745f 636f 6c75 6d6e 732c  _format_columns,
+00016b60: 206f 6c64 5f6f 7574 7075 745f 616c 6c5f   old_output_all_
+00016b70: 636f 6c75 6d6e 732c 202a 2a6f 6c64 5f66  columns, **old_f
+00016b80: 6f72 6d61 745f 6b77 6172 6773 290a 0a20  ormat_kwargs).. 
+00016b90: 2020 2040 6669 6e67 6572 7072 696e 745f     @fingerprint_
+00016ba0: 7472 616e 7366 6f72 6d28 696e 706c 6163  transform(inplac
+00016bb0: 653d 5472 7565 290a 2020 2020 6465 6620  e=True).    def 
+00016bc0: 7365 745f 666f 726d 6174 280a 2020 2020  set_format(.    
+00016bd0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00016be0: 2020 7479 7065 3a20 4f70 7469 6f6e 616c    type: Optional
+00016bf0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+00016c00: 2020 2020 2020 636f 6c75 6d6e 733a 204f        columns: O
+00016c10: 7074 696f 6e61 6c5b 4c69 7374 5d20 3d20  ptional[List] = 
+00016c20: 4e6f 6e65 2c0a 2020 2020 2020 2020 6f75  None,.        ou
+00016c30: 7470 7574 5f61 6c6c 5f63 6f6c 756d 6e73  tput_all_columns
+00016c40: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00016c50: 2020 2020 2020 2020 2a2a 666f 726d 6174          **format
+00016c60: 5f6b 7761 7267 732c 0a20 2020 2029 3a0a  _kwargs,.    ):.
+00016c70: 2020 2020 2020 2020 2222 2253 6574 2060          """Set `
+00016c80: 5f5f 6765 7469 7465 6d5f 5f60 2072 6574  __getitem__` ret
+00016c90: 7572 6e20 666f 726d 6174 2028 7479 7065  urn format (type
+00016ca0: 2061 6e64 2063 6f6c 756d 6e73 292e 2054   and columns). T
+00016cb0: 6865 2064 6174 6120 666f 726d 6174 7469  he data formatti
+00016cc0: 6e67 2069 7320 6170 706c 6965 6420 6f6e  ng is applied on
+00016cd0: 2d74 6865 2d66 6c79 2e0a 2020 2020 2020  -the-fly..      
+00016ce0: 2020 5468 6520 666f 726d 6174 2060 7479    The format `ty
+00016cf0: 7065 6020 2866 6f72 2065 7861 6d70 6c65  pe` (for example
+00016d00: 2022 6e75 6d70 7922 2920 6973 2075 7365   "numpy") is use
+00016d10: 6420 746f 2066 6f72 6d61 7420 6261 7463  d to format batc
+00016d20: 6865 7320 7768 656e 2075 7369 6e67 2060  hes when using `
+00016d30: 5f5f 6765 7469 7465 6d5f 5f60 2e0a 2020  __getitem__`..  
+00016d40: 2020 2020 2020 4974 2773 2061 6c73 6f20        It's also 
+00016d50: 706f 7373 6962 6c65 2074 6f20 7573 6520  possible to use 
+00016d60: 6375 7374 6f6d 2074 7261 6e73 666f 726d  custom transform
+00016d70: 7320 666f 7220 666f 726d 6174 7469 6e67  s for formatting
+00016d80: 2075 7369 6e67 205b 607e 6461 7461 7365   using [`~datase
+00016d90: 7473 2e44 6174 6173 6574 2e73 6574 5f74  ts.Dataset.set_t
+00016da0: 7261 6e73 666f 726d 605d 2e0a 0a20 2020  ransform`]...   
+00016db0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+00016dc0: 2020 2020 2020 2074 7970 6520 2860 7374         type (`st
+00016dd0: 7260 2c20 2a6f 7074 696f 6e61 6c2a 293a  r`, *optional*):
+00016de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016df0: 2045 6974 6865 7220 6f75 7470 7574 2074   Either output t
+00016e00: 7970 6520 7365 6c65 6374 6564 2069 6e20  ype selected in 
+00016e10: 605b 4e6f 6e65 2c20 276e 756d 7079 272c  `[None, 'numpy',
+00016e20: 2027 746f 7263 6827 2c20 2774 656e 736f   'torch', 'tenso
+00016e30: 7266 6c6f 7727 2c20 2770 616e 6461 7327  rflow', 'pandas'
+00016e40: 2c20 2761 7272 6f77 275d 602e 0a20 2020  , 'arrow']`..   
+00016e50: 2020 2020 2020 2020 2020 2020 2060 4e6f               `No
+00016e60: 6e65 6020 6d65 616e 7320 605f 5f67 6574  ne` means `__get
+00016e70: 6974 656d 5f5f 6020 7265 7475 726e 7320  item__` returns 
+00016e80: 7079 7468 6f6e 206f 626a 6563 7473 2028  python objects (
+00016e90: 6465 6661 756c 7429 2e0a 2020 2020 2020  default)..      
+00016ea0: 2020 2020 2020 636f 6c75 6d6e 7320 2860        columns (`
+00016eb0: 4c69 7374 5b73 7472 5d60 2c20 2a6f 7074  List[str]`, *opt
+00016ec0: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
+00016ed0: 2020 2020 2020 2020 2043 6f6c 756d 6e73           Columns
+00016ee0: 2074 6f20 666f 726d 6174 2069 6e20 7468   to format in th
+00016ef0: 6520 6f75 7470 7574 2e0a 2020 2020 2020  e output..      
+00016f00: 2020 2020 2020 2020 2020 604e 6f6e 6560            `None`
+00016f10: 206d 6561 6e73 2060 5f5f 6765 7469 7465   means `__getite
+00016f20: 6d5f 5f60 2072 6574 7572 6e73 2061 6c6c  m__` returns all
+00016f30: 2063 6f6c 756d 6e73 2028 6465 6661 756c   columns (defaul
+00016f40: 7429 2e0a 2020 2020 2020 2020 2020 2020  t)..            
+00016f50: 6f75 7470 7574 5f61 6c6c 5f63 6f6c 756d  output_all_colum
+00016f60: 6e73 2028 6062 6f6f 6c60 2c20 6465 6661  ns (`bool`, defa
+00016f70: 756c 7473 2074 6f20 6046 616c 7365 6029  ults to `False`)
+00016f80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016f90: 2020 4b65 6570 2075 6e2d 666f 726d 6174    Keep un-format
+00016fa0: 7465 6420 636f 6c75 6d6e 7320 6173 2077  ted columns as w
+00016fb0: 656c 6c20 696e 2074 6865 206f 7574 7075  ell in the outpu
+00016fc0: 7420 2861 7320 7079 7468 6f6e 206f 626a  t (as python obj
+00016fd0: 6563 7473 292e 0a20 2020 2020 2020 2020  ects)..         
+00016fe0: 2020 202a 2a66 6f72 6d61 745f 6b77 6172     **format_kwar
+00016ff0: 6773 2028 6164 6469 7469 6f6e 616c 206b  gs (additional k
+00017000: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+00017010: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00017020: 2020 204b 6579 776f 7264 7320 6172 6775     Keywords argu
+00017030: 6d65 6e74 7320 7061 7373 6564 2074 6f20  ments passed to 
+00017040: 7468 6520 636f 6e76 6572 7420 6675 6e63  the convert func
+00017050: 7469 6f6e 206c 696b 6520 606e 702e 6172  tion like `np.ar
+00017060: 7261 7960 2c20 6074 6f72 6368 2e74 656e  ray`, `torch.ten
+00017070: 736f 7260 206f 7220 6074 656e 736f 7266  sor` or `tensorf
+00017080: 6c6f 772e 7261 6767 6564 2e63 6f6e 7374  low.ragged.const
+00017090: 616e 7460 2e0a 0a20 2020 2020 2020 2049  ant`...        I
+000170a0: 7420 6973 2070 6f73 7369 626c 6520 746f  t is possible to
+000170b0: 2063 616c 6c20 5b60 7e64 6174 6173 6574   call [`~dataset
+000170c0: 732e 4461 7461 7365 742e 6d61 7060 5d20  s.Dataset.map`] 
+000170d0: 6166 7465 7220 6361 6c6c 696e 6720 6073  after calling `s
+000170e0: 6574 5f66 6f72 6d61 7460 2e20 5369 6e63  et_format`. Sinc
+000170f0: 6520 606d 6170 6020 6d61 7920 6164 6420  e `map` may add 
+00017100: 6e65 7720 636f 6c75 6d6e 732c 2074 6865  new columns, the
+00017110: 6e20 7468 6520 6c69 7374 206f 6620 666f  n the list of fo
+00017120: 726d 6174 7465 6420 636f 6c75 6d6e 730a  rmatted columns.
+00017130: 2020 2020 2020 2020 6765 7473 2075 7064          gets upd
+00017140: 6174 6564 2e20 496e 2074 6869 7320 6361  ated. In this ca
+00017150: 7365 2c20 6966 2079 6f75 2061 7070 6c79  se, if you apply
+00017160: 2060 6d61 7060 206f 6e20 6120 6461 7461   `map` on a data
+00017170: 7365 7420 746f 2061 6464 2061 206e 6577  set to add a new
+00017180: 2063 6f6c 756d 6e2c 2074 6865 6e20 7468   column, then th
+00017190: 6973 2063 6f6c 756d 6e20 7769 6c6c 2062  is column will b
+000171a0: 6520 666f 726d 6174 7465 6420 6173 3a0a  e formatted as:.
+000171b0: 0a20 2020 2020 2020 2020 2020 2060 6060  .            ```
+000171c0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+000171d0: 2066 6f72 6d61 7474 6564 2063 6f6c 756d   formatted colum
+000171e0: 6e73 203d 2028 616c 6c20 636f 6c75 6d6e  ns = (all column
+000171f0: 7320 2d20 7072 6576 696f 7573 6c79 2075  s - previously u
+00017200: 6e66 6f72 6d61 7474 6564 2063 6f6c 756d  nformatted colum
+00017210: 6e73 290a 2020 2020 2020 2020 2020 2020  ns).            
+00017220: 6060 600a 0a20 2020 2020 2020 2045 7861  ```..        Exa
+00017230: 6d70 6c65 3a0a 0a20 2020 2020 2020 2060  mple:..        `
+00017240: 6060 7079 0a20 2020 2020 2020 203e 3e3e  ``py.        >>>
+00017250: 2066 726f 6d20 6461 7461 7365 7473 2069   from datasets i
+00017260: 6d70 6f72 7420 6c6f 6164 5f64 6174 6173  mport load_datas
+00017270: 6574 0a20 2020 2020 2020 203e 3e3e 2066  et.        >>> f
+00017280: 726f 6d20 7472 616e 7366 6f72 6d65 7273  rom transformers
+00017290: 2069 6d70 6f72 7420 4175 746f 546f 6b65   import AutoToke
+000172a0: 6e69 7a65 720a 2020 2020 2020 2020 3e3e  nizer.        >>
+000172b0: 3e20 6473 203d 206c 6f61 645f 6461 7461  > ds = load_data
+000172c0: 7365 7428 2272 6f74 7465 6e5f 746f 6d61  set("rotten_toma
+000172d0: 746f 6573 222c 2073 706c 6974 3d22 7661  toes", split="va
+000172e0: 6c69 6461 7469 6f6e 2229 0a20 2020 2020  lidation").     
+000172f0: 2020 203e 3e3e 2074 6f6b 656e 697a 6572     >>> tokenizer
+00017300: 203d 2041 7574 6f54 6f6b 656e 697a 6572   = AutoTokenizer
+00017310: 2e66 726f 6d5f 7072 6574 7261 696e 6564  .from_pretrained
+00017320: 2822 6265 7274 2d62 6173 652d 6361 7365  ("bert-base-case
+00017330: 6422 290a 2020 2020 2020 2020 3e3e 3e20  d").        >>> 
+00017340: 6473 203d 2064 732e 6d61 7028 6c61 6d62  ds = ds.map(lamb
+00017350: 6461 2078 3a20 746f 6b65 6e69 7a65 7228  da x: tokenizer(
+00017360: 785b 2774 6578 7427 5d2c 2074 7275 6e63  x['text'], trunc
+00017370: 6174 696f 6e3d 5472 7565 2c20 7061 6464  ation=True, padd
+00017380: 696e 673d 5472 7565 292c 2062 6174 6368  ing=True), batch
+00017390: 6564 3d54 7275 6529 0a20 2020 2020 2020  ed=True).       
+000173a0: 203e 3e3e 2064 732e 7365 745f 666f 726d   >>> ds.set_form
+000173b0: 6174 2874 7970 653d 276e 756d 7079 272c  at(type='numpy',
+000173c0: 2063 6f6c 756d 6e73 3d5b 2774 6578 7427   columns=['text'
+000173d0: 2c20 276c 6162 656c 275d 290a 2020 2020  , 'label']).    
+000173e0: 2020 2020 3e3e 3e20 6473 2e66 6f72 6d61      >>> ds.forma
+000173f0: 740a 2020 2020 2020 2020 7b27 636f 6c75  t.        {'colu
+00017400: 6d6e 7327 3a20 5b27 696e 7075 745f 6964  mns': ['input_id
+00017410: 7327 2c20 2774 6f6b 656e 5f74 7970 655f  s', 'token_type_
+00017420: 6964 7327 2c20 2761 7474 656e 7469 6f6e  ids', 'attention
+00017430: 5f6d 6173 6b27 2c20 276c 6162 656c 275d  _mask', 'label']
+00017440: 2c0a 2020 2020 2020 2020 2027 666f 726d  ,.         'form
+00017450: 6174 5f6b 7761 7267 7327 3a20 7b7d 2c0a  at_kwargs': {},.
+00017460: 2020 2020 2020 2020 2027 6f75 7470 7574           'output
+00017470: 5f61 6c6c 5f63 6f6c 756d 6e73 273a 2046  _all_columns': F
+00017480: 616c 7365 2c0a 2020 2020 2020 2020 2027  alse,.         '
+00017490: 7479 7065 273a 2027 6e75 6d70 7927 7d0a  type': 'numpy'}.
+000174a0: 2020 2020 2020 2020 6060 600a 2020 2020          ```.    
+000174b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000174c0: 666f 726d 6174 5f6b 7761 7267 732e 7570  format_kwargs.up
+000174d0: 6461 7465 2866 6f72 6d61 745f 6b77 6172  date(format_kwar
+000174e0: 6773 2e70 6f70 2822 666f 726d 6174 5f6b  gs.pop("format_k
+000174f0: 7761 7267 7322 2c20 7b7d 2929 2020 2320  wargs", {}))  # 
+00017500: 616c 6c6f 7720 746f 2075 7365 2073 656c  allow to use sel
+00017510: 662e 7365 745f 666f 726d 6174 2873 656c  f.set_format(sel
+00017520: 662e 666f 726d 6174 290a 0a20 2020 2020  f.format)..     
+00017530: 2020 2023 2043 6865 636b 2074 6861 7420     # Check that 
+00017540: 7468 6520 666f 726d 6174 5f74 7970 6520  the format_type 
+00017550: 616e 6420 666f 726d 6174 5f6b 7761 7267  and format_kwarg
+00017560: 7320 6172 6520 7661 6c69 6420 616e 6420  s are valid and 
+00017570: 6d61 6b65 2069 7420 706f 7373 6962 6c65  make it possible
+00017580: 2074 6f20 6861 7665 2061 2046 6f72 6d61   to have a Forma
+00017590: 7474 6572 0a20 2020 2020 2020 2074 7970  tter.        typ
+000175a0: 6520 3d20 6765 745f 666f 726d 6174 5f74  e = get_format_t
+000175b0: 7970 655f 6672 6f6d 5f61 6c69 6173 2874  ype_from_alias(t
+000175c0: 7970 6529 0a20 2020 2020 2020 205f 203d  ype).        _ =
+000175d0: 2067 6574 5f66 6f72 6d61 7474 6572 2874   get_formatter(t
+000175e0: 7970 652c 2066 6561 7475 7265 733d 7365  ype, features=se
+000175f0: 6c66 2e66 6561 7475 7265 732c 202a 2a66  lf.features, **f
+00017600: 6f72 6d61 745f 6b77 6172 6773 290a 0a20  ormat_kwargs).. 
+00017610: 2020 2020 2020 2023 2043 6865 636b 2066         # Check f
+00017620: 696c 7465 7220 636f 6c75 6d6e 0a20 2020  ilter column.   
+00017630: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00017640: 6365 2863 6f6c 756d 6e73 2c20 7374 7229  ce(columns, str)
+00017650: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+00017660: 6c75 6d6e 7320 3d20 5b63 6f6c 756d 6e73  lumns = [columns
+00017670: 5d0a 2020 2020 2020 2020 6966 2069 7369  ].        if isi
+00017680: 6e73 7461 6e63 6528 636f 6c75 6d6e 732c  nstance(columns,
+00017690: 2074 7570 6c65 293a 0a20 2020 2020 2020   tuple):.       
+000176a0: 2020 2020 2063 6f6c 756d 6e73 203d 206c       columns = l
+000176b0: 6973 7428 636f 6c75 6d6e 7329 0a20 2020  ist(columns).   
+000176c0: 2020 2020 2069 6620 636f 6c75 6d6e 7320       if columns 
+000176d0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+000176e0: 616e 7928 636f 6c20 6e6f 7420 696e 2073  any(col not in s
+000176f0: 656c 662e 5f64 6174 612e 636f 6c75 6d6e  elf._data.column
+00017700: 5f6e 616d 6573 2066 6f72 2063 6f6c 2069  _names for col i
+00017710: 6e20 636f 6c75 6d6e 7329 3a0a 2020 2020  n columns):.    
+00017720: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00017730: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00017740: 2020 2020 2020 2020 2020 6622 436f 6c75            f"Colu
+00017750: 6d6e 7320 7b6c 6973 7428 6669 6c74 6572  mns {list(filter
+00017760: 286c 616d 6264 6120 636f 6c3a 2063 6f6c  (lambda col: col
+00017770: 206e 6f74 2069 6e20 7365 6c66 2e5f 6461   not in self._da
+00017780: 7461 2e63 6f6c 756d 6e5f 6e61 6d65 732c  ta.column_names,
+00017790: 2063 6f6c 756d 6e73 2929 7d20 6e6f 7420   columns))} not 
+000177a0: 696e 2074 6865 2064 6174 6173 6574 2e20  in the dataset. 
+000177b0: 4375 7272 656e 7420 636f 6c75 6d6e 7320  Current columns 
+000177c0: 696e 2074 6865 2064 6174 6173 6574 3a20  in the dataset: 
+000177d0: 7b73 656c 662e 5f64 6174 612e 636f 6c75  {self._data.colu
+000177e0: 6d6e 5f6e 616d 6573 7d22 0a20 2020 2020  mn_names}".     
+000177f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00017800: 2069 6620 636f 6c75 6d6e 7320 6973 206e   if columns is n
+00017810: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00017820: 2020 2020 2063 6f6c 756d 6e73 203d 2063       columns = c
+00017830: 6f6c 756d 6e73 2e63 6f70 7928 2920 2023  olumns.copy()  #
+00017840: 2045 6e73 7572 6573 206d 6f64 6966 6963   Ensures modific
+00017850: 6174 696f 6e73 206d 6164 6520 746f 2074  ations made to t
+00017860: 6865 206c 6973 7420 6166 7465 7220 7468  he list after th
+00017870: 6973 2063 616c 6c20 646f 6e27 7420 6361  is call don't ca
+00017880: 7573 6520 6275 6773 0a0a 2020 2020 2020  use bugs..      
+00017890: 2020 7365 6c66 2e5f 666f 726d 6174 5f74    self._format_t
+000178a0: 7970 6520 3d20 7479 7065 0a20 2020 2020  ype = type.     
+000178b0: 2020 2073 656c 662e 5f66 6f72 6d61 745f     self._format_
+000178c0: 6b77 6172 6773 203d 2066 6f72 6d61 745f  kwargs = format_
+000178d0: 6b77 6172 6773 0a20 2020 2020 2020 2073  kwargs.        s
+000178e0: 656c 662e 5f66 6f72 6d61 745f 636f 6c75  elf._format_colu
+000178f0: 6d6e 7320 3d20 636f 6c75 6d6e 730a 2020  mns = columns.  
+00017900: 2020 2020 2020 7365 6c66 2e5f 6f75 7470        self._outp
+00017910: 7574 5f61 6c6c 5f63 6f6c 756d 6e73 203d  ut_all_columns =
+00017920: 206f 7574 7075 745f 616c 6c5f 636f 6c75   output_all_colu
+00017930: 6d6e 730a 2020 2020 2020 2020 6c6f 6767  mns.        logg
+00017940: 6572 2e64 6562 7567 280a 2020 2020 2020  er.debug(.      
+00017950: 2020 2020 2020 2253 6574 205f 5f67 6574        "Set __get
+00017960: 6974 656d 5f5f 286b 6579 2920 6f75 7470  item__(key) outp
+00017970: 7574 2074 7970 6520 746f 2025 7320 666f  ut type to %s fo
+00017980: 7220 2573 2063 6f6c 756d 6e73 2022 0a20  r %s columns ". 
+00017990: 2020 2020 2020 2020 2020 2022 2028 7768             " (wh
+000179a0: 656e 206b 6579 2069 7320 696e 7420 6f72  en key is int or
+000179b0: 2073 6c69 6365 2920 616e 6420 2573 206f   slice) and %s o
+000179c0: 7574 7075 7420 6f74 6865 7220 2875 6e2d  utput other (un-
+000179d0: 666f 726d 6174 7465 6429 2063 6f6c 756d  formatted) colum
+000179e0: 6e73 2e22 2c0a 2020 2020 2020 2020 2020  ns.",.          
+000179f0: 2020 2270 7974 686f 6e20 6f62 6a65 6374    "python object
+00017a00: 7322 2069 6620 7479 7065 2069 7320 4e6f  s" if type is No
+00017a10: 6e65 2065 6c73 6520 7479 7065 2c0a 2020  ne else type,.  
+00017a20: 2020 2020 2020 2020 2020 226e 6f22 2069            "no" i
+00017a30: 6620 636f 6c75 6d6e 7320 6973 204e 6f6e  f columns is Non
+00017a40: 6520 656c 7365 2073 7472 2863 6f6c 756d  e else str(colum
+00017a50: 6e73 292c 0a20 2020 2020 2020 2020 2020  ns),.           
+00017a60: 2022 646f 2220 6966 206f 7574 7075 745f   "do" if output_
+00017a70: 616c 6c5f 636f 6c75 6d6e 7320 656c 7365  all_columns else
+00017a80: 2022 646f 6e27 7422 2c0a 2020 2020 2020   "don't",.      
+00017a90: 2020 290a 0a20 2020 2064 6566 2072 6573    )..    def res
+00017aa0: 6574 5f66 6f72 6d61 7428 7365 6c66 293a  et_format(self):
+00017ab0: 0a20 2020 2020 2020 2022 2222 5265 7365  .        """Rese
+00017ac0: 7420 605f 5f67 6574 6974 656d 5f5f 6020  t `__getitem__` 
+00017ad0: 7265 7475 726e 2066 6f72 6d61 7420 746f  return format to
+00017ae0: 2070 7974 686f 6e20 6f62 6a65 6374 7320   python objects 
+00017af0: 616e 6420 616c 6c20 636f 6c75 6d6e 732e  and all columns.
+00017b00: 0a0a 2020 2020 2020 2020 5361 6d65 2061  ..        Same a
+00017b10: 7320 6073 656c 662e 7365 745f 666f 726d  s `self.set_form
+00017b20: 6174 2829 600a 0a20 2020 2020 2020 2045  at()`..        E
+00017b30: 7861 6d70 6c65 3a0a 0a20 2020 2020 2020  xample:..       
+00017b40: 2060 6060 7079 0a20 2020 2020 2020 203e   ```py.        >
+00017b50: 3e3e 2066 726f 6d20 6461 7461 7365 7473  >> from datasets
+00017b60: 2069 6d70 6f72 7420 6c6f 6164 5f64 6174   import load_dat
+00017b70: 6173 6574 0a20 2020 2020 2020 203e 3e3e  aset.        >>>
+00017b80: 2066 726f 6d20 7472 616e 7366 6f72 6d65   from transforme
+00017b90: 7273 2069 6d70 6f72 7420 4175 746f 546f  rs import AutoTo
+00017ba0: 6b65 6e69 7a65 720a 2020 2020 2020 2020  kenizer.        
+00017bb0: 3e3e 3e20 6473 203d 206c 6f61 645f 6461  >>> ds = load_da
+00017bc0: 7461 7365 7428 2272 6f74 7465 6e5f 746f  taset("rotten_to
+00017bd0: 6d61 746f 6573 222c 2073 706c 6974 3d22  matoes", split="
+00017be0: 7661 6c69 6461 7469 6f6e 2229 0a20 2020  validation").   
+00017bf0: 2020 2020 203e 3e3e 2074 6f6b 656e 697a       >>> tokeniz
+00017c00: 6572 203d 2041 7574 6f54 6f6b 656e 697a  er = AutoTokeniz
+00017c10: 6572 2e66 726f 6d5f 7072 6574 7261 696e  er.from_pretrain
+00017c20: 6564 2822 6265 7274 2d62 6173 652d 6361  ed("bert-base-ca
+00017c30: 7365 6422 290a 2020 2020 2020 2020 3e3e  sed").        >>
+00017c40: 3e20 6473 203d 2064 732e 6d61 7028 6c61  > ds = ds.map(la
+00017c50: 6d62 6461 2078 3a20 746f 6b65 6e69 7a65  mbda x: tokenize
+00017c60: 7228 785b 2774 6578 7427 5d2c 2074 7275  r(x['text'], tru
+00017c70: 6e63 6174 696f 6e3d 5472 7565 2c20 7061  ncation=True, pa
+00017c80: 6464 696e 673d 5472 7565 292c 2062 6174  dding=True), bat
+00017c90: 6368 6564 3d54 7275 6529 0a20 2020 2020  ched=True).     
+00017ca0: 2020 203e 3e3e 2064 732e 7365 745f 666f     >>> ds.set_fo
+00017cb0: 726d 6174 2874 7970 653d 276e 756d 7079  rmat(type='numpy
+00017cc0: 272c 2063 6f6c 756d 6e73 3d5b 2769 6e70  ', columns=['inp
+00017cd0: 7574 5f69 6473 272c 2027 746f 6b65 6e5f  ut_ids', 'token_
+00017ce0: 7479 7065 5f69 6473 272c 2027 6174 7465  type_ids', 'atte
+00017cf0: 6e74 696f 6e5f 6d61 736b 272c 2027 6c61  ntion_mask', 'la
+00017d00: 6265 6c27 5d29 0a20 2020 2020 2020 203e  bel']).        >
+00017d10: 3e3e 2064 732e 666f 726d 6174 0a20 2020  >> ds.format.   
+00017d20: 2020 2020 207b 2763 6f6c 756d 6e73 273a       {'columns':
+00017d30: 205b 2769 6e70 7574 5f69 6473 272c 2027   ['input_ids', '
+00017d40: 746f 6b65 6e5f 7479 7065 5f69 6473 272c  token_type_ids',
+00017d50: 2027 6174 7465 6e74 696f 6e5f 6d61 736b   'attention_mask
+00017d60: 272c 2027 6c61 6265 6c27 5d2c 0a20 2020  ', 'label'],.   
+00017d70: 2020 2020 2020 2766 6f72 6d61 745f 6b77        'format_kw
+00017d80: 6172 6773 273a 207b 7d2c 0a20 2020 2020  args': {},.     
+00017d90: 2020 2020 276f 7574 7075 745f 616c 6c5f      'output_all_
+00017da0: 636f 6c75 6d6e 7327 3a20 4661 6c73 652c  columns': False,
+00017db0: 0a20 2020 2020 2020 2020 2774 7970 6527  .         'type'
+00017dc0: 3a20 276e 756d 7079 277d 0a20 2020 2020  : 'numpy'}.     
+00017dd0: 2020 203e 3e3e 2064 732e 7265 7365 745f     >>> ds.reset_
+00017de0: 666f 726d 6174 2829 0a20 2020 2020 2020  format().       
+00017df0: 203e 3e3e 2064 732e 666f 726d 6174 0a20   >>> ds.format. 
+00017e00: 2020 2020 2020 207b 2763 6f6c 756d 6e73         {'columns
+00017e10: 273a 205b 2774 6578 7427 2c20 276c 6162  ': ['text', 'lab
+00017e20: 656c 272c 2027 696e 7075 745f 6964 7327  el', 'input_ids'
+00017e30: 2c20 2774 6f6b 656e 5f74 7970 655f 6964  , 'token_type_id
+00017e40: 7327 2c20 2761 7474 656e 7469 6f6e 5f6d  s', 'attention_m
+00017e50: 6173 6b27 5d2c 0a20 2020 2020 2020 2020  ask'],.         
+00017e60: 2766 6f72 6d61 745f 6b77 6172 6773 273a  'format_kwargs':
+00017e70: 207b 7d2c 0a20 2020 2020 2020 2020 276f   {},.         'o
+00017e80: 7574 7075 745f 616c 6c5f 636f 6c75 6d6e  utput_all_column
+00017e90: 7327 3a20 4661 6c73 652c 0a20 2020 2020  s': False,.     
+00017ea0: 2020 2020 2774 7970 6527 3a20 4e6f 6e65      'type': None
+00017eb0: 7d0a 2020 2020 2020 2020 6060 600a 2020  }.        ```.  
+00017ec0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00017ed0: 2020 7365 6c66 2e73 6574 5f66 6f72 6d61    self.set_forma
+00017ee0: 7428 290a 0a20 2020 2064 6566 2073 6574  t()..    def set
+00017ef0: 5f74 7261 6e73 666f 726d 280a 2020 2020  _transform(.    
+00017f00: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00017f10: 2020 7472 616e 7366 6f72 6d3a 204f 7074    transform: Opt
+00017f20: 696f 6e61 6c5b 4361 6c6c 6162 6c65 5d2c  ional[Callable],
+00017f30: 0a20 2020 2020 2020 2063 6f6c 756d 6e73  .        columns
+00017f40: 3a20 4f70 7469 6f6e 616c 5b4c 6973 745d  : Optional[List]
+00017f50: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00017f60: 206f 7574 7075 745f 616c 6c5f 636f 6c75   output_all_colu
+00017f70: 6d6e 733a 2062 6f6f 6c20 3d20 4661 6c73  mns: bool = Fals
+00017f80: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
+00017f90: 2020 2222 2253 6574 2060 5f5f 6765 7469    """Set `__geti
+00017fa0: 7465 6d5f 5f60 2072 6574 7572 6e20 666f  tem__` return fo
+00017fb0: 726d 6174 2075 7369 6e67 2074 6869 7320  rmat using this 
+00017fc0: 7472 616e 7366 6f72 6d2e 2054 6865 2074  transform. The t
+00017fd0: 7261 6e73 666f 726d 2069 7320 6170 706c  ransform is appl
+00017fe0: 6965 6420 6f6e 2d74 6865 2d66 6c79 206f  ied on-the-fly o
+00017ff0: 6e20 6261 7463 6865 7320 7768 656e 2060  n batches when `
+00018000: 5f5f 6765 7469 7465 6d5f 5f60 2069 7320  __getitem__` is 
+00018010: 6361 6c6c 6564 2e0a 2020 2020 2020 2020  called..        
+00018020: 4173 205b 607e 6461 7461 7365 7473 2e44  As [`~datasets.D
+00018030: 6174 6173 6574 2e73 6574 5f66 6f72 6d61  ataset.set_forma
+00018040: 7460 5d2c 2074 6869 7320 6361 6e20 6265  t`], this can be
+00018050: 2072 6573 6574 2075 7369 6e67 205b 607e   reset using [`~
+00018060: 6461 7461 7365 7473 2e44 6174 6173 6574  datasets.Dataset
+00018070: 2e72 6573 6574 5f66 6f72 6d61 7460 5d2e  .reset_format`].
+00018080: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00018090: 2020 2020 2020 2020 2020 2020 7472 616e              tran
+000180a0: 7366 6f72 6d20 2860 4361 6c6c 6162 6c65  sform (`Callable
+000180b0: 602c 202a 6f70 7469 6f6e 616c 2a29 3a0a  `, *optional*):.
+000180c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180d0: 5573 6572 2d64 6566 696e 6564 2066 6f72  User-defined for
+000180e0: 6d61 7474 696e 6720 7472 616e 7366 6f72  matting transfor
+000180f0: 6d2c 2072 6570 6c61 6365 7320 7468 6520  m, replaces the 
+00018100: 666f 726d 6174 2064 6566 696e 6564 2062  format defined b
+00018110: 7920 5b60 7e64 6174 6173 6574 732e 4461  y [`~datasets.Da
+00018120: 7461 7365 742e 7365 745f 666f 726d 6174  taset.set_format
+00018130: 605d 2e0a 2020 2020 2020 2020 2020 2020  `]..            
+00018140: 2020 2020 4120 666f 726d 6174 7469 6e67      A formatting
+00018150: 2066 756e 6374 696f 6e20 6973 2061 2063   function is a c
+00018160: 616c 6c61 626c 6520 7468 6174 2074 616b  allable that tak
+00018170: 6573 2061 2062 6174 6368 2028 6173 2061  es a batch (as a
+00018180: 2060 6469 6374 6029 2061 7320 696e 7075   `dict`) as inpu
+00018190: 7420 616e 6420 7265 7475 726e 7320 6120  t and returns a 
+000181a0: 6261 7463 682e 0a20 2020 2020 2020 2020  batch..         
+000181b0: 2020 2020 2020 2054 6869 7320 6675 6e63         This func
+000181c0: 7469 6f6e 2069 7320 6170 706c 6965 6420  tion is applied 
+000181d0: 7269 6768 7420 6265 666f 7265 2072 6574  right before ret
+000181e0: 7572 6e69 6e67 2074 6865 206f 626a 6563  urning the objec
+000181f0: 7473 2069 6e20 605f 5f67 6574 6974 656d  ts in `__getitem
+00018200: 5f5f 602e 0a20 2020 2020 2020 2020 2020  __`..           
+00018210: 2063 6f6c 756d 6e73 2028 604c 6973 745b   columns (`List[
+00018220: 7374 725d 602c 202a 6f70 7469 6f6e 616c  str]`, *optional
+00018230: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
+00018240: 2020 2020 436f 6c75 6d6e 7320 746f 2066      Columns to f
+00018250: 6f72 6d61 7420 696e 2074 6865 206f 7574  ormat in the out
+00018260: 7075 742e 0a20 2020 2020 2020 2020 2020  put..           
+00018270: 2020 2020 2049 6620 7370 6563 6966 6965       If specifie
+00018280: 642c 2074 6865 6e20 7468 6520 696e 7075  d, then the inpu
+00018290: 7420 6261 7463 6820 6f66 2074 6865 2074  t batch of the t
+000182a0: 7261 6e73 666f 726d 206f 6e6c 7920 636f  ransform only co
+000182b0: 6e74 6169 6e73 2074 686f 7365 2063 6f6c  ntains those col
+000182c0: 756d 6e73 2e0a 2020 2020 2020 2020 2020  umns..          
+000182d0: 2020 6f75 7470 7574 5f61 6c6c 5f63 6f6c    output_all_col
+000182e0: 756d 6e73 2028 6062 6f6f 6c60 2c20 6465  umns (`bool`, de
+000182f0: 6661 756c 7473 2074 6f20 6046 616c 7365  faults to `False
+00018300: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
+00018310: 2020 2020 4b65 6570 2075 6e2d 666f 726d      Keep un-form
+00018320: 6174 7465 6420 636f 6c75 6d6e 7320 6173  atted columns as
+00018330: 2077 656c 6c20 696e 2074 6865 206f 7574   well in the out
+00018340: 7075 7420 2861 7320 7079 7468 6f6e 206f  put (as python o
+00018350: 626a 6563 7473 292e 0a20 2020 2020 2020  bjects)..       
+00018360: 2020 2020 2020 2020 2049 6620 7365 7420           If set 
+00018370: 746f 2054 7275 652c 2074 6865 6e20 7468  to True, then th
+00018380: 6520 6f74 6865 7220 756e 2d66 6f72 6d61  e other un-forma
+00018390: 7474 6564 2063 6f6c 756d 6e73 2061 7265  tted columns are
+000183a0: 206b 6570 7420 7769 7468 2074 6865 206f   kept with the o
+000183b0: 7574 7075 7420 6f66 2074 6865 2074 7261  utput of the tra
+000183c0: 6e73 666f 726d 2e0a 0a20 2020 2020 2020  nsform...       
+000183d0: 2045 7861 6d70 6c65 3a0a 0a20 2020 2020   Example:..     
+000183e0: 2020 2060 6060 7079 0a20 2020 2020 2020     ```py.       
+000183f0: 203e 3e3e 2066 726f 6d20 6461 7461 7365   >>> from datase
+00018400: 7473 2069 6d70 6f72 7420 6c6f 6164 5f64  ts import load_d
+00018410: 6174 6173 6574 0a20 2020 2020 2020 203e  ataset.        >
+00018420: 3e3e 2066 726f 6d20 7472 616e 7366 6f72  >> from transfor
+00018430: 6d65 7273 2069 6d70 6f72 7420 4175 746f  mers import Auto
+00018440: 546f 6b65 6e69 7a65 720a 2020 2020 2020  Tokenizer.      
+00018450: 2020 3e3e 3e20 6473 203d 206c 6f61 645f    >>> ds = load_
+00018460: 6461 7461 7365 7428 2272 6f74 7465 6e5f  dataset("rotten_
+00018470: 746f 6d61 746f 6573 222c 2073 706c 6974  tomatoes", split
+00018480: 3d22 7661 6c69 6461 7469 6f6e 2229 0a20  ="validation"). 
+00018490: 2020 2020 2020 203e 3e3e 2074 6f6b 656e         >>> token
+000184a0: 697a 6572 203d 2041 7574 6f54 6f6b 656e  izer = AutoToken
+000184b0: 697a 6572 2e66 726f 6d5f 7072 6574 7261  izer.from_pretra
+000184c0: 696e 6564 2827 6265 7274 2d62 6173 652d  ined('bert-base-
+000184d0: 756e 6361 7365 6427 290a 2020 2020 2020  uncased').      
+000184e0: 2020 3e3e 3e20 6465 6620 656e 636f 6465    >>> def encode
+000184f0: 2862 6174 6368 293a 0a20 2020 2020 2020  (batch):.       
+00018500: 202e 2e2e 2020 2020 2072 6574 7572 6e20   ...     return 
+00018510: 746f 6b65 6e69 7a65 7228 6261 7463 685b  tokenizer(batch[
+00018520: 2774 6578 7427 5d2c 2070 6164 6469 6e67  'text'], padding
+00018530: 3d54 7275 652c 2074 7275 6e63 6174 696f  =True, truncatio
+00018540: 6e3d 5472 7565 2c20 7265 7475 726e 5f74  n=True, return_t
+00018550: 656e 736f 7273 3d27 7074 2729 0a20 2020  ensors='pt').   
+00018560: 2020 2020 203e 3e3e 2064 732e 7365 745f       >>> ds.set_
+00018570: 7472 616e 7366 6f72 6d28 656e 636f 6465  transform(encode
+00018580: 290a 2020 2020 2020 2020 3e3e 3e20 6473  ).        >>> ds
+00018590: 5b30 5d0a 2020 2020 2020 2020 7b27 6174  [0].        {'at
+000185a0: 7465 6e74 696f 6e5f 6d61 736b 273a 2074  tention_mask': t
+000185b0: 656e 736f 7228 5b31 2c20 312c 2031 2c20  ensor([1, 1, 1, 
+000185c0: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+000185d0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+000185e0: 2031 2c20 312c 2031 2c20 312c 2031 2c20   1, 1, 1, 1, 1, 
+000185f0: 312c 2031 2c20 312c 2031 2c20 312c 0a20  1, 1, 1, 1, 1,. 
+00018600: 2020 2020 2020 2020 312c 2031 5d29 2c0a          1, 1]),.
+00018610: 2020 2020 2020 2020 2027 696e 7075 745f           'input_
+00018620: 6964 7327 3a20 7465 6e73 6f72 285b 2020  ids': tensor([  
+00018630: 3130 312c 2032 3933 3533 2c20 2032 3133  101, 29353,  213
+00018640: 352c 2031 3531 3032 2c20 2031 3939 362c  5, 15102,  1996,
+00018650: 2020 3934 3238 2c20 3230 3836 382c 2020    9428, 20868,  
+00018660: 3238 3930 2c20 2038 3636 332c 2020 3638  2890,  8663,  68
+00018670: 3935 2c0a 2020 2020 2020 2020 2020 2020  95,.            
+00018680: 2020 2020 2032 3034 3730 2c20 2032 3537       20470,  257
+00018690: 312c 2020 3336 3633 2c20 2032 3039 302c  1,  3663,  2090,
+000186a0: 2020 3436 3033 2c20 2033 3031 372c 2020    4603,  3017,  
+000186b0: 3330 3038 2c20 2031 3939 382c 2020 3230  3008,  1998,  20
+000186c0: 3337 2c20 3234 3231 312c 0a20 2020 2020  37, 24211,.     
+000186d0: 2020 2020 2020 2020 2020 2020 3536 3337              5637
+000186e0: 2c20 2031 3939 382c 2031 3136 3930 2c20  ,  1998, 11690, 
+000186f0: 2032 3333 362c 2020 3130 3132 2c20 2020   2336,  1012,   
+00018700: 3130 325d 292c 0a20 2020 2020 2020 2020  102]),.         
+00018710: 2774 6f6b 656e 5f74 7970 655f 6964 7327  'token_type_ids'
+00018720: 3a20 7465 6e73 6f72 285b 302c 2030 2c20  : tensor([0, 0, 
+00018730: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00018740: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00018750: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00018760: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00018770: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018780: 2020 2030 2c20 305d 297d 0a20 2020 2020     0, 0])}.     
+00018790: 2020 2060 6060 0a20 2020 2020 2020 2022     ```.        "
+000187a0: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+000187b0: 7365 745f 666f 726d 6174 2822 6375 7374  set_format("cust
+000187c0: 6f6d 222c 2063 6f6c 756d 6e73 3d63 6f6c  om", columns=col
+000187d0: 756d 6e73 2c20 6f75 7470 7574 5f61 6c6c  umns, output_all
+000187e0: 5f63 6f6c 756d 6e73 3d6f 7574 7075 745f  _columns=output_
+000187f0: 616c 6c5f 636f 6c75 6d6e 732c 2074 7261  all_columns, tra
+00018800: 6e73 666f 726d 3d74 7261 6e73 666f 726d  nsform=transform
+00018810: 290a 0a20 2020 2064 6566 2077 6974 685f  )..    def with_
+00018820: 666f 726d 6174 280a 2020 2020 2020 2020  format(.        
+00018830: 7365 6c66 2c0a 2020 2020 2020 2020 7479  self,.        ty
+00018840: 7065 3a20 4f70 7469 6f6e 616c 5b73 7472  pe: Optional[str
+00018850: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00018860: 2020 636f 6c75 6d6e 733a 204f 7074 696f    columns: Optio
+00018870: 6e61 6c5b 4c69 7374 5d20 3d20 4e6f 6e65  nal[List] = None
+00018880: 2c0a 2020 2020 2020 2020 6f75 7470 7574  ,.        output
+00018890: 5f61 6c6c 5f63 6f6c 756d 6e73 3a20 626f  _all_columns: bo
+000188a0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+000188b0: 2020 2020 2a2a 666f 726d 6174 5f6b 7761      **format_kwa
+000188c0: 7267 732c 0a20 2020 2029 3a0a 2020 2020  rgs,.    ):.    
+000188d0: 2020 2020 2222 2253 6574 2060 5f5f 6765      """Set `__ge
+000188e0: 7469 7465 6d5f 5f60 2072 6574 7572 6e20  titem__` return 
+000188f0: 666f 726d 6174 2028 7479 7065 2061 6e64  format (type and
+00018900: 2063 6f6c 756d 6e73 292e 2054 6865 2064   columns). The d
+00018910: 6174 6120 666f 726d 6174 7469 6e67 2069  ata formatting i
+00018920: 7320 6170 706c 6965 6420 6f6e 2d74 6865  s applied on-the
+00018930: 2d66 6c79 2e0a 2020 2020 2020 2020 5468  -fly..        Th
+00018940: 6520 666f 726d 6174 2060 7479 7065 6020  e format `type` 
+00018950: 2866 6f72 2065 7861 6d70 6c65 2022 6e75  (for example "nu
+00018960: 6d70 7922 2920 6973 2075 7365 6420 746f  mpy") is used to
+00018970: 2066 6f72 6d61 7420 6261 7463 6865 7320   format batches 
+00018980: 7768 656e 2075 7369 6e67 2060 5f5f 6765  when using `__ge
+00018990: 7469 7465 6d5f 5f60 2e0a 0a20 2020 2020  titem__`...     
+000189a0: 2020 2049 7427 7320 616c 736f 2070 6f73     It's also pos
+000189b0: 7369 626c 6520 746f 2075 7365 2063 7573  sible to use cus
+000189c0: 746f 6d20 7472 616e 7366 6f72 6d73 2066  tom transforms f
+000189d0: 6f72 2066 6f72 6d61 7474 696e 6720 7573  or formatting us
+000189e0: 696e 6720 5b60 7e64 6174 6173 6574 732e  ing [`~datasets.
+000189f0: 4461 7461 7365 742e 7769 7468 5f74 7261  Dataset.with_tra
+00018a00: 6e73 666f 726d 605d 2e0a 0a20 2020 2020  nsform`]...     
+00018a10: 2020 2043 6f6e 7472 6172 7920 746f 205b     Contrary to [
+00018a20: 607e 6461 7461 7365 7473 2e44 6174 6173  `~datasets.Datas
+00018a30: 6574 2e73 6574 5f66 6f72 6d61 7460 5d2c  et.set_format`],
+00018a40: 2060 7769 7468 5f66 6f72 6d61 7460 2072   `with_format` r
+00018a50: 6574 7572 6e73 2061 206e 6577 205b 6044  eturns a new [`D
+00018a60: 6174 6173 6574 605d 206f 626a 6563 742e  ataset`] object.
+00018a70: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00018a80: 2020 2020 2020 2020 2020 2020 7479 7065              type
+00018a90: 2028 6073 7472 602c 202a 6f70 7469 6f6e   (`str`, *option
+00018aa0: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
+00018ab0: 2020 2020 2020 4569 7468 6572 206f 7574        Either out
+00018ac0: 7075 7420 7479 7065 2073 656c 6563 7465  put type selecte
+00018ad0: 6420 696e 2060 5b4e 6f6e 652c 2027 6e75  d in `[None, 'nu
+00018ae0: 6d70 7927 2c20 2774 6f72 6368 272c 2027  mpy', 'torch', '
+00018af0: 7465 6e73 6f72 666c 6f77 272c 2027 7061  tensorflow', 'pa
+00018b00: 6e64 6173 272c 2027 6172 726f 7727 5d60  ndas', 'arrow']`
+00018b10: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018b20: 2020 604e 6f6e 6560 206d 6561 6e73 2060    `None` means `
+00018b30: 5f5f 6765 7469 7465 6d5f 5f60 2072 6574  __getitem__` ret
+00018b40: 7572 6e73 2070 7974 686f 6e20 6f62 6a65  urns python obje
+00018b50: 6374 7320 2864 6566 6175 6c74 292e 0a20  cts (default).. 
+00018b60: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+00018b70: 6e73 2028 604c 6973 745b 7374 725d 602c  ns (`List[str]`,
+00018b80: 202a 6f70 7469 6f6e 616c 2a29 3a0a 2020   *optional*):.  
+00018b90: 2020 2020 2020 2020 2020 2020 2020 436f                Co
+00018ba0: 6c75 6d6e 7320 746f 2066 6f72 6d61 7420  lumns to format 
+00018bb0: 696e 2074 6865 206f 7574 7075 742e 0a20  in the output.. 
+00018bc0: 2020 2020 2020 2020 2020 2020 2020 2060                 `
+00018bd0: 4e6f 6e65 6020 6d65 616e 7320 605f 5f67  None` means `__g
+00018be0: 6574 6974 656d 5f5f 6020 7265 7475 726e  etitem__` return
+00018bf0: 7320 616c 6c20 636f 6c75 6d6e 7320 2864  s all columns (d
+00018c00: 6566 6175 6c74 292e 0a20 2020 2020 2020  efault)..       
+00018c10: 2020 2020 206f 7574 7075 745f 616c 6c5f       output_all_
+00018c20: 636f 6c75 6d6e 7320 2860 626f 6f6c 602c  columns (`bool`,
+00018c30: 2064 6566 6175 6c74 7320 746f 2060 4661   defaults to `Fa
+00018c40: 6c73 6560 293a 0a20 2020 2020 2020 2020  lse`):.         
+00018c50: 2020 2020 2020 204b 6565 7020 756e 2d66         Keep un-f
+00018c60: 6f72 6d61 7474 6564 2063 6f6c 756d 6e73  ormatted columns
+00018c70: 2061 7320 7765 6c6c 2069 6e20 7468 6520   as well in the 
+00018c80: 6f75 7470 7574 2028 6173 2070 7974 686f  output (as pytho
+00018c90: 6e20 6f62 6a65 6374 7329 2e0a 2020 2020  n objects)..    
+00018ca0: 2020 2020 2020 2020 2a2a 666f 726d 6174          **format
+00018cb0: 5f6b 7761 7267 7320 2861 6464 6974 696f  _kwargs (additio
+00018cc0: 6e61 6c20 6b65 7977 6f72 6420 6172 6775  nal keyword argu
+00018cd0: 6d65 6e74 7329 3a0a 2020 2020 2020 2020  ments):.        
+00018ce0: 2020 2020 2020 2020 4b65 7977 6f72 6473          Keywords
+00018cf0: 2061 7267 756d 656e 7473 2070 6173 7365   arguments passe
+00018d00: 6420 746f 2074 6865 2063 6f6e 7665 7274  d to the convert
+00018d10: 2066 756e 6374 696f 6e20 6c69 6b65 2060   function like `
+00018d20: 6e70 2e61 7272 6179 602c 2060 746f 7263  np.array`, `torc
+00018d30: 682e 7465 6e73 6f72 6020 6f72 2060 7465  h.tensor` or `te
+00018d40: 6e73 6f72 666c 6f77 2e72 6167 6765 642e  nsorflow.ragged.
+00018d50: 636f 6e73 7461 6e74 602e 0a0a 2020 2020  constant`...    
+00018d60: 2020 2020 4578 616d 706c 653a 0a0a 2020      Example:..  
+00018d70: 2020 2020 2020 6060 6070 790a 2020 2020        ```py.    
+00018d80: 2020 2020 3e3e 3e20 6672 6f6d 2064 6174      >>> from dat
+00018d90: 6173 6574 7320 696d 706f 7274 206c 6f61  asets import loa
+00018da0: 645f 6461 7461 7365 740a 2020 2020 2020  d_dataset.      
+00018db0: 2020 3e3e 3e20 6672 6f6d 2074 7261 6e73    >>> from trans
+00018dc0: 666f 726d 6572 7320 696d 706f 7274 2041  formers import A
+00018dd0: 7574 6f54 6f6b 656e 697a 6572 0a20 2020  utoTokenizer.   
+00018de0: 2020 2020 203e 3e3e 2064 7320 3d20 6c6f       >>> ds = lo
+00018df0: 6164 5f64 6174 6173 6574 2822 726f 7474  ad_dataset("rott
+00018e00: 656e 5f74 6f6d 6174 6f65 7322 2c20 7370  en_tomatoes", sp
+00018e10: 6c69 743d 2276 616c 6964 6174 696f 6e22  lit="validation"
+00018e20: 290a 2020 2020 2020 2020 3e3e 3e20 746f  ).        >>> to
+00018e30: 6b65 6e69 7a65 7220 3d20 4175 746f 546f  kenizer = AutoTo
+00018e40: 6b65 6e69 7a65 722e 6672 6f6d 5f70 7265  kenizer.from_pre
+00018e50: 7472 6169 6e65 6428 2262 6572 742d 6261  trained("bert-ba
+00018e60: 7365 2d63 6173 6564 2229 0a20 2020 2020  se-cased").     
+00018e70: 2020 203e 3e3e 2064 7320 3d20 6473 2e6d     >>> ds = ds.m
+00018e80: 6170 286c 616d 6264 6120 783a 2074 6f6b  ap(lambda x: tok
+00018e90: 656e 697a 6572 2878 5b27 7465 7874 275d  enizer(x['text']
+00018ea0: 2c20 7472 756e 6361 7469 6f6e 3d54 7275  , truncation=Tru
+00018eb0: 652c 2070 6164 6469 6e67 3d54 7275 6529  e, padding=True)
+00018ec0: 2c20 6261 7463 6865 643d 5472 7565 290a  , batched=True).
+00018ed0: 2020 2020 2020 2020 3e3e 3e20 6473 2e66          >>> ds.f
+00018ee0: 6f72 6d61 740a 2020 2020 2020 2020 7b27  ormat.        {'
+00018ef0: 636f 6c75 6d6e 7327 3a20 5b27 7465 7874  columns': ['text
+00018f00: 272c 2027 6c61 6265 6c27 2c20 2769 6e70  ', 'label', 'inp
+00018f10: 7574 5f69 6473 272c 2027 746f 6b65 6e5f  ut_ids', 'token_
+00018f20: 7479 7065 5f69 6473 272c 2027 6174 7465  type_ids', 'atte
+00018f30: 6e74 696f 6e5f 6d61 736b 275d 2c0a 2020  ntion_mask'],.  
+00018f40: 2020 2020 2020 2027 666f 726d 6174 5f6b         'format_k
+00018f50: 7761 7267 7327 3a20 7b7d 2c0a 2020 2020  wargs': {},.    
+00018f60: 2020 2020 2027 6f75 7470 7574 5f61 6c6c       'output_all
+00018f70: 5f63 6f6c 756d 6e73 273a 2046 616c 7365  _columns': False
+00018f80: 2c0a 2020 2020 2020 2020 2027 7479 7065  ,.         'type
+00018f90: 273a 204e 6f6e 657d 0a20 2020 2020 2020  ': None}.       
+00018fa0: 203e 3e3e 2064 7320 3d20 6473 2e77 6974   >>> ds = ds.wit
+00018fb0: 685f 666f 726d 6174 2874 7970 653d 2774  h_format(type='t
+00018fc0: 656e 736f 7266 6c6f 7727 2c20 636f 6c75  ensorflow', colu
+00018fd0: 6d6e 733d 5b27 696e 7075 745f 6964 7327  mns=['input_ids'
+00018fe0: 2c20 2774 6f6b 656e 5f74 7970 655f 6964  , 'token_type_id
+00018ff0: 7327 2c20 2761 7474 656e 7469 6f6e 5f6d  s', 'attention_m
+00019000: 6173 6b27 2c20 276c 6162 656c 275d 290a  ask', 'label']).
+00019010: 2020 2020 2020 2020 3e3e 3e20 6473 2e66          >>> ds.f
+00019020: 6f72 6d61 740a 2020 2020 2020 2020 7b27  ormat.        {'
+00019030: 636f 6c75 6d6e 7327 3a20 5b27 696e 7075  columns': ['inpu
+00019040: 745f 6964 7327 2c20 2774 6f6b 656e 5f74  t_ids', 'token_t
+00019050: 7970 655f 6964 7327 2c20 2761 7474 656e  ype_ids', 'atten
+00019060: 7469 6f6e 5f6d 6173 6b27 2c20 276c 6162  tion_mask', 'lab
+00019070: 656c 275d 2c0a 2020 2020 2020 2020 2027  el'],.         '
+00019080: 666f 726d 6174 5f6b 7761 7267 7327 3a20  format_kwargs': 
+00019090: 7b7d 2c0a 2020 2020 2020 2020 2027 6f75  {},.         'ou
+000190a0: 7470 7574 5f61 6c6c 5f63 6f6c 756d 6e73  tput_all_columns
+000190b0: 273a 2046 616c 7365 2c0a 2020 2020 2020  ': False,.      
+000190c0: 2020 2027 7479 7065 273a 2027 7465 6e73     'type': 'tens
+000190d0: 6f72 666c 6f77 277d 0a20 2020 2020 2020  orflow'}.       
+000190e0: 2060 6060 0a20 2020 2020 2020 2022 2222   ```.        """
+000190f0: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
+00019100: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+00019110: 2873 656c 6629 0a20 2020 2020 2020 2064  (self).        d
+00019120: 6174 6173 6574 2e73 6574 5f66 6f72 6d61  ataset.set_forma
+00019130: 7428 7479 7065 3d74 7970 652c 2063 6f6c  t(type=type, col
+00019140: 756d 6e73 3d63 6f6c 756d 6e73 2c20 6f75  umns=columns, ou
+00019150: 7470 7574 5f61 6c6c 5f63 6f6c 756d 6e73  tput_all_columns
+00019160: 3d6f 7574 7075 745f 616c 6c5f 636f 6c75  =output_all_colu
+00019170: 6d6e 732c 202a 2a66 6f72 6d61 745f 6b77  mns, **format_kw
+00019180: 6172 6773 290a 2020 2020 2020 2020 7265  args).        re
+00019190: 7475 726e 2064 6174 6173 6574 0a0a 2020  turn dataset..  
+000191a0: 2020 6465 6620 7769 7468 5f74 7261 6e73    def with_trans
+000191b0: 666f 726d 280a 2020 2020 2020 2020 7365  form(.        se
+000191c0: 6c66 2c0a 2020 2020 2020 2020 7472 616e  lf,.        tran
+000191d0: 7366 6f72 6d3a 204f 7074 696f 6e61 6c5b  sform: Optional[
+000191e0: 4361 6c6c 6162 6c65 5d2c 0a20 2020 2020  Callable],.     
+000191f0: 2020 2063 6f6c 756d 6e73 3a20 4f70 7469     columns: Opti
+00019200: 6f6e 616c 5b4c 6973 745d 203d 204e 6f6e  onal[List] = Non
+00019210: 652c 0a20 2020 2020 2020 206f 7574 7075  e,.        outpu
+00019220: 745f 616c 6c5f 636f 6c75 6d6e 733a 2062  t_all_columns: b
+00019230: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+00019240: 2029 3a0a 2020 2020 2020 2020 2222 2253   ):.        """S
+00019250: 6574 2060 5f5f 6765 7469 7465 6d5f 5f60  et `__getitem__`
+00019260: 2072 6574 7572 6e20 666f 726d 6174 2075   return format u
+00019270: 7369 6e67 2074 6869 7320 7472 616e 7366  sing this transf
+00019280: 6f72 6d2e 2054 6865 2074 7261 6e73 666f  orm. The transfo
+00019290: 726d 2069 7320 6170 706c 6965 6420 6f6e  rm is applied on
+000192a0: 2d74 6865 2d66 6c79 206f 6e20 6261 7463  -the-fly on batc
+000192b0: 6865 7320 7768 656e 2060 5f5f 6765 7469  hes when `__geti
+000192c0: 7465 6d5f 5f60 2069 7320 6361 6c6c 6564  tem__` is called
+000192d0: 2e0a 0a20 2020 2020 2020 2041 7320 5b60  ...        As [`
+000192e0: 7e64 6174 6173 6574 732e 4461 7461 7365  ~datasets.Datase
+000192f0: 742e 7365 745f 666f 726d 6174 605d 2c20  t.set_format`], 
+00019300: 7468 6973 2063 616e 2062 6520 7265 7365  this can be rese
+00019310: 7420 7573 696e 6720 5b60 7e64 6174 6173  t using [`~datas
+00019320: 6574 732e 4461 7461 7365 742e 7265 7365  ets.Dataset.rese
+00019330: 745f 666f 726d 6174 605d 2e0a 0a20 2020  t_format`]...   
+00019340: 2020 2020 2043 6f6e 7472 6172 7920 746f       Contrary to
+00019350: 205b 607e 6461 7461 7365 7473 2e44 6174   [`~datasets.Dat
+00019360: 6173 6574 2e73 6574 5f74 7261 6e73 666f  aset.set_transfo
+00019370: 726d 605d 2c20 6077 6974 685f 7472 616e  rm`], `with_tran
+00019380: 7366 6f72 6d60 2072 6574 7572 6e73 2061  sform` returns a
+00019390: 206e 6577 205b 6044 6174 6173 6574 605d   new [`Dataset`]
+000193a0: 206f 626a 6563 742e 0a0a 2020 2020 2020   object...      
+000193b0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+000193c0: 2020 2020 7472 616e 7366 6f72 6d20 2860      transform (`
+000193d0: 4361 6c6c 6162 6c65 602c 2060 6f70 7469  Callable`, `opti
+000193e0: 6f6e 616c 6029 3a0a 2020 2020 2020 2020  onal`):.        
+000193f0: 2020 2020 2020 2020 5573 6572 2d64 6566          User-def
+00019400: 696e 6564 2066 6f72 6d61 7474 696e 6720  ined formatting 
+00019410: 7472 616e 7366 6f72 6d2c 2072 6570 6c61  transform, repla
+00019420: 6365 7320 7468 6520 666f 726d 6174 2064  ces the format d
+00019430: 6566 696e 6564 2062 7920 5b60 7e64 6174  efined by [`~dat
+00019440: 6173 6574 732e 4461 7461 7365 742e 7365  asets.Dataset.se
+00019450: 745f 666f 726d 6174 605d 2e0a 2020 2020  t_format`]..    
+00019460: 2020 2020 2020 2020 2020 2020 4120 666f              A fo
+00019470: 726d 6174 7469 6e67 2066 756e 6374 696f  rmatting functio
+00019480: 6e20 6973 2061 2063 616c 6c61 626c 6520  n is a callable 
+00019490: 7468 6174 2074 616b 6573 2061 2062 6174  that takes a bat
+000194a0: 6368 2028 6173 2061 2060 6469 6374 6029  ch (as a `dict`)
+000194b0: 2061 7320 696e 7075 7420 616e 6420 7265   as input and re
+000194c0: 7475 726e 7320 6120 6261 7463 682e 0a20  turns a batch.. 
+000194d0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+000194e0: 6869 7320 6675 6e63 7469 6f6e 2069 7320  his function is 
+000194f0: 6170 706c 6965 6420 7269 6768 7420 6265  applied right be
+00019500: 666f 7265 2072 6574 7572 6e69 6e67 2074  fore returning t
+00019510: 6865 206f 626a 6563 7473 2069 6e20 605f  he objects in `_
+00019520: 5f67 6574 6974 656d 5f5f 602e 0a20 2020  _getitem__`..   
+00019530: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
+00019540: 2028 604c 6973 745b 7374 725d 602c 2060   (`List[str]`, `
+00019550: 6f70 7469 6f6e 616c 6029 3a0a 2020 2020  optional`):.    
+00019560: 2020 2020 2020 2020 2020 2020 436f 6c75              Colu
+00019570: 6d6e 7320 746f 2066 6f72 6d61 7420 696e  mns to format in
+00019580: 2074 6865 206f 7574 7075 742e 0a20 2020   the output..   
+00019590: 2020 2020 2020 2020 2020 2020 2049 6620               If 
+000195a0: 7370 6563 6966 6965 642c 2074 6865 6e20  specified, then 
+000195b0: 7468 6520 696e 7075 7420 6261 7463 6820  the input batch 
+000195c0: 6f66 2074 6865 2074 7261 6e73 666f 726d  of the transform
+000195d0: 206f 6e6c 7920 636f 6e74 6169 6e73 2074   only contains t
+000195e0: 686f 7365 2063 6f6c 756d 6e73 2e0a 2020  hose columns..  
+000195f0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00019600: 5f61 6c6c 5f63 6f6c 756d 6e73 2028 6062  _all_columns (`b
+00019610: 6f6f 6c60 2c20 6465 6661 756c 7473 2074  ool`, defaults t
+00019620: 6f20 6046 616c 7365 6029 3a0a 2020 2020  o `False`):.    
+00019630: 2020 2020 2020 2020 2020 2020 4b65 6570              Keep
+00019640: 2075 6e2d 666f 726d 6174 7465 6420 636f   un-formatted co
+00019650: 6c75 6d6e 7320 6173 2077 656c 6c20 696e  lumns as well in
+00019660: 2074 6865 206f 7574 7075 7420 2861 7320   the output (as 
+00019670: 7079 7468 6f6e 206f 626a 6563 7473 292e  python objects).
+00019680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019690: 2049 6620 7365 7420 746f 2060 5472 7565   If set to `True
+000196a0: 602c 2074 6865 6e20 7468 6520 6f74 6865  `, then the othe
+000196b0: 7220 756e 2d66 6f72 6d61 7474 6564 2063  r un-formatted c
+000196c0: 6f6c 756d 6e73 2061 7265 206b 6570 7420  olumns are kept 
+000196d0: 7769 7468 2074 6865 206f 7574 7075 7420  with the output 
+000196e0: 6f66 2074 6865 2074 7261 6e73 666f 726d  of the transform
+000196f0: 2e0a 0a20 2020 2020 2020 2045 7861 6d70  ...        Examp
+00019700: 6c65 3a0a 0a20 2020 2020 2020 2060 6060  le:..        ```
+00019710: 7079 0a20 2020 2020 2020 203e 3e3e 2066  py.        >>> f
+00019720: 726f 6d20 6461 7461 7365 7473 2069 6d70  rom datasets imp
+00019730: 6f72 7420 6c6f 6164 5f64 6174 6173 6574  ort load_dataset
+00019740: 0a20 2020 2020 2020 203e 3e3e 2066 726f  .        >>> fro
+00019750: 6d20 7472 616e 7366 6f72 6d65 7273 2069  m transformers i
+00019760: 6d70 6f72 7420 4175 746f 546f 6b65 6e69  mport AutoTokeni
+00019770: 7a65 720a 2020 2020 2020 2020 3e3e 3e20  zer.        >>> 
+00019780: 6473 203d 206c 6f61 645f 6461 7461 7365  ds = load_datase
+00019790: 7428 2272 6f74 7465 6e5f 746f 6d61 746f  t("rotten_tomato
+000197a0: 6573 222c 2073 706c 6974 3d22 7661 6c69  es", split="vali
+000197b0: 6461 7469 6f6e 2229 0a20 2020 2020 2020  dation").       
+000197c0: 203e 3e3e 2074 6f6b 656e 697a 6572 203d   >>> tokenizer =
+000197d0: 2041 7574 6f54 6f6b 656e 697a 6572 2e66   AutoTokenizer.f
+000197e0: 726f 6d5f 7072 6574 7261 696e 6564 2822  rom_pretrained("
+000197f0: 6265 7274 2d62 6173 652d 6361 7365 6422  bert-base-cased"
+00019800: 290a 2020 2020 2020 2020 3e3e 3e20 6465  ).        >>> de
+00019810: 6620 656e 636f 6465 2865 7861 6d70 6c65  f encode(example
+00019820: 293a 0a20 2020 2020 2020 202e 2e2e 2020  ):.        ...  
+00019830: 2020 2072 6574 7572 6e20 746f 6b65 6e69     return tokeni
+00019840: 7a65 7228 6578 616d 706c 655b 2274 6578  zer(example["tex
+00019850: 7422 5d2c 2070 6164 6469 6e67 3d54 7275  t"], padding=Tru
+00019860: 652c 2074 7275 6e63 6174 696f 6e3d 5472  e, truncation=Tr
+00019870: 7565 2c20 7265 7475 726e 5f74 656e 736f  ue, return_tenso
+00019880: 7273 3d27 7074 2729 0a20 2020 2020 2020  rs='pt').       
+00019890: 203e 3e3e 2064 7320 3d20 6473 2e77 6974   >>> ds = ds.wit
+000198a0: 685f 7472 616e 7366 6f72 6d28 656e 636f  h_transform(enco
+000198b0: 6465 290a 2020 2020 2020 2020 3e3e 3e20  de).        >>> 
+000198c0: 6473 5b30 5d0a 2020 2020 2020 2020 7b27  ds[0].        {'
+000198d0: 6174 7465 6e74 696f 6e5f 6d61 736b 273a  attention_mask':
+000198e0: 2074 656e 736f 7228 5b31 2c20 312c 2031   tensor([1, 1, 1
+000198f0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00019900: 2031 2c20 312c 2031 2c20 312c 2031 2c20   1, 1, 1, 1, 1, 
+00019910: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+00019920: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
+00019930: 0a20 2020 2020 2020 2020 312c 2031 2c20  .         1, 1, 
+00019940: 312c 2031 2c20 315d 292c 0a20 2020 2020  1, 1, 1]),.     
+00019950: 2020 2020 2769 6e70 7574 5f69 6473 273a      'input_ids':
+00019960: 2074 656e 736f 7228 5b20 2031 3031 2c20   tensor([  101, 
+00019970: 3138 3032 372c 2031 3633 3130 2c20 3136  18027, 16310, 16
+00019980: 3030 312c 2020 3131 3033 2c20 2039 3332  001,  1103,  932
+00019990: 312c 2020 2031 3738 2c20 3131 3630 342c  1,   178, 11604,
+000199a0: 2020 3732 3335 2c20 2036 3631 372c 0a20    7235,  6617,. 
+000199b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199c0: 3137 3432 2c20 2032 3136 352c 2020 3238  1742,  2165,  28
+000199d0: 3230 2c20 2031 3230 362c 2020 3635 3838  20,  1206,  6588
+000199e0: 2c20 3232 3537 322c 2031 3239 3337 2c20  , 22572, 12937, 
+000199f0: 2031 3831 312c 2020 3231 3533 2c20 2031   1811,  2153,  1
+00019a00: 3130 352c 0a20 2020 2020 2020 2020 2020  105,.           
+00019a10: 2020 2020 2020 3131 3437 2c20 3132 3839        1147, 1289
+00019a20: 302c 2031 3935 3837 2c20 2036 3436 332c  0, 19587,  6463,
+00019a30: 2020 3131 3035 2c20 3135 3032 362c 2020    1105, 15026,  
+00019a40: 3134 3832 2c20 2020 3131 392c 2020 2031  1482,   119,   1
+00019a50: 3032 5d29 2c0a 2020 2020 2020 2020 2027  02]),.         '
+00019a60: 746f 6b65 6e5f 7479 7065 5f69 6473 273a  token_type_ids':
+00019a70: 2074 656e 736f 7228 5b30 2c20 302c 2030   tensor([0, 0, 0
+00019a80: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00019a90: 2030 2c20 302c 2030 2c20 302c 2030 2c20   0, 0, 0, 0, 0, 
+00019aa0: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+00019ab0: 2c20 302c 2030 2c20 302c 2030 2c20 302c  , 0, 0, 0, 0, 0,
+00019ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019ad0: 2020 302c 2030 2c20 302c 2030 2c20 305d    0, 0, 0, 0, 0]
+00019ae0: 297d 0a20 2020 2020 2020 2060 6060 0a20  )}.        ```. 
+00019af0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00019b00: 2020 2064 6174 6173 6574 203d 2063 6f70     dataset = cop
+00019b10: 792e 6465 6570 636f 7079 2873 656c 6629  y.deepcopy(self)
+00019b20: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
+00019b30: 2e73 6574 5f74 7261 6e73 666f 726d 2874  .set_transform(t
+00019b40: 7261 6e73 666f 726d 3d74 7261 6e73 666f  ransform=transfo
+00019b50: 726d 2c20 636f 6c75 6d6e 733d 636f 6c75  rm, columns=colu
+00019b60: 6d6e 732c 206f 7574 7075 745f 616c 6c5f  mns, output_all_
+00019b70: 636f 6c75 6d6e 733d 6f75 7470 7574 5f61  columns=output_a
+00019b80: 6c6c 5f63 6f6c 756d 6e73 290a 2020 2020  ll_columns).    
+00019b90: 2020 2020 7265 7475 726e 2064 6174 6173      return datas
+00019ba0: 6574 0a0a 2020 2020 6465 6620 7072 6570  et..    def prep
+00019bb0: 6172 655f 666f 725f 7461 736b 2873 656c  are_for_task(sel
+00019bc0: 662c 2074 6173 6b3a 2055 6e69 6f6e 5b73  f, task: Union[s
+00019bd0: 7472 2c20 5461 736b 5465 6d70 6c61 7465  tr, TaskTemplate
+00019be0: 5d2c 2069 643a 2069 6e74 203d 2030 2920  ], id: int = 0) 
+00019bf0: 2d3e 2022 4461 7461 7365 7422 3a0a 2020  -> "Dataset":.  
+00019c00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00019c10: 2020 5072 6570 6172 6520 6120 6461 7461    Prepare a data
+00019c20: 7365 7420 666f 7220 7468 6520 6769 7665  set for the give
+00019c30: 6e20 7461 736b 2062 7920 6361 7374 696e  n task by castin
+00019c40: 6720 7468 6520 6461 7461 7365 7427 7320  g the dataset's 
+00019c50: 5b60 4665 6174 7572 6573 605d 2074 6f20  [`Features`] to 
+00019c60: 7374 616e 6461 7264 697a 6564 2063 6f6c  standardized col
+00019c70: 756d 6e20 6e61 6d65 7320 616e 6420 7479  umn names and ty
+00019c80: 7065 7320 6173 2064 6574 6169 6c65 6420  pes as detailed 
+00019c90: 696e 205b 6064 6174 6173 6574 732e 7461  in [`datasets.ta
+00019ca0: 736b 7360 5d28 2e2f 7461 736b 5f74 656d  sks`](./task_tem
+00019cb0: 706c 6174 6573 292e 0a0a 2020 2020 2020  plates)...      
+00019cc0: 2020 4361 7374 7320 5b60 6461 7461 7365    Casts [`datase
+00019cd0: 7473 2e44 6174 6173 6574 496e 666f 2e66  ts.DatasetInfo.f
+00019ce0: 6561 7475 7265 7360 5d20 6163 636f 7264  eatures`] accord
+00019cf0: 696e 6720 746f 2061 2074 6173 6b2d 7370  ing to a task-sp
+00019d00: 6563 6966 6963 2073 6368 656d 612e 2049  ecific schema. I
+00019d10: 6e74 656e 6465 6420 666f 7220 7369 6e67  ntended for sing
+00019d20: 6c65 2d75 7365 206f 6e6c 792c 2073 6f20  le-use only, so 
+00019d30: 616c 6c20 7461 736b 2074 656d 706c 6174  all task templat
+00019d40: 6573 2061 7265 2072 656d 6f76 6564 2066  es are removed f
+00019d50: 726f 6d20 5b60 6461 7461 7365 7473 2e44  rom [`datasets.D
+00019d60: 6174 6173 6574 496e 666f 2e74 6173 6b5f  atasetInfo.task_
+00019d70: 7465 6d70 6c61 7465 7360 5d20 6166 7465  templates`] afte
+00019d80: 7220 6361 7374 696e 672e 0a0a 2020 2020  r casting...    
+00019d90: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00019da0: 2020 2020 2020 7461 736b 2028 6055 6e69        task (`Uni
+00019db0: 6f6e 5b73 7472 2c20 5461 736b 5465 6d70  on[str, TaskTemp
+00019dc0: 6c61 7465 5d60 293a 0a20 2020 2020 2020  late]`):.       
+00019dd0: 2020 2020 2020 2020 2054 6865 2074 6173           The tas
+00019de0: 6b20 746f 2070 7265 7061 7265 2074 6865  k to prepare the
+00019df0: 2064 6174 6173 6574 2066 6f72 2064 7572   dataset for dur
+00019e00: 696e 6720 7472 6169 6e69 6e67 2061 6e64  ing training and
+00019e10: 2065 7661 6c75 6174 696f 6e2e 2049 6620   evaluation. If 
+00019e20: 6073 7472 602c 2073 7570 706f 7274 6564  `str`, supported
+00019e30: 2074 6173 6b73 2069 6e63 6c75 6465 3a0a   tasks include:.
+00019e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019e50: 202d 2060 2274 6578 742d 636c 6173 7369   - `"text-classi
+00019e60: 6669 6361 7469 6f6e 2260 0a20 2020 2020  fication"`.     
+00019e70: 2020 2020 2020 2020 2020 202d 2060 2271             - `"q
+00019e80: 7565 7374 696f 6e2d 616e 7377 6572 696e  uestion-answerin
+00019e90: 6722 600a 0a20 2020 2020 2020 2020 2020  g"`..           
+00019ea0: 2020 2020 2049 6620 5b60 5461 736b 5465       If [`TaskTe
+00019eb0: 6d70 6c61 7465 605d 2c20 6d75 7374 2062  mplate`], must b
+00019ec0: 6520 6f6e 6520 6f66 2074 6865 2074 6173  e one of the tas
+00019ed0: 6b20 7465 6d70 6c61 7465 7320 696e 205b  k templates in [
+00019ee0: 6064 6174 6173 6574 732e 7461 736b 7360  `datasets.tasks`
+00019ef0: 5d28 2e2f 7461 736b 5f74 656d 706c 6174  ](./task_templat
+00019f00: 6573 292e 0a20 2020 2020 2020 2020 2020  es)..           
+00019f10: 2069 6420 2860 696e 7460 2c20 6465 6661   id (`int`, defa
+00019f20: 756c 7473 2074 6f20 6030 6029 3a0a 2020  ults to `0`):.  
+00019f30: 2020 2020 2020 2020 2020 2020 2020 5468                Th
+00019f40: 6520 6964 2072 6571 7569 7265 6420 746f  e id required to
+00019f50: 2075 6e61 6d62 6967 756f 7573 6c79 2069   unambiguously i
+00019f60: 6465 6e74 6966 7920 7468 6520 7461 736b  dentify the task
+00019f70: 2074 656d 706c 6174 6520 7768 656e 206d   template when m
+00019f80: 756c 7469 706c 6520 7461 736b 2074 656d  ultiple task tem
+00019f90: 706c 6174 6573 206f 6620 7468 6520 7361  plates of the sa
+00019fa0: 6d65 2074 7970 6520 6172 6520 7375 7070  me type are supp
+00019fb0: 6f72 7465 642e 0a20 2020 2020 2020 2022  orted..        "
+00019fc0: 2222 0a20 2020 2020 2020 2023 2054 4f44  "".        # TOD
+00019fd0: 4f28 6c65 7774 756e 293a 2041 6464 2073  O(lewtun): Add s
+00019fe0: 7570 706f 7274 2066 6f72 2063 6173 7469  upport for casti
+00019ff0: 6e67 206e 6573 7465 6420 6665 6174 7572  ng nested featur
+0001a000: 6573 206c 696b 6520 616e 7377 6572 732e  es like answers.
+0001a010: 7465 7874 2061 6e64 2061 6e73 7765 7273  text and answers
+0001a020: 2e61 6e73 7765 725f 7374 6172 7420 696e  .answer_start in
+0001a030: 2053 5175 4144 0a20 2020 2020 2020 2069   SQuAD.        i
+0001a040: 6620 6973 696e 7374 616e 6365 2874 6173  f isinstance(tas
+0001a050: 6b2c 2073 7472 293a 0a20 2020 2020 2020  k, str):.       
+0001a060: 2020 2020 2074 6173 6b73 203d 205b 7465       tasks = [te
+0001a070: 6d70 6c61 7465 2e74 6173 6b20 666f 7220  mplate.task for 
+0001a080: 7465 6d70 6c61 7465 2069 6e20 2873 656c  template in (sel
+0001a090: 662e 696e 666f 2e74 6173 6b5f 7465 6d70  f.info.task_temp
+0001a0a0: 6c61 7465 7320 6f72 205b 5d29 5d0a 2020  lates or [])].  
+0001a0b0: 2020 2020 2020 2020 2020 636f 6d70 6174            compat
+0001a0c0: 6962 6c65 5f74 656d 706c 6174 6573 203d  ible_templates =
+0001a0d0: 205b 7465 6d70 6c61 7465 2066 6f72 2074   [template for t
+0001a0e0: 656d 706c 6174 6520 696e 2028 7365 6c66  emplate in (self
+0001a0f0: 2e69 6e66 6f2e 7461 736b 5f74 656d 706c  .info.task_templ
+0001a100: 6174 6573 206f 7220 5b5d 2920 6966 2074  ates or []) if t
+0001a110: 656d 706c 6174 652e 7461 736b 203d 3d20  emplate.task == 
+0001a120: 7461 736b 5d0a 2020 2020 2020 2020 2020  task].          
+0001a130: 2020 6966 206e 6f74 2063 6f6d 7061 7469    if not compati
+0001a140: 626c 655f 7465 6d70 6c61 7465 733a 0a20  ble_templates:. 
+0001a150: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001a160: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0001a170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a180: 2020 2020 2066 2254 6173 6b20 7b74 6173       f"Task {tas
+0001a190: 6b7d 2069 7320 6e6f 7420 636f 6d70 6174  k} is not compat
+0001a1a0: 6962 6c65 2077 6974 6820 7468 6973 2064  ible with this d
+0001a1b0: 6174 6173 6574 2120 4176 6169 6c61 626c  ataset! Availabl
+0001a1c0: 6520 7461 736b 733a 207b 6c69 7374 2875  e tasks: {list(u
+0001a1d0: 6e69 7175 655f 7661 6c75 6573 2874 6173  nique_values(tas
+0001a1e0: 6b73 2929 7d22 0a20 2020 2020 2020 2020  ks))}".         
+0001a1f0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0001a200: 2020 2020 2020 6966 206e 6f74 2030 203c        if not 0 <
+0001a210: 3d20 6964 203c 206c 656e 2863 6f6d 7061  = id < len(compa
+0001a220: 7469 626c 655f 7465 6d70 6c61 7465 7329  tible_templates)
+0001a230: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a240: 2020 7465 6d70 6c61 7465 735f 6c69 7374    templates_list
+0001a250: 5f73 7472 203d 2022 5c6e 222e 6a6f 696e  _str = "\n".join
+0001a260: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001a270: 2020 2020 2020 6622 2d20 607b 6964 787d        f"- `{idx}
+0001a280: 6020 666f 7220 7461 736b 207b 7465 6d70  ` for task {temp
+0001a290: 6c61 7465 7d22 2066 6f72 2069 6478 2c20  late}" for idx, 
+0001a2a0: 7465 6d70 6c61 7465 2069 6e20 656e 756d  template in enum
+0001a2b0: 6572 6174 6528 636f 6d70 6174 6962 6c65  erate(compatible
+0001a2c0: 5f74 656d 706c 6174 6573 290a 2020 2020  _templates).    
+0001a2d0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001a2e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0001a2f0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+0001a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a310: 2020 2020 6622 4964 207b 6964 7d20 666f      f"Id {id} fo
+0001a320: 7220 7461 736b 207b 7461 736b 7d20 6973  r task {task} is
+0001a330: 206e 6f74 2069 6e20 6120 7661 6c69 6420   not in a valid 
+0001a340: 7261 6e67 652e 2053 7570 706f 7274 6564  range. Supported
+0001a350: 2069 6473 3a5c 6e7b 7465 6d70 6c61 7465   ids:\n{template
+0001a360: 735f 6c69 7374 5f73 7472 7d22 0a20 2020  s_list_str}".   
+0001a370: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001a380: 2020 2020 2020 2020 2020 2074 656d 706c             templ
+0001a390: 6174 6520 3d20 636f 6d70 6174 6962 6c65  ate = compatible
+0001a3a0: 5f74 656d 706c 6174 6573 5b69 645d 0a20  _templates[id]. 
+0001a3b0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+0001a3c0: 7374 616e 6365 2874 6173 6b2c 2054 6173  stance(task, Tas
+0001a3d0: 6b54 656d 706c 6174 6529 3a0a 2020 2020  kTemplate):.    
+0001a3e0: 2020 2020 2020 2020 7465 6d70 6c61 7465          template
+0001a3f0: 203d 2074 6173 6b0a 2020 2020 2020 2020   = task.        
+0001a400: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001a410: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0001a420: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0001a430: 2020 2020 6622 4578 7065 6374 6564 2061      f"Expected a
+0001a440: 2060 7374 7260 206f 7220 6064 6174 6173   `str` or `datas
+0001a450: 6574 732e 5461 736b 5465 6d70 6c61 7465  ets.TaskTemplate
+0001a460: 6020 6f62 6a65 6374 2062 7574 2067 6f74  ` object but got
+0001a470: 2074 6173 6b20 7b74 6173 6b7d 2077 6974   task {task} wit
+0001a480: 6820 7479 7065 207b 7479 7065 2874 6173  h type {type(tas
+0001a490: 6b29 7d2e 220a 2020 2020 2020 2020 2020  k)}.".          
+0001a4a0: 2020 290a 2020 2020 2020 2020 7465 6d70    ).        temp
+0001a4b0: 6c61 7465 203d 2074 656d 706c 6174 652e  late = template.
+0001a4c0: 616c 6967 6e5f 7769 7468 5f66 6561 7475  align_with_featu
+0001a4d0: 7265 7328 7365 6c66 2e69 6e66 6f2e 6665  res(self.info.fe
+0001a4e0: 6174 7572 6573 290a 2020 2020 2020 2020  atures).        
+0001a4f0: 636f 6c75 6d6e 5f6d 6170 7069 6e67 203d  column_mapping =
+0001a500: 2074 656d 706c 6174 652e 636f 6c75 6d6e   template.column
+0001a510: 5f6d 6170 7069 6e67 0a20 2020 2020 2020  _mapping.       
+0001a520: 2063 6f6c 756d 6e73 5f74 6f5f 6472 6f70   columns_to_drop
+0001a530: 203d 205b 636f 6c75 6d6e 2066 6f72 2063   = [column for c
+0001a540: 6f6c 756d 6e20 696e 2073 656c 662e 636f  olumn in self.co
+0001a550: 6c75 6d6e 5f6e 616d 6573 2069 6620 636f  lumn_names if co
+0001a560: 6c75 6d6e 206e 6f74 2069 6e20 636f 6c75  lumn not in colu
+0001a570: 6d6e 5f6d 6170 7069 6e67 5d0a 2020 2020  mn_mapping].    
+0001a580: 2020 2020 6461 7461 7365 7420 3d20 7365      dataset = se
+0001a590: 6c66 2e72 656d 6f76 655f 636f 6c75 6d6e  lf.remove_column
+0001a5a0: 7328 636f 6c75 6d6e 735f 746f 5f64 726f  s(columns_to_dro
+0001a5b0: 7029 0a20 2020 2020 2020 2064 6174 6173  p).        datas
+0001a5c0: 6574 203d 2064 6174 6173 6574 2e72 656e  et = dataset.ren
+0001a5d0: 616d 655f 636f 6c75 6d6e 7328 636f 6c75  ame_columns(colu
+0001a5e0: 6d6e 5f6d 6170 7069 6e67 290a 2020 2020  mn_mapping).    
+0001a5f0: 2020 2020 2320 5765 2066 6f75 6e64 2061      # We found a
+0001a600: 2074 656d 706c 6174 6520 736f 206e 6f77   template so now
+0001a610: 2066 6c75 7368 2060 4461 7461 7365 7449   flush `DatasetI
+0001a620: 6e66 6f60 2074 6f20 736b 6970 2074 6865  nfo` to skip the
+0001a630: 2074 656d 706c 6174 6520 7570 6461 7465   template update
+0001a640: 2069 6e20 6044 6174 6173 6574 496e 666f   in `DatasetInfo
+0001a650: 2e5f 5f70 6f73 745f 696e 6974 5f5f 600a  .__post_init__`.
+0001a660: 2020 2020 2020 2020 6461 7461 7365 742e          dataset.
+0001a670: 696e 666f 2e74 6173 6b5f 7465 6d70 6c61  info.task_templa
+0001a680: 7465 7320 3d20 4e6f 6e65 0a20 2020 2020  tes = None.     
+0001a690: 2020 2064 6174 6173 6574 203d 2064 6174     dataset = dat
+0001a6a0: 6173 6574 2e63 6173 7428 6665 6174 7572  aset.cast(featur
+0001a6b0: 6573 3d74 656d 706c 6174 652e 6665 6174  es=template.feat
+0001a6c0: 7572 6573 290a 2020 2020 2020 2020 7265  ures).        re
+0001a6d0: 7475 726e 2064 6174 6173 6574 0a0a 2020  turn dataset..  
+0001a6e0: 2020 6465 6620 5f67 6574 6974 656d 2873    def _getitem(s
+0001a6f0: 656c 662c 206b 6579 3a20 556e 696f 6e5b  elf, key: Union[
+0001a700: 696e 742c 2073 6c69 6365 2c20 7374 725d  int, slice, str]
+0001a710: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2055  , **kwargs) -> U
+0001a720: 6e69 6f6e 5b44 6963 742c 204c 6973 745d  nion[Dict, List]
+0001a730: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001a740: 2020 2020 2020 4361 6e20 6265 2075 7365        Can be use
+0001a750: 6420 746f 2069 6e64 6578 2063 6f6c 756d  d to index colum
+0001a760: 6e73 2028 6279 2073 7472 696e 6720 6e61  ns (by string na
+0001a770: 6d65 7329 206f 7220 726f 7773 2028 6279  mes) or rows (by
+0001a780: 2069 6e74 6567 6572 2069 6e64 6578 2c20   integer index, 
+0001a790: 736c 6963 6573 2c20 6f72 2069 7465 7220  slices, or iter 
+0001a7a0: 6f66 2069 6e64 6963 6573 206f 7220 626f  of indices or bo
+0001a7b0: 6f6c 7329 0a20 2020 2020 2020 2022 2222  ols).        """
+0001a7c0: 0a20 2020 2020 2020 2066 6f72 6d61 745f  .        format_
+0001a7d0: 7479 7065 203d 206b 7761 7267 735b 2266  type = kwargs["f
+0001a7e0: 6f72 6d61 745f 7479 7065 225d 2069 6620  ormat_type"] if 
+0001a7f0: 2266 6f72 6d61 745f 7479 7065 2220 696e  "format_type" in
+0001a800: 206b 7761 7267 7320 656c 7365 2073 656c   kwargs else sel
+0001a810: 662e 5f66 6f72 6d61 745f 7479 7065 0a20  f._format_type. 
+0001a820: 2020 2020 2020 2066 6f72 6d61 745f 636f         format_co
+0001a830: 6c75 6d6e 7320 3d20 6b77 6172 6773 5b22  lumns = kwargs["
+0001a840: 666f 726d 6174 5f63 6f6c 756d 6e73 225d  format_columns"]
+0001a850: 2069 6620 2266 6f72 6d61 745f 636f 6c75   if "format_colu
+0001a860: 6d6e 7322 2069 6e20 6b77 6172 6773 2065  mns" in kwargs e
+0001a870: 6c73 6520 7365 6c66 2e5f 666f 726d 6174  lse self._format
+0001a880: 5f63 6f6c 756d 6e73 0a20 2020 2020 2020  _columns.       
+0001a890: 206f 7574 7075 745f 616c 6c5f 636f 6c75   output_all_colu
+0001a8a0: 6d6e 7320 3d20 280a 2020 2020 2020 2020  mns = (.        
+0001a8b0: 2020 2020 6b77 6172 6773 5b22 6f75 7470      kwargs["outp
+0001a8c0: 7574 5f61 6c6c 5f63 6f6c 756d 6e73 225d  ut_all_columns"]
+0001a8d0: 2069 6620 226f 7574 7075 745f 616c 6c5f   if "output_all_
+0001a8e0: 636f 6c75 6d6e 7322 2069 6e20 6b77 6172  columns" in kwar
+0001a8f0: 6773 2065 6c73 6520 7365 6c66 2e5f 6f75  gs else self._ou
+0001a900: 7470 7574 5f61 6c6c 5f63 6f6c 756d 6e73  tput_all_columns
+0001a910: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0001a920: 2020 2066 6f72 6d61 745f 6b77 6172 6773     format_kwargs
+0001a930: 203d 206b 7761 7267 735b 2266 6f72 6d61   = kwargs["forma
+0001a940: 745f 6b77 6172 6773 225d 2069 6620 2266  t_kwargs"] if "f
+0001a950: 6f72 6d61 745f 6b77 6172 6773 2220 696e  ormat_kwargs" in
+0001a960: 206b 7761 7267 7320 656c 7365 2073 656c   kwargs else sel
+0001a970: 662e 5f66 6f72 6d61 745f 6b77 6172 6773  f._format_kwargs
+0001a980: 0a20 2020 2020 2020 2066 6f72 6d61 745f  .        format_
+0001a990: 6b77 6172 6773 203d 2066 6f72 6d61 745f  kwargs = format_
+0001a9a0: 6b77 6172 6773 2069 6620 666f 726d 6174  kwargs if format
+0001a9b0: 5f6b 7761 7267 7320 6973 206e 6f74 204e  _kwargs is not N
+0001a9c0: 6f6e 6520 656c 7365 207b 7d0a 2020 2020  one else {}.    
+0001a9d0: 2020 2020 666f 726d 6174 7465 7220 3d20      formatter = 
+0001a9e0: 6765 745f 666f 726d 6174 7465 7228 666f  get_formatter(fo
+0001a9f0: 726d 6174 5f74 7970 652c 2066 6561 7475  rmat_type, featu
+0001aa00: 7265 733d 7365 6c66 2e66 6561 7475 7265  res=self.feature
+0001aa10: 732c 202a 2a66 6f72 6d61 745f 6b77 6172  s, **format_kwar
+0001aa20: 6773 290a 2020 2020 2020 2020 7061 5f73  gs).        pa_s
+0001aa30: 7562 7461 626c 6520 3d20 7175 6572 795f  ubtable = query_
+0001aa40: 7461 626c 6528 7365 6c66 2e5f 6461 7461  table(self._data
+0001aa50: 2c20 6b65 792c 2069 6e64 6963 6573 3d73  , key, indices=s
+0001aa60: 656c 662e 5f69 6e64 6963 6573 2069 6620  elf._indices if 
+0001aa70: 7365 6c66 2e5f 696e 6469 6365 7320 6973  self._indices is
+0001aa80: 206e 6f74 204e 6f6e 6520 656c 7365 204e   not None else N
+0001aa90: 6f6e 6529 0a20 2020 2020 2020 2066 6f72  one).        for
+0001aaa0: 6d61 7474 6564 5f6f 7574 7075 7420 3d20  matted_output = 
+0001aab0: 666f 726d 6174 5f74 6162 6c65 280a 2020  format_table(.  
+0001aac0: 2020 2020 2020 2020 2020 7061 5f73 7562            pa_sub
+0001aad0: 7461 626c 652c 206b 6579 2c20 666f 726d  table, key, form
+0001aae0: 6174 7465 723d 666f 726d 6174 7465 722c  atter=formatter,
+0001aaf0: 2066 6f72 6d61 745f 636f 6c75 6d6e 733d   format_columns=
+0001ab00: 666f 726d 6174 5f63 6f6c 756d 6e73 2c20  format_columns, 
+0001ab10: 6f75 7470 7574 5f61 6c6c 5f63 6f6c 756d  output_all_colum
+0001ab20: 6e73 3d6f 7574 7075 745f 616c 6c5f 636f  ns=output_all_co
+0001ab30: 6c75 6d6e 730a 2020 2020 2020 2020 290a  lumns.        ).
+0001ab40: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+0001ab50: 6f72 6d61 7474 6564 5f6f 7574 7075 740a  ormatted_output.
+0001ab60: 0a20 2020 2040 6f76 6572 6c6f 6164 0a20  .    @overload. 
+0001ab70: 2020 2064 6566 205f 5f67 6574 6974 656d     def __getitem
+0001ab80: 5f5f 2873 656c 662c 206b 6579 3a20 556e  __(self, key: Un
+0001ab90: 696f 6e5b 696e 742c 2073 6c69 6365 2c20  ion[int, slice, 
+0001aba0: 4974 6572 6162 6c65 5b69 6e74 5d5d 2920  Iterable[int]]) 
+0001abb0: 2d3e 2044 6963 743a 2020 2320 6e6f 7161  -> Dict:  # noqa
+0001abc0: 3a20 4638 3131 0a20 2020 2020 2020 202e  : F811.        .
+0001abd0: 2e2e 0a0a 2020 2020 406f 7665 726c 6f61  ....    @overloa
+0001abe0: 640a 2020 2020 6465 6620 5f5f 6765 7469  d.    def __geti
+0001abf0: 7465 6d5f 5f28 7365 6c66 2c20 6b65 793a  tem__(self, key:
+0001ac00: 2073 7472 2920 2d3e 204c 6973 743a 2020   str) -> List:  
+0001ac10: 2320 6e6f 7161 3a20 4638 3131 0a20 2020  # noqa: F811.   
+0001ac20: 2020 2020 202e 2e2e 0a0a 2020 2020 6465       .....    de
+0001ac30: 6620 5f5f 6765 7469 7465 6d5f 5f28 7365  f __getitem__(se
+0001ac40: 6c66 2c20 6b65 7929 3a20 2023 206e 6f71  lf, key):  # noq
+0001ac50: 613a 2046 3831 310a 2020 2020 2020 2020  a: F811.        
+0001ac60: 2222 2243 616e 2062 6520 7573 6564 2074  """Can be used t
+0001ac70: 6f20 696e 6465 7820 636f 6c75 6d6e 7320  o index columns 
+0001ac80: 2862 7920 7374 7269 6e67 206e 616d 6573  (by string names
+0001ac90: 2920 6f72 2072 6f77 7320 2862 7920 696e  ) or rows (by in
+0001aca0: 7465 6765 7220 696e 6465 7820 6f72 2069  teger index or i
+0001acb0: 7465 7261 626c 6520 6f66 2069 6e64 6963  terable of indic
+0001acc0: 6573 206f 7220 626f 6f6c 7329 2e22 2222  es or bools)."""
+0001acd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001ace0: 7365 6c66 2e5f 6765 7469 7465 6d28 0a20  self._getitem(. 
+0001acf0: 2020 2020 2020 2020 2020 206b 6579 2c0a             key,.
+0001ad00: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+0001ad10: 6566 2063 6c65 616e 7570 5f63 6163 6865  ef cleanup_cache
+0001ad20: 5f66 696c 6573 2873 656c 6629 202d 3e20  _files(self) -> 
+0001ad30: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
+0001ad40: 436c 6561 6e20 7570 2061 6c6c 2063 6163  Clean up all cac
+0001ad50: 6865 2066 696c 6573 2069 6e20 7468 6520  he files in the 
+0001ad60: 6461 7461 7365 7420 6361 6368 6520 6469  dataset cache di
+0001ad70: 7265 6374 6f72 792c 2065 7863 6570 7465  rectory, excepte
+0001ad80: 6420 7468 6520 6375 7272 656e 746c 7920  d the currently 
+0001ad90: 7573 6564 2063 6163 6865 2066 696c 6520  used cache file 
+0001ada0: 6966 2074 6865 7265 2069 730a 2020 2020  if there is.    
+0001adb0: 2020 2020 6f6e 652e 0a0a 2020 2020 2020      one...      
+0001adc0: 2020 4265 2063 6172 6566 756c 2077 6865    Be careful whe
+0001add0: 6e20 7275 6e6e 696e 6720 7468 6973 2063  n running this c
+0001ade0: 6f6d 6d61 6e64 2074 6861 7420 6e6f 206f  ommand that no o
+0001adf0: 7468 6572 2070 726f 6365 7373 2069 7320  ther process is 
+0001ae00: 6375 7272 656e 746c 7920 7573 696e 6720  currently using 
+0001ae10: 6f74 6865 7220 6361 6368 6520 6669 6c65  other cache file
+0001ae20: 732e 0a0a 2020 2020 2020 2020 5265 7475  s...        Retu
+0001ae30: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
+0001ae40: 2060 696e 7460 3a20 4e75 6d62 6572 206f   `int`: Number o
+0001ae50: 6620 7265 6d6f 7665 6420 6669 6c65 732e  f removed files.
+0001ae60: 0a0a 2020 2020 2020 2020 4578 616d 706c  ..        Exampl
+0001ae70: 653a 0a0a 2020 2020 2020 2020 6060 6070  e:..        ```p
+0001ae80: 790a 2020 2020 2020 2020 3e3e 3e20 6672  y.        >>> fr
+0001ae90: 6f6d 2064 6174 6173 6574 7320 696d 706f  om datasets impo
+0001aea0: 7274 206c 6f61 645f 6461 7461 7365 740a  rt load_dataset.
+0001aeb0: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
+0001aec0: 206c 6f61 645f 6461 7461 7365 7428 2272   load_dataset("r
+0001aed0: 6f74 7465 6e5f 746f 6d61 746f 6573 222c  otten_tomatoes",
+0001aee0: 2073 706c 6974 3d22 7661 6c69 6461 7469   split="validati
+0001aef0: 6f6e 2229 0a20 2020 2020 2020 203e 3e3e  on").        >>>
+0001af00: 2064 732e 636c 6561 6e75 705f 6361 6368   ds.cleanup_cach
+0001af10: 655f 6669 6c65 7328 290a 2020 2020 2020  e_files().      
+0001af20: 2020 3130 0a20 2020 2020 2020 2060 6060    10.        ```
+0001af30: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001af40: 2020 2020 2063 7572 7265 6e74 5f63 6163       current_cac
+0001af50: 6865 5f66 696c 6573 203d 205b 6f73 2e70  he_files = [os.p
+0001af60: 6174 682e 6162 7370 6174 6828 6361 6368  ath.abspath(cach
+0001af70: 655f 6669 6c65 5b22 6669 6c65 6e61 6d65  e_file["filename
+0001af80: 225d 2920 666f 7220 6361 6368 655f 6669  "]) for cache_fi
+0001af90: 6c65 2069 6e20 7365 6c66 2e63 6163 6865  le in self.cache
+0001afa0: 5f66 696c 6573 5d0a 2020 2020 2020 2020  _files].        
+0001afb0: 6966 206e 6f74 2063 7572 7265 6e74 5f63  if not current_c
+0001afc0: 6163 6865 5f66 696c 6573 3a0a 2020 2020  ache_files:.    
+0001afd0: 2020 2020 2020 2020 7265 7475 726e 2030          return 0
+0001afe0: 0a20 2020 2020 2020 2063 6163 6865 5f64  .        cache_d
+0001aff0: 6972 6563 746f 7279 203d 206f 732e 7061  irectory = os.pa
+0001b000: 7468 2e64 6972 6e61 6d65 2863 7572 7265  th.dirname(curre
+0001b010: 6e74 5f63 6163 6865 5f66 696c 6573 5b30  nt_cache_files[0
+0001b020: 5d29 0a20 2020 2020 2020 206c 6f67 6765  ]).        logge
+0001b030: 722e 696e 666f 2866 224c 6973 7469 6e67  r.info(f"Listing
+0001b040: 2066 696c 6573 2069 6e20 7b63 6163 6865   files in {cache
+0001b050: 5f64 6972 6563 746f 7279 7d22 290a 2020  _directory}").  
+0001b060: 2020 2020 2020 6669 6c65 733a 204c 6973        files: Lis
+0001b070: 745b 7374 725d 203d 206f 732e 6c69 7374  t[str] = os.list
+0001b080: 6469 7228 6361 6368 655f 6469 7265 6374  dir(cache_direct
+0001b090: 6f72 7929 0a20 2020 2020 2020 2066 696c  ory).        fil
+0001b0a0: 6573 5f74 6f5f 7265 6d6f 7665 203d 205b  es_to_remove = [
+0001b0b0: 5d0a 2020 2020 2020 2020 666f 7220 665f  ].        for f_
+0001b0c0: 6e61 6d65 2069 6e20 6669 6c65 733a 0a20  name in files:. 
+0001b0d0: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
+0001b0e0: 6e61 6d65 203d 206f 732e 7061 7468 2e61  name = os.path.a
+0001b0f0: 6273 7061 7468 286f 732e 7061 7468 2e6a  bspath(os.path.j
+0001b100: 6f69 6e28 6361 6368 655f 6469 7265 6374  oin(cache_direct
+0001b110: 6f72 792c 2066 5f6e 616d 6529 290a 2020  ory, f_name)).  
+0001b120: 2020 2020 2020 2020 2020 6966 2066 5f6e            if f_n
+0001b130: 616d 652e 7374 6172 7473 7769 7468 2822  ame.startswith("
+0001b140: 6361 6368 652d 2229 2061 6e64 2066 5f6e  cache-") and f_n
+0001b150: 616d 652e 656e 6473 7769 7468 2822 2e61  ame.endswith(".a
+0001b160: 7272 6f77 2229 3a0a 2020 2020 2020 2020  rrow"):.        
+0001b170: 2020 2020 2020 2020 6966 2066 756c 6c5f          if full_
+0001b180: 6e61 6d65 2069 6e20 6375 7272 656e 745f  name in current_
+0001b190: 6361 6368 655f 6669 6c65 733a 0a20 2020  cache_files:.   
+0001b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1b0: 206c 6f67 6765 722e 696e 666f 2866 224b   logger.info(f"K
+0001b1c0: 6565 7069 6e67 2063 7572 7265 6e74 6c79  eeping currently
+0001b1d0: 2075 7365 6420 6361 6368 6520 6669 6c65   used cache file
+0001b1e0: 2061 7420 7b66 756c 6c5f 6e61 6d65 7d22   at {full_name}"
+0001b1f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001b200: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0001b210: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001b220: 696c 6573 5f74 6f5f 7265 6d6f 7665 2e61  iles_to_remove.a
+0001b230: 7070 656e 6428 6675 6c6c 5f6e 616d 6529  ppend(full_name)
+0001b240: 0a20 2020 2020 2020 2066 6f72 2066 696c  .        for fil
+0001b250: 655f 7061 7468 2069 6e20 6669 6c65 735f  e_path in files_
+0001b260: 746f 5f72 656d 6f76 653a 0a20 2020 2020  to_remove:.     
+0001b270: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
+0001b280: 666f 2866 2252 656d 6f76 696e 6720 7b66  fo(f"Removing {f
+0001b290: 696c 655f 7061 7468 7d22 290a 2020 2020  ile_path}").    
+0001b2a0: 2020 2020 2020 2020 6f73 2e72 656d 6f76          os.remov
+0001b2b0: 6528 6669 6c65 5f70 6174 6829 0a20 2020  e(file_path).   
+0001b2c0: 2020 2020 2072 6574 7572 6e20 6c65 6e28       return len(
+0001b2d0: 6669 6c65 735f 746f 5f72 656d 6f76 6529  files_to_remove)
+0001b2e0: 0a0a 2020 2020 6465 6620 5f67 6574 5f63  ..    def _get_c
+0001b2f0: 6163 6865 5f66 696c 655f 7061 7468 2873  ache_file_path(s
+0001b300: 656c 662c 2066 696e 6765 7270 7269 6e74  elf, fingerprint
+0001b310: 293a 0a20 2020 2020 2020 2069 6620 6973  ):.        if is
+0001b320: 5f63 6163 6869 6e67 5f65 6e61 626c 6564  _caching_enabled
+0001b330: 2829 2061 6e64 2073 656c 662e 6361 6368  () and self.cach
+0001b340: 655f 6669 6c65 733a 0a20 2020 2020 2020  e_files:.       
+0001b350: 2020 2020 2063 6163 6865 5f66 696c 655f       cache_file_
+0001b360: 6e61 6d65 203d 2022 6361 6368 652d 2220  name = "cache-" 
+0001b370: 2b20 6669 6e67 6572 7072 696e 7420 2b20  + fingerprint + 
+0001b380: 222e 6172 726f 7722 0a20 2020 2020 2020  ".arrow".       
+0001b390: 2020 2020 2063 6163 6865 5f64 6972 6563       cache_direc
+0001b3a0: 746f 7279 203d 206f 732e 7061 7468 2e64  tory = os.path.d
+0001b3b0: 6972 6e61 6d65 2873 656c 662e 6361 6368  irname(self.cach
+0001b3c0: 655f 6669 6c65 735b 305d 5b22 6669 6c65  e_files[0]["file
+0001b3d0: 6e61 6d65 225d 290a 2020 2020 2020 2020  name"]).        
+0001b3e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001b3f0: 2020 6361 6368 655f 6669 6c65 5f6e 616d    cache_file_nam
+0001b400: 6520 3d20 2263 6163 6865 2d22 202b 2067  e = "cache-" + g
+0001b410: 656e 6572 6174 655f 7261 6e64 6f6d 5f66  enerate_random_f
+0001b420: 696e 6765 7270 7269 6e74 2829 202b 2022  ingerprint() + "
+0001b430: 2e61 7272 6f77 220a 2020 2020 2020 2020  .arrow".        
+0001b440: 2020 2020 6361 6368 655f 6469 7265 6374      cache_direct
+0001b450: 6f72 7920 3d20 6765 745f 7465 6d70 6f72  ory = get_tempor
+0001b460: 6172 795f 6361 6368 655f 6669 6c65 735f  ary_cache_files_
+0001b470: 6469 7265 6374 6f72 7928 290a 2020 2020  directory().    
+0001b480: 2020 2020 6361 6368 655f 6669 6c65 5f70      cache_file_p
+0001b490: 6174 6820 3d20 6f73 2e70 6174 682e 6a6f  ath = os.path.jo
+0001b4a0: 696e 2863 6163 6865 5f64 6972 6563 746f  in(cache_directo
+0001b4b0: 7279 2c20 6361 6368 655f 6669 6c65 5f6e  ry, cache_file_n
+0001b4c0: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
+0001b4d0: 7572 6e20 6361 6368 655f 6669 6c65 5f70  urn cache_file_p
+0001b4e0: 6174 680a 0a20 2020 2064 6566 206d 6170  ath..    def map
+0001b4f0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0001b500: 2020 2020 2020 2020 6675 6e63 7469 6f6e          function
+0001b510: 3a20 4f70 7469 6f6e 616c 5b43 616c 6c61  : Optional[Calla
+0001b520: 626c 655d 203d 204e 6f6e 652c 0a20 2020  ble] = None,.   
+0001b530: 2020 2020 2077 6974 685f 696e 6469 6365       with_indice
+0001b540: 733a 2062 6f6f 6c20 3d20 4661 6c73 652c  s: bool = False,
+0001b550: 0a20 2020 2020 2020 2077 6974 685f 7261  .        with_ra
+0001b560: 6e6b 3a20 626f 6f6c 203d 2046 616c 7365  nk: bool = False
+0001b570: 2c0a 2020 2020 2020 2020 696e 7075 745f  ,.        input_
+0001b580: 636f 6c75 6d6e 733a 204f 7074 696f 6e61  columns: Optiona
+0001b590: 6c5b 556e 696f 6e5b 7374 722c 204c 6973  l[Union[str, Lis
+0001b5a0: 745b 7374 725d 5d5d 203d 204e 6f6e 652c  t[str]]] = None,
+0001b5b0: 0a20 2020 2020 2020 2062 6174 6368 6564  .        batched
+0001b5c0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+0001b5d0: 2020 2020 2020 2020 6261 7463 685f 7369          batch_si
+0001b5e0: 7a65 3a20 4f70 7469 6f6e 616c 5b69 6e74  ze: Optional[int
+0001b5f0: 5d20 3d20 3130 3030 2c0a 2020 2020 2020  ] = 1000,.      
+0001b600: 2020 6472 6f70 5f6c 6173 745f 6261 7463    drop_last_batc
+0001b610: 683a 2062 6f6f 6c20 3d20 4661 6c73 652c  h: bool = False,
+0001b620: 0a20 2020 2020 2020 2072 656d 6f76 655f  .        remove_
+0001b630: 636f 6c75 6d6e 733a 204f 7074 696f 6e61  columns: Optiona
+0001b640: 6c5b 556e 696f 6e5b 7374 722c 204c 6973  l[Union[str, Lis
+0001b650: 745b 7374 725d 5d5d 203d 204e 6f6e 652c  t[str]]] = None,
+0001b660: 0a20 2020 2020 2020 206b 6565 705f 696e  .        keep_in
+0001b670: 5f6d 656d 6f72 793a 2062 6f6f 6c20 3d20  _memory: bool = 
+0001b680: 4661 6c73 652c 0a20 2020 2020 2020 206c  False,.        l
+0001b690: 6f61 645f 6672 6f6d 5f63 6163 6865 5f66  oad_from_cache_f
+0001b6a0: 696c 653a 2062 6f6f 6c20 3d20 4e6f 6e65  ile: bool = None
+0001b6b0: 2c0a 2020 2020 2020 2020 6361 6368 655f  ,.        cache_
+0001b6c0: 6669 6c65 5f6e 616d 653a 204f 7074 696f  file_name: Optio
+0001b6d0: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+0001b6e0: 0a20 2020 2020 2020 2077 7269 7465 725f  .        writer_
+0001b6f0: 6261 7463 685f 7369 7a65 3a20 4f70 7469  batch_size: Opti
+0001b700: 6f6e 616c 5b69 6e74 5d20 3d20 3130 3030  onal[int] = 1000
+0001b710: 2c0a 2020 2020 2020 2020 6665 6174 7572  ,.        featur
+0001b720: 6573 3a20 4f70 7469 6f6e 616c 5b46 6561  es: Optional[Fea
+0001b730: 7475 7265 735d 203d 204e 6f6e 652c 0a20  tures] = None,. 
+0001b740: 2020 2020 2020 2064 6973 6162 6c65 5f6e         disable_n
+0001b750: 756c 6c61 626c 653a 2062 6f6f 6c20 3d20  ullable: bool = 
+0001b760: 4661 6c73 652c 0a20 2020 2020 2020 2066  False,.        f
+0001b770: 6e5f 6b77 6172 6773 3a20 4f70 7469 6f6e  n_kwargs: Option
+0001b780: 616c 5b64 6963 745d 203d 204e 6f6e 652c  al[dict] = None,
+0001b790: 0a20 2020 2020 2020 206e 756d 5f70 726f  .        num_pro
+0001b7a0: 633a 204f 7074 696f 6e61 6c5b 696e 745d  c: Optional[int]
+0001b7b0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0001b7c0: 2073 7566 6669 785f 7465 6d70 6c61 7465   suffix_template
+0001b7d0: 3a20 7374 7220 3d20 225f 7b72 616e 6b3a  : str = "_{rank:
+0001b7e0: 3035 647d 5f6f 665f 7b6e 756d 5f70 726f  05d}_of_{num_pro
+0001b7f0: 633a 3035 647d 222c 0a20 2020 2020 2020  c:05d}",.       
+0001b800: 206e 6577 5f66 696e 6765 7270 7269 6e74   new_fingerprint
+0001b810: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+0001b820: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0001b830: 6465 7363 3a20 4f70 7469 6f6e 616c 5b73  desc: Optional[s
+0001b840: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+0001b850: 2920 2d3e 2022 4461 7461 7365 7422 3a0a  ) -> "Dataset":.
+0001b860: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001b870: 2020 2020 4170 706c 7920 6120 6675 6e63      Apply a func
+0001b880: 7469 6f6e 2074 6f20 616c 6c20 7468 6520  tion to all the 
+0001b890: 6578 616d 706c 6573 2069 6e20 7468 6520  examples in the 
+0001b8a0: 7461 626c 6520 2869 6e64 6976 6964 7561  table (individua
+0001b8b0: 6c6c 7920 6f72 2069 6e20 6261 7463 6865  lly or in batche
+0001b8c0: 7329 2061 6e64 2075 7064 6174 6520 7468  s) and update th
+0001b8d0: 6520 7461 626c 652e 0a20 2020 2020 2020  e table..       
+0001b8e0: 2049 6620 796f 7572 2066 756e 6374 696f   If your functio
+0001b8f0: 6e20 7265 7475 726e 7320 6120 636f 6c75  n returns a colu
+0001b900: 6d6e 2074 6861 7420 616c 7265 6164 7920  mn that already 
+0001b910: 6578 6973 7473 2c20 7468 656e 2069 7420  exists, then it 
+0001b920: 6f76 6572 7772 6974 6573 2069 742e 0a0a  overwrites it...
+0001b930: 2020 2020 2020 2020 596f 7520 6361 6e20          You can 
+0001b940: 7370 6563 6966 7920 7768 6574 6865 7220  specify whether 
+0001b950: 7468 6520 6675 6e63 7469 6f6e 2073 686f  the function sho
+0001b960: 756c 6420 6265 2062 6174 6368 6564 206f  uld be batched o
+0001b970: 7220 6e6f 7420 7769 7468 2074 6865 2060  r not with the `
+0001b980: 6261 7463 6865 6460 2070 6172 616d 6574  batched` paramet
+0001b990: 6572 3a0a 0a20 2020 2020 2020 202d 2049  er:..        - I
+0001b9a0: 6620 6261 7463 6865 6420 6973 2060 4661  f batched is `Fa
+0001b9b0: 6c73 6560 2c20 7468 656e 2074 6865 2066  lse`, then the f
+0001b9c0: 756e 6374 696f 6e20 7461 6b65 7320 3120  unction takes 1 
+0001b9d0: 6578 616d 706c 6520 696e 2061 6e64 2073  example in and s
+0001b9e0: 686f 756c 6420 7265 7475 726e 2031 2065  hould return 1 e
+0001b9f0: 7861 6d70 6c65 2e0a 2020 2020 2020 2020  xample..        
+0001ba00: 2020 416e 2065 7861 6d70 6c65 2069 7320    An example is 
+0001ba10: 6120 6469 6374 696f 6e61 7279 2c20 652e  a dictionary, e.
+0001ba20: 672e 2060 7b22 7465 7874 223a 2022 4865  g. `{"text": "He
+0001ba30: 6c6c 6f20 7468 6572 6520 2122 7d60 2e0a  llo there !"}`..
+0001ba40: 2020 2020 2020 2020 2d20 4966 2062 6174          - If bat
+0001ba50: 6368 6564 2069 7320 6054 7275 6560 2061  ched is `True` a
+0001ba60: 6e64 2060 6261 7463 685f 7369 7a65 6020  nd `batch_size` 
+0001ba70: 6973 2031 2c20 7468 656e 2074 6865 2066  is 1, then the f
+0001ba80: 756e 6374 696f 6e20 7461 6b65 7320 6120  unction takes a 
+0001ba90: 6261 7463 6820 6f66 2031 2065 7861 6d70  batch of 1 examp
+0001baa0: 6c65 2061 7320 696e 7075 7420 616e 6420  le as input and 
+0001bab0: 6361 6e20 7265 7475 726e 2061 2062 6174  can return a bat
+0001bac0: 6368 2077 6974 6820 3120 6f72 206d 6f72  ch with 1 or mor
+0001bad0: 6520 6578 616d 706c 6573 2e0a 2020 2020  e examples..    
+0001bae0: 2020 2020 2020 4120 6261 7463 6820 6973        A batch is
+0001baf0: 2061 2064 6963 7469 6f6e 6172 792c 2065   a dictionary, e
+0001bb00: 2e67 2e20 6120 6261 7463 6820 6f66 2031  .g. a batch of 1
+0001bb10: 2065 7861 6d70 6c65 2069 7320 607b 2274   example is `{"t
+0001bb20: 6578 7422 3a20 5b22 4865 6c6c 6f20 7468  ext": ["Hello th
+0001bb30: 6572 6520 2122 5d7d 602e 0a20 2020 2020  ere !"]}`..     
+0001bb40: 2020 202d 2049 6620 6261 7463 6865 6420     - If batched 
+0001bb50: 6973 2060 5472 7565 6020 616e 6420 6062  is `True` and `b
+0001bb60: 6174 6368 5f73 697a 6560 2069 7320 606e  atch_size` is `n
+0001bb70: 203e 2031 602c 2074 6865 6e20 7468 6520   > 1`, then the 
+0001bb80: 6675 6e63 7469 6f6e 2074 616b 6573 2061  function takes a
+0001bb90: 2062 6174 6368 206f 6620 606e 6020 6578   batch of `n` ex
+0001bba0: 616d 706c 6573 2061 7320 696e 7075 7420  amples as input 
+0001bbb0: 616e 6420 6361 6e20 7265 7475 726e 2061  and can return a
+0001bbc0: 2062 6174 6368 2077 6974 6820 606e 6020   batch with `n` 
+0001bbd0: 6578 616d 706c 6573 2c20 6f72 2077 6974  examples, or wit
+0001bbe0: 6820 616e 2061 7262 6974 7261 7279 206e  h an arbitrary n
+0001bbf0: 756d 6265 7220 6f66 2065 7861 6d70 6c65  umber of example
+0001bc00: 732e 0a20 2020 2020 2020 2020 204e 6f74  s..          Not
+0001bc10: 6520 7468 6174 2074 6865 206c 6173 7420  e that the last 
+0001bc20: 6261 7463 6820 6d61 7920 6861 7665 206c  batch may have l
+0001bc30: 6573 7320 7468 616e 2060 6e60 2065 7861  ess than `n` exa
+0001bc40: 6d70 6c65 732e 0a20 2020 2020 2020 2020  mples..         
+0001bc50: 2041 2062 6174 6368 2069 7320 6120 6469   A batch is a di
+0001bc60: 6374 696f 6e61 7279 2c20 652e 672e 2061  ctionary, e.g. a
+0001bc70: 2062 6174 6368 206f 6620 606e 6020 6578   batch of `n` ex
+0001bc80: 616d 706c 6573 2069 7320 607b 2274 6578  amples is `{"tex
+0001bc90: 7422 3a20 5b22 4865 6c6c 6f20 7468 6572  t": ["Hello ther
+0001bca0: 6520 2122 5d20 2a20 6e7d 602e 0a0a 2020  e !"] * n}`...  
+0001bcb0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+0001bcc0: 2020 2020 2020 2020 6675 6e63 7469 6f6e          function
+0001bcd0: 2028 6043 616c 6c61 626c 6560 293a 2046   (`Callable`): F
+0001bce0: 756e 6374 696f 6e20 7769 7468 206f 6e65  unction with one
+0001bcf0: 206f 6620 7468 6520 666f 6c6c 6f77 696e   of the followin
+0001bd00: 6720 7369 676e 6174 7572 6573 3a0a 0a20  g signatures:.. 
+0001bd10: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+0001bd20: 2060 6675 6e63 7469 6f6e 2865 7861 6d70   `function(examp
+0001bd30: 6c65 3a20 4469 6374 5b73 7472 2c20 416e  le: Dict[str, An
+0001bd40: 795d 2920 2d3e 2044 6963 745b 7374 722c  y]) -> Dict[str,
+0001bd50: 2041 6e79 5d60 2069 6620 6062 6174 6368   Any]` if `batch
+0001bd60: 6564 3d46 616c 7365 6020 616e 6420 6077  ed=False` and `w
+0001bd70: 6974 685f 696e 6469 6365 733d 4661 6c73  ith_indices=Fals
+0001bd80: 6560 2061 6e64 2060 7769 7468 5f72 616e  e` and `with_ran
+0001bd90: 6b3d 4661 6c73 6560 0a20 2020 2020 2020  k=False`.       
+0001bda0: 2020 2020 2020 2020 202d 2060 6675 6e63           - `func
+0001bdb0: 7469 6f6e 2865 7861 6d70 6c65 3a20 4469  tion(example: Di
+0001bdc0: 6374 5b73 7472 2c20 416e 795d 2c20 2a65  ct[str, Any], *e
+0001bdd0: 7874 7261 5f61 7267 7329 202d 3e20 4469  xtra_args) -> Di
+0001bde0: 6374 5b73 7472 2c20 416e 795d 6020 6966  ct[str, Any]` if
+0001bdf0: 2060 6261 7463 6865 643d 4661 6c73 6560   `batched=False`
+0001be00: 2061 6e64 2060 7769 7468 5f69 6e64 6963   and `with_indic
+0001be10: 6573 3d54 7275 6560 2061 6e64 2f6f 7220  es=True` and/or 
+0001be20: 6077 6974 685f 7261 6e6b 3d54 7275 6560  `with_rank=True`
+0001be30: 2028 6f6e 6520 6578 7472 6120 6172 6720   (one extra arg 
+0001be40: 666f 7220 6561 6368 290a 2020 2020 2020  for each).      
+0001be50: 2020 2020 2020 2020 2020 2d20 6066 756e            - `fun
+0001be60: 6374 696f 6e28 6261 7463 683a 2044 6963  ction(batch: Dic
+0001be70: 745b 7374 722c 204c 6973 745d 2920 2d3e  t[str, List]) ->
+0001be80: 2044 6963 745b 7374 722c 204c 6973 745d   Dict[str, List]
+0001be90: 6020 6966 2060 6261 7463 6865 643d 5472  ` if `batched=Tr
+0001bea0: 7565 6020 616e 6420 6077 6974 685f 696e  ue` and `with_in
+0001beb0: 6469 6365 733d 4661 6c73 6560 2061 6e64  dices=False` and
+0001bec0: 2060 7769 7468 5f72 616e 6b3d 4661 6c73   `with_rank=Fals
+0001bed0: 6560 0a20 2020 2020 2020 2020 2020 2020  e`.             
+0001bee0: 2020 202d 2060 6675 6e63 7469 6f6e 2862     - `function(b
+0001bef0: 6174 6368 3a20 4469 6374 5b73 7472 2c20  atch: Dict[str, 
+0001bf00: 4c69 7374 5d2c 202a 6578 7472 615f 6172  List], *extra_ar
+0001bf10: 6773 2920 2d3e 2044 6963 745b 7374 722c  gs) -> Dict[str,
+0001bf20: 204c 6973 745d 6020 6966 2060 6261 7463   List]` if `batc
+0001bf30: 6865 643d 5472 7565 6020 616e 6420 6077  hed=True` and `w
+0001bf40: 6974 685f 696e 6469 6365 733d 5472 7565  ith_indices=True
+0001bf50: 6020 616e 642f 6f72 2060 7769 7468 5f72  ` and/or `with_r
+0001bf60: 616e 6b3d 5472 7565 6020 286f 6e65 2065  ank=True` (one e
+0001bf70: 7874 7261 2061 7267 2066 6f72 2065 6163  xtra arg for eac
+0001bf80: 6829 0a0a 2020 2020 2020 2020 2020 2020  h)..            
+0001bf90: 2020 2020 466f 7220 6164 7661 6e63 6564      For advanced
+0001bfa0: 2075 7361 6765 2c20 7468 6520 6675 6e63   usage, the func
+0001bfb0: 7469 6f6e 2063 616e 2061 6c73 6f20 7265  tion can also re
+0001bfc0: 7475 726e 2061 2060 7079 6172 726f 772e  turn a `pyarrow.
+0001bfd0: 5461 626c 6560 2e0a 2020 2020 2020 2020  Table`..        
+0001bfe0: 2020 2020 2020 2020 4d6f 7265 6f76 6572          Moreover
+0001bff0: 2069 6620 796f 7572 2066 756e 6374 696f   if your functio
+0001c000: 6e20 7265 7475 726e 7320 6e6f 7468 696e  n returns nothin
+0001c010: 6720 2860 4e6f 6e65 6029 2c20 7468 656e  g (`None`), then
+0001c020: 2060 6d61 7060 2077 696c 6c20 7275 6e20   `map` will run 
+0001c030: 796f 7572 2066 756e 6374 696f 6e20 616e  your function an
+0001c040: 6420 7265 7475 726e 2074 6865 2064 6174  d return the dat
+0001c050: 6173 6574 2075 6e63 6861 6e67 6564 2e0a  aset unchanged..
+0001c060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c070: 4966 206e 6f20 6675 6e63 7469 6f6e 2069  If no function i
+0001c080: 7320 7072 6f76 6964 6564 2c20 6465 6661  s provided, defa
+0001c090: 756c 7420 746f 2069 6465 6e74 6974 7920  ult to identity 
+0001c0a0: 6675 6e63 7469 6f6e 3a20 606c 616d 6264  function: `lambd
+0001c0b0: 6120 783a 2078 602e 0a20 2020 2020 2020  a x: x`..       
+0001c0c0: 2020 2020 2077 6974 685f 696e 6469 6365       with_indice
+0001c0d0: 7320 2860 626f 6f6c 602c 2064 6566 6175  s (`bool`, defau
+0001c0e0: 6c74 7320 746f 2060 4661 6c73 6560 293a  lts to `False`):
+0001c0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c100: 2050 726f 7669 6465 2065 7861 6d70 6c65   Provide example
+0001c110: 2069 6e64 6963 6573 2074 6f20 6066 756e   indices to `fun
+0001c120: 6374 696f 6e60 2e20 4e6f 7465 2074 6861  ction`. Note tha
+0001c130: 7420 696e 2074 6869 7320 6361 7365 2074  t in this case t
+0001c140: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
+0001c150: 2020 2073 6967 6e61 7475 7265 206f 6620     signature of 
+0001c160: 6066 756e 6374 696f 6e60 2073 686f 756c  `function` shoul
+0001c170: 6420 6265 2060 6465 6620 6675 6e63 7469  d be `def functi
+0001c180: 6f6e 2865 7861 6d70 6c65 2c20 6964 785b  on(example, idx[
+0001c190: 2c20 7261 6e6b 5d29 3a20 2e2e 2e60 2e0a  , rank]): ...`..
+0001c1a0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0001c1b0: 5f72 616e 6b20 2860 626f 6f6c 602c 2064  _rank (`bool`, d
+0001c1c0: 6566 6175 6c74 7320 746f 2060 4661 6c73  efaults to `Fals
+0001c1d0: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
+0001c1e0: 2020 2020 2050 726f 7669 6465 2070 726f       Provide pro
+0001c1f0: 6365 7373 2072 616e 6b20 746f 2060 6675  cess rank to `fu
+0001c200: 6e63 7469 6f6e 602e 204e 6f74 6520 7468  nction`. Note th
+0001c210: 6174 2069 6e20 7468 6973 2063 6173 6520  at in this case 
+0001c220: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+0001c230: 2020 2020 7369 676e 6174 7572 6520 6f66      signature of
+0001c240: 2060 6675 6e63 7469 6f6e 6020 7368 6f75   `function` shou
+0001c250: 6c64 2062 6520 6064 6566 2066 756e 6374  ld be `def funct
+0001c260: 696f 6e28 6578 616d 706c 655b 2c20 6964  ion(example[, id
+0001c270: 785d 2c20 7261 6e6b 293a 202e 2e2e 602e  x], rank): ...`.
+0001c280: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
+0001c290: 7574 5f63 6f6c 756d 6e73 2028 604f 7074  ut_columns (`Opt
+0001c2a0: 696f 6e61 6c5b 556e 696f 6e5b 7374 722c  ional[Union[str,
+0001c2b0: 204c 6973 745b 7374 725d 5d5d 602c 2064   List[str]]]`, d
+0001c2c0: 6566 6175 6c74 7320 746f 2060 4e6f 6e65  efaults to `None
+0001c2d0: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
+0001c2e0: 2020 2020 5468 6520 636f 6c75 6d6e 7320      The columns 
+0001c2f0: 746f 2062 6520 7061 7373 6564 2069 6e74  to be passed int
+0001c300: 6f20 6066 756e 6374 696f 6e60 0a20 2020  o `function`.   
+0001c310: 2020 2020 2020 2020 2020 2020 2061 7320               as 
+0001c320: 706f 7369 7469 6f6e 616c 2061 7267 756d  positional argum
+0001c330: 656e 7473 2e20 4966 2060 4e6f 6e65 602c  ents. If `None`,
+0001c340: 2061 2060 6469 6374 6020 6d61 7070 696e   a `dict` mappin
+0001c350: 6720 746f 2061 6c6c 2066 6f72 6d61 7474  g to all formatt
+0001c360: 6564 2063 6f6c 756d 6e73 2069 7320 7061  ed columns is pa
+0001c370: 7373 6564 2061 7320 6f6e 6520 6172 6775  ssed as one argu
+0001c380: 6d65 6e74 2e0a 2020 2020 2020 2020 2020  ment..          
+0001c390: 2020 6261 7463 6865 6420 2860 626f 6f6c    batched (`bool
+0001c3a0: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
+0001c3b0: 4661 6c73 6560 293a 0a20 2020 2020 2020  False`):.       
+0001c3c0: 2020 2020 2020 2020 2050 726f 7669 6465           Provide
+0001c3d0: 2062 6174 6368 206f 6620 6578 616d 706c   batch of exampl
+0001c3e0: 6573 2074 6f20 6066 756e 6374 696f 6e60  es to `function`
+0001c3f0: 2e0a 2020 2020 2020 2020 2020 2020 6261  ..            ba
+0001c400: 7463 685f 7369 7a65 2028 6069 6e74 602c  tch_size (`int`,
+0001c410: 202a 6f70 7469 6f6e 616c 2a2c 2064 6566   *optional*, def
+0001c420: 6175 6c74 7320 746f 2060 3130 3030 6029  aults to `1000`)
+0001c430: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c440: 2020 4e75 6d62 6572 206f 6620 6578 616d    Number of exam
+0001c450: 706c 6573 2070 6572 2062 6174 6368 2070  ples per batch p
+0001c460: 726f 7669 6465 6420 746f 2060 6675 6e63  rovided to `func
+0001c470: 7469 6f6e 6020 6966 2060 6261 7463 6865  tion` if `batche
+0001c480: 643d 5472 7565 602e 0a20 2020 2020 2020  d=True`..       
+0001c490: 2020 2020 2020 2020 2049 6620 6062 6174           If `bat
+0001c4a0: 6368 5f73 697a 6520 3c3d 2030 6020 6f72  ch_size <= 0` or
+0001c4b0: 2060 6261 7463 685f 7369 7a65 203d 3d20   `batch_size == 
+0001c4c0: 4e6f 6e65 602c 2070 726f 7669 6465 2074  None`, provide t
+0001c4d0: 6865 2066 756c 6c20 6461 7461 7365 7420  he full dataset 
+0001c4e0: 6173 2061 2073 696e 676c 6520 6261 7463  as a single batc
+0001c4f0: 6820 746f 2060 6675 6e63 7469 6f6e 602e  h to `function`.
+0001c500: 0a20 2020 2020 2020 2020 2020 2064 726f  .            dro
+0001c510: 705f 6c61 7374 5f62 6174 6368 2028 6062  p_last_batch (`b
+0001c520: 6f6f 6c60 2c20 6465 6661 756c 7473 2074  ool`, defaults t
+0001c530: 6f20 6046 616c 7365 6029 3a0a 2020 2020  o `False`):.    
+0001c540: 2020 2020 2020 2020 2020 2020 5768 6574              Whet
+0001c550: 6865 7220 6120 6c61 7374 2062 6174 6368  her a last batch
+0001c560: 2073 6d61 6c6c 6572 2074 6861 6e20 7468   smaller than th
+0001c570: 6520 6261 7463 685f 7369 7a65 2073 686f  e batch_size sho
+0001c580: 756c 6420 6265 0a20 2020 2020 2020 2020  uld be.         
+0001c590: 2020 2020 2020 2064 726f 7070 6564 2069         dropped i
+0001c5a0: 6e73 7465 6164 206f 6620 6265 696e 6720  nstead of being 
+0001c5b0: 7072 6f63 6573 7365 6420 6279 2074 6865  processed by the
+0001c5c0: 2066 756e 6374 696f 6e2e 0a20 2020 2020   function..     
+0001c5d0: 2020 2020 2020 2072 656d 6f76 655f 636f         remove_co
+0001c5e0: 6c75 6d6e 7320 2860 4f70 7469 6f6e 616c  lumns (`Optional
+0001c5f0: 5b55 6e69 6f6e 5b73 7472 2c20 4c69 7374  [Union[str, List
+0001c600: 5b73 7472 5d5d 5d60 2c20 6465 6661 756c  [str]]]`, defaul
+0001c610: 7473 2074 6f20 604e 6f6e 6560 293a 0a20  ts to `None`):. 
+0001c620: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+0001c630: 656d 6f76 6520 6120 7365 6c65 6374 696f  emove a selectio
+0001c640: 6e20 6f66 2063 6f6c 756d 6e73 2077 6869  n of columns whi
+0001c650: 6c65 2064 6f69 6e67 2074 6865 206d 6170  le doing the map
+0001c660: 7069 6e67 2e0a 2020 2020 2020 2020 2020  ping..          
+0001c670: 2020 2020 2020 436f 6c75 6d6e 7320 7769        Columns wi
+0001c680: 6c6c 2062 6520 7265 6d6f 7665 6420 6265  ll be removed be
+0001c690: 666f 7265 2075 7064 6174 696e 6720 7468  fore updating th
+0001c6a0: 6520 6578 616d 706c 6573 2077 6974 6820  e examples with 
+0001c6b0: 7468 6520 6f75 7470 7574 206f 6620 6066  the output of `f
+0001c6c0: 756e 6374 696f 6e60 2c20 692e 652e 2069  unction`, i.e. i
+0001c6d0: 6620 6066 756e 6374 696f 6e60 2069 7320  f `function` is 
+0001c6e0: 6164 6469 6e67 0a20 2020 2020 2020 2020  adding.         
+0001c6f0: 2020 2020 2020 2063 6f6c 756d 6e73 2077         columns w
+0001c700: 6974 6820 6e61 6d65 7320 696e 2060 7265  ith names in `re
+0001c710: 6d6f 7665 5f63 6f6c 756d 6e73 602c 2074  move_columns`, t
+0001c720: 6865 7365 2063 6f6c 756d 6e73 2077 696c  hese columns wil
+0001c730: 6c20 6265 206b 6570 742e 0a20 2020 2020  l be kept..     
+0001c740: 2020 2020 2020 206b 6565 705f 696e 5f6d         keep_in_m
+0001c750: 656d 6f72 7920 2860 626f 6f6c 602c 2064  emory (`bool`, d
+0001c760: 6566 6175 6c74 7320 746f 2060 4661 6c73  efaults to `Fals
+0001c770: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
+0001c780: 2020 2020 204b 6565 7020 7468 6520 6461       Keep the da
+0001c790: 7461 7365 7420 696e 206d 656d 6f72 7920  taset in memory 
+0001c7a0: 696e 7374 6561 6420 6f66 2077 7269 7469  instead of writi
+0001c7b0: 6e67 2069 7420 746f 2061 2063 6163 6865  ng it to a cache
+0001c7c0: 2066 696c 652e 0a20 2020 2020 2020 2020   file..         
+0001c7d0: 2020 206c 6f61 645f 6672 6f6d 5f63 6163     load_from_cac
+0001c7e0: 6865 5f66 696c 6520 2860 626f 6f6c 602c  he_file (`bool`,
+0001c7f0: 2064 6566 6175 6c74 7320 746f 2060 5472   defaults to `Tr
+0001c800: 7565 6020 6966 2063 6163 6869 6e67 2069  ue` if caching i
+0001c810: 7320 656e 6162 6c65 6429 3a0a 2020 2020  s enabled):.    
+0001c820: 2020 2020 2020 2020 2020 2020 4966 2061              If a
+0001c830: 2063 6163 6865 2066 696c 6520 7374 6f72   cache file stor
+0001c840: 696e 6720 7468 6520 6375 7272 656e 7420  ing the current 
+0001c850: 636f 6d70 7574 6174 696f 6e20 6672 6f6d  computation from
+0001c860: 2060 6675 6e63 7469 6f6e 600a 2020 2020   `function`.    
+0001c870: 2020 2020 2020 2020 2020 2020 6361 6e20              can 
+0001c880: 6265 2069 6465 6e74 6966 6965 642c 2075  be identified, u
+0001c890: 7365 2069 7420 696e 7374 6561 6420 6f66  se it instead of
+0001c8a0: 2072 6563 6f6d 7075 7469 6e67 2e0a 2020   recomputing..  
+0001c8b0: 2020 2020 2020 2020 2020 6361 6368 655f            cache_
+0001c8c0: 6669 6c65 5f6e 616d 6520 2860 7374 7260  file_name (`str`
+0001c8d0: 2c20 2a6f 7074 696f 6e61 6c2a 2c20 6465  , *optional*, de
+0001c8e0: 6661 756c 7473 2074 6f20 604e 6f6e 6560  faults to `None`
+0001c8f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001c900: 2020 2050 726f 7669 6465 2074 6865 206e     Provide the n
+0001c910: 616d 6520 6f66 2061 2070 6174 6820 666f  ame of a path fo
+0001c920: 7220 7468 6520 6361 6368 6520 6669 6c65  r the cache file
+0001c930: 2e20 4974 2069 7320 7573 6564 2074 6f20  . It is used to 
+0001c940: 7374 6f72 6520 7468 650a 2020 2020 2020  store the.      
+0001c950: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+0001c960: 7320 6f66 2074 6865 2063 6f6d 7075 7461  s of the computa
+0001c970: 7469 6f6e 2069 6e73 7465 6164 206f 6620  tion instead of 
+0001c980: 7468 6520 6175 746f 6d61 7469 6361 6c6c  the automaticall
+0001c990: 7920 6765 6e65 7261 7465 6420 6361 6368  y generated cach
+0001c9a0: 6520 6669 6c65 206e 616d 652e 0a20 2020  e file name..   
+0001c9b0: 2020 2020 2020 2020 2077 7269 7465 725f           writer_
+0001c9c0: 6261 7463 685f 7369 7a65 2028 6069 6e74  batch_size (`int
+0001c9d0: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
+0001c9e0: 3130 3030 6029 3a0a 2020 2020 2020 2020  1000`):.        
+0001c9f0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+0001ca00: 6620 726f 7773 2070 6572 2077 7269 7465  f rows per write
+0001ca10: 206f 7065 7261 7469 6f6e 2066 6f72 2074   operation for t
+0001ca20: 6865 2063 6163 6865 2066 696c 6520 7772  he cache file wr
+0001ca30: 6974 6572 2e0a 2020 2020 2020 2020 2020  iter..          
+0001ca40: 2020 2020 2020 5468 6973 2076 616c 7565        This value
+0001ca50: 2069 7320 6120 676f 6f64 2074 7261 6465   is a good trade
+0001ca60: 2d6f 6666 2062 6574 7765 656e 206d 656d  -off between mem
+0001ca70: 6f72 7920 7573 6167 6520 6475 7269 6e67  ory usage during
+0001ca80: 2074 6865 2070 726f 6365 7373 696e 672c   the processing,
+0001ca90: 2061 6e64 2070 726f 6365 7373 696e 6720   and processing 
+0001caa0: 7370 6565 642e 0a20 2020 2020 2020 2020  speed..         
+0001cab0: 2020 2020 2020 2048 6967 6865 7220 7661         Higher va
+0001cac0: 6c75 6520 6d61 6b65 7320 7468 6520 7072  lue makes the pr
+0001cad0: 6f63 6573 7369 6e67 2064 6f20 6665 7765  ocessing do fewe
+0001cae0: 7220 6c6f 6f6b 7570 732c 206c 6f77 6572  r lookups, lower
+0001caf0: 2076 616c 7565 2063 6f6e 7375 6d65 206c   value consume l
+0001cb00: 6573 7320 7465 6d70 6f72 6172 7920 6d65  ess temporary me
+0001cb10: 6d6f 7279 2077 6869 6c65 2072 756e 6e69  mory while runni
+0001cb20: 6e67 2060 6d61 7060 2e0a 2020 2020 2020  ng `map`..      
+0001cb30: 2020 2020 2020 6665 6174 7572 6573 2028        features (
+0001cb40: 604f 7074 696f 6e61 6c5b 6461 7461 7365  `Optional[datase
+0001cb50: 7473 2e46 6561 7475 7265 735d 602c 2064  ts.Features]`, d
+0001cb60: 6566 6175 6c74 7320 746f 2060 4e6f 6e65  efaults to `None
+0001cb70: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
+0001cb80: 2020 2020 5573 6520 6120 7370 6563 6966      Use a specif
+0001cb90: 6963 2046 6561 7475 7265 7320 746f 2073  ic Features to s
+0001cba0: 746f 7265 2074 6865 2063 6163 6865 2066  tore the cache f
+0001cbb0: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
+0001cbc0: 2020 2020 696e 7374 6561 6420 6f66 2074      instead of t
+0001cbd0: 6865 2061 7574 6f6d 6174 6963 616c 6c79  he automatically
+0001cbe0: 2067 656e 6572 6174 6564 206f 6e65 2e0a   generated one..
+0001cbf0: 2020 2020 2020 2020 2020 2020 6469 7361              disa
+0001cc00: 626c 655f 6e75 6c6c 6162 6c65 2028 6062  ble_nullable (`b
+0001cc10: 6f6f 6c60 2c20 6465 6661 756c 7473 2074  ool`, defaults t
+0001cc20: 6f20 6046 616c 7365 6029 3a0a 2020 2020  o `False`):.    
+0001cc30: 2020 2020 2020 2020 2020 2020 4469 7361              Disa
+0001cc40: 6c6c 6f77 206e 756c 6c20 7661 6c75 6573  llow null values
+0001cc50: 2069 6e20 7468 6520 7461 626c 652e 0a20   in the table.. 
+0001cc60: 2020 2020 2020 2020 2020 2066 6e5f 6b77             fn_kw
+0001cc70: 6172 6773 2028 6044 6963 7460 2c20 2a6f  args (`Dict`, *o
+0001cc80: 7074 696f 6e61 6c2a 2c20 6465 6661 756c  ptional*, defaul
+0001cc90: 7473 2074 6f20 604e 6f6e 6560 293a 0a20  ts to `None`):. 
+0001cca0: 2020 2020 2020 2020 2020 2020 2020 204b                 K
+0001ccb0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+0001ccc0: 2074 6f20 6265 2070 6173 7365 6420 746f   to be passed to
+0001ccd0: 2060 6675 6e63 7469 6f6e 602e 0a20 2020   `function`..   
+0001cce0: 2020 2020 2020 2020 206e 756d 5f70 726f           num_pro
+0001ccf0: 6320 2860 696e 7460 2c20 2a6f 7074 696f  c (`int`, *optio
+0001cd00: 6e61 6c2a 2c20 6465 6661 756c 7473 2074  nal*, defaults t
+0001cd10: 6f20 604e 6f6e 6560 293a 0a20 2020 2020  o `None`):.     
+0001cd20: 2020 2020 2020 2020 2020 204d 6178 206e             Max n
+0001cd30: 756d 6265 7220 6f66 2070 726f 6365 7373  umber of process
+0001cd40: 6573 2077 6865 6e20 6765 6e65 7261 7469  es when generati
+0001cd50: 6e67 2063 6163 6865 2e20 416c 7265 6164  ng cache. Alread
+0001cd60: 7920 6361 6368 6564 2073 6861 7264 7320  y cached shards 
+0001cd70: 6172 6520 6c6f 6164 6564 2073 6571 7565  are loaded seque
+0001cd80: 6e74 6961 6c6c 792e 0a20 2020 2020 2020  ntially..       
+0001cd90: 2020 2020 2073 7566 6669 785f 7465 6d70       suffix_temp
+0001cda0: 6c61 7465 2028 6073 7472 6029 3a0a 2020  late (`str`):.  
+0001cdb0: 2020 2020 2020 2020 2020 2020 2020 4966                If
+0001cdc0: 2060 6361 6368 655f 6669 6c65 5f6e 616d   `cache_file_nam
+0001cdd0: 6560 2069 7320 7370 6563 6966 6965 642c  e` is specified,
+0001cde0: 2074 6865 6e20 7468 6973 2073 7566 6669   then this suffi
+0001cdf0: 780a 2020 2020 2020 2020 2020 2020 2020  x.              
+0001ce00: 2020 7769 6c6c 2062 6520 6164 6465 6420    will be added 
+0001ce10: 6174 2074 6865 2065 6e64 206f 6620 7468  at the end of th
+0001ce20: 6520 6261 7365 206e 616d 6520 6f66 2065  e base name of e
+0001ce30: 6163 682e 2044 6566 6175 6c74 7320 746f  ach. Defaults to
+0001ce40: 2060 225f 7b72 616e 6b3a 3035 647d 5f6f   `"_{rank:05d}_o
+0001ce50: 665f 7b6e 756d 5f70 726f 633a 3035 647d  f_{num_proc:05d}
+0001ce60: 2260 2e20 466f 7220 6578 616d 706c 652c  "`. For example,
+0001ce70: 2069 6620 6063 6163 6865 5f66 696c 655f   if `cache_file_
+0001ce80: 6e61 6d65 6020 6973 2022 7072 6f63 6573  name` is "proces
+0001ce90: 7365 642e 6172 726f 7722 2c20 7468 656e  sed.arrow", then
+0001cea0: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
+0001ceb0: 2020 2020 2060 7261 6e6b 3d31 6020 616e       `rank=1` an
+0001cec0: 6420 606e 756d 5f70 726f 633d 3460 2c20  d `num_proc=4`, 
+0001ced0: 7468 6520 7265 7375 6c74 696e 6720 6669  the resulting fi
+0001cee0: 6c65 2077 6f75 6c64 2062 6520 6022 7072  le would be `"pr
+0001cef0: 6f63 6573 7365 645f 3030 3030 315f 6f66  ocessed_00001_of
+0001cf00: 5f30 3030 3034 2e61 7272 6f77 2260 2066  _00004.arrow"` f
+0001cf10: 6f72 2074 6865 2064 6566 6175 6c74 2073  or the default s
+0001cf20: 7566 6669 782e 0a20 2020 2020 2020 2020  uffix..         
+0001cf30: 2020 206e 6577 5f66 696e 6765 7270 7269     new_fingerpri
+0001cf40: 6e74 2028 6073 7472 602c 202a 6f70 7469  nt (`str`, *opti
+0001cf50: 6f6e 616c 2a2c 2064 6566 6175 6c74 7320  onal*, defaults 
+0001cf60: 746f 2060 4e6f 6e65 6029 3a0a 2020 2020  to `None`):.    
+0001cf70: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0001cf80: 6e65 7720 6669 6e67 6572 7072 696e 7420  new fingerprint 
+0001cf90: 6f66 2074 6865 2064 6174 6173 6574 2061  of the dataset a
+0001cfa0: 6674 6572 2074 7261 6e73 666f 726d 2e0a  fter transform..
+0001cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfc0: 4966 2060 4e6f 6e65 602c 2074 6865 206e  If `None`, the n
+0001cfd0: 6577 2066 696e 6765 7270 7269 6e74 2069  ew fingerprint i
+0001cfe0: 7320 636f 6d70 7574 6564 2075 7369 6e67  s computed using
+0001cff0: 2061 2068 6173 6820 6f66 2074 6865 2070   a hash of the p
+0001d000: 7265 7669 6f75 7320 6669 6e67 6572 7072  revious fingerpr
+0001d010: 696e 742c 2061 6e64 2074 6865 2074 7261  int, and the tra
+0001d020: 6e73 666f 726d 2061 7267 756d 656e 7473  nsform arguments
+0001d030: 2e0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+0001d040: 7363 2028 6073 7472 602c 202a 6f70 7469  sc (`str`, *opti
+0001d050: 6f6e 616c 2a2c 2064 6566 6175 6c74 7320  onal*, defaults 
+0001d060: 746f 2060 4e6f 6e65 6029 3a0a 2020 2020  to `None`):.    
+0001d070: 2020 2020 2020 2020 2020 2020 4d65 616e              Mean
+0001d080: 696e 6766 756c 2064 6573 6372 6970 7469  ingful descripti
+0001d090: 6f6e 2074 6f20 6265 2064 6973 706c 6179  on to be display
+0001d0a0: 6564 2061 6c6f 6e67 7369 6465 2077 6974  ed alongside wit
+0001d0b0: 6820 7468 6520 7072 6f67 7265 7373 2062  h the progress b
+0001d0c0: 6172 2077 6869 6c65 206d 6170 7069 6e67  ar while mapping
+0001d0d0: 2065 7861 6d70 6c65 732e 0a0a 2020 2020   examples...    
+0001d0e0: 2020 2020 4578 616d 706c 653a 0a0a 2020      Example:..  
+0001d0f0: 2020 2020 2020 6060 6070 790a 2020 2020        ```py.    
+0001d100: 2020 2020 3e3e 3e20 6672 6f6d 2064 6174      >>> from dat
+0001d110: 6173 6574 7320 696d 706f 7274 206c 6f61  asets import loa
+0001d120: 645f 6461 7461 7365 740a 2020 2020 2020  d_dataset.      
+0001d130: 2020 3e3e 3e20 6473 203d 206c 6f61 645f    >>> ds = load_
+0001d140: 6461 7461 7365 7428 2272 6f74 7465 6e5f  dataset("rotten_
+0001d150: 746f 6d61 746f 6573 222c 2073 706c 6974  tomatoes", split
+0001d160: 3d22 7661 6c69 6461 7469 6f6e 2229 0a20  ="validation"). 
+0001d170: 2020 2020 2020 203e 3e3e 2064 6566 2061         >>> def a
+0001d180: 6464 5f70 7265 6669 7828 6578 616d 706c  dd_prefix(exampl
+0001d190: 6529 3a0a 2020 2020 2020 2020 2e2e 2e20  e):.        ... 
+0001d1a0: 2020 2020 6578 616d 706c 655b 2274 6578      example["tex
+0001d1b0: 7422 5d20 3d20 2252 6576 6965 773a 2022  t"] = "Review: "
+0001d1c0: 202b 2065 7861 6d70 6c65 5b22 7465 7874   + example["text
+0001d1d0: 225d 0a20 2020 2020 2020 202e 2e2e 2020  "].        ...  
+0001d1e0: 2020 2072 6574 7572 6e20 6578 616d 706c     return exampl
+0001d1f0: 650a 2020 2020 2020 2020 3e3e 3e20 6473  e.        >>> ds
+0001d200: 203d 2064 732e 6d61 7028 6164 645f 7072   = ds.map(add_pr
+0001d210: 6566 6978 290a 2020 2020 2020 2020 3e3e  efix).        >>
+0001d220: 3e20 6473 5b30 3a33 5d5b 2274 6578 7422  > ds[0:3]["text"
+0001d230: 5d0a 2020 2020 2020 2020 5b27 5265 7669  ].        ['Revi
+0001d240: 6577 3a20 636f 6d70 6173 7369 6f6e 6174  ew: compassionat
+0001d250: 656c 7920 6578 706c 6f72 6573 2074 6865  ely explores the
+0001d260: 2073 6565 6d69 6e67 6c79 2069 7272 6563   seemingly irrec
+0001d270: 6f6e 6369 6c61 626c 6520 7369 7475 6174  oncilable situat
+0001d280: 696f 6e20 6265 7477 6565 6e20 636f 6e73  ion between cons
+0001d290: 6572 7661 7469 7665 2063 6872 6973 7469  ervative christi
+0001d2a0: 616e 2070 6172 656e 7473 2061 6e64 2074  an parents and t
+0001d2b0: 6865 6972 2065 7374 7261 6e67 6564 2067  heir estranged g
+0001d2c0: 6179 2061 6e64 206c 6573 6269 616e 2063  ay and lesbian c
+0001d2d0: 6869 6c64 7265 6e20 2e27 2c0a 2020 2020  hildren .',.    
+0001d2e0: 2020 2020 2027 5265 7669 6577 3a20 7468       'Review: th
+0001d2f0: 6520 736f 756e 6474 7261 636b 2061 6c6f  e soundtrack alo
+0001d300: 6e65 2069 7320 776f 7274 6820 7468 6520  ne is worth the 
+0001d310: 7072 6963 6520 6f66 2061 646d 6973 7369  price of admissi
+0001d320: 6f6e 202e 272c 0a20 2020 2020 2020 2020  on .',.         
+0001d330: 2752 6576 6965 773a 2072 6f64 7269 6775  'Review: rodrigu
+0001d340: 657a 2064 6f65 7320 6120 7370 6c65 6e64  ez does a splend
+0001d350: 6964 206a 6f62 206f 6620 7261 6369 616c  id job of racial
+0001d360: 2070 726f 6669 6c69 6e67 2068 6f6c 6c79   profiling holly
+0001d370: 776f 6f64 2073 7479 6c65 2d2d 6361 7374  wood style--cast
+0001d380: 696e 6720 6578 6365 6c6c 656e 7420 6c61  ing excellent la
+0001d390: 7469 6e20 6163 746f 7273 206f 6620 616c  tin actors of al
+0001d3a0: 6c20 6167 6573 2d2d 6120 7472 656e 6420  l ages--a trend 
+0001d3b0: 6c6f 6e67 206f 7665 7264 7565 202e 275d  long overdue .']
+0001d3c0: 0a0a 2020 2020 2020 2020 2320 7072 6f63  ..        # proc
+0001d3d0: 6573 7320 6120 6261 7463 6820 6f66 2065  ess a batch of e
+0001d3e0: 7861 6d70 6c65 730a 2020 2020 2020 2020  xamples.        
+0001d3f0: 3e3e 3e20 6473 203d 2064 732e 6d61 7028  >>> ds = ds.map(
+0001d400: 6c61 6d62 6461 2065 7861 6d70 6c65 3a20  lambda example: 
+0001d410: 746f 6b65 6e69 7a65 7228 6578 616d 706c  tokenizer(exampl
+0001d420: 655b 2274 6578 7422 5d29 2c20 6261 7463  e["text"]), batc
+0001d430: 6865 643d 5472 7565 290a 2020 2020 2020  hed=True).      
+0001d440: 2020 2320 7365 7420 6e75 6d62 6572 206f    # set number o
+0001d450: 6620 7072 6f63 6573 736f 7273 0a20 2020  f processors.   
+0001d460: 2020 2020 203e 3e3e 2064 7320 3d20 6473       >>> ds = ds
+0001d470: 2e6d 6170 2861 6464 5f70 7265 6669 782c  .map(add_prefix,
+0001d480: 206e 756d 5f70 726f 633d 3429 0a20 2020   num_proc=4).   
+0001d490: 2020 2020 2060 6060 0a20 2020 2020 2020       ```.       
+0001d4a0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+0001d4b0: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 2061  keep_in_memory a
+0001d4c0: 6e64 2063 6163 6865 5f66 696c 655f 6e61  nd cache_file_na
+0001d4d0: 6d65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  me is not None:.
+0001d4e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001d4f0: 6520 5661 6c75 6545 7272 6f72 2822 506c  e ValueError("Pl
+0001d500: 6561 7365 2075 7365 2065 6974 6865 7220  ease use either 
+0001d510: 606b 6565 705f 696e 5f6d 656d 6f72 7960  `keep_in_memory`
+0001d520: 206f 7220 6063 6163 6865 5f66 696c 655f   or `cache_file_
+0001d530: 6e61 6d65 6020 6275 7420 6e6f 7420 626f  name` but not bo
+0001d540: 7468 2e22 290a 0a20 2020 2020 2020 2069  th.")..        i
+0001d550: 6620 6e75 6d5f 7072 6f63 2069 7320 6e6f  f num_proc is no
+0001d560: 7420 4e6f 6e65 2061 6e64 206e 756d 5f70  t None and num_p
+0001d570: 726f 6320 3c3d 2030 3a0a 2020 2020 2020  roc <= 0:.      
+0001d580: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0001d590: 6545 7272 6f72 2822 6e75 6d5f 7072 6f63  eError("num_proc
+0001d5a0: 206d 7573 7420 6265 2061 6e20 696e 7465   must be an inte
+0001d5b0: 6765 7220 3e20 302e 2229 0a0a 2020 2020  ger > 0.")..    
+0001d5c0: 2020 2020 2320 4966 2074 6865 2061 7272      # If the arr
+0001d5d0: 6179 2069 7320 656d 7074 7920 7765 2064  ay is empty we d
+0001d5e0: 6f20 6e6f 7468 696e 6720 2862 7574 2077  o nothing (but w
+0001d5f0: 6520 6d61 6b65 2073 7572 6520 746f 2068  e make sure to h
+0001d600: 616e 646c 6520 616e 2065 6d70 7479 2069  andle an empty i
+0001d610: 6e64 6963 6573 206d 6170 7069 6e67 2061  ndices mapping a
+0001d620: 6e64 2072 656d 6f76 6520 7468 6520 7265  nd remove the re
+0001d630: 7175 6573 7465 6420 636f 6c75 6d6e 7320  quested columns 
+0001d640: 616e 7977 6179 290a 2020 2020 2020 2020  anyway).        
+0001d650: 6966 206c 656e 2873 656c 6629 203d 3d20  if len(self) == 
+0001d660: 303a 0a20 2020 2020 2020 2020 2020 2069  0:.            i
+0001d670: 6620 7365 6c66 2e5f 696e 6469 6365 7320  f self._indices 
+0001d680: 6973 206e 6f74 204e 6f6e 653a 2020 2320  is not None:  # 
+0001d690: 656d 7074 7920 696e 6469 6365 7320 6d61  empty indices ma
+0001d6a0: 7070 696e 670a 2020 2020 2020 2020 2020  pping.          
+0001d6b0: 2020 2020 2020 7365 6c66 203d 2044 6174        self = Dat
+0001d6c0: 6173 6574 280a 2020 2020 2020 2020 2020  aset(.          
+0001d6d0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+0001d6e0: 6174 612e 736c 6963 6528 302c 2030 292c  ata.slice(0, 0),
+0001d6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d700: 2020 2020 2069 6e66 6f3d 7365 6c66 2e69       info=self.i
+0001d710: 6e66 6f2e 636f 7079 2829 2c0a 2020 2020  nfo.copy(),.    
+0001d720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d730: 7370 6c69 743d 7365 6c66 2e73 706c 6974  split=self.split
+0001d740: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001d750: 2020 2020 2020 6669 6e67 6572 7072 696e        fingerprin
+0001d760: 743d 6e65 775f 6669 6e67 6572 7072 696e  t=new_fingerprin
+0001d770: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0001d780: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001d790: 2069 6620 7265 6d6f 7665 5f63 6f6c 756d   if remove_colum
+0001d7a0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0001d7b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001d7c0: 7265 6d6f 7665 5f63 6f6c 756d 6e73 2872  remove_columns(r
+0001d7d0: 656d 6f76 655f 636f 6c75 6d6e 7329 0a20  emove_columns). 
+0001d7e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001d7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d800: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
+0001d810: 2020 2020 2020 6966 2066 756e 6374 696f        if functio
+0001d820: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
+0001d830: 2020 2020 2020 2066 756e 6374 696f 6e20         function 
+0001d840: 3d20 6c61 6d62 6461 2078 3a20 7820 2023  = lambda x: x  #
+0001d850: 206e 6f71 613a 2045 3733 310a 0a20 2020   noqa: E731..   
+0001d860: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0001d870: 6365 2869 6e70 7574 5f63 6f6c 756d 6e73  ce(input_columns
+0001d880: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+0001d890: 2020 2020 696e 7075 745f 636f 6c75 6d6e      input_column
+0001d8a0: 7320 3d20 5b69 6e70 7574 5f63 6f6c 756d  s = [input_colum
+0001d8b0: 6e73 5d0a 0a20 2020 2020 2020 2069 6620  ns]..        if 
+0001d8c0: 696e 7075 745f 636f 6c75 6d6e 7320 6973  input_columns is
+0001d8d0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0001d8e0: 2020 2020 2020 2066 6f72 2069 6e70 7574         for input
+0001d8f0: 5f63 6f6c 756d 6e20 696e 2069 6e70 7574  _column in input
+0001d900: 5f63 6f6c 756d 6e73 3a0a 2020 2020 2020  _columns:.      
+0001d910: 2020 2020 2020 2020 2020 6966 2069 6e70            if inp
+0001d920: 7574 5f63 6f6c 756d 6e20 6e6f 7420 696e  ut_column not in
+0001d930: 2073 656c 662e 5f64 6174 612e 636f 6c75   self._data.colu
+0001d940: 6d6e 5f6e 616d 6573 3a0a 2020 2020 2020  mn_names:.      
+0001d950: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0001d960: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+0001d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d980: 2020 2020 2020 2020 6622 496e 7075 7420          f"Input 
+0001d990: 636f 6c75 6d6e 207b 696e 7075 745f 636f  column {input_co
+0001d9a0: 6c75 6d6e 7d20 6e6f 7420 696e 2074 6865  lumn} not in the
+0001d9b0: 2064 6174 6173 6574 2e20 4375 7272 656e   dataset. Curren
+0001d9c0: 7420 636f 6c75 6d6e 7320 696e 2074 6865  t columns in the
+0001d9d0: 2064 6174 6173 6574 3a20 7b73 656c 662e   dataset: {self.
+0001d9e0: 5f64 6174 612e 636f 6c75 6d6e 5f6e 616d  _data.column_nam
+0001d9f0: 6573 7d22 0a20 2020 2020 2020 2020 2020  es}".           
+0001da00: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0001da10: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0001da20: 6528 7265 6d6f 7665 5f63 6f6c 756d 6e73  e(remove_columns
+0001da30: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+0001da40: 2020 2020 7265 6d6f 7665 5f63 6f6c 756d      remove_colum
+0001da50: 6e73 203d 205b 7265 6d6f 7665 5f63 6f6c  ns = [remove_col
+0001da60: 756d 6e73 5d0a 0a20 2020 2020 2020 2069  umns]..        i
+0001da70: 6620 7265 6d6f 7665 5f63 6f6c 756d 6e73  f remove_columns
+0001da80: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0001da90: 2061 6e79 2863 6f6c 206e 6f74 2069 6e20   any(col not in 
+0001daa0: 7365 6c66 2e5f 6461 7461 2e63 6f6c 756d  self._data.colum
+0001dab0: 6e5f 6e61 6d65 7320 666f 7220 636f 6c20  n_names for col 
+0001dac0: 696e 2072 656d 6f76 655f 636f 6c75 6d6e  in remove_column
+0001dad0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0001dae0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0001daf0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001db00: 2020 6622 436f 6c75 6d6e 2074 6f20 7265    f"Column to re
+0001db10: 6d6f 7665 207b 6c69 7374 2866 696c 7465  move {list(filte
+0001db20: 7228 6c61 6d62 6461 2063 6f6c 3a20 636f  r(lambda col: co
+0001db30: 6c20 6e6f 7420 696e 2073 656c 662e 5f64  l not in self._d
+0001db40: 6174 612e 636f 6c75 6d6e 5f6e 616d 6573  ata.column_names
+0001db50: 2c20 7265 6d6f 7665 5f63 6f6c 756d 6e73  , remove_columns
+0001db60: 2929 7d20 6e6f 7420 696e 2074 6865 2064  ))} not in the d
+0001db70: 6174 6173 6574 2e20 4375 7272 656e 7420  ataset. Current 
+0001db80: 636f 6c75 6d6e 7320 696e 2074 6865 2064  columns in the d
+0001db90: 6174 6173 6574 3a20 7b73 656c 662e 5f64  ataset: {self._d
+0001dba0: 6174 612e 636f 6c75 6d6e 5f6e 616d 6573  ata.column_names
+0001dbb0: 7d22 0a20 2020 2020 2020 2020 2020 2029  }".            )
+0001dbc0: 0a0a 2020 2020 2020 2020 6c6f 6164 5f66  ..        load_f
+0001dbd0: 726f 6d5f 6361 6368 655f 6669 6c65 203d  rom_cache_file =
+0001dbe0: 206c 6f61 645f 6672 6f6d 5f63 6163 6865   load_from_cache
+0001dbf0: 5f66 696c 6520 6966 206c 6f61 645f 6672  _file if load_fr
+0001dc00: 6f6d 5f63 6163 6865 5f66 696c 6520 6973  om_cache_file is
+0001dc10: 206e 6f74 204e 6f6e 6520 656c 7365 2069   not None else i
+0001dc20: 735f 6361 6368 696e 675f 656e 6162 6c65  s_caching_enable
+0001dc30: 6428 290a 0a20 2020 2020 2020 2069 6620  d()..        if 
+0001dc40: 666e 5f6b 7761 7267 7320 6973 204e 6f6e  fn_kwargs is Non
+0001dc50: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
+0001dc60: 6e5f 6b77 6172 6773 203d 207b 7d0a 0a20  n_kwargs = {}.. 
+0001dc70: 2020 2020 2020 2069 6620 6e75 6d5f 7072         if num_pr
+0001dc80: 6f63 2069 7320 6e6f 7420 4e6f 6e65 2061  oc is not None a
+0001dc90: 6e64 206e 756d 5f70 726f 6320 3e20 6c65  nd num_proc > le
+0001dca0: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
+0001dcb0: 2020 2020 206e 756d 5f70 726f 6320 3d20       num_proc = 
+0001dcc0: 6c65 6e28 7365 6c66 290a 2020 2020 2020  len(self).      
+0001dcd0: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+0001dce0: 6e69 6e67 280a 2020 2020 2020 2020 2020  ning(.          
+0001dcf0: 2020 2020 2020 6622 6e75 6d5f 7072 6f63        f"num_proc
+0001dd00: 206d 7573 7420 6265 203c 3d20 7b6c 656e   must be <= {len
+0001dd10: 2873 656c 6629 7d2e 2052 6564 7563 696e  (self)}. Reducin
+0001dd20: 6720 6e75 6d5f 7072 6f63 2074 6f20 7b6e  g num_proc to {n
+0001dd30: 756d 5f70 726f 637d 2066 6f72 2064 6174  um_proc} for dat
+0001dd40: 6173 6574 206f 6620 7369 7a65 207b 6c65  aset of size {le
+0001dd50: 6e28 7365 6c66 297d 2e22 0a20 2020 2020  n(self)}.".     
+0001dd60: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0001dd70: 2020 6469 7361 626c 655f 7471 646d 203d    disable_tqdm =
+0001dd80: 206e 6f74 206c 6f67 6769 6e67 2e69 735f   not logging.is_
+0001dd90: 7072 6f67 7265 7373 5f62 6172 5f65 6e61  progress_bar_ena
+0001dda0: 626c 6564 2829 0a0a 2020 2020 2020 2020  bled()..        
+0001ddb0: 6966 206e 756d 5f70 726f 6320 6973 204e  if num_proc is N
+0001ddc0: 6f6e 6520 6f72 206e 756d 5f70 726f 6320  one or num_proc 
+0001ddd0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+0001dde0: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+0001ddf0: 6170 5f73 696e 676c 6528 0a20 2020 2020  ap_single(.     
+0001de00: 2020 2020 2020 2020 2020 2066 756e 6374             funct
+0001de10: 696f 6e3d 6675 6e63 7469 6f6e 2c0a 2020  ion=function,.  
+0001de20: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+0001de30: 7468 5f69 6e64 6963 6573 3d77 6974 685f  th_indices=with_
+0001de40: 696e 6469 6365 732c 0a20 2020 2020 2020  indices,.       
+0001de50: 2020 2020 2020 2020 2077 6974 685f 7261           with_ra
+0001de60: 6e6b 3d77 6974 685f 7261 6e6b 2c0a 2020  nk=with_rank,.  
+0001de70: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0001de80: 7075 745f 636f 6c75 6d6e 733d 696e 7075  put_columns=inpu
+0001de90: 745f 636f 6c75 6d6e 732c 0a20 2020 2020  t_columns,.     
+0001dea0: 2020 2020 2020 2020 2020 2062 6174 6368             batch
+0001deb0: 6564 3d62 6174 6368 6564 2c0a 2020 2020  ed=batched,.    
+0001dec0: 2020 2020 2020 2020 2020 2020 6261 7463              batc
+0001ded0: 685f 7369 7a65 3d62 6174 6368 5f73 697a  h_size=batch_siz
+0001dee0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001def0: 2020 2064 726f 705f 6c61 7374 5f62 6174     drop_last_bat
+0001df00: 6368 3d64 726f 705f 6c61 7374 5f62 6174  ch=drop_last_bat
+0001df10: 6368 2c0a 2020 2020 2020 2020 2020 2020  ch,.            
+0001df20: 2020 2020 7265 6d6f 7665 5f63 6f6c 756d      remove_colum
+0001df30: 6e73 3d72 656d 6f76 655f 636f 6c75 6d6e  ns=remove_column
+0001df40: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0001df50: 2020 206b 6565 705f 696e 5f6d 656d 6f72     keep_in_memor
+0001df60: 793d 6b65 6570 5f69 6e5f 6d65 6d6f 7279  y=keep_in_memory
+0001df70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001df80: 2020 6c6f 6164 5f66 726f 6d5f 6361 6368    load_from_cach
+0001df90: 655f 6669 6c65 3d6c 6f61 645f 6672 6f6d  e_file=load_from
+0001dfa0: 5f63 6163 6865 5f66 696c 652c 0a20 2020  _cache_file,.   
+0001dfb0: 2020 2020 2020 2020 2020 2020 2063 6163               cac
+0001dfc0: 6865 5f66 696c 655f 6e61 6d65 3d63 6163  he_file_name=cac
+0001dfd0: 6865 5f66 696c 655f 6e61 6d65 2c0a 2020  he_file_name,.  
+0001dfe0: 2020 2020 2020 2020 2020 2020 2020 7772                wr
+0001dff0: 6974 6572 5f62 6174 6368 5f73 697a 653d  iter_batch_size=
+0001e000: 7772 6974 6572 5f62 6174 6368 5f73 697a  writer_batch_siz
+0001e010: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001e020: 2020 2066 6561 7475 7265 733d 6665 6174     features=feat
+0001e030: 7572 6573 2c0a 2020 2020 2020 2020 2020  ures,.          
+0001e040: 2020 2020 2020 6469 7361 626c 655f 6e75        disable_nu
+0001e050: 6c6c 6162 6c65 3d64 6973 6162 6c65 5f6e  llable=disable_n
+0001e060: 756c 6c61 626c 652c 0a20 2020 2020 2020  ullable,.       
+0001e070: 2020 2020 2020 2020 2066 6e5f 6b77 6172           fn_kwar
+0001e080: 6773 3d66 6e5f 6b77 6172 6773 2c0a 2020  gs=fn_kwargs,.  
+0001e090: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0001e0a0: 775f 6669 6e67 6572 7072 696e 743d 6e65  w_fingerprint=ne
+0001e0b0: 775f 6669 6e67 6572 7072 696e 742c 0a20  w_fingerprint,. 
+0001e0c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0001e0d0: 6973 6162 6c65 5f74 7164 6d3d 6469 7361  isable_tqdm=disa
+0001e0e0: 626c 655f 7471 646d 2c0a 2020 2020 2020  ble_tqdm,.      
+0001e0f0: 2020 2020 2020 2020 2020 6465 7363 3d64            desc=d
+0001e100: 6573 632c 0a20 2020 2020 2020 2020 2020  esc,.           
+0001e110: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
+0001e120: 0a0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+0001e130: 6620 666f 726d 6174 5f63 6163 6865 5f66  f format_cache_f
+0001e140: 696c 655f 6e61 6d65 2863 6163 6865 5f66  ile_name(cache_f
+0001e150: 696c 655f 6e61 6d65 2c20 7261 6e6b 293a  ile_name, rank):
+0001e160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e170: 2073 6570 203d 2063 6163 6865 5f66 696c   sep = cache_fil
+0001e180: 655f 6e61 6d65 2e72 696e 6465 7828 222e  e_name.rindex(".
+0001e190: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001e1a0: 2020 2062 6173 655f 6e61 6d65 2c20 6578     base_name, ex
+0001e1b0: 7465 6e73 696f 6e20 3d20 6361 6368 655f  tension = cache_
+0001e1c0: 6669 6c65 5f6e 616d 655b 3a73 6570 5d2c  file_name[:sep],
+0001e1d0: 2063 6163 6865 5f66 696c 655f 6e61 6d65   cache_file_name
+0001e1e0: 5b73 6570 3a5d 0a20 2020 2020 2020 2020  [sep:].         
+0001e1f0: 2020 2020 2020 2063 6163 6865 5f66 696c         cache_fil
+0001e200: 655f 6e61 6d65 203d 2062 6173 655f 6e61  e_name = base_na
+0001e210: 6d65 202b 2073 7566 6669 785f 7465 6d70  me + suffix_temp
+0001e220: 6c61 7465 2e66 6f72 6d61 7428 7261 6e6b  late.format(rank
+0001e230: 3d72 616e 6b2c 206e 756d 5f70 726f 633d  =rank, num_proc=
+0001e240: 6e75 6d5f 7072 6f63 2920 2b20 6578 7465  num_proc) + exte
+0001e250: 6e73 696f 6e0a 2020 2020 2020 2020 2020  nsion.          
+0001e260: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+0001e270: 6f28 6622 5072 6f63 6573 7320 237b 7261  o(f"Process #{ra
+0001e280: 6e6b 7d20 7769 6c6c 2077 7269 7465 2061  nk} will write a
+0001e290: 7420 7b63 6163 6865 5f66 696c 655f 6e61  t {cache_file_na
+0001e2a0: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
+0001e2b0: 2020 2020 2020 7265 7475 726e 2063 6163        return cac
+0001e2c0: 6865 5f66 696c 655f 6e61 6d65 0a0a 2020  he_file_name..  
+0001e2d0: 2020 2020 2020 2020 2020 6465 6620 666f            def fo
+0001e2e0: 726d 6174 5f6e 6577 5f66 696e 6765 7270  rmat_new_fingerp
+0001e2f0: 7269 6e74 286e 6577 5f66 696e 6765 7270  rint(new_fingerp
+0001e300: 7269 6e74 2c20 7261 6e6b 293a 0a20 2020  rint, rank):.   
+0001e310: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001e320: 7572 6e20 6e65 775f 6669 6e67 6572 7072  urn new_fingerpr
+0001e330: 696e 7420 2b20 7375 6666 6978 5f74 656d  int + suffix_tem
+0001e340: 706c 6174 652e 666f 726d 6174 2872 616e  plate.format(ran
+0001e350: 6b3d 7261 6e6b 2c20 6e75 6d5f 7072 6f63  k=rank, num_proc
+0001e360: 3d6e 756d 5f70 726f 6329 0a0a 2020 2020  =num_proc)..    
+0001e370: 2020 2020 2020 2020 7072 6576 5f65 6e76          prev_env
+0001e380: 203d 2064 6565 7063 6f70 7928 6f73 2e65   = deepcopy(os.e
+0001e390: 6e76 6972 6f6e 290a 2020 2020 2020 2020  nviron).        
+0001e3a0: 2020 2020 2320 6368 6563 6b20 6966 2070      # check if p
+0001e3b0: 6172 616c 6c65 6c69 736d 2069 6620 6f66  arallelism if of
+0001e3c0: 660a 2020 2020 2020 2020 2020 2020 2320  f.            # 
+0001e3d0: 6672 6f6d 2068 7474 7073 3a2f 2f67 6974  from https://git
+0001e3e0: 6875 622e 636f 6d2f 6875 6767 696e 6766  hub.com/huggingf
+0001e3f0: 6163 652f 746f 6b65 6e69 7a65 7273 2f62  ace/tokenizers/b
+0001e400: 6c6f 622f 6262 3636 3862 6334 3339 6463  lob/bb668bc439dc
+0001e410: 3334 3338 3962 3731 6462 6238 6365 3063  34389b71dbb8ce0c
+0001e420: 3539 3766 3135 3730 3762 3533 2f74 6f6b  597f15707b53/tok
+0001e430: 656e 697a 6572 732f 7372 632f 7574 696c  enizers/src/util
+0001e440: 732f 7061 7261 6c6c 656c 6973 6d2e 7273  s/parallelism.rs
+0001e450: 234c 3232 0a20 2020 2020 2020 2020 2020  #L22.           
+0001e460: 2069 6620 7072 6576 5f65 6e76 2e67 6574   if prev_env.get
+0001e470: 2822 544f 4b45 4e49 5a45 5253 5f50 4152  ("TOKENIZERS_PAR
+0001e480: 414c 4c45 4c49 534d 222c 2022 6661 6c73  ALLELISM", "fals
+0001e490: 6522 292e 6c6f 7765 7228 2920 6e6f 7420  e").lower() not 
+0001e4a0: 696e 2028 0a20 2020 2020 2020 2020 2020  in (.           
+0001e4b0: 2020 2020 2022 222c 0a20 2020 2020 2020       "",.       
+0001e4c0: 2020 2020 2020 2020 2022 6f66 6622 2c0a           "off",.
+0001e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4e0: 2266 616c 7365 222c 0a20 2020 2020 2020  "false",.       
+0001e4f0: 2020 2020 2020 2020 2022 6622 2c0a 2020           "f",.  
+0001e500: 2020 2020 2020 2020 2020 2020 2020 226e                "n
+0001e510: 6f22 2c0a 2020 2020 2020 2020 2020 2020  o",.            
+0001e520: 2020 2020 226e 222c 0a20 2020 2020 2020      "n",.       
+0001e530: 2020 2020 2020 2020 2022 3022 2c0a 2020           "0",.  
+0001e540: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+0001e550: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+0001e560: 6765 722e 7761 726e 696e 6728 2253 6574  ger.warning("Set
+0001e570: 7469 6e67 2054 4f4b 454e 495a 4552 535f  ting TOKENIZERS_
+0001e580: 5041 5241 4c4c 454c 4953 4d3d 6661 6c73  PARALLELISM=fals
+0001e590: 6520 666f 7220 666f 726b 6564 2070 726f  e for forked pro
+0001e5a0: 6365 7373 6573 2e22 290a 2020 2020 2020  cesses.").      
+0001e5b0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+0001e5c0: 5b22 544f 4b45 4e49 5a45 5253 5f50 4152  ["TOKENIZERS_PAR
+0001e5d0: 414c 4c45 4c49 534d 225d 203d 2022 6661  ALLELISM"] = "fa
+0001e5e0: 6c73 6522 0a20 2020 2020 2020 2020 2020  lse".           
+0001e5f0: 2069 6e69 7461 7267 732c 2069 6e69 7469   initargs, initi
+0001e600: 616c 697a 6572 203d 204e 6f6e 652c 204e  alizer = None, N
+0001e610: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0001e620: 6966 206e 6f74 2064 6973 6162 6c65 5f74  if not disable_t
+0001e630: 7164 6d3a 0a20 2020 2020 2020 2020 2020  qdm:.           
+0001e640: 2020 2020 2069 6e69 7461 7267 732c 2069       initargs, i
+0001e650: 6e69 7469 616c 697a 6572 203d 2028 524c  nitializer = (RL
+0001e660: 6f63 6b28 292c 292c 2074 7164 6d2e 7365  ock(),), tqdm.se
+0001e670: 745f 6c6f 636b 0a0a 2020 2020 2020 2020  t_lock..        
+0001e680: 2020 2020 7368 6172 6473 203d 205b 0a20      shards = [. 
+0001e690: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001e6a0: 656c 662e 7368 6172 6428 6e75 6d5f 7368  elf.shard(num_sh
+0001e6b0: 6172 6473 3d6e 756d 5f70 726f 632c 2069  ards=num_proc, i
+0001e6c0: 6e64 6578 3d72 616e 6b2c 2063 6f6e 7469  ndex=rank, conti
+0001e6d0: 6775 6f75 733d 5472 7565 2c20 6b65 6570  guous=True, keep
+0001e6e0: 5f69 6e5f 6d65 6d6f 7279 3d6b 6565 705f  _in_memory=keep_
+0001e6f0: 696e 5f6d 656d 6f72 7929 0a20 2020 2020  in_memory).     
+0001e700: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+0001e710: 616e 6b20 696e 2072 616e 6765 286e 756d  ank in range(num
+0001e720: 5f70 726f 6329 0a20 2020 2020 2020 2020  _proc).         
+0001e730: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+0001e740: 206b 7764 735f 7065 725f 7368 6172 6420   kwds_per_shard 
+0001e750: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+0001e760: 2020 2020 6469 6374 280a 2020 2020 2020      dict(.      
+0001e770: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001e780: 6c66 3d73 6861 7264 735b 7261 6e6b 5d2c  lf=shards[rank],
+0001e790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e7a0: 2020 2020 2066 756e 6374 696f 6e3d 6675       function=fu
+0001e7b0: 6e63 7469 6f6e 2c0a 2020 2020 2020 2020  nction,.        
+0001e7c0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0001e7d0: 5f69 6e64 6963 6573 3d77 6974 685f 696e  _indices=with_in
+0001e7e0: 6469 6365 732c 0a20 2020 2020 2020 2020  dices,.         
+0001e7f0: 2020 2020 2020 2020 2020 2077 6974 685f             with_
+0001e800: 7261 6e6b 3d77 6974 685f 7261 6e6b 2c0a  rank=with_rank,.
+0001e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e820: 2020 2020 696e 7075 745f 636f 6c75 6d6e      input_column
+0001e830: 733d 696e 7075 745f 636f 6c75 6d6e 732c  s=input_columns,
+0001e840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e850: 2020 2020 2062 6174 6368 6564 3d62 6174       batched=bat
+0001e860: 6368 6564 2c0a 2020 2020 2020 2020 2020  ched,.          
+0001e870: 2020 2020 2020 2020 2020 6261 7463 685f            batch_
+0001e880: 7369 7a65 3d62 6174 6368 5f73 697a 652c  size=batch_size,
+0001e890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e8a0: 2020 2020 2064 726f 705f 6c61 7374 5f62       drop_last_b
+0001e8b0: 6174 6368 3d64 726f 705f 6c61 7374 5f62  atch=drop_last_b
+0001e8c0: 6174 6368 2c0a 2020 2020 2020 2020 2020  atch,.          
+0001e8d0: 2020 2020 2020 2020 2020 7265 6d6f 7665            remove
+0001e8e0: 5f63 6f6c 756d 6e73 3d72 656d 6f76 655f  _columns=remove_
+0001e8f0: 636f 6c75 6d6e 732c 0a20 2020 2020 2020  columns,.       
+0001e900: 2020 2020 2020 2020 2020 2020 206b 6565               kee
+0001e910: 705f 696e 5f6d 656d 6f72 793d 6b65 6570  p_in_memory=keep
+0001e920: 5f69 6e5f 6d65 6d6f 7279 2c0a 2020 2020  _in_memory,.    
+0001e930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e940: 6c6f 6164 5f66 726f 6d5f 6361 6368 655f  load_from_cache_
+0001e950: 6669 6c65 3d6c 6f61 645f 6672 6f6d 5f63  file=load_from_c
+0001e960: 6163 6865 5f66 696c 652c 0a20 2020 2020  ache_file,.     
+0001e970: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001e980: 6163 6865 5f66 696c 655f 6e61 6d65 3d66  ache_file_name=f
+0001e990: 6f72 6d61 745f 6361 6368 655f 6669 6c65  ormat_cache_file
+0001e9a0: 5f6e 616d 6528 6361 6368 655f 6669 6c65  _name(cache_file
+0001e9b0: 5f6e 616d 652c 2072 616e 6b29 0a20 2020  _name, rank).   
+0001e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9d0: 2069 6620 6361 6368 655f 6669 6c65 5f6e   if cache_file_n
+0001e9e0: 616d 6520 6973 206e 6f74 204e 6f6e 650a  ame is not None.
+0001e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea00: 2020 2020 656c 7365 204e 6f6e 652c 0a20      else None,. 
+0001ea10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea20: 2020 2077 7269 7465 725f 6261 7463 685f     writer_batch_
+0001ea30: 7369 7a65 3d77 7269 7465 725f 6261 7463  size=writer_batc
+0001ea40: 685f 7369 7a65 2c0a 2020 2020 2020 2020  h_size,.        
+0001ea50: 2020 2020 2020 2020 2020 2020 6665 6174              feat
+0001ea60: 7572 6573 3d66 6561 7475 7265 732e 636f  ures=features.co
+0001ea70: 7079 2829 2069 6620 6665 6174 7572 6573  py() if features
+0001ea80: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+0001ea90: 6520 4e6f 6e65 2c0a 2020 2020 2020 2020  e None,.        
+0001eaa0: 2020 2020 2020 2020 2020 2020 6469 7361              disa
+0001eab0: 626c 655f 6e75 6c6c 6162 6c65 3d64 6973  ble_nullable=dis
+0001eac0: 6162 6c65 5f6e 756c 6c61 626c 652c 0a20  able_nullable,. 
+0001ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eae0: 2020 2066 6e5f 6b77 6172 6773 3d66 6e5f     fn_kwargs=fn_
+0001eaf0: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
+0001eb00: 2020 2020 2020 2020 2020 2020 7261 6e6b              rank
+0001eb10: 3d72 616e 6b2c 0a20 2020 2020 2020 2020  =rank,.         
+0001eb20: 2020 2020 2020 2020 2020 206f 6666 7365             offse
+0001eb30: 743d 7375 6d28 6c65 6e28 7329 2066 6f72  t=sum(len(s) for
+0001eb40: 2073 2069 6e20 7368 6172 6473 5b3a 7261   s in shards[:ra
+0001eb50: 6e6b 5d29 2c0a 2020 2020 2020 2020 2020  nk]),.          
+0001eb60: 2020 2020 2020 2020 2020 6469 7361 626c            disabl
+0001eb70: 655f 7471 646d 3d64 6973 6162 6c65 5f74  e_tqdm=disable_t
+0001eb80: 7164 6d2c 0a20 2020 2020 2020 2020 2020  qdm,.           
+0001eb90: 2020 2020 2020 2020 206e 6577 5f66 696e           new_fin
+0001eba0: 6765 7270 7269 6e74 3d66 6f72 6d61 745f  gerprint=format_
+0001ebb0: 6e65 775f 6669 6e67 6572 7072 696e 7428  new_fingerprint(
+0001ebc0: 6e65 775f 6669 6e67 6572 7072 696e 742c  new_fingerprint,
+0001ebd0: 2072 616e 6b29 0a20 2020 2020 2020 2020   rank).         
+0001ebe0: 2020 2020 2020 2020 2020 2069 6620 6e65             if ne
+0001ebf0: 775f 6669 6e67 6572 7072 696e 7420 6973  w_fingerprint is
+0001ec00: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
+0001ec10: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001ec20: 7365 204e 6f6e 652c 0a20 2020 2020 2020  se None,.       
+0001ec30: 2020 2020 2020 2020 2020 2020 2064 6573               des
+0001ec40: 633d 6465 7363 2c0a 2020 2020 2020 2020  c=desc,.        
+0001ec50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001ec60: 2020 2020 2020 2020 2020 666f 7220 7261            for ra
+0001ec70: 6e6b 2069 6e20 7261 6e67 6528 6e75 6d5f  nk in range(num_
+0001ec80: 7072 6f63 290a 2020 2020 2020 2020 2020  proc).          
+0001ec90: 2020 5d0a 0a20 2020 2020 2020 2020 2020    ]..           
+0001eca0: 2023 2057 6520 7365 6172 6368 2066 6f72   # We search for
+0001ecb0: 2061 6c72 6561 6479 2063 6163 6865 6420   already cached 
+0001ecc0: 7368 6172 6473 0a20 2020 2020 2020 2020  shards.         
+0001ecd0: 2020 2064 6566 2063 6174 6368 5f6e 6f6e     def catch_non
+0001ece0: 5f65 7869 7374 656e 745f 6572 726f 7228  _existent_error(
+0001ecf0: 6675 6e63 2c20 6b77 6172 6773 293a 0a20  func, kwargs):. 
+0001ed00: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001ed10: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001ed20: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+0001ed30: 756e 6328 2a2a 6b77 6172 6773 290a 2020  unc(**kwargs).  
+0001ed40: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0001ed50: 6365 7074 204e 6f6e 4578 6973 7465 6e74  cept NonExistent
+0001ed60: 4461 7461 7365 7445 7272 6f72 3a0a 2020  DatasetError:.  
+0001ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed80: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
+0001ed90: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+0001eda0: 666f 726d 6564 5f73 6861 7264 7320 3d20  formed_shards = 
+0001edb0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+0001edc0: 2020 6361 7463 685f 6e6f 6e5f 6578 6973    catch_non_exis
+0001edd0: 7465 6e74 5f65 7272 6f72 2873 656c 662e  tent_error(self.
+0001ede0: 5f5f 636c 6173 735f 5f2e 5f6d 6170 5f73  __class__._map_s
+0001edf0: 696e 676c 652c 2064 6963 7428 6361 6368  ingle, dict(cach
+0001ee00: 655f 6f6e 6c79 3d54 7275 652c 202a 2a6b  e_only=True, **k
+0001ee10: 7764 7329 290a 2020 2020 2020 2020 2020  wds)).          
+0001ee20: 2020 2020 2020 666f 7220 6b77 6473 2069        for kwds i
+0001ee30: 6e20 6b77 6473 5f70 6572 5f73 6861 7264  n kwds_per_shard
+0001ee40: 0a20 2020 2020 2020 2020 2020 205d 0a0a  .            ]..
+0001ee50: 2020 2020 2020 2020 2020 2020 2320 5765              # We
+0001ee60: 2074 7279 2074 6f20 6372 6561 7465 2061   try to create a
+0001ee70: 2070 6f6f 6c20 7769 7468 2061 7320 6d61   pool with as ma
+0001ee80: 6e79 2077 6f72 6b65 7273 2061 7320 6461  ny workers as da
+0001ee90: 7461 7365 7420 6e6f 7420 7965 7420 6361  taset not yet ca
+0001eea0: 6368 6564 2e0a 2020 2020 2020 2020 2020  ched..          
+0001eeb0: 2020 6e62 5f6f 665f 6d69 7373 696e 675f    nb_of_missing_
+0001eec0: 7368 6172 6473 203d 2074 7261 6e73 666f  shards = transfo
+0001eed0: 726d 6564 5f73 6861 7264 732e 636f 756e  rmed_shards.coun
+0001eee0: 7428 4e6f 6e65 290a 2020 2020 2020 2020  t(None).        
+0001eef0: 2020 2020 6966 206e 625f 6f66 5f6d 6973      if nb_of_mis
+0001ef00: 7369 6e67 5f73 6861 7264 7320 3e20 303a  sing_shards > 0:
+0001ef10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ef20: 2077 6974 6820 506f 6f6c 286e 625f 6f66   with Pool(nb_of
+0001ef30: 5f6d 6973 7369 6e67 5f73 6861 7264 732c  _missing_shards,
+0001ef40: 2069 6e69 7461 7267 733d 696e 6974 6172   initargs=initar
+0001ef50: 6773 2c20 696e 6974 6961 6c69 7a65 723d  gs, initializer=
+0001ef60: 696e 6974 6961 6c69 7a65 7229 2061 7320  initializer) as 
+0001ef70: 706f 6f6c 3a0a 2020 2020 2020 2020 2020  pool:.          
+0001ef80: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
+0001ef90: 6972 6f6e 203d 2070 7265 765f 656e 760a  iron = prev_env.
+0001efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001efb0: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+0001efc0: 6622 5370 6177 6e69 6e67 207b 6e75 6d5f  f"Spawning {num_
+0001efd0: 7072 6f63 7d20 7072 6f63 6573 7365 7322  proc} processes"
+0001efe0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001eff0: 2020 2020 2020 7265 7375 6c74 7320 3d20        results = 
+0001f000: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001f010: 2020 2020 2020 2020 2020 693a 2070 6f6f            i: poo
+0001f020: 6c2e 6170 706c 795f 6173 796e 6328 7365  l.apply_async(se
+0001f030: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 6d61  lf.__class__._ma
+0001f040: 705f 7369 6e67 6c65 2c20 6b77 6473 3d6b  p_single, kwds=k
+0001f050: 7764 7329 0a20 2020 2020 2020 2020 2020  wds).           
+0001f060: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001f070: 2069 2c20 286b 7764 732c 2063 6163 6865   i, (kwds, cache
+0001f080: 645f 7368 6172 6429 2069 6e20 656e 756d  d_shard) in enum
+0001f090: 6572 6174 6528 7a69 7028 6b77 6473 5f70  erate(zip(kwds_p
+0001f0a0: 6572 5f73 6861 7264 2c20 7472 616e 7366  er_shard, transf
+0001f0b0: 6f72 6d65 645f 7368 6172 6473 2929 0a20  ormed_shards)). 
+0001f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f0d0: 2020 2020 2020 2069 6620 6361 6368 6564         if cached
+0001f0e0: 5f73 6861 7264 2069 7320 4e6f 6e65 0a20  _shard is None. 
+0001f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f100: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+0001f110: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+0001f120: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001f130: 2020 2020 2020 2020 2020 6c65 6e28 7265            len(re
+0001f140: 7375 6c74 7329 203d 3d20 6e62 5f6f 665f  sults) == nb_of_
+0001f150: 6d69 7373 696e 675f 7368 6172 6473 0a20  missing_shards. 
+0001f160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f170: 2020 2029 2c20 2254 6865 206e 756d 6265     ), "The numbe
+0001f180: 7220 6f66 206d 6973 7369 6e67 2063 6163  r of missing cac
+0001f190: 6865 6420 7368 6172 6473 206e 6565 6473  hed shards needs
+0001f1a0: 2074 6f20 636f 7272 6573 706f 6e64 2074   to correspond t
+0001f1b0: 6f20 7468 6520 6e75 6d62 6572 206f 6620  o the number of 
+0001f1c0: 605f 6d61 705f 7369 6e67 6c65 6020 7765  `_map_single` we
+0001f1d0: 2772 6520 7275 6e6e 696e 6722 0a0a 2020  're running"..  
+0001f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f1f0: 2020 666f 7220 696e 6465 782c 2061 7379    for index, asy
+0001f200: 6e63 5f72 6573 756c 7420 696e 2072 6573  nc_result in res
+0001f210: 756c 7473 2e69 7465 6d73 2829 3a0a 2020  ults.items():.  
+0001f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f230: 2020 2020 2020 7472 616e 7366 6f72 6d65        transforme
+0001f240: 645f 7368 6172 6473 5b69 6e64 6578 5d20  d_shards[index] 
+0001f250: 3d20 6173 796e 635f 7265 7375 6c74 2e67  = async_result.g
+0001f260: 6574 2829 0a0a 2020 2020 2020 2020 2020  et()..          
+0001f270: 2020 6173 7365 7274 2028 0a20 2020 2020    assert (.     
+0001f280: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+0001f290: 666f 726d 6564 5f73 6861 7264 732e 636f  formed_shards.co
+0001f2a0: 756e 7428 4e6f 6e65 2920 3d3d 2030 0a20  unt(None) == 0. 
+0001f2b0: 2020 2020 2020 2020 2020 2029 2c20 2241             ), "A
+0001f2c0: 6c6c 2073 6861 7264 7320 6861 7665 2074  ll shards have t
+0001f2d0: 6f20 6265 2064 6566 696e 6564 2044 6174  o be defined Dat
+0001f2e0: 6173 6574 732c 206e 6f6e 6520 7368 6f75  asets, none shou
+0001f2f0: 6c64 2073 7469 6c6c 2062 6520 6d69 7373  ld still be miss
+0001f300: 696e 672e 220a 0a20 2020 2020 2020 2020  ing."..         
+0001f310: 2020 206c 6f67 6765 722e 696e 666f 2866     logger.info(f
+0001f320: 2243 6f6e 6361 7465 6e61 7469 6e67 207b  "Concatenating {
+0001f330: 6e75 6d5f 7072 6f63 7d20 7368 6172 6473  num_proc} shards
+0001f340: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0001f350: 6573 756c 7420 3d20 5f63 6f6e 6361 7465  esult = _concate
+0001f360: 6e61 7465 5f6d 6170 5f73 7479 6c65 5f64  nate_map_style_d
+0001f370: 6174 6173 6574 7328 7472 616e 7366 6f72  atasets(transfor
+0001f380: 6d65 645f 7368 6172 6473 290a 2020 2020  med_shards).    
+0001f390: 2020 2020 2020 2020 6966 206e 6577 5f66          if new_f
+0001f3a0: 696e 6765 7270 7269 6e74 2069 7320 6e6f  ingerprint is no
+0001f3b0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0001f3c0: 2020 2020 2020 2020 7265 7375 6c74 2e5f          result._
+0001f3d0: 6669 6e67 6572 7072 696e 7420 3d20 6e65  fingerprint = ne
+0001f3e0: 775f 6669 6e67 6572 7072 696e 740a 2020  w_fingerprint.  
+0001f3f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001f400: 2072 6573 756c 740a 0a20 2020 2040 7472   result..    @tr
+0001f410: 616e 736d 6974 5f74 6173 6b73 0a20 2020  ansmit_tasks.   
+0001f420: 2040 7472 616e 736d 6974 5f66 6f72 6d61   @transmit_forma
+0001f430: 740a 2020 2020 4066 696e 6765 7270 7269  t.    @fingerpri
+0001f440: 6e74 5f74 7261 6e73 666f 726d 280a 2020  nt_transform(.  
+0001f450: 2020 2020 2020 696e 706c 6163 653d 4661        inplace=Fa
+0001f460: 6c73 652c 2069 676e 6f72 655f 6b77 6172  lse, ignore_kwar
+0001f470: 6773 3d5b 226c 6f61 645f 6672 6f6d 5f63  gs=["load_from_c
+0001f480: 6163 6865 5f66 696c 6522 2c20 2263 6163  ache_file", "cac
+0001f490: 6865 5f66 696c 655f 6e61 6d65 222c 2022  he_file_name", "
+0001f4a0: 6469 7361 626c 655f 7471 646d 222c 2022  disable_tqdm", "
+0001f4b0: 6465 7363 222c 2022 6361 6368 655f 6f6e  desc", "cache_on
+0001f4c0: 6c79 225d 0a20 2020 2029 0a20 2020 2064  ly"].    ).    d
+0001f4d0: 6566 205f 6d61 705f 7369 6e67 6c65 280a  ef _map_single(.
+0001f4e0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0001f4f0: 2020 2020 2020 6675 6e63 7469 6f6e 3a20        function: 
+0001f500: 4f70 7469 6f6e 616c 5b43 616c 6c61 626c  Optional[Callabl
+0001f510: 655d 203d 204e 6f6e 652c 0a20 2020 2020  e] = None,.     
+0001f520: 2020 2077 6974 685f 696e 6469 6365 733a     with_indices:
+0001f530: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+0001f540: 2020 2020 2020 2077 6974 685f 7261 6e6b         with_rank
+0001f550: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+0001f560: 2020 2020 2020 2020 696e 7075 745f 636f          input_co
+0001f570: 6c75 6d6e 733a 204f 7074 696f 6e61 6c5b  lumns: Optional[
+0001f580: 4c69 7374 5b73 7472 5d5d 203d 204e 6f6e  List[str]] = Non
+0001f590: 652c 0a20 2020 2020 2020 2062 6174 6368  e,.        batch
+0001f5a0: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
+0001f5b0: 2c0a 2020 2020 2020 2020 6261 7463 685f  ,.        batch_
+0001f5c0: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b69  size: Optional[i
+0001f5d0: 6e74 5d20 3d20 3130 3030 2c0a 2020 2020  nt] = 1000,.    
+0001f5e0: 2020 2020 6472 6f70 5f6c 6173 745f 6261      drop_last_ba
+0001f5f0: 7463 683a 2062 6f6f 6c20 3d20 4661 6c73  tch: bool = Fals
+0001f600: 652c 0a20 2020 2020 2020 2072 656d 6f76  e,.        remov
+0001f610: 655f 636f 6c75 6d6e 733a 204f 7074 696f  e_columns: Optio
+0001f620: 6e61 6c5b 4c69 7374 5b73 7472 5d5d 203d  nal[List[str]] =
+0001f630: 204e 6f6e 652c 0a20 2020 2020 2020 206b   None,.        k
+0001f640: 6565 705f 696e 5f6d 656d 6f72 793a 2062  eep_in_memory: b
+0001f650: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0001f660: 2020 2020 206c 6f61 645f 6672 6f6d 5f63       load_from_c
+0001f670: 6163 6865 5f66 696c 653a 2062 6f6f 6c20  ache_file: bool 
+0001f680: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0001f690: 6361 6368 655f 6669 6c65 5f6e 616d 653a  cache_file_name:
+0001f6a0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+0001f6b0: 204e 6f6e 652c 0a20 2020 2020 2020 2077   None,.        w
+0001f6c0: 7269 7465 725f 6261 7463 685f 7369 7a65  riter_batch_size
+0001f6d0: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+0001f6e0: 3d20 3130 3030 2c0a 2020 2020 2020 2020  = 1000,.        
+0001f6f0: 6665 6174 7572 6573 3a20 4f70 7469 6f6e  features: Option
+0001f700: 616c 5b46 6561 7475 7265 735d 203d 204e  al[Features] = N
+0001f710: 6f6e 652c 0a20 2020 2020 2020 2064 6973  one,.        dis
+0001f720: 6162 6c65 5f6e 756c 6c61 626c 653a 2062  able_nullable: b
+0001f730: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0001f740: 2020 2020 2066 6e5f 6b77 6172 6773 3a20       fn_kwargs: 
+0001f750: 4f70 7469 6f6e 616c 5b64 6963 745d 203d  Optional[dict] =
+0001f760: 204e 6f6e 652c 0a20 2020 2020 2020 206e   None,.        n
+0001f770: 6577 5f66 696e 6765 7270 7269 6e74 3a20  ew_fingerprint: 
+0001f780: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+0001f790: 4e6f 6e65 2c0a 2020 2020 2020 2020 7261  None,.        ra
+0001f7a0: 6e6b 3a20 4f70 7469 6f6e 616c 5b69 6e74  nk: Optional[int
+0001f7b0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0001f7c0: 2020 6f66 6673 6574 3a20 696e 7420 3d20    offset: int = 
+0001f7d0: 302c 0a20 2020 2020 2020 2064 6973 6162  0,.        disab
+0001f7e0: 6c65 5f74 7164 6d3a 2062 6f6f 6c20 3d20  le_tqdm: bool = 
+0001f7f0: 4661 6c73 652c 0a20 2020 2020 2020 2064  False,.        d
+0001f800: 6573 633a 204f 7074 696f 6e61 6c5b 7374  esc: Optional[st
+0001f810: 725d 203d 204e 6f6e 652c 0a20 2020 2020  r] = None,.     
+0001f820: 2020 2063 6163 6865 5f6f 6e6c 793a 2062     cache_only: b
+0001f830: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0001f840: 2029 202d 3e20 2244 6174 6173 6574 223a   ) -> "Dataset":
+0001f850: 0a20 2020 2020 2020 2022 2222 4170 706c  .        """Appl
+0001f860: 7920 6120 6675 6e63 7469 6f6e 2074 6f20  y a function to 
+0001f870: 616c 6c20 7468 6520 656c 656d 656e 7473  all the elements
+0001f880: 2069 6e20 7468 6520 7461 626c 6520 2869   in the table (i
+0001f890: 6e64 6976 6964 7561 6c6c 7920 6f72 2069  ndividually or i
+0001f8a0: 6e20 6261 7463 6865 7329 0a20 2020 2020  n batches).     
+0001f8b0: 2020 2061 6e64 2075 7064 6174 6520 7468     and update th
+0001f8c0: 6520 7461 626c 6520 2869 6620 6675 6e63  e table (if func
+0001f8d0: 7469 6f6e 2064 6f65 7320 7570 6461 7465  tion does update
+0001f8e0: 2065 7861 6d70 6c65 7329 2e0a 0a20 2020   examples)...   
+0001f8f0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+0001f900: 2020 2020 2020 2066 756e 6374 696f 6e20         function 
+0001f910: 2860 4361 6c6c 6162 6c65 6029 3a20 7769  (`Callable`): wi
+0001f920: 7468 206f 6e65 206f 6620 7468 6520 666f  th one of the fo
+0001f930: 6c6c 6f77 696e 6720 7369 676e 6174 7572  llowing signatur
+0001f940: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001f950: 2020 202d 2060 6675 6e63 7469 6f6e 2865     - `function(e
+0001f960: 7861 6d70 6c65 3a20 4469 6374 5b73 7472  xample: Dict[str
+0001f970: 2c20 416e 795d 2920 2d3e 2044 6963 745b  , Any]) -> Dict[
+0001f980: 7374 722c 2041 6e79 5d60 2069 6620 6062  str, Any]` if `b
+0001f990: 6174 6368 6564 3d46 616c 7365 6020 616e  atched=False` an
+0001f9a0: 6420 6077 6974 685f 696e 6469 6365 733d  d `with_indices=
+0001f9b0: 4661 6c73 6560 2061 6e64 2060 7769 7468  False` and `with
+0001f9c0: 5f72 616e 6b3d 4661 6c73 6560 0a20 2020  _rank=False`.   
+0001f9d0: 2020 2020 2020 2020 2020 2020 202d 2060               - `
+0001f9e0: 6675 6e63 7469 6f6e 2865 7861 6d70 6c65  function(example
+0001f9f0: 3a20 4469 6374 5b73 7472 2c20 416e 795d  : Dict[str, Any]
+0001fa00: 2c20 2a65 7874 7261 5f61 7267 7329 202d  , *extra_args) -
+0001fa10: 3e20 4469 6374 5b73 7472 2c20 416e 795d  > Dict[str, Any]
+0001fa20: 6020 6966 2060 6261 7463 6865 643d 4661  ` if `batched=Fa
+0001fa30: 6c73 6560 2061 6e64 2060 7769 7468 5f69  lse` and `with_i
+0001fa40: 6e64 6963 6573 3d54 7275 6560 2061 6e64  ndices=True` and
+0001fa50: 2f6f 7220 6077 6974 685f 7261 6e6b 3d54  /or `with_rank=T
+0001fa60: 7275 6560 2028 6f6e 6520 6578 7472 6120  rue` (one extra 
+0001fa70: 6172 6720 666f 7220 6561 6368 290a 2020  arg for each).  
+0001fa80: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
+0001fa90: 6066 756e 6374 696f 6e28 6261 7463 683a  `function(batch:
+0001faa0: 2044 6963 745b 7374 722c 204c 6973 745d   Dict[str, List]
+0001fab0: 2920 2d3e 2044 6963 745b 7374 722c 204c  ) -> Dict[str, L
+0001fac0: 6973 745d 6020 6966 2060 6261 7463 6865  ist]` if `batche
+0001fad0: 643d 5472 7565 6020 616e 6420 6077 6974  d=True` and `wit
+0001fae0: 685f 696e 6469 6365 733d 4661 6c73 6560  h_indices=False`
+0001faf0: 2061 6e64 2060 7769 7468 5f72 616e 6b3d   and `with_rank=
+0001fb00: 4661 6c73 6560 0a20 2020 2020 2020 2020  False`.         
+0001fb10: 2020 2020 2020 202d 2060 6675 6e63 7469         - `functi
+0001fb20: 6f6e 2862 6174 6368 3a20 4469 6374 5b73  on(batch: Dict[s
+0001fb30: 7472 2c20 4c69 7374 5d2c 202a 6578 7472  tr, List], *extr
+0001fb40: 615f 6172 6773 2920 2d3e 2044 6963 745b  a_args) -> Dict[
+0001fb50: 7374 722c 204c 6973 745d 6020 6966 2060  str, List]` if `
+0001fb60: 6261 7463 6865 643d 5472 7565 6020 616e  batched=True` an
+0001fb70: 6420 6077 6974 685f 696e 6469 6365 733d  d `with_indices=
+0001fb80: 5472 7565 6020 616e 642f 6f72 2060 7769  True` and/or `wi
+0001fb90: 7468 5f72 616e 6b3d 5472 7565 6020 286f  th_rank=True` (o
+0001fba0: 6e65 2065 7874 7261 2061 7267 2066 6f72  ne extra arg for
+0001fbb0: 2065 6163 6829 0a0a 2020 2020 2020 2020   each)..        
+0001fbc0: 2020 2020 2020 2020 466f 7220 6164 7661          For adva
+0001fbd0: 6e63 6564 2075 7361 6765 2c20 7468 6520  nced usage, the 
+0001fbe0: 6675 6e63 7469 6f6e 2063 616e 2061 6c73  function can als
+0001fbf0: 6f20 7265 7475 726e 2061 2060 7079 6172  o return a `pyar
+0001fc00: 726f 772e 5461 626c 6560 2e0a 2020 2020  row.Table`..    
+0001fc10: 2020 2020 2020 2020 2020 2020 4d6f 7265              More
+0001fc20: 6f76 6572 2069 6620 796f 7572 2066 756e  over if your fun
+0001fc30: 6374 696f 6e20 7265 7475 726e 7320 6e6f  ction returns no
+0001fc40: 7468 696e 6720 2860 4e6f 6e65 6029 2c20  thing (`None`), 
+0001fc50: 7468 656e 2060 6d61 7060 2077 696c 6c20  then `map` will 
+0001fc60: 7275 6e20 796f 7572 2066 756e 6374 696f  run your functio
+0001fc70: 6e20 616e 6420 7265 7475 726e 2074 6865  n and return the
+0001fc80: 2064 6174 6173 6574 2075 6e63 6861 6e67   dataset unchang
+0001fc90: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+0001fca0: 2020 2020 4966 206e 6f20 6675 6e63 7469      If no functi
+0001fcb0: 6f6e 2069 7320 7072 6f76 6964 6564 2c20  on is provided, 
+0001fcc0: 6465 6661 756c 7420 746f 2069 6465 6e74  default to ident
+0001fcd0: 6974 7920 6675 6e63 7469 6f6e 3a20 6c61  ity function: la
+0001fce0: 6d62 6461 2078 3a20 780a 2020 2020 2020  mbda x: x.      
+0001fcf0: 2020 2020 2020 7769 7468 5f69 6e64 6963        with_indic
+0001fd00: 6573 2028 6062 6f6f 6c60 2c20 6465 6661  es (`bool`, defa
+0001fd10: 756c 7473 2074 6f20 6046 616c 7365 6029  ults to `False`)
+0001fd20: 3a20 5072 6f76 6964 6520 6578 616d 706c  : Provide exampl
+0001fd30: 6520 696e 6469 6365 7320 746f 2060 6675  e indices to `fu
+0001fd40: 6e63 7469 6f6e 602e 204e 6f74 6520 7468  nction`. Note th
+0001fd50: 6174 2069 6e20 7468 6973 2063 6173 6520  at in this case 
+0001fd60: 7468 6520 7369 676e 6174 7572 6520 6f66  the signature of
+0001fd70: 2060 6675 6e63 7469 6f6e 6020 7368 6f75   `function` shou
+0001fd80: 6c64 2062 6520 6064 6566 2066 756e 6374  ld be `def funct
+0001fd90: 696f 6e28 6578 616d 706c 652c 2069 6478  ion(example, idx
+0001fda0: 5b2c 2072 616e 6b5d 293a 202e 2e2e 602e  [, rank]): ...`.
+0001fdb0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0001fdc0: 685f 7261 6e6b 2028 6062 6f6f 6c60 2c20  h_rank (`bool`, 
+0001fdd0: 6465 6661 756c 7420 6046 616c 7365 6029  default `False`)
+0001fde0: 3a20 5072 6f76 6964 6520 7072 6f63 6573  : Provide proces
+0001fdf0: 7320 7261 6e6b 2074 6f20 6066 756e 6374  s rank to `funct
+0001fe00: 696f 6e60 2e20 4e6f 7465 2074 6861 7420  ion`. Note that 
+0001fe10: 696e 2074 6869 7320 6361 7365 2074 6865  in this case the
+0001fe20: 2073 6967 6e61 7475 7265 206f 6620 6066   signature of `f
+0001fe30: 756e 6374 696f 6e60 2073 686f 756c 6420  unction` should 
+0001fe40: 6265 2060 6465 6620 6675 6e63 7469 6f6e  be `def function
+0001fe50: 2865 7861 6d70 6c65 5b2c 2069 6478 5d2c  (example[, idx],
+0001fe60: 2072 616e 6b29 3a20 2e2e 2e60 2e0a 2020   rank): ...`..  
+0001fe70: 2020 2020 2020 2020 2020 696e 7075 745f            input_
+0001fe80: 636f 6c75 6d6e 7320 2860 4f70 7469 6f6e  columns (`Option
+0001fe90: 616c 5b4c 6973 745b 7374 725d 5d60 2c20  al[List[str]]`, 
+0001fea0: 6465 6661 756c 7473 2074 6f20 604e 6f6e  defaults to `Non
+0001feb0: 6560 293a 2054 6865 2063 6f6c 756d 6e73  e`): The columns
+0001fec0: 2074 6f20 6265 2070 6173 7365 6420 696e   to be passed in
+0001fed0: 746f 2060 6675 6e63 7469 6f6e 6020 6173  to `function` as
+0001fee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fef0: 2070 6f73 6974 696f 6e61 6c20 6172 6775   positional argu
+0001ff00: 6d65 6e74 732e 2049 6620 604e 6f6e 6560  ments. If `None`
+0001ff10: 2c20 6120 6469 6374 206d 6170 7069 6e67  , a dict mapping
+0001ff20: 2074 6f20 616c 6c20 666f 726d 6174 7465   to all formatte
+0001ff30: 6420 636f 6c75 6d6e 7320 6973 2070 6173  d columns is pas
+0001ff40: 7365 6420 6173 206f 6e65 2061 7267 756d  sed as one argum
+0001ff50: 656e 742e 0a20 2020 2020 2020 2020 2020  ent..           
+0001ff60: 2062 6174 6368 6564 2028 6062 6f6f 6c60   batched (`bool`
+0001ff70: 2c20 6465 6661 756c 7473 2074 6f20 6046  , defaults to `F
+0001ff80: 616c 7365 6029 3a20 5072 6f76 6964 6520  alse`): Provide 
+0001ff90: 6261 7463 6820 6f66 2065 7861 6d70 6c65  batch of example
+0001ffa0: 7320 746f 2060 6675 6e63 7469 6f6e 600a  s to `function`.
+0001ffb0: 2020 2020 2020 2020 2020 2020 6261 7463              batc
+0001ffc0: 685f 7369 7a65 2028 6069 6e74 602c 206f  h_size (`int`, o
+0001ffd0: 7074 696f 6e61 6c2c 2064 6566 6175 6c74  ptional, default
+0001ffe0: 7320 746f 2060 3130 3030 6029 3a20 4e75  s to `1000`): Nu
+0001fff0: 6d62 6572 206f 6620 6578 616d 706c 6573  mber of examples
+00020000: 2070 6572 2062 6174 6368 2070 726f 7669   per batch provi
+00020010: 6465 6420 746f 2060 6675 6e63 7469 6f6e  ded to `function
+00020020: 6020 6966 2060 6261 7463 6865 643d 5472  ` if `batched=Tr
+00020030: 7565 600a 2020 2020 2020 2020 2020 2020  ue`.            
+00020040: 2020 2020 6062 6174 6368 5f73 697a 6520      `batch_size 
+00020050: 3c3d 2030 6020 6f72 2060 6261 7463 685f  <= 0` or `batch_
+00020060: 7369 7a65 203d 3d20 4e6f 6e65 603a 2050  size == None`: P
+00020070: 726f 7669 6465 2074 6865 2066 756c 6c20  rovide the full 
+00020080: 6461 7461 7365 7420 6173 2061 2073 696e  dataset as a sin
+00020090: 676c 6520 6261 7463 6820 746f 2060 6675  gle batch to `fu
+000200a0: 6e63 7469 6f6e 600a 2020 2020 2020 2020  nction`.        
+000200b0: 2020 2020 6472 6f70 5f6c 6173 745f 6261      drop_last_ba
+000200c0: 7463 6820 2860 626f 6f6c 602c 2064 6566  tch (`bool`, def
+000200d0: 6175 6c74 3a20 6046 616c 7365 6029 3a20  ault: `False`): 
+000200e0: 5768 6574 6865 7220 6120 6c61 7374 2062  Whether a last b
+000200f0: 6174 6368 2073 6d61 6c6c 6572 2074 6861  atch smaller tha
+00020100: 6e20 7468 6520 6261 7463 685f 7369 7a65  n the batch_size
+00020110: 2073 686f 756c 6420 6265 0a20 2020 2020   should be.     
+00020120: 2020 2020 2020 2020 2020 2064 726f 7070             dropp
+00020130: 6564 2069 6e73 7465 6164 206f 6620 6265  ed instead of be
+00020140: 696e 6720 7072 6f63 6573 7365 6420 6279  ing processed by
+00020150: 2074 6865 2066 756e 6374 696f 6e2e 0a20   the function.. 
+00020160: 2020 2020 2020 2020 2020 2072 656d 6f76             remov
+00020170: 655f 636f 6c75 6d6e 7320 2860 4f70 7469  e_columns (`Opti
+00020180: 6f6e 616c 5b4c 6973 745b 7374 725d 5d60  onal[List[str]]`
+00020190: 2c20 6465 6661 756c 7473 2074 6f20 604e  , defaults to `N
+000201a0: 6f6e 6560 293a 2052 656d 6f76 6520 6120  one`): Remove a 
+000201b0: 7365 6c65 6374 696f 6e20 6f66 2063 6f6c  selection of col
+000201c0: 756d 6e73 2077 6869 6c65 2064 6f69 6e67  umns while doing
+000201d0: 2074 6865 206d 6170 7069 6e67 2e0a 2020   the mapping..  
+000201e0: 2020 2020 2020 2020 2020 2020 2020 436f                Co
+000201f0: 6c75 6d6e 7320 7769 6c6c 2062 6520 7265  lumns will be re
+00020200: 6d6f 7665 6420 6265 666f 7265 2075 7064  moved before upd
+00020210: 6174 696e 6720 7468 6520 6578 616d 706c  ating the exampl
+00020220: 6573 2077 6974 6820 7468 6520 6f75 7470  es with the outp
+00020230: 7574 206f 6620 6066 756e 6374 696f 6e60  ut of `function`
+00020240: 2c20 692e 652e 2069 6620 6066 756e 6374  , i.e. if `funct
+00020250: 696f 6e60 2069 7320 6164 6469 6e67 0a20  ion` is adding. 
+00020260: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00020270: 6f6c 756d 6e73 2077 6974 6820 6e61 6d65  olumns with name
+00020280: 7320 696e 2060 7265 6d6f 7665 5f63 6f6c  s in `remove_col
+00020290: 756d 6e73 602c 2074 6865 7365 2063 6f6c  umns`, these col
+000202a0: 756d 6e73 2077 696c 6c20 6265 206b 6570  umns will be kep
+000202b0: 742e 0a20 2020 2020 2020 2020 2020 206b  t..            k
+000202c0: 6565 705f 696e 5f6d 656d 6f72 7920 2860  eep_in_memory (`
+000202d0: 626f 6f6c 602c 2064 6566 6175 6c74 7320  bool`, defaults 
+000202e0: 746f 2060 4661 6c73 6560 293a 204b 6565  to `False`): Kee
+000202f0: 7020 7468 6520 6461 7461 7365 7420 696e  p the dataset in
+00020300: 206d 656d 6f72 7920 696e 7374 6561 6420   memory instead 
+00020310: 6f66 2077 7269 7469 6e67 2069 7420 746f  of writing it to
+00020320: 2061 2063 6163 6865 2066 696c 652e 0a20   a cache file.. 
+00020330: 2020 2020 2020 2020 2020 206c 6f61 645f             load_
+00020340: 6672 6f6d 5f63 6163 6865 5f66 696c 6520  from_cache_file 
+00020350: 2860 626f 6f6c 602c 2064 6566 6175 6c74  (`bool`, default
+00020360: 7320 746f 2060 5472 7565 6020 6966 2063  s to `True` if c
+00020370: 6163 6869 6e67 2069 7320 656e 6162 6c65  aching is enable
+00020380: 6429 3a20 4966 2061 2063 6163 6865 2066  d): If a cache f
+00020390: 696c 6520 7374 6f72 696e 6720 7468 6520  ile storing the 
+000203a0: 6375 7272 656e 7420 636f 6d70 7574 6174  current computat
+000203b0: 696f 6e20 6672 6f6d 2060 6675 6e63 7469  ion from `functi
+000203c0: 6f6e 600a 2020 2020 2020 2020 2020 2020  on`.            
+000203d0: 2020 2020 6361 6e20 6265 2069 6465 6e74      can be ident
+000203e0: 6966 6965 642c 2075 7365 2069 7420 696e  ified, use it in
+000203f0: 7374 6561 6420 6f66 2072 6563 6f6d 7075  stead of recompu
+00020400: 7469 6e67 2e0a 2020 2020 2020 2020 2020  ting..          
+00020410: 2020 6361 6368 655f 6669 6c65 5f6e 616d    cache_file_nam
+00020420: 6520 2860 7374 7260 2c20 6f70 7469 6f6e  e (`str`, option
+00020430: 616c 2c20 6465 6661 756c 7473 2074 6f20  al, defaults to 
+00020440: 604e 6f6e 6560 293a 2050 726f 7669 6465  `None`): Provide
+00020450: 2074 6865 206e 616d 6520 6f66 2061 2070   the name of a p
+00020460: 6174 6820 666f 7220 7468 6520 6361 6368  ath for the cach
+00020470: 6520 6669 6c65 2e20 4974 2069 7320 7573  e file. It is us
+00020480: 6564 2074 6f20 7374 6f72 6520 7468 650a  ed to store the.
+00020490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204a0: 7265 7375 6c74 7320 6f66 2074 6865 2063  results of the c
+000204b0: 6f6d 7075 7461 7469 6f6e 2069 6e73 7465  omputation inste
+000204c0: 6164 206f 6620 7468 6520 6175 746f 6d61  ad of the automa
+000204d0: 7469 6361 6c6c 7920 6765 6e65 7261 7465  tically generate
+000204e0: 6420 6361 6368 6520 6669 6c65 206e 616d  d cache file nam
+000204f0: 652e 0a20 2020 2020 2020 2020 2020 2077  e..            w
+00020500: 7269 7465 725f 6261 7463 685f 7369 7a65  riter_batch_size
+00020510: 2028 6069 6e74 602c 2064 6566 6175 6c74   (`int`, default
+00020520: 2060 3130 3030 6029 3a20 4e75 6d62 6572   `1000`): Number
+00020530: 206f 6620 726f 7773 2070 6572 2077 7269   of rows per wri
+00020540: 7465 206f 7065 7261 7469 6f6e 2066 6f72  te operation for
+00020550: 2074 6865 2063 6163 6865 2066 696c 6520   the cache file 
+00020560: 7772 6974 6572 2e0a 2020 2020 2020 2020  writer..        
+00020570: 2020 2020 2020 2020 5468 6973 2076 616c          This val
+00020580: 7565 2069 7320 6120 676f 6f64 2074 7261  ue is a good tra
+00020590: 6465 2d6f 6666 2062 6574 7765 656e 206d  de-off between m
+000205a0: 656d 6f72 7920 7573 6167 6520 6475 7269  emory usage duri
+000205b0: 6e67 2074 6865 2070 726f 6365 7373 696e  ng the processin
+000205c0: 672c 2061 6e64 2070 726f 6365 7373 696e  g, and processin
+000205d0: 6720 7370 6565 642e 0a20 2020 2020 2020  g speed..       
+000205e0: 2020 2020 2020 2020 2048 6967 6865 7220           Higher 
+000205f0: 7661 6c75 6520 6d61 6b65 7320 7468 6520  value makes the 
+00020600: 7072 6f63 6573 7369 6e67 2064 6f20 6665  processing do fe
+00020610: 7765 7220 6c6f 6f6b 7570 732c 206c 6f77  wer lookups, low
+00020620: 6572 2076 616c 7565 2063 6f6e 7375 6d65  er value consume
+00020630: 206c 6573 7320 7465 6d70 6f72 6172 7920   less temporary 
+00020640: 6d65 6d6f 7279 2077 6869 6c65 2072 756e  memory while run
+00020650: 6e69 6e67 2060 2e6d 6170 2829 602e 0a20  ning `.map()`.. 
+00020660: 2020 2020 2020 2020 2020 2066 6561 7475             featu
+00020670: 7265 7320 2860 4f70 7469 6f6e 616c 5b64  res (`Optional[d
+00020680: 6174 6173 6574 732e 4665 6174 7572 6573  atasets.Features
+00020690: 5d60 2c20 6465 6661 756c 7473 2074 6f20  ]`, defaults to 
+000206a0: 604e 6f6e 6560 293a 2055 7365 2061 2073  `None`): Use a s
+000206b0: 7065 6369 6669 6320 4665 6174 7572 6573  pecific Features
+000206c0: 2074 6f20 7374 6f72 6520 7468 6520 6361   to store the ca
+000206d0: 6368 6520 6669 6c65 0a20 2020 2020 2020  che file.       
+000206e0: 2020 2020 2020 2020 2069 6e73 7465 6164           instead
+000206f0: 206f 6620 7468 6520 6175 746f 6d61 7469   of the automati
+00020700: 6361 6c6c 7920 6765 6e65 7261 7465 6420  cally generated 
+00020710: 6f6e 652e 0a20 2020 2020 2020 2020 2020  one..           
+00020720: 2064 6973 6162 6c65 5f6e 756c 6c61 626c   disable_nullabl
+00020730: 6520 2860 626f 6f6c 602c 2064 6566 6175  e (`bool`, defau
+00020740: 6c74 7320 746f 2060 4661 6c73 6560 293a  lts to `False`):
+00020750: 2044 6973 616c 6c6f 7720 6e75 6c6c 2076   Disallow null v
+00020760: 616c 7565 7320 696e 2074 6865 2074 6162  alues in the tab
+00020770: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
+00020780: 666e 5f6b 7761 7267 7320 2860 4469 6374  fn_kwargs (`Dict
+00020790: 602c 206f 7074 696f 6e61 6c2c 2064 6566  `, optional, def
+000207a0: 6175 6c74 7320 746f 2060 4e6f 6e65 6029  aults to `None`)
+000207b0: 3a20 4b65 7977 6f72 6420 6172 6775 6d65  : Keyword argume
+000207c0: 6e74 7320 746f 2062 6520 7061 7373 6564  nts to be passed
+000207d0: 2074 6f20 6066 756e 6374 696f 6e60 0a20   to `function`. 
+000207e0: 2020 2020 2020 2020 2020 206e 6577 5f66             new_f
+000207f0: 696e 6765 7270 7269 6e74 2028 6073 7472  ingerprint (`str
+00020800: 602c 206f 7074 696f 6e61 6c2c 2064 6566  `, optional, def
+00020810: 6175 6c74 7320 746f 2060 4e6f 6e65 6029  aults to `None`)
+00020820: 3a20 7468 6520 6e65 7720 6669 6e67 6572  : the new finger
+00020830: 7072 696e 7420 6f66 2074 6865 2064 6174  print of the dat
+00020840: 6173 6574 2061 6674 6572 2074 7261 6e73  aset after trans
+00020850: 666f 726d 2e0a 2020 2020 2020 2020 2020  form..          
+00020860: 2020 2020 2020 4966 2060 4e6f 6e65 602c        If `None`,
+00020870: 2074 6865 206e 6577 2066 696e 6765 7270   the new fingerp
+00020880: 7269 6e74 2069 7320 636f 6d70 7574 6564  rint is computed
+00020890: 2075 7369 6e67 2061 2068 6173 6820 6f66   using a hash of
+000208a0: 2074 6865 2070 7265 7669 6f75 7320 6669   the previous fi
+000208b0: 6e67 6572 7072 696e 742c 2061 6e64 2074  ngerprint, and t
+000208c0: 6865 2074 7261 6e73 666f 726d 2061 7267  he transform arg
+000208d0: 756d 656e 7473 0a20 2020 2020 2020 2020  uments.         
+000208e0: 2020 2072 616e 6b3a 2028 6069 6e74 602c     rank: (`int`,
+000208f0: 206f 7074 696f 6e61 6c2c 2064 6566 6175   optional, defau
+00020900: 6c74 7320 746f 2060 4e6f 6e65 6029 3a20  lts to `None`): 
+00020910: 4966 2073 7065 6369 6669 6564 2c20 7468  If specified, th
+00020920: 6973 2069 7320 7468 6520 7072 6f63 6573  is is the proces
+00020930: 7320 7261 6e6b 2077 6865 6e20 646f 696e  s rank when doin
+00020940: 6720 6d75 6c74 6970 726f 6365 7373 696e  g multiprocessin
+00020950: 670a 2020 2020 2020 2020 2020 2020 6f66  g.            of
+00020960: 6673 6574 3a20 2860 696e 7460 2c20 6465  fset: (`int`, de
+00020970: 6661 756c 7473 2074 6f20 3029 3a20 4966  faults to 0): If
+00020980: 2073 7065 6369 6669 6564 2c20 7468 6973   specified, this
+00020990: 2069 7320 616e 206f 6666 7365 7420 6170   is an offset ap
+000209a0: 706c 6965 6420 746f 2074 6865 2069 6e64  plied to the ind
+000209b0: 6963 6573 2070 6173 7365 6420 746f 2060  ices passed to `
+000209c0: 6675 6e63 7469 6f6e 6020 6966 2060 7769  function` if `wi
+000209d0: 7468 5f69 6e64 6963 6573 3d54 7275 6560  th_indices=True`
+000209e0: 2e0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+000209f0: 7361 626c 655f 7471 646d 2028 6062 6f6f  sable_tqdm (`boo
+00020a00: 6c60 2c20 6465 6661 756c 7473 2074 6f20  l`, defaults to 
+00020a10: 6046 616c 7365 6029 3a20 5768 6574 6865  `False`): Whethe
+00020a20: 7220 746f 2073 696c 656e 6365 2074 7164  r to silence tqd
+00020a30: 6d27 7320 6f75 7470 7574 2e0a 2020 2020  m's output..    
+00020a40: 2020 2020 2020 2020 6465 7363 2028 6073          desc (`s
+00020a50: 7472 602c 206f 7074 696f 6e61 6c2c 2064  tr`, optional, d
+00020a60: 6566 6175 6c74 7320 746f 2060 4e6f 6e65  efaults to `None
+00020a70: 6029 3a20 4d65 616e 696e 6766 756c 2064  `): Meaningful d
+00020a80: 6573 6372 6970 7469 6f6e 2074 6f20 6265  escription to be
+00020a90: 2064 6973 706c 6179 6564 2061 6c6f 6e67   displayed along
+00020aa0: 7369 6465 2077 6974 6820 7468 6520 7072  side with the pr
+00020ab0: 6f67 7265 7373 2062 6172 2077 6869 6c65  ogress bar while
+00020ac0: 206d 6170 7069 6e67 2065 7861 6d70 6c65   mapping example
+00020ad0: 732e 0a20 2020 2020 2020 2020 2020 2063  s..            c
+00020ae0: 6163 6865 5f6f 6e6c 7920 2860 626f 6f6c  ache_only (`bool
+00020af0: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
+00020b00: 4661 6c73 6560 293a 2046 6c61 6720 696e  False`): Flag in
+00020b10: 206f 7264 6572 2074 6f20 6e6f 7469 6669   order to notifi
+00020b20: 7920 7468 6520 6d65 7468 6f64 2077 696c  y the method wil
+00020b30: 6c20 6569 7468 6572 2066 696e 6420 6120  l either find a 
+00020b40: 6361 6368 6564 2064 6174 6173 6574 206f  cached dataset o
+00020b50: 7220 7261 6973 6520 604e 6f6e 4578 6973  r raise `NonExis
+00020b60: 7465 6e74 4461 7461 7365 7445 7272 6f72  tentDatasetError
+00020b70: 6020 6578 6365 7074 696f 6e2c 0a20 2020  ` exception,.   
+00020b80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00020b90: 2023 2052 6564 7563 6520 6c6f 6767 696e   # Reduce loggin
+00020ba0: 6720 746f 206b 6565 7020 7468 696e 6773  g to keep things
+00020bb0: 2072 6561 6461 626c 6520 696e 206d 756c   readable in mul
+00020bc0: 7469 7072 6f63 6573 7369 6e67 2077 6974  tiprocessing wit
+00020bd0: 6820 7471 646d 0a20 2020 2020 2020 2069  h tqdm.        i
+00020be0: 6620 7261 6e6b 2069 7320 6e6f 7420 4e6f  f rank is not No
+00020bf0: 6e65 2061 6e64 206c 6f67 6769 6e67 2e67  ne and logging.g
+00020c00: 6574 5f76 6572 626f 7369 7479 2829 203c  et_verbosity() <
+00020c10: 206c 6f67 6769 6e67 2e57 4152 4e49 4e47   logging.WARNING
+00020c20: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00020c30: 6767 696e 672e 7365 745f 7665 7262 6f73  gging.set_verbos
+00020c40: 6974 795f 7761 726e 696e 6728 290a 2020  ity_warning().  
+00020c50: 2020 2020 2020 2320 5072 696e 7420 6174        # Print at
+00020c60: 206c 6561 7374 206f 6e65 2074 6869 6e67   least one thing
+00020c70: 2074 6f20 6669 7820 7471 646d 2069 6e20   to fix tqdm in 
+00020c80: 6e6f 7465 626f 6f6b 7320 696e 206d 756c  notebooks in mul
+00020c90: 7469 7072 6f63 6573 7369 6e67 0a20 2020  tiprocessing.   
+00020ca0: 2020 2020 2023 2073 6565 2068 7474 7073       # see https
+00020cb0: 3a2f 2f67 6974 6875 622e 636f 6d2f 7471  ://github.com/tq
+00020cc0: 646d 2f74 7164 6d2f 6973 7375 6573 2f34  dm/tqdm/issues/4
+00020cd0: 3835 2369 7373 7565 636f 6d6d 656e 742d  85#issuecomment-
+00020ce0: 3437 3333 3338 3330 380a 2020 2020 2020  473338308.      
+00020cf0: 2020 6966 2072 616e 6b20 6973 206e 6f74    if rank is not
+00020d00: 204e 6f6e 6520 616e 6420 6e6f 7420 6469   None and not di
+00020d10: 7361 626c 655f 7471 646d 2061 6e64 2061  sable_tqdm and a
+00020d20: 6e79 2822 6e6f 7465 626f 6f6b 2220 696e  ny("notebook" in
+00020d30: 2074 7164 6d5f 636c 732e 5f5f 6e61 6d65   tqdm_cls.__name
+00020d40: 5f5f 2066 6f72 2074 7164 6d5f 636c 7320  __ for tqdm_cls 
+00020d50: 696e 2074 7164 6d2e 5f5f 6d72 6f5f 5f29  in tqdm.__mro__)
+00020d60: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00020d70: 696e 7428 2220 222c 2065 6e64 3d22 222c  int(" ", end="",
+00020d80: 2066 6c75 7368 3d54 7275 6529 0a0a 2020   flush=True)..  
+00020d90: 2020 2020 2020 6966 2066 6e5f 6b77 6172        if fn_kwar
+00020da0: 6773 2069 7320 4e6f 6e65 3a0a 2020 2020  gs is None:.    
+00020db0: 2020 2020 2020 2020 666e 5f6b 7761 7267          fn_kwarg
+00020dc0: 7320 3d20 7b7d 0a0a 2020 2020 2020 2020  s = {}..        
+00020dd0: 2320 4966 2077 6520 646f 2062 6174 6368  # If we do batch
+00020de0: 2063 6f6d 7075 7461 7469 6f6e 2062 7574   computation but
+00020df0: 206e 6f20 6261 7463 6820 7369 7a65 2069   no batch size i
+00020e00: 7320 7072 6f76 6964 6564 2c20 6465 6661  s provided, defa
+00020e10: 756c 7420 746f 2074 6865 2066 756c 6c20  ult to the full 
+00020e20: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
+00020e30: 6966 2062 6174 6368 6564 2061 6e64 2028  if batched and (
+00020e40: 6261 7463 685f 7369 7a65 2069 7320 4e6f  batch_size is No
+00020e50: 6e65 206f 7220 6261 7463 685f 7369 7a65  ne or batch_size
+00020e60: 203c 3d20 3029 3a0a 2020 2020 2020 2020   <= 0):.        
+00020e70: 2020 2020 6261 7463 685f 7369 7a65 203d      batch_size =
+00020e80: 2073 656c 662e 6e75 6d5f 726f 7773 0a0a   self.num_rows..
+00020e90: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+00020ea0: 6966 2077 6527 7665 2061 6c72 6561 6479  if we've already
+00020eb0: 2063 6163 6865 6420 7468 6973 2063 6f6d   cached this com
+00020ec0: 7075 7461 7469 6f6e 2028 696e 6465 7865  putation (indexe
+00020ed0: 6420 6279 2061 2068 6173 6829 0a20 2020  d by a hash).   
+00020ee0: 2020 2020 2069 6620 7365 6c66 2e63 6163       if self.cac
+00020ef0: 6865 5f66 696c 6573 3a0a 2020 2020 2020  he_files:.      
+00020f00: 2020 2020 2020 6966 2063 6163 6865 5f66        if cache_f
+00020f10: 696c 655f 6e61 6d65 2069 7320 4e6f 6e65  ile_name is None
+00020f20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00020f30: 2020 2320 7765 2063 7265 6174 6520 6120    # we create a 
+00020f40: 756e 6971 7565 2068 6173 6820 6672 6f6d  unique hash from
+00020f50: 2074 6865 2066 756e 6374 696f 6e2c 0a20   the function,. 
+00020f60: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00020f70: 2063 7572 7265 6e74 2064 6174 6173 6574   current dataset
+00020f80: 2066 696c 6520 616e 6420 7468 6520 6d61   file and the ma
+00020f90: 7070 696e 6720 6172 6773 0a20 2020 2020  pping args.     
+00020fa0: 2020 2020 2020 2020 2020 2063 6163 6865             cache
+00020fb0: 5f66 696c 655f 6e61 6d65 203d 2073 656c  _file_name = sel
+00020fc0: 662e 5f67 6574 5f63 6163 6865 5f66 696c  f._get_cache_fil
+00020fd0: 655f 7061 7468 286e 6577 5f66 696e 6765  e_path(new_finge
+00020fe0: 7270 7269 6e74 290a 2020 2020 2020 2020  rprint).        
+00020ff0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+00021000: 7869 7374 7328 6361 6368 655f 6669 6c65  xists(cache_file
+00021010: 5f6e 616d 6529 2061 6e64 206c 6f61 645f  _name) and load_
+00021020: 6672 6f6d 5f63 6163 6865 5f66 696c 653a  from_cache_file:
+00021030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021040: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
+00021050: 6622 4c6f 6164 696e 6720 6361 6368 6564  f"Loading cached
+00021060: 2070 726f 6365 7373 6564 2064 6174 6173   processed datas
+00021070: 6574 2061 7420 7b63 6163 6865 5f66 696c  et at {cache_fil
+00021080: 655f 6e61 6d65 7d22 290a 2020 2020 2020  e_name}").      
+00021090: 2020 2020 2020 2020 2020 696e 666f 203d            info =
+000210a0: 2073 656c 662e 696e 666f 2e63 6f70 7928   self.info.copy(
+000210b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000210c0: 2020 696e 666f 2e66 6561 7475 7265 7320    info.features 
+000210d0: 3d20 6665 6174 7572 6573 0a20 2020 2020  = features.     
+000210e0: 2020 2020 2020 2020 2020 2069 6e66 6f2e             info.
+000210f0: 7461 736b 5f74 656d 706c 6174 6573 203d  task_templates =
+00021100: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00021110: 2020 2020 2020 7265 7475 726e 2044 6174        return Dat
+00021120: 6173 6574 2e66 726f 6d5f 6669 6c65 2863  aset.from_file(c
+00021130: 6163 6865 5f66 696c 655f 6e61 6d65 2c20  ache_file_name, 
+00021140: 696e 666f 3d69 6e66 6f2c 2073 706c 6974  info=info, split
+00021150: 3d73 656c 662e 7370 6c69 7429 0a0a 2020  =self.split)..  
+00021160: 2020 2020 2020 2320 5261 6973 6520 616e        # Raise an
+00021170: 2065 7272 6f72 2069 6620 7765 2077 6572   error if we wer
+00021180: 6520 7375 7070 6f73 6564 2074 6f20 7265  e supposed to re
+00021190: 7475 726e 2061 2063 6163 6865 6420 6461  turn a cached da
+000211a0: 7461 7365 7420 616e 6420 6e6f 6e65 2077  taset and none w
+000211b0: 6173 2066 6f75 6e64 0a20 2020 2020 2020  as found.       
+000211c0: 2069 6620 6361 6368 655f 6f6e 6c79 3a0a   if cache_only:.
+000211d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000211e0: 6520 4e6f 6e45 7869 7374 656e 7444 6174  e NonExistentDat
+000211f0: 6173 6574 4572 726f 720a 0a20 2020 2020  asetError..     
+00021200: 2020 2023 2057 6520 7365 7420 7468 6973     # We set this
+00021210: 2076 6172 6961 626c 6520 746f 2054 7275   variable to Tru
+00021220: 6520 6166 7465 7220 7072 6f63 6573 7369  e after processi
+00021230: 6e67 2074 6865 2066 6972 7374 2065 7861  ng the first exa
+00021240: 6d70 6c65 2f62 6174 6368 2069 6e0a 2020  mple/batch in.  
+00021250: 2020 2020 2020 2320 6061 7070 6c79 5f66        # `apply_f
+00021260: 756e 6374 696f 6e5f 6f6e 5f66 696c 7465  unction_on_filte
+00021270: 7265 645f 696e 7075 7473 6020 6966 2074  red_inputs` if t
+00021280: 6865 206d 6170 2066 756e 6374 696f 6e20  he map function 
+00021290: 7265 7475 726e 7320 6120 6469 6374 2e0a  returns a dict..
+000212a0: 2020 2020 2020 2020 2320 4966 2073 6574          # If set
+000212b0: 2074 6f20 4661 6c73 652c 206e 6f20 6e65   to False, no ne
+000212c0: 7720 6172 726f 7720 7461 626c 6520 7769  w arrow table wi
+000212d0: 6c6c 2062 6520 6372 6561 7465 640a 0a20  ll be created.. 
+000212e0: 2020 2020 2020 2075 7064 6174 655f 6461         update_da
+000212f0: 7461 203d 204e 6f6e 650a 0a20 2020 2020  ta = None..     
+00021300: 2020 2066 6f72 6d61 745f 6b77 6172 6773     format_kwargs
+00021310: 203d 2073 656c 662e 5f66 6f72 6d61 745f   = self._format_
+00021320: 6b77 6172 6773 2e63 6f70 7928 290a 2020  kwargs.copy().  
+00021330: 2020 2020 2020 2320 4c61 7a79 2066 6f72        # Lazy for
+00021340: 6d61 7474 696e 6720 6973 206f 6e6c 7920  matting is only 
+00021350: 6176 6169 6c61 626c 6520 666f 7220 7468  available for th
+00021360: 6520 6465 6661 756c 7420 666f 726d 6174  e default format
+00021370: 2028 4e6f 6e65 2f70 7974 686f 6e29 0a20   (None/python). 
+00021380: 2020 2020 2020 2069 6620 6e6f 7420 696e         if not in
+00021390: 7075 745f 636f 6c75 6d6e 7320 616e 6420  put_columns and 
+000213a0: 7365 6c66 2e5f 666f 726d 6174 5f74 7970  self._format_typ
+000213b0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+000213c0: 2020 2020 2020 2066 6f72 6d61 745f 6b77         format_kw
+000213d0: 6172 6773 5b22 6c61 7a79 225d 203d 2054  args["lazy"] = T
+000213e0: 7275 650a 2020 2020 2020 2020 696e 7075  rue.        inpu
+000213f0: 745f 666f 726d 6174 7465 7220 3d20 6765  t_formatter = ge
+00021400: 745f 666f 726d 6174 7465 7228 0a20 2020  t_formatter(.   
+00021410: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+00021420: 6f72 6d61 745f 7479 7065 2c0a 2020 2020  ormat_type,.    
+00021430: 2020 2020 2020 2020 6665 6174 7572 6573          features
+00021440: 3d73 656c 662e 6665 6174 7572 6573 2c0a  =self.features,.
+00021450: 2020 2020 2020 2020 2020 2020 2a2a 666f              **fo
+00021460: 726d 6174 5f6b 7761 7267 732c 0a20 2020  rmat_kwargs,.   
+00021470: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00021480: 636c 6173 7320 4e75 6d45 7861 6d70 6c65  class NumExample
+00021490: 734d 6973 6d61 7463 6845 7272 6f72 2845  sMismatchError(E
+000214a0: 7863 6570 7469 6f6e 293a 0a20 2020 2020  xception):.     
+000214b0: 2020 2020 2020 2070 6173 730a 0a20 2020         pass..   
+000214c0: 2020 2020 2064 6566 2076 616c 6964 6174       def validat
+000214d0: 655f 6675 6e63 7469 6f6e 5f6f 7574 7075  e_function_outpu
+000214e0: 7428 7072 6f63 6573 7365 645f 696e 7075  t(processed_inpu
+000214f0: 7473 2c20 696e 6469 6365 7329 3a0a 2020  ts, indices):.  
+00021500: 2020 2020 2020 2020 2020 2222 2256 616c            """Val
+00021510: 6964 6174 6520 6f75 7470 7574 206f 6620  idate output of 
+00021520: 7468 6520 6d61 7020 6675 6e63 7469 6f6e  the map function
+00021530: 2e22 2222 0a20 2020 2020 2020 2020 2020  .""".           
+00021540: 2069 6620 7072 6f63 6573 7365 645f 696e   if processed_in
+00021550: 7075 7473 2069 7320 6e6f 7420 4e6f 6e65  puts is not None
+00021560: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
+00021570: 6e63 6528 7072 6f63 6573 7365 645f 696e  nce(processed_in
+00021580: 7075 7473 2c20 284d 6170 7069 6e67 2c20  puts, (Mapping, 
+00021590: 7061 2e54 6162 6c65 2929 3a0a 2020 2020  pa.Table)):.    
+000215a0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000215b0: 6520 5479 7065 4572 726f 7228 0a20 2020  e TypeError(.   
+000215c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000215d0: 2066 2250 726f 7669 6465 6420 6066 756e   f"Provided `fun
+000215e0: 6374 696f 6e60 2077 6869 6368 2069 7320  ction` which is 
+000215f0: 6170 706c 6965 6420 746f 2061 6c6c 2065  applied to all e
+00021600: 6c65 6d65 6e74 7320 6f66 2074 6162 6c65  lements of table
+00021610: 2072 6574 7572 6e73 2061 2076 6172 6961   returns a varia
+00021620: 626c 6520 6f66 2074 7970 6520 7b74 7970  ble of type {typ
+00021630: 6528 7072 6f63 6573 7365 645f 696e 7075  e(processed_inpu
+00021640: 7473 297d 2e20 4d61 6b65 2073 7572 6520  ts)}. Make sure 
+00021650: 7072 6f76 6964 6564 2060 6675 6e63 7469  provided `functi
+00021660: 6f6e 6020 7265 7475 726e 7320 6120 7661  on` returns a va
+00021670: 7269 6162 6c65 206f 6620 7479 7065 2060  riable of type `
+00021680: 6469 6374 6020 286f 7220 6120 7079 6172  dict` (or a pyar
+00021690: 726f 7720 7461 626c 6529 2074 6f20 7570  row table) to up
+000216a0: 6461 7465 2074 6865 2064 6174 6173 6574  date the dataset
+000216b0: 206f 7220 604e 6f6e 6560 2069 6620 796f   or `None` if yo
+000216c0: 7520 6172 6520 6f6e 6c79 2069 6e74 6572  u are only inter
+000216d0: 6573 7465 6420 696e 2073 6964 6520 6566  ested in side ef
+000216e0: 6665 6374 732e 220a 2020 2020 2020 2020  fects.".        
+000216f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00021700: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+00021710: 7461 6e63 6528 696e 6469 6365 732c 206c  tance(indices, l
+00021720: 6973 7429 2061 6e64 2069 7369 6e73 7461  ist) and isinsta
+00021730: 6e63 6528 7072 6f63 6573 7365 645f 696e  nce(processed_in
+00021740: 7075 7473 2c20 4d61 7070 696e 6729 3a0a  puts, Mapping):.
+00021750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021760: 616c 6c6f 7765 645f 6261 7463 685f 7265  allowed_batch_re
+00021770: 7475 726e 5f74 7970 6573 203d 2028 6c69  turn_types = (li
+00021780: 7374 2c20 6e70 2e6e 6461 7272 6179 2c20  st, np.ndarray, 
+00021790: 7064 2e53 6572 6965 7329 0a20 2020 2020  pd.Series).     
+000217a0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+000217b0: 6e66 6967 2e54 465f 4156 4149 4c41 424c  nfig.TF_AVAILABL
+000217c0: 4520 616e 6420 2274 656e 736f 7266 6c6f  E and "tensorflo
+000217d0: 7722 2069 6e20 7379 732e 6d6f 6475 6c65  w" in sys.module
+000217e0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000217f0: 2020 2020 2020 2069 6d70 6f72 7420 7465         import te
+00021800: 6e73 6f72 666c 6f77 2061 7320 7466 0a0a  nsorflow as tf..
+00021810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021820: 2020 2020 616c 6c6f 7765 645f 6261 7463      allowed_batc
+00021830: 685f 7265 7475 726e 5f74 7970 6573 202b  h_return_types +
+00021840: 3d20 2874 662e 5465 6e73 6f72 2c29 0a20  = (tf.Tensor,). 
+00021850: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00021860: 6620 636f 6e66 6967 2e54 4f52 4348 5f41  f config.TORCH_A
+00021870: 5641 494c 4142 4c45 2061 6e64 2022 746f  VAILABLE and "to
+00021880: 7263 6822 2069 6e20 7379 732e 6d6f 6475  rch" in sys.modu
+00021890: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+000218a0: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
+000218b0: 746f 7263 680a 0a20 2020 2020 2020 2020  torch..         
+000218c0: 2020 2020 2020 2020 2020 2061 6c6c 6f77             allow
+000218d0: 6564 5f62 6174 6368 5f72 6574 7572 6e5f  ed_batch_return_
+000218e0: 7479 7065 7320 2b3d 2028 746f 7263 682e  types += (torch.
+000218f0: 5465 6e73 6f72 2c29 0a20 2020 2020 2020  Tensor,).       
+00021900: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
+00021910: 6967 2e4a 4158 5f41 5641 494c 4142 4c45  ig.JAX_AVAILABLE
+00021920: 2061 6e64 2022 6a61 7822 2069 6e20 7379   and "jax" in sy
+00021930: 732e 6d6f 6475 6c65 733a 0a20 2020 2020  s.modules:.     
+00021940: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00021950: 6d70 6f72 7420 6a61 782e 6e75 6d70 7920  mport jax.numpy 
+00021960: 6173 206a 6e70 0a0a 2020 2020 2020 2020  as jnp..        
+00021970: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
+00021980: 7765 645f 6261 7463 685f 7265 7475 726e  wed_batch_return
+00021990: 5f74 7970 6573 202b 3d20 286a 6e70 2e6e  _types += (jnp.n
+000219a0: 6461 7272 6179 2c29 0a20 2020 2020 2020  darray,).       
+000219b0: 2020 2020 2020 2020 2061 6c6c 5f64 6963           all_dic
+000219c0: 745f 7661 6c75 6573 5f61 7265 5f6c 6973  t_values_are_lis
+000219d0: 7473 203d 2061 6c6c 280a 2020 2020 2020  ts = all(.      
+000219e0: 2020 2020 2020 2020 2020 2020 2020 6973                is
+000219f0: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
+00021a00: 616c 6c6f 7765 645f 6261 7463 685f 7265  allowed_batch_re
+00021a10: 7475 726e 5f74 7970 6573 2920 666f 7220  turn_types) for 
+00021a20: 7661 6c75 6520 696e 2070 726f 6365 7373  value in process
+00021a30: 6564 5f69 6e70 7574 732e 7661 6c75 6573  ed_inputs.values
+00021a40: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00021a50: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00021a60: 2020 2020 2069 6620 616c 6c5f 6469 6374       if all_dict
+00021a70: 5f76 616c 7565 735f 6172 655f 6c69 7374  _values_are_list
+00021a80: 7320 6973 2046 616c 7365 3a0a 2020 2020  s is False:.    
+00021a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021aa0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+00021ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021ac0: 2020 2020 2020 2020 2066 2250 726f 7669           f"Provi
+00021ad0: 6465 6420 6066 756e 6374 696f 6e60 2077  ded `function` w
+00021ae0: 6869 6368 2069 7320 6170 706c 6965 6420  hich is applied 
+00021af0: 746f 2061 6c6c 2065 6c65 6d65 6e74 7320  to all elements 
+00021b00: 6f66 2074 6162 6c65 2072 6574 7572 6e73  of table returns
+00021b10: 2061 2060 6469 6374 6020 6f66 2074 7970   a `dict` of typ
+00021b20: 6573 207b 5b74 7970 6528 7829 2066 6f72  es {[type(x) for
+00021b30: 2078 2069 6e20 7072 6f63 6573 7365 645f   x in processed_
+00021b40: 696e 7075 7473 2e76 616c 7565 7328 295d  inputs.values()]
+00021b50: 7d2e 2057 6865 6e20 7573 696e 6720 6062  }. When using `b
+00021b60: 6174 6368 6564 3d54 7275 6560 2c20 6d61  atched=True`, ma
+00021b70: 6b65 2073 7572 6520 7072 6f76 6964 6564  ke sure provided
+00021b80: 2060 6675 6e63 7469 6f6e 6020 7265 7475   `function` retu
+00021b90: 726e 7320 6120 6064 6963 7460 206f 6620  rns a `dict` of 
+00021ba0: 7479 7065 7320 6c69 6b65 2060 7b61 6c6c  types like `{all
+00021bb0: 6f77 6564 5f62 6174 6368 5f72 6574 7572  owed_batch_retur
+00021bc0: 6e5f 7479 7065 737d 602e 220a 2020 2020  n_types}`.".    
+00021bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021be0: 290a 0a20 2020 2020 2020 2064 6566 2061  )..        def a
+00021bf0: 7070 6c79 5f66 756e 6374 696f 6e5f 6f6e  pply_function_on
+00021c00: 5f66 696c 7465 7265 645f 696e 7075 7473  _filtered_inputs
+00021c10: 2870 615f 696e 7075 7473 2c20 696e 6469  (pa_inputs, indi
+00021c20: 6365 732c 2063 6865 636b 5f73 616d 655f  ces, check_same_
+00021c30: 6e75 6d5f 6578 616d 706c 6573 3d46 616c  num_examples=Fal
+00021c40: 7365 2c20 6f66 6673 6574 3d30 293a 0a20  se, offset=0):. 
+00021c50: 2020 2020 2020 2020 2020 2022 2222 5574             """Ut
+00021c60: 696c 6974 7920 746f 2061 7070 6c79 2074  ility to apply t
+00021c70: 6865 2066 756e 6374 696f 6e20 6f6e 2061  he function on a
+00021c80: 2073 656c 6563 7469 6f6e 206f 6620 636f   selection of co
+00021c90: 6c75 6d6e 732e 2222 220a 2020 2020 2020  lumns.""".      
+00021ca0: 2020 2020 2020 6e6f 6e6c 6f63 616c 2075        nonlocal u
+00021cb0: 7064 6174 655f 6461 7461 0a20 2020 2020  pdate_data.     
+00021cc0: 2020 2020 2020 2069 6e70 7574 7320 3d20         inputs = 
+00021cd0: 666f 726d 6174 5f74 6162 6c65 280a 2020  format_table(.  
+00021ce0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00021cf0: 5f69 6e70 7574 732c 0a20 2020 2020 2020  _inputs,.       
+00021d00: 2020 2020 2020 2020 2030 2069 6620 6e6f           0 if no
+00021d10: 7420 6261 7463 6865 6420 656c 7365 2072  t batched else r
+00021d20: 616e 6765 2870 615f 696e 7075 7473 2e6e  ange(pa_inputs.n
+00021d30: 756d 5f72 6f77 7329 2c0a 2020 2020 2020  um_rows),.      
+00021d40: 2020 2020 2020 2020 2020 666f 726d 6174            format
+00021d50: 5f63 6f6c 756d 6e73 3d69 6e70 7574 5f63  _columns=input_c
+00021d60: 6f6c 756d 6e73 2c0a 2020 2020 2020 2020  olumns,.        
+00021d70: 2020 2020 2020 2020 666f 726d 6174 7465          formatte
+00021d80: 723d 696e 7075 745f 666f 726d 6174 7465  r=input_formatte
+00021d90: 722c 0a20 2020 2020 2020 2020 2020 2029  r,.            )
+00021da0: 0a20 2020 2020 2020 2020 2020 2066 6e5f  .            fn_
+00021db0: 6172 6773 203d 205b 696e 7075 7473 5d20  args = [inputs] 
+00021dc0: 6966 2069 6e70 7574 5f63 6f6c 756d 6e73  if input_columns
+00021dd0: 2069 7320 4e6f 6e65 2065 6c73 6520 5b69   is None else [i
+00021de0: 6e70 7574 735b 636f 6c5d 2066 6f72 2063  nputs[col] for c
+00021df0: 6f6c 2069 6e20 696e 7075 745f 636f 6c75  ol in input_colu
+00021e00: 6d6e 735d 0a20 2020 2020 2020 2020 2020  mns].           
+00021e10: 2069 6620 6f66 6673 6574 203d 3d20 303a   if offset == 0:
+00021e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021e30: 2065 6666 6563 7469 7665 5f69 6e64 6963   effective_indic
+00021e40: 6573 203d 2069 6e64 6963 6573 0a20 2020  es = indices.   
+00021e50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00021e60: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00021e70: 6666 6563 7469 7665 5f69 6e64 6963 6573  ffective_indices
+00021e80: 203d 205b 6920 2b20 6f66 6673 6574 2066   = [i + offset f
+00021e90: 6f72 2069 2069 6e20 696e 6469 6365 735d  or i in indices]
+00021ea0: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
+00021eb0: 6e64 6963 6573 2c20 6c69 7374 2920 656c  ndices, list) el
+00021ec0: 7365 2069 6e64 6963 6573 202b 206f 6666  se indices + off
+00021ed0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
+00021ee0: 6164 6469 7469 6f6e 616c 5f61 7267 7320  additional_args 
+00021ef0: 3d20 2829 0a20 2020 2020 2020 2020 2020  = ().           
+00021f00: 2069 6620 7769 7468 5f69 6e64 6963 6573   if with_indices
+00021f10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00021f20: 2020 6164 6469 7469 6f6e 616c 5f61 7267    additional_arg
+00021f30: 7320 2b3d 2028 6566 6665 6374 6976 655f  s += (effective_
+00021f40: 696e 6469 6365 732c 290a 2020 2020 2020  indices,).      
+00021f50: 2020 2020 2020 6966 2077 6974 685f 7261        if with_ra
+00021f60: 6e6b 3a0a 2020 2020 2020 2020 2020 2020  nk:.            
+00021f70: 2020 2020 6164 6469 7469 6f6e 616c 5f61      additional_a
+00021f80: 7267 7320 2b3d 2028 7261 6e6b 2c29 0a20  rgs += (rank,). 
+00021f90: 2020 2020 2020 2020 2020 2070 726f 6365             proce
+00021fa0: 7373 6564 5f69 6e70 7574 7320 3d20 6675  ssed_inputs = fu
+00021fb0: 6e63 7469 6f6e 282a 666e 5f61 7267 732c  nction(*fn_args,
+00021fc0: 202a 6164 6469 7469 6f6e 616c 5f61 7267   *additional_arg
+00021fd0: 732c 202a 2a66 6e5f 6b77 6172 6773 290a  s, **fn_kwargs).
+00021fe0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00021ff0: 7369 6e73 7461 6e63 6528 7072 6f63 6573  sinstance(proces
+00022000: 7365 645f 696e 7075 7473 2c20 4c61 7a79  sed_inputs, Lazy
+00022010: 4469 6374 293a 0a20 2020 2020 2020 2020  Dict):.         
+00022020: 2020 2020 2020 2070 726f 6365 7373 6564         processed
+00022030: 5f69 6e70 7574 7320 3d20 7b0a 2020 2020  _inputs = {.    
+00022040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022050: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
+00022060: 2070 726f 6365 7373 6564 5f69 6e70 7574   processed_input
+00022070: 732e 6461 7461 2e69 7465 6d73 2829 2069  s.data.items() i
+00022080: 6620 6b20 6e6f 7420 696e 2070 726f 6365  f k not in proce
+00022090: 7373 6564 5f69 6e70 7574 732e 6b65 7973  ssed_inputs.keys
+000220a0: 5f74 6f5f 666f 726d 6174 0a20 2020 2020  _to_format.     
+000220b0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+000220c0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000220d0: 7572 6e65 645f 6c61 7a79 5f64 6963 7420  urned_lazy_dict 
+000220e0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+000220f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00022100: 2020 2020 2020 2020 2072 6574 7572 6e65           returne
+00022110: 645f 6c61 7a79 5f64 6963 7420 3d20 4661  d_lazy_dict = Fa
+00022120: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00022130: 6966 2075 7064 6174 655f 6461 7461 2069  if update_data i
+00022140: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00022150: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+00022160: 6966 2074 6865 2066 756e 6374 696f 6e20  if the function 
+00022170: 7265 7475 726e 7320 7570 6461 7465 6420  returns updated 
+00022180: 6578 616d 706c 6573 0a20 2020 2020 2020  examples.       
+00022190: 2020 2020 2020 2020 2075 7064 6174 655f           update_
+000221a0: 6461 7461 203d 2069 7369 6e73 7461 6e63  data = isinstanc
+000221b0: 6528 7072 6f63 6573 7365 645f 696e 7075  e(processed_inpu
+000221c0: 7473 2c20 284d 6170 7069 6e67 2c20 7061  ts, (Mapping, pa
+000221d0: 2e54 6162 6c65 2929 0a20 2020 2020 2020  .Table)).       
+000221e0: 2020 2020 2020 2020 2076 616c 6964 6174           validat
+000221f0: 655f 6675 6e63 7469 6f6e 5f6f 7574 7075  e_function_outpu
+00022200: 7428 7072 6f63 6573 7365 645f 696e 7075  t(processed_inpu
+00022210: 7473 2c20 696e 6469 6365 7329 0a20 2020  ts, indices).   
+00022220: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00022230: 7570 6461 7465 5f64 6174 613a 0a20 2020  update_data:.   
+00022240: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00022250: 7572 6e20 4e6f 6e65 2020 2320 4e6f 7468  urn None  # Noth
+00022260: 696e 6720 746f 2075 7064 6174 652c 206c  ing to update, l
+00022270: 6574 2773 206d 6f76 6520 6f6e 0a20 2020  et's move on.   
+00022280: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00022290: 2e5f 666f 726d 6174 5f74 7970 6520 6f72  ._format_type or
+000222a0: 2069 6e70 7574 5f63 6f6c 756d 6e73 3a0a   input_columns:.
+000222b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000222c0: 2320 544f 444f 2851 4c2c 204d 5329 3a20  # TODO(QL, MS): 
+000222d0: 6964 6561 6c6c 7920 7468 6520 6265 6861  ideally the beha
+000222e0: 7669 6f72 2073 686f 756c 6420 6265 2074  vior should be t
+000222f0: 6865 2073 616d 6520 6576 656e 2069 6620  he same even if 
+00022300: 7468 6520 6461 7461 7365 7420 6973 2066  the dataset is f
+00022310: 6f72 6d61 7474 6564 2028 6d61 7920 7265  ormatted (may re
+00022320: 7175 6972 6520 6d61 6a6f 7220 7265 6c65  quire major rele
+00022330: 6173 6529 0a20 2020 2020 2020 2020 2020  ase).           
+00022340: 2020 2020 2069 6e70 7574 735f 746f 5f6d       inputs_to_m
+00022350: 6572 6765 203d 207b 6b3a 2076 2066 6f72  erge = {k: v for
+00022360: 206b 2c20 7620 696e 207a 6970 2870 615f   k, v in zip(pa_
+00022370: 696e 7075 7473 2e63 6f6c 756d 6e5f 6e61  inputs.column_na
+00022380: 6d65 732c 2070 615f 696e 7075 7473 2e69  mes, pa_inputs.i
+00022390: 7465 7263 6f6c 756d 6e73 2829 297d 0a20  tercolumns())}. 
+000223a0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000223b0: 6973 696e 7374 616e 6365 2869 6e70 7574  isinstance(input
+000223c0: 732c 204c 617a 7944 6963 7429 3a0a 2020  s, LazyDict):.  
+000223d0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+000223e0: 7075 7473 5f74 6f5f 6d65 7267 6520 3d20  puts_to_merge = 
+000223f0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00022400: 2020 2020 2020 6b3a 2028 7620 6966 206b        k: (v if k
+00022410: 206e 6f74 2069 6e20 696e 7075 7473 2e6b   not in inputs.k
+00022420: 6579 735f 746f 5f66 6f72 6d61 7420 656c  eys_to_format el
+00022430: 7365 2070 615f 696e 7075 7473 5b6b 5d29  se pa_inputs[k])
+00022440: 2066 6f72 206b 2c20 7620 696e 2069 6e70   for k, v in inp
+00022450: 7574 732e 6461 7461 2e69 7465 6d73 2829  uts.data.items()
+00022460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022470: 207d 0a20 2020 2020 2020 2020 2020 2065   }.            e
+00022480: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00022490: 2020 2020 2069 6e70 7574 735f 746f 5f6d       inputs_to_m
+000224a0: 6572 6765 203d 2069 6e70 7574 730a 2020  erge = inputs.  
+000224b0: 2020 2020 2020 2020 2020 6966 2072 656d            if rem
+000224c0: 6f76 655f 636f 6c75 6d6e 7320 6973 206e  ove_columns is n
+000224d0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000224e0: 2020 2020 2020 2020 2066 6f72 2063 6f6c           for col
+000224f0: 756d 6e20 696e 2072 656d 6f76 655f 636f  umn in remove_co
+00022500: 6c75 6d6e 733a 0a20 2020 2020 2020 2020  lumns:.         
+00022510: 2020 2020 2020 2020 2020 2023 2060 6675             # `fu
+00022520: 6e63 7469 6f6e 6020 6361 6e20 6d6f 6469  nction` can modi
+00022530: 6679 2069 6e70 7574 2069 6e2d 706c 6163  fy input in-plac
+00022540: 6520 6361 7573 696e 6720 636f 6c75 6d6e  e causing column
+00022550: 2074 6f20 6265 2061 6c72 6561 6479 2072   to be already r
+00022560: 656d 6f76 6564 2e0a 2020 2020 2020 2020  emoved..        
+00022570: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00022580: 6f6c 756d 6e20 696e 2069 6e70 7574 735f  olumn in inputs_
+00022590: 746f 5f6d 6572 6765 3a0a 2020 2020 2020  to_merge:.      
+000225a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000225b0: 2020 696e 7075 7473 5f74 6f5f 6d65 7267    inputs_to_merg
+000225c0: 652e 706f 7028 636f 6c75 6d6e 290a 2020  e.pop(column).  
+000225d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000225e0: 2020 6966 2072 6574 7572 6e65 645f 6c61    if returned_la
+000225f0: 7a79 5f64 6963 7420 616e 6420 636f 6c75  zy_dict and colu
+00022600: 6d6e 2069 6e20 7072 6f63 6573 7365 645f  mn in processed_
+00022610: 696e 7075 7473 3a0a 2020 2020 2020 2020  inputs:.        
+00022620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022630: 7072 6f63 6573 7365 645f 696e 7075 7473  processed_inputs
+00022640: 2e70 6f70 2863 6f6c 756d 6e29 0a20 2020  .pop(column).   
+00022650: 2020 2020 2020 2020 2069 6620 6368 6563           if chec
+00022660: 6b5f 7361 6d65 5f6e 756d 5f65 7861 6d70  k_same_num_examp
+00022670: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00022680: 2020 2020 2069 6e70 7574 5f6e 756d 5f65       input_num_e
+00022690: 7861 6d70 6c65 7320 3d20 6c65 6e28 7061  xamples = len(pa
+000226a0: 5f69 6e70 7574 7329 0a20 2020 2020 2020  _inputs).       
+000226b0: 2020 2020 2020 2020 2070 726f 6365 7373           process
+000226c0: 6564 5f69 6e70 7574 735f 6e75 6d5f 6578  ed_inputs_num_ex
+000226d0: 616d 706c 6573 203d 206c 656e 2870 726f  amples = len(pro
+000226e0: 6365 7373 6564 5f69 6e70 7574 735b 6e65  cessed_inputs[ne
+000226f0: 7874 2869 7465 7228 7072 6f63 6573 7365  xt(iter(processe
+00022700: 645f 696e 7075 7473 2e6b 6579 7328 2929  d_inputs.keys())
+00022710: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
+00022720: 2020 2020 6966 2069 6e70 7574 5f6e 756d      if input_num
+00022730: 5f65 7861 6d70 6c65 7320 213d 2070 726f  _examples != pro
+00022740: 6365 7373 6564 5f69 6e70 7574 735f 6e75  cessed_inputs_nu
+00022750: 6d5f 6578 616d 706c 6573 3a0a 2020 2020  m_examples:.    
+00022760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022770: 7261 6973 6520 4e75 6d45 7861 6d70 6c65  raise NumExample
+00022780: 734d 6973 6d61 7463 6845 7272 6f72 2829  sMismatchError()
+00022790: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000227a0: 6973 696e 7374 616e 6365 2869 6e70 7574  isinstance(input
+000227b0: 732c 204d 6170 7069 6e67 2920 616e 6420  s, Mapping) and 
+000227c0: 6973 696e 7374 616e 6365 2870 726f 6365  isinstance(proce
+000227d0: 7373 6564 5f69 6e70 7574 732c 204d 6170  ssed_inputs, Map
+000227e0: 7069 6e67 293a 0a20 2020 2020 2020 2020  ping):.         
+000227f0: 2020 2020 2020 2023 2054 6865 202e 6d61         # The .ma
+00022800: 7028 2920 7472 616e 7366 6f72 6d20 2a75  p() transform *u
+00022810: 7064 6174 6573 2a20 7468 6520 6461 7461  pdates* the data
+00022820: 7365 743a 0a20 2020 2020 2020 2020 2020  set:.           
+00022830: 2020 2020 2023 2074 6865 206f 7574 7075       # the outpu
+00022840: 7420 6469 6374 696f 6e61 7279 2063 6f6e  t dictionary con
+00022850: 7461 696e 7320 626f 7468 2074 6865 2074  tains both the t
+00022860: 6865 2069 6e70 7574 2064 6174 6120 616e  he input data an
+00022870: 6420 7468 6520 6f75 7470 7574 2064 6174  d the output dat
+00022880: 612e 0a20 2020 2020 2020 2020 2020 2020  a..             
+00022890: 2020 2023 2054 6865 206f 7574 7075 7420     # The output 
+000228a0: 6469 6374 696f 6e61 7279 206d 6179 2063  dictionary may c
+000228b0: 6f6e 7461 696e 2041 7272 6f77 2076 616c  ontain Arrow val
+000228c0: 7565 7320 6672 6f6d 2060 696e 7075 7473  ues from `inputs
+000228d0: 5f74 6f5f 6d65 7267 6560 2073 6f20 7468  _to_merge` so th
+000228e0: 6174 2077 6520 6361 6e20 7265 2d77 7269  at we can re-wri
+000228f0: 7465 2074 6865 6d20 6566 6669 6369 656e  te them efficien
+00022900: 746c 792e 0a20 2020 2020 2020 2020 2020  tly..           
+00022910: 2020 2020 2072 6574 7572 6e20 7b2a 2a69       return {**i
+00022920: 6e70 7574 735f 746f 5f6d 6572 6765 2c20  nputs_to_merge, 
+00022930: 2a2a 7072 6f63 6573 7365 645f 696e 7075  **processed_inpu
+00022940: 7473 7d0a 2020 2020 2020 2020 2020 2020  ts}.            
+00022950: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00022960: 2020 2020 2020 7265 7475 726e 2070 726f        return pro
+00022970: 6365 7373 6564 5f69 6e70 7574 730a 0a20  cessed_inputs.. 
+00022980: 2020 2020 2020 2064 6566 2069 6e69 745f         def init_
+00022990: 6275 6666 6572 5f61 6e64 5f77 7269 7465  buffer_and_write
+000229a0: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
+000229b0: 2023 2050 7265 7061 7265 206f 7574 7075   # Prepare outpu
+000229c0: 7420 6275 6666 6572 2061 6e64 2062 6174  t buffer and bat
+000229d0: 6368 6564 2077 7269 7465 7220 696e 206d  ched writer in m
+000229e0: 656d 6f72 7920 6f72 206f 6e20 6669 6c65  emory or on file
+000229f0: 2069 6620 7765 2075 7064 6174 6520 7468   if we update th
+00022a00: 6520 7461 626c 650a 2020 2020 2020 2020  e table.        
+00022a10: 2020 2020 7772 6974 6572 5f66 6561 7475      writer_featu
+00022a20: 7265 7320 3d20 6665 6174 7572 6573 0a20  res = features. 
+00022a30: 2020 2020 2020 2020 2020 2069 6620 7772             if wr
+00022a40: 6974 6572 5f66 6561 7475 7265 7320 6973  iter_features is
+00022a50: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00022a60: 2020 2020 2020 2077 7269 7465 725f 6665         writer_fe
+00022a70: 6174 7572 6573 203d 2073 656c 662e 6665  atures = self.fe
+00022a80: 6174 7572 6573 0a20 2020 2020 2020 2020  atures.         
+00022a90: 2020 2020 2020 2075 7064 6174 655f 6665         update_fe
+00022aa0: 6174 7572 6573 203d 2054 7275 650a 2020  atures = True.  
+00022ab0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00022ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ad0: 7570 6461 7465 5f66 6561 7475 7265 7320  update_features 
+00022ae0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00022af0: 2020 2020 6966 206b 6565 705f 696e 5f6d      if keep_in_m
+00022b00: 656d 6f72 7920 6f72 2063 6163 6865 5f66  emory or cache_f
+00022b10: 696c 655f 6e61 6d65 2069 7320 4e6f 6e65  ile_name is None
+00022b20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00022b30: 2020 6275 665f 7772 6974 6572 203d 2070    buf_writer = p
+00022b40: 612e 4275 6666 6572 4f75 7470 7574 5374  a.BufferOutputSt
+00022b50: 7265 616d 2829 0a20 2020 2020 2020 2020  ream().         
+00022b60: 2020 2020 2020 2074 6d70 5f66 696c 6520         tmp_file 
+00022b70: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+00022b80: 2020 2020 2020 2077 7269 7465 7220 3d20         writer = 
+00022b90: 4172 726f 7757 7269 7465 7228 0a20 2020  ArrowWriter(.   
+00022ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bb0: 2066 6561 7475 7265 733d 7772 6974 6572   features=writer
+00022bc0: 5f66 6561 7475 7265 732c 0a20 2020 2020  _features,.     
+00022bd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00022be0: 7472 6561 6d3d 6275 665f 7772 6974 6572  tream=buf_writer
+00022bf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00022c00: 2020 2020 2020 7772 6974 6572 5f62 6174        writer_bat
+00022c10: 6368 5f73 697a 653d 7772 6974 6572 5f62  ch_size=writer_b
+00022c20: 6174 6368 5f73 697a 652c 0a20 2020 2020  atch_size,.     
+00022c30: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00022c40: 7064 6174 655f 6665 6174 7572 6573 3d75  pdate_features=u
+00022c50: 7064 6174 655f 6665 6174 7572 6573 2c0a  pdate_features,.
+00022c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022c70: 2020 2020 6669 6e67 6572 7072 696e 743d      fingerprint=
+00022c80: 6e65 775f 6669 6e67 6572 7072 696e 742c  new_fingerprint,
+00022c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022ca0: 2020 2020 2064 6973 6162 6c65 5f6e 756c       disable_nul
+00022cb0: 6c61 626c 653d 6469 7361 626c 655f 6e75  lable=disable_nu
+00022cc0: 6c6c 6162 6c65 2c0a 2020 2020 2020 2020  llable,.        
+00022cd0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00022ce0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00022cf0: 2020 2020 2020 2020 2020 2020 6275 665f              buf_
+00022d00: 7772 6974 6572 203d 204e 6f6e 650a 2020  writer = None.  
+00022d10: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00022d20: 6767 6572 2e69 6e66 6f28 6622 4361 6368  gger.info(f"Cach
+00022d30: 696e 6720 7072 6f63 6573 7365 6420 6461  ing processed da
+00022d40: 7461 7365 7420 6174 207b 6361 6368 655f  taset at {cache_
+00022d50: 6669 6c65 5f6e 616d 657d 2229 0a20 2020  file_name}").   
+00022d60: 2020 2020 2020 2020 2020 2020 2074 6d70               tmp
+00022d70: 5f66 696c 6520 3d20 7465 6d70 6669 6c65  _file = tempfile
+00022d80: 2e4e 616d 6564 5465 6d70 6f72 6172 7946  .NamedTemporaryF
+00022d90: 696c 6528 2277 6222 2c20 6469 723d 6f73  ile("wb", dir=os
+00022da0: 2e70 6174 682e 6469 726e 616d 6528 6361  .path.dirname(ca
+00022db0: 6368 655f 6669 6c65 5f6e 616d 6529 2c20  che_file_name), 
+00022dc0: 6465 6c65 7465 3d46 616c 7365 290a 2020  delete=False).  
+00022dd0: 2020 2020 2020 2020 2020 2020 2020 7772                wr
+00022de0: 6974 6572 203d 2041 7272 6f77 5772 6974  iter = ArrowWrit
+00022df0: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
+00022e00: 2020 2020 2020 2020 6665 6174 7572 6573          features
+00022e10: 3d77 7269 7465 725f 6665 6174 7572 6573  =writer_features
+00022e20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00022e30: 2020 2020 2020 7061 7468 3d74 6d70 5f66        path=tmp_f
+00022e40: 696c 652e 6e61 6d65 2c0a 2020 2020 2020  ile.name,.      
+00022e50: 2020 2020 2020 2020 2020 2020 2020 7772                wr
+00022e60: 6974 6572 5f62 6174 6368 5f73 697a 653d  iter_batch_size=
+00022e70: 7772 6974 6572 5f62 6174 6368 5f73 697a  writer_batch_siz
+00022e80: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00022e90: 2020 2020 2020 2075 7064 6174 655f 6665         update_fe
+00022ea0: 6174 7572 6573 3d75 7064 6174 655f 6665  atures=update_fe
+00022eb0: 6174 7572 6573 2c0a 2020 2020 2020 2020  atures,.        
+00022ec0: 2020 2020 2020 2020 2020 2020 6669 6e67              fing
+00022ed0: 6572 7072 696e 743d 6e65 775f 6669 6e67  erprint=new_fing
+00022ee0: 6572 7072 696e 742c 0a20 2020 2020 2020  erprint,.       
+00022ef0: 2020 2020 2020 2020 2020 2020 2064 6973               dis
+00022f00: 6162 6c65 5f6e 756c 6c61 626c 653d 6469  able_nullable=di
+00022f10: 7361 626c 655f 6e75 6c6c 6162 6c65 2c0a  sable_nullable,.
+00022f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022f30: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00022f40: 7475 726e 2062 7566 5f77 7269 7465 722c  turn buf_writer,
+00022f50: 2077 7269 7465 722c 2074 6d70 5f66 696c   writer, tmp_fil
+00022f60: 650a 0a20 2020 2020 2020 2023 2049 6620  e..        # If 
+00022f70: 6075 7064 6174 655f 6461 7461 6020 6973  `update_data` is
+00022f80: 2054 7275 6520 6166 7465 7220 7072 6f63   True after proc
+00022f90: 6573 7369 6e67 2074 6865 2066 6972 7374  essing the first
+00022fa0: 2065 7861 6d70 6c65 2f62 6174 6368 2c20   example/batch, 
+00022fb0: 696e 6974 616c 697a 6520 7468 6573 6520  initalize these 
+00022fc0: 7265 736f 7572 6365 7320 7769 7468 2060  resources with `
+00022fd0: 696e 6974 5f62 7566 6665 725f 616e 645f  init_buffer_and_
+00022fe0: 7772 6974 6572 600a 2020 2020 2020 2020  writer`.        
+00022ff0: 6275 665f 7772 6974 6572 2c20 7772 6974  buf_writer, writ
+00023000: 6572 2c20 746d 705f 6669 6c65 203d 204e  er, tmp_file = N
+00023010: 6f6e 652c 204e 6f6e 652c 204e 6f6e 650a  one, None, None.
+00023020: 0a20 2020 2020 2020 2023 204f 7074 696f  .        # Optio
+00023030: 6e61 6c6c 7920 696e 6974 6961 6c69 7a65  nally initialize
+00023040: 2074 6865 2077 7269 7465 7220 6173 2061   the writer as a
+00023050: 2063 6f6e 7465 7874 206d 616e 6167 6572   context manager
+00023060: 0a20 2020 2020 2020 2077 6974 6820 636f  .        with co
+00023070: 6e74 6578 746c 6962 2e45 7869 7453 7461  ntextlib.ExitSta
+00023080: 636b 2829 2061 7320 7374 6163 6b3a 0a20  ck() as stack:. 
+00023090: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+000230a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230b0: 696e 7075 745f 6461 7461 7365 7420 3d20  input_dataset = 
+000230c0: 7365 6c66 2e77 6974 685f 666f 726d 6174  self.with_format
+000230d0: 2822 6172 726f 7722 290a 0a20 2020 2020  ("arrow")..     
+000230e0: 2020 2020 2020 2020 2020 2023 204c 6f6f             # Loo
+000230f0: 7020 6f76 6572 2073 696e 676c 6520 6578  p over single ex
+00023100: 616d 706c 6573 206f 7220 6261 7463 6865  amples or batche
+00023110: 7320 616e 6420 7772 6974 6520 746f 2062  s and write to b
+00023120: 7566 6665 722f 6669 6c65 2069 6620 6578  uffer/file if ex
+00023130: 616d 706c 6573 2061 7265 2074 6f20 6265  amples are to be
+00023140: 2075 7064 6174 6564 0a20 2020 2020 2020   updated.       
+00023150: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00023160: 6261 7463 6865 643a 0a20 2020 2020 2020  batched:.       
+00023170: 2020 2020 2020 2020 2020 2020 2070 6261               pba
+00023180: 725f 746f 7461 6c20 3d20 6c65 6e28 696e  r_total = len(in
+00023190: 7075 745f 6461 7461 7365 7429 0a20 2020  put_dataset).   
+000231a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000231b0: 2070 6261 725f 6974 6572 6162 6c65 203d   pbar_iterable =
+000231c0: 2065 6e75 6d65 7261 7465 2869 6e70 7574   enumerate(input
+000231d0: 5f64 6174 6173 6574 290a 2020 2020 2020  _dataset).      
+000231e0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000231f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023200: 2020 2020 6e75 6d5f 726f 7773 203d 2028      num_rows = (
+00023210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023220: 2020 2020 2020 2020 206c 656e 2869 6e70           len(inp
+00023230: 7574 5f64 6174 6173 6574 2920 6966 206e  ut_dataset) if n
+00023240: 6f74 2064 726f 705f 6c61 7374 5f62 6174  ot drop_last_bat
+00023250: 6368 2065 6c73 6520 6c65 6e28 696e 7075  ch else len(inpu
+00023260: 745f 6461 7461 7365 7429 202f 2f20 6261  t_dataset) // ba
+00023270: 7463 685f 7369 7a65 202a 2062 6174 6368  tch_size * batch
+00023280: 5f73 697a 650a 2020 2020 2020 2020 2020  _size.          
+00023290: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000232a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000232b0: 7062 6172 5f74 6f74 616c 203d 2028 6e75  pbar_total = (nu
+000232c0: 6d5f 726f 7773 202f 2f20 6261 7463 685f  m_rows // batch_
+000232d0: 7369 7a65 2920 2b20 3120 6966 206e 756d  size) + 1 if num
+000232e0: 5f72 6f77 7320 2520 6261 7463 685f 7369  _rows % batch_si
+000232f0: 7a65 2065 6c73 6520 6e75 6d5f 726f 7773  ze else num_rows
+00023300: 202f 2f20 6261 7463 685f 7369 7a65 0a20   // batch_size. 
+00023310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023320: 2020 2070 6261 725f 6974 6572 6162 6c65     pbar_iterable
+00023330: 203d 207a 6970 280a 2020 2020 2020 2020   = zip(.        
+00023340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023350: 7261 6e67 6528 302c 206e 756d 5f72 6f77  range(0, num_row
+00023360: 732c 2062 6174 6368 5f73 697a 6529 2c0a  s, batch_size),.
+00023370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023380: 2020 2020 2020 2020 696e 7075 745f 6461          input_da
+00023390: 7461 7365 742e 6974 6572 2862 6174 6368  taset.iter(batch
+000233a0: 5f73 697a 652c 2064 726f 705f 6c61 7374  _size, drop_last
+000233b0: 5f62 6174 6368 3d64 726f 705f 6c61 7374  _batch=drop_last
+000233c0: 5f62 6174 6368 292c 0a20 2020 2020 2020  _batch),.       
+000233d0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+000233e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000233f0: 6261 725f 756e 6974 203d 2022 6578 2220  bar_unit = "ex" 
+00023400: 6966 206e 6f74 2062 6174 6368 6564 2065  if not batched e
+00023410: 6c73 6520 2262 6122 0a20 2020 2020 2020  lse "ba".       
+00023420: 2020 2020 2020 2020 2070 6261 725f 6465           pbar_de
+00023430: 7363 203d 2028 6465 7363 202b 2022 2022  sc = (desc + " "
+00023440: 2069 6620 6465 7363 2069 7320 6e6f 7420   if desc is not 
+00023450: 4e6f 6e65 2065 6c73 6520 2222 2920 2b20  None else "") + 
+00023460: 2223 2220 2b20 7374 7228 7261 6e6b 2920  "#" + str(rank) 
+00023470: 6966 2072 616e 6b20 6973 206e 6f74 204e  if rank is not N
+00023480: 6f6e 6520 656c 7365 2064 6573 630a 2020  one else desc.  
+00023490: 2020 2020 2020 2020 2020 2020 2020 7062                pb
+000234a0: 6172 203d 206c 6f67 6769 6e67 2e74 7164  ar = logging.tqd
+000234b0: 6d28 0a20 2020 2020 2020 2020 2020 2020  m(.             
+000234c0: 2020 2020 2020 2070 6261 725f 6974 6572         pbar_iter
+000234d0: 6162 6c65 2c0a 2020 2020 2020 2020 2020  able,.          
+000234e0: 2020 2020 2020 2020 2020 746f 7461 6c3d            total=
+000234f0: 7062 6172 5f74 6f74 616c 2c0a 2020 2020  pbar_total,.    
+00023500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023510: 6469 7361 626c 653d 6469 7361 626c 655f  disable=disable_
+00023520: 7471 646d 2c0a 2020 2020 2020 2020 2020  tqdm,.          
+00023530: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+00023540: 6f6e 3d72 616e 6b2c 0a20 2020 2020 2020  on=rank,.       
+00023550: 2020 2020 2020 2020 2020 2020 2075 6e69               uni
+00023560: 743d 7062 6172 5f75 6e69 742c 0a20 2020  t=pbar_unit,.   
+00023570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023580: 2064 6573 633d 7062 6172 5f64 6573 632c   desc=pbar_desc,
+00023590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000235a0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+000235b0: 2020 2069 6620 6e6f 7420 6261 7463 6865     if not batche
+000235c0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+000235d0: 2020 2020 2020 2066 6f72 2069 2c20 6578         for i, ex
+000235e0: 616d 706c 6520 696e 2070 6261 723a 0a20  ample in pbar:. 
+000235f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023600: 2020 2020 2020 2065 7861 6d70 6c65 203d         example =
+00023610: 2061 7070 6c79 5f66 756e 6374 696f 6e5f   apply_function_
+00023620: 6f6e 5f66 696c 7465 7265 645f 696e 7075  on_filtered_inpu
+00023630: 7473 2865 7861 6d70 6c65 2c20 692c 206f  ts(example, i, o
+00023640: 6666 7365 743d 6f66 6673 6574 290a 2020  ffset=offset).  
+00023650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023660: 2020 2020 2020 6966 2075 7064 6174 655f        if update_
+00023670: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+00023680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023690: 2020 6966 2069 203d 3d20 303a 0a20 2020    if i == 0:.   
+000236a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000236b0: 2020 2020 2020 2020 2020 2020 2062 7566               buf
+000236c0: 5f77 7269 7465 722c 2077 7269 7465 722c  _writer, writer,
+000236d0: 2074 6d70 5f66 696c 6520 3d20 696e 6974   tmp_file = init
+000236e0: 5f62 7566 6665 725f 616e 645f 7772 6974  _buffer_and_writ
+000236f0: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
+00023700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023710: 2020 2020 2073 7461 636b 2e65 6e74 6572       stack.enter
+00023720: 5f63 6f6e 7465 7874 2877 7269 7465 7229  _context(writer)
+00023730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023740: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00023750: 6973 696e 7374 616e 6365 2865 7861 6d70  isinstance(examp
+00023760: 6c65 2c20 7061 2e54 6162 6c65 293a 0a20  le, pa.Table):. 
+00023770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023780: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00023790: 7269 7465 722e 7772 6974 655f 726f 7728  riter.write_row(
+000237a0: 6578 616d 706c 6529 0a20 2020 2020 2020  example).       
+000237b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000237c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000237d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000237e0: 2020 2020 2020 2020 2020 2077 7269 7465             write
+000237f0: 722e 7772 6974 6528 6578 616d 706c 6529  r.write(example)
+00023800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023810: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00023820: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00023830: 2c20 6261 7463 6820 696e 2070 6261 723a  , batch in pbar:
+00023840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023850: 2020 2020 2020 2020 2069 6e64 6963 6573           indices
+00023860: 203d 206c 6973 7428 0a20 2020 2020 2020   = list(.       
+00023870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023880: 2020 2020 2072 616e 6765 282a 2873 6c69       range(*(sli
+00023890: 6365 2869 2c20 6920 2b20 6261 7463 685f  ce(i, i + batch_
+000238a0: 7369 7a65 292e 696e 6469 6365 7328 696e  size).indices(in
+000238b0: 7075 745f 6461 7461 7365 742e 6e75 6d5f  put_dataset.num_
+000238c0: 726f 7773 2929 290a 2020 2020 2020 2020  rows))).        
+000238d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000238e0: 2920 2023 2053 6f6d 6574 6869 6e67 2073  )  # Something s
+000238f0: 696d 706c 6572 3f0a 2020 2020 2020 2020  impler?.        
+00023900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023910: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
 00023920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023930: 2020 6966 2075 7064 6174 655f 6461 7461    if update_data
-00023940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023950: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00023960: 2069 203d 3d20 303a 0a20 2020 2020 2020   i == 0:.       
-00023970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023980: 2020 2020 2020 2020 2062 7566 5f77 7269           buf_wri
-00023990: 7465 722c 2077 7269 7465 722c 2074 6d70  ter, writer, tmp
-000239a0: 5f66 696c 6520 3d20 696e 6974 5f62 7566  _file = init_buf
-000239b0: 6665 725f 616e 645f 7772 6974 6572 2829  fer_and_writer()
-000239c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000239d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000239e0: 2073 7461 636b 2e65 6e74 6572 5f63 6f6e   stack.enter_con
-000239f0: 7465 7874 2877 7269 7465 7229 0a20 2020  text(writer).   
-00023a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a10: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00023a20: 7374 616e 6365 2865 7861 6d70 6c65 2c20  stance(example, 
-00023a30: 7061 2e54 6162 6c65 293a 0a20 2020 2020  pa.Table):.     
+00023930: 2062 6174 6368 203d 2061 7070 6c79 5f66   batch = apply_f
+00023940: 756e 6374 696f 6e5f 6f6e 5f66 696c 7465  unction_on_filte
+00023950: 7265 645f 696e 7075 7473 280a 2020 2020  red_inputs(.    
+00023960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023970: 2020 2020 2020 2020 2020 2020 6261 7463              batc
+00023980: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
+00023990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239a0: 2020 2069 6e64 6963 6573 2c0a 2020 2020     indices,.    
+000239b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000239c0: 2020 2020 2020 2020 2020 2020 6368 6563              chec
+000239d0: 6b5f 7361 6d65 5f6e 756d 5f65 7861 6d70  k_same_num_examp
+000239e0: 6c65 733d 6c65 6e28 696e 7075 745f 6461  les=len(input_da
+000239f0: 7461 7365 742e 6c69 7374 5f69 6e64 6578  taset.list_index
+00023a00: 6573 2829 2920 3e20 302c 0a20 2020 2020  es()) > 0,.     
+00023a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a20: 2020 2020 2020 2020 2020 206f 6666 7365             offse
+00023a30: 743d 6f66 6673 6574 2c0a 2020 2020 2020  t=offset,.      
 00023a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a50: 2020 2020 2020 2020 2020 2077 7269 7465             write
-00023a60: 722e 7772 6974 655f 726f 7728 6578 616d  r.write_row(exam
-00023a70: 706c 6529 0a20 2020 2020 2020 2020 2020  ple).           
-00023a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00023aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ab0: 2020 2020 2020 2077 7269 7465 722e 7772         writer.wr
-00023ac0: 6974 6528 6578 616d 706c 6529 0a20 2020  ite(example).   
-00023ad0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00023ae0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00023af0: 2020 2020 2020 2066 6f72 2069 2c20 6261         for i, ba
-00023b00: 7463 6820 696e 2070 6261 723a 0a20 2020  tch in pbar:.   
-00023b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b20: 2020 2020 2069 6e64 6963 6573 203d 206c       indices = l
-00023b30: 6973 7428 0a20 2020 2020 2020 2020 2020  ist(.           
-00023b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b50: 2072 616e 6765 282a 2873 6c69 6365 2869   range(*(slice(i
-00023b60: 2c20 6920 2b20 6261 7463 685f 7369 7a65  , i + batch_size
-00023b70: 292e 696e 6469 6365 7328 696e 7075 745f  ).indices(input_
-00023b80: 6461 7461 7365 742e 6e75 6d5f 726f 7773  dataset.num_rows
-00023b90: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
-00023ba0: 2020 2020 2020 2020 2020 2020 2920 2023              )  #
-00023bb0: 2053 6f6d 6574 6869 6e67 2073 696d 706c   Something simpl
-00023bc0: 6572 3f0a 2020 2020 2020 2020 2020 2020  er?.            
-00023bd0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00023be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023bf0: 2020 2020 2020 2020 2020 2020 2062 6174               bat
-00023c00: 6368 203d 2061 7070 6c79 5f66 756e 6374  ch = apply_funct
-00023c10: 696f 6e5f 6f6e 5f66 696c 7465 7265 645f  ion_on_filtered_
-00023c20: 696e 7075 7473 280a 2020 2020 2020 2020  inputs(.        
-00023c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c40: 2020 2020 2020 2020 6261 7463 682c 0a20          batch,. 
-00023c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023c70: 6e64 6963 6573 2c0a 2020 2020 2020 2020  ndices,.        
-00023c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c90: 2020 2020 2020 2020 6368 6563 6b5f 7361          check_sa
-00023ca0: 6d65 5f6e 756d 5f65 7861 6d70 6c65 733d  me_num_examples=
-00023cb0: 6c65 6e28 696e 7075 745f 6461 7461 7365  len(input_datase
-00023cc0: 742e 6c69 7374 5f69 6e64 6578 6573 2829  t.list_indexes()
-00023cd0: 2920 3e20 302c 0a20 2020 2020 2020 2020  ) > 0,.         
-00023ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023cf0: 2020 2020 2020 206f 6666 7365 743d 6f66         offset=of
-00023d00: 6673 6574 2c0a 2020 2020 2020 2020 2020  fset,.          
+00023a50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00023a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a70: 6578 6365 7074 204e 756d 4578 616d 706c  except NumExampl
+00023a80: 6573 4d69 736d 6174 6368 4572 726f 723a  esMismatchError:
+00023a90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023aa0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00023ab0: 7365 2044 6174 6173 6574 5472 616e 7366  se DatasetTransf
+00023ac0: 6f72 6d61 7469 6f6e 4e6f 7441 6c6c 6f77  ormationNotAllow
+00023ad0: 6564 4572 726f 7228 0a20 2020 2020 2020  edError(.       
+00023ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023af0: 2020 2020 2020 2020 2022 5573 696e 6720           "Using 
+00023b00: 602e 6d61 7060 2069 6e20 6261 7463 6865  `.map` in batche
+00023b10: 6420 6d6f 6465 206f 6e20 6120 6461 7461  d mode on a data
+00023b20: 7365 7420 7769 7468 2061 7474 6163 6865  set with attache
+00023b30: 6420 696e 6465 7865 7320 6973 2061 6c6c  d indexes is all
+00023b40: 6f77 6564 206f 6e6c 7920 6966 2069 7420  owed only if it 
+00023b50: 646f 6573 6e27 7420 6372 6561 7465 206f  doesn't create o
+00023b60: 7220 7265 6d6f 7665 2065 7869 7374 696e  r remove existin
+00023b70: 6720 6578 616d 706c 6573 2e20 596f 7520  g examples. You 
+00023b80: 6361 6e20 6669 7273 7420 7275 6e20 602e  can first run `.
+00023b90: 6472 6f70 5f69 6e64 6578 2829 2074 6f20  drop_index() to 
+00023ba0: 7265 6d6f 7665 2079 6f75 7220 696e 6465  remove your inde
+00023bb0: 7820 616e 6420 7468 656e 2072 652d 6164  x and then re-ad
+00023bc0: 6420 6974 2e22 0a20 2020 2020 2020 2020  d it.".         
+00023bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023be0: 2020 2029 2066 726f 6d20 4e6f 6e65 0a20     ) from None. 
+00023bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c00: 2020 2020 2020 2069 6620 7570 6461 7465         if update
+00023c10: 5f64 6174 613a 0a20 2020 2020 2020 2020  _data:.         
+00023c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c30: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
+00023c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c50: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+00023c60: 665f 7772 6974 6572 2c20 7772 6974 6572  f_writer, writer
+00023c70: 2c20 746d 705f 6669 6c65 203d 2069 6e69  , tmp_file = ini
+00023c80: 745f 6275 6666 6572 5f61 6e64 5f77 7269  t_buffer_and_wri
+00023c90: 7465 7228 290a 2020 2020 2020 2020 2020  ter().          
+00023ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cb0: 2020 2020 2020 7374 6163 6b2e 656e 7465        stack.ente
+00023cc0: 725f 636f 6e74 6578 7428 7772 6974 6572  r_context(writer
+00023cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00023ce0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00023cf0: 2069 7369 6e73 7461 6e63 6528 6261 7463   isinstance(batc
+00023d00: 682c 2070 612e 5461 626c 6529 3a0a 2020  h, pa.Table):.  
 00023d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d20: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00023d30: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00023d40: 7074 204e 756d 4578 616d 706c 6573 4d69  pt NumExamplesMi
-00023d50: 736d 6174 6368 4572 726f 723a 0a20 2020  smatchError:.   
-00023d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d70: 2020 2020 2020 2020 2072 6169 7365 2044           raise D
-00023d80: 6174 6173 6574 5472 616e 7366 6f72 6d61  atasetTransforma
-00023d90: 7469 6f6e 4e6f 7441 6c6c 6f77 6564 4572  tionNotAllowedEr
-00023da0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00023db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023dc0: 2020 2020 2022 5573 696e 6720 602e 6d61       "Using `.ma
-00023dd0: 7060 2069 6e20 6261 7463 6865 6420 6d6f  p` in batched mo
-00023de0: 6465 206f 6e20 6120 6461 7461 7365 7420  de on a dataset 
-00023df0: 7769 7468 2061 7474 6163 6865 6420 696e  with attached in
-00023e00: 6465 7865 7320 6973 2061 6c6c 6f77 6564  dexes is allowed
-00023e10: 206f 6e6c 7920 6966 2069 7420 646f 6573   only if it does
-00023e20: 6e27 7420 6372 6561 7465 206f 7220 7265  n't create or re
-00023e30: 6d6f 7665 2065 7869 7374 696e 6720 6578  move existing ex
-00023e40: 616d 706c 6573 2e20 596f 7520 6361 6e20  amples. You can 
-00023e50: 6669 7273 7420 7275 6e20 602e 6472 6f70  first run `.drop
-00023e60: 5f69 6e64 6578 2829 2074 6f20 7265 6d6f  _index() to remo
-00023e70: 7665 2079 6f75 7220 696e 6465 7820 616e  ve your index an
-00023e80: 6420 7468 656e 2072 652d 6164 6420 6974  d then re-add it
-00023e90: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
-00023ea0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00023eb0: 2066 726f 6d20 4e6f 6e65 0a20 2020 2020   from None.     
-00023ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ed0: 2020 2069 6620 7570 6461 7465 5f64 6174     if update_dat
-00023ee0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-00023ef0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023f00: 6620 6920 3d3d 2030 3a0a 2020 2020 2020  f i == 0:.      
-00023f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f20: 2020 2020 2020 2020 2020 6275 665f 7772            buf_wr
-00023f30: 6974 6572 2c20 7772 6974 6572 2c20 746d  iter, writer, tm
-00023f40: 705f 6669 6c65 203d 2069 6e69 745f 6275  p_file = init_bu
-00023f50: 6666 6572 5f61 6e64 5f77 7269 7465 7228  ffer_and_writer(
-00023f60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00023f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f80: 2020 7374 6163 6b2e 656e 7465 725f 636f    stack.enter_co
-00023f90: 6e74 6578 7428 7772 6974 6572 290a 2020  ntext(writer).  
-00023fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023fb0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-00023fc0: 6e73 7461 6e63 6528 6261 7463 682c 2070  nstance(batch, p
-00023fd0: 612e 5461 626c 6529 3a0a 2020 2020 2020  a.Table):.      
-00023fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ff0: 2020 2020 2020 2020 2020 7772 6974 6572            writer
-00024000: 2e77 7269 7465 5f74 6162 6c65 2862 6174  .write_table(bat
-00024010: 6368 290a 2020 2020 2020 2020 2020 2020  ch).            
-00024020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024030: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00024040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024050: 2020 2020 2020 7772 6974 6572 2e77 7269        writer.wri
-00024060: 7465 5f62 6174 6368 2862 6174 6368 290a  te_batch(batch).
-00024070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024080: 6966 2075 7064 6174 655f 6461 7461 2061  if update_data a
-00024090: 6e64 2077 7269 7465 7220 6973 206e 6f74  nd writer is not
-000240a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000240b0: 2020 2020 2020 2020 2020 2077 7269 7465             write
-000240c0: 722e 6669 6e61 6c69 7a65 2829 2020 2320  r.finalize()  # 
-000240d0: 636c 6f73 655f 7374 7265 616d 3d62 6f6f  close_stream=boo
-000240e0: 6c28 6275 665f 7772 6974 6572 2069 7320  l(buf_writer is 
-000240f0: 4e6f 6e65 2929 2020 2320 5765 206f 6e6c  None))  # We onl
-00024100: 7920 636c 6f73 6520 6966 2077 6520 6172  y close if we ar
-00024110: 6520 7772 6974 696e 6720 696e 2061 2066  e writing in a f
-00024120: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
-00024130: 6578 6365 7074 2028 4578 6365 7074 696f  except (Exceptio
-00024140: 6e2c 204b 6579 626f 6172 6449 6e74 6572  n, KeyboardInter
-00024150: 7275 7074 293a 0a20 2020 2020 2020 2020  rupt):.         
-00024160: 2020 2020 2020 2069 6620 7570 6461 7465         if update
-00024170: 5f64 6174 613a 0a20 2020 2020 2020 2020  _data:.         
-00024180: 2020 2020 2020 2020 2020 2069 6620 7772             if wr
-00024190: 6974 6572 2069 7320 6e6f 7420 4e6f 6e65  iter is not None
-000241a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000241b0: 2020 2020 2020 2020 2020 7772 6974 6572            writer
-000241c0: 2e66 696e 616c 697a 6528 290a 2020 2020  .finalize().    
-000241d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000241e0: 6966 2074 6d70 5f66 696c 6520 6973 206e  if tmp_file is n
-000241f0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00024200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024210: 2074 6d70 5f66 696c 652e 636c 6f73 6528   tmp_file.close(
-00024220: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00024230: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
-00024240: 7061 7468 2e65 7869 7374 7328 746d 705f  path.exists(tmp_
-00024250: 6669 6c65 2e6e 616d 6529 3a0a 2020 2020  file.name):.    
-00024260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024270: 2020 2020 2020 2020 6f73 2e72 656d 6f76          os.remov
-00024280: 6528 746d 705f 6669 6c65 2e6e 616d 6529  e(tmp_file.name)
-00024290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000242a0: 2072 6169 7365 0a0a 2020 2020 2020 2020   raise..        
-000242b0: 6966 2075 7064 6174 655f 6461 7461 2061  if update_data a
-000242c0: 6e64 2074 6d70 5f66 696c 6520 6973 206e  nd tmp_file is n
-000242d0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000242e0: 2020 2020 2074 6d70 5f66 696c 652e 636c       tmp_file.cl
-000242f0: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
-00024300: 2020 7368 7574 696c 2e6d 6f76 6528 746d    shutil.move(tm
-00024310: 705f 6669 6c65 2e6e 616d 652c 2063 6163  p_file.name, cac
-00024320: 6865 5f66 696c 655f 6e61 6d65 290a 2020  he_file_name).  
-00024330: 2020 2020 2020 2020 2020 756d 6173 6b20            umask 
-00024340: 3d20 6f73 2e75 6d61 736b 2830 6f36 3636  = os.umask(0o666
-00024350: 290a 2020 2020 2020 2020 2020 2020 6f73  ).            os
-00024360: 2e75 6d61 736b 2875 6d61 736b 290a 2020  .umask(umask).  
-00024370: 2020 2020 2020 2020 2020 6f73 2e63 686d            os.chm
-00024380: 6f64 2863 6163 6865 5f66 696c 655f 6e61  od(cache_file_na
-00024390: 6d65 2c20 306f 3636 3620 2620 7e75 6d61  me, 0o666 & ~uma
-000243a0: 736b 290a 0a20 2020 2020 2020 2069 6620  sk)..        if 
-000243b0: 7570 6461 7465 5f64 6174 613a 0a20 2020  update_data:.   
-000243c0: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
-000243d0: 6520 6e65 7720 4461 7461 7365 7420 6672  e new Dataset fr
-000243e0: 6f6d 2062 7566 6665 7220 6f72 2066 696c  om buffer or fil
-000243f0: 650a 2020 2020 2020 2020 2020 2020 696e  e.            in
-00024400: 666f 203d 2073 656c 662e 696e 666f 2e63  fo = self.info.c
-00024410: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-00024420: 2020 696e 666f 2e66 6561 7475 7265 7320    info.features 
-00024430: 3d20 7772 6974 6572 2e5f 6665 6174 7572  = writer._featur
-00024440: 6573 0a20 2020 2020 2020 2020 2020 2069  es.            i
-00024450: 6e66 6f2e 7461 736b 5f74 656d 706c 6174  nfo.task_templat
-00024460: 6573 203d 204e 6f6e 650a 2020 2020 2020  es = None.      
-00024470: 2020 2020 2020 6966 2062 7566 5f77 7269        if buf_wri
-00024480: 7465 7220 6973 204e 6f6e 653a 0a20 2020  ter is None:.   
-00024490: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000244a0: 7572 6e20 4461 7461 7365 742e 6672 6f6d  urn Dataset.from
-000244b0: 5f66 696c 6528 6361 6368 655f 6669 6c65  _file(cache_file
-000244c0: 5f6e 616d 652c 2069 6e66 6f3d 696e 666f  _name, info=info
-000244d0: 2c20 7370 6c69 743d 7365 6c66 2e73 706c  , split=self.spl
-000244e0: 6974 290a 2020 2020 2020 2020 2020 2020  it).            
-000244f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00024500: 2020 2020 2020 7265 7475 726e 2044 6174        return Dat
-00024510: 6173 6574 2e66 726f 6d5f 6275 6666 6572  aset.from_buffer
-00024520: 2862 7566 5f77 7269 7465 722e 6765 7476  (buf_writer.getv
-00024530: 616c 7565 2829 2c20 696e 666f 3d69 6e66  alue(), info=inf
-00024540: 6f2c 2073 706c 6974 3d73 656c 662e 7370  o, split=self.sp
-00024550: 6c69 7429 0a20 2020 2020 2020 2065 6c73  lit).        els
-00024560: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00024570: 6574 7572 6e20 7365 6c66 0a0a 2020 2020  eturn self..    
-00024580: 4074 7261 6e73 6d69 745f 666f 726d 6174  @transmit_format
-00024590: 0a20 2020 2040 6669 6e67 6572 7072 696e  .    @fingerprin
-000245a0: 745f 7472 616e 7366 6f72 6d28 0a20 2020  t_transform(.   
-000245b0: 2020 2020 2069 6e70 6c61 6365 3d46 616c       inplace=Fal
-000245c0: 7365 2c20 6967 6e6f 7265 5f6b 7761 7267  se, ignore_kwarg
-000245d0: 733d 5b22 6c6f 6164 5f66 726f 6d5f 6361  s=["load_from_ca
-000245e0: 6368 655f 6669 6c65 222c 2022 6361 6368  che_file", "cach
-000245f0: 655f 6669 6c65 5f6e 616d 6522 2c20 2264  e_file_name", "d
-00024600: 6573 6322 5d2c 2076 6572 7369 6f6e 3d22  esc"], version="
-00024610: 322e 302e 3122 0a20 2020 2029 0a20 2020  2.0.1".    ).   
-00024620: 2064 6566 2066 696c 7465 7228 0a20 2020   def filter(.   
-00024630: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00024640: 2020 2066 756e 6374 696f 6e3a 204f 7074     function: Opt
-00024650: 696f 6e61 6c5b 4361 6c6c 6162 6c65 5d20  ional[Callable] 
-00024660: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00024670: 7769 7468 5f69 6e64 6963 6573 3d46 616c  with_indices=Fal
-00024680: 7365 2c0a 2020 2020 2020 2020 696e 7075  se,.        inpu
-00024690: 745f 636f 6c75 6d6e 733a 204f 7074 696f  t_columns: Optio
-000246a0: 6e61 6c5b 556e 696f 6e5b 7374 722c 204c  nal[Union[str, L
-000246b0: 6973 745b 7374 725d 5d5d 203d 204e 6f6e  ist[str]]] = Non
-000246c0: 652c 0a20 2020 2020 2020 2062 6174 6368  e,.        batch
-000246d0: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
-000246e0: 2c0a 2020 2020 2020 2020 6261 7463 685f  ,.        batch_
-000246f0: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b69  size: Optional[i
-00024700: 6e74 5d20 3d20 3130 3030 2c0a 2020 2020  nt] = 1000,.    
-00024710: 2020 2020 6b65 6570 5f69 6e5f 6d65 6d6f      keep_in_memo
-00024720: 7279 3a20 626f 6f6c 203d 2046 616c 7365  ry: bool = False
-00024730: 2c0a 2020 2020 2020 2020 6c6f 6164 5f66  ,.        load_f
-00024740: 726f 6d5f 6361 6368 655f 6669 6c65 3a20  rom_cache_file: 
-00024750: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
-00024760: 2020 2020 2063 6163 6865 5f66 696c 655f       cache_file_
-00024770: 6e61 6d65 3a20 4f70 7469 6f6e 616c 5b73  name: Optional[s
-00024780: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-00024790: 2020 2020 7772 6974 6572 5f62 6174 6368      writer_batch
-000247a0: 5f73 697a 653a 204f 7074 696f 6e61 6c5b  _size: Optional[
-000247b0: 696e 745d 203d 2031 3030 302c 0a20 2020  int] = 1000,.   
-000247c0: 2020 2020 2066 6e5f 6b77 6172 6773 3a20       fn_kwargs: 
-000247d0: 4f70 7469 6f6e 616c 5b64 6963 745d 203d  Optional[dict] =
-000247e0: 204e 6f6e 652c 0a20 2020 2020 2020 206e   None,.        n
-000247f0: 756d 5f70 726f 633a 204f 7074 696f 6e61  um_proc: Optiona
-00024800: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
-00024810: 2020 2020 2020 2073 7566 6669 785f 7465         suffix_te
-00024820: 6d70 6c61 7465 3a20 7374 7220 3d20 225f  mplate: str = "_
-00024830: 7b72 616e 6b3a 3035 647d 5f6f 665f 7b6e  {rank:05d}_of_{n
-00024840: 756d 5f70 726f 633a 3035 647d 222c 0a20  um_proc:05d}",. 
-00024850: 2020 2020 2020 206e 6577 5f66 696e 6765         new_finge
-00024860: 7270 7269 6e74 3a20 4f70 7469 6f6e 616c  rprint: Optional
-00024870: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
-00024880: 2020 2020 2020 6465 7363 3a20 4f70 7469        desc: Opti
-00024890: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-000248a0: 2c0a 2020 2020 2920 2d3e 2022 4461 7461  ,.    ) -> "Data
-000248b0: 7365 7422 3a0a 2020 2020 2020 2020 2222  set":.        ""
-000248c0: 2241 7070 6c79 2061 2066 696c 7465 7220  "Apply a filter 
-000248d0: 6675 6e63 7469 6f6e 2074 6f20 616c 6c20  function to all 
-000248e0: 7468 6520 656c 656d 656e 7473 2069 6e20  the elements in 
-000248f0: 7468 6520 7461 626c 6520 696e 2062 6174  the table in bat
-00024900: 6368 6573 0a20 2020 2020 2020 2061 6e64  ches.        and
-00024910: 2075 7064 6174 6520 7468 6520 7461 626c   update the tabl
-00024920: 6520 736f 2074 6861 7420 7468 6520 6461  e so that the da
-00024930: 7461 7365 7420 6f6e 6c79 2069 6e63 6c75  taset only inclu
-00024940: 6465 7320 6578 616d 706c 6573 2061 6363  des examples acc
-00024950: 6f72 6469 6e67 2074 6f20 7468 6520 6669  ording to the fi
-00024960: 6c74 6572 2066 756e 6374 696f 6e2e 0a0a  lter function...
-00024970: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00024980: 2020 2020 2020 2020 2020 6675 6e63 7469            functi
-00024990: 6f6e 2028 6043 616c 6c61 626c 6560 293a  on (`Callable`):
-000249a0: 2043 616c 6c61 626c 6520 7769 7468 206f   Callable with o
-000249b0: 6e65 206f 6620 7468 6520 666f 6c6c 6f77  ne of the follow
-000249c0: 696e 6720 7369 676e 6174 7572 6573 3a0a  ing signatures:.
-000249d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000249e0: 202d 2060 6675 6e63 7469 6f6e 2865 7861   - `function(exa
-000249f0: 6d70 6c65 3a20 4469 6374 5b73 7472 2c20  mple: Dict[str, 
-00024a00: 416e 795d 2920 2d3e 2062 6f6f 6c60 2069  Any]) -> bool` i
-00024a10: 6620 6077 6974 685f 696e 6469 6365 733d  f `with_indices=
-00024a20: 4661 6c73 652c 2062 6174 6368 6564 3d46  False, batched=F
-00024a30: 616c 7365 600a 2020 2020 2020 2020 2020  alse`.          
-00024a40: 2020 2020 2020 2d20 6066 756e 6374 696f        - `functio
-00024a50: 6e28 6578 616d 706c 653a 2044 6963 745b  n(example: Dict[
-00024a60: 7374 722c 2041 6e79 5d2c 2069 6e64 6963  str, Any], indic
-00024a70: 6573 3a20 696e 7429 202d 3e20 626f 6f6c  es: int) -> bool
-00024a80: 6020 6966 2060 7769 7468 5f69 6e64 6963  ` if `with_indic
-00024a90: 6573 3d54 7275 652c 2062 6174 6368 6564  es=True, batched
-00024aa0: 3d46 616c 7365 600a 2020 2020 2020 2020  =False`.        
-00024ab0: 2020 2020 2020 2020 2d20 6066 756e 6374          - `funct
-00024ac0: 696f 6e28 6578 616d 706c 653a 2044 6963  ion(example: Dic
-00024ad0: 745b 7374 722c 204c 6973 745d 2920 2d3e  t[str, List]) ->
-00024ae0: 204c 6973 745b 626f 6f6c 5d60 2069 6620   List[bool]` if 
-00024af0: 6077 6974 685f 696e 6469 6365 733d 4661  `with_indices=Fa
-00024b00: 6c73 652c 2062 6174 6368 6564 3d54 7275  lse, batched=Tru
-00024b10: 6560 0a20 2020 2020 2020 2020 2020 2020  e`.             
-00024b20: 2020 202d 2060 6675 6e63 7469 6f6e 2865     - `function(e
-00024b30: 7861 6d70 6c65 3a20 4469 6374 5b73 7472  xample: Dict[str
-00024b40: 2c20 4c69 7374 5d2c 2069 6e64 6963 6573  , List], indices
-00024b50: 3a20 4c69 7374 5b69 6e74 5d29 202d 3e20  : List[int]) -> 
-00024b60: 4c69 7374 5b62 6f6f 6c5d 6020 6966 2060  List[bool]` if `
-00024b70: 7769 7468 5f69 6e64 6963 6573 3d54 7275  with_indices=Tru
-00024b80: 652c 2062 6174 6368 6564 3d54 7275 6560  e, batched=True`
-00024b90: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024ba0: 2020 4966 206e 6f20 6675 6e63 7469 6f6e    If no function
-00024bb0: 2069 7320 7072 6f76 6964 6564 2c20 6465   is provided, de
-00024bc0: 6661 756c 7473 2074 6f20 616e 2061 6c77  faults to an alw
-00024bd0: 6179 7320 6054 7275 6560 2066 756e 6374  ays `True` funct
-00024be0: 696f 6e3a 2060 6c61 6d62 6461 2078 3a20  ion: `lambda x: 
-00024bf0: 5472 7565 602e 0a20 2020 2020 2020 2020  True`..         
-00024c00: 2020 2077 6974 685f 696e 6469 6365 7320     with_indices 
-00024c10: 2860 626f 6f6c 602c 2064 6566 6175 6c74  (`bool`, default
-00024c20: 7320 746f 2060 4661 6c73 6560 293a 0a20  s to `False`):. 
-00024c30: 2020 2020 2020 2020 2020 2020 2020 2050                 P
-00024c40: 726f 7669 6465 2065 7861 6d70 6c65 2069  rovide example i
-00024c50: 6e64 6963 6573 2074 6f20 6066 756e 6374  ndices to `funct
-00024c60: 696f 6e60 2e20 4e6f 7465 2074 6861 7420  ion`. Note that 
-00024c70: 696e 2074 6869 7320 6361 7365 2074 6865  in this case the
-00024c80: 2073 6967 6e61 7475 7265 206f 6620 6066   signature of `f
-00024c90: 756e 6374 696f 6e60 2073 686f 756c 6420  unction` should 
-00024ca0: 6265 2060 6465 6620 6675 6e63 7469 6f6e  be `def function
-00024cb0: 2865 7861 6d70 6c65 2c20 6964 7829 3a20  (example, idx): 
-00024cc0: 2e2e 2e60 2e0a 2020 2020 2020 2020 2020  ...`..          
-00024cd0: 2020 696e 7075 745f 636f 6c75 6d6e 7320    input_columns 
-00024ce0: 2860 7374 7260 206f 7220 604c 6973 745b  (`str` or `List[
-00024cf0: 7374 725d 602c 202a 6f70 7469 6f6e 616c  str]`, *optional
-00024d00: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
-00024d10: 2020 2020 5468 6520 636f 6c75 6d6e 7320      The columns 
-00024d20: 746f 2062 6520 7061 7373 6564 2069 6e74  to be passed int
-00024d30: 6f20 6066 756e 6374 696f 6e60 2061 730a  o `function` as.
-00024d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024d50: 706f 7369 7469 6f6e 616c 2061 7267 756d  positional argum
-00024d60: 656e 7473 2e20 4966 2060 4e6f 6e65 602c  ents. If `None`,
-00024d70: 2061 2060 6469 6374 6020 6d61 7070 696e   a `dict` mappin
-00024d80: 6720 746f 2061 6c6c 2066 6f72 6d61 7474  g to all formatt
-00024d90: 6564 2063 6f6c 756d 6e73 2069 7320 7061  ed columns is pa
-00024da0: 7373 6564 2061 7320 6f6e 6520 6172 6775  ssed as one argu
-00024db0: 6d65 6e74 2e0a 2020 2020 2020 2020 2020  ment..          
-00024dc0: 2020 6261 7463 6865 6420 2860 626f 6f6c    batched (`bool
-00024dd0: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
-00024de0: 4661 6c73 6560 293a 0a20 2020 2020 2020  False`):.       
-00024df0: 2020 2020 2020 2020 2050 726f 7669 6465           Provide
-00024e00: 2062 6174 6368 206f 6620 6578 616d 706c   batch of exampl
-00024e10: 6573 2074 6f20 6066 756e 6374 696f 6e60  es to `function`
-00024e20: 2e0a 2020 2020 2020 2020 2020 2020 6261  ..            ba
-00024e30: 7463 685f 7369 7a65 2028 6069 6e74 602c  tch_size (`int`,
-00024e40: 202a 6f70 7469 6f6e 616c 2a2c 2064 6566   *optional*, def
-00024e50: 6175 6c74 7320 746f 2060 3130 3030 6029  aults to `1000`)
-00024e60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00024e70: 2020 4e75 6d62 6572 206f 6620 6578 616d    Number of exam
-00024e80: 706c 6573 2070 6572 2062 6174 6368 2070  ples per batch p
-00024e90: 726f 7669 6465 6420 746f 2060 6675 6e63  rovided to `func
-00024ea0: 7469 6f6e 6020 6966 0a20 2020 2020 2020  tion` if.       
-00024eb0: 2020 2020 2020 2020 2060 6261 7463 6865           `batche
-00024ec0: 6420 3d20 5472 7565 602e 2049 6620 6062  d = True`. If `b
-00024ed0: 6174 6368 6564 203d 2046 616c 7365 602c  atched = False`,
-00024ee0: 206f 6e65 2065 7861 6d70 6c65 2070 6572   one example per
-00024ef0: 2062 6174 6368 2069 7320 7061 7373 6564   batch is passed
-00024f00: 2074 6f20 6066 756e 6374 696f 6e60 2e0a   to `function`..
-00024f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024f20: 4966 2060 6261 7463 685f 7369 7a65 203c  If `batch_size <
-00024f30: 3d20 3060 206f 7220 6062 6174 6368 5f73  = 0` or `batch_s
-00024f40: 697a 6520 3d3d 204e 6f6e 6560 2c20 7072  ize == None`, pr
-00024f50: 6f76 6964 6520 7468 6520 6675 6c6c 2064  ovide the full d
-00024f60: 6174 6173 6574 2061 7320 6120 7369 6e67  ataset as a sing
-00024f70: 6c65 2062 6174 6368 2074 6f20 6066 756e  le batch to `fun
-00024f80: 6374 696f 6e60 2e0a 2020 2020 2020 2020  ction`..        
-00024f90: 2020 2020 6b65 6570 5f69 6e5f 6d65 6d6f      keep_in_memo
-00024fa0: 7279 2028 6062 6f6f 6c60 2c20 6465 6661  ry (`bool`, defa
-00024fb0: 756c 7473 2074 6f20 6046 616c 7365 6029  ults to `False`)
-00024fc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00024fd0: 2020 4b65 6570 2074 6865 2064 6174 6173    Keep the datas
-00024fe0: 6574 2069 6e20 6d65 6d6f 7279 2069 6e73  et in memory ins
-00024ff0: 7465 6164 206f 6620 7772 6974 696e 6720  tead of writing 
-00025000: 6974 2074 6f20 6120 6361 6368 6520 6669  it to a cache fi
-00025010: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
-00025020: 6c6f 6164 5f66 726f 6d5f 6361 6368 655f  load_from_cache_
-00025030: 6669 6c65 2028 6062 6f6f 6c60 2c20 6465  file (`bool`, de
-00025040: 6661 756c 7473 2074 6f20 6054 7275 6560  faults to `True`
-00025050: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00025060: 2020 2049 6620 6120 6361 6368 6520 6669     If a cache fi
-00025070: 6c65 2073 746f 7269 6e67 2074 6865 2063  le storing the c
-00025080: 7572 7265 6e74 2063 6f6d 7075 7461 7469  urrent computati
-00025090: 6f6e 2066 726f 6d20 6066 756e 6374 696f  on from `functio
-000250a0: 6e60 0a20 2020 2020 2020 2020 2020 2020  n`.             
-000250b0: 2020 2063 616e 2062 6520 6964 656e 7469     can be identi
-000250c0: 6669 6564 2c20 7573 6520 6974 2069 6e73  fied, use it ins
-000250d0: 7465 6164 206f 6620 7265 636f 6d70 7574  tead of recomput
-000250e0: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-000250f0: 2063 6163 6865 5f66 696c 655f 6e61 6d65   cache_file_name
-00025100: 2028 6073 7472 602c 202a 6f70 7469 6f6e   (`str`, *option
-00025110: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
-00025120: 2020 2020 2020 5072 6f76 6964 6520 7468        Provide th
-00025130: 6520 6e61 6d65 206f 6620 6120 7061 7468  e name of a path
-00025140: 2066 6f72 2074 6865 2063 6163 6865 2066   for the cache f
-00025150: 696c 652e 2049 7420 6973 2075 7365 6420  ile. It is used 
-00025160: 746f 2073 746f 7265 2074 6865 0a20 2020  to store the.   
-00025170: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00025180: 756c 7473 206f 6620 7468 6520 636f 6d70  ults of the comp
-00025190: 7574 6174 696f 6e20 696e 7374 6561 6420  utation instead 
-000251a0: 6f66 2074 6865 2061 7574 6f6d 6174 6963  of the automatic
-000251b0: 616c 6c79 2067 656e 6572 6174 6564 2063  ally generated c
-000251c0: 6163 6865 2066 696c 6520 6e61 6d65 2e0a  ache file name..
-000251d0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
-000251e0: 6572 5f62 6174 6368 5f73 697a 6520 2860  er_batch_size (`
-000251f0: 696e 7460 2c20 6465 6661 756c 7473 2074  int`, defaults t
-00025200: 6f20 6031 3030 3060 293a 0a20 2020 2020  o `1000`):.     
-00025210: 2020 2020 2020 2020 2020 204e 756d 6265             Numbe
-00025220: 7220 6f66 2072 6f77 7320 7065 7220 7772  r of rows per wr
-00025230: 6974 6520 6f70 6572 6174 696f 6e20 666f  ite operation fo
-00025240: 7220 7468 6520 6361 6368 6520 6669 6c65  r the cache file
-00025250: 2077 7269 7465 722e 0a20 2020 2020 2020   writer..       
-00025260: 2020 2020 2020 2020 2054 6869 7320 7661           This va
-00025270: 6c75 6520 6973 2061 2067 6f6f 6420 7472  lue is a good tr
-00025280: 6164 652d 6f66 6620 6265 7477 6565 6e20  ade-off between 
-00025290: 6d65 6d6f 7279 2075 7361 6765 2064 7572  memory usage dur
-000252a0: 696e 6720 7468 6520 7072 6f63 6573 7369  ing the processi
-000252b0: 6e67 2c20 616e 6420 7072 6f63 6573 7369  ng, and processi
-000252c0: 6e67 2073 7065 6564 2e0a 2020 2020 2020  ng speed..      
-000252d0: 2020 2020 2020 2020 2020 4869 6768 6572            Higher
-000252e0: 2076 616c 7565 206d 616b 6573 2074 6865   value makes the
-000252f0: 2070 726f 6365 7373 696e 6720 646f 2066   processing do f
-00025300: 6577 6572 206c 6f6f 6b75 7073 2c20 6c6f  ewer lookups, lo
-00025310: 7765 7220 7661 6c75 6520 636f 6e73 756d  wer value consum
-00025320: 6520 6c65 7373 2074 656d 706f 7261 7279  e less temporary
-00025330: 206d 656d 6f72 7920 7768 696c 6520 7275   memory while ru
-00025340: 6e6e 696e 6720 606d 6170 602e 0a20 2020  nning `map`..   
-00025350: 2020 2020 2020 2020 2066 6e5f 6b77 6172           fn_kwar
-00025360: 6773 2028 6064 6963 7460 2c20 2a6f 7074  gs (`dict`, *opt
-00025370: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
-00025380: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
-00025390: 2061 7267 756d 656e 7473 2074 6f20 6265   arguments to be
-000253a0: 2070 6173 7365 6420 746f 2060 6675 6e63   passed to `func
-000253b0: 7469 6f6e 602e 0a20 2020 2020 2020 2020  tion`..         
-000253c0: 2020 206e 756d 5f70 726f 6320 2860 696e     num_proc (`in
-000253d0: 7460 2c20 2a6f 7074 696f 6e61 6c2a 293a  t`, *optional*):
-000253e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000253f0: 204e 756d 6265 7220 6f66 2070 726f 6365   Number of proce
-00025400: 7373 6573 2066 6f72 206d 756c 7469 7072  sses for multipr
-00025410: 6f63 6573 7369 6e67 2e20 4279 2064 6566  ocessing. By def
-00025420: 6175 6c74 2069 7420 646f 6573 6e27 740a  ault it doesn't.
-00025430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025440: 7573 6520 6d75 6c74 6970 726f 6365 7373  use multiprocess
-00025450: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-00025460: 2073 7566 6669 785f 7465 6d70 6c61 7465   suffix_template
-00025470: 2028 6073 7472 6029 3a0a 2020 2020 2020   (`str`):.      
-00025480: 2020 2020 2020 2020 2020 4966 2060 6361            If `ca
-00025490: 6368 655f 6669 6c65 5f6e 616d 6560 2069  che_file_name` i
-000254a0: 7320 7370 6563 6966 6965 642c 2074 6865  s specified, the
-000254b0: 6e20 7468 6973 2073 7566 6669 7820 7769  n this suffix wi
-000254c0: 6c6c 2062 6520 6164 6465 6420 6174 2074  ll be added at t
-000254d0: 6865 2065 6e64 206f 6620 7468 6520 6261  he end of the ba
-000254e0: 7365 206e 616d 6520 6f66 2065 6163 682e  se name of each.
-000254f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025500: 2046 6f72 2065 7861 6d70 6c65 2c20 6966   For example, if
-00025510: 2060 6361 6368 655f 6669 6c65 5f6e 616d   `cache_file_nam
-00025520: 6560 2069 7320 6022 7072 6f63 6573 7365  e` is `"processe
-00025530: 642e 6172 726f 7722 602c 2074 6865 6e20  d.arrow"`, then 
-00025540: 666f 7220 6072 616e 6b20 3d20 3160 2061  for `rank = 1` a
-00025550: 6e64 2060 6e75 6d5f 7072 6f63 203d 2034  nd `num_proc = 4
-00025560: 602c 0a20 2020 2020 2020 2020 2020 2020  `,.             
-00025570: 2020 2074 6865 2072 6573 756c 7469 6e67     the resulting
-00025580: 2066 696c 6520 776f 756c 6420 6265 2060   file would be `
-00025590: 2270 726f 6365 7373 6564 5f30 3030 3031  "processed_00001
-000255a0: 5f6f 665f 3030 3030 342e 6172 726f 7722  _of_00004.arrow"
-000255b0: 6020 666f 7220 7468 6520 6465 6661 756c  ` for the defaul
-000255c0: 7420 7375 6666 6978 2028 6465 6661 756c  t suffix (defaul
-000255d0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-000255e0: 2020 605f 7b72 616e 6b3a 3035 647d 5f6f    `_{rank:05d}_o
-000255f0: 665f 7b6e 756d 5f70 726f 633a 3035 647d  f_{num_proc:05d}
-00025600: 6029 2e0a 2020 2020 2020 2020 2020 2020  `)..            
-00025610: 6e65 775f 6669 6e67 6572 7072 696e 7420  new_fingerprint 
-00025620: 2860 7374 7260 2c20 2a6f 7074 696f 6e61  (`str`, *optiona
-00025630: 6c2a 293a 0a20 2020 2020 2020 2020 2020  l*):.           
-00025640: 2020 2020 2054 6865 206e 6577 2066 696e       The new fin
-00025650: 6765 7270 7269 6e74 206f 6620 7468 6520  gerprint of the 
-00025660: 6461 7461 7365 7420 6166 7465 7220 7472  dataset after tr
-00025670: 616e 7366 6f72 6d2e 0a20 2020 2020 2020  ansform..       
-00025680: 2020 2020 2020 2020 2049 6620 604e 6f6e           If `Non
-00025690: 6560 2c20 7468 6520 6e65 7720 6669 6e67  e`, the new fing
-000256a0: 6572 7072 696e 7420 6973 2063 6f6d 7075  erprint is compu
-000256b0: 7465 6420 7573 696e 6720 6120 6861 7368  ted using a hash
-000256c0: 206f 6620 7468 6520 7072 6576 696f 7573   of the previous
-000256d0: 2066 696e 6765 7270 7269 6e74 2c20 616e   fingerprint, an
-000256e0: 6420 7468 6520 7472 616e 7366 6f72 6d20  d the transform 
-000256f0: 6172 6775 6d65 6e74 732e 0a20 2020 2020  arguments..     
-00025700: 2020 2020 2020 2064 6573 6320 2860 7374         desc (`st
-00025710: 7260 2c20 2a6f 7074 696f 6e61 6c2a 2c20  r`, *optional*, 
-00025720: 6465 6661 756c 7473 2074 6f20 604e 6f6e  defaults to `Non
-00025730: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
-00025740: 2020 2020 204d 6561 6e69 6e67 6675 6c20       Meaningful 
-00025750: 6465 7363 7269 7074 696f 6e20 746f 2062  description to b
-00025760: 6520 6469 7370 6c61 7965 6420 616c 6f6e  e displayed alon
-00025770: 6773 6964 6520 7769 7468 2074 6865 2070  gside with the p
-00025780: 726f 6772 6573 7320 6261 7220 7768 696c  rogress bar whil
-00025790: 6520 6669 6c74 6572 696e 6720 6578 616d  e filtering exam
-000257a0: 706c 6573 2e0a 0a20 2020 2020 2020 2045  ples...        E
-000257b0: 7861 6d70 6c65 3a0a 0a20 2020 2020 2020  xample:..       
-000257c0: 2060 6060 7079 0a20 2020 2020 2020 203e   ```py.        >
-000257d0: 3e3e 2066 726f 6d20 6461 7461 7365 7473  >> from datasets
-000257e0: 2069 6d70 6f72 7420 6c6f 6164 5f64 6174   import load_dat
-000257f0: 6173 6574 0a20 2020 2020 2020 203e 3e3e  aset.        >>>
-00025800: 2064 7320 3d20 6c6f 6164 5f64 6174 6173   ds = load_datas
-00025810: 6574 2822 726f 7474 656e 5f74 6f6d 6174  et("rotten_tomat
-00025820: 6f65 7322 2c20 7370 6c69 743d 2276 616c  oes", split="val
-00025830: 6964 6174 696f 6e22 290a 2020 2020 2020  idation").      
-00025840: 2020 3e3e 3e20 6473 2e66 696c 7465 7228    >>> ds.filter(
-00025850: 6c61 6d62 6461 2078 3a20 785b 226c 6162  lambda x: x["lab
-00025860: 656c 225d 203d 3d20 3129 0a20 2020 2020  el"] == 1).     
-00025870: 2020 2044 6174 6173 6574 287b 0a20 2020     Dataset({.   
-00025880: 2020 2020 2020 2020 2066 6561 7475 7265           feature
-00025890: 733a 205b 2774 6578 7427 2c20 276c 6162  s: ['text', 'lab
-000258a0: 656c 275d 2c0a 2020 2020 2020 2020 2020  el'],.          
-000258b0: 2020 6e75 6d5f 726f 7773 3a20 3533 330a    num_rows: 533.
-000258c0: 2020 2020 2020 2020 7d29 0a20 2020 2020          }).     
-000258d0: 2020 2060 6060 0a20 2020 2020 2020 2022     ```.        "
-000258e0: 2222 0a20 2020 2020 2020 2069 6620 6c65  "".        if le
-000258f0: 6e28 7365 6c66 2e6c 6973 745f 696e 6465  n(self.list_inde
-00025900: 7865 7328 2929 203e 2030 3a0a 2020 2020  xes()) > 0:.    
-00025910: 2020 2020 2020 2020 7261 6973 6520 4461          raise Da
-00025920: 7461 7365 7454 7261 6e73 666f 726d 6174  tasetTransformat
-00025930: 696f 6e4e 6f74 416c 6c6f 7765 6445 7272  ionNotAllowedErr
-00025940: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00025950: 2020 2020 2255 7369 6e67 2060 2e66 696c      "Using `.fil
-00025960: 7465 7260 206f 6e20 6120 6461 7461 7365  ter` on a datase
-00025970: 7420 7769 7468 2061 7474 6163 6865 6420  t with attached 
-00025980: 696e 6465 7865 7320 6973 206e 6f74 2061  indexes is not a
-00025990: 6c6c 6f77 6564 2e20 596f 7520 6361 6e20  llowed. You can 
-000259a0: 6669 7273 7420 7275 6e20 602e 6472 6f70  first run `.drop
-000259b0: 5f69 6e64 6578 2829 2074 6f20 7265 6d6f  _index() to remo
-000259c0: 7665 2079 6f75 7220 696e 6465 7820 616e  ve your index an
-000259d0: 6420 7468 656e 2072 652d 6164 6420 6974  d then re-add it
-000259e0: 2e60 220a 2020 2020 2020 2020 2020 2020  .`".            
-000259f0: 290a 0a20 2020 2020 2020 2069 6620 6675  )..        if fu
-00025a00: 6e63 7469 6f6e 2069 7320 4e6f 6e65 3a0a  nction is None:.
-00025a10: 2020 2020 2020 2020 2020 2020 6675 6e63              func
-00025a20: 7469 6f6e 203d 206c 616d 6264 6120 783a  tion = lambda x:
-00025a30: 2054 7275 6520 2023 206e 6f71 613a 2045   True  # noqa: E
-00025a40: 3733 310a 0a20 2020 2020 2020 2069 6620  731..        if 
-00025a50: 6c65 6e28 7365 6c66 2920 3d3d 2030 3a0a  len(self) == 0:.
-00025a60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00025a70: 726e 2073 656c 660a 0a20 2020 2020 2020  rn self..       
-00025a80: 2069 6e64 6963 6573 203d 2073 656c 662e   indices = self.
-00025a90: 6d61 7028 0a20 2020 2020 2020 2020 2020  map(.           
-00025aa0: 2066 756e 6374 696f 6e3d 7061 7274 6961   function=partia
-00025ab0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00025ac0: 2020 2067 6574 5f69 6e64 6963 6573 5f66     get_indices_f
-00025ad0: 726f 6d5f 6d61 736b 5f66 756e 6374 696f  rom_mask_functio
-00025ae0: 6e2c 2066 756e 6374 696f 6e2c 2062 6174  n, function, bat
-00025af0: 6368 6564 2c20 7769 7468 5f69 6e64 6963  ched, with_indic
-00025b00: 6573 2c20 696e 7075 745f 636f 6c75 6d6e  es, input_column
-00025b10: 732c 2073 656c 662e 5f69 6e64 6963 6573  s, self._indices
-00025b20: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
-00025b30: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00025b40: 5f69 6e64 6963 6573 3d54 7275 652c 0a20  _indices=True,. 
-00025b50: 2020 2020 2020 2020 2020 2066 6561 7475             featu
-00025b60: 7265 733d 4665 6174 7572 6573 287b 2269  res=Features({"i
-00025b70: 6e64 6963 6573 223a 2056 616c 7565 2822  ndices": Value("
-00025b80: 7569 6e74 3634 2229 7d29 2c0a 2020 2020  uint64")}),.    
-00025b90: 2020 2020 2020 2020 6261 7463 6865 643d          batched=
-00025ba0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00025bb0: 2020 6261 7463 685f 7369 7a65 3d62 6174    batch_size=bat
-00025bc0: 6368 5f73 697a 652c 0a20 2020 2020 2020  ch_size,.       
-00025bd0: 2020 2020 2072 656d 6f76 655f 636f 6c75       remove_colu
-00025be0: 6d6e 733d 7365 6c66 2e63 6f6c 756d 6e5f  mns=self.column_
-00025bf0: 6e61 6d65 732c 0a20 2020 2020 2020 2020  names,.         
-00025c00: 2020 206b 6565 705f 696e 5f6d 656d 6f72     keep_in_memor
-00025c10: 793d 6b65 6570 5f69 6e5f 6d65 6d6f 7279  y=keep_in_memory
-00025c20: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
-00025c30: 6164 5f66 726f 6d5f 6361 6368 655f 6669  ad_from_cache_fi
-00025c40: 6c65 3d6c 6f61 645f 6672 6f6d 5f63 6163  le=load_from_cac
-00025c50: 6865 5f66 696c 652c 0a20 2020 2020 2020  he_file,.       
-00025c60: 2020 2020 2063 6163 6865 5f66 696c 655f       cache_file_
-00025c70: 6e61 6d65 3d63 6163 6865 5f66 696c 655f  name=cache_file_
-00025c80: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00025c90: 2020 7772 6974 6572 5f62 6174 6368 5f73    writer_batch_s
-00025ca0: 697a 653d 7772 6974 6572 5f62 6174 6368  ize=writer_batch
-00025cb0: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-00025cc0: 2020 2066 6e5f 6b77 6172 6773 3d66 6e5f     fn_kwargs=fn_
-00025cd0: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
-00025ce0: 2020 2020 6e75 6d5f 7072 6f63 3d6e 756d      num_proc=num
-00025cf0: 5f70 726f 632c 0a20 2020 2020 2020 2020  _proc,.         
-00025d00: 2020 2073 7566 6669 785f 7465 6d70 6c61     suffix_templa
-00025d10: 7465 3d73 7566 6669 785f 7465 6d70 6c61  te=suffix_templa
-00025d20: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
-00025d30: 6e65 775f 6669 6e67 6572 7072 696e 743d  new_fingerprint=
-00025d40: 6e65 775f 6669 6e67 6572 7072 696e 742c  new_fingerprint,
-00025d50: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-00025d60: 7574 5f63 6f6c 756d 6e73 3d69 6e70 7574  ut_columns=input
-00025d70: 5f63 6f6c 756d 6e73 2c0a 2020 2020 2020  _columns,.      
-00025d80: 2020 2020 2020 6465 7363 3d64 6573 632c        desc=desc,
-00025d90: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00025da0: 2020 206e 6577 5f64 6174 6173 6574 203d     new_dataset =
-00025db0: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
-00025dc0: 656c 6629 0a20 2020 2020 2020 206e 6577  elf).        new
-00025dd0: 5f64 6174 6173 6574 2e5f 696e 6469 6365  _dataset._indice
-00025de0: 7320 3d20 696e 6469 6365 732e 6461 7461  s = indices.data
-00025df0: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
-00025e00: 6173 6574 2e5f 6669 6e67 6572 7072 696e  aset._fingerprin
-00025e10: 7420 3d20 6e65 775f 6669 6e67 6572 7072  t = new_fingerpr
-00025e20: 696e 740a 2020 2020 2020 2020 7265 7475  int.        retu
-00025e30: 726e 206e 6577 5f64 6174 6173 6574 0a0a  rn new_dataset..
-00025e40: 2020 2020 4074 7261 6e73 6d69 745f 666f      @transmit_fo
-00025e50: 726d 6174 0a20 2020 2040 6669 6e67 6572  rmat.    @finger
-00025e60: 7072 696e 745f 7472 616e 7366 6f72 6d28  print_transform(
-00025e70: 696e 706c 6163 653d 4661 6c73 652c 2069  inplace=False, i
-00025e80: 676e 6f72 655f 6b77 6172 6773 3d5b 2263  gnore_kwargs=["c
-00025e90: 6163 6865 5f66 696c 655f 6e61 6d65 225d  ache_file_name"]
-00025ea0: 290a 2020 2020 6465 6620 666c 6174 7465  ).    def flatte
-00025eb0: 6e5f 696e 6469 6365 7328 0a20 2020 2020  n_indices(.     
-00025ec0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00025ed0: 206b 6565 705f 696e 5f6d 656d 6f72 793a   keep_in_memory:
-00025ee0: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-00025ef0: 2020 2020 2020 2063 6163 6865 5f66 696c         cache_fil
-00025f00: 655f 6e61 6d65 3a20 4f70 7469 6f6e 616c  e_name: Optional
-00025f10: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
-00025f20: 2020 2020 2020 7772 6974 6572 5f62 6174        writer_bat
-00025f30: 6368 5f73 697a 653a 204f 7074 696f 6e61  ch_size: Optiona
-00025f40: 6c5b 696e 745d 203d 2031 3030 302c 0a20  l[int] = 1000,. 
-00025f50: 2020 2020 2020 2066 6561 7475 7265 733a         features:
-00025f60: 204f 7074 696f 6e61 6c5b 4665 6174 7572   Optional[Featur
-00025f70: 6573 5d20 3d20 4e6f 6e65 2c0a 2020 2020  es] = None,.    
-00025f80: 2020 2020 6469 7361 626c 655f 6e75 6c6c      disable_null
-00025f90: 6162 6c65 3a20 626f 6f6c 203d 2046 616c  able: bool = Fal
-00025fa0: 7365 2c0a 2020 2020 2020 2020 6e75 6d5f  se,.        num_
-00025fb0: 7072 6f63 3a20 4f70 7469 6f6e 616c 5b69  proc: Optional[i
-00025fc0: 6e74 5d20 3d20 4e6f 6e65 2c0a 2020 2020  nt] = None,.    
-00025fd0: 2020 2020 6e65 775f 6669 6e67 6572 7072      new_fingerpr
-00025fe0: 696e 743a 204f 7074 696f 6e61 6c5b 7374  int: Optional[st
-00025ff0: 725d 203d 204e 6f6e 652c 0a20 2020 2029  r] = None,.    )
-00026000: 202d 3e20 2244 6174 6173 6574 223a 0a20   -> "Dataset":. 
-00026010: 2020 2020 2020 2022 2222 4372 6561 7465         """Create
-00026020: 2061 6e64 2063 6163 6865 2061 206e 6577   and cache a new
-00026030: 2044 6174 6173 6574 2062 7920 666c 6174   Dataset by flat
-00026040: 7465 6e69 6e67 2074 6865 2069 6e64 6963  tening the indic
-00026050: 6573 206d 6170 7069 6e67 2e0a 0a20 2020  es mapping...   
-00026060: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00026070: 2020 2020 2020 206b 6565 705f 696e 5f6d         keep_in_m
-00026080: 656d 6f72 7920 2860 626f 6f6c 602c 2064  emory (`bool`, d
-00026090: 6566 6175 6c74 7320 746f 2060 4661 6c73  efaults to `Fals
-000260a0: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
-000260b0: 2020 2020 204b 6565 7020 7468 6520 6461       Keep the da
-000260c0: 7461 7365 7420 696e 206d 656d 6f72 7920  taset in memory 
-000260d0: 696e 7374 6561 6420 6f66 2077 7269 7469  instead of writi
-000260e0: 6e67 2069 7420 746f 2061 2063 6163 6865  ng it to a cache
-000260f0: 2066 696c 652e 0a20 2020 2020 2020 2020   file..         
-00026100: 2020 2063 6163 6865 5f66 696c 655f 6e61     cache_file_na
-00026110: 6d65 2028 6073 7472 602c 202a 6f70 7469  me (`str`, *opti
-00026120: 6f6e 616c 2a2c 2064 6566 6175 6c74 2060  onal*, default `
-00026130: 4e6f 6e65 6029 3a0a 2020 2020 2020 2020  None`):.        
-00026140: 2020 2020 2020 2020 5072 6f76 6964 6520          Provide 
-00026150: 7468 6520 6e61 6d65 206f 6620 6120 7061  the name of a pa
-00026160: 7468 2066 6f72 2074 6865 2063 6163 6865  th for the cache
-00026170: 2066 696c 652e 2049 7420 6973 2075 7365   file. It is use
-00026180: 6420 746f 2073 746f 7265 2074 6865 0a20  d to store the. 
-00026190: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000261a0: 6573 756c 7473 206f 6620 7468 6520 636f  esults of the co
-000261b0: 6d70 7574 6174 696f 6e20 696e 7374 6561  mputation instea
-000261c0: 6420 6f66 2074 6865 2061 7574 6f6d 6174  d of the automat
-000261d0: 6963 616c 6c79 2067 656e 6572 6174 6564  ically generated
-000261e0: 2063 6163 6865 2066 696c 6520 6e61 6d65   cache file name
-000261f0: 2e0a 2020 2020 2020 2020 2020 2020 7772  ..            wr
-00026200: 6974 6572 5f62 6174 6368 5f73 697a 6520  iter_batch_size 
-00026210: 2860 696e 7460 2c20 6465 6661 756c 7473  (`int`, defaults
-00026220: 2074 6f20 6031 3030 3060 293a 0a20 2020   to `1000`):.   
-00026230: 2020 2020 2020 2020 2020 2020 204e 756d               Num
-00026240: 6265 7220 6f66 2072 6f77 7320 7065 7220  ber of rows per 
-00026250: 7772 6974 6520 6f70 6572 6174 696f 6e20  write operation 
-00026260: 666f 7220 7468 6520 6361 6368 6520 6669  for the cache fi
-00026270: 6c65 2077 7269 7465 722e 0a20 2020 2020  le writer..     
-00026280: 2020 2020 2020 2020 2020 2054 6869 7320             This 
-00026290: 7661 6c75 6520 6973 2061 2067 6f6f 6420  value is a good 
-000262a0: 7472 6164 652d 6f66 6620 6265 7477 6565  trade-off betwee
-000262b0: 6e20 6d65 6d6f 7279 2075 7361 6765 2064  n memory usage d
-000262c0: 7572 696e 6720 7468 6520 7072 6f63 6573  uring the proces
-000262d0: 7369 6e67 2c20 616e 6420 7072 6f63 6573  sing, and proces
-000262e0: 7369 6e67 2073 7065 6564 2e0a 2020 2020  sing speed..    
-000262f0: 2020 2020 2020 2020 2020 2020 4869 6768              High
-00026300: 6572 2076 616c 7565 206d 616b 6573 2074  er value makes t
-00026310: 6865 2070 726f 6365 7373 696e 6720 646f  he processing do
-00026320: 2066 6577 6572 206c 6f6f 6b75 7073 2c20   fewer lookups, 
-00026330: 6c6f 7765 7220 7661 6c75 6520 636f 6e73  lower value cons
-00026340: 756d 6520 6c65 7373 2074 656d 706f 7261  ume less tempora
-00026350: 7279 206d 656d 6f72 7920 7768 696c 6520  ry memory while 
-00026360: 7275 6e6e 696e 6720 606d 6170 602e 0a20  running `map`.. 
-00026370: 2020 2020 2020 2020 2020 2066 6561 7475             featu
-00026380: 7265 7320 2860 4f70 7469 6f6e 616c 5b64  res (`Optional[d
-00026390: 6174 6173 6574 732e 4665 6174 7572 6573  atasets.Features
-000263a0: 5d60 2c20 6465 6661 756c 7473 2074 6f20  ]`, defaults to 
-000263b0: 604e 6f6e 6560 293a 0a20 2020 2020 2020  `None`):.       
-000263c0: 2020 2020 2020 2020 2055 7365 2061 2073           Use a s
-000263d0: 7065 6369 6669 6320 5b60 4665 6174 7572  pecific [`Featur
-000263e0: 6573 605d 2074 6f20 7374 6f72 6520 7468  es`] to store th
-000263f0: 6520 6361 6368 6520 6669 6c65 0a20 2020  e cache file.   
-00026400: 2020 2020 2020 2020 2020 2020 2069 6e73               ins
-00026410: 7465 6164 206f 6620 7468 6520 6175 746f  tead of the auto
-00026420: 6d61 7469 6361 6c6c 7920 6765 6e65 7261  matically genera
-00026430: 7465 6420 6f6e 652e 0a20 2020 2020 2020  ted one..       
-00026440: 2020 2020 2064 6973 6162 6c65 5f6e 756c       disable_nul
-00026450: 6c61 626c 6520 2860 626f 6f6c 602c 2064  lable (`bool`, d
-00026460: 6566 6175 6c74 7320 746f 2060 4661 6c73  efaults to `Fals
-00026470: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
-00026480: 2020 2020 2041 6c6c 6f77 206e 756c 6c20       Allow null 
-00026490: 7661 6c75 6573 2069 6e20 7468 6520 7461  values in the ta
-000264a0: 626c 652e 0a20 2020 2020 2020 2020 2020  ble..           
-000264b0: 206e 756d 5f70 726f 6320 2860 696e 7460   num_proc (`int`
-000264c0: 2c20 6f70 7469 6f6e 616c 2c20 6465 6661  , optional, defa
-000264d0: 756c 7420 604e 6f6e 6560 293a 0a20 2020  ult `None`):.   
-000264e0: 2020 2020 2020 2020 2020 2020 204d 6178               Max
-000264f0: 206e 756d 6265 7220 6f66 2070 726f 6365   number of proce
-00026500: 7373 6573 2077 6865 6e20 6765 6e65 7261  sses when genera
-00026510: 7469 6e67 2063 6163 6865 2e20 416c 7265  ting cache. Alre
-00026520: 6164 7920 6361 6368 6564 2073 6861 7264  ady cached shard
-00026530: 7320 6172 6520 6c6f 6164 6564 2073 6571  s are loaded seq
-00026540: 7565 6e74 6961 6c6c 790a 2020 2020 2020  uentially.      
-00026550: 2020 2020 2020 6e65 775f 6669 6e67 6572        new_finger
-00026560: 7072 696e 7420 2860 7374 7260 2c20 2a6f  print (`str`, *o
-00026570: 7074 696f 6e61 6c2a 2c20 6465 6661 756c  ptional*, defaul
-00026580: 7473 2074 6f20 604e 6f6e 6560 293a 0a20  ts to `None`):. 
-00026590: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-000265a0: 6865 206e 6577 2066 696e 6765 7270 7269  he new fingerpri
-000265b0: 6e74 206f 6620 7468 6520 6461 7461 7365  nt of the datase
-000265c0: 7420 6166 7465 7220 7472 616e 7366 6f72  t after transfor
-000265d0: 6d2e 0a20 2020 2020 2020 2020 2020 2020  m..             
-000265e0: 2020 2049 6620 604e 6f6e 6560 2c20 7468     If `None`, th
-000265f0: 6520 6e65 7720 6669 6e67 6572 7072 696e  e new fingerprin
-00026600: 7420 6973 2063 6f6d 7075 7465 6420 7573  t is computed us
-00026610: 696e 6720 6120 6861 7368 206f 6620 7468  ing a hash of th
-00026620: 6520 7072 6576 696f 7573 2066 696e 6765  e previous finge
-00026630: 7270 7269 6e74 2c20 616e 6420 7468 6520  rprint, and the 
-00026640: 7472 616e 7366 6f72 6d20 6172 6775 6d65  transform argume
-00026650: 6e74 730a 2020 2020 2020 2020 2222 220a  nts.        """.
-00026660: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00026670: 7365 6c66 2e6d 6170 280a 2020 2020 2020  self.map(.      
-00026680: 2020 2020 2020 6261 7463 6865 643d 5472        batched=Tr
-00026690: 7565 2c20 2023 2066 6f72 2073 7065 6564  ue,  # for speed
-000266a0: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
-000266b0: 705f 696e 5f6d 656d 6f72 793d 6b65 6570  p_in_memory=keep
-000266c0: 5f69 6e5f 6d65 6d6f 7279 2c0a 2020 2020  _in_memory,.    
-000266d0: 2020 2020 2020 2020 6361 6368 655f 6669          cache_fi
-000266e0: 6c65 5f6e 616d 653d 6361 6368 655f 6669  le_name=cache_fi
-000266f0: 6c65 5f6e 616d 652c 0a20 2020 2020 2020  le_name,.       
-00026700: 2020 2020 2077 7269 7465 725f 6261 7463       writer_batc
-00026710: 685f 7369 7a65 3d77 7269 7465 725f 6261  h_size=writer_ba
-00026720: 7463 685f 7369 7a65 2c0a 2020 2020 2020  tch_size,.      
-00026730: 2020 2020 2020 6665 6174 7572 6573 3d66        features=f
-00026740: 6561 7475 7265 732c 0a20 2020 2020 2020  eatures,.       
-00026750: 2020 2020 2064 6973 6162 6c65 5f6e 756c       disable_nul
-00026760: 6c61 626c 653d 6469 7361 626c 655f 6e75  lable=disable_nu
-00026770: 6c6c 6162 6c65 2c0a 2020 2020 2020 2020  llable,.        
-00026780: 2020 2020 6e65 775f 6669 6e67 6572 7072      new_fingerpr
-00026790: 696e 743d 6e65 775f 6669 6e67 6572 7072  int=new_fingerpr
-000267a0: 696e 742c 0a20 2020 2020 2020 2020 2020  int,.           
-000267b0: 2064 6573 633d 2246 6c61 7474 656e 696e   desc="Flattenin
-000267c0: 6720 7468 6520 696e 6469 6365 7322 2c0a  g the indices",.
-000267d0: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
-000267e0: 7072 6f63 3d6e 756d 5f70 726f 632c 0a20  proc=num_proc,. 
-000267f0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00026800: 6620 5f6e 6577 5f64 6174 6173 6574 5f77  f _new_dataset_w
-00026810: 6974 685f 696e 6469 6365 7328 0a20 2020  ith_indices(.   
-00026820: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00026830: 2020 2069 6e64 6963 6573 5f63 6163 6865     indices_cache
-00026840: 5f66 696c 655f 6e61 6d65 3a20 4f70 7469  _file_name: Opti
-00026850: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-00026860: 2c0a 2020 2020 2020 2020 696e 6469 6365  ,.        indice
-00026870: 735f 6275 6666 6572 3a20 4f70 7469 6f6e  s_buffer: Option
-00026880: 616c 5b70 612e 4275 6666 6572 5d20 3d20  al[pa.Buffer] = 
-00026890: 4e6f 6e65 2c0a 2020 2020 2020 2020 6669  None,.        fi
-000268a0: 6e67 6572 7072 696e 743a 204f 7074 696f  ngerprint: Optio
-000268b0: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
-000268c0: 0a20 2020 2029 202d 3e20 2244 6174 6173  .    ) -> "Datas
-000268d0: 6574 223a 0a20 2020 2020 2020 2022 2222  et":.        """
-000268e0: 5265 7475 726e 2061 206e 6577 2044 6174  Return a new Dat
-000268f0: 6173 6574 206f 6274 6169 6e65 6420 6279  aset obtained by
-00026900: 2061 6464 696e 6720 696e 6469 6365 7320   adding indices 
-00026910: 2870 726f 7669 6465 6420 696e 2069 6e64  (provided in ind
-00026920: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
-00026930: 6e61 6d65 206f 7220 696e 2061 2062 7566  name or in a buf
-00026940: 6665 7229 2074 6f20 7468 650a 2020 2020  fer) to the.    
-00026950: 2020 2020 6375 7272 656e 7420 4461 7461      current Data
-00026960: 7365 742e 0a20 2020 2020 2020 2022 2222  set..        """
-00026970: 0a0a 2020 2020 2020 2020 6966 2069 6e64  ..        if ind
-00026980: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
-00026990: 6e61 6d65 2069 7320 4e6f 6e65 2061 6e64  name is None and
-000269a0: 2069 6e64 6963 6573 5f62 7566 6665 7220   indices_buffer 
-000269b0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000269c0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-000269d0: 4572 726f 7228 2241 7420 6c65 6173 7420  Error("At least 
-000269e0: 6f6e 6520 6f66 2069 6e64 6963 6573 5f63  one of indices_c
-000269f0: 6163 6865 5f66 696c 655f 6e61 6d65 206f  ache_file_name o
-00026a00: 7220 696e 6469 6365 735f 6275 6666 6572  r indices_buffer
-00026a10: 206d 7573 7420 6265 2070 726f 7669 6465   must be provide
-00026a20: 642e 2229 0a0a 2020 2020 2020 2020 6966  d.")..        if
-00026a30: 2066 696e 6765 7270 7269 6e74 2069 7320   fingerprint is 
-00026a40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00026a50: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00026a60: 6f72 2822 706c 6561 7365 2073 7065 6369  or("please speci
-00026a70: 6679 2061 2066 696e 6765 7270 7269 6e74  fy a fingerprint
-00026a80: 2066 6f72 2074 6865 2064 6174 6173 6574   for the dataset
-00026a90: 2077 6974 6820 696e 6469 6365 7322 290a   with indices").
-00026aa0: 0a20 2020 2020 2020 2069 6620 696e 6469  .        if indi
-00026ab0: 6365 735f 6361 6368 655f 6669 6c65 5f6e  ces_cache_file_n
-00026ac0: 616d 6520 6973 206e 6f74 204e 6f6e 653a  ame is not None:
-00026ad0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-00026ae0: 6963 6573 5f74 6162 6c65 203d 204d 656d  ices_table = Mem
-00026af0: 6f72 794d 6170 7065 6454 6162 6c65 2e66  oryMappedTable.f
-00026b00: 726f 6d5f 6669 6c65 2869 6e64 6963 6573  rom_file(indices
-00026b10: 5f63 6163 6865 5f66 696c 655f 6e61 6d65  _cache_file_name
-00026b20: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00026b30: 2020 2020 2020 2020 2020 2020 696e 6469              indi
-00026b40: 6365 735f 7461 626c 6520 3d20 496e 4d65  ces_table = InMe
-00026b50: 6d6f 7279 5461 626c 652e 6672 6f6d 5f62  moryTable.from_b
-00026b60: 7566 6665 7228 696e 6469 6365 735f 6275  uffer(indices_bu
-00026b70: 6666 6572 290a 0a20 2020 2020 2020 2023  ffer)..        #
-00026b80: 2052 6574 7572 6e20 6e65 7720 4461 7461   Return new Data
-00026b90: 7365 7420 6f62 6a65 6374 0a20 2020 2020  set object.     
-00026ba0: 2020 2023 2064 6f6e 2774 2066 6f72 6765     # don't forge
-00026bb0: 7420 746f 2063 6f70 7920 7468 6520 6f62  t to copy the ob
-00026bc0: 6a65 6374 730a 2020 2020 2020 2020 7265  jects.        re
-00026bd0: 7475 726e 2044 6174 6173 6574 280a 2020  turn Dataset(.  
-00026be0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00026bf0: 6461 7461 2c0a 2020 2020 2020 2020 2020  data,.          
-00026c00: 2020 696e 666f 3d73 656c 662e 696e 666f    info=self.info
-00026c10: 2e63 6f70 7928 292c 0a20 2020 2020 2020  .copy(),.       
-00026c20: 2020 2020 2073 706c 6974 3d73 656c 662e       split=self.
-00026c30: 7370 6c69 742c 0a20 2020 2020 2020 2020  split,.         
-00026c40: 2020 2069 6e64 6963 6573 5f74 6162 6c65     indices_table
-00026c50: 3d69 6e64 6963 6573 5f74 6162 6c65 2c0a  =indices_table,.
-00026c60: 2020 2020 2020 2020 2020 2020 6669 6e67              fing
-00026c70: 6572 7072 696e 743d 6669 6e67 6572 7072  erprint=fingerpr
-00026c80: 696e 742c 0a20 2020 2020 2020 2029 0a0a  int,.        )..
-00026c90: 2020 2020 4074 7261 6e73 6d69 745f 666f      @transmit_fo
-00026ca0: 726d 6174 0a20 2020 2040 6669 6e67 6572  rmat.    @finger
-00026cb0: 7072 696e 745f 7472 616e 7366 6f72 6d28  print_transform(
-00026cc0: 696e 706c 6163 653d 4661 6c73 652c 2069  inplace=False, i
-00026cd0: 676e 6f72 655f 6b77 6172 6773 3d5b 2269  gnore_kwargs=["i
-00026ce0: 6e64 6963 6573 5f63 6163 6865 5f66 696c  ndices_cache_fil
-00026cf0: 655f 6e61 6d65 225d 290a 2020 2020 6465  e_name"]).    de
-00026d00: 6620 7365 6c65 6374 280a 2020 2020 2020  f select(.      
-00026d10: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00026d20: 696e 6469 6365 733a 2049 7465 7261 626c  indices: Iterabl
-00026d30: 652c 0a20 2020 2020 2020 206b 6565 705f  e,.        keep_
-00026d40: 696e 5f6d 656d 6f72 793a 2062 6f6f 6c20  in_memory: bool 
-00026d50: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-00026d60: 2069 6e64 6963 6573 5f63 6163 6865 5f66   indices_cache_f
-00026d70: 696c 655f 6e61 6d65 3a20 4f70 7469 6f6e  ile_name: Option
-00026d80: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-00026d90: 2020 2020 2020 2020 7772 6974 6572 5f62          writer_b
-00026da0: 6174 6368 5f73 697a 653a 204f 7074 696f  atch_size: Optio
-00026db0: 6e61 6c5b 696e 745d 203d 2031 3030 302c  nal[int] = 1000,
-00026dc0: 0a20 2020 2020 2020 206e 6577 5f66 696e  .        new_fin
-00026dd0: 6765 7270 7269 6e74 3a20 4f70 7469 6f6e  gerprint: Option
-00026de0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-00026df0: 2020 2020 2920 2d3e 2022 4461 7461 7365      ) -> "Datase
-00026e00: 7422 3a0a 2020 2020 2020 2020 2222 2243  t":.        """C
-00026e10: 7265 6174 6520 6120 6e65 7720 6461 7461  reate a new data
-00026e20: 7365 7420 7769 7468 2072 6f77 7320 7365  set with rows se
-00026e30: 6c65 6374 6564 2066 6f6c 6c6f 7769 6e67  lected following
-00026e40: 2074 6865 206c 6973 742f 6172 7261 7920   the list/array 
-00026e50: 6f66 2069 6e64 6963 6573 2e0a 0a20 2020  of indices...   
-00026e60: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00026e70: 2020 2020 2020 2069 6e64 6963 6573 2028         indices (
-00026e80: 6072 616e 6765 602c 2060 6c69 7374 602c  `range`, `list`,
-00026e90: 2060 6974 6572 6162 6c65 602c 2060 6e64   `iterable`, `nd
-00026ea0: 6172 7261 7960 206f 7220 6053 6572 6965  array` or `Serie
-00026eb0: 7360 293a 0a20 2020 2020 2020 2020 2020  s`):.           
-00026ec0: 2020 2020 2052 616e 6765 2c20 6c69 7374       Range, list
-00026ed0: 206f 7220 3144 2d61 7272 6179 206f 6620   or 1D-array of 
-00026ee0: 696e 7465 6765 7220 696e 6469 6365 7320  integer indices 
-00026ef0: 666f 7220 696e 6465 7869 6e67 2e0a 2020  for indexing..  
-00026f00: 2020 2020 2020 2020 2020 2020 2020 4966                If
-00026f10: 2074 6865 2069 6e64 6963 6573 2063 6f72   the indices cor
-00026f20: 7265 7370 6f6e 6420 746f 2061 2063 6f6e  respond to a con
-00026f30: 7469 6775 6f75 7320 7261 6e67 652c 2074  tiguous range, t
-00026f40: 6865 2041 7272 6f77 2074 6162 6c65 2069  he Arrow table i
-00026f50: 7320 7369 6d70 6c79 2073 6c69 6365 642e  s simply sliced.
-00026f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026f70: 2048 6f77 6576 6572 2070 6173 7369 6e67   However passing
-00026f80: 2061 206c 6973 7420 6f66 2069 6e64 6963   a list of indic
-00026f90: 6573 2074 6861 7420 6172 6520 6e6f 7420  es that are not 
-00026fa0: 636f 6e74 6967 756f 7573 2063 7265 6174  contiguous creat
-00026fb0: 6573 2069 6e64 6963 6573 206d 6170 7069  es indices mappi
-00026fc0: 6e67 2c20 7768 6963 6820 6973 206d 7563  ng, which is muc
-00026fd0: 6820 6c65 7373 2065 6666 6963 6965 6e74  h less efficient
-00026fe0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00026ff0: 2020 6275 7420 7374 696c 6c20 6661 7374    but still fast
-00027000: 6572 2074 6861 6e20 7265 6372 6561 7469  er than recreati
-00027010: 6e67 2061 6e20 4172 726f 7720 7461 626c  ng an Arrow tabl
-00027020: 6520 6d61 6465 206f 6620 7468 6520 7265  e made of the re
-00027030: 7175 6573 7465 6420 726f 7773 2e0a 2020  quested rows..  
-00027040: 2020 2020 2020 2020 2020 6b65 6570 5f69            keep_i
-00027050: 6e5f 6d65 6d6f 7279 2028 6062 6f6f 6c60  n_memory (`bool`
-00027060: 2c20 6465 6661 756c 7473 2074 6f20 6046  , defaults to `F
-00027070: 616c 7365 6029 3a0a 2020 2020 2020 2020  alse`):.        
-00027080: 2020 2020 2020 2020 4b65 6570 2074 6865          Keep the
-00027090: 2069 6e64 6963 6573 206d 6170 7069 6e67   indices mapping
-000270a0: 2069 6e20 6d65 6d6f 7279 2069 6e73 7465   in memory inste
-000270b0: 6164 206f 6620 7772 6974 696e 6720 6974  ad of writing it
-000270c0: 2074 6f20 6120 6361 6368 6520 6669 6c65   to a cache file
-000270d0: 2e0a 2020 2020 2020 2020 2020 2020 696e  ..            in
-000270e0: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
-000270f0: 5f6e 616d 6520 2860 7374 7260 2c20 2a6f  _name (`str`, *o
-00027100: 7074 696f 6e61 6c2a 2c20 6465 6661 756c  ptional*, defaul
-00027110: 7473 2074 6f20 604e 6f6e 6560 293a 0a20  ts to `None`):. 
-00027120: 2020 2020 2020 2020 2020 2020 2020 2050                 P
-00027130: 726f 7669 6465 2074 6865 206e 616d 6520  rovide the name 
-00027140: 6f66 2061 2070 6174 6820 666f 7220 7468  of a path for th
-00027150: 6520 6361 6368 6520 6669 6c65 2e20 4974  e cache file. It
-00027160: 2069 7320 7573 6564 2074 6f20 7374 6f72   is used to stor
-00027170: 6520 7468 650a 2020 2020 2020 2020 2020  e the.          
-00027180: 2020 2020 2020 696e 6469 6365 7320 6d61        indices ma
-00027190: 7070 696e 6720 696e 7374 6561 6420 6f66  pping instead of
-000271a0: 2074 6865 2061 7574 6f6d 6174 6963 616c   the automatical
-000271b0: 6c79 2067 656e 6572 6174 6564 2063 6163  ly generated cac
-000271c0: 6865 2066 696c 6520 6e61 6d65 2e0a 2020  he file name..  
-000271d0: 2020 2020 2020 2020 2020 7772 6974 6572            writer
-000271e0: 5f62 6174 6368 5f73 697a 6520 2860 696e  _batch_size (`in
-000271f0: 7460 2c20 6465 6661 756c 7473 2074 6f20  t`, defaults to 
-00027200: 6031 3030 3060 293a 0a20 2020 2020 2020  `1000`):.       
-00027210: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
-00027220: 6f66 2072 6f77 7320 7065 7220 7772 6974  of rows per writ
-00027230: 6520 6f70 6572 6174 696f 6e20 666f 7220  e operation for 
-00027240: 7468 6520 6361 6368 6520 6669 6c65 2077  the cache file w
-00027250: 7269 7465 722e 0a20 2020 2020 2020 2020  riter..         
-00027260: 2020 2020 2020 2054 6869 7320 7661 6c75         This valu
-00027270: 6520 6973 2061 2067 6f6f 6420 7472 6164  e is a good trad
-00027280: 652d 6f66 6620 6265 7477 6565 6e20 6d65  e-off between me
-00027290: 6d6f 7279 2075 7361 6765 2064 7572 696e  mory usage durin
-000272a0: 6720 7468 6520 7072 6f63 6573 7369 6e67  g the processing
-000272b0: 2c20 616e 6420 7072 6f63 6573 7369 6e67  , and processing
-000272c0: 2073 7065 6564 2e0a 2020 2020 2020 2020   speed..        
-000272d0: 2020 2020 2020 2020 4869 6768 6572 2076          Higher v
-000272e0: 616c 7565 206d 616b 6573 2074 6865 2070  alue makes the p
-000272f0: 726f 6365 7373 696e 6720 646f 2066 6577  rocessing do few
-00027300: 6572 206c 6f6f 6b75 7073 2c20 6c6f 7765  er lookups, lowe
-00027310: 7220 7661 6c75 6520 636f 6e73 756d 6520  r value consume 
-00027320: 6c65 7373 2074 656d 706f 7261 7279 206d  less temporary m
-00027330: 656d 6f72 7920 7768 696c 6520 7275 6e6e  emory while runn
-00027340: 696e 6720 606d 6170 602e 0a20 2020 2020  ing `map`..     
-00027350: 2020 2020 2020 206e 6577 5f66 696e 6765         new_finge
-00027360: 7270 7269 6e74 2028 6073 7472 602c 202a  rprint (`str`, *
-00027370: 6f70 7469 6f6e 616c 2a2c 2064 6566 6175  optional*, defau
-00027380: 6c74 7320 746f 2060 4e6f 6e65 6029 3a0a  lts to `None`):.
-00027390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000273a0: 5468 6520 6e65 7720 6669 6e67 6572 7072  The new fingerpr
-000273b0: 696e 7420 6f66 2074 6865 2064 6174 6173  int of the datas
-000273c0: 6574 2061 6674 6572 2074 7261 6e73 666f  et after transfo
-000273d0: 726d 2e0a 2020 2020 2020 2020 2020 2020  rm..            
-000273e0: 2020 2020 4966 2060 4e6f 6e65 602c 2074      If `None`, t
-000273f0: 6865 206e 6577 2066 696e 6765 7270 7269  he new fingerpri
-00027400: 6e74 2069 7320 636f 6d70 7574 6564 2075  nt is computed u
-00027410: 7369 6e67 2061 2068 6173 6820 6f66 2074  sing a hash of t
-00027420: 6865 2070 7265 7669 6f75 7320 6669 6e67  he previous fing
-00027430: 6572 7072 696e 742c 2061 6e64 2074 6865  erprint, and the
-00027440: 2074 7261 6e73 666f 726d 2061 7267 756d   transform argum
-00027450: 656e 7473 2e0a 0a20 2020 2020 2020 2045  ents...        E
-00027460: 7861 6d70 6c65 3a0a 0a20 2020 2020 2020  xample:..       
-00027470: 2060 6060 7079 0a20 2020 2020 2020 203e   ```py.        >
-00027480: 3e3e 2066 726f 6d20 6461 7461 7365 7473  >> from datasets
-00027490: 2069 6d70 6f72 7420 6c6f 6164 5f64 6174   import load_dat
-000274a0: 6173 6574 0a20 2020 2020 2020 203e 3e3e  aset.        >>>
-000274b0: 2064 7320 3d20 6c6f 6164 5f64 6174 6173   ds = load_datas
-000274c0: 6574 2822 726f 7474 656e 5f74 6f6d 6174  et("rotten_tomat
-000274d0: 6f65 7322 2c20 7370 6c69 743d 2276 616c  oes", split="val
-000274e0: 6964 6174 696f 6e22 290a 2020 2020 2020  idation").      
-000274f0: 2020 3e3e 3e20 6473 2e73 656c 6563 7428    >>> ds.select(
-00027500: 7261 6e67 6528 3429 290a 2020 2020 2020  range(4)).      
-00027510: 2020 4461 7461 7365 7428 7b0a 2020 2020    Dataset({.    
-00027520: 2020 2020 2020 2020 6665 6174 7572 6573          features
-00027530: 3a20 5b27 7465 7874 272c 2027 6c61 6265  : ['text', 'labe
-00027540: 6c27 5d2c 0a20 2020 2020 2020 2020 2020  l'],.           
-00027550: 206e 756d 5f72 6f77 733a 2034 0a20 2020   num_rows: 4.   
-00027560: 2020 2020 207d 290a 2020 2020 2020 2020       }).        
-00027570: 6060 600a 2020 2020 2020 2020 2222 220a  ```.        """.
-00027580: 2020 2020 2020 2020 6966 206b 6565 705f          if keep_
-00027590: 696e 5f6d 656d 6f72 7920 616e 6420 696e  in_memory and in
-000275a0: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
-000275b0: 5f6e 616d 6520 6973 206e 6f74 204e 6f6e  _name is not Non
-000275c0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-000275d0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000275e0: 2250 6c65 6173 6520 7573 6520 6569 7468  "Please use eith
-000275f0: 6572 2060 6b65 6570 5f69 6e5f 6d65 6d6f  er `keep_in_memo
-00027600: 7279 6020 6f72 2060 696e 6469 6365 735f  ry` or `indices_
-00027610: 6361 6368 655f 6669 6c65 5f6e 616d 6560  cache_file_name`
-00027620: 2062 7574 206e 6f74 2062 6f74 682e 2229   but not both.")
-00027630: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-00027640: 2873 656c 662e 6c69 7374 5f69 6e64 6578  (self.list_index
-00027650: 6573 2829 2920 3e20 303a 0a20 2020 2020  es()) > 0:.     
-00027660: 2020 2020 2020 2072 6169 7365 2044 6174         raise Dat
-00027670: 6173 6574 5472 616e 7366 6f72 6d61 7469  asetTransformati
-00027680: 6f6e 4e6f 7441 6c6c 6f77 6564 4572 726f  onNotAllowedErro
-00027690: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-000276a0: 2020 2022 5573 696e 6720 602e 7365 6c65     "Using `.sele
-000276b0: 6374 6020 6f6e 2061 2064 6174 6173 6574  ct` on a dataset
-000276c0: 2077 6974 6820 6174 7461 6368 6564 2069   with attached i
-000276d0: 6e64 6578 6573 2069 7320 6e6f 7420 616c  ndexes is not al
-000276e0: 6c6f 7765 642e 2059 6f75 2063 616e 2066  lowed. You can f
-000276f0: 6972 7374 2072 756e 2060 2e64 726f 705f  irst run `.drop_
-00027700: 696e 6465 7828 2920 746f 2072 656d 6f76  index() to remov
-00027710: 6520 796f 7572 2069 6e64 6578 2061 6e64  e your index and
-00027720: 2074 6865 6e20 7265 2d61 6464 2069 742e   then re-add it.
-00027730: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00027740: 0a20 2020 2020 2020 2023 2049 6620 7468  .        # If th
-00027750: 6520 6172 7261 7920 6973 2065 6d70 7479  e array is empty
-00027760: 2077 6520 646f 206e 6f74 6869 6e67 0a20   we do nothing. 
-00027770: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-00027780: 6c66 2920 3d3d 2030 3a0a 2020 2020 2020  lf) == 0:.      
-00027790: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000277a0: 660a 0a20 2020 2020 2020 2023 2043 6f6e  f..        # Con
-000277b0: 7665 7274 2067 656e 6572 6174 6f72 206f  vert generator o
-000277c0: 626a 6563 7473 2074 6f20 6c69 7374 730a  bjects to lists.
-000277d0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000277e0: 7461 6e63 6528 696e 6469 6365 732c 2049  tance(indices, I
-000277f0: 7465 7261 746f 7229 3a0a 2020 2020 2020  terator):.      
-00027800: 2020 2020 2020 696e 6469 6365 7320 3d20        indices = 
-00027810: 6c69 7374 2869 6e64 6963 6573 290a 0a20  list(indices).. 
-00027820: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
-00027830: 696e 6469 6365 7320 6172 6520 636f 6e74  indices are cont
-00027840: 6967 756f 7573 2c20 7369 6d70 6c79 2073  iguous, simply s
-00027850: 6c69 6365 2074 6865 2061 7272 6f77 2074  lice the arrow t
-00027860: 6162 6c65 0a20 2020 2020 2020 2069 6620  able.        if 
-00027870: 6973 696e 7374 616e 6365 2869 6e64 6963  isinstance(indic
-00027880: 6573 2c20 7261 6e67 6529 3a0a 2020 2020  es, range):.    
-00027890: 2020 2020 2020 2020 6966 205f 6973 5f72          if _is_r
-000278a0: 616e 6765 5f63 6f6e 7469 6775 6f75 7328  ange_contiguous(
-000278b0: 696e 6469 6365 7329 2061 6e64 2069 6e64  indices) and ind
-000278c0: 6963 6573 2e73 7461 7274 203e 3d20 303a  ices.start >= 0:
-000278d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000278e0: 2073 7461 7274 2c20 6c65 6e67 7468 203d   start, length =
-000278f0: 2069 6e64 6963 6573 2e73 7461 7274 2c20   indices.start, 
-00027900: 696e 6469 6365 732e 7374 6f70 202d 2069  indices.stop - i
-00027910: 6e64 6963 6573 2e73 7461 7274 0a20 2020  ndices.start.   
-00027920: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00027930: 7572 6e20 7365 6c66 2e5f 7365 6c65 6374  urn self._select
-00027940: 5f63 6f6e 7469 6775 6f75 7328 7374 6172  _contiguous(star
-00027950: 742c 206c 656e 6774 682c 206e 6577 5f66  t, length, new_f
-00027960: 696e 6765 7270 7269 6e74 3d6e 6577 5f66  ingerprint=new_f
-00027970: 696e 6765 7270 7269 6e74 290a 2020 2020  ingerprint).    
-00027980: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00027990: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000279a0: 2020 2020 2020 2020 2020 2073 7461 7274             start
-000279b0: 203d 206e 6578 7428 6974 6572 2869 6e64   = next(iter(ind
-000279c0: 6963 6573 2929 0a20 2020 2020 2020 2020  ices)).         
-000279d0: 2020 2065 7863 6570 7420 5374 6f70 4974     except StopIt
-000279e0: 6572 6174 696f 6e3a 0a20 2020 2020 2020  eration:.       
-000279f0: 2020 2020 2020 2020 2023 2069 6620 6069           # if `i
-00027a00: 6e64 6963 6573 6020 6973 2061 6e20 656d  ndices` is an em
-00027a10: 7074 7920 6974 6572 6162 6c65 2c20 7765  pty iterable, we
-00027a20: 2072 6574 7572 6e20 616e 2065 6d70 7479   return an empty
-00027a30: 2064 6174 6173 6574 0a20 2020 2020 2020   dataset.       
-00027a40: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00027a50: 7365 6c66 2e5f 7365 6c65 6374 5f63 6f6e  self._select_con
-00027a60: 7469 6775 6f75 7328 302c 2030 2c20 6e65  tiguous(0, 0, ne
-00027a70: 775f 6669 6e67 6572 7072 696e 743d 6e65  w_fingerprint=ne
-00027a80: 775f 6669 6e67 6572 7072 696e 7429 0a20  w_fingerprint). 
-00027a90: 2020 2020 2020 2020 2020 2069 6620 7374             if st
-00027aa0: 6172 7420 3e3d 2030 3a0a 2020 2020 2020  art >= 0:.      
-00027ab0: 2020 2020 2020 2020 2020 636f 756e 7465            counte
-00027ac0: 725f 6672 6f6d 5f73 7461 7274 203d 2069  r_from_start = i
-00027ad0: 7465 7274 6f6f 6c73 2e63 6f75 6e74 2873  tertools.count(s
-00027ae0: 7461 7274 3d73 7461 7274 290a 2020 2020  tart=start).    
-00027af0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00027b00: 6c6c 2869 203d 3d20 6a20 666f 7220 692c  ll(i == j for i,
-00027b10: 206a 2069 6e20 7a69 7028 696e 6469 6365   j in zip(indice
-00027b20: 732c 2063 6f75 6e74 6572 5f66 726f 6d5f  s, counter_from_
-00027b30: 7374 6172 7429 293a 0a20 2020 2020 2020  start)):.       
-00027b40: 2020 2020 2020 2020 2020 2020 206c 656e               len
-00027b50: 6774 6820 3d20 6e65 7874 2863 6f75 6e74  gth = next(count
-00027b60: 6572 5f66 726f 6d5f 7374 6172 7429 202d  er_from_start) -
-00027b70: 2073 7461 7274 0a20 2020 2020 2020 2020   start.         
-00027b80: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00027b90: 6e20 7365 6c66 2e5f 7365 6c65 6374 5f63  n self._select_c
-00027ba0: 6f6e 7469 6775 6f75 7328 7374 6172 742c  ontiguous(start,
-00027bb0: 206c 656e 6774 682c 206e 6577 5f66 696e   length, new_fin
-00027bc0: 6765 7270 7269 6e74 3d6e 6577 5f66 696e  gerprint=new_fin
-00027bd0: 6765 7270 7269 6e74 290a 0a20 2020 2020  gerprint)..     
-00027be0: 2020 2023 2049 6620 6e6f 7420 636f 6e74     # If not cont
-00027bf0: 6967 756f 7573 2c20 7765 206e 6565 6420  iguous, we need 
-00027c00: 746f 2063 7265 6174 6520 6120 6e65 7720  to create a new 
-00027c10: 696e 6469 6365 7320 6d61 7070 696e 670a  indices mapping.
-00027c20: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00027c30: 656c 662e 5f73 656c 6563 745f 7769 7468  elf._select_with
-00027c40: 5f69 6e64 6963 6573 5f6d 6170 7069 6e67  _indices_mapping
-00027c50: 280a 2020 2020 2020 2020 2020 2020 696e  (.            in
-00027c60: 6469 6365 732c 0a20 2020 2020 2020 2020  dices,.         
-00027c70: 2020 206b 6565 705f 696e 5f6d 656d 6f72     keep_in_memor
-00027c80: 793d 6b65 6570 5f69 6e5f 6d65 6d6f 7279  y=keep_in_memory
-00027c90: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
-00027ca0: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
-00027cb0: 5f6e 616d 653d 696e 6469 6365 735f 6361  _name=indices_ca
-00027cc0: 6368 655f 6669 6c65 5f6e 616d 652c 0a20  che_file_name,. 
-00027cd0: 2020 2020 2020 2020 2020 2077 7269 7465             write
-00027ce0: 725f 6261 7463 685f 7369 7a65 3d77 7269  r_batch_size=wri
-00027cf0: 7465 725f 6261 7463 685f 7369 7a65 2c0a  ter_batch_size,.
-00027d00: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00027d10: 6669 6e67 6572 7072 696e 743d 6e65 775f  fingerprint=new_
-00027d20: 6669 6e67 6572 7072 696e 742c 0a20 2020  fingerprint,.   
-00027d30: 2020 2020 2029 0a0a 2020 2020 4074 7261       )..    @tra
-00027d40: 6e73 6d69 745f 666f 726d 6174 0a20 2020  nsmit_format.   
-00027d50: 2040 6669 6e67 6572 7072 696e 745f 7472   @fingerprint_tr
-00027d60: 616e 7366 6f72 6d28 696e 706c 6163 653d  ansform(inplace=
-00027d70: 4661 6c73 6529 0a20 2020 2064 6566 205f  False).    def _
-00027d80: 7365 6c65 6374 5f63 6f6e 7469 6775 6f75  select_contiguou
-00027d90: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-00027da0: 0a20 2020 2020 2020 2073 7461 7274 3a20  .        start: 
-00027db0: 696e 742c 0a20 2020 2020 2020 206c 656e  int,.        len
-00027dc0: 6774 683a 2069 6e74 2c0a 2020 2020 2020  gth: int,.      
-00027dd0: 2020 6e65 775f 6669 6e67 6572 7072 696e    new_fingerprin
-00027de0: 743a 204f 7074 696f 6e61 6c5b 7374 725d  t: Optional[str]
-00027df0: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-00027e00: 3e20 2244 6174 6173 6574 223a 0a20 2020  > "Dataset":.   
-00027e10: 2020 2020 2022 2222 4372 6561 7465 2061       """Create a
-00027e20: 206e 6577 2064 6174 6173 6574 2077 6974   new dataset wit
-00027e30: 6820 726f 7773 2066 726f 6d20 6120 636f  h rows from a co
-00027e40: 6e74 6967 756f 7573 2073 6c69 6365 206f  ntiguous slice o
-00027e50: 6620 6461 7461 2e0a 2020 2020 2020 2020  f data..        
-00027e60: 5468 6520 736c 6963 6520 6973 2064 6566  The slice is def
-00027e70: 696e 6564 2062 7920 7468 6174 2073 7461  ined by that sta
-00027e80: 7274 2069 6e64 6578 2061 6e64 2069 7473  rt index and its
-00027e90: 206c 656e 6774 682e 0a0a 2020 2020 2020   length...      
-00027ea0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00027eb0: 2020 2020 7374 6172 7420 2860 696e 7460      start (`int`
-00027ec0: 293a 2073 7461 7274 2069 6e64 6578 2e0a  ): start index..
-00027ed0: 2020 2020 2020 2020 2020 2020 6c65 6e67              leng
-00027ee0: 7468 2028 6069 6e74 6029 3a20 6c65 6e67  th (`int`): leng
-00027ef0: 7468 206f 6620 7468 6520 736c 6963 6520  th of the slice 
-00027f00: 746f 2073 656c 6563 742e 0a20 2020 2020  to select..     
-00027f10: 2020 2020 2020 206e 6577 5f66 696e 6765         new_finge
-00027f20: 7270 7269 6e74 2028 6073 7472 602c 206f  rprint (`str`, o
-00027f30: 7074 696f 6e61 6c2c 2064 6566 6175 6c74  ptional, default
-00027f40: 2060 4e6f 6e65 6029 3a20 7468 6520 6e65   `None`): the ne
-00027f50: 7720 6669 6e67 6572 7072 696e 7420 6f66  w fingerprint of
-00027f60: 2074 6865 2064 6174 6173 6574 2061 6674   the dataset aft
-00027f70: 6572 2074 7261 6e73 666f 726d 2e0a 2020  er transform..  
-00027f80: 2020 2020 2020 2020 2020 2020 2020 4966                If
-00027f90: 2060 4e6f 6e65 602c 2074 6865 206e 6577   `None`, the new
-00027fa0: 2066 696e 6765 7270 7269 6e74 2069 7320   fingerprint is 
-00027fb0: 636f 6d70 7574 6564 2075 7369 6e67 2061  computed using a
-00027fc0: 2068 6173 6820 6f66 2074 6865 2070 7265   hash of the pre
-00027fd0: 7669 6f75 7320 6669 6e67 6572 7072 696e  vious fingerprin
-00027fe0: 742c 2061 6e64 2074 6865 2074 7261 6e73  t, and the trans
-00027ff0: 666f 726d 2061 7267 756d 656e 7473 0a0a  form arguments..
-00028000: 2020 2020 2020 2020 4578 616d 706c 653a          Example:
-00028010: 0a0a 2020 2020 2020 2020 6060 6070 790a  ..        ```py.
-00028020: 2020 2020 2020 2020 3e3e 3e20 6672 6f6d          >>> from
-00028030: 2064 6174 6173 6574 7320 696d 706f 7274   datasets import
-00028040: 206c 6f61 645f 6461 7461 7365 740a 2020   load_dataset.  
-00028050: 2020 2020 2020 3e3e 3e20 6473 203d 206c        >>> ds = l
-00028060: 6f61 645f 6461 7461 7365 7428 2272 6f74  oad_dataset("rot
-00028070: 7465 6e5f 746f 6d61 746f 6573 222c 2073  ten_tomatoes", s
-00028080: 706c 6974 3d22 7661 6c69 6461 7469 6f6e  plit="validation
-00028090: 2229 0a20 2020 2020 2020 203e 3e3e 2064  ").        >>> d
-000280a0: 732e 5f73 656c 6563 745f 636f 6e74 6967  s._select_contig
-000280b0: 756f 7573 2830 2c20 3429 0a20 2020 2020  uous(0, 4).     
-000280c0: 2020 2044 6174 6173 6574 287b 0a20 2020     Dataset({.   
-000280d0: 2020 2020 2020 2020 2066 6561 7475 7265           feature
-000280e0: 733a 205b 2774 6578 7427 2c20 276c 6162  s: ['text', 'lab
-000280f0: 656c 275d 2c0a 2020 2020 2020 2020 2020  el'],.          
-00028100: 2020 6e75 6d5f 726f 7773 3a20 340a 2020    num_rows: 4.  
-00028110: 2020 2020 2020 7d29 0a20 2020 2020 2020        }).       
-00028120: 2060 6060 0a20 2020 2020 2020 2022 2222   ```.        """
-00028130: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00028140: 7365 6c66 2e6c 6973 745f 696e 6465 7865  self.list_indexe
-00028150: 7328 2929 203e 2030 3a0a 2020 2020 2020  s()) > 0:.      
-00028160: 2020 2020 2020 7261 6973 6520 4461 7461        raise Data
-00028170: 7365 7454 7261 6e73 666f 726d 6174 696f  setTransformatio
-00028180: 6e4e 6f74 416c 6c6f 7765 6445 7272 6f72  nNotAllowedError
-00028190: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000281a0: 2020 2255 7369 6e67 2060 2e73 656c 6563    "Using `.selec
-000281b0: 7460 206f 6e20 6120 6461 7461 7365 7420  t` on a dataset 
-000281c0: 7769 7468 2061 7474 6163 6865 6420 696e  with attached in
-000281d0: 6465 7865 7320 6973 206e 6f74 2061 6c6c  dexes is not all
-000281e0: 6f77 6564 2e20 596f 7520 6361 6e20 6669  owed. You can fi
-000281f0: 7273 7420 7275 6e20 602e 6472 6f70 5f69  rst run `.drop_i
-00028200: 6e64 6578 2829 2074 6f20 7265 6d6f 7665  ndex() to remove
-00028210: 2079 6f75 7220 696e 6465 7820 616e 6420   your index and 
-00028220: 7468 656e 2072 652d 6164 6420 6974 2e22  then re-add it."
-00028230: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00028240: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
-00028250: 2061 7272 6179 2069 7320 656d 7074 7920   array is empty 
-00028260: 7765 2064 6f20 6e6f 7468 696e 670a 2020  we do nothing.  
-00028270: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
-00028280: 6629 203d 3d20 303a 0a20 2020 2020 2020  f) == 0:.       
-00028290: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000282a0: 0a0a 2020 2020 2020 2020 5f63 6865 636b  ..        _check
-000282b0: 5f76 616c 6964 5f69 6e64 6963 6573 5f76  _valid_indices_v
-000282c0: 616c 7565 2873 7461 7274 2c20 6c65 6e28  alue(start, len(
-000282d0: 7365 6c66 2929 0a20 2020 2020 2020 205f  self)).        _
-000282e0: 6368 6563 6b5f 7661 6c69 645f 696e 6469  check_valid_indi
-000282f0: 6365 735f 7661 6c75 6528 7374 6172 7420  ces_value(start 
-00028300: 2b20 6c65 6e67 7468 202d 2031 2c20 6c65  + length - 1, le
-00028310: 6e28 7365 6c66 2929 0a20 2020 2020 2020  n(self)).       
-00028320: 2069 6620 7365 6c66 2e5f 696e 6469 6365   if self._indice
-00028330: 7320 6973 204e 6f6e 6520 6f72 206c 656e  s is None or len
-00028340: 6774 6820 3d3d 2030 3a0a 2020 2020 2020  gth == 0:.      
-00028350: 2020 2020 2020 7265 7475 726e 2044 6174        return Dat
-00028360: 6173 6574 280a 2020 2020 2020 2020 2020  aset(.          
-00028370: 2020 2020 2020 7365 6c66 2e64 6174 612e        self.data.
-00028380: 736c 6963 6528 7374 6172 742c 206c 656e  slice(start, len
-00028390: 6774 6829 2c0a 2020 2020 2020 2020 2020  gth),.          
-000283a0: 2020 2020 2020 696e 666f 3d73 656c 662e        info=self.
-000283b0: 696e 666f 2e63 6f70 7928 292c 0a20 2020  info.copy(),.   
-000283c0: 2020 2020 2020 2020 2020 2020 2073 706c               spl
-000283d0: 6974 3d73 656c 662e 7370 6c69 742c 0a20  it=self.split,. 
-000283e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000283f0: 696e 6765 7270 7269 6e74 3d6e 6577 5f66  ingerprint=new_f
-00028400: 696e 6765 7270 7269 6e74 2c0a 2020 2020  ingerprint,.    
-00028410: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00028420: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00028430: 2020 2020 7265 7475 726e 2044 6174 6173      return Datas
-00028440: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
-00028450: 2020 2020 7365 6c66 2e64 6174 612c 0a20      self.data,. 
-00028460: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00028470: 6e66 6f3d 7365 6c66 2e69 6e66 6f2e 636f  nfo=self.info.co
-00028480: 7079 2829 2c0a 2020 2020 2020 2020 2020  py(),.          
-00028490: 2020 2020 2020 7370 6c69 743d 7365 6c66        split=self
-000284a0: 2e73 706c 6974 2c0a 2020 2020 2020 2020  .split,.        
-000284b0: 2020 2020 2020 2020 696e 6469 6365 735f          indices_
-000284c0: 7461 626c 653d 7365 6c66 2e5f 696e 6469  table=self._indi
-000284d0: 6365 732e 736c 6963 6528 7374 6172 742c  ces.slice(start,
-000284e0: 206c 656e 6774 6829 2c0a 2020 2020 2020   length),.      
-000284f0: 2020 2020 2020 2020 2020 6669 6e67 6572            finger
-00028500: 7072 696e 743d 6e65 775f 6669 6e67 6572  print=new_finger
-00028510: 7072 696e 742c 0a20 2020 2020 2020 2020  print,.         
-00028520: 2020 2029 0a0a 2020 2020 4074 7261 6e73     )..    @trans
-00028530: 6d69 745f 666f 726d 6174 0a20 2020 2040  mit_format.    @
-00028540: 6669 6e67 6572 7072 696e 745f 7472 616e  fingerprint_tran
-00028550: 7366 6f72 6d28 696e 706c 6163 653d 4661  sform(inplace=Fa
-00028560: 6c73 652c 2069 676e 6f72 655f 6b77 6172  lse, ignore_kwar
-00028570: 6773 3d5b 2269 6e64 6963 6573 5f63 6163  gs=["indices_cac
-00028580: 6865 5f66 696c 655f 6e61 6d65 225d 290a  he_file_name"]).
-00028590: 2020 2020 6465 6620 5f73 656c 6563 745f      def _select_
-000285a0: 7769 7468 5f69 6e64 6963 6573 5f6d 6170  with_indices_map
-000285b0: 7069 6e67 280a 2020 2020 2020 2020 7365  ping(.        se
-000285c0: 6c66 2c0a 2020 2020 2020 2020 696e 6469  lf,.        indi
-000285d0: 6365 733a 2049 7465 7261 626c 652c 0a20  ces: Iterable,. 
-000285e0: 2020 2020 2020 206b 6565 705f 696e 5f6d         keep_in_m
-000285f0: 656d 6f72 793a 2062 6f6f 6c20 3d20 4661  emory: bool = Fa
-00028600: 6c73 652c 0a20 2020 2020 2020 2069 6e64  lse,.        ind
-00028610: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
-00028620: 6e61 6d65 3a20 4f70 7469 6f6e 616c 5b73  name: Optional[s
-00028630: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-00028640: 2020 2020 7772 6974 6572 5f62 6174 6368      writer_batch
-00028650: 5f73 697a 653a 204f 7074 696f 6e61 6c5b  _size: Optional[
-00028660: 696e 745d 203d 2031 3030 302c 0a20 2020  int] = 1000,.   
-00028670: 2020 2020 206e 6577 5f66 696e 6765 7270       new_fingerp
-00028680: 7269 6e74 3a20 4f70 7469 6f6e 616c 5b73  rint: Optional[s
-00028690: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-000286a0: 2920 2d3e 2022 4461 7461 7365 7422 3a0a  ) -> "Dataset":.
-000286b0: 2020 2020 2020 2020 2222 2243 7265 6174          """Creat
-000286c0: 6520 6120 6e65 7720 6461 7461 7365 7420  e a new dataset 
-000286d0: 7769 7468 2072 6f77 7320 7365 6c65 6374  with rows select
-000286e0: 6564 2066 6f6c 6c6f 7769 6e67 2074 6865  ed following the
-000286f0: 206c 6973 742f 6172 7261 7920 6f66 2069   list/array of i
-00028700: 6e64 6963 6573 2e0a 2020 2020 2020 2020  ndices..        
-00028710: 5468 6520 6e65 7720 6461 7461 7365 7420  The new dataset 
-00028720: 6973 206d 6164 6520 6279 2063 7265 6174  is made by creat
-00028730: 696e 6720 6120 6e65 7720 696e 6469 6365  ing a new indice
-00028740: 7320 6d61 7070 696e 6720 6f6e 2074 6f70  s mapping on top
-00028750: 206f 6620 7468 6520 6d61 696e 2061 7272   of the main arr
-00028760: 6f77 2074 6162 6c65 2e0a 0a20 2020 2020  ow table...     
-00028770: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00028780: 2020 2020 2069 6e64 6963 6573 2028 7365       indices (se
-00028790: 7175 656e 6365 2c20 6974 6572 6162 6c65  quence, iterable
-000287a0: 2c20 7261 6e67 652c 206e 6461 7272 6179  , range, ndarray
-000287b0: 206f 7220 5365 7269 6573 293a 204c 6973   or Series): Lis
-000287c0: 7420 6f72 2031 442d 6172 7261 7920 6f66  t or 1D-array of
-000287d0: 2069 6e74 6567 6572 2069 6e64 6963 6573   integer indices
-000287e0: 2066 6f72 2069 6e64 6578 696e 672e 0a20   for indexing.. 
-000287f0: 2020 2020 2020 2020 2020 206b 6565 705f             keep_
-00028800: 696e 5f6d 656d 6f72 7920 2860 626f 6f6c  in_memory (`bool
-00028810: 602c 2064 6566 6175 6c74 2060 4661 6c73  `, default `Fals
-00028820: 6560 293a 204b 6565 7020 7468 6520 696e  e`): Keep the in
-00028830: 6469 6365 7320 6d61 7070 696e 6720 696e  dices mapping in
-00028840: 206d 656d 6f72 7920 696e 7374 6561 6420   memory instead 
-00028850: 6f66 2077 7269 7469 6e67 2069 7420 746f  of writing it to
-00028860: 2061 2063 6163 6865 2066 696c 652e 0a20   a cache file.. 
-00028870: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
-00028880: 6573 5f63 6163 6865 5f66 696c 655f 6e61  es_cache_file_na
-00028890: 6d65 2028 6073 7472 602c 206f 7074 696f  me (`str`, optio
-000288a0: 6e61 6c2c 2064 6566 6175 6c74 2060 4e6f  nal, default `No
-000288b0: 6e65 6029 3a20 5072 6f76 6964 6520 7468  ne`): Provide th
-000288c0: 6520 6e61 6d65 206f 6620 6120 7061 7468  e name of a path
-000288d0: 2066 6f72 2074 6865 2063 6163 6865 2066   for the cache f
-000288e0: 696c 652e 2049 7420 6973 2075 7365 6420  ile. It is used 
-000288f0: 746f 2073 746f 7265 2074 6865 0a20 2020  to store the.   
-00028900: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-00028910: 6963 6573 206d 6170 7069 6e67 2069 6e73  ices mapping ins
-00028920: 7465 6164 206f 6620 7468 6520 6175 746f  tead of the auto
-00028930: 6d61 7469 6361 6c6c 7920 6765 6e65 7261  matically genera
-00028940: 7465 6420 6361 6368 6520 6669 6c65 206e  ted cache file n
-00028950: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
-00028960: 2077 7269 7465 725f 6261 7463 685f 7369   writer_batch_si
-00028970: 7a65 2028 6069 6e74 602c 2064 6566 6175  ze (`int`, defau
-00028980: 6c74 2060 3130 3030 6029 3a20 4e75 6d62  lt `1000`): Numb
-00028990: 6572 206f 6620 726f 7773 2070 6572 2077  er of rows per w
-000289a0: 7269 7465 206f 7065 7261 7469 6f6e 2066  rite operation f
-000289b0: 6f72 2074 6865 2063 6163 6865 2066 696c  or the cache fil
-000289c0: 6520 7772 6974 6572 2e0a 2020 2020 2020  e writer..      
-000289d0: 2020 2020 2020 2020 2020 5468 6973 2076            This v
-000289e0: 616c 7565 2069 7320 6120 676f 6f64 2074  alue is a good t
-000289f0: 7261 6465 2d6f 6666 2062 6574 7765 656e  rade-off between
-00028a00: 206d 656d 6f72 7920 7573 6167 6520 6475   memory usage du
-00028a10: 7269 6e67 2074 6865 2070 726f 6365 7373  ring the process
-00028a20: 696e 672c 2061 6e64 2070 726f 6365 7373  ing, and process
-00028a30: 696e 6720 7370 6565 642e 0a20 2020 2020  ing speed..     
-00028a40: 2020 2020 2020 2020 2020 2048 6967 6865             Highe
-00028a50: 7220 7661 6c75 6520 6d61 6b65 7320 7468  r value makes th
-00028a60: 6520 7072 6f63 6573 7369 6e67 2064 6f20  e processing do 
-00028a70: 6665 7765 7220 6c6f 6f6b 7570 732c 206c  fewer lookups, l
-00028a80: 6f77 6572 2076 616c 7565 2063 6f6e 7375  ower value consu
-00028a90: 6d65 206c 6573 7320 7465 6d70 6f72 6172  me less temporar
-00028aa0: 7920 6d65 6d6f 7279 2077 6869 6c65 2072  y memory while r
-00028ab0: 756e 6e69 6e67 2060 2e6d 6170 2829 602e  unning `.map()`.
-00028ac0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00028ad0: 5f66 696e 6765 7270 7269 6e74 2028 6073  _fingerprint (`s
-00028ae0: 7472 602c 206f 7074 696f 6e61 6c2c 2064  tr`, optional, d
-00028af0: 6566 6175 6c74 2060 4e6f 6e65 6029 3a20  efault `None`): 
-00028b00: 7468 6520 6e65 7720 6669 6e67 6572 7072  the new fingerpr
-00028b10: 696e 7420 6f66 2074 6865 2064 6174 6173  int of the datas
-00028b20: 6574 2061 6674 6572 2074 7261 6e73 666f  et after transfo
-00028b30: 726d 2e0a 2020 2020 2020 2020 2020 2020  rm..            
-00028b40: 2020 2020 4966 2060 4e6f 6e65 602c 2074      If `None`, t
-00028b50: 6865 206e 6577 2066 696e 6765 7270 7269  he new fingerpri
-00028b60: 6e74 2069 7320 636f 6d70 7574 6564 2075  nt is computed u
-00028b70: 7369 6e67 2061 2068 6173 6820 6f66 2074  sing a hash of t
-00028b80: 6865 2070 7265 7669 6f75 7320 6669 6e67  he previous fing
-00028b90: 6572 7072 696e 742c 2061 6e64 2074 6865  erprint, and the
-00028ba0: 2074 7261 6e73 666f 726d 2061 7267 756d   transform argum
-00028bb0: 656e 7473 0a0a 2020 2020 2020 2020 4578  ents..        Ex
-00028bc0: 616d 706c 653a 0a0a 2020 2020 2020 2020  ample:..        
-00028bd0: 6060 6070 790a 2020 2020 2020 2020 3e3e  ```py.        >>
-00028be0: 3e20 6672 6f6d 2064 6174 6173 6574 7320  > from datasets 
-00028bf0: 696d 706f 7274 206c 6f61 645f 6461 7461  import load_data
-00028c00: 7365 740a 2020 2020 2020 2020 3e3e 3e20  set.        >>> 
-00028c10: 6473 203d 206c 6f61 645f 6461 7461 7365  ds = load_datase
-00028c20: 7428 2272 6f74 7465 6e5f 746f 6d61 746f  t("rotten_tomato
-00028c30: 6573 222c 2073 706c 6974 3d22 7661 6c69  es", split="vali
-00028c40: 6461 7469 6f6e 2229 0a20 2020 2020 2020  dation").       
-00028c50: 203e 3e3e 2064 732e 5f73 656c 6563 745f   >>> ds._select_
-00028c60: 7769 7468 5f69 6e64 6963 6573 5f6d 6170  with_indices_map
-00028c70: 7069 6e67 2872 616e 6765 2834 2929 0a20  ping(range(4)). 
-00028c80: 2020 2020 2020 2044 6174 6173 6574 287b         Dataset({
-00028c90: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
-00028ca0: 7475 7265 733a 205b 2774 6578 7427 2c20  tures: ['text', 
-00028cb0: 276c 6162 656c 275d 2c0a 2020 2020 2020  'label'],.      
-00028cc0: 2020 2020 2020 6e75 6d5f 726f 7773 3a20        num_rows: 
-00028cd0: 340a 2020 2020 2020 2020 7d29 0a20 2020  4.        }).   
-00028ce0: 2020 2020 2060 6060 0a20 2020 2020 2020       ```.       
-00028cf0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00028d00: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 2061  keep_in_memory a
-00028d10: 6e64 2069 6e64 6963 6573 5f63 6163 6865  nd indices_cache
-00028d20: 5f66 696c 655f 6e61 6d65 2069 7320 6e6f  _file_name is no
-00028d30: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00028d40: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00028d50: 7272 6f72 2822 506c 6561 7365 2075 7365  rror("Please use
-00028d60: 2065 6974 6865 7220 606b 6565 705f 696e   either `keep_in
-00028d70: 5f6d 656d 6f72 7960 206f 7220 6069 6e64  _memory` or `ind
-00028d80: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
-00028d90: 6e61 6d65 6020 6275 7420 6e6f 7420 626f  name` but not bo
-00028da0: 7468 2e22 290a 0a20 2020 2020 2020 2069  th.")..        i
-00028db0: 6620 6c65 6e28 7365 6c66 2e6c 6973 745f  f len(self.list_
-00028dc0: 696e 6465 7865 7328 2929 203e 2030 3a0a  indexes()) > 0:.
-00028dd0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00028de0: 6520 4461 7461 7365 7454 7261 6e73 666f  e DatasetTransfo
-00028df0: 726d 6174 696f 6e4e 6f74 416c 6c6f 7765  rmationNotAllowe
-00028e00: 6445 7272 6f72 280a 2020 2020 2020 2020  dError(.        
-00028e10: 2020 2020 2020 2020 2255 7369 6e67 2060          "Using `
-00028e20: 2e73 656c 6563 7460 206f 6e20 6120 6461  .select` on a da
-00028e30: 7461 7365 7420 7769 7468 2061 7474 6163  taset with attac
-00028e40: 6865 6420 696e 6465 7865 7320 6973 206e  hed indexes is n
-00028e50: 6f74 2061 6c6c 6f77 6564 2e20 596f 7520  ot allowed. You 
-00028e60: 6361 6e20 6669 7273 7420 7275 6e20 602e  can first run `.
-00028e70: 6472 6f70 5f69 6e64 6578 2829 2074 6f20  drop_index() to 
-00028e80: 7265 6d6f 7665 2079 6f75 7220 696e 6465  remove your inde
-00028e90: 7820 616e 6420 7468 656e 2072 652d 6164  x and then re-ad
-00028ea0: 6420 6974 2e22 0a20 2020 2020 2020 2020  d it.".         
-00028eb0: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00028ec0: 4966 2074 6865 2061 7272 6179 2069 7320  If the array is 
-00028ed0: 656d 7074 7920 7765 2064 6f20 6e6f 7468  empty we do noth
-00028ee0: 696e 670a 2020 2020 2020 2020 6966 206c  ing.        if l
-00028ef0: 656e 2873 656c 6629 203d 3d20 303a 0a20  en(self) == 0:. 
-00028f00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00028f10: 6e20 7365 6c66 0a0a 2020 2020 2020 2020  n self..        
-00028f20: 2320 5072 6570 6172 6520 7468 6520 7772  # Prepare the wr
-00028f30: 6974 6572 2066 6f72 206f 7572 2069 6e64  iter for our ind
-00028f40: 6963 6573 2061 7272 6f77 2074 6162 6c65  ices arrow table
-00028f50: 0a20 2020 2020 2020 2069 6620 6b65 6570  .        if keep
-00028f60: 5f69 6e5f 6d65 6d6f 7279 206f 7220 696e  _in_memory or in
-00028f70: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
-00028f80: 5f6e 616d 6520 6973 204e 6f6e 653a 0a20  _name is None:. 
-00028f90: 2020 2020 2020 2020 2020 2062 7566 5f77             buf_w
-00028fa0: 7269 7465 7220 3d20 7061 2e42 7566 6665  riter = pa.Buffe
-00028fb0: 724f 7574 7075 7453 7472 6561 6d28 290a  rOutputStream().
-00028fc0: 2020 2020 2020 2020 2020 2020 746d 705f              tmp_
-00028fd0: 6669 6c65 203d 204e 6f6e 650a 2020 2020  file = None.    
-00028fe0: 2020 2020 2020 2020 7772 6974 6572 203d          writer =
-00028ff0: 2041 7272 6f77 5772 6974 6572 280a 2020   ArrowWriter(.  
-00029000: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00029010: 7265 616d 3d62 7566 5f77 7269 7465 722c  ream=buf_writer,
-00029020: 2077 7269 7465 725f 6261 7463 685f 7369   writer_batch_si
-00029030: 7a65 3d77 7269 7465 725f 6261 7463 685f  ze=writer_batch_
-00029040: 7369 7a65 2c20 6669 6e67 6572 7072 696e  size, fingerprin
-00029050: 743d 6e65 775f 6669 6e67 6572 7072 696e  t=new_fingerprin
-00029060: 742c 2075 6e69 743d 2269 6e64 6963 6573  t, unit="indices
-00029070: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00029080: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00029090: 2020 2020 2020 2020 2020 6275 665f 7772            buf_wr
-000290a0: 6974 6572 203d 204e 6f6e 650a 2020 2020  iter = None.    
-000290b0: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-000290c0: 6e66 6f28 6622 4361 6368 696e 6720 696e  nfo(f"Caching in
-000290d0: 6469 6365 7320 6d61 7070 696e 6720 6174  dices mapping at
-000290e0: 207b 696e 6469 6365 735f 6361 6368 655f   {indices_cache_
-000290f0: 6669 6c65 5f6e 616d 657d 2229 0a20 2020  file_name}").   
-00029100: 2020 2020 2020 2020 2074 6d70 5f66 696c           tmp_fil
-00029110: 6520 3d20 7465 6d70 6669 6c65 2e4e 616d  e = tempfile.Nam
-00029120: 6564 5465 6d70 6f72 6172 7946 696c 6528  edTemporaryFile(
-00029130: 2277 6222 2c20 6469 723d 6f73 2e70 6174  "wb", dir=os.pat
-00029140: 682e 6469 726e 616d 6528 696e 6469 6365  h.dirname(indice
-00029150: 735f 6361 6368 655f 6669 6c65 5f6e 616d  s_cache_file_nam
-00029160: 6529 2c20 6465 6c65 7465 3d46 616c 7365  e), delete=False
-00029170: 290a 2020 2020 2020 2020 2020 2020 7772  ).            wr
-00029180: 6974 6572 203d 2041 7272 6f77 5772 6974  iter = ArrowWrit
-00029190: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
-000291a0: 2020 2020 7061 7468 3d74 6d70 5f66 696c      path=tmp_fil
-000291b0: 652e 6e61 6d65 2c20 7772 6974 6572 5f62  e.name, writer_b
-000291c0: 6174 6368 5f73 697a 653d 7772 6974 6572  atch_size=writer
-000291d0: 5f62 6174 6368 5f73 697a 652c 2066 696e  _batch_size, fin
-000291e0: 6765 7270 7269 6e74 3d6e 6577 5f66 696e  gerprint=new_fin
-000291f0: 6765 7270 7269 6e74 2c20 756e 6974 3d22  gerprint, unit="
-00029200: 696e 6469 6365 7322 0a20 2020 2020 2020  indices".       
-00029210: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00029220: 696e 6469 6365 7320 3d20 696e 6469 6365  indices = indice
-00029230: 7320 6966 2069 7369 6e73 7461 6e63 6528  s if isinstance(
-00029240: 696e 6469 6365 732c 206c 6973 7429 2065  indices, list) e
-00029250: 6c73 6520 6c69 7374 2869 6e64 6963 6573  lse list(indices
-00029260: 290a 0a20 2020 2020 2020 2073 697a 6520  )..        size 
-00029270: 3d20 6c65 6e28 7365 6c66 290a 2020 2020  = len(self).    
-00029280: 2020 2020 6966 2069 6e64 6963 6573 3a0a      if indices:.
-00029290: 2020 2020 2020 2020 2020 2020 5f63 6865              _che
-000292a0: 636b 5f76 616c 6964 5f69 6e64 6963 6573  ck_valid_indices
-000292b0: 5f76 616c 7565 2869 6e74 286d 6178 2869  _value(int(max(i
-000292c0: 6e64 6963 6573 2929 2c20 7369 7a65 3d73  ndices)), size=s
-000292d0: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-000292e0: 205f 6368 6563 6b5f 7661 6c69 645f 696e   _check_valid_in
-000292f0: 6469 6365 735f 7661 6c75 6528 696e 7428  dices_value(int(
-00029300: 6d69 6e28 696e 6469 6365 7329 292c 2073  min(indices)), s
-00029310: 697a 653d 7369 7a65 290a 2020 2020 2020  ize=size).      
-00029320: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00029330: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00029340: 5f73 656c 6563 745f 636f 6e74 6967 756f  _select_contiguo
-00029350: 7573 2830 2c20 302c 206e 6577 5f66 696e  us(0, 0, new_fin
-00029360: 6765 7270 7269 6e74 3d6e 6577 5f66 696e  gerprint=new_fin
-00029370: 6765 7270 7269 6e74 290a 0a20 2020 2020  gerprint)..     
-00029380: 2020 2069 6e64 6963 6573 5f61 7272 6179     indices_array
-00029390: 203d 2070 612e 6172 7261 7928 696e 6469   = pa.array(indi
-000293a0: 6365 732c 2074 7970 653d 7061 2e75 696e  ces, type=pa.uin
-000293b0: 7436 3428 2929 0a20 2020 2020 2020 2023  t64()).        #
-000293c0: 2043 6865 636b 2069 6620 7765 206e 6565   Check if we nee
-000293d0: 6420 746f 2063 6f6e 7665 7274 2069 6e64  d to convert ind
-000293e0: 6963 6573 0a20 2020 2020 2020 2069 6620  ices.        if 
-000293f0: 7365 6c66 2e5f 696e 6469 6365 7320 6973  self._indices is
-00029400: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00029410: 2020 2020 2020 2069 6e64 6963 6573 5f61         indices_a
-00029420: 7272 6179 203d 2073 656c 662e 5f69 6e64  rray = self._ind
-00029430: 6963 6573 2e63 6f6c 756d 6e28 3029 2e74  ices.column(0).t
-00029440: 616b 6528 696e 6469 6365 735f 6172 7261  ake(indices_arra
-00029450: 7929 0a0a 2020 2020 2020 2020 696e 6469  y)..        indi
-00029460: 6365 735f 7461 626c 6520 3d20 7061 2e54  ces_table = pa.T
-00029470: 6162 6c65 2e66 726f 6d5f 6172 7261 7973  able.from_arrays
-00029480: 285b 696e 6469 6365 735f 6172 7261 795d  ([indices_array]
-00029490: 2c20 6e61 6d65 733d 5b22 696e 6469 6365  , names=["indice
-000294a0: 7322 5d29 0a0a 2020 2020 2020 2020 7769  s"])..        wi
-000294b0: 7468 2077 7269 7465 723a 0a20 2020 2020  th writer:.     
-000294c0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-000294d0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
-000294e0: 6572 2e77 7269 7465 5f74 6162 6c65 2869  er.write_table(i
-000294f0: 6e64 6963 6573 5f74 6162 6c65 290a 2020  ndices_table).  
-00029500: 2020 2020 2020 2020 2020 2020 2020 7772                wr
-00029510: 6974 6572 2e66 696e 616c 697a 6528 2920  iter.finalize() 
-00029520: 2023 2063 6c6f 7365 5f73 7472 6561 6d3d   # close_stream=
-00029530: 626f 6f6c 2862 7566 5f77 7269 7465 7220  bool(buf_writer 
-00029540: 6973 204e 6f6e 6529 2920 2057 6520 6f6e  is None))  We on
-00029550: 6c79 2063 6c6f 7365 2069 6620 7765 2061  ly close if we a
-00029560: 7265 2077 7269 7469 6e67 2069 6e20 6120  re writing in a 
-00029570: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-00029580: 2065 7863 6570 7420 2845 7863 6570 7469   except (Excepti
-00029590: 6f6e 2c20 4b65 7962 6f61 7264 496e 7465  on, KeyboardInte
-000295a0: 7272 7570 7429 3a0a 2020 2020 2020 2020  rrupt):.        
-000295b0: 2020 2020 2020 2020 6966 2074 6d70 5f66          if tmp_f
-000295c0: 696c 6520 6973 206e 6f74 204e 6f6e 653a  ile is not None:
-000295d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000295e0: 2020 2020 2074 6d70 5f66 696c 652e 636c       tmp_file.cl
-000295f0: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
-00029600: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
-00029610: 7061 7468 2e65 7869 7374 7328 746d 705f  path.exists(tmp_
-00029620: 6669 6c65 2e6e 616d 6529 3a0a 2020 2020  file.name):.    
-00029630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029640: 2020 2020 6f73 2e72 656d 6f76 6528 746d      os.remove(tm
-00029650: 705f 6669 6c65 2e6e 616d 6529 0a20 2020  p_file.name).   
-00029660: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00029670: 7365 0a0a 2020 2020 2020 2020 6966 2074  se..        if t
-00029680: 6d70 5f66 696c 6520 6973 206e 6f74 204e  mp_file is not N
-00029690: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000296a0: 2074 6d70 5f66 696c 652e 636c 6f73 6528   tmp_file.close(
-000296b0: 290a 2020 2020 2020 2020 2020 2020 7368  ).            sh
-000296c0: 7574 696c 2e6d 6f76 6528 746d 705f 6669  util.move(tmp_fi
-000296d0: 6c65 2e6e 616d 652c 2069 6e64 6963 6573  le.name, indices
-000296e0: 5f63 6163 6865 5f66 696c 655f 6e61 6d65  _cache_file_name
-000296f0: 290a 2020 2020 2020 2020 2020 2020 756d  ).            um
-00029700: 6173 6b20 3d20 6f73 2e75 6d61 736b 2830  ask = os.umask(0
-00029710: 6f36 3636 290a 2020 2020 2020 2020 2020  o666).          
-00029720: 2020 6f73 2e75 6d61 736b 2875 6d61 736b    os.umask(umask
-00029730: 290a 2020 2020 2020 2020 2020 2020 6f73  ).            os
-00029740: 2e63 686d 6f64 2869 6e64 6963 6573 5f63  .chmod(indices_c
-00029750: 6163 6865 5f66 696c 655f 6e61 6d65 2c20  ache_file_name, 
-00029760: 306f 3636 3620 2620 7e75 6d61 736b 290a  0o666 & ~umask).
-00029770: 0a20 2020 2020 2020 2023 2052 6574 7572  .        # Retur
-00029780: 6e20 6e65 7720 4461 7461 7365 7420 6f62  n new Dataset ob
-00029790: 6a65 6374 0a20 2020 2020 2020 2069 6620  ject.        if 
-000297a0: 6275 665f 7772 6974 6572 2069 7320 4e6f  buf_writer is No
-000297b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000297c0: 7265 7475 726e 2073 656c 662e 5f6e 6577  return self._new
-000297d0: 5f64 6174 6173 6574 5f77 6974 685f 696e  _dataset_with_in
-000297e0: 6469 6365 7328 0a20 2020 2020 2020 2020  dices(.         
-000297f0: 2020 2020 2020 2069 6e64 6963 6573 5f63         indices_c
-00029800: 6163 6865 5f66 696c 655f 6e61 6d65 3d69  ache_file_name=i
-00029810: 6e64 6963 6573 5f63 6163 6865 5f66 696c  ndices_cache_fil
-00029820: 655f 6e61 6d65 2c20 6669 6e67 6572 7072  e_name, fingerpr
-00029830: 696e 743d 6e65 775f 6669 6e67 6572 7072  int=new_fingerpr
-00029840: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-00029850: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00029860: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00029870: 726e 2073 656c 662e 5f6e 6577 5f64 6174  rn self._new_dat
-00029880: 6173 6574 5f77 6974 685f 696e 6469 6365  aset_with_indice
-00029890: 7328 696e 6469 6365 735f 6275 6666 6572  s(indices_buffer
-000298a0: 3d62 7566 5f77 7269 7465 722e 6765 7476  =buf_writer.getv
-000298b0: 616c 7565 2829 2c20 6669 6e67 6572 7072  alue(), fingerpr
-000298c0: 696e 743d 6e65 775f 6669 6e67 6572 7072  int=new_fingerpr
-000298d0: 696e 7429 0a0a 2020 2020 4074 7261 6e73  int)..    @trans
-000298e0: 6d69 745f 666f 726d 6174 0a20 2020 2040  mit_format.    @
-000298f0: 6669 6e67 6572 7072 696e 745f 7472 616e  fingerprint_tran
-00029900: 7366 6f72 6d28 696e 706c 6163 653d 4661  sform(inplace=Fa
-00029910: 6c73 652c 2069 676e 6f72 655f 6b77 6172  lse, ignore_kwar
-00029920: 6773 3d5b 226c 6f61 645f 6672 6f6d 5f63  gs=["load_from_c
-00029930: 6163 6865 5f66 696c 6522 2c20 2269 6e64  ache_file", "ind
-00029940: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
-00029950: 6e61 6d65 225d 290a 2020 2020 6465 6620  name"]).    def 
-00029960: 736f 7274 280a 2020 2020 2020 2020 7365  sort(.        se
-00029970: 6c66 2c0a 2020 2020 2020 2020 636f 6c75  lf,.        colu
-00029980: 6d6e 3a20 7374 722c 0a20 2020 2020 2020  mn: str,.       
-00029990: 2072 6576 6572 7365 3a20 626f 6f6c 203d   reverse: bool =
-000299a0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-000299b0: 6b69 6e64 3a20 7374 7220 3d20 4e6f 6e65  kind: str = None
-000299c0: 2c0a 2020 2020 2020 2020 6e75 6c6c 5f70  ,.        null_p
-000299d0: 6c61 6365 6d65 6e74 3a20 7374 7220 3d20  lacement: str = 
-000299e0: 226c 6173 7422 2c0a 2020 2020 2020 2020  "last",.        
-000299f0: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 3a20  keep_in_memory: 
-00029a00: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-00029a10: 2020 2020 2020 6c6f 6164 5f66 726f 6d5f        load_from_
-00029a20: 6361 6368 655f 6669 6c65 3a20 626f 6f6c  cache_file: bool
-00029a30: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
-00029a40: 2069 6e64 6963 6573 5f63 6163 6865 5f66   indices_cache_f
-00029a50: 696c 655f 6e61 6d65 3a20 4f70 7469 6f6e  ile_name: Option
-00029a60: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-00029a70: 2020 2020 2020 2020 7772 6974 6572 5f62          writer_b
-00029a80: 6174 6368 5f73 697a 653a 204f 7074 696f  atch_size: Optio
-00029a90: 6e61 6c5b 696e 745d 203d 2031 3030 302c  nal[int] = 1000,
-00029aa0: 0a20 2020 2020 2020 206e 6577 5f66 696e  .        new_fin
-00029ab0: 6765 7270 7269 6e74 3a20 4f70 7469 6f6e  gerprint: Option
-00029ac0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-00029ad0: 2020 2020 2920 2d3e 2022 4461 7461 7365      ) -> "Datase
-00029ae0: 7422 3a0a 2020 2020 2020 2020 2222 2243  t":.        """C
-00029af0: 7265 6174 6520 6120 6e65 7720 6461 7461  reate a new data
-00029b00: 7365 7420 736f 7274 6564 2061 6363 6f72  set sorted accor
-00029b10: 6469 6e67 2074 6f20 6120 636f 6c75 6d6e  ding to a column
-00029b20: 2e0a 0a20 2020 2020 2020 2043 7572 7265  ...        Curre
-00029b30: 6e74 6c79 2073 6f72 7469 6e67 2061 6363  ntly sorting acc
-00029b40: 6f72 6469 6e67 2074 6f20 6120 636f 6c75  ording to a colu
-00029b50: 6d6e 206e 616d 6520 7573 6573 2070 616e  mn name uses pan
-00029b60: 6461 7320 736f 7274 696e 6720 616c 676f  das sorting algo
-00029b70: 7269 7468 6d20 756e 6465 7220 7468 6520  rithm under the 
-00029b80: 686f 6f64 2e0a 2020 2020 2020 2020 5468  hood..        Th
-00029b90: 6520 636f 6c75 6d6e 2073 686f 756c 6420  e column should 
-00029ba0: 7468 7573 2062 6520 6120 7061 6e64 6173  thus be a pandas
-00029bb0: 2063 6f6d 7061 7469 626c 6520 7479 7065   compatible type
-00029bc0: 2028 696e 2070 6172 7469 6375 6c61 7220   (in particular 
-00029bd0: 6e6f 7420 6120 6e65 7374 6564 2074 7970  not a nested typ
-00029be0: 6529 2e0a 2020 2020 2020 2020 5468 6973  e)..        This
-00029bf0: 2061 6c73 6f20 6d65 616e 7320 7468 6174   also means that
-00029c00: 2074 6865 2063 6f6c 756d 6e20 7573 6564   the column used
-00029c10: 2066 6f72 2073 6f72 7469 6e67 2069 7320   for sorting is 
-00029c20: 6675 6c6c 7920 6c6f 6164 6564 2069 6e20  fully loaded in 
-00029c30: 6d65 6d6f 7279 2028 7768 6963 6820 7368  memory (which sh
-00029c40: 6f75 6c64 2062 6520 6669 6e65 2069 6e20  ould be fine in 
-00029c50: 6d6f 7374 2063 6173 6573 292e 0a0a 2020  most cases)...  
-00029c60: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-00029c70: 2020 2020 2020 2020 636f 6c75 6d6e 2028          column (
-00029c80: 6073 7472 6029 3a0a 2020 2020 2020 2020  `str`):.        
-00029c90: 2020 2020 2020 2020 436f 6c75 6d6e 206e          Column n
-00029ca0: 616d 6520 746f 2073 6f72 7420 6279 2e0a  ame to sort by..
-00029cb0: 2020 2020 2020 2020 2020 2020 7265 7665              reve
-00029cc0: 7273 6520 2860 626f 6f6c 602c 2064 6566  rse (`bool`, def
-00029cd0: 6175 6c74 7320 746f 2060 4661 6c73 6560  aults to `False`
-00029ce0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00029cf0: 2020 2049 6620 6054 7275 6560 2c20 736f     If `True`, so
-00029d00: 7274 2062 7920 6465 7363 656e 6469 6e67  rt by descending
-00029d10: 206f 7264 6572 2072 6174 6865 7220 7468   order rather th
-00029d20: 656e 2061 7363 656e 6469 6e67 2e0a 2020  en ascending..  
-00029d30: 2020 2020 2020 2020 2020 6b69 6e64 2028            kind (
-00029d40: 6073 7472 602c 202a 6f70 7469 6f6e 616c  `str`, *optional
-00029d50: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
-00029d60: 2020 2020 5061 6e64 6173 2061 6c67 6f72      Pandas algor
-00029d70: 6974 686d 2066 6f72 2073 6f72 7469 6e67  ithm for sorting
-00029d80: 2073 656c 6563 7465 6420 696e 2060 7b71   selected in `{q
-00029d90: 7569 636b 736f 7274 2c20 6d65 7267 6573  uicksort, merges
-00029da0: 6f72 742c 2068 6561 7073 6f72 742c 2073  ort, heapsort, s
-00029db0: 7461 626c 657d 602c 0a20 2020 2020 2020  table}`,.       
-00029dc0: 2020 2020 2020 2020 2054 6865 2064 6566           The def
-00029dd0: 6175 6c74 2069 7320 6071 7569 636b 736f  ault is `quickso
-00029de0: 7274 602e 204e 6f74 6520 7468 6174 2062  rt`. Note that b
-00029df0: 6f74 6820 6073 7461 626c 6560 2061 6e64  oth `stable` and
-00029e00: 2060 6d65 7267 6573 6f72 7460 2075 7365   `mergesort` use
-00029e10: 2060 7469 6d73 6f72 7460 2075 6e64 6572   `timsort` under
-00029e20: 2074 6865 2063 6f76 6572 7320 616e 642c   the covers and,
-00029e30: 2069 6e20 6765 6e65 7261 6c2c 0a20 2020   in general,.   
-00029e40: 2020 2020 2020 2020 2020 2020 2074 6865               the
-00029e50: 2061 6374 7561 6c20 696d 706c 656d 656e   actual implemen
-00029e60: 7461 7469 6f6e 2077 696c 6c20 7661 7279  tation will vary
-00029e70: 2077 6974 6820 6461 7461 2074 7970 652e   with data type.
-00029e80: 2054 6865 2060 6d65 7267 6573 6f72 7460   The `mergesort`
-00029e90: 206f 7074 696f 6e20 6973 2072 6574 6169   option is retai
-00029ea0: 6e65 6420 666f 7220 6261 636b 7761 7264  ned for backward
-00029eb0: 7320 636f 6d70 6174 6962 696c 6974 792e  s compatibility.
-00029ec0: 0a20 2020 2020 2020 2020 2020 206e 756c  .            nul
-00029ed0: 6c5f 706c 6163 656d 656e 7420 2860 7374  l_placement (`st
-00029ee0: 7260 2c20 6465 6661 756c 7473 2074 6f20  r`, defaults to 
-00029ef0: 606c 6173 7460 293a 0a20 2020 2020 2020  `last`):.       
-00029f00: 2020 2020 2020 2020 2050 7574 2060 4e6f           Put `No
-00029f10: 6e65 6020 7661 6c75 6573 2061 7420 7468  ne` values at th
-00029f20: 6520 6265 6769 6e6e 696e 6720 6966 2066  e beginning if f
-00029f30: 6972 7374 3b20 6c61 7374 2070 7574 7320  irst; last puts 
-00029f40: 604e 6f6e 6560 2076 616c 7565 7320 6174  `None` values at
-00029f50: 2074 6865 2065 6e64 2e0a 0a20 2020 2020   the end...     
-00029f60: 2020 2020 2020 2020 2020 203c 4164 6465             <Adde
-00029f70: 6420 7665 7273 696f 6e3d 2231 2e31 342e  d version="1.14.
-00029f80: 3222 2f3e 0a20 2020 2020 2020 2020 2020  2"/>.           
-00029f90: 206b 6565 705f 696e 5f6d 656d 6f72 7920   keep_in_memory 
-00029fa0: 2860 626f 6f6c 602c 2064 6566 6175 6c74  (`bool`, default
-00029fb0: 7320 746f 2060 4661 6c73 6560 293a 0a20  s to `False`):. 
-00029fc0: 2020 2020 2020 2020 2020 2020 2020 204b                 K
-00029fd0: 6565 7020 7468 6520 736f 7274 6564 2069  eep the sorted i
-00029fe0: 6e64 6963 6573 2069 6e20 6d65 6d6f 7279  ndices in memory
-00029ff0: 2069 6e73 7465 6164 206f 6620 7772 6974   instead of writ
-0002a000: 696e 6720 6974 2074 6f20 6120 6361 6368  ing it to a cach
-0002a010: 6520 6669 6c65 2e0a 2020 2020 2020 2020  e file..        
-0002a020: 2020 2020 6c6f 6164 5f66 726f 6d5f 6361      load_from_ca
-0002a030: 6368 655f 6669 6c65 2028 6062 6f6f 6c60  che_file (`bool`
-0002a040: 2c20 6465 6661 756c 7473 2074 6f20 6054  , defaults to `T
-0002a050: 7275 6560 293a 0a20 2020 2020 2020 2020  rue`):.         
-0002a060: 2020 2020 2020 2049 6620 6120 6361 6368         If a cach
-0002a070: 6520 6669 6c65 2073 746f 7269 6e67 2074  e file storing t
-0002a080: 6865 2073 6f72 7465 6420 696e 6469 6365  he sorted indice
-0002a090: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0002a0a0: 2020 6361 6e20 6265 2069 6465 6e74 6966    can be identif
-0002a0b0: 6965 642c 2075 7365 2069 7420 696e 7374  ied, use it inst
-0002a0c0: 6561 6420 6f66 2072 6563 6f6d 7075 7469  ead of recomputi
-0002a0d0: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
-0002a0e0: 696e 6469 6365 735f 6361 6368 655f 6669  indices_cache_fi
-0002a0f0: 6c65 5f6e 616d 6520 2860 7374 7260 2c20  le_name (`str`, 
-0002a100: 2a6f 7074 696f 6e61 6c2a 2c20 6465 6661  *optional*, defa
-0002a110: 756c 7473 2074 6f20 604e 6f6e 6560 293a  ults to `None`):
-0002a120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a130: 2050 726f 7669 6465 2074 6865 206e 616d   Provide the nam
-0002a140: 6520 6f66 2061 2070 6174 6820 666f 7220  e of a path for 
-0002a150: 7468 6520 6361 6368 6520 6669 6c65 2e20  the cache file. 
-0002a160: 4974 2069 7320 7573 6564 2074 6f20 7374  It is used to st
-0002a170: 6f72 6520 7468 650a 2020 2020 2020 2020  ore the.        
-0002a180: 2020 2020 2020 2020 736f 7274 6564 2069          sorted i
-0002a190: 6e64 6963 6573 2069 6e73 7465 6164 206f  ndices instead o
-0002a1a0: 6620 7468 6520 6175 746f 6d61 7469 6361  f the automatica
-0002a1b0: 6c6c 7920 6765 6e65 7261 7465 6420 6361  lly generated ca
-0002a1c0: 6368 6520 6669 6c65 206e 616d 652e 0a20  che file name.. 
-0002a1d0: 2020 2020 2020 2020 2020 2077 7269 7465             write
-0002a1e0: 725f 6261 7463 685f 7369 7a65 2028 6069  r_batch_size (`i
-0002a1f0: 6e74 602c 2064 6566 6175 6c74 7320 746f  nt`, defaults to
-0002a200: 2060 3130 3030 6029 3a0a 2020 2020 2020   `1000`):.      
-0002a210: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
-0002a220: 206f 6620 726f 7773 2070 6572 2077 7269   of rows per wri
-0002a230: 7465 206f 7065 7261 7469 6f6e 2066 6f72  te operation for
-0002a240: 2074 6865 2063 6163 6865 2066 696c 6520   the cache file 
-0002a250: 7772 6974 6572 2e0a 2020 2020 2020 2020  writer..        
-0002a260: 2020 2020 2020 2020 4869 6768 6572 2076          Higher v
-0002a270: 616c 7565 2067 6976 6573 2073 6d61 6c6c  alue gives small
-0002a280: 6572 2063 6163 6865 2066 696c 6573 2c20  er cache files, 
-0002a290: 6c6f 7765 7220 7661 6c75 6520 636f 6e73  lower value cons
-0002a2a0: 756d 6520 6c65 7373 2074 656d 706f 7261  ume less tempora
-0002a2b0: 7279 206d 656d 6f72 792e 0a20 2020 2020  ry memory..     
-0002a2c0: 2020 2020 2020 206e 6577 5f66 696e 6765         new_finge
-0002a2d0: 7270 7269 6e74 2028 6073 7472 602c 202a  rprint (`str`, *
-0002a2e0: 6f70 7469 6f6e 616c 2a2c 2064 6566 6175  optional*, defau
-0002a2f0: 6c74 7320 746f 2060 4e6f 6e65 6029 3a0a  lts to `None`):.
-0002a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a310: 5468 6520 6e65 7720 6669 6e67 6572 7072  The new fingerpr
-0002a320: 696e 7420 6f66 2074 6865 2064 6174 6173  int of the datas
-0002a330: 6574 2061 6674 6572 2074 7261 6e73 666f  et after transfo
-0002a340: 726d 2e0a 2020 2020 2020 2020 2020 2020  rm..            
-0002a350: 2020 2020 4966 2060 4e6f 6e65 602c 2074      If `None`, t
-0002a360: 6865 206e 6577 2066 696e 6765 7270 7269  he new fingerpri
-0002a370: 6e74 2069 7320 636f 6d70 7574 6564 2075  nt is computed u
-0002a380: 7369 6e67 2061 2068 6173 6820 6f66 2074  sing a hash of t
-0002a390: 6865 2070 7265 7669 6f75 7320 6669 6e67  he previous fing
-0002a3a0: 6572 7072 696e 742c 2061 6e64 2074 6865  erprint, and the
-0002a3b0: 2074 7261 6e73 666f 726d 2061 7267 756d   transform argum
-0002a3c0: 656e 7473 0a0a 2020 2020 2020 2020 4578  ents..        Ex
-0002a3d0: 616d 706c 653a 0a0a 2020 2020 2020 2020  ample:..        
-0002a3e0: 6060 6070 790a 2020 2020 2020 2020 3e3e  ```py.        >>
-0002a3f0: 3e20 6672 6f6d 2064 6174 6173 6574 7320  > from datasets 
-0002a400: 696d 706f 7274 206c 6f61 645f 6461 7461  import load_data
-0002a410: 7365 740a 2020 2020 2020 2020 3e3e 3e20  set.        >>> 
-0002a420: 6473 203d 206c 6f61 645f 6461 7461 7365  ds = load_datase
-0002a430: 7428 2272 6f74 7465 6e5f 746f 6d61 746f  t("rotten_tomato
-0002a440: 6573 222c 2073 706c 6974 3d22 7661 6c69  es", split="vali
-0002a450: 6461 7469 6f6e 2229 0a20 2020 2020 2020  dation").       
-0002a460: 203e 3e3e 2064 735b 276c 6162 656c 275d   >>> ds['label']
-0002a470: 5b3a 3130 5d0a 2020 2020 2020 2020 5b31  [:10].        [1
-0002a480: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-0002a490: 2031 2c20 312c 2031 2c20 315d 0a20 2020   1, 1, 1, 1].   
-0002a4a0: 2020 2020 203e 3e3e 2073 6f72 7465 645f       >>> sorted_
-0002a4b0: 6473 203d 2064 732e 736f 7274 2827 6c61  ds = ds.sort('la
-0002a4c0: 6265 6c27 290a 2020 2020 2020 2020 3e3e  bel').        >>
-0002a4d0: 3e20 736f 7274 6564 5f64 735b 276c 6162  > sorted_ds['lab
-0002a4e0: 656c 275d 5b3a 3130 5d0a 2020 2020 2020  el'][:10].      
-0002a4f0: 2020 5b30 2c20 302c 2030 2c20 302c 2030    [0, 0, 0, 0, 0
-0002a500: 2c20 302c 2030 2c20 302c 2030 2c20 305d  , 0, 0, 0, 0, 0]
-0002a510: 0a20 2020 2020 2020 2060 6060 0a20 2020  .        ```.   
-0002a520: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0002a530: 2069 6620 6c65 6e28 7365 6c66 2e6c 6973   if len(self.lis
-0002a540: 745f 696e 6465 7865 7328 2929 203e 2030  t_indexes()) > 0
-0002a550: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0002a560: 6973 6520 4461 7461 7365 7454 7261 6e73  ise DatasetTrans
-0002a570: 666f 726d 6174 696f 6e4e 6f74 416c 6c6f  formationNotAllo
-0002a580: 7765 6445 7272 6f72 280a 2020 2020 2020  wedError(.      
-0002a590: 2020 2020 2020 2020 2020 2255 7369 6e67            "Using
-0002a5a0: 2060 2e73 6f72 7460 206f 6e20 6120 6461   `.sort` on a da
-0002a5b0: 7461 7365 7420 7769 7468 2061 7474 6163  taset with attac
-0002a5c0: 6865 6420 696e 6465 7865 7320 6973 206e  hed indexes is n
-0002a5d0: 6f74 2061 6c6c 6f77 6564 2e20 596f 7520  ot allowed. You 
-0002a5e0: 6361 6e20 6669 7273 7420 7275 6e20 602e  can first run `.
-0002a5f0: 6472 6f70 5f69 6e64 6578 2829 2074 6f20  drop_index() to 
-0002a600: 7265 6d6f 7665 2079 6f75 7220 696e 6465  remove your inde
-0002a610: 7820 616e 6420 7468 656e 2072 652d 6164  x and then re-ad
-0002a620: 6420 6974 2e22 0a20 2020 2020 2020 2020  d it.".         
-0002a630: 2020 2029 0a20 2020 2020 2020 2023 2049     ).        # I
-0002a640: 6620 7468 6520 6172 7261 7920 6973 2065  f the array is e
-0002a650: 6d70 7479 2077 6520 646f 206e 6f74 6869  mpty we do nothi
-0002a660: 6e67 0a20 2020 2020 2020 2069 6620 6c65  ng.        if le
-0002a670: 6e28 7365 6c66 2920 3d3d 2030 3a0a 2020  n(self) == 0:.  
-0002a680: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002a690: 2073 656c 660a 0a20 2020 2020 2020 2023   self..        #
-0002a6a0: 2043 6865 636b 2074 6865 2063 6f6c 756d   Check the colum
-0002a6b0: 6e20 6e61 6d65 0a20 2020 2020 2020 2069  n name.        i
-0002a6c0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0002a6d0: 2863 6f6c 756d 6e2c 2073 7472 2920 6f72  (column, str) or
-0002a6e0: 2063 6f6c 756d 6e20 6e6f 7420 696e 2073   column not in s
-0002a6f0: 656c 662e 5f64 6174 612e 636f 6c75 6d6e  elf._data.column
-0002a700: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
-0002a710: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0002a720: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0002a730: 2020 2020 2020 6622 436f 6c75 6d6e 2027        f"Column '
-0002a740: 7b63 6f6c 756d 6e7d 2720 6e6f 7420 666f  {column}' not fo
-0002a750: 756e 6420 696e 2074 6865 2064 6174 6173  und in the datas
-0002a760: 6574 2e20 506c 6561 7365 2070 726f 7669  et. Please provi
-0002a770: 6465 2061 2063 6f6c 756d 6e20 7365 6c65  de a column sele
-0002a780: 6374 6564 2069 6e3a 207b 7365 6c66 2e5f  cted in: {self._
-0002a790: 6461 7461 2e63 6f6c 756d 6e5f 6e61 6d65  data.column_name
-0002a7a0: 737d 220a 2020 2020 2020 2020 2020 2020  s}".            
-0002a7b0: 290a 0a20 2020 2020 2020 2023 2043 6865  )..        # Che
-0002a7c0: 636b 2069 6620 7765 2776 6520 616c 7265  ck if we've alre
-0002a7d0: 6164 7920 6361 6368 6564 2074 6869 7320  ady cached this 
-0002a7e0: 636f 6d70 7574 6174 696f 6e20 2869 6e64  computation (ind
-0002a7f0: 6578 6564 2062 7920 6120 6861 7368 290a  exed by a hash).
-0002a800: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0002a810: 6361 6368 655f 6669 6c65 733a 0a20 2020  cache_files:.   
-0002a820: 2020 2020 2020 2020 2069 6620 696e 6469           if indi
-0002a830: 6365 735f 6361 6368 655f 6669 6c65 5f6e  ces_cache_file_n
-0002a840: 616d 6520 6973 204e 6f6e 653a 0a20 2020  ame is None:.   
-0002a850: 2020 2020 2020 2020 2020 2020 2023 2077               # w
-0002a860: 6520 6372 6561 7465 2061 2075 6e69 7175  e create a uniqu
-0002a870: 6520 6861 7368 2066 726f 6d20 7468 6520  e hash from the 
-0002a880: 6675 6e63 7469 6f6e 2c20 6375 7272 656e  function, curren
-0002a890: 7420 6461 7461 7365 7420 6669 6c65 2061  t dataset file a
-0002a8a0: 6e64 2074 6865 206d 6170 7069 6e67 2061  nd the mapping a
-0002a8b0: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
-0002a8c0: 2020 2020 696e 6469 6365 735f 6361 6368      indices_cach
-0002a8d0: 655f 6669 6c65 5f6e 616d 6520 3d20 7365  e_file_name = se
-0002a8e0: 6c66 2e5f 6765 745f 6361 6368 655f 6669  lf._get_cache_fi
-0002a8f0: 6c65 5f70 6174 6828 6e65 775f 6669 6e67  le_path(new_fing
-0002a900: 6572 7072 696e 7429 0a20 2020 2020 2020  erprint).       
-0002a910: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-0002a920: 6578 6973 7473 2869 6e64 6963 6573 5f63  exists(indices_c
-0002a930: 6163 6865 5f66 696c 655f 6e61 6d65 2920  ache_file_name) 
-0002a940: 616e 6420 6c6f 6164 5f66 726f 6d5f 6361  and load_from_ca
-0002a950: 6368 655f 6669 6c65 3a0a 2020 2020 2020  che_file:.      
-0002a960: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-0002a970: 2e77 6172 6e69 6e67 2866 224c 6f61 6469  .warning(f"Loadi
-0002a980: 6e67 2063 6163 6865 6420 736f 7274 6564  ng cached sorted
-0002a990: 2069 6e64 6963 6573 2066 6f72 2064 6174   indices for dat
-0002a9a0: 6173 6574 2061 7420 7b69 6e64 6963 6573  aset at {indices
-0002a9b0: 5f63 6163 6865 5f66 696c 655f 6e61 6d65  _cache_file_name
-0002a9c0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0002a9d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0002a9e0: 5f6e 6577 5f64 6174 6173 6574 5f77 6974  _new_dataset_wit
-0002a9f0: 685f 696e 6469 6365 7328 0a20 2020 2020  h_indices(.     
-0002aa00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0002aa10: 696e 6765 7270 7269 6e74 3d6e 6577 5f66  ingerprint=new_f
-0002aa20: 696e 6765 7270 7269 6e74 2c20 696e 6469  ingerprint, indi
-0002aa30: 6365 735f 6361 6368 655f 6669 6c65 5f6e  ces_cache_file_n
-0002aa40: 616d 653d 696e 6469 6365 735f 6361 6368  ame=indices_cach
-0002aa50: 655f 6669 6c65 5f6e 616d 650a 2020 2020  e_file_name.    
-0002aa60: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0002aa70: 2020 2020 2020 2063 6f6c 756d 6e5f 6461         column_da
-0002aa80: 7461 203d 2073 656c 662e 5f67 6574 6974  ta = self._getit
-0002aa90: 656d 280a 2020 2020 2020 2020 2020 2020  em(.            
-0002aaa0: 636f 6c75 6d6e 2c20 666f 726d 6174 5f74  column, format_t
-0002aab0: 7970 653d 2270 616e 6461 7322 2c20 666f  ype="pandas", fo
-0002aac0: 726d 6174 5f63 6f6c 756d 6e73 3d4e 6f6e  rmat_columns=Non
-0002aad0: 652c 206f 7574 7075 745f 616c 6c5f 636f  e, output_all_co
-0002aae0: 6c75 6d6e 733d 4661 6c73 652c 2066 6f72  lumns=False, for
-0002aaf0: 6d61 745f 6b77 6172 6773 3d4e 6f6e 650a  mat_kwargs=None.
-0002ab00: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0002ab10: 2020 2064 665f 736f 7274 6564 203d 2063     df_sorted = c
-0002ab20: 6f6c 756d 6e5f 6461 7461 2e74 6f5f 6672  olumn_data.to_fr
-0002ab30: 616d 6528 292e 736f 7274 5f76 616c 7565  ame().sort_value
-0002ab40: 7328 0a20 2020 2020 2020 2020 2020 2063  s(.            c
-0002ab50: 6f6c 756d 6e2c 2061 7363 656e 6469 6e67  olumn, ascending
-0002ab60: 3d6e 6f74 2072 6576 6572 7365 2c20 6b69  =not reverse, ki
-0002ab70: 6e64 3d6b 696e 642c 206e 615f 706f 7369  nd=kind, na_posi
-0002ab80: 7469 6f6e 3d6e 756c 6c5f 706c 6163 656d  tion=null_placem
-0002ab90: 656e 740a 2020 2020 2020 2020 290a 2020  ent.        ).  
-0002aba0: 2020 2020 2020 696e 6469 6365 7320 3d20        indices = 
-0002abb0: 6466 5f73 6f72 7465 642e 696e 6465 782e  df_sorted.index.
-0002abc0: 746f 5f6e 756d 7079 2829 0a0a 2020 2020  to_numpy()..    
-0002abd0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0002abe0: 7365 6c65 6374 280a 2020 2020 2020 2020  select(.        
-0002abf0: 2020 2020 696e 6469 6365 733d 696e 6469      indices=indi
-0002ac00: 6365 732c 0a20 2020 2020 2020 2020 2020  ces,.           
-0002ac10: 206b 6565 705f 696e 5f6d 656d 6f72 793d   keep_in_memory=
-0002ac20: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 2c0a  keep_in_memory,.
-0002ac30: 2020 2020 2020 2020 2020 2020 696e 6469              indi
-0002ac40: 6365 735f 6361 6368 655f 6669 6c65 5f6e  ces_cache_file_n
-0002ac50: 616d 653d 696e 6469 6365 735f 6361 6368  ame=indices_cach
-0002ac60: 655f 6669 6c65 5f6e 616d 652c 0a20 2020  e_file_name,.   
-0002ac70: 2020 2020 2020 2020 2077 7269 7465 725f           writer_
-0002ac80: 6261 7463 685f 7369 7a65 3d77 7269 7465  batch_size=write
-0002ac90: 725f 6261 7463 685f 7369 7a65 2c0a 2020  r_batch_size,.  
-0002aca0: 2020 2020 2020 2020 2020 6e65 775f 6669            new_fi
-0002acb0: 6e67 6572 7072 696e 743d 6e65 775f 6669  ngerprint=new_fi
-0002acc0: 6e67 6572 7072 696e 742c 0a20 2020 2020  ngerprint,.     
-0002acd0: 2020 2029 0a0a 2020 2020 4074 7261 6e73     )..    @trans
-0002ace0: 6d69 745f 666f 726d 6174 0a20 2020 2040  mit_format.    @
-0002acf0: 6669 6e67 6572 7072 696e 745f 7472 616e  fingerprint_tran
-0002ad00: 7366 6f72 6d28 0a20 2020 2020 2020 2069  sform(.        i
-0002ad10: 6e70 6c61 6365 3d46 616c 7365 2c20 7261  nplace=False, ra
-0002ad20: 6e64 6f6d 697a 6564 5f66 756e 6374 696f  ndomized_functio
-0002ad30: 6e3d 5472 7565 2c20 6967 6e6f 7265 5f6b  n=True, ignore_k
-0002ad40: 7761 7267 733d 5b22 6c6f 6164 5f66 726f  wargs=["load_fro
-0002ad50: 6d5f 6361 6368 655f 6669 6c65 222c 2022  m_cache_file", "
-0002ad60: 696e 6469 6365 735f 6361 6368 655f 6669  indices_cache_fi
-0002ad70: 6c65 5f6e 616d 6522 5d0a 2020 2020 290a  le_name"].    ).
-0002ad80: 2020 2020 6465 6620 7368 7566 666c 6528      def shuffle(
-0002ad90: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0002ada0: 2020 2020 2020 2073 6565 643a 204f 7074         seed: Opt
-0002adb0: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
-0002adc0: 652c 0a20 2020 2020 2020 2067 656e 6572  e,.        gener
-0002add0: 6174 6f72 3a20 4f70 7469 6f6e 616c 5b6e  ator: Optional[n
-0002ade0: 702e 7261 6e64 6f6d 2e47 656e 6572 6174  p.random.Generat
-0002adf0: 6f72 5d20 3d20 4e6f 6e65 2c0a 2020 2020  or] = None,.    
-0002ae00: 2020 2020 6b65 6570 5f69 6e5f 6d65 6d6f      keep_in_memo
-0002ae10: 7279 3a20 626f 6f6c 203d 2046 616c 7365  ry: bool = False
-0002ae20: 2c0a 2020 2020 2020 2020 6c6f 6164 5f66  ,.        load_f
-0002ae30: 726f 6d5f 6361 6368 655f 6669 6c65 3a20  rom_cache_file: 
-0002ae40: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
-0002ae50: 2020 2020 2069 6e64 6963 6573 5f63 6163       indices_cac
-0002ae60: 6865 5f66 696c 655f 6e61 6d65 3a20 4f70  he_file_name: Op
-0002ae70: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-0002ae80: 6e65 2c0a 2020 2020 2020 2020 7772 6974  ne,.        writ
-0002ae90: 6572 5f62 6174 6368 5f73 697a 653a 204f  er_batch_size: O
-0002aea0: 7074 696f 6e61 6c5b 696e 745d 203d 2031  ptional[int] = 1
-0002aeb0: 3030 302c 0a20 2020 2020 2020 206e 6577  000,.        new
-0002aec0: 5f66 696e 6765 7270 7269 6e74 3a20 4f70  _fingerprint: Op
-0002aed0: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-0002aee0: 6e65 2c0a 2020 2020 2920 2d3e 2022 4461  ne,.    ) -> "Da
-0002aef0: 7461 7365 7422 3a0a 2020 2020 2020 2020  taset":.        
-0002af00: 2222 2243 7265 6174 6520 6120 6e65 7720  """Create a new 
-0002af10: 4461 7461 7365 7420 7768 6572 6520 7468  Dataset where th
-0002af20: 6520 726f 7773 2061 7265 2073 6875 6666  e rows are shuff
-0002af30: 6c65 642e 0a0a 2020 2020 2020 2020 4375  led...        Cu
-0002af40: 7272 656e 746c 7920 7368 7566 666c 696e  rrently shufflin
-0002af50: 6720 7573 6573 206e 756d 7079 2072 616e  g uses numpy ran
-0002af60: 646f 6d20 6765 6e65 7261 746f 7273 2e0a  dom generators..
-0002af70: 2020 2020 2020 2020 596f 7520 6361 6e20          You can 
-0002af80: 6569 7468 6572 2073 7570 706c 7920 6120  either supply a 
-0002af90: 4e75 6d50 7920 4269 7447 656e 6572 6174  NumPy BitGenerat
-0002afa0: 6f72 2074 6f20 7573 652c 206f 7220 6120  or to use, or a 
-0002afb0: 7365 6564 2074 6f20 696e 6974 6961 7465  seed to initiate
-0002afc0: 204e 756d 5079 2773 2064 6566 6175 6c74   NumPy's default
-0002afd0: 2072 616e 646f 6d20 6765 6e65 7261 746f   random generato
-0002afe0: 7220 2850 4347 3634 292e 0a0a 2020 2020  r (PCG64)...    
-0002aff0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-0002b000: 2020 2020 2020 7365 6564 2028 6069 6e74        seed (`int
-0002b010: 602c 202a 6f70 7469 6f6e 616c 2a29 3a0a  `, *optional*):.
-0002b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b030: 4120 7365 6564 2074 6f20 696e 6974 6961  A seed to initia
-0002b040: 6c69 7a65 2074 6865 2064 6566 6175 6c74  lize the default
-0002b050: 2042 6974 4765 6e65 7261 746f 7220 6966   BitGenerator if
-0002b060: 2060 6765 6e65 7261 746f 723d 4e6f 6e65   `generator=None
-0002b070: 602e 0a20 2020 2020 2020 2020 2020 2020  `..             
-0002b080: 2020 2049 6620 604e 6f6e 6560 2c20 7468     If `None`, th
-0002b090: 656e 2066 7265 7368 2c20 756e 7072 6564  en fresh, unpred
-0002b0a0: 6963 7461 626c 6520 656e 7472 6f70 7920  ictable entropy 
-0002b0b0: 7769 6c6c 2062 6520 7075 6c6c 6564 2066  will be pulled f
-0002b0c0: 726f 6d20 7468 6520 4f53 2e0a 2020 2020  rom the OS..    
-0002b0d0: 2020 2020 2020 2020 2020 2020 4966 2061              If a
-0002b0e0: 6e20 6069 6e74 6020 6f72 2060 6172 7261  n `int` or `arra
-0002b0f0: 795f 6c69 6b65 5b69 6e74 735d 6020 6973  y_like[ints]` is
-0002b100: 2070 6173 7365 642c 2074 6865 6e20 6974   passed, then it
-0002b110: 2077 696c 6c20 6265 2070 6173 7365 6420   will be passed 
-0002b120: 746f 2053 6565 6453 6571 7565 6e63 6520  to SeedSequence 
-0002b130: 746f 2064 6572 6976 6520 7468 6520 696e  to derive the in
-0002b140: 6974 6961 6c20 4269 7447 656e 6572 6174  itial BitGenerat
-0002b150: 6f72 2073 7461 7465 2e0a 2020 2020 2020  or state..      
-0002b160: 2020 2020 2020 6765 6e65 7261 746f 7220        generator 
-0002b170: 2860 6e75 6d70 792e 7261 6e64 6f6d 2e47  (`numpy.random.G
-0002b180: 656e 6572 6174 6f72 602c 202a 6f70 7469  enerator`, *opti
-0002b190: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
-0002b1a0: 2020 2020 2020 2020 4e75 6d70 7920 7261          Numpy ra
-0002b1b0: 6e64 6f6d 2047 656e 6572 6174 6f72 2074  ndom Generator t
-0002b1c0: 6f20 7573 6520 746f 2063 6f6d 7075 7465  o use to compute
-0002b1d0: 2074 6865 2070 6572 6d75 7461 7469 6f6e   the permutation
-0002b1e0: 206f 6620 7468 6520 6461 7461 7365 7420   of the dataset 
-0002b1f0: 726f 7773 2e0a 2020 2020 2020 2020 2020  rows..          
-0002b200: 2020 2020 2020 4966 2060 6765 6e65 7261        If `genera
-0002b210: 746f 723d 4e6f 6e65 6020 2864 6566 6175  tor=None` (defau
-0002b220: 6c74 292c 2075 7365 7320 606e 702e 7261  lt), uses `np.ra
-0002b230: 6e64 6f6d 2e64 6566 6175 6c74 5f72 6e67  ndom.default_rng
-0002b240: 6020 2874 6865 2064 6566 6175 6c74 2042  ` (the default B
-0002b250: 6974 4765 6e65 7261 746f 7220 2850 4347  itGenerator (PCG
-0002b260: 3634 2920 6f66 204e 756d 5079 292e 0a20  64) of NumPy).. 
-0002b270: 2020 2020 2020 2020 2020 206b 6565 705f             keep_
-0002b280: 696e 5f6d 656d 6f72 7920 2860 626f 6f6c  in_memory (`bool
-0002b290: 602c 2064 6566 6175 6c74 2060 4661 6c73  `, default `Fals
-0002b2a0: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
-0002b2b0: 2020 2020 204b 6565 7020 7468 6520 7368       Keep the sh
-0002b2c0: 7566 666c 6564 2069 6e64 6963 6573 2069  uffled indices i
-0002b2d0: 6e20 6d65 6d6f 7279 2069 6e73 7465 6164  n memory instead
-0002b2e0: 206f 6620 7772 6974 696e 6720 6974 2074   of writing it t
-0002b2f0: 6f20 6120 6361 6368 6520 6669 6c65 2e0a  o a cache file..
-0002b300: 2020 2020 2020 2020 2020 2020 6c6f 6164              load
-0002b310: 5f66 726f 6d5f 6361 6368 655f 6669 6c65  _from_cache_file
-0002b320: 2028 6062 6f6f 6c60 2c20 6465 6661 756c   (`bool`, defaul
-0002b330: 7473 2074 6f20 6054 7275 6560 293a 0a20  ts to `True`):. 
-0002b340: 2020 2020 2020 2020 2020 2020 2020 2049                 I
-0002b350: 6620 6120 6361 6368 6520 6669 6c65 2073  f a cache file s
-0002b360: 746f 7269 6e67 2074 6865 2073 6875 6666  toring the shuff
-0002b370: 6c65 6420 696e 6469 6365 730a 2020 2020  led indices.    
-0002b380: 2020 2020 2020 2020 2020 2020 6361 6e20              can 
-0002b390: 6265 2069 6465 6e74 6966 6965 642c 2075  be identified, u
-0002b3a0: 7365 2069 7420 696e 7374 6561 6420 6f66  se it instead of
-0002b3b0: 2072 6563 6f6d 7075 7469 6e67 2e0a 2020   recomputing..  
-0002b3c0: 2020 2020 2020 2020 2020 696e 6469 6365            indice
-0002b3d0: 735f 6361 6368 655f 6669 6c65 5f6e 616d  s_cache_file_nam
-0002b3e0: 6520 2860 7374 7260 2c20 2a6f 7074 696f  e (`str`, *optio
-0002b3f0: 6e61 6c2a 293a 0a20 2020 2020 2020 2020  nal*):.         
-0002b400: 2020 2020 2020 2050 726f 7669 6465 2074         Provide t
-0002b410: 6865 206e 616d 6520 6f66 2061 2070 6174  he name of a pat
-0002b420: 6820 666f 7220 7468 6520 6361 6368 6520  h for the cache 
-0002b430: 6669 6c65 2e20 4974 2069 7320 7573 6564  file. It is used
-0002b440: 2074 6f20 7374 6f72 6520 7468 650a 2020   to store the.  
-0002b450: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-0002b460: 7566 666c 6564 2069 6e64 6963 6573 2069  uffled indices i
-0002b470: 6e73 7465 6164 206f 6620 7468 6520 6175  nstead of the au
-0002b480: 746f 6d61 7469 6361 6c6c 7920 6765 6e65  tomatically gene
-0002b490: 7261 7465 6420 6361 6368 6520 6669 6c65  rated cache file
-0002b4a0: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
-0002b4b0: 2020 2077 7269 7465 725f 6261 7463 685f     writer_batch_
-0002b4c0: 7369 7a65 2028 6069 6e74 602c 2064 6566  size (`int`, def
-0002b4d0: 6175 6c74 7320 746f 2060 3130 3030 6029  aults to `1000`)
-0002b4e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002b4f0: 2020 4e75 6d62 6572 206f 6620 726f 7773    Number of rows
-0002b500: 2070 6572 2077 7269 7465 206f 7065 7261   per write opera
-0002b510: 7469 6f6e 2066 6f72 2074 6865 2063 6163  tion for the cac
-0002b520: 6865 2066 696c 6520 7772 6974 6572 2e0a  he file writer..
-0002b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b540: 5468 6973 2076 616c 7565 2069 7320 6120  This value is a 
-0002b550: 676f 6f64 2074 7261 6465 2d6f 6666 2062  good trade-off b
-0002b560: 6574 7765 656e 206d 656d 6f72 7920 7573  etween memory us
-0002b570: 6167 6520 6475 7269 6e67 2074 6865 2070  age during the p
-0002b580: 726f 6365 7373 696e 672c 2061 6e64 2070  rocessing, and p
-0002b590: 726f 6365 7373 696e 6720 7370 6565 642e  rocessing speed.
-0002b5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b5b0: 2048 6967 6865 7220 7661 6c75 6520 6d61   Higher value ma
-0002b5c0: 6b65 7320 7468 6520 7072 6f63 6573 7369  kes the processi
-0002b5d0: 6e67 2064 6f20 6665 7765 7220 6c6f 6f6b  ng do fewer look
-0002b5e0: 7570 732c 206c 6f77 6572 2076 616c 7565  ups, lower value
-0002b5f0: 2063 6f6e 7375 6d65 206c 6573 7320 7465   consume less te
-0002b600: 6d70 6f72 6172 7920 6d65 6d6f 7279 2077  mporary memory w
-0002b610: 6869 6c65 2072 756e 6e69 6e67 2060 6d61  hile running `ma
-0002b620: 7060 2e0a 2020 2020 2020 2020 2020 2020  p`..            
-0002b630: 6e65 775f 6669 6e67 6572 7072 696e 7420  new_fingerprint 
-0002b640: 2860 7374 7260 2c20 2a6f 7074 696f 6e61  (`str`, *optiona
-0002b650: 6c2a 2c20 6465 6661 756c 7473 2074 6f20  l*, defaults to 
-0002b660: 604e 6f6e 6560 293a 0a20 2020 2020 2020  `None`):.       
-0002b670: 2020 2020 2020 2020 2054 6865 206e 6577           The new
-0002b680: 2066 696e 6765 7270 7269 6e74 206f 6620   fingerprint of 
-0002b690: 7468 6520 6461 7461 7365 7420 6166 7465  the dataset afte
-0002b6a0: 7220 7472 616e 7366 6f72 6d2e 0a20 2020  r transform..   
-0002b6b0: 2020 2020 2020 2020 2020 2020 2049 6620               If 
-0002b6c0: 604e 6f6e 6560 2c20 7468 6520 6e65 7720  `None`, the new 
-0002b6d0: 6669 6e67 6572 7072 696e 7420 6973 2063  fingerprint is c
-0002b6e0: 6f6d 7075 7465 6420 7573 696e 6720 6120  omputed using a 
-0002b6f0: 6861 7368 206f 6620 7468 6520 7072 6576  hash of the prev
-0002b700: 696f 7573 2066 696e 6765 7270 7269 6e74  ious fingerprint
-0002b710: 2c20 616e 6420 7468 6520 7472 616e 7366  , and the transf
-0002b720: 6f72 6d20 6172 6775 6d65 6e74 732e 0a0a  orm arguments...
-0002b730: 2020 2020 2020 2020 4578 616d 706c 653a          Example:
-0002b740: 0a0a 2020 2020 2020 2020 6060 6070 790a  ..        ```py.
-0002b750: 2020 2020 2020 2020 3e3e 3e20 6672 6f6d          >>> from
-0002b760: 2064 6174 6173 6574 7320 696d 706f 7274   datasets import
-0002b770: 206c 6f61 645f 6461 7461 7365 740a 2020   load_dataset.  
-0002b780: 2020 2020 2020 3e3e 3e20 6473 203d 206c        >>> ds = l
-0002b790: 6f61 645f 6461 7461 7365 7428 2272 6f74  oad_dataset("rot
-0002b7a0: 7465 6e5f 746f 6d61 746f 6573 222c 2073  ten_tomatoes", s
-0002b7b0: 706c 6974 3d22 7661 6c69 6461 7469 6f6e  plit="validation
-0002b7c0: 2229 0a20 2020 2020 2020 203e 3e3e 2064  ").        >>> d
-0002b7d0: 735b 276c 6162 656c 275d 5b3a 3130 5d0a  s['label'][:10].
-0002b7e0: 2020 2020 2020 2020 5b31 2c20 312c 2031          [1, 1, 1
-0002b7f0: 2c20 312c 2031 2c20 312c 2031 2c20 312c  , 1, 1, 1, 1, 1,
-0002b800: 2031 2c20 315d 0a0a 2020 2020 2020 2020   1, 1]..        
-0002b810: 2320 7365 7420 6120 7365 6564 0a20 2020  # set a seed.   
-0002b820: 2020 2020 203e 3e3e 2073 6875 6666 6c65       >>> shuffle
-0002b830: 645f 6473 203d 2064 732e 7368 7566 666c  d_ds = ds.shuffl
-0002b840: 6528 7365 6564 3d34 3229 0a20 2020 2020  e(seed=42).     
-0002b850: 2020 203e 3e3e 2073 6875 6666 6c65 645f     >>> shuffled_
-0002b860: 6473 5b27 6c61 6265 6c27 5d5b 3a31 305d  ds['label'][:10]
-0002b870: 0a20 2020 2020 2020 205b 312c 2030 2c20  .        [1, 0, 
-0002b880: 312c 2031 2c20 302c 2030 2c20 302c 2030  1, 1, 0, 0, 0, 0
-0002b890: 2c20 302c 2030 5d0a 2020 2020 2020 2020  , 0, 0].        
-0002b8a0: 6060 600a 2020 2020 2020 2020 2222 220a  ```.        """.
-0002b8b0: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-0002b8c0: 656c 662e 6c69 7374 5f69 6e64 6578 6573  elf.list_indexes
-0002b8d0: 2829 2920 3e20 303a 0a20 2020 2020 2020  ()) > 0:.       
-0002b8e0: 2020 2020 2072 6169 7365 2044 6174 6173       raise Datas
-0002b8f0: 6574 5472 616e 7366 6f72 6d61 7469 6f6e  etTransformation
-0002b900: 4e6f 7441 6c6c 6f77 6564 4572 726f 7228  NotAllowedError(
-0002b910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b920: 2022 5573 696e 6720 602e 7368 7566 666c   "Using `.shuffl
-0002b930: 6560 206f 6e20 6120 6461 7461 7365 7420  e` on a dataset 
-0002b940: 7769 7468 2061 7474 6163 6865 6420 696e  with attached in
-0002b950: 6465 7865 7320 6973 206e 6f74 2061 6c6c  dexes is not all
-0002b960: 6f77 6564 2e20 596f 7520 6361 6e20 6669  owed. You can fi
-0002b970: 7273 7420 7275 6e20 602e 6472 6f70 5f69  rst run `.drop_i
-0002b980: 6e64 6578 2829 2074 6f20 7265 6d6f 7665  ndex() to remove
-0002b990: 2079 6f75 7220 696e 6465 7820 616e 6420   your index and 
-0002b9a0: 7468 656e 2072 652d 6164 6420 6974 2e22  then re-add it."
-0002b9b0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0002b9c0: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
-0002b9d0: 6172 7261 7920 6973 2065 6d70 7479 2077  array is empty w
-0002b9e0: 6520 646f 206e 6f74 6869 6e67 0a20 2020  e do nothing.   
-0002b9f0: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
-0002ba00: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-0002ba10: 2020 2020 7265 7475 726e 2073 656c 660a      return self.
-0002ba20: 0a20 2020 2020 2020 2069 6620 6b65 6570  .        if keep
-0002ba30: 5f69 6e5f 6d65 6d6f 7279 2061 6e64 2069  _in_memory and i
-0002ba40: 6e64 6963 6573 5f63 6163 6865 5f66 696c  ndices_cache_fil
-0002ba50: 655f 6e61 6d65 2069 7320 6e6f 7420 4e6f  e_name is not No
-0002ba60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0002ba70: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0002ba80: 2822 506c 6561 7365 2075 7365 2065 6974  ("Please use eit
-0002ba90: 6865 7220 606b 6565 705f 696e 5f6d 656d  her `keep_in_mem
-0002baa0: 6f72 7960 206f 7220 6069 6e64 6963 6573  ory` or `indices
-0002bab0: 5f63 6163 6865 5f66 696c 655f 6e61 6d65  _cache_file_name
-0002bac0: 6020 6275 7420 6e6f 7420 626f 7468 2e22  ` but not both."
-0002bad0: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
-0002bae0: 6564 2069 7320 6e6f 7420 4e6f 6e65 2061  ed is not None a
-0002baf0: 6e64 2067 656e 6572 6174 6f72 2069 7320  nd generator is 
-0002bb00: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0002bb10: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0002bb20: 6545 7272 6f72 2822 426f 7468 2060 7365  eError("Both `se
-0002bb30: 6564 6020 616e 6420 6067 656e 6572 6174  ed` and `generat
-0002bb40: 6f72 6020 7765 7265 2070 726f 7669 6465  or` were provide
-0002bb50: 642e 2050 6c65 6173 6520 7370 6563 6966  d. Please specif
-0002bb60: 7920 6a75 7374 206f 6e65 206f 6620 7468  y just one of th
-0002bb70: 656d 2e22 290a 0a20 2020 2020 2020 2069  em.")..        i
-0002bb80: 6620 6765 6e65 7261 746f 7220 6973 206e  f generator is n
-0002bb90: 6f74 204e 6f6e 6520 616e 6420 6e6f 7420  ot None and not 
-0002bba0: 6973 696e 7374 616e 6365 2867 656e 6572  isinstance(gener
-0002bbb0: 6174 6f72 2c20 6e70 2e72 616e 646f 6d2e  ator, np.random.
-0002bbc0: 4765 6e65 7261 746f 7229 3a0a 2020 2020  Generator):.    
-0002bbd0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0002bbe0: 6c75 6545 7272 6f72 2822 5468 6520 7072  lueError("The pr
-0002bbf0: 6f76 6964 6564 2067 656e 6572 6174 6f72  ovided generator
-0002bc00: 206d 7573 7420 6265 2061 6e20 696e 7374   must be an inst
-0002bc10: 616e 6365 206f 6620 6e75 6d70 792e 7261  ance of numpy.ra
-0002bc20: 6e64 6f6d 2e47 656e 6572 6174 6f72 2229  ndom.Generator")
-0002bc30: 0a0a 2020 2020 2020 2020 6966 2067 656e  ..        if gen
-0002bc40: 6572 6174 6f72 2069 7320 4e6f 6e65 3a0a  erator is None:.
-0002bc50: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0002bc60: 6565 6420 6973 204e 6f6e 653a 0a20 2020  eed is None:.   
-0002bc70: 2020 2020 2020 2020 2020 2020 205f 2c20               _, 
-0002bc80: 7365 6564 2c20 706f 732c 202a 5f20 3d20  seed, pos, *_ = 
-0002bc90: 6e70 2e72 616e 646f 6d2e 6765 745f 7374  np.random.get_st
-0002bca0: 6174 6528 290a 2020 2020 2020 2020 2020  ate().          
-0002bcb0: 2020 2020 2020 7365 6564 203d 2073 6565        seed = see
-0002bcc0: 645b 706f 735d 2069 6620 706f 7320 3c20  d[pos] if pos < 
-0002bcd0: 3632 3420 656c 7365 2073 6565 645b 305d  624 else seed[0]
-0002bce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002bcf0: 205f 203d 206e 702e 7261 6e64 6f6d 2e72   _ = np.random.r
-0002bd00: 616e 646f 6d28 2920 2023 2064 6f20 3120  andom()  # do 1 
-0002bd10: 7374 6570 206f 6620 726e 670a 2020 2020  step of rng.    
-0002bd20: 2020 2020 2020 2020 6765 6e65 7261 746f          generato
-0002bd30: 7220 3d20 6e70 2e72 616e 646f 6d2e 6465  r = np.random.de
-0002bd40: 6661 756c 745f 726e 6728 7365 6564 290a  fault_rng(seed).
-0002bd50: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-0002bd60: 2069 6620 7765 2776 6520 616c 7265 6164   if we've alread
-0002bd70: 7920 6361 6368 6564 2074 6869 7320 636f  y cached this co
-0002bd80: 6d70 7574 6174 696f 6e20 2869 6e64 6578  mputation (index
-0002bd90: 6564 2062 7920 6120 6861 7368 290a 2020  ed by a hash).  
-0002bda0: 2020 2020 2020 6966 2073 656c 662e 6361        if self.ca
-0002bdb0: 6368 655f 6669 6c65 733a 0a20 2020 2020  che_files:.     
-0002bdc0: 2020 2020 2020 2069 6620 696e 6469 6365         if indice
-0002bdd0: 735f 6361 6368 655f 6669 6c65 5f6e 616d  s_cache_file_nam
-0002bde0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-0002bdf0: 2020 2020 2020 2020 2020 2023 2077 6520             # we 
-0002be00: 6372 6561 7465 2061 2075 6e69 7175 6520  create a unique 
-0002be10: 6861 7368 2066 726f 6d20 7468 6520 6675  hash from the fu
-0002be20: 6e63 7469 6f6e 2c20 6375 7272 656e 7420  nction, current 
-0002be30: 6461 7461 7365 7420 6669 6c65 2061 6e64  dataset file and
-0002be40: 2074 6865 206d 6170 7069 6e67 2061 7267   the mapping arg
-0002be50: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0002be60: 2020 696e 6469 6365 735f 6361 6368 655f    indices_cache_
-0002be70: 6669 6c65 5f6e 616d 6520 3d20 7365 6c66  file_name = self
-0002be80: 2e5f 6765 745f 6361 6368 655f 6669 6c65  ._get_cache_file
-0002be90: 5f70 6174 6828 6e65 775f 6669 6e67 6572  _path(new_finger
-0002bea0: 7072 696e 7429 0a20 2020 2020 2020 2020  print).         
-0002beb0: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-0002bec0: 6973 7473 2869 6e64 6963 6573 5f63 6163  ists(indices_cac
-0002bed0: 6865 5f66 696c 655f 6e61 6d65 2920 616e  he_file_name) an
-0002bee0: 6420 6c6f 6164 5f66 726f 6d5f 6361 6368  d load_from_cach
-0002bef0: 655f 6669 6c65 3a0a 2020 2020 2020 2020  e_file:.        
-0002bf00: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-0002bf10: 6172 6e69 6e67 2866 224c 6f61 6469 6e67  arning(f"Loading
-0002bf20: 2063 6163 6865 6420 7368 7566 666c 6564   cached shuffled
-0002bf30: 2069 6e64 6963 6573 2066 6f72 2064 6174   indices for dat
-0002bf40: 6173 6574 2061 7420 7b69 6e64 6963 6573  aset at {indices
-0002bf50: 5f63 6163 6865 5f66 696c 655f 6e61 6d65  _cache_file_name
-0002bf60: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0002bf70: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0002bf80: 5f6e 6577 5f64 6174 6173 6574 5f77 6974  _new_dataset_wit
-0002bf90: 685f 696e 6469 6365 7328 0a20 2020 2020  h_indices(.     
-0002bfa0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0002bfb0: 696e 6765 7270 7269 6e74 3d6e 6577 5f66  ingerprint=new_f
-0002bfc0: 696e 6765 7270 7269 6e74 2c20 696e 6469  ingerprint, indi
-0002bfd0: 6365 735f 6361 6368 655f 6669 6c65 5f6e  ces_cache_file_n
-0002bfe0: 616d 653d 696e 6469 6365 735f 6361 6368  ame=indices_cach
-0002bff0: 655f 6669 6c65 5f6e 616d 650a 2020 2020  e_file_name.    
-0002c000: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0002c010: 2020 2020 2020 2070 6572 6d75 7461 7469         permutati
-0002c020: 6f6e 203d 2067 656e 6572 6174 6f72 2e70  on = generator.p
-0002c030: 6572 6d75 7461 7469 6f6e 286c 656e 2873  ermutation(len(s
-0002c040: 656c 6629 290a 0a20 2020 2020 2020 2072  elf))..        r
-0002c050: 6574 7572 6e20 7365 6c66 2e73 656c 6563  eturn self.selec
-0002c060: 7428 0a20 2020 2020 2020 2020 2020 2069  t(.            i
-0002c070: 6e64 6963 6573 3d70 6572 6d75 7461 7469  ndices=permutati
-0002c080: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-0002c090: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 3d6b  keep_in_memory=k
-0002c0a0: 6565 705f 696e 5f6d 656d 6f72 792c 0a20  eep_in_memory,. 
-0002c0b0: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
-0002c0c0: 6573 5f63 6163 6865 5f66 696c 655f 6e61  es_cache_file_na
-0002c0d0: 6d65 3d69 6e64 6963 6573 5f63 6163 6865  me=indices_cache
-0002c0e0: 5f66 696c 655f 6e61 6d65 2069 6620 6e6f  _file_name if no
-0002c0f0: 7420 6b65 6570 5f69 6e5f 6d65 6d6f 7279  t keep_in_memory
-0002c100: 2065 6c73 6520 4e6f 6e65 2c0a 2020 2020   else None,.    
-0002c110: 2020 2020 2020 2020 7772 6974 6572 5f62          writer_b
-0002c120: 6174 6368 5f73 697a 653d 7772 6974 6572  atch_size=writer
-0002c130: 5f62 6174 6368 5f73 697a 652c 0a20 2020  _batch_size,.   
-0002c140: 2020 2020 2020 2020 206e 6577 5f66 696e           new_fin
-0002c150: 6765 7270 7269 6e74 3d6e 6577 5f66 696e  gerprint=new_fin
-0002c160: 6765 7270 7269 6e74 2c0a 2020 2020 2020  gerprint,.      
-0002c170: 2020 290a 0a20 2020 2040 7472 616e 736d    )..    @transm
-0002c180: 6974 5f66 6f72 6d61 740a 2020 2020 4066  it_format.    @f
-0002c190: 696e 6765 7270 7269 6e74 5f74 7261 6e73  ingerprint_trans
-0002c1a0: 666f 726d 280a 2020 2020 2020 2020 696e  form(.        in
-0002c1b0: 706c 6163 653d 4661 6c73 652c 0a20 2020  place=False,.   
-0002c1c0: 2020 2020 2072 616e 646f 6d69 7a65 645f       randomized_
-0002c1d0: 6675 6e63 7469 6f6e 3d54 7275 652c 0a20  function=True,. 
-0002c1e0: 2020 2020 2020 2066 696e 6765 7270 7269         fingerpri
-0002c1f0: 6e74 5f6e 616d 6573 3d5b 2274 7261 696e  nt_names=["train
-0002c200: 5f6e 6577 5f66 696e 6765 7270 7269 6e74  _new_fingerprint
-0002c210: 222c 2022 7465 7374 5f6e 6577 5f66 696e  ", "test_new_fin
-0002c220: 6765 7270 7269 6e74 225d 2c0a 2020 2020  gerprint"],.    
-0002c230: 2020 2020 6967 6e6f 7265 5f6b 7761 7267      ignore_kwarg
-0002c240: 733d 5b22 6c6f 6164 5f66 726f 6d5f 6361  s=["load_from_ca
-0002c250: 6368 655f 6669 6c65 222c 2022 7472 6169  che_file", "trai
-0002c260: 6e5f 696e 6469 6365 735f 6361 6368 655f  n_indices_cache_
-0002c270: 6669 6c65 5f6e 616d 6522 2c20 2274 6573  file_name", "tes
-0002c280: 745f 696e 6469 6365 735f 6361 6368 655f  t_indices_cache_
-0002c290: 6669 6c65 5f6e 616d 6522 5d2c 0a20 2020  file_name"],.   
-0002c2a0: 2029 0a20 2020 2064 6566 2074 7261 696e   ).    def train
-0002c2b0: 5f74 6573 745f 7370 6c69 7428 0a20 2020  _test_split(.   
-0002c2c0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0002c2d0: 2020 2074 6573 745f 7369 7a65 3a20 556e     test_size: Un
-0002c2e0: 696f 6e5b 666c 6f61 742c 2069 6e74 2c20  ion[float, int, 
-0002c2f0: 4e6f 6e65 5d20 3d20 4e6f 6e65 2c0a 2020  None] = None,.  
-0002c300: 2020 2020 2020 7472 6169 6e5f 7369 7a65        train_size
-0002c310: 3a20 556e 696f 6e5b 666c 6f61 742c 2069  : Union[float, i
-0002c320: 6e74 2c20 4e6f 6e65 5d20 3d20 4e6f 6e65  nt, None] = None
-0002c330: 2c0a 2020 2020 2020 2020 7368 7566 666c  ,.        shuffl
-0002c340: 653a 2062 6f6f 6c20 3d20 5472 7565 2c0a  e: bool = True,.
-0002c350: 2020 2020 2020 2020 7374 7261 7469 6679          stratify
-0002c360: 5f62 795f 636f 6c75 6d6e 3a20 4f70 7469  _by_column: Opti
-0002c370: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-0002c380: 2c0a 2020 2020 2020 2020 7365 6564 3a20  ,.        seed: 
-0002c390: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
-0002c3a0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6765  None,.        ge
-0002c3b0: 6e65 7261 746f 723a 204f 7074 696f 6e61  nerator: Optiona
-0002c3c0: 6c5b 6e70 2e72 616e 646f 6d2e 4765 6e65  l[np.random.Gene
-0002c3d0: 7261 746f 725d 203d 204e 6f6e 652c 0a20  rator] = None,. 
-0002c3e0: 2020 2020 2020 206b 6565 705f 696e 5f6d         keep_in_m
-0002c3f0: 656d 6f72 793a 2062 6f6f 6c20 3d20 4661  emory: bool = Fa
-0002c400: 6c73 652c 0a20 2020 2020 2020 206c 6f61  lse,.        loa
-0002c410: 645f 6672 6f6d 5f63 6163 6865 5f66 696c  d_from_cache_fil
-0002c420: 653a 2062 6f6f 6c20 3d20 5472 7565 2c0a  e: bool = True,.
-0002c430: 2020 2020 2020 2020 7472 6169 6e5f 696e          train_in
-0002c440: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
-0002c450: 5f6e 616d 653a 204f 7074 696f 6e61 6c5b  _name: Optional[
-0002c460: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-0002c470: 2020 2020 2074 6573 745f 696e 6469 6365       test_indice
-0002c480: 735f 6361 6368 655f 6669 6c65 5f6e 616d  s_cache_file_nam
-0002c490: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
-0002c4a0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0002c4b0: 2077 7269 7465 725f 6261 7463 685f 7369   writer_batch_si
-0002c4c0: 7a65 3a20 4f70 7469 6f6e 616c 5b69 6e74  ze: Optional[int
-0002c4d0: 5d20 3d20 3130 3030 2c0a 2020 2020 2020  ] = 1000,.      
-0002c4e0: 2020 7472 6169 6e5f 6e65 775f 6669 6e67    train_new_fing
-0002c4f0: 6572 7072 696e 743a 204f 7074 696f 6e61  erprint: Optiona
-0002c500: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
-0002c510: 2020 2020 2020 2074 6573 745f 6e65 775f         test_new_
-0002c520: 6669 6e67 6572 7072 696e 743a 204f 7074  fingerprint: Opt
-0002c530: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-0002c540: 652c 0a20 2020 2029 202d 3e20 2244 6174  e,.    ) -> "Dat
-0002c550: 6173 6574 4469 6374 223a 0a20 2020 2020  asetDict":.     
-0002c560: 2020 2022 2222 5265 7475 726e 2061 2064     """Return a d
-0002c570: 6963 7469 6f6e 6172 7920 285b 6064 6174  ictionary ([`dat
-0002c580: 6173 6574 732e 4461 7461 7365 7444 6963  asets.DatasetDic
-0002c590: 7460 5d29 2077 6974 6820 7477 6f20 7261  t`]) with two ra
-0002c5a0: 6e64 6f6d 2074 7261 696e 2061 6e64 2074  ndom train and t
-0002c5b0: 6573 7420 7375 6273 6574 7320 2860 7472  est subsets (`tr
-0002c5c0: 6169 6e60 2061 6e64 2060 7465 7374 6020  ain` and `test` 
-0002c5d0: 6044 6174 6173 6574 6020 7370 6c69 7473  `Dataset` splits
-0002c5e0: 292e 0a20 2020 2020 2020 2053 706c 6974  )..        Split
-0002c5f0: 7320 6172 6520 6372 6561 7465 6420 6672  s are created fr
-0002c600: 6f6d 2074 6865 2064 6174 6173 6574 2061  om the dataset a
-0002c610: 6363 6f72 6469 6e67 2074 6f20 6074 6573  ccording to `tes
-0002c620: 745f 7369 7a65 602c 2060 7472 6169 6e5f  t_size`, `train_
-0002c630: 7369 7a65 6020 616e 6420 6073 6875 6666  size` and `shuff
-0002c640: 6c65 602e 0a0a 2020 2020 2020 2020 5468  le`...        Th
-0002c650: 6973 206d 6574 686f 6420 6973 2073 696d  is method is sim
-0002c660: 696c 6172 2074 6f20 7363 696b 6974 2d6c  ilar to scikit-l
-0002c670: 6561 726e 2060 7472 6169 6e5f 7465 7374  earn `train_test
-0002c680: 5f73 706c 6974 602e 0a0a 2020 2020 2020  _split`...      
-0002c690: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-0002c6a0: 2020 2020 7465 7374 5f73 697a 6520 2860      test_size (`
-0002c6b0: 6e75 6d70 792e 7261 6e64 6f6d 2e47 656e  numpy.random.Gen
-0002c6c0: 6572 6174 6f72 602c 202a 6f70 7469 6f6e  erator`, *option
-0002c6d0: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
-0002c6e0: 2020 2020 2020 5369 7a65 206f 6620 7468        Size of th
-0002c6f0: 6520 7465 7374 2073 706c 6974 0a20 2020  e test split.   
-0002c700: 2020 2020 2020 2020 2020 2020 2049 6620               If 
-0002c710: 6066 6c6f 6174 602c 2073 686f 756c 6420  `float`, should 
-0002c720: 6265 2062 6574 7765 656e 2060 302e 3060  be between `0.0`
-0002c730: 2061 6e64 2060 312e 3060 2061 6e64 2072   and `1.0` and r
-0002c740: 6570 7265 7365 6e74 2074 6865 2070 726f  epresent the pro
-0002c750: 706f 7274 696f 6e20 6f66 2074 6865 2064  portion of the d
-0002c760: 6174 6173 6574 2074 6f20 696e 636c 7564  ataset to includ
-0002c770: 6520 696e 2074 6865 2074 6573 7420 7370  e in the test sp
-0002c780: 6c69 742e 0a20 2020 2020 2020 2020 2020  lit..           
-0002c790: 2020 2020 2049 6620 6069 6e74 602c 2072       If `int`, r
-0002c7a0: 6570 7265 7365 6e74 7320 7468 6520 6162  epresents the ab
-0002c7b0: 736f 6c75 7465 206e 756d 6265 7220 6f66  solute number of
-0002c7c0: 2074 6573 7420 7361 6d70 6c65 732e 0a20   test samples.. 
-0002c7d0: 2020 2020 2020 2020 2020 2020 2020 2049                 I
-0002c7e0: 6620 604e 6f6e 6560 2c20 7468 6520 7661  f `None`, the va
-0002c7f0: 6c75 6520 6973 2073 6574 2074 6f20 7468  lue is set to th
-0002c800: 6520 636f 6d70 6c65 6d65 6e74 206f 6620  e complement of 
-0002c810: 7468 6520 7472 6169 6e20 7369 7a65 2e0a  the train size..
-0002c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c830: 4966 2060 7472 6169 6e5f 7369 7a65 6020  If `train_size` 
-0002c840: 6973 2061 6c73 6f20 604e 6f6e 6560 2c20  is also `None`, 
-0002c850: 6974 2077 696c 6c20 6265 2073 6574 2074  it will be set t
-0002c860: 6f20 6030 2e32 3560 2e0a 2020 2020 2020  o `0.25`..      
-0002c870: 2020 2020 2020 7472 6169 6e5f 7369 7a65        train_size
-0002c880: 2028 606e 756d 7079 2e72 616e 646f 6d2e   (`numpy.random.
-0002c890: 4765 6e65 7261 746f 7260 2c20 2a6f 7074  Generator`, *opt
-0002c8a0: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
-0002c8b0: 2020 2020 2020 2020 2053 697a 6520 6f66           Size of
-0002c8c0: 2074 6865 2074 7261 696e 2073 706c 6974   the train split
-0002c8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c8e0: 2049 6620 6066 6c6f 6174 602c 2073 686f   If `float`, sho
-0002c8f0: 756c 6420 6265 2062 6574 7765 656e 2060  uld be between `
-0002c900: 302e 3060 2061 6e64 2060 312e 3060 2061  0.0` and `1.0` a
-0002c910: 6e64 2072 6570 7265 7365 6e74 2074 6865  nd represent the
-0002c920: 2070 726f 706f 7274 696f 6e20 6f66 2074   proportion of t
-0002c930: 6865 2064 6174 6173 6574 2074 6f20 696e  he dataset to in
-0002c940: 636c 7564 6520 696e 2074 6865 2074 7261  clude in the tra
-0002c950: 696e 2073 706c 6974 2e0a 2020 2020 2020  in split..      
-0002c960: 2020 2020 2020 2020 2020 4966 2060 696e            If `in
-0002c970: 7460 2c20 7265 7072 6573 656e 7473 2074  t`, represents t
-0002c980: 6865 2061 6273 6f6c 7574 6520 6e75 6d62  he absolute numb
-0002c990: 6572 206f 6620 7472 6169 6e20 7361 6d70  er of train samp
-0002c9a0: 6c65 732e 0a20 2020 2020 2020 2020 2020  les..           
-0002c9b0: 2020 2020 2049 6620 604e 6f6e 6560 2c20       If `None`, 
-0002c9c0: 7468 6520 7661 6c75 6520 6973 2061 7574  the value is aut
-0002c9d0: 6f6d 6174 6963 616c 6c79 2073 6574 2074  omatically set t
-0002c9e0: 6f20 7468 6520 636f 6d70 6c65 6d65 6e74  o the complement
-0002c9f0: 206f 6620 7468 6520 7465 7374 2073 697a   of the test siz
-0002ca00: 652e 0a20 2020 2020 2020 2020 2020 2073  e..            s
-0002ca10: 6875 6666 6c65 2028 6062 6f6f 6c60 2c20  huffle (`bool`, 
-0002ca20: 2a6f 7074 696f 6e61 6c2a 2c20 6465 6661  *optional*, defa
-0002ca30: 756c 7473 2074 6f20 6054 7275 6560 293a  ults to `True`):
-0002ca40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ca50: 2057 6865 7468 6572 206f 7220 6e6f 7420   Whether or not 
-0002ca60: 746f 2073 6875 6666 6c65 2074 6865 2064  to shuffle the d
-0002ca70: 6174 6120 6265 666f 7265 2073 706c 6974  ata before split
-0002ca80: 7469 6e67 2e0a 2020 2020 2020 2020 2020  ting..          
-0002ca90: 2020 7374 7261 7469 6679 5f62 795f 636f    stratify_by_co
-0002caa0: 6c75 6d6e 2028 6073 7472 602c 202a 6f70  lumn (`str`, *op
-0002cab0: 7469 6f6e 616c 2a2c 2064 6566 6175 6c74  tional*, default
-0002cac0: 7320 746f 2060 4e6f 6e65 6029 3a0a 2020  s to `None`):.  
-0002cad0: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-0002cae0: 6520 636f 6c75 6d6e 206e 616d 6520 6f66  e column name of
-0002caf0: 206c 6162 656c 7320 746f 2062 6520 7573   labels to be us
-0002cb00: 6564 2074 6f20 7065 7266 6f72 6d20 7374  ed to perform st
-0002cb10: 7261 7469 6669 6564 2073 706c 6974 206f  ratified split o
-0002cb20: 6620 6461 7461 2e0a 2020 2020 2020 2020  f data..        
-0002cb30: 2020 2020 7365 6564 2028 6069 6e74 602c      seed (`int`,
-0002cb40: 202a 6f70 7469 6f6e 616c 2a29 3a0a 2020   *optional*):.  
-0002cb50: 2020 2020 2020 2020 2020 2020 2020 4120                A 
-0002cb60: 7365 6564 2074 6f20 696e 6974 6961 6c69  seed to initiali
-0002cb70: 7a65 2074 6865 2064 6566 6175 6c74 2042  ze the default B
-0002cb80: 6974 4765 6e65 7261 746f 7220 6966 2060  itGenerator if `
-0002cb90: 6765 6e65 7261 746f 723d 4e6f 6e65 602e  generator=None`.
-0002cba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002cbb0: 2049 6620 604e 6f6e 6560 2c20 7468 656e   If `None`, then
-0002cbc0: 2066 7265 7368 2c20 756e 7072 6564 6963   fresh, unpredic
-0002cbd0: 7461 626c 6520 656e 7472 6f70 7920 7769  table entropy wi
-0002cbe0: 6c6c 2062 6520 7075 6c6c 6564 2066 726f  ll be pulled fro
-0002cbf0: 6d20 7468 6520 4f53 2e0a 2020 2020 2020  m the OS..      
-0002cc00: 2020 2020 2020 2020 2020 4966 2061 6e20            If an 
-0002cc10: 6069 6e74 6020 6f72 2060 6172 7261 795f  `int` or `array_
-0002cc20: 6c69 6b65 5b69 6e74 735d 6020 6973 2070  like[ints]` is p
-0002cc30: 6173 7365 642c 2074 6865 6e20 6974 2077  assed, then it w
-0002cc40: 696c 6c20 6265 2070 6173 7365 6420 746f  ill be passed to
-0002cc50: 2053 6565 6453 6571 7565 6e63 6520 746f   SeedSequence to
-0002cc60: 2064 6572 6976 6520 7468 6520 696e 6974   derive the init
-0002cc70: 6961 6c20 4269 7447 656e 6572 6174 6f72  ial BitGenerator
-0002cc80: 2073 7461 7465 2e0a 2020 2020 2020 2020   state..        
-0002cc90: 2020 2020 6765 6e65 7261 746f 7220 2860      generator (`
-0002cca0: 6e75 6d70 792e 7261 6e64 6f6d 2e47 656e  numpy.random.Gen
-0002ccb0: 6572 6174 6f72 602c 202a 6f70 7469 6f6e  erator`, *option
-0002ccc0: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
-0002ccd0: 2020 2020 2020 4e75 6d70 7920 7261 6e64        Numpy rand
-0002cce0: 6f6d 2047 656e 6572 6174 6f72 2074 6f20  om Generator to 
-0002ccf0: 7573 6520 746f 2063 6f6d 7075 7465 2074  use to compute t
-0002cd00: 6865 2070 6572 6d75 7461 7469 6f6e 206f  he permutation o
-0002cd10: 6620 7468 6520 6461 7461 7365 7420 726f  f the dataset ro
-0002cd20: 7773 2e0a 2020 2020 2020 2020 2020 2020  ws..            
-0002cd30: 2020 2020 4966 2060 6765 6e65 7261 746f      If `generato
-0002cd40: 723d 4e6f 6e65 6020 2864 6566 6175 6c74  r=None` (default
-0002cd50: 292c 2075 7365 7320 606e 702e 7261 6e64  ), uses `np.rand
-0002cd60: 6f6d 2e64 6566 6175 6c74 5f72 6e67 6020  om.default_rng` 
-0002cd70: 2874 6865 2064 6566 6175 6c74 2042 6974  (the default Bit
-0002cd80: 4765 6e65 7261 746f 7220 2850 4347 3634  Generator (PCG64
-0002cd90: 2920 6f66 204e 756d 5079 292e 0a20 2020  ) of NumPy)..   
-0002cda0: 2020 2020 2020 2020 206b 6565 705f 696e           keep_in
-0002cdb0: 5f6d 656d 6f72 7920 2860 626f 6f6c 602c  _memory (`bool`,
-0002cdc0: 2064 6566 6175 6c74 7320 746f 2060 4661   defaults to `Fa
-0002cdd0: 6c73 6560 293a 0a20 2020 2020 2020 2020  lse`):.         
-0002cde0: 2020 2020 2020 204b 6565 7020 7468 6520         Keep the 
-0002cdf0: 7370 6c69 7473 2069 6e64 6963 6573 2069  splits indices i
-0002ce00: 6e20 6d65 6d6f 7279 2069 6e73 7465 6164  n memory instead
-0002ce10: 206f 6620 7772 6974 696e 6720 6974 2074   of writing it t
-0002ce20: 6f20 6120 6361 6368 6520 6669 6c65 2e0a  o a cache file..
-0002ce30: 2020 2020 2020 2020 2020 2020 6c6f 6164              load
-0002ce40: 5f66 726f 6d5f 6361 6368 655f 6669 6c65  _from_cache_file
-0002ce50: 2028 6062 6f6f 6c60 2c20 6465 6661 756c   (`bool`, defaul
-0002ce60: 7473 2074 6f20 6054 7275 6560 293a 0a20  ts to `True`):. 
-0002ce70: 2020 2020 2020 2020 2020 2020 2020 2049                 I
-0002ce80: 6620 6120 6361 6368 6520 6669 6c65 2073  f a cache file s
-0002ce90: 746f 7269 6e67 2074 6865 2073 706c 6974  toring the split
-0002cea0: 7320 696e 6469 6365 730a 2020 2020 2020  s indices.      
-0002ceb0: 2020 2020 2020 2020 2020 6361 6e20 6265            can be
-0002cec0: 2069 6465 6e74 6966 6965 642c 2075 7365   identified, use
-0002ced0: 2069 7420 696e 7374 6561 6420 6f66 2072   it instead of r
-0002cee0: 6563 6f6d 7075 7469 6e67 2e0a 2020 2020  ecomputing..    
-0002cef0: 2020 2020 2020 2020 7472 6169 6e5f 6361          train_ca
-0002cf00: 6368 655f 6669 6c65 5f6e 616d 6520 2860  che_file_name (`
-0002cf10: 7374 7260 2c20 2a6f 7074 696f 6e61 6c2a  str`, *optional*
-0002cf20: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0002cf30: 2020 2050 726f 7669 6465 2074 6865 206e     Provide the n
-0002cf40: 616d 6520 6f66 2061 2070 6174 6820 666f  ame of a path fo
-0002cf50: 7220 7468 6520 6361 6368 6520 6669 6c65  r the cache file
-0002cf60: 2e20 4974 2069 7320 7573 6564 2074 6f20  . It is used to 
-0002cf70: 7374 6f72 6520 7468 650a 2020 2020 2020  store the.      
-0002cf80: 2020 2020 2020 2020 2020 7472 6169 6e20            train 
-0002cf90: 7370 6c69 7420 696e 6469 6365 7320 696e  split indices in
-0002cfa0: 7374 6561 6420 6f66 2074 6865 2061 7574  stead of the aut
-0002cfb0: 6f6d 6174 6963 616c 6c79 2067 656e 6572  omatically gener
-0002cfc0: 6174 6564 2063 6163 6865 2066 696c 6520  ated cache file 
-0002cfd0: 6e61 6d65 2e0a 2020 2020 2020 2020 2020  name..          
-0002cfe0: 2020 7465 7374 5f63 6163 6865 5f66 696c    test_cache_fil
-0002cff0: 655f 6e61 6d65 2028 6073 7472 602c 202a  e_name (`str`, *
-0002d000: 6f70 7469 6f6e 616c 2a29 3a0a 2020 2020  optional*):.    
-0002d010: 2020 2020 2020 2020 2020 2020 5072 6f76              Prov
-0002d020: 6964 6520 7468 6520 6e61 6d65 206f 6620  ide the name of 
-0002d030: 6120 7061 7468 2066 6f72 2074 6865 2063  a path for the c
-0002d040: 6163 6865 2066 696c 652e 2049 7420 6973  ache file. It is
-0002d050: 2075 7365 6420 746f 2073 746f 7265 2074   used to store t
-0002d060: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
-0002d070: 2020 2074 6573 7420 7370 6c69 7420 696e     test split in
-0002d080: 6469 6365 7320 696e 7374 6561 6420 6f66  dices instead of
-0002d090: 2074 6865 2061 7574 6f6d 6174 6963 616c   the automatical
-0002d0a0: 6c79 2067 656e 6572 6174 6564 2063 6163  ly generated cac
-0002d0b0: 6865 2066 696c 6520 6e61 6d65 2e0a 2020  he file name..  
-0002d0c0: 2020 2020 2020 2020 2020 7772 6974 6572            writer
-0002d0d0: 5f62 6174 6368 5f73 697a 6520 2860 696e  _batch_size (`in
-0002d0e0: 7460 2c20 6465 6661 756c 7473 2074 6f20  t`, defaults to 
-0002d0f0: 6031 3030 3060 293a 0a20 2020 2020 2020  `1000`):.       
-0002d100: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
-0002d110: 6f66 2072 6f77 7320 7065 7220 7772 6974  of rows per writ
-0002d120: 6520 6f70 6572 6174 696f 6e20 666f 7220  e operation for 
-0002d130: 7468 6520 6361 6368 6520 6669 6c65 2077  the cache file w
-0002d140: 7269 7465 722e 0a20 2020 2020 2020 2020  riter..         
-0002d150: 2020 2020 2020 2054 6869 7320 7661 6c75         This valu
-0002d160: 6520 6973 2061 2067 6f6f 6420 7472 6164  e is a good trad
-0002d170: 652d 6f66 6620 6265 7477 6565 6e20 6d65  e-off between me
-0002d180: 6d6f 7279 2075 7361 6765 2064 7572 696e  mory usage durin
-0002d190: 6720 7468 6520 7072 6f63 6573 7369 6e67  g the processing
-0002d1a0: 2c20 616e 6420 7072 6f63 6573 7369 6e67  , and processing
-0002d1b0: 2073 7065 6564 2e0a 2020 2020 2020 2020   speed..        
-0002d1c0: 2020 2020 2020 2020 4869 6768 6572 2076          Higher v
-0002d1d0: 616c 7565 206d 616b 6573 2074 6865 2070  alue makes the p
-0002d1e0: 726f 6365 7373 696e 6720 646f 2066 6577  rocessing do few
-0002d1f0: 6572 206c 6f6f 6b75 7073 2c20 6c6f 7765  er lookups, lowe
-0002d200: 7220 7661 6c75 6520 636f 6e73 756d 6520  r value consume 
-0002d210: 6c65 7373 2074 656d 706f 7261 7279 206d  less temporary m
-0002d220: 656d 6f72 7920 7768 696c 6520 7275 6e6e  emory while runn
-0002d230: 696e 6720 606d 6170 602e 0a20 2020 2020  ing `map`..     
-0002d240: 2020 2020 2020 2074 7261 696e 5f6e 6577         train_new
-0002d250: 5f66 696e 6765 7270 7269 6e74 2028 6073  _fingerprint (`s
-0002d260: 7472 602c 202a 6f70 7469 6f6e 616c 2a2c  tr`, *optional*,
-0002d270: 2064 6566 6175 6c74 7320 746f 2060 4e6f   defaults to `No
-0002d280: 6e65 6029 3a0a 2020 2020 2020 2020 2020  ne`):.          
-0002d290: 2020 2020 2020 5468 6520 6e65 7720 6669        The new fi
-0002d2a0: 6e67 6572 7072 696e 7420 6f66 2074 6865  ngerprint of the
-0002d2b0: 2074 7261 696e 2073 6574 2061 6674 6572   train set after
-0002d2c0: 2074 7261 6e73 666f 726d 2e0a 2020 2020   transform..    
-0002d2d0: 2020 2020 2020 2020 2020 2020 4966 2060              If `
-0002d2e0: 4e6f 6e65 602c 2074 6865 206e 6577 2066  None`, the new f
-0002d2f0: 696e 6765 7270 7269 6e74 2069 7320 636f  ingerprint is co
-0002d300: 6d70 7574 6564 2075 7369 6e67 2061 2068  mputed using a h
-0002d310: 6173 6820 6f66 2074 6865 2070 7265 7669  ash of the previ
-0002d320: 6f75 7320 6669 6e67 6572 7072 696e 742c  ous fingerprint,
-0002d330: 2061 6e64 2074 6865 2074 7261 6e73 666f   and the transfo
-0002d340: 726d 2061 7267 756d 656e 7473 0a20 2020  rm arguments.   
-0002d350: 2020 2020 2020 2020 2074 6573 745f 6e65           test_ne
-0002d360: 775f 6669 6e67 6572 7072 696e 7420 2860  w_fingerprint (`
-0002d370: 7374 7260 2c20 2a6f 7074 696f 6e61 6c2a  str`, *optional*
-0002d380: 2c20 6465 6661 756c 7473 2074 6f20 604e  , defaults to `N
-0002d390: 6f6e 6560 293a 0a20 2020 2020 2020 2020  one`):.         
-0002d3a0: 2020 2020 2020 2054 6865 206e 6577 2066         The new f
-0002d3b0: 696e 6765 7270 7269 6e74 206f 6620 7468  ingerprint of th
-0002d3c0: 6520 7465 7374 2073 6574 2061 6674 6572  e test set after
-0002d3d0: 2074 7261 6e73 666f 726d 2e0a 2020 2020   transform..    
-0002d3e0: 2020 2020 2020 2020 2020 2020 4966 2060              If `
-0002d3f0: 4e6f 6e65 602c 2074 6865 206e 6577 2066  None`, the new f
-0002d400: 696e 6765 7270 7269 6e74 2069 7320 636f  ingerprint is co
-0002d410: 6d70 7574 6564 2075 7369 6e67 2061 2068  mputed using a h
-0002d420: 6173 6820 6f66 2074 6865 2070 7265 7669  ash of the previ
-0002d430: 6f75 7320 6669 6e67 6572 7072 696e 742c  ous fingerprint,
-0002d440: 2061 6e64 2074 6865 2074 7261 6e73 666f   and the transfo
-0002d450: 726d 2061 7267 756d 656e 7473 0a0a 2020  rm arguments..  
-0002d460: 2020 2020 2020 4578 616d 706c 653a 0a0a        Example:..
-0002d470: 2020 2020 2020 2020 6060 6070 790a 2020          ```py.  
-0002d480: 2020 2020 2020 3e3e 3e20 6672 6f6d 2064        >>> from d
-0002d490: 6174 6173 6574 7320 696d 706f 7274 206c  atasets import l
-0002d4a0: 6f61 645f 6461 7461 7365 740a 2020 2020  oad_dataset.    
-0002d4b0: 2020 2020 3e3e 3e20 6473 203d 206c 6f61      >>> ds = loa
-0002d4c0: 645f 6461 7461 7365 7428 2272 6f74 7465  d_dataset("rotte
-0002d4d0: 6e5f 746f 6d61 746f 6573 222c 2073 706c  n_tomatoes", spl
-0002d4e0: 6974 3d22 7661 6c69 6461 7469 6f6e 2229  it="validation")
-0002d4f0: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
-0002d500: 3d20 6473 2e74 7261 696e 5f74 6573 745f  = ds.train_test_
-0002d510: 7370 6c69 7428 7465 7374 5f73 697a 653d  split(test_size=
-0002d520: 302e 322c 2073 6875 6666 6c65 3d54 7275  0.2, shuffle=Tru
-0002d530: 6529 0a20 2020 2020 2020 2044 6174 6173  e).        Datas
-0002d540: 6574 4469 6374 287b 0a20 2020 2020 2020  etDict({.       
-0002d550: 2020 2020 2074 7261 696e 3a20 4461 7461       train: Data
-0002d560: 7365 7428 7b0a 2020 2020 2020 2020 2020  set({.          
-0002d570: 2020 2020 2020 6665 6174 7572 6573 3a20        features: 
-0002d580: 5b27 7465 7874 272c 2027 6c61 6265 6c27  ['text', 'label'
-0002d590: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0002d5a0: 2020 206e 756d 5f72 6f77 733a 2038 3532     num_rows: 852
-0002d5b0: 0a20 2020 2020 2020 2020 2020 207d 290a  .            }).
-0002d5c0: 2020 2020 2020 2020 2020 2020 7465 7374              test
-0002d5d0: 3a20 4461 7461 7365 7428 7b0a 2020 2020  : Dataset({.    
-0002d5e0: 2020 2020 2020 2020 2020 2020 6665 6174              feat
-0002d5f0: 7572 6573 3a20 5b27 7465 7874 272c 2027  ures: ['text', '
-0002d600: 6c61 6265 6c27 5d2c 0a20 2020 2020 2020  label'],.       
-0002d610: 2020 2020 2020 2020 206e 756d 5f72 6f77           num_row
-0002d620: 733a 2032 3134 0a20 2020 2020 2020 2020  s: 214.         
-0002d630: 2020 207d 290a 2020 2020 2020 2020 7d29     }).        })
-0002d640: 0a0a 2020 2020 2020 2020 2320 7365 7420  ..        # set 
-0002d650: 6120 7365 6564 0a20 2020 2020 2020 203e  a seed.        >
-0002d660: 3e3e 2064 7320 3d20 6473 2e74 7261 696e  >> ds = ds.train
-0002d670: 5f74 6573 745f 7370 6c69 7428 7465 7374  _test_split(test
-0002d680: 5f73 697a 653d 302e 322c 2073 6565 643d  _size=0.2, seed=
-0002d690: 3432 290a 0a20 2020 2020 2020 2023 2073  42)..        # s
-0002d6a0: 7472 6174 6966 6965 6420 7370 6c69 740a  tratified split.
-0002d6b0: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
-0002d6c0: 206c 6f61 645f 6461 7461 7365 7428 2269   load_dataset("i
-0002d6d0: 6d64 6222 2c73 706c 6974 3d22 7472 6169  mdb",split="trai
-0002d6e0: 6e22 290a 2020 2020 2020 2020 4461 7461  n").        Data
-0002d6f0: 7365 7428 7b0a 2020 2020 2020 2020 2020  set({.          
-0002d700: 2020 6665 6174 7572 6573 3a20 5b27 7465    features: ['te
-0002d710: 7874 272c 2027 6c61 6265 6c27 5d2c 0a20  xt', 'label'],. 
-0002d720: 2020 2020 2020 2020 2020 206e 756d 5f72             num_r
-0002d730: 6f77 733a 2032 3530 3030 0a20 2020 2020  ows: 25000.     
-0002d740: 2020 207d 290a 2020 2020 2020 2020 3e3e     }).        >>
-0002d750: 3e20 6473 203d 2064 732e 7472 6169 6e5f  > ds = ds.train_
-0002d760: 7465 7374 5f73 706c 6974 2874 6573 745f  test_split(test_
-0002d770: 7369 7a65 3d30 2e32 2c20 7374 7261 7469  size=0.2, strati
-0002d780: 6679 5f62 795f 636f 6c75 6d6e 3d22 6c61  fy_by_column="la
-0002d790: 6265 6c22 290a 2020 2020 2020 2020 4461  bel").        Da
-0002d7a0: 7461 7365 7444 6963 7428 7b0a 2020 2020  tasetDict({.    
-0002d7b0: 2020 2020 2020 2020 7472 6169 6e3a 2044          train: D
-0002d7c0: 6174 6173 6574 287b 0a20 2020 2020 2020  ataset({.       
-0002d7d0: 2020 2020 2020 2020 2066 6561 7475 7265           feature
-0002d7e0: 733a 205b 2774 6578 7427 2c20 276c 6162  s: ['text', 'lab
-0002d7f0: 656c 275d 2c0a 2020 2020 2020 2020 2020  el'],.          
-0002d800: 2020 2020 2020 6e75 6d5f 726f 7773 3a20        num_rows: 
-0002d810: 3230 3030 300a 2020 2020 2020 2020 2020  20000.          
-0002d820: 2020 7d29 0a20 2020 2020 2020 2020 2020    }).           
-0002d830: 2074 6573 743a 2044 6174 6173 6574 287b   test: Dataset({
-0002d840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d850: 2066 6561 7475 7265 733a 205b 2774 6578   features: ['tex
-0002d860: 7427 2c20 276c 6162 656c 275d 2c0a 2020  t', 'label'],.  
-0002d870: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
-0002d880: 6d5f 726f 7773 3a20 3530 3030 0a20 2020  m_rows: 5000.   
-0002d890: 2020 2020 2020 2020 207d 290a 2020 2020           }).    
-0002d8a0: 2020 2020 7d29 0a20 2020 2020 2020 2060      }).        `
-0002d8b0: 6060 0a20 2020 2020 2020 2022 2222 0a20  ``.        """. 
-0002d8c0: 2020 2020 2020 2066 726f 6d20 2e64 6174         from .dat
-0002d8d0: 6173 6574 5f64 6963 7420 696d 706f 7274  aset_dict import
-0002d8e0: 2044 6174 6173 6574 4469 6374 2020 2320   DatasetDict  # 
-0002d8f0: 696d 706f 7274 2068 6572 6520 6265 6361  import here beca
-0002d900: 7573 6520 6f66 2063 6972 6375 6c61 7220  use of circular 
-0002d910: 6465 7065 6e64 656e 6379 0a0a 2020 2020  dependency..    
-0002d920: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
-0002d930: 6c69 7374 5f69 6e64 6578 6573 2829 2920  list_indexes()) 
-0002d940: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0002d950: 2072 6169 7365 2044 6174 6173 6574 5472   raise DatasetTr
-0002d960: 616e 7366 6f72 6d61 7469 6f6e 4e6f 7441  ansformationNotA
-0002d970: 6c6c 6f77 6564 4572 726f 7228 0a20 2020  llowedError(.   
-0002d980: 2020 2020 2020 2020 2020 2020 2022 5573               "Us
-0002d990: 696e 6720 602e 7472 6169 6e5f 7465 7374  ing `.train_test
-0002d9a0: 5f73 706c 6974 6020 6f6e 2061 2064 6174  _split` on a dat
-0002d9b0: 6173 6574 2077 6974 6820 6174 7461 6368  aset with attach
-0002d9c0: 6564 2069 6e64 6578 6573 2069 7320 6e6f  ed indexes is no
-0002d9d0: 7420 616c 6c6f 7765 642e 2059 6f75 2063  t allowed. You c
-0002d9e0: 616e 2066 6972 7374 2072 756e 2060 2e64  an first run `.d
-0002d9f0: 726f 705f 696e 6465 7828 2920 746f 2072  rop_index() to r
-0002da00: 656d 6f76 6520 796f 7572 2069 6e64 6578  emove your index
-0002da10: 2061 6e64 2074 6865 6e20 7265 2d61 6464   and then re-add
-0002da20: 2069 742e 220a 2020 2020 2020 2020 2020   it.".          
-0002da30: 2020 290a 2020 2020 2020 2020 2320 4966    ).        # If
-0002da40: 2074 6865 2061 7272 6179 2069 7320 656d   the array is em
-0002da50: 7074 7920 7765 2064 6f20 6e6f 7468 696e  pty we do nothin
-0002da60: 670a 2020 2020 2020 2020 6966 206c 656e  g.        if len
-0002da70: 2873 656c 6629 203d 3d20 303a 0a20 2020  (self) == 0:.   
-0002da80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0002da90: 4461 7461 7365 7444 6963 7428 7b22 7472  DatasetDict({"tr
-0002daa0: 6169 6e22 3a20 7365 6c66 2c20 2274 6573  ain": self, "tes
-0002dab0: 7422 3a20 7365 6c66 7d29 0a0a 2020 2020  t": self})..    
-0002dac0: 2020 2020 6966 2074 6573 745f 7369 7a65      if test_size
-0002dad0: 2069 7320 4e6f 6e65 2061 6e64 2074 7261   is None and tra
-0002dae0: 696e 5f73 697a 6520 6973 204e 6f6e 653a  in_size is None:
-0002daf0: 0a20 2020 2020 2020 2020 2020 2074 6573  .            tes
-0002db00: 745f 7369 7a65 203d 2030 2e32 350a 0a20  t_size = 0.25.. 
-0002db10: 2020 2020 2020 2023 2053 6166 6574 7920         # Safety 
-0002db20: 6368 6563 6b73 2073 696d 696c 6172 2074  checks similar t
-0002db30: 6f20 7363 696b 6974 2d6c 6561 726e 2773  o scikit-learn's
-0002db40: 206f 6e65 732e 0a20 2020 2020 2020 2023   ones..        #
-0002db50: 2028 6164 6170 7465 6420 6672 6f6d 2068   (adapted from h
-0002db60: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-0002db70: 6d2f 7363 696b 6974 2d6c 6561 726e 2f73  m/scikit-learn/s
-0002db80: 6369 6b69 742d 6c65 6172 6e2f 626c 6f62  cikit-learn/blob
-0002db90: 2f66 6432 3337 3237 3865 3839 3562 3432  /fd237278e895b42
-0002dba0: 6162 6538 6438 6430 3931 3035 6362 6238  abe8d8d09105cbb8
-0002dbb0: 3264 6332 6362 6261 372f 736b 6c65 6172  2dc2cbba7/sklear
-0002dbc0: 6e2f 6d6f 6465 6c5f 7365 6c65 6374 696f  n/model_selectio
-0002dbd0: 6e2f 5f73 706c 6974 2e70 7923 4c31 3735  n/_split.py#L175
-0002dbe0: 3029 0a20 2020 2020 2020 206e 5f73 616d  0).        n_sam
-0002dbf0: 706c 6573 203d 206c 656e 2873 656c 6629  ples = len(self)
-0002dc00: 0a20 2020 2020 2020 2069 6620 280a 2020  .        if (.  
-0002dc10: 2020 2020 2020 2020 2020 6973 696e 7374            isinst
-0002dc20: 616e 6365 2874 6573 745f 7369 7a65 2c20  ance(test_size, 
-0002dc30: 696e 7429 0a20 2020 2020 2020 2020 2020  int).           
-0002dc40: 2061 6e64 2028 7465 7374 5f73 697a 6520   and (test_size 
-0002dc50: 3e3d 206e 5f73 616d 706c 6573 206f 7220  >= n_samples or 
-0002dc60: 7465 7374 5f73 697a 6520 3c3d 2030 290a  test_size <= 0).
-0002dc70: 2020 2020 2020 2020 2020 2020 6f72 2069              or i
-0002dc80: 7369 6e73 7461 6e63 6528 7465 7374 5f73  sinstance(test_s
-0002dc90: 697a 652c 2066 6c6f 6174 290a 2020 2020  ize, float).    
-0002dca0: 2020 2020 2020 2020 616e 6420 2874 6573          and (tes
-0002dcb0: 745f 7369 7a65 203c 3d20 3020 6f72 2074  t_size <= 0 or t
-0002dcc0: 6573 745f 7369 7a65 203e 3d20 3129 0a20  est_size >= 1). 
-0002dcd0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0002dce0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0002dcf0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0002dd00: 2020 2020 2020 2020 6622 7465 7374 5f73          f"test_s
-0002dd10: 697a 653d 7b74 6573 745f 7369 7a65 7d20  ize={test_size} 
-0002dd20: 7368 6f75 6c64 2062 6520 6569 7468 6572  should be either
-0002dd30: 2070 6f73 6974 6976 6520 616e 6420 736d   positive and sm
-0002dd40: 616c 6c65 7220 220a 2020 2020 2020 2020  aller ".        
-0002dd50: 2020 2020 2020 2020 6622 7468 616e 2074          f"than t
-0002dd60: 6865 206e 756d 6265 7220 6f66 2073 616d  he number of sam
-0002dd70: 706c 6573 207b 6e5f 7361 6d70 6c65 737d  ples {n_samples}
-0002dd80: 206f 7220 6120 666c 6f61 7420 696e 2074   or a float in t
-0002dd90: 6865 2028 302c 2031 2920 7261 6e67 6522  he (0, 1) range"
-0002dda0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0002ddb0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-0002ddc0: 2020 2020 2020 2020 2069 7369 6e73 7461           isinsta
-0002ddd0: 6e63 6528 7472 6169 6e5f 7369 7a65 2c20  nce(train_size, 
-0002dde0: 696e 7429 0a20 2020 2020 2020 2020 2020  int).           
-0002ddf0: 2061 6e64 2028 7472 6169 6e5f 7369 7a65   and (train_size
-0002de00: 203e 3d20 6e5f 7361 6d70 6c65 7320 6f72   >= n_samples or
-0002de10: 2074 7261 696e 5f73 697a 6520 3c3d 2030   train_size <= 0
-0002de20: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
-0002de30: 2069 7369 6e73 7461 6e63 6528 7472 6169   isinstance(trai
-0002de40: 6e5f 7369 7a65 2c20 666c 6f61 7429 0a20  n_size, float). 
-0002de50: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-0002de60: 7472 6169 6e5f 7369 7a65 203c 3d20 3020  train_size <= 0 
-0002de70: 6f72 2074 7261 696e 5f73 697a 6520 3e3d  or train_size >=
-0002de80: 2031 290a 2020 2020 2020 2020 293a 0a20   1).        ):. 
-0002de90: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0002dea0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-0002deb0: 2020 2020 2020 2020 2020 2020 2066 2274               f"t
-0002dec0: 7261 696e 5f73 697a 653d 7b74 7261 696e  rain_size={train
-0002ded0: 5f73 697a 657d 2073 686f 756c 6420 6265  _size} should be
-0002dee0: 2065 6974 6865 7220 706f 7369 7469 7665   either positive
-0002def0: 2061 6e64 2073 6d61 6c6c 6572 2022 0a20   and smaller ". 
-0002df00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0002df10: 2274 6861 6e20 7468 6520 6e75 6d62 6572  "than the number
-0002df20: 206f 6620 7361 6d70 6c65 7320 7b6e 5f73   of samples {n_s
-0002df30: 616d 706c 6573 7d20 6f72 2061 2066 6c6f  amples} or a flo
-0002df40: 6174 2069 6e20 7468 6520 2830 2c20 3129  at in the (0, 1)
-0002df50: 2072 616e 6765 220a 2020 2020 2020 2020   range".        
-0002df60: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
-0002df70: 6620 7472 6169 6e5f 7369 7a65 2069 7320  f train_size is 
-0002df80: 6e6f 7420 4e6f 6e65 2061 6e64 206e 6f74  not None and not
-0002df90: 2069 7369 6e73 7461 6e63 6528 7472 6169   isinstance(trai
-0002dfa0: 6e5f 7369 7a65 2c20 2869 6e74 2c20 666c  n_size, (int, fl
-0002dfb0: 6f61 7429 293a 0a20 2020 2020 2020 2020  oat)):.         
-0002dfc0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0002dfd0: 726f 7228 6622 496e 7661 6c69 6420 7661  ror(f"Invalid va
-0002dfe0: 6c75 6520 666f 7220 7472 6169 6e5f 7369  lue for train_si
-0002dff0: 7a65 3a20 7b74 7261 696e 5f73 697a 657d  ze: {train_size}
-0002e000: 206f 6620 7479 7065 207b 7479 7065 2874   of type {type(t
-0002e010: 7261 696e 5f73 697a 6529 7d22 290a 2020  rain_size)}").  
-0002e020: 2020 2020 2020 6966 2074 6573 745f 7369        if test_si
-0002e030: 7a65 2069 7320 6e6f 7420 4e6f 6e65 2061  ze is not None a
-0002e040: 6e64 206e 6f74 2069 7369 6e73 7461 6e63  nd not isinstanc
-0002e050: 6528 7465 7374 5f73 697a 652c 2028 696e  e(test_size, (in
-0002e060: 742c 2066 6c6f 6174 2929 3a0a 2020 2020  t, float)):.    
-0002e070: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0002e080: 6c75 6545 7272 6f72 2866 2249 6e76 616c  lueError(f"Inval
-0002e090: 6964 2076 616c 7565 2066 6f72 2074 6573  id value for tes
-0002e0a0: 745f 7369 7a65 3a20 7b74 6573 745f 7369  t_size: {test_si
-0002e0b0: 7a65 7d20 6f66 2074 7970 6520 7b74 7970  ze} of type {typ
-0002e0c0: 6528 7465 7374 5f73 697a 6529 7d22 290a  e(test_size)}").
-0002e0d0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-0002e0e0: 7374 616e 6365 2874 7261 696e 5f73 697a  stance(train_siz
-0002e0f0: 652c 2066 6c6f 6174 2920 616e 6420 6973  e, float) and is
-0002e100: 696e 7374 616e 6365 2874 6573 745f 7369  instance(test_si
-0002e110: 7a65 2c20 666c 6f61 7429 2061 6e64 2074  ze, float) and t
-0002e120: 7261 696e 5f73 697a 6520 2b20 7465 7374  rain_size + test
-0002e130: 5f73 697a 6520 3e20 313a 0a20 2020 2020  _size > 1:.     
-0002e140: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0002e150: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-0002e160: 2020 2020 2020 2020 2066 2254 6865 2073           f"The s
-0002e170: 756d 206f 6620 7465 7374 5f73 697a 6520  um of test_size 
-0002e180: 616e 6420 7472 6169 6e5f 7369 7a65 203d  and train_size =
-0002e190: 207b 7472 6169 6e5f 7369 7a65 202b 2074   {train_size + t
-0002e1a0: 6573 745f 7369 7a65 7d2c 2073 686f 756c  est_size}, shoul
-0002e1b0: 6420 6265 2069 6e20 7468 6520 2830 2c20  d be in the (0, 
-0002e1c0: 3129 220a 2020 2020 2020 2020 2020 2020  1)".            
-0002e1d0: 2020 2020 2220 7261 6e67 652e 2052 6564      " range. Red
-0002e1e0: 7563 6520 7465 7374 5f73 697a 6520 616e  uce test_size an
-0002e1f0: 642f 6f72 2074 7261 696e 5f73 697a 652e  d/or train_size.
-0002e200: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-0002e210: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-0002e220: 7374 616e 6365 2874 6573 745f 7369 7a65  stance(test_size
-0002e230: 2c20 666c 6f61 7429 3a0a 2020 2020 2020  , float):.      
-0002e240: 2020 2020 2020 6e5f 7465 7374 203d 2063        n_test = c
-0002e250: 6569 6c28 7465 7374 5f73 697a 6520 2a20  eil(test_size * 
-0002e260: 6e5f 7361 6d70 6c65 7329 0a20 2020 2020  n_samples).     
-0002e270: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0002e280: 6365 2874 6573 745f 7369 7a65 2c20 696e  ce(test_size, in
-0002e290: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0002e2a0: 6e5f 7465 7374 203d 2066 6c6f 6174 2874  n_test = float(t
-0002e2b0: 6573 745f 7369 7a65 290a 0a20 2020 2020  est_size)..     
-0002e2c0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0002e2d0: 2874 7261 696e 5f73 697a 652c 2066 6c6f  (train_size, flo
-0002e2e0: 6174 293a 0a20 2020 2020 2020 2020 2020  at):.           
-0002e2f0: 206e 5f74 7261 696e 203d 2066 6c6f 6f72   n_train = floor
-0002e300: 2874 7261 696e 5f73 697a 6520 2a20 6e5f  (train_size * n_
-0002e310: 7361 6d70 6c65 7329 0a20 2020 2020 2020  samples).       
-0002e320: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-0002e330: 2874 7261 696e 5f73 697a 652c 2069 6e74  (train_size, int
-0002e340: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
-0002e350: 5f74 7261 696e 203d 2066 6c6f 6174 2874  _train = float(t
-0002e360: 7261 696e 5f73 697a 6529 0a0a 2020 2020  rain_size)..    
-0002e370: 2020 2020 6966 2074 7261 696e 5f73 697a      if train_siz
-0002e380: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-0002e390: 2020 2020 2020 206e 5f74 7261 696e 203d         n_train =
-0002e3a0: 206e 5f73 616d 706c 6573 202d 206e 5f74   n_samples - n_t
-0002e3b0: 6573 740a 2020 2020 2020 2020 656c 6966  est.        elif
-0002e3c0: 2074 6573 745f 7369 7a65 2069 7320 4e6f   test_size is No
-0002e3d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0002e3e0: 6e5f 7465 7374 203d 206e 5f73 616d 706c  n_test = n_sampl
-0002e3f0: 6573 202d 206e 5f74 7261 696e 0a0a 2020  es - n_train..  
-0002e400: 2020 2020 2020 6966 206e 5f74 7261 696e        if n_train
-0002e410: 202b 206e 5f74 6573 7420 3e20 6e5f 7361   + n_test > n_sa
-0002e420: 6d70 6c65 733a 0a20 2020 2020 2020 2020  mples:.         
-0002e430: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0002e440: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0002e450: 2020 2020 2066 2254 6865 2073 756d 206f       f"The sum o
-0002e460: 6620 7472 6169 6e5f 7369 7a65 2061 6e64  f train_size and
-0002e470: 2074 6573 745f 7369 7a65 203d 207b 6e5f   test_size = {n_
-0002e480: 7472 6169 6e20 2b20 6e5f 7465 7374 7d2c  train + n_test},
-0002e490: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0002e4a0: 2020 2022 7368 6f75 6c64 2062 6520 736d     "should be sm
-0002e4b0: 616c 6c65 7220 7468 616e 2074 6865 206e  aller than the n
-0002e4c0: 756d 6265 7220 6f66 2022 0a20 2020 2020  umber of ".     
-0002e4d0: 2020 2020 2020 2020 2020 2066 2273 616d             f"sam
-0002e4e0: 706c 6573 207b 6e5f 7361 6d70 6c65 737d  ples {n_samples}
-0002e4f0: 2e20 5265 6475 6365 2074 6573 745f 7369  . Reduce test_si
-0002e500: 7a65 2061 6e64 2f6f 7220 220a 2020 2020  ze and/or ".    
-0002e510: 2020 2020 2020 2020 2020 2020 2274 7261              "tra
-0002e520: 696e 5f73 697a 652e 220a 2020 2020 2020  in_size.".      
-0002e530: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0002e540: 206e 5f74 7261 696e 2c20 6e5f 7465 7374   n_train, n_test
-0002e550: 203d 2069 6e74 286e 5f74 7261 696e 292c   = int(n_train),
-0002e560: 2069 6e74 286e 5f74 6573 7429 0a0a 2020   int(n_test)..  
-0002e570: 2020 2020 2020 6966 206e 5f74 7261 696e        if n_train
-0002e580: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0002e590: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0002e5a0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0002e5b0: 2020 2020 2066 2257 6974 6820 6e5f 7361       f"With n_sa
-0002e5c0: 6d70 6c65 733d 7b6e 5f73 616d 706c 6573  mples={n_samples
-0002e5d0: 7d2c 2074 6573 745f 7369 7a65 3d7b 7465  }, test_size={te
-0002e5e0: 7374 5f73 697a 657d 2061 6e64 2074 7261  st_size} and tra
-0002e5f0: 696e 5f73 697a 653d 7b74 7261 696e 5f73  in_size={train_s
-0002e600: 697a 657d 2c20 7468 6520 220a 2020 2020  ize}, the ".    
-0002e610: 2020 2020 2020 2020 2020 2020 2272 6573              "res
-0002e620: 756c 7469 6e67 2074 7261 696e 2073 6574  ulting train set
-0002e630: 2077 696c 6c20 6265 2065 6d70 7479 2e20   will be empty. 
-0002e640: 4164 6a75 7374 2061 6e79 206f 6620 7468  Adjust any of th
-0002e650: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-0002e660: 2020 2020 2261 666f 7265 6d65 6e74 696f      "aforementio
-0002e670: 6e65 6420 7061 7261 6d65 7465 7273 2e22  ned parameters."
-0002e680: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0002e690: 2020 2020 2020 2020 6966 2067 656e 6572          if gener
-0002e6a0: 6174 6f72 2069 7320 4e6f 6e65 2061 6e64  ator is None and
-0002e6b0: 2073 6875 6666 6c65 2069 7320 5472 7565   shuffle is True
-0002e6c0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0002e6d0: 2073 6565 6420 6973 204e 6f6e 653a 0a20   seed is None:. 
-0002e6e0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-0002e6f0: 2c20 7365 6564 2c20 706f 732c 202a 5f20  , seed, pos, *_ 
-0002e700: 3d20 6e70 2e72 616e 646f 6d2e 6765 745f  = np.random.get_
-0002e710: 7374 6174 6528 290a 2020 2020 2020 2020  state().        
-0002e720: 2020 2020 2020 2020 7365 6564 203d 2073          seed = s
-0002e730: 6565 645b 706f 735d 2069 6620 706f 7320  eed[pos] if pos 
-0002e740: 3c20 3632 3420 656c 7365 2073 6565 645b  < 624 else seed[
-0002e750: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
-0002e760: 2020 205f 203d 206e 702e 7261 6e64 6f6d     _ = np.random
-0002e770: 2e72 616e 646f 6d28 2920 2023 2064 6f20  .random()  # do 
-0002e780: 3120 7374 6570 206f 6620 726e 670a 2020  1 step of rng.  
-0002e790: 2020 2020 2020 2020 2020 6765 6e65 7261            genera
-0002e7a0: 746f 7220 3d20 6e70 2e72 616e 646f 6d2e  tor = np.random.
-0002e7b0: 6465 6661 756c 745f 726e 6728 7365 6564  default_rng(seed
-0002e7c0: 290a 0a20 2020 2020 2020 2023 2043 6865  )..        # Che
-0002e7d0: 636b 2069 6620 7765 2776 6520 616c 7265  ck if we've alre
-0002e7e0: 6164 7920 6361 6368 6564 2074 6869 7320  ady cached this 
-0002e7f0: 636f 6d70 7574 6174 696f 6e20 2869 6e64  computation (ind
-0002e800: 6578 6564 2062 7920 6120 6861 7368 290a  exed by a hash).
-0002e810: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0002e820: 6361 6368 655f 6669 6c65 733a 0a20 2020  cache_files:.   
-0002e830: 2020 2020 2020 2020 2069 6620 7472 6169           if trai
-0002e840: 6e5f 696e 6469 6365 735f 6361 6368 655f  n_indices_cache_
-0002e850: 6669 6c65 5f6e 616d 6520 6973 204e 6f6e  file_name is Non
-0002e860: 6520 6f72 2074 6573 745f 696e 6469 6365  e or test_indice
-0002e870: 735f 6361 6368 655f 6669 6c65 5f6e 616d  s_cache_file_nam
-0002e880: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-0002e890: 2020 2020 2020 2020 2020 2023 2077 6520             # we 
-0002e8a0: 6372 6561 7465 2061 2075 6e69 7175 6520  create a unique 
-0002e8b0: 6861 7368 2066 726f 6d20 7468 6520 6675  hash from the fu
-0002e8c0: 6e63 7469 6f6e 2c20 6375 7272 656e 7420  nction, current 
-0002e8d0: 6461 7461 7365 7420 6669 6c65 2061 6e64  dataset file and
-0002e8e0: 2074 6865 206d 6170 7069 6e67 2061 7267   the mapping arg
-0002e8f0: 730a 0a20 2020 2020 2020 2020 2020 2020  s..             
-0002e900: 2020 2069 6620 7472 6169 6e5f 696e 6469     if train_indi
-0002e910: 6365 735f 6361 6368 655f 6669 6c65 5f6e  ces_cache_file_n
-0002e920: 616d 6520 6973 204e 6f6e 653a 0a20 2020  ame is None:.   
-0002e930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e940: 2074 7261 696e 5f69 6e64 6963 6573 5f63   train_indices_c
-0002e950: 6163 6865 5f66 696c 655f 6e61 6d65 203d  ache_file_name =
-0002e960: 2073 656c 662e 5f67 6574 5f63 6163 6865   self._get_cache
-0002e970: 5f66 696c 655f 7061 7468 2874 7261 696e  _file_path(train
-0002e980: 5f6e 6577 5f66 696e 6765 7270 7269 6e74  _new_fingerprint
-0002e990: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002e9a0: 2020 6966 2074 6573 745f 696e 6469 6365    if test_indice
-0002e9b0: 735f 6361 6368 655f 6669 6c65 5f6e 616d  s_cache_file_nam
-0002e9c0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-0002e9d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0002e9e0: 6573 745f 696e 6469 6365 735f 6361 6368  est_indices_cach
-0002e9f0: 655f 6669 6c65 5f6e 616d 6520 3d20 7365  e_file_name = se
-0002ea00: 6c66 2e5f 6765 745f 6361 6368 655f 6669  lf._get_cache_fi
-0002ea10: 6c65 5f70 6174 6828 7465 7374 5f6e 6577  le_path(test_new
-0002ea20: 5f66 696e 6765 7270 7269 6e74 290a 2020  _fingerprint).  
-0002ea30: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
-0002ea40: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0002ea50: 732e 7061 7468 2e65 7869 7374 7328 7472  s.path.exists(tr
-0002ea60: 6169 6e5f 696e 6469 6365 735f 6361 6368  ain_indices_cach
-0002ea70: 655f 6669 6c65 5f6e 616d 6529 0a20 2020  e_file_name).   
-0002ea80: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-0002ea90: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0002eaa0: 7465 7374 5f69 6e64 6963 6573 5f63 6163  test_indices_cac
-0002eab0: 6865 5f66 696c 655f 6e61 6d65 290a 2020  he_file_name).  
-0002eac0: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0002ead0: 6420 6c6f 6164 5f66 726f 6d5f 6361 6368  d load_from_cach
-0002eae0: 655f 6669 6c65 0a20 2020 2020 2020 2020  e_file.         
-0002eaf0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-0002eb00: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
-0002eb10: 6e69 6e67 280a 2020 2020 2020 2020 2020  ning(.          
-0002eb20: 2020 2020 2020 2020 2020 6622 4c6f 6164            f"Load
-0002eb30: 696e 6720 6361 6368 6564 2073 706c 6974  ing cached split
-0002eb40: 2069 6e64 6963 6573 2066 6f72 2064 6174   indices for dat
-0002eb50: 6173 6574 2061 7420 7b74 7261 696e 5f69  aset at {train_i
-0002eb60: 6e64 6963 6573 5f63 6163 6865 5f66 696c  ndices_cache_fil
-0002eb70: 655f 6e61 6d65 7d20 616e 6420 7b74 6573  e_name} and {tes
-0002eb80: 745f 696e 6469 6365 735f 6361 6368 655f  t_indices_cache_
-0002eb90: 6669 6c65 5f6e 616d 657d 220a 2020 2020  file_name}".    
-0002eba0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0002ebb0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0002ebc0: 7475 726e 2044 6174 6173 6574 4469 6374  turn DatasetDict
-0002ebd0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0002ebe0: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
-0002ebf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ec00: 2274 7261 696e 223a 2073 656c 662e 5f6e  "train": self._n
-0002ec10: 6577 5f64 6174 6173 6574 5f77 6974 685f  ew_dataset_with_
-0002ec20: 696e 6469 6365 7328 0a20 2020 2020 2020  indices(.       
-0002ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ec40: 2020 2020 2066 696e 6765 7270 7269 6e74       fingerprint
-0002ec50: 3d74 7261 696e 5f6e 6577 5f66 696e 6765  =train_new_finge
-0002ec60: 7270 7269 6e74 2c20 696e 6469 6365 735f  rprint, indices_
-0002ec70: 6361 6368 655f 6669 6c65 5f6e 616d 653d  cache_file_name=
-0002ec80: 7472 6169 6e5f 696e 6469 6365 735f 6361  train_indices_ca
-0002ec90: 6368 655f 6669 6c65 5f6e 616d 650a 2020  che_file_name.  
-0002eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ecb0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-0002ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ecd0: 2022 7465 7374 223a 2073 656c 662e 5f6e   "test": self._n
-0002ece0: 6577 5f64 6174 6173 6574 5f77 6974 685f  ew_dataset_with_
-0002ecf0: 696e 6469 6365 7328 0a20 2020 2020 2020  indices(.       
-0002ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ed10: 2020 2020 2066 696e 6765 7270 7269 6e74       fingerprint
-0002ed20: 3d74 6573 745f 6e65 775f 6669 6e67 6572  =test_new_finger
-0002ed30: 7072 696e 742c 2069 6e64 6963 6573 5f63  print, indices_c
-0002ed40: 6163 6865 5f66 696c 655f 6e61 6d65 3d74  ache_file_name=t
-0002ed50: 6573 745f 696e 6469 6365 735f 6361 6368  est_indices_cach
-0002ed60: 655f 6669 6c65 5f6e 616d 650a 2020 2020  e_file_name.    
-0002ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ed80: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-0002ed90: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-0002eda0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0002edb0: 2020 2020 2020 2069 6620 6e6f 7420 7368         if not sh
-0002edc0: 7566 666c 653a 0a20 2020 2020 2020 2020  uffle:.         
-0002edd0: 2020 2069 6620 7374 7261 7469 6679 5f62     if stratify_b
-0002ede0: 795f 636f 6c75 6d6e 2069 7320 6e6f 7420  y_column is not 
-0002edf0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0002ee00: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0002ee10: 6545 7272 6f72 2822 5374 7261 7469 6669  eError("Stratifi
-0002ee20: 6564 2074 7261 696e 2f74 6573 7420 7370  ed train/test sp
-0002ee30: 6c69 7420 6973 206e 6f74 2069 6d70 6c65  lit is not imple
-0002ee40: 6d65 6e74 6564 2066 6f72 2060 7368 7566  mented for `shuf
-0002ee50: 666c 653d 4661 6c73 6560 2229 0a20 2020  fle=False`").   
-0002ee60: 2020 2020 2020 2020 2074 7261 696e 5f69           train_i
-0002ee70: 6e64 6963 6573 203d 206e 702e 6172 616e  ndices = np.aran
-0002ee80: 6765 286e 5f74 7261 696e 290a 2020 2020  ge(n_train).    
-0002ee90: 2020 2020 2020 2020 7465 7374 5f69 6e64          test_ind
-0002eea0: 6963 6573 203d 206e 702e 6172 616e 6765  ices = np.arange
-0002eeb0: 286e 5f74 7261 696e 2c20 6e5f 7472 6169  (n_train, n_trai
-0002eec0: 6e20 2b20 6e5f 7465 7374 290a 2020 2020  n + n_test).    
-0002eed0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002eee0: 2020 2020 2020 2320 7374 7261 7469 6669        # stratifi
-0002eef0: 6564 2070 6172 7469 7469 6f6e 0a20 2020  ed partition.   
-0002ef00: 2020 2020 2020 2020 2069 6620 7374 7261           if stra
-0002ef10: 7469 6679 5f62 795f 636f 6c75 6d6e 2069  tify_by_column i
-0002ef20: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0002ef30: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0002ef40: 7472 6174 6966 795f 6279 5f63 6f6c 756d  tratify_by_colum
-0002ef50: 6e20 6e6f 7420 696e 2073 656c 662e 6665  n not in self.fe
-0002ef60: 6174 7572 6573 2e6b 6579 7328 293a 0a20  atures.keys():. 
-0002ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ef80: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0002ef90: 726f 7228 6622 4b65 7920 7b73 7472 6174  ror(f"Key {strat
-0002efa0: 6966 795f 6279 5f63 6f6c 756d 6e7d 206e  ify_by_column} n
-0002efb0: 6f74 2066 6f75 6e64 2069 6e20 7b73 656c  ot found in {sel
-0002efc0: 662e 6665 6174 7572 6573 2e6b 6579 7328  f.features.keys(
-0002efd0: 297d 2229 0a20 2020 2020 2020 2020 2020  )}").           
-0002efe0: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-0002eff0: 7374 616e 6365 2873 656c 662e 6665 6174  stance(self.feat
-0002f000: 7572 6573 5b73 7472 6174 6966 795f 6279  ures[stratify_by
-0002f010: 5f63 6f6c 756d 6e5d 2c20 436c 6173 734c  _column], ClassL
-0002f020: 6162 656c 293a 0a20 2020 2020 2020 2020  abel):.         
-0002f030: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0002f040: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-0002f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f060: 2020 2020 2066 2253 7472 6174 6966 7969       f"Stratifyi
-0002f070: 6e67 2062 7920 636f 6c75 6d6e 2069 7320  ng by column is 
-0002f080: 6f6e 6c79 2073 7570 706f 7274 6564 2066  only supported f
-0002f090: 6f72 207b 436c 6173 734c 6162 656c 2e5f  or {ClassLabel._
-0002f0a0: 5f6e 616d 655f 5f7d 2063 6f6c 756d 6e2c  _name__} column,
-0002f0b0: 2061 6e64 2063 6f6c 756d 6e20 7b73 7472   and column {str
-0002f0c0: 6174 6966 795f 6279 5f63 6f6c 756d 6e7d  atify_by_column}
-0002f0d0: 2069 7320 7b74 7970 6528 7365 6c66 2e66   is {type(self.f
-0002f0e0: 6561 7475 7265 735b 7374 7261 7469 6679  eatures[stratify
-0002f0f0: 5f62 795f 636f 6c75 6d6e 5d29 2e5f 5f6e  _by_column]).__n
-0002f100: 616d 655f 5f7d 2e22 0a20 2020 2020 2020  ame__}.".       
-0002f110: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0002f120: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0002f130: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0002f140: 2020 2020 2020 2020 7472 6169 6e5f 696e          train_in
-0002f150: 6469 6365 732c 2074 6573 745f 696e 6469  dices, test_indi
-0002f160: 6365 7320 3d20 6e65 7874 280a 2020 2020  ces = next(.    
-0002f170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f180: 2020 2020 7374 7261 7469 6669 6564 5f73      stratified_s
-0002f190: 6875 6666 6c65 5f73 706c 6974 5f67 656e  huffle_split_gen
-0002f1a0: 6572 6174 655f 696e 6469 6365 7328 0a20  erate_indices(. 
-0002f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f1c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0002f1d0: 7769 7468 5f66 6f72 6d61 7428 226e 756d  with_format("num
-0002f1e0: 7079 2229 5b73 7472 6174 6966 795f 6279  py")[stratify_by
-0002f1f0: 5f63 6f6c 756d 6e5d 2c20 6e5f 7472 6169  _column], n_trai
-0002f200: 6e2c 206e 5f74 6573 742c 2072 6e67 3d67  n, n_test, rng=g
-0002f210: 656e 6572 6174 6f72 0a20 2020 2020 2020  enerator.       
-0002f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f230: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0002f240: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0002f250: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0002f260: 4578 6365 7074 696f 6e20 6173 2065 7272  Exception as err
-0002f270: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-0002f280: 2020 2020 2020 2020 6966 2073 7472 2865          if str(e
-0002f290: 7272 6f72 2920 3d3d 2022 4d69 6e69 6d75  rror) == "Minimu
-0002f2a0: 6d20 636c 6173 7320 636f 756e 7420 6572  m class count er
-0002f2b0: 726f 7222 3a0a 2020 2020 2020 2020 2020  ror":.          
-0002f2c0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0002f2d0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-0002f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f2f0: 2020 2020 2020 2020 2020 2020 6622 5468              f"Th
-0002f300: 6520 6c65 6173 7420 706f 7075 6c61 7465  e least populate
-0002f310: 6420 636c 6173 7320 696e 207b 7374 7261  d class in {stra
-0002f320: 7469 6679 5f62 795f 636f 6c75 6d6e 7d20  tify_by_column} 
-0002f330: 636f 6c75 6d6e 2068 6173 206f 6e6c 7920  column has only 
-0002f340: 3122 0a20 2020 2020 2020 2020 2020 2020  1".             
-0002f350: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0002f360: 206d 656d 6265 722c 2077 6869 6368 2069   member, which i
-0002f370: 7320 746f 6f20 6665 772e 2054 6865 206d  s too few. The m
-0002f380: 696e 696d 756d 220a 2020 2020 2020 2020  inimum".        
-0002f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f3a0: 2020 2020 2220 6e75 6d62 6572 206f 6620      " number of 
-0002f3b0: 6772 6f75 7073 2066 6f72 2061 6e79 2063  groups for any c
-0002f3c0: 6c61 7373 2063 616e 6e6f 7422 0a20 2020  lass cannot".   
-0002f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f3e0: 2020 2020 2020 2020 2022 2062 6520 6c65           " be le
-0002f3f0: 7373 2074 6861 6e20 322e 220a 2020 2020  ss than 2.".    
-0002f400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f410: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0002f420: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0002f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f440: 2020 2020 2020 2020 7261 6973 6520 6572          raise er
-0002f450: 726f 720a 0a20 2020 2020 2020 2020 2020  ror..           
-0002f460: 2023 2072 616e 646f 6d20 7061 7274 6974   # random partit
-0002f470: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-0002f480: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0002f490: 2020 2020 2020 7065 726d 7574 6174 696f        permutatio
-0002f4a0: 6e20 3d20 6765 6e65 7261 746f 722e 7065  n = generator.pe
-0002f4b0: 726d 7574 6174 696f 6e28 6c65 6e28 7365  rmutation(len(se
-0002f4c0: 6c66 2929 0a20 2020 2020 2020 2020 2020  lf)).           
-0002f4d0: 2020 2020 2074 6573 745f 696e 6469 6365       test_indice
-0002f4e0: 7320 3d20 7065 726d 7574 6174 696f 6e5b  s = permutation[
-0002f4f0: 3a6e 5f74 6573 745d 0a20 2020 2020 2020  :n_test].       
-0002f500: 2020 2020 2020 2020 2074 7261 696e 5f69           train_i
-0002f510: 6e64 6963 6573 203d 2070 6572 6d75 7461  ndices = permuta
-0002f520: 7469 6f6e 5b6e 5f74 6573 7420 3a20 286e  tion[n_test : (n
-0002f530: 5f74 6573 7420 2b20 6e5f 7472 6169 6e29  _test + n_train)
-0002f540: 5d0a 0a20 2020 2020 2020 2074 7261 696e  ]..        train
-0002f550: 5f73 706c 6974 203d 2073 656c 662e 7365  _split = self.se
-0002f560: 6c65 6374 280a 2020 2020 2020 2020 2020  lect(.          
-0002f570: 2020 696e 6469 6365 733d 7472 6169 6e5f    indices=train_
-0002f580: 696e 6469 6365 732c 0a20 2020 2020 2020  indices,.       
-0002f590: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
-0002f5a0: 6f72 793d 6b65 6570 5f69 6e5f 6d65 6d6f  ory=keep_in_memo
-0002f5b0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
-0002f5c0: 696e 6469 6365 735f 6361 6368 655f 6669  indices_cache_fi
-0002f5d0: 6c65 5f6e 616d 653d 7472 6169 6e5f 696e  le_name=train_in
-0002f5e0: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
-0002f5f0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-0002f600: 2020 2077 7269 7465 725f 6261 7463 685f     writer_batch_
-0002f610: 7369 7a65 3d77 7269 7465 725f 6261 7463  size=writer_batc
-0002f620: 685f 7369 7a65 2c0a 2020 2020 2020 2020  h_size,.        
-0002f630: 2020 2020 6e65 775f 6669 6e67 6572 7072      new_fingerpr
-0002f640: 696e 743d 7472 6169 6e5f 6e65 775f 6669  int=train_new_fi
-0002f650: 6e67 6572 7072 696e 742c 0a20 2020 2020  ngerprint,.     
-0002f660: 2020 2029 0a20 2020 2020 2020 2074 6573     ).        tes
-0002f670: 745f 7370 6c69 7420 3d20 7365 6c66 2e73  t_split = self.s
-0002f680: 656c 6563 7428 0a20 2020 2020 2020 2020  elect(.         
-0002f690: 2020 2069 6e64 6963 6573 3d74 6573 745f     indices=test_
-0002f6a0: 696e 6469 6365 732c 0a20 2020 2020 2020  indices,.       
-0002f6b0: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
-0002f6c0: 6f72 793d 6b65 6570 5f69 6e5f 6d65 6d6f  ory=keep_in_memo
-0002f6d0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
-0002f6e0: 696e 6469 6365 735f 6361 6368 655f 6669  indices_cache_fi
-0002f6f0: 6c65 5f6e 616d 653d 7465 7374 5f69 6e64  le_name=test_ind
-0002f700: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
-0002f710: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-0002f720: 2020 7772 6974 6572 5f62 6174 6368 5f73    writer_batch_s
-0002f730: 697a 653d 7772 6974 6572 5f62 6174 6368  ize=writer_batch
-0002f740: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-0002f750: 2020 206e 6577 5f66 696e 6765 7270 7269     new_fingerpri
-0002f760: 6e74 3d74 6573 745f 6e65 775f 6669 6e67  nt=test_new_fing
-0002f770: 6572 7072 696e 742c 0a20 2020 2020 2020  erprint,.       
-0002f780: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
-0002f790: 726e 2044 6174 6173 6574 4469 6374 287b  rn DatasetDict({
-0002f7a0: 2274 7261 696e 223a 2074 7261 696e 5f73  "train": train_s
-0002f7b0: 706c 6974 2c20 2274 6573 7422 3a20 7465  plit, "test": te
-0002f7c0: 7374 5f73 706c 6974 7d29 0a0a 2020 2020  st_split})..    
-0002f7d0: 6465 6620 7368 6172 6428 0a20 2020 2020  def shard(.     
-0002f7e0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0002f7f0: 206e 756d 5f73 6861 7264 733a 2069 6e74   num_shards: int
-0002f800: 2c0a 2020 2020 2020 2020 696e 6465 783a  ,.        index:
-0002f810: 2069 6e74 2c0a 2020 2020 2020 2020 636f   int,.        co
-0002f820: 6e74 6967 756f 7573 3a20 626f 6f6c 203d  ntiguous: bool =
-0002f830: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-0002f840: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 3a20  keep_in_memory: 
-0002f850: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0002f860: 2020 2020 2020 696e 6469 6365 735f 6361        indices_ca
-0002f870: 6368 655f 6669 6c65 5f6e 616d 653a 204f  che_file_name: O
-0002f880: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-0002f890: 6f6e 652c 0a20 2020 2020 2020 2077 7269  one,.        wri
-0002f8a0: 7465 725f 6261 7463 685f 7369 7a65 3a20  ter_batch_size: 
-0002f8b0: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
-0002f8c0: 3130 3030 2c0a 2020 2020 2920 2d3e 2022  1000,.    ) -> "
-0002f8d0: 4461 7461 7365 7422 3a0a 2020 2020 2020  Dataset":.      
-0002f8e0: 2020 2222 2252 6574 7572 6e20 7468 6520    """Return the 
-0002f8f0: 6069 6e64 6578 602d 6e74 6820 7368 6172  `index`-nth shar
-0002f900: 6420 6672 6f6d 2064 6174 6173 6574 2073  d from dataset s
-0002f910: 706c 6974 2069 6e74 6f20 606e 756d 5f73  plit into `num_s
-0002f920: 6861 7264 7360 2070 6965 6365 732e 0a0a  hards` pieces...
-0002f930: 2020 2020 2020 2020 5468 6973 2073 6861          This sha
-0002f940: 7264 7320 6465 7465 726d 696e 6973 7469  rds deterministi
-0002f950: 6361 6c6c 792e 2060 6473 6574 2e73 6861  cally. `dset.sha
-0002f960: 7264 286e 2c20 6929 6020 7769 6c6c 2063  rd(n, i)` will c
-0002f970: 6f6e 7461 696e 2061 6c6c 2065 6c65 6d65  ontain all eleme
-0002f980: 6e74 7320 6f66 2064 7365 7420 7768 6f73  nts of dset whos
-0002f990: 650a 2020 2020 2020 2020 696e 6465 7820  e.        index 
-0002f9a0: 6d6f 6420 606e 203d 2069 602e 0a0a 2020  mod `n = i`...  
-0002f9b0: 2020 2020 2020 6064 7365 742e 7368 6172        `dset.shar
-0002f9c0: 6428 6e2c 2069 2c20 636f 6e74 6967 756f  d(n, i, contiguo
-0002f9d0: 7573 3d54 7275 6529 6020 7769 6c6c 2069  us=True)` will i
-0002f9e0: 6e73 7465 6164 2073 706c 6974 2064 7365  nstead split dse
-0002f9f0: 7420 696e 746f 2063 6f6e 7469 6775 6f75  t into contiguou
-0002fa00: 7320 6368 756e 6b73 2c0a 2020 2020 2020  s chunks,.      
-0002fa10: 2020 736f 2069 7420 6361 6e20 6265 2065    so it can be e
-0002fa20: 6173 696c 7920 636f 6e63 6174 656e 6174  asily concatenat
-0002fa30: 6564 2062 6163 6b20 746f 6765 7468 6572  ed back together
-0002fa40: 2061 6674 6572 2070 726f 6365 7373 696e   after processin
-0002fa50: 672e 2049 6620 606e 2025 2069 203d 3d20  g. If `n % i == 
-0002fa60: 6c60 2c20 7468 656e 2074 6865 0a20 2020  l`, then the.   
-0002fa70: 2020 2020 2066 6972 7374 2060 6c60 2073       first `l` s
-0002fa80: 6861 7264 7320 7769 6c6c 2068 6176 6520  hards will have 
-0002fa90: 6c65 6e67 7468 2060 286e 202f 2f20 6929  length `(n // i)
-0002faa0: 202b 2031 602c 2061 6e64 2074 6865 2072   + 1`, and the r
-0002fab0: 656d 6169 6e69 6e67 2073 6861 7264 7320  emaining shards 
-0002fac0: 7769 6c6c 2068 6176 6520 6c65 6e67 7468  will have length
-0002fad0: 2060 286e 202f 2f20 6929 602e 0a20 2020   `(n // i)`..   
-0002fae0: 2020 2020 2060 6461 7461 7365 7473 2e63       `datasets.c
-0002faf0: 6f6e 6361 7465 6e61 7465 285b 6473 6574  oncatenate([dset
-0002fb00: 2e73 6861 7264 286e 2c20 692c 2063 6f6e  .shard(n, i, con
-0002fb10: 7469 6775 6f75 733d 5472 7565 2920 666f  tiguous=True) fo
-0002fb20: 7220 6920 696e 2072 616e 6765 286e 295d  r i in range(n)]
-0002fb30: 2960 2077 696c 6c20 7265 7475 726e 0a20  )` will return. 
-0002fb40: 2020 2020 2020 2061 2064 6174 6173 6574         a dataset
-0002fb50: 2077 6974 6820 7468 6520 7361 6d65 206f   with the same o
-0002fb60: 7264 6572 2061 7320 7468 6520 6f72 6967  rder as the orig
-0002fb70: 696e 616c 2e0a 0a20 2020 2020 2020 2042  inal...        B
-0002fb80: 6520 7375 7265 2074 6f20 7368 6172 6420  e sure to shard 
-0002fb90: 6265 666f 7265 2075 7369 6e67 2061 6e79  before using any
-0002fba0: 2072 616e 646f 6d69 7a69 6e67 206f 7065   randomizing ope
-0002fbb0: 7261 746f 7220 2873 7563 6820 6173 2060  rator (such as `
-0002fbc0: 7368 7566 666c 6560 292e 0a20 2020 2020  shuffle`)..     
-0002fbd0: 2020 2049 7420 6973 2062 6573 7420 6966     It is best if
-0002fbe0: 2074 6865 2073 6861 7264 206f 7065 7261   the shard opera
-0002fbf0: 746f 7220 6973 2075 7365 6420 6561 726c  tor is used earl
-0002fc00: 7920 696e 2074 6865 2064 6174 6173 6574  y in the dataset
-0002fc10: 2070 6970 656c 696e 652e 0a0a 0a20 2020   pipeline....   
-0002fc20: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-0002fc30: 2020 2020 2020 206e 756d 5f73 6861 7264         num_shard
-0002fc40: 7320 2860 696e 7460 293a 0a20 2020 2020  s (`int`):.     
-0002fc50: 2020 2020 2020 2020 2020 2048 6f77 206d             How m
-0002fc60: 616e 7920 7368 6172 6473 2074 6f20 7370  any shards to sp
-0002fc70: 6c69 7420 7468 6520 6461 7461 7365 7420  lit the dataset 
-0002fc80: 696e 746f 2e0a 2020 2020 2020 2020 2020  into..          
-0002fc90: 2020 696e 6465 7820 2860 696e 7460 293a    index (`int`):
-0002fca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002fcb0: 2057 6869 6368 2073 6861 7264 2074 6f20   Which shard to 
-0002fcc0: 7365 6c65 6374 2061 6e64 2072 6574 7572  select and retur
-0002fcd0: 6e2e 0a20 2020 2020 2020 2020 2020 2063  n..            c
-0002fce0: 6f6e 7469 6775 6f75 733a 2028 6062 6f6f  ontiguous: (`boo
-0002fcf0: 6c60 2c20 6465 6661 756c 7473 2074 6f20  l`, defaults to 
-0002fd00: 6046 616c 7365 6029 3a0a 2020 2020 2020  `False`):.      
-0002fd10: 2020 2020 2020 2020 2020 5768 6574 6865            Whethe
-0002fd20: 7220 746f 2073 656c 6563 7420 636f 6e74  r to select cont
-0002fd30: 6967 756f 7573 2062 6c6f 636b 7320 6f66  iguous blocks of
-0002fd40: 2069 6e64 6963 6573 2066 6f72 2073 6861   indices for sha
-0002fd50: 7264 732e 0a20 2020 2020 2020 2020 2020  rds..           
-0002fd60: 206b 6565 705f 696e 5f6d 656d 6f72 7920   keep_in_memory 
-0002fd70: 2860 626f 6f6c 602c 2064 6566 6175 6c74  (`bool`, default
-0002fd80: 7320 746f 2060 4661 6c73 6560 293a 0a20  s to `False`):. 
-0002fd90: 2020 2020 2020 2020 2020 2020 2020 204b                 K
-0002fda0: 6565 7020 7468 6520 6461 7461 7365 7420  eep the dataset 
-0002fdb0: 696e 206d 656d 6f72 7920 696e 7374 6561  in memory instea
-0002fdc0: 6420 6f66 2077 7269 7469 6e67 2069 7420  d of writing it 
-0002fdd0: 746f 2061 2063 6163 6865 2066 696c 652e  to a cache file.
-0002fde0: 0a20 2020 2020 2020 2020 2020 206c 6f61  .            loa
-0002fdf0: 645f 6672 6f6d 5f63 6163 6865 5f66 696c  d_from_cache_fil
-0002fe00: 6520 2860 626f 6f6c 602c 2064 6566 6175  e (`bool`, defau
-0002fe10: 6c74 7320 746f 2060 5472 7565 6029 3a0a  lts to `True`):.
-0002fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fe30: 4966 2061 2063 6163 6865 2066 696c 6520  If a cache file 
-0002fe40: 7374 6f72 696e 6720 7468 6520 6375 7272  storing the curr
-0002fe50: 656e 7420 636f 6d70 7574 6174 696f 6e20  ent computation 
-0002fe60: 6672 6f6d 2060 6675 6e63 7469 6f6e 600a  from `function`.
-0002fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fe80: 6361 6e20 6265 2069 6465 6e74 6966 6965  can be identifie
-0002fe90: 642c 2075 7365 2069 7420 696e 7374 6561  d, use it instea
-0002fea0: 6420 6f66 2072 6563 6f6d 7075 7469 6e67  d of recomputing
-0002feb0: 2e0a 2020 2020 2020 2020 2020 2020 696e  ..            in
-0002fec0: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
-0002fed0: 5f6e 616d 6520 2860 7374 7260 2c20 2a6f  _name (`str`, *o
-0002fee0: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
-0002fef0: 2020 2020 2020 2020 2020 2050 726f 7669             Provi
-0002ff00: 6465 2074 6865 206e 616d 6520 6f66 2061  de the name of a
-0002ff10: 2070 6174 6820 666f 7220 7468 6520 6361   path for the ca
-0002ff20: 6368 6520 6669 6c65 2e20 4974 2069 7320  che file. It is 
-0002ff30: 7573 6564 2074 6f20 7374 6f72 6520 7468  used to store th
-0002ff40: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0002ff50: 2020 696e 6469 6365 7320 6f66 2065 6163    indices of eac
-0002ff60: 6820 7368 6172 6420 696e 7374 6561 6420  h shard instead 
-0002ff70: 6f66 2074 6865 2061 7574 6f6d 6174 6963  of the automatic
-0002ff80: 616c 6c79 2067 656e 6572 6174 6564 2063  ally generated c
-0002ff90: 6163 6865 2066 696c 6520 6e61 6d65 2e0a  ache file name..
-0002ffa0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
-0002ffb0: 6572 5f62 6174 6368 5f73 697a 6520 2860  er_batch_size (`
-0002ffc0: 696e 7460 2c20 6465 6661 756c 7473 2074  int`, defaults t
-0002ffd0: 6f20 6031 3030 3060 293a 0a20 2020 2020  o `1000`):.     
-0002ffe0: 2020 2020 2020 2020 2020 204e 756d 6265             Numbe
-0002fff0: 7220 6f66 2072 6f77 7320 7065 7220 7772  r of rows per wr
-00030000: 6974 6520 6f70 6572 6174 696f 6e20 666f  ite operation fo
-00030010: 7220 7468 6520 6361 6368 6520 6669 6c65  r the cache file
-00030020: 2077 7269 7465 722e 0a20 2020 2020 2020   writer..       
-00030030: 2020 2020 2020 2020 2054 6869 7320 7661           This va
-00030040: 6c75 6520 6973 2061 2067 6f6f 6420 7472  lue is a good tr
-00030050: 6164 652d 6f66 6620 6265 7477 6565 6e20  ade-off between 
-00030060: 6d65 6d6f 7279 2075 7361 6765 2064 7572  memory usage dur
-00030070: 696e 6720 7468 6520 7072 6f63 6573 7369  ing the processi
-00030080: 6e67 2c20 616e 6420 7072 6f63 6573 7369  ng, and processi
-00030090: 6e67 2073 7065 6564 2e0a 2020 2020 2020  ng speed..      
-000300a0: 2020 2020 2020 2020 2020 4869 6768 6572            Higher
-000300b0: 2076 616c 7565 206d 616b 6573 2074 6865   value makes the
-000300c0: 2070 726f 6365 7373 696e 6720 646f 2066   processing do f
-000300d0: 6577 6572 206c 6f6f 6b75 7073 2c20 6c6f  ewer lookups, lo
-000300e0: 7765 7220 7661 6c75 6520 636f 6e73 756d  wer value consum
-000300f0: 6520 6c65 7373 2074 656d 706f 7261 7279  e less temporary
-00030100: 206d 656d 6f72 7920 7768 696c 6520 7275   memory while ru
-00030110: 6e6e 696e 6720 606d 6170 602e 0a0a 2020  nning `map`...  
-00030120: 2020 2020 2020 4578 616d 706c 653a 0a0a        Example:..
-00030130: 2020 2020 2020 2020 6060 6070 790a 2020          ```py.  
-00030140: 2020 2020 2020 3e3e 3e20 6672 6f6d 2064        >>> from d
-00030150: 6174 6173 6574 7320 696d 706f 7274 206c  atasets import l
-00030160: 6f61 645f 6461 7461 7365 740a 2020 2020  oad_dataset.    
-00030170: 2020 2020 3e3e 3e20 6473 203d 206c 6f61      >>> ds = loa
-00030180: 645f 6461 7461 7365 7428 2272 6f74 7465  d_dataset("rotte
-00030190: 6e5f 746f 6d61 746f 6573 222c 2073 706c  n_tomatoes", spl
-000301a0: 6974 3d22 7661 6c69 6461 7469 6f6e 2229  it="validation")
-000301b0: 0a20 2020 2020 2020 203e 3e3e 2064 730a  .        >>> ds.
-000301c0: 2020 2020 2020 2020 4461 7461 7365 7428          Dataset(
-000301d0: 7b0a 2020 2020 2020 2020 2020 2020 6665  {.            fe
-000301e0: 6174 7572 6573 3a20 5b27 7465 7874 272c  atures: ['text',
-000301f0: 2027 6c61 6265 6c27 5d2c 0a20 2020 2020   'label'],.     
-00030200: 2020 2020 2020 206e 756d 5f72 6f77 733a         num_rows:
-00030210: 2031 3036 360a 2020 2020 2020 2020 7d29   1066.        })
-00030220: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
-00030230: 7368 6172 6428 6e75 6d5f 7368 6172 6473  shard(num_shards
-00030240: 3d32 2c20 696e 6465 783d 3029 0a20 2020  =2, index=0).   
-00030250: 2020 2020 2044 6174 6173 6574 287b 0a20       Dataset({. 
-00030260: 2020 2020 2020 2020 2020 2066 6561 7475             featu
-00030270: 7265 733a 205b 2774 6578 7427 2c20 276c  res: ['text', 'l
-00030280: 6162 656c 275d 2c0a 2020 2020 2020 2020  abel'],.        
-00030290: 2020 2020 6e75 6d5f 726f 7773 3a20 3533      num_rows: 53
-000302a0: 330a 2020 2020 2020 2020 7d29 0a20 2020  3.        }).   
-000302b0: 2020 2020 2060 6060 0a20 2020 2020 2020       ```.       
-000302c0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-000302d0: 6e6f 7420 3020 3c3d 2069 6e64 6578 203c  not 0 <= index <
-000302e0: 206e 756d 5f73 6861 7264 733a 0a20 2020   num_shards:.   
-000302f0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00030300: 616c 7565 4572 726f 7228 2269 6e64 6578  alueError("index
-00030310: 2073 686f 756c 6420 6265 2069 6e20 5b30   should be in [0
-00030320: 2c20 6e75 6d5f 7368 6172 6473 2d31 5d22  , num_shards-1]"
-00030330: 290a 2020 2020 2020 2020 6966 2063 6f6e  ).        if con
-00030340: 7469 6775 6f75 733a 0a20 2020 2020 2020  tiguous:.       
-00030350: 2020 2020 2064 6976 203d 206c 656e 2873       div = len(s
-00030360: 656c 6629 202f 2f20 6e75 6d5f 7368 6172  elf) // num_shar
-00030370: 6473 0a20 2020 2020 2020 2020 2020 206d  ds.            m
-00030380: 6f64 203d 206c 656e 2873 656c 6629 2025  od = len(self) %
-00030390: 206e 756d 5f73 6861 7264 730a 2020 2020   num_shards.    
-000303a0: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
-000303b0: 6469 7620 2a20 696e 6465 7820 2b20 6d69  div * index + mi
-000303c0: 6e28 696e 6465 782c 206d 6f64 290a 2020  n(index, mod).  
-000303d0: 2020 2020 2020 2020 2020 656e 6420 3d20            end = 
-000303e0: 7374 6172 7420 2b20 6469 7620 2b20 2831  start + div + (1
-000303f0: 2069 6620 696e 6465 7820 3c20 6d6f 6420   if index < mod 
-00030400: 656c 7365 2030 290a 2020 2020 2020 2020  else 0).        
-00030410: 2020 2020 696e 6469 6365 7320 3d20 7261      indices = ra
-00030420: 6e67 6528 7374 6172 742c 2065 6e64 290a  nge(start, end).
-00030430: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00030440: 2020 2020 2020 2020 2020 696e 6469 6365            indice
-00030450: 7320 3d20 6e70 2e61 7261 6e67 6528 696e  s = np.arange(in
-00030460: 6465 782c 206c 656e 2873 656c 6629 2c20  dex, len(self), 
-00030470: 6e75 6d5f 7368 6172 6473 290a 0a20 2020  num_shards)..   
-00030480: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00030490: 2e73 656c 6563 7428 0a20 2020 2020 2020  .select(.       
-000304a0: 2020 2020 2069 6e64 6963 6573 3d69 6e64       indices=ind
-000304b0: 6963 6573 2c0a 2020 2020 2020 2020 2020  ices,.          
-000304c0: 2020 6b65 6570 5f69 6e5f 6d65 6d6f 7279    keep_in_memory
-000304d0: 3d6b 6565 705f 696e 5f6d 656d 6f72 792c  =keep_in_memory,
-000304e0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-000304f0: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
-00030500: 6e61 6d65 3d69 6e64 6963 6573 5f63 6163  name=indices_cac
-00030510: 6865 5f66 696c 655f 6e61 6d65 2c0a 2020  he_file_name,.  
-00030520: 2020 2020 2020 2020 2020 7772 6974 6572            writer
-00030530: 5f62 6174 6368 5f73 697a 653d 7772 6974  _batch_size=writ
-00030540: 6572 5f62 6174 6368 5f73 697a 652c 0a20  er_batch_size,. 
-00030550: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00030560: 6620 6578 706f 7274 280a 2020 2020 2020  f export(.      
-00030570: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00030580: 6669 6c65 6e61 6d65 3a20 7374 722c 0a20  filename: str,. 
-00030590: 2020 2020 2020 2066 6f72 6d61 743a 2073         format: s
-000305a0: 7472 203d 2022 7466 7265 636f 7264 222c  tr = "tfrecord",
-000305b0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-000305c0: 2222 2257 7269 7465 7320 7468 6520 4172  """Writes the Ar
-000305d0: 726f 7720 6461 7461 7365 7420 746f 2061  row dataset to a
-000305e0: 2054 4652 6563 6f72 6420 6669 6c65 2e0a   TFRecord file..
-000305f0: 0a20 2020 2020 2020 2054 6865 2064 6174  .        The dat
-00030600: 6173 6574 206d 7573 7420 616c 7265 6164  aset must alread
-00030610: 7920 6265 2069 6e20 7465 6e73 6f72 666c  y be in tensorfl
-00030620: 6f77 2066 6f72 6d61 742e 2054 6865 2072  ow format. The r
-00030630: 6563 6f72 6473 2077 696c 6c20 6265 2077  ecords will be w
-00030640: 7269 7474 656e 2077 6974 680a 2020 2020  ritten with.    
-00030650: 2020 2020 6b65 7973 2066 726f 6d20 6064      keys from `d
-00030660: 6174 6173 6574 2e5f 666f 726d 6174 5f63  ataset._format_c
-00030670: 6f6c 756d 6e73 602e 0a0a 2020 2020 2020  olumns`...      
-00030680: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00030690: 2020 2020 6669 6c65 6e61 6d65 2028 6073      filename (`s
-000306a0: 7472 6029 3a20 5468 6520 6669 6c65 6e61  tr`): The filena
-000306b0: 6d65 2c20 696e 636c 7564 696e 6720 7468  me, including th
-000306c0: 6520 602e 7466 7265 636f 7264 6020 6578  e `.tfrecord` ex
-000306d0: 7465 6e73 696f 6e2c 2074 6f20 7772 6974  tension, to writ
-000306e0: 6520 746f 2e0a 2020 2020 2020 2020 2020  e to..          
-000306f0: 2020 666f 726d 6174 2028 6073 7472 602c    format (`str`,
-00030700: 206f 7074 696f 6e61 6c2c 2064 6566 6175   optional, defau
-00030710: 6c74 2060 2274 6672 6563 6f72 6422 6029  lt `"tfrecord"`)
-00030720: 3a20 5468 6520 7479 7065 206f 6620 6f75  : The type of ou
-00030730: 7470 7574 2066 696c 652e 2043 7572 7265  tput file. Curre
-00030740: 6e74 6c79 2074 6869 7320 6973 2061 206e  ntly this is a n
-00030750: 6f2d 6f70 2c20 6173 0a20 2020 2020 2020  o-op, as.       
-00030760: 2020 2020 2020 2020 2054 4652 6563 6f72           TFRecor
-00030770: 6473 2061 7265 2074 6865 206f 6e6c 7920  ds are the only 
-00030780: 6f70 7469 6f6e 2e20 5468 6973 2065 6e61  option. This ena
-00030790: 626c 6573 2061 206d 6f72 6520 666c 6578  bles a more flex
-000307a0: 6962 6c65 2066 756e 6374 696f 6e20 7369  ible function si
-000307b0: 676e 6174 7572 6520 6c61 7465 722e 0a20  gnature later.. 
-000307c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000307d0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000307e0: 2020 2020 696d 706f 7274 2074 656e 736f      import tenso
-000307f0: 7266 6c6f 7720 6173 2074 6620 2023 206e  rflow as tf  # n
-00030800: 6f71 613a 2046 3430 310a 2020 2020 2020  oqa: F401.      
-00030810: 2020 6578 6365 7074 2049 6d70 6f72 7445    except ImportE
-00030820: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00030830: 2020 6c6f 6767 6572 2e65 7272 6f72 2822    logger.error("
-00030840: 5465 6e73 6f72 666c 6f77 206e 6565 6473  Tensorflow needs
-00030850: 2074 6f20 6265 2069 6e73 7461 6c6c 6564   to be installed
-00030860: 2074 6f20 6265 2061 626c 6520 746f 2072   to be able to r
-00030870: 6574 7572 6e20 5465 6e73 6f72 666c 6f77  eturn Tensorflow
-00030880: 2074 656e 736f 7273 2e22 290a 0a20 2020   tensors.")..   
-00030890: 2020 2020 2023 2046 726f 6d20 6874 7470       # From http
-000308a0: 733a 2f2f 7777 772e 7465 6e73 6f72 666c  s://www.tensorfl
-000308b0: 6f77 2e6f 7267 2f74 7574 6f72 6961 6c73  ow.org/tutorials
-000308c0: 2f6c 6f61 645f 6461 7461 2f74 6672 6563  /load_data/tfrec
-000308d0: 6f72 640a 2020 2020 2020 2020 6465 6620  ord.        def 
-000308e0: 5f62 7974 6573 5f66 6561 7475 7265 2876  _bytes_feature(v
-000308f0: 616c 7565 7329 3a0a 2020 2020 2020 2020  alues):.        
-00030900: 2020 2020 2222 2252 6574 7572 6e73 2061      """Returns a
-00030910: 2062 7974 6573 5f6c 6973 7420 6672 6f6d   bytes_list from
-00030920: 2061 206c 6973 7420 6f66 2073 7472 696e   a list of strin
-00030930: 6720 2f20 6279 7465 2e22 2222 0a20 2020  g / byte.""".   
-00030940: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00030950: 7466 2e74 7261 696e 2e46 6561 7475 7265  tf.train.Feature
-00030960: 2862 7974 6573 5f6c 6973 743d 7466 2e74  (bytes_list=tf.t
-00030970: 7261 696e 2e42 7974 6573 4c69 7374 2876  rain.BytesList(v
-00030980: 616c 7565 3d76 616c 7565 7329 290a 0a20  alue=values)).. 
-00030990: 2020 2020 2020 2064 6566 205f 666c 6f61         def _floa
-000309a0: 745f 6665 6174 7572 6528 7661 6c75 6573  t_feature(values
-000309b0: 293a 0a20 2020 2020 2020 2020 2020 2022  ):.            "
-000309c0: 2222 5265 7475 726e 7320 6120 666c 6f61  ""Returns a floa
-000309d0: 745f 6c69 7374 2066 726f 6d20 6120 6c69  t_list from a li
-000309e0: 7374 206f 6620 666c 6f61 7420 2f20 646f  st of float / do
-000309f0: 7562 6c65 2e22 2222 0a20 2020 2020 2020  uble.""".       
-00030a00: 2020 2020 2072 6574 7572 6e20 7466 2e74       return tf.t
-00030a10: 7261 696e 2e46 6561 7475 7265 2866 6c6f  rain.Feature(flo
-00030a20: 6174 5f6c 6973 743d 7466 2e74 7261 696e  at_list=tf.train
-00030a30: 2e46 6c6f 6174 4c69 7374 2876 616c 7565  .FloatList(value
-00030a40: 3d76 616c 7565 7329 290a 0a20 2020 2020  =values))..     
-00030a50: 2020 2064 6566 205f 696e 7436 345f 6665     def _int64_fe
-00030a60: 6174 7572 6528 7661 6c75 6573 293a 0a20  ature(values):. 
-00030a70: 2020 2020 2020 2020 2020 2022 2222 5265             """Re
-00030a80: 7475 726e 7320 616e 2069 6e74 3634 5f6c  turns an int64_l
-00030a90: 6973 7420 6672 6f6d 2061 206c 6973 7420  ist from a list 
-00030aa0: 6f66 2062 6f6f 6c20 2f20 656e 756d 202f  of bool / enum /
-00030ab0: 2069 6e74 202f 2075 696e 742e 2222 220a   int / uint.""".
-00030ac0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00030ad0: 726e 2074 662e 7472 6169 6e2e 4665 6174  rn tf.train.Feat
-00030ae0: 7572 6528 696e 7436 345f 6c69 7374 3d74  ure(int64_list=t
-00030af0: 662e 7472 6169 6e2e 496e 7436 344c 6973  f.train.Int64Lis
-00030b00: 7428 7661 6c75 653d 7661 6c75 6573 2929  t(value=values))
-00030b10: 0a0a 2020 2020 2020 2020 6465 6620 5f66  ..        def _f
-00030b20: 6561 7475 7265 2876 616c 7565 733a 2055  eature(values: U
-00030b30: 6e69 6f6e 5b66 6c6f 6174 2c20 696e 742c  nion[float, int,
-00030b40: 2073 7472 2c20 6e70 2e6e 6461 7272 6179   str, np.ndarray
-00030b50: 2c20 6c69 7374 5d29 202d 3e20 2274 662e  , list]) -> "tf.
-00030b60: 7472 6169 6e2e 4665 6174 7572 6522 3a0a  train.Feature":.
-00030b70: 2020 2020 2020 2020 2020 2020 2222 2254              """T
-00030b80: 7970 6563 6865 636b 7320 6076 616c 7565  ypechecks `value
-00030b90: 7360 2061 6e64 2072 6574 7572 6e73 2074  s` and returns t
-00030ba0: 6865 2063 6f72 7265 7370 6f6e 6469 6e67  he corresponding
-00030bb0: 2074 662e 7472 6169 6e2e 4665 6174 7572   tf.train.Featur
-00030bc0: 652e 2222 220a 2020 2020 2020 2020 2020  e.""".          
-00030bd0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00030be0: 7661 6c75 6573 2c20 6c69 7374 293a 0a20  values, list):. 
-00030bf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00030c00: 6620 7661 6c75 6573 2061 6e64 2069 7369  f values and isi
-00030c10: 6e73 7461 6e63 6528 7661 6c75 6573 5b30  nstance(values[0
-00030c20: 5d2c 2073 7472 293a 0a20 2020 2020 2020  ], str):.       
-00030c30: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00030c40: 7572 6e20 5f62 7974 6573 5f66 6561 7475  urn _bytes_featu
-00030c50: 7265 285b 762e 656e 636f 6465 2829 2066  re([v.encode() f
-00030c60: 6f72 2076 2069 6e20 7661 6c75 6573 5d29  or v in values])
-00030c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030c80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00030c90: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00030ca0: 2056 616c 7565 4572 726f 7228 6622 7661   ValueError(f"va
-00030cb0: 6c75 6573 3d7b 7661 6c75 6573 7d20 6973  lues={values} is
-00030cc0: 2065 6d70 7479 206f 7220 636f 6e74 6169   empty or contai
-00030cd0: 6e73 2069 7465 6d73 2074 6861 7420 6361  ns items that ca
-00030ce0: 6e6e 6f74 2062 6520 7365 7269 616c 697a  nnot be serializ
-00030cf0: 6564 2229 0a20 2020 2020 2020 2020 2020  ed").           
-00030d00: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00030d10: 2876 616c 7565 732c 206e 702e 6e64 6172  (values, np.ndar
-00030d20: 7261 7929 3a0a 2020 2020 2020 2020 2020  ray):.          
-00030d30: 2020 2020 2020 6966 2076 616c 7565 732e        if values.
-00030d40: 6474 7970 6520 3d3d 206e 702e 6474 7970  dtype == np.dtyp
-00030d50: 6528 666c 6f61 7429 3a0a 2020 2020 2020  e(float):.      
-00030d60: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00030d70: 7475 726e 205f 666c 6f61 745f 6665 6174  turn _float_feat
-00030d80: 7572 6528 7661 6c75 6573 290a 2020 2020  ure(values).    
-00030d90: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00030da0: 2076 616c 7565 732e 6474 7970 6520 3d3d   values.dtype ==
-00030db0: 206e 702e 696e 7436 343a 0a20 2020 2020   np.int64:.     
-00030dc0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00030dd0: 6574 7572 6e20 5f69 6e74 3634 5f66 6561  eturn _int64_fea
-00030de0: 7475 7265 2876 616c 7565 7329 0a20 2020  ture(values).   
-00030df0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00030e00: 6620 7661 6c75 6573 2e64 7479 7065 203d  f values.dtype =
-00030e10: 3d20 6e70 2e64 7479 7065 2873 7472 2920  = np.dtype(str) 
-00030e20: 6f72 2028 0a20 2020 2020 2020 2020 2020  or (.           
-00030e30: 2020 2020 2020 2020 2076 616c 7565 732e           values.
-00030e40: 6474 7970 6520 3d3d 206e 702e 6474 7970  dtype == np.dtyp
-00030e50: 6528 6f62 6a65 6374 2920 616e 6420 6c65  e(object) and le
-00030e60: 6e28 7661 6c75 6573 2920 3e20 3020 616e  n(values) > 0 an
-00030e70: 6420 6973 696e 7374 616e 6365 2876 616c  d isinstance(val
-00030e80: 7565 735b 305d 2c20 7374 7229 0a20 2020  ues[0], str).   
-00030e90: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-00030ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030eb0: 2020 2020 7265 7475 726e 205f 6279 7465      return _byte
-00030ec0: 735f 6665 6174 7572 6528 5b76 2e65 6e63  s_feature([v.enc
-00030ed0: 6f64 6528 2920 666f 7220 7620 696e 2076  ode() for v in v
-00030ee0: 616c 7565 735d 290a 2020 2020 2020 2020  alues]).        
-00030ef0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00030f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030f10: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00030f20: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00030f30: 2020 2020 2020 2020 2020 2020 6622 7661              f"va
-00030f40: 6c75 6573 3d7b 7661 6c75 6573 7d20 6973  lues={values} is
-00030f50: 2065 6d70 7479 206f 7220 6973 2061 6e20   empty or is an 
-00030f60: 6e70 2e6e 6461 7272 6179 2077 6974 6820  np.ndarray with 
-00030f70: 6974 656d 7320 6f66 2064 7479 7065 207b  items of dtype {
-00030f80: 7661 6c75 6573 5b30 5d2e 6474 7970 657d  values[0].dtype}
-00030f90: 2c20 7768 6963 6820 6361 6e6e 6f74 2062  , which cannot b
-00030fa0: 6520 7365 7269 616c 697a 6564 220a 2020  e serialized".  
-00030fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030fc0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00030fd0: 656c 6966 2068 6173 6174 7472 2876 616c  elif hasattr(val
-00030fe0: 7565 732c 2022 6474 7970 6522 293a 0a20  ues, "dtype"):. 
-00030ff0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00031000: 6620 6e70 2e69 7373 7562 6474 7970 6528  f np.issubdtype(
-00031010: 7661 6c75 6573 2e64 7479 7065 2c20 6e70  values.dtype, np
-00031020: 2e66 6c6f 6174 696e 6729 3a0a 2020 2020  .floating):.    
-00031030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031040: 7265 7475 726e 205f 666c 6f61 745f 6665  return _float_fe
-00031050: 6174 7572 6528 5b76 616c 7565 732e 6974  ature([values.it
-00031060: 656d 2829 5d29 0a20 2020 2020 2020 2020  em()]).         
-00031070: 2020 2020 2020 2065 6c69 6620 6e70 2e69         elif np.i
-00031080: 7373 7562 6474 7970 6528 7661 6c75 6573  ssubdtype(values
-00031090: 2e64 7479 7065 2c20 6e70 2e69 6e74 6567  .dtype, np.integ
-000310a0: 6572 293a 0a20 2020 2020 2020 2020 2020  er):.           
-000310b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000310c0: 5f69 6e74 3634 5f66 6561 7475 7265 285b  _int64_feature([
-000310d0: 7661 6c75 6573 2e69 7465 6d28 295d 290a  values.item()]).
-000310e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000310f0: 656c 6966 206e 702e 6973 7375 6264 7479  elif np.issubdty
-00031100: 7065 2876 616c 7565 732e 6474 7970 652c  pe(values.dtype,
-00031110: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
-00031120: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00031130: 6e20 5f62 7974 6573 5f66 6561 7475 7265  n _bytes_feature
-00031140: 285b 7661 6c75 6573 2e69 7465 6d28 292e  ([values.item().
-00031150: 656e 636f 6465 2829 5d29 0a20 2020 2020  encode()]).     
-00031160: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00031170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031180: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00031190: 4572 726f 7228 6622 7661 6c75 6573 3d7b  Error(f"values={
-000311a0: 7661 6c75 6573 7d20 6861 7320 6474 7970  values} has dtyp
-000311b0: 6520 7b76 616c 7565 732e 6474 7970 657d  e {values.dtype}
-000311c0: 2c20 7768 6963 6820 6361 6e6e 6f74 2062  , which cannot b
-000311d0: 6520 7365 7269 616c 697a 6564 2229 0a20  e serialized"). 
-000311e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000311f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031200: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00031210: 7228 6622 7661 6c75 6573 3d7b 7661 6c75  r(f"values={valu
-00031220: 6573 7d20 6172 6520 6e6f 7420 6e75 6d70  es} are not nump
-00031230: 7920 6f62 6a65 6374 7320 6f72 2073 7472  y objects or str
-00031240: 696e 6773 2c20 616e 6420 736f 2063 616e  ings, and so can
-00031250: 6e6f 7420 6265 2073 6572 6961 6c69 7a65  not be serialize
-00031260: 6422 290a 0a20 2020 2020 2020 2064 6566  d")..        def
-00031270: 2073 6572 6961 6c69 7a65 5f65 7861 6d70   serialize_examp
-00031280: 6c65 2865 7829 3a0a 2020 2020 2020 2020  le(ex):.        
-00031290: 2020 2020 6665 6174 7572 6520 3d20 7b6b      feature = {k
-000312a0: 6579 3a20 5f66 6561 7475 7265 2876 616c  ey: _feature(val
-000312b0: 7565 2920 666f 7220 6b65 792c 2076 616c  ue) for key, val
-000312c0: 7565 2069 6e20 6578 2e69 7465 6d73 2829  ue in ex.items()
-000312d0: 7d0a 2020 2020 2020 2020 2020 2020 6578  }.            ex
-000312e0: 616d 706c 655f 7072 6f74 6f20 3d20 7466  ample_proto = tf
-000312f0: 2e74 7261 696e 2e45 7861 6d70 6c65 2866  .train.Example(f
-00031300: 6561 7475 7265 733d 7466 2e74 7261 696e  eatures=tf.train
-00031310: 2e46 6561 7475 7265 7328 6665 6174 7572  .Features(featur
-00031320: 653d 6665 6174 7572 6529 290a 2020 2020  e=feature)).    
-00031330: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-00031340: 7861 6d70 6c65 5f70 726f 746f 2e53 6572  xample_proto.Ser
-00031350: 6961 6c69 7a65 546f 5374 7269 6e67 2829  ializeToString()
-00031360: 0a0a 2020 2020 2020 2020 6465 6620 7466  ..        def tf
-00031370: 5f73 6572 6961 6c69 7a65 5f65 7861 6d70  _serialize_examp
-00031380: 6c65 2865 7829 3a0a 2020 2020 2020 2020  le(ex):.        
-00031390: 2020 2020 7466 5f73 7472 696e 6720 3d20      tf_string = 
-000313a0: 7466 2e70 795f 6675 6e63 7469 6f6e 2873  tf.py_function(s
-000313b0: 6572 6961 6c69 7a65 5f65 7861 6d70 6c65  erialize_example
-000313c0: 2c20 2865 782c 292c 2074 662e 7374 7269  , (ex,), tf.stri
-000313d0: 6e67 290a 2020 2020 2020 2020 2020 2020  ng).            
-000313e0: 7265 7475 726e 2074 662e 7265 7368 6170  return tf.reshap
-000313f0: 6528 7466 5f73 7472 696e 672c 2028 2929  e(tf_string, ())
-00031400: 0a0a 2020 2020 2020 2020 6465 6620 6765  ..        def ge
-00031410: 6e65 7261 746f 7228 293a 0a20 2020 2020  nerator():.     
-00031420: 2020 2020 2020 2066 6f72 2065 7820 696e         for ex in
-00031430: 2073 656c 663a 0a20 2020 2020 2020 2020   self:.         
-00031440: 2020 2020 2020 2079 6965 6c64 2073 6572         yield ser
-00031450: 6961 6c69 7a65 5f65 7861 6d70 6c65 2865  ialize_example(e
-00031460: 7829 0a0a 2020 2020 2020 2020 6966 2073  x)..        if s
-00031470: 656c 662e 5f66 6f72 6d61 745f 7479 7065  elf._format_type
-00031480: 2021 3d20 226e 756d 7079 223a 0a20 2020   != "numpy":.   
-00031490: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000314a0: 616c 7565 4572 726f 7228 2244 6174 6173  alueError("Datas
-000314b0: 6574 2066 6f72 6d61 7420 6d75 7374 2062  et format must b
-000314c0: 6520 6e75 6d70 7920 6265 666f 7265 2065  e numpy before e
-000314d0: 7870 6f72 7469 6e67 2229 0a20 2020 2020  xporting").     
-000314e0: 2020 2069 6620 6e6f 7420 6669 6c65 6e61     if not filena
-000314f0: 6d65 2e65 6e64 7377 6974 6828 222e 7466  me.endswith(".tf
-00031500: 7265 636f 7264 2229 3a0a 2020 2020 2020  record"):.      
-00031510: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00031520: 6545 7272 6f72 2822 6669 6c65 6e61 6d65  eError("filename
-00031530: 207b 6669 6c65 6e61 6d65 7d20 6d75 7374   {filename} must
-00031540: 2065 6e64 2077 6974 6820 2e74 6672 6563   end with .tfrec
-00031550: 6f72 6422 290a 2020 2020 2020 2020 7466  ord").        tf
-00031560: 5f64 6174 6173 6574 203d 2074 662e 6461  _dataset = tf.da
-00031570: 7461 2e44 6174 6173 6574 2e66 726f 6d5f  ta.Dataset.from_
-00031580: 6765 6e65 7261 746f 7228 6765 6e65 7261  generator(genera
-00031590: 746f 722c 206f 7574 7075 745f 7479 7065  tor, output_type
-000315a0: 733d 7466 2e73 7472 696e 672c 206f 7574  s=tf.string, out
-000315b0: 7075 745f 7368 6170 6573 3d28 2929 0a20  put_shapes=()). 
-000315c0: 2020 2020 2020 2077 7269 7465 7220 3d20         writer = 
-000315d0: 7466 2e64 6174 612e 6578 7065 7269 6d65  tf.data.experime
-000315e0: 6e74 616c 2e54 4652 6563 6f72 6457 7269  ntal.TFRecordWri
-000315f0: 7465 7228 6669 6c65 6e61 6d65 290a 2020  ter(filename).  
-00031600: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-00031610: 6f28 6622 5772 6974 696e 6720 5446 5265  o(f"Writing TFRe
-00031620: 636f 7264 2074 6f20 7b66 696c 656e 616d  cord to {filenam
-00031630: 657d 2229 0a20 2020 2020 2020 2077 7269  e}").        wri
-00031640: 7465 722e 7772 6974 6528 7466 5f64 6174  ter.write(tf_dat
-00031650: 6173 6574 290a 2020 2020 2020 2020 6c6f  aset).        lo
-00031660: 6767 6572 2e69 6e66 6f28 6622 4669 6e69  gger.info(f"Fini
-00031670: 7368 6564 2077 7269 7469 6e67 2054 4652  shed writing TFR
-00031680: 6563 6f72 6420 746f 207b 6669 6c65 6e61  ecord to {filena
-00031690: 6d65 7d22 290a 2020 2020 2020 2020 7365  me}").        se
-000316a0: 6c66 203d 204e 6f6e 6520 2023 2064 656c  lf = None  # del
-000316b0: 6574 6520 7468 6520 6461 7461 7365 7420  ete the dataset 
-000316c0: 7265 6665 7265 6e63 6520 7573 6564 2062  reference used b
-000316d0: 7920 7466 5f64 6174 6173 6574 0a0a 2020  y tf_dataset..  
-000316e0: 2020 6465 6620 746f 5f63 7376 280a 2020    def to_csv(.  
-000316f0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00031700: 2020 2020 7061 7468 5f6f 725f 6275 663a      path_or_buf:
-00031710: 2055 6e69 6f6e 5b50 6174 684c 696b 652c   Union[PathLike,
-00031720: 2042 696e 6172 7949 4f5d 2c0a 2020 2020   BinaryIO],.    
-00031730: 2020 2020 6261 7463 685f 7369 7a65 3a20      batch_size: 
-00031740: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
-00031750: 4e6f 6e65 2c0a 2020 2020 2020 2020 6e75  None,.        nu
-00031760: 6d5f 7072 6f63 3a20 4f70 7469 6f6e 616c  m_proc: Optional
-00031770: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
-00031780: 2020 2020 2020 2a2a 746f 5f63 7376 5f6b        **to_csv_k
-00031790: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
-000317a0: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
-000317b0: 4578 706f 7274 7320 7468 6520 6461 7461  Exports the data
-000317c0: 7365 7420 746f 2063 7376 0a0a 2020 2020  set to csv..    
-000317d0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-000317e0: 2020 2020 2020 7061 7468 5f6f 725f 6275        path_or_bu
-000317f0: 6620 2860 5061 7468 4c69 6b65 6020 6f72  f (`PathLike` or
-00031800: 2060 4669 6c65 4f72 4275 6666 6572 6029   `FileOrBuffer`)
-00031810: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00031820: 2020 4569 7468 6572 2061 2070 6174 6820    Either a path 
-00031830: 746f 2061 2066 696c 6520 6f72 2061 2042  to a file or a B
-00031840: 696e 6172 7949 4f2e 0a20 2020 2020 2020  inaryIO..       
-00031850: 2020 2020 2062 6174 6368 5f73 697a 6520       batch_size 
-00031860: 2860 696e 7460 2c20 2a6f 7074 696f 6e61  (`int`, *optiona
-00031870: 6c2a 293a 0a20 2020 2020 2020 2020 2020  l*):.           
-00031880: 2020 2020 2053 697a 6520 6f66 2074 6865       Size of the
-00031890: 2062 6174 6368 2074 6f20 6c6f 6164 2069   batch to load i
-000318a0: 6e20 6d65 6d6f 7279 2061 6e64 2077 7269  n memory and wri
-000318b0: 7465 2061 7420 6f6e 6365 2e0a 2020 2020  te at once..    
-000318c0: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
-000318d0: 756c 7473 2074 6f20 6064 6174 6173 6574  ults to `dataset
-000318e0: 732e 636f 6e66 6967 2e44 4546 4155 4c54  s.config.DEFAULT
-000318f0: 5f4d 4158 5f42 4154 4348 5f53 495a 4560  _MAX_BATCH_SIZE`
-00031900: 2e0a 2020 2020 2020 2020 2020 2020 6e75  ..            nu
-00031910: 6d5f 7072 6f63 2028 6069 6e74 602c 202a  m_proc (`int`, *
-00031920: 6f70 7469 6f6e 616c 2a29 3a0a 2020 2020  optional*):.    
-00031930: 2020 2020 2020 2020 2020 2020 4e75 6d62              Numb
-00031940: 6572 206f 6620 7072 6f63 6573 7365 7320  er of processes 
-00031950: 666f 7220 6d75 6c74 6970 726f 6365 7373  for multiprocess
-00031960: 696e 672e 2042 7920 6465 6661 756c 7420  ing. By default 
-00031970: 6974 2064 6f65 736e 2774 0a20 2020 2020  it doesn't.     
-00031980: 2020 2020 2020 2020 2020 2075 7365 206d             use m
-00031990: 756c 7469 7072 6f63 6573 7369 6e67 2e20  ultiprocessing. 
-000319a0: 6062 6174 6368 5f73 697a 6560 2069 6e20  `batch_size` in 
-000319b0: 7468 6973 2063 6173 6520 6465 6661 756c  this case defaul
-000319c0: 7473 2074 6f0a 2020 2020 2020 2020 2020  ts to.          
-000319d0: 2020 2020 2020 6064 6174 6173 6574 732e        `datasets.
-000319e0: 636f 6e66 6967 2e44 4546 4155 4c54 5f4d  config.DEFAULT_M
-000319f0: 4158 5f42 4154 4348 5f53 495a 4560 2062  AX_BATCH_SIZE` b
-00031a00: 7574 2066 6565 6c20 6672 6565 2074 6f20  ut feel free to 
-00031a10: 6d61 6b65 2069 7420 3578 206f 7220 3130  make it 5x or 10
-00031a20: 7820 6f66 2074 6865 2064 6566 6175 6c74  x of the default
-00031a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031a40: 2076 616c 7565 2069 6620 796f 7520 6861   value if you ha
-00031a50: 7665 2073 7566 6669 6369 656e 7420 636f  ve sufficient co
-00031a60: 6d70 7574 6520 706f 7765 722e 0a20 2020  mpute power..   
-00031a70: 2020 2020 2020 2020 202a 2a74 6f5f 6373           **to_cs
-00031a80: 765f 6b77 6172 6773 2028 6164 6469 7469  v_kwargs (additi
-00031a90: 6f6e 616c 206b 6579 776f 7264 2061 7267  onal keyword arg
-00031aa0: 756d 656e 7473 293a 0a20 2020 2020 2020  uments):.       
-00031ab0: 2020 2020 2020 2020 2050 6172 616d 6574           Paramet
-00031ac0: 6572 7320 746f 2070 6173 7320 746f 2070  ers to pass to p
-00031ad0: 616e 6461 7327 7320 6070 616e 6461 732e  andas's `pandas.
-00031ae0: 4461 7461 4672 616d 652e 746f 5f63 7376  DataFrame.to_csv
-00031af0: 602e 0a0a 2020 2020 2020 2020 5265 7475  `...        Retu
-00031b00: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
-00031b10: 2060 696e 7460 3a20 5468 6520 6e75 6d62   `int`: The numb
-00031b20: 6572 206f 6620 6368 6172 6163 7465 7273  er of characters
-00031b30: 206f 7220 6279 7465 7320 7772 6974 7465   or bytes writte
-00031b40: 6e2e 0a0a 2020 2020 2020 2020 4578 616d  n...        Exam
-00031b50: 706c 653a 0a0a 2020 2020 2020 2020 6060  ple:..        ``
-00031b60: 6070 790a 2020 2020 2020 2020 3e3e 3e20  `py.        >>> 
-00031b70: 6473 2e74 6f5f 6373 7628 2270 6174 682f  ds.to_csv("path/
-00031b80: 746f 2f64 6174 6173 6574 2f64 6972 6563  to/dataset/direc
-00031b90: 746f 7279 2229 0a20 2020 2020 2020 2060  tory").        `
-00031ba0: 6060 0a20 2020 2020 2020 2022 2222 0a20  ``.        """. 
-00031bb0: 2020 2020 2020 2023 2044 796e 616d 6963         # Dynamic
-00031bc0: 2069 6d70 6f72 7420 746f 2061 766f 6964   import to avoid
-00031bd0: 2063 6972 6375 6c61 7220 6465 7065 6e64   circular depend
-00031be0: 656e 6379 0a20 2020 2020 2020 2066 726f  ency.        fro
-00031bf0: 6d20 2e69 6f2e 6373 7620 696d 706f 7274  m .io.csv import
-00031c00: 2043 7376 4461 7461 7365 7457 7269 7465   CsvDatasetWrite
-00031c10: 720a 0a20 2020 2020 2020 2072 6574 7572  r..        retur
-00031c20: 6e20 4373 7644 6174 6173 6574 5772 6974  n CsvDatasetWrit
-00031c30: 6572 2873 656c 662c 2070 6174 685f 6f72  er(self, path_or
-00031c40: 5f62 7566 2c20 6261 7463 685f 7369 7a65  _buf, batch_size
-00031c50: 3d62 6174 6368 5f73 697a 652c 206e 756d  =batch_size, num
-00031c60: 5f70 726f 633d 6e75 6d5f 7072 6f63 2c20  _proc=num_proc, 
-00031c70: 2a2a 746f 5f63 7376 5f6b 7761 7267 7329  **to_csv_kwargs)
-00031c80: 2e77 7269 7465 2829 0a0a 2020 2020 6465  .write()..    de
-00031c90: 6620 746f 5f64 6963 7428 7365 6c66 2c20  f to_dict(self, 
-00031ca0: 6261 7463 685f 7369 7a65 3a20 4f70 7469  batch_size: Opti
-00031cb0: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
-00031cc0: 2c20 6261 7463 6865 643a 2062 6f6f 6c20  , batched: bool 
-00031cd0: 3d20 4661 6c73 6529 202d 3e20 556e 696f  = False) -> Unio
-00031ce0: 6e5b 6469 6374 2c20 4974 6572 6174 6f72  n[dict, Iterator
-00031cf0: 5b64 6963 745d 5d3a 0a20 2020 2020 2020  [dict]]:.       
-00031d00: 2022 2222 5265 7475 726e 7320 7468 6520   """Returns the 
-00031d10: 6461 7461 7365 7420 6173 2061 2050 7974  dataset as a Pyt
-00031d20: 686f 6e20 6469 6374 2e20 4361 6e20 616c  hon dict. Can al
-00031d30: 736f 2072 6574 7572 6e20 6120 6765 6e65  so return a gene
-00031d40: 7261 746f 7220 666f 7220 6c61 7267 6520  rator for large 
-00031d50: 6461 7461 7365 7473 2e0a 0a20 2020 2020  datasets...     
-00031d60: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00031d70: 2020 2020 2062 6174 6368 6564 2028 6062       batched (`b
-00031d80: 6f6f 6c60 293a 0a20 2020 2020 2020 2020  ool`):.         
-00031d90: 2020 2020 2020 2053 6574 2074 6f20 6054         Set to `T
-00031da0: 7275 6560 2074 6f20 7265 7475 726e 2061  rue` to return a
-00031db0: 2067 656e 6572 6174 6f72 2074 6861 7420   generator that 
-00031dc0: 7969 656c 6473 2074 6865 2064 6174 6173  yields the datas
-00031dd0: 6574 2061 7320 6261 7463 6865 730a 2020  et as batches.  
-00031de0: 2020 2020 2020 2020 2020 2020 2020 6f66                of
-00031df0: 2060 6261 7463 685f 7369 7a65 6020 726f   `batch_size` ro
-00031e00: 7773 2e20 4465 6661 756c 7473 2074 6f20  ws. Defaults to 
-00031e10: 6046 616c 7365 6020 2872 6574 7572 6e73  `False` (returns
-00031e20: 2074 6865 2077 686f 6c65 2064 6174 6173   the whole datas
-00031e30: 6574 7320 6f6e 6365 292e 0a20 2020 2020  ets once)..     
-00031e40: 2020 2020 2020 2062 6174 6368 5f73 697a         batch_siz
-00031e50: 6520 2860 696e 7460 2c20 2a6f 7074 696f  e (`int`, *optio
-00031e60: 6e61 6c2a 293a 2054 6865 2073 697a 6520  nal*): The size 
-00031e70: 286e 756d 6265 7220 6f66 2072 6f77 7329  (number of rows)
-00031e80: 206f 6620 7468 6520 6261 7463 6865 7320   of the batches 
-00031e90: 6966 2060 6261 7463 6865 6460 2069 7320  if `batched` is 
-00031ea0: 6054 7275 6560 2e0a 2020 2020 2020 2020  `True`..        
-00031eb0: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
-00031ec0: 2074 6f20 6064 6174 6173 6574 732e 636f   to `datasets.co
-00031ed0: 6e66 6967 2e44 4546 4155 4c54 5f4d 4158  nfig.DEFAULT_MAX
-00031ee0: 5f42 4154 4348 5f53 495a 4560 2e0a 0a20  _BATCH_SIZE`... 
-00031ef0: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
-00031f00: 2020 2020 2020 2020 2020 2020 6064 6963              `dic
-00031f10: 7460 206f 7220 6049 7465 7261 746f 725b  t` or `Iterator[
-00031f20: 6469 6374 5d60 0a0a 2020 2020 2020 2020  dict]`..        
-00031f30: 4578 616d 706c 653a 0a0a 2020 2020 2020  Example:..      
-00031f40: 2020 6060 6070 790a 2020 2020 2020 2020    ```py.        
-00031f50: 3e3e 3e20 6473 2e74 6f5f 6469 6374 2829  >>> ds.to_dict()
-00031f60: 0a20 2020 2020 2020 2060 6060 0a20 2020  .        ```.   
-00031f70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00031f80: 2069 6620 6e6f 7420 6261 7463 6865 643a   if not batched:
-00031f90: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00031fa0: 7572 6e20 7175 6572 795f 7461 626c 6528  urn query_table(
-00031fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031fc0: 2074 6162 6c65 3d73 656c 662e 5f64 6174   table=self._dat
-00031fd0: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
-00031fe0: 2020 206b 6579 3d73 6c69 6365 2830 2c20     key=slice(0, 
-00031ff0: 6c65 6e28 7365 6c66 2929 2c0a 2020 2020  len(self)),.    
-00032000: 2020 2020 2020 2020 2020 2020 696e 6469              indi
-00032010: 6365 733d 7365 6c66 2e5f 696e 6469 6365  ces=self._indice
-00032020: 7320 6966 2073 656c 662e 5f69 6e64 6963  s if self._indic
-00032030: 6573 2069 7320 6e6f 7420 4e6f 6e65 2065  es is not None e
-00032040: 6c73 6520 4e6f 6e65 2c0a 2020 2020 2020  lse None,.      
-00032050: 2020 2020 2020 292e 746f 5f70 7964 6963        ).to_pydic
-00032060: 7428 290a 2020 2020 2020 2020 656c 7365  t().        else
-00032070: 3a0a 2020 2020 2020 2020 2020 2020 6261  :.            ba
-00032080: 7463 685f 7369 7a65 203d 2062 6174 6368  tch_size = batch
-00032090: 5f73 697a 6520 6966 2062 6174 6368 5f73  _size if batch_s
-000320a0: 697a 6520 656c 7365 2063 6f6e 6669 672e  ize else config.
-000320b0: 4445 4641 554c 545f 4d41 585f 4241 5443  DEFAULT_MAX_BATC
-000320c0: 485f 5349 5a45 0a20 2020 2020 2020 2020  H_SIZE.         
-000320d0: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
-000320e0: 2020 2020 2020 2020 2020 2020 7175 6572              quer
-000320f0: 795f 7461 626c 6528 0a20 2020 2020 2020  y_table(.       
-00032100: 2020 2020 2020 2020 2020 2020 2074 6162               tab
-00032110: 6c65 3d73 656c 662e 5f64 6174 612c 0a20  le=self._data,. 
-00032120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032130: 2020 206b 6579 3d73 6c69 6365 286f 6666     key=slice(off
-00032140: 7365 742c 206f 6666 7365 7420 2b20 6261  set, offset + ba
-00032150: 7463 685f 7369 7a65 292c 0a20 2020 2020  tch_size),.     
-00032160: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00032170: 6e64 6963 6573 3d73 656c 662e 5f69 6e64  ndices=self._ind
-00032180: 6963 6573 2069 6620 7365 6c66 2e5f 696e  ices if self._in
-00032190: 6469 6365 7320 6973 206e 6f74 204e 6f6e  dices is not Non
-000321a0: 6520 656c 7365 204e 6f6e 652c 0a20 2020  e else None,.   
-000321b0: 2020 2020 2020 2020 2020 2020 2029 2e74               ).t
-000321c0: 6f5f 7079 6469 6374 2829 0a20 2020 2020  o_pydict().     
-000321d0: 2020 2020 2020 2020 2020 2066 6f72 206f             for o
-000321e0: 6666 7365 7420 696e 2072 616e 6765 2830  ffset in range(0
-000321f0: 2c20 6c65 6e28 7365 6c66 292c 2062 6174  , len(self), bat
-00032200: 6368 5f73 697a 6529 0a20 2020 2020 2020  ch_size).       
-00032210: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00032220: 746f 5f6a 736f 6e28 0a20 2020 2020 2020  to_json(.       
-00032230: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
-00032240: 6174 685f 6f72 5f62 7566 3a20 556e 696f  ath_or_buf: Unio
-00032250: 6e5b 5061 7468 4c69 6b65 2c20 4269 6e61  n[PathLike, Bina
-00032260: 7279 494f 5d2c 0a20 2020 2020 2020 2062  ryIO],.        b
-00032270: 6174 6368 5f73 697a 653a 204f 7074 696f  atch_size: Optio
-00032280: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
-00032290: 0a20 2020 2020 2020 206e 756d 5f70 726f  .        num_pro
-000322a0: 633a 204f 7074 696f 6e61 6c5b 696e 745d  c: Optional[int]
-000322b0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-000322c0: 202a 2a74 6f5f 6a73 6f6e 5f6b 7761 7267   **to_json_kwarg
-000322d0: 732c 0a20 2020 2029 202d 3e20 696e 743a  s,.    ) -> int:
-000322e0: 0a20 2020 2020 2020 2022 2222 4578 706f  .        """Expo
-000322f0: 7274 2074 6865 2064 6174 6173 6574 2074  rt the dataset t
-00032300: 6f20 4a53 4f4e 204c 696e 6573 206f 7220  o JSON Lines or 
-00032310: 4a53 4f4e 2e0a 0a20 2020 2020 2020 2041  JSON...        A
-00032320: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00032330: 2070 6174 685f 6f72 5f62 7566 2028 6050   path_or_buf (`P
-00032340: 6174 684c 696b 6560 206f 7220 6046 696c  athLike` or `Fil
-00032350: 654f 7242 7566 6665 7260 293a 0a20 2020  eOrBuffer`):.   
-00032360: 2020 2020 2020 2020 2020 2020 2045 6974               Eit
-00032370: 6865 7220 6120 7061 7468 2074 6f20 6120  her a path to a 
-00032380: 6669 6c65 206f 7220 6120 4269 6e61 7279  file or a Binary
-00032390: 494f 2e0a 2020 2020 2020 2020 2020 2020  IO..            
-000323a0: 6261 7463 685f 7369 7a65 2028 6069 6e74  batch_size (`int
-000323b0: 602c 202a 6f70 7469 6f6e 616c 2a29 3a0a  `, *optional*):.
-000323c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000323d0: 5369 7a65 206f 6620 7468 6520 6261 7463  Size of the batc
-000323e0: 6820 746f 206c 6f61 6420 696e 206d 656d  h to load in mem
-000323f0: 6f72 7920 616e 6420 7772 6974 6520 6174  ory and write at
-00032400: 206f 6e63 652e 0a20 2020 2020 2020 2020   once..         
-00032410: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
-00032420: 746f 2060 6461 7461 7365 7473 2e63 6f6e  to `datasets.con
-00032430: 6669 672e 4445 4641 554c 545f 4d41 585f  fig.DEFAULT_MAX_
-00032440: 4241 5443 485f 5349 5a45 602e 0a20 2020  BATCH_SIZE`..   
-00032450: 2020 2020 2020 2020 206e 756d 5f70 726f           num_pro
-00032460: 6320 2860 696e 7460 2c20 2a6f 7074 696f  c (`int`, *optio
-00032470: 6e61 6c2a 293a 0a20 2020 2020 2020 2020  nal*):.         
-00032480: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-00032490: 2070 726f 6365 7373 6573 2066 6f72 206d   processes for m
-000324a0: 756c 7469 7072 6f63 6573 7369 6e67 2e20  ultiprocessing. 
-000324b0: 4279 2064 6566 6175 6c74 2069 7420 646f  By default it do
-000324c0: 6573 6e27 740a 2020 2020 2020 2020 2020  esn't.          
-000324d0: 2020 2020 2020 7573 6520 6d75 6c74 6970        use multip
-000324e0: 726f 6365 7373 696e 672e 2060 6261 7463  rocessing. `batc
-000324f0: 685f 7369 7a65 6020 696e 2074 6869 7320  h_size` in this 
-00032500: 6361 7365 2064 6566 6175 6c74 7320 746f  case defaults to
-00032510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032520: 2060 6461 7461 7365 7473 2e63 6f6e 6669   `datasets.confi
-00032530: 672e 4445 4641 554c 545f 4d41 585f 4241  g.DEFAULT_MAX_BA
-00032540: 5443 485f 5349 5a45 6020 6275 7420 6665  TCH_SIZE` but fe
-00032550: 656c 2066 7265 6520 746f 206d 616b 6520  el free to make 
-00032560: 6974 2035 7820 6f72 2031 3078 206f 6620  it 5x or 10x of 
-00032570: 7468 6520 6465 6661 756c 740a 2020 2020  the default.    
-00032580: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-00032590: 6520 6966 2079 6f75 2068 6176 6520 7375  e if you have su
-000325a0: 6666 6963 6965 6e74 2063 6f6d 7075 7465  fficient compute
-000325b0: 2070 6f77 6572 2e0a 2020 2020 2020 2020   power..        
-000325c0: 2020 2020 6c69 6e65 7320 2860 626f 6f6c      lines (`bool
-000325d0: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
-000325e0: 5472 7565 6029 3a0a 2020 2020 2020 2020  True`):.        
-000325f0: 2020 2020 2020 2020 5768 6574 6865 7220          Whether 
-00032600: 6f75 7470 7574 204a 534f 4e20 6c69 6e65  output JSON line
-00032610: 7320 666f 726d 6174 2e0a 2020 2020 2020  s format..      
-00032620: 2020 2020 2020 2020 2020 4f6e 6c79 2070            Only p
-00032630: 6f73 7369 626c 6520 6966 2060 6f72 6965  ossible if `orie
-00032640: 6e74 3d22 7265 636f 7264 7322 602e 2049  nt="records"`. I
-00032650: 7420 7769 6c6c 2074 6872 6f77 2056 616c  t will throw Val
-00032660: 7565 4572 726f 7220 7769 7468 2060 6f72  ueError with `or
-00032670: 6965 6e74 6020 6469 6666 6572 656e 7420  ient` different 
-00032680: 6672 6f6d 0a20 2020 2020 2020 2020 2020  from.           
-00032690: 2020 2020 2060 2272 6563 6f72 6473 2260       `"records"`
-000326a0: 2c20 7369 6e63 6520 7468 6520 6f74 6865  , since the othe
-000326b0: 7273 2061 7265 206e 6f74 206c 6973 742d  rs are not list-
-000326c0: 6c69 6b65 2e0a 2020 2020 2020 2020 2020  like..          
-000326d0: 2020 6f72 6965 6e74 2028 6073 7472 602c    orient (`str`,
-000326e0: 2064 6566 6175 6c74 7320 746f 2060 2272   defaults to `"r
-000326f0: 6563 6f72 6473 2260 293a 0a20 2020 2020  ecords"`):.     
-00032700: 2020 2020 2020 2020 2020 2046 6f72 6d61             Forma
-00032710: 7420 6f66 2074 6865 204a 534f 4e3a 0a0a  t of the JSON:..
-00032720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032730: 2d20 6022 7265 636f 7264 7322 603a 206c  - `"records"`: l
-00032740: 6973 7420 6c69 6b65 2060 5b7b 636f 6c75  ist like `[{colu
-00032750: 6d6e 202d 3e20 7661 6c75 657d 2c20 e280  mn -> value}, ..
-00032760: a620 2c20 7b63 6f6c 756d 6e20 2d3e 2076  . , {column -> v
-00032770: 616c 7565 7d5d 600a 2020 2020 2020 2020  alue}]`.        
-00032780: 2020 2020 2020 2020 2d20 6022 7370 6c69          - `"spli
-00032790: 7422 603a 2064 6963 7420 6c69 6b65 2060  t"`: dict like `
-000327a0: 7b22 696e 6465 7822 202d 3e20 5b69 6e64  {"index" -> [ind
-000327b0: 6578 5d2c 2022 636f 6c75 6d6e 7322 202d  ex], "columns" -
-000327c0: 3e20 5b63 6f6c 756d 6e73 5d2c 2022 6461  > [columns], "da
-000327d0: 7461 2220 2d3e 205b 7661 6c75 6573 5d7d  ta" -> [values]}
-000327e0: 600a 2020 2020 2020 2020 2020 2020 2020  `.              
-000327f0: 2020 2d20 6022 696e 6465 7822 603a 2064    - `"index"`: d
-00032800: 6963 7420 6c69 6b65 2060 7b69 6e64 6578  ict like `{index
-00032810: 202d 3e20 7b63 6f6c 756d 6e20 2d3e 2076   -> {column -> v
-00032820: 616c 7565 7d7d 600a 2020 2020 2020 2020  alue}}`.        
-00032830: 2020 2020 2020 2020 2d20 6022 636f 6c75          - `"colu
-00032840: 6d6e 7322 603a 2064 6963 7420 6c69 6b65  mns"`: dict like
-00032850: 2060 7b63 6f6c 756d 6e20 2d3e 207b 696e   `{column -> {in
-00032860: 6465 7820 2d3e 2076 616c 7565 7d7d 600a  dex -> value}}`.
-00032870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032880: 2d20 6022 7661 6c75 6573 2260 3a20 6a75  - `"values"`: ju
-00032890: 7374 2074 6865 2076 616c 7565 7320 6172  st the values ar
-000328a0: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
-000328b0: 2020 2020 2d20 6022 7461 626c 6522 603a      - `"table"`:
-000328c0: 2064 6963 7420 6c69 6b65 2060 7b22 7363   dict like `{"sc
-000328d0: 6865 6d61 223a 207b 7363 6865 6d61 7d2c  hema": {schema},
-000328e0: 2022 6461 7461 223a 207b 6461 7461 7d7d   "data": {data}}
-000328f0: 600a 2020 2020 2020 2020 2020 2020 2a2a  `.            **
-00032900: 746f 5f6a 736f 6e5f 6b77 6172 6773 2028  to_json_kwargs (
-00032910: 6164 6469 7469 6f6e 616c 206b 6579 776f  additional keywo
-00032920: 7264 2061 7267 756d 656e 7473 293a 0a20  rd arguments):. 
-00032930: 2020 2020 2020 2020 2020 2020 2020 2050                 P
-00032940: 6172 616d 6574 6572 7320 746f 2070 6173  arameters to pas
-00032950: 7320 746f 2070 616e 6461 7327 7320 5b60  s to pandas's [`
-00032960: 7061 6e64 6173 2e44 6174 6146 7261 6d65  pandas.DataFrame
-00032970: 2e74 6f5f 6a73 6f6e 605d 2868 7474 7073  .to_json`](https
-00032980: 3a2f 2f70 616e 6461 732e 7079 6461 7461  ://pandas.pydata
-00032990: 2e6f 7267 2f64 6f63 732f 7265 6665 7265  .org/docs/refere
-000329a0: 6e63 652f 6170 692f 7061 6e64 6173 2e44  nce/api/pandas.D
-000329b0: 6174 6146 7261 6d65 2e74 6f5f 6a73 6f6e  ataFrame.to_json
-000329c0: 2e68 746d 6c29 2e0a 0a20 2020 2020 2020  .html)...       
-000329d0: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
-000329e0: 2020 2020 2020 6069 6e74 603a 2054 6865        `int`: The
-000329f0: 206e 756d 6265 7220 6f66 2063 6861 7261   number of chara
-00032a00: 6374 6572 7320 6f72 2062 7974 6573 2077  cters or bytes w
-00032a10: 7269 7474 656e 2e0a 0a20 2020 2020 2020  ritten...       
-00032a20: 2045 7861 6d70 6c65 3a0a 0a20 2020 2020   Example:..     
-00032a30: 2020 2060 6060 7079 0a20 2020 2020 2020     ```py.       
-00032a40: 203e 3e3e 2064 732e 746f 5f6a 736f 6e28   >>> ds.to_json(
-00032a50: 2270 6174 682f 746f 2f64 6174 6173 6574  "path/to/dataset
-00032a60: 2f64 6972 6563 746f 7279 2229 0a20 2020  /directory").   
-00032a70: 2020 2020 2060 6060 0a20 2020 2020 2020       ```.       
-00032a80: 2022 2222 0a20 2020 2020 2020 2023 2044   """.        # D
-00032a90: 796e 616d 6963 2069 6d70 6f72 7420 746f  ynamic import to
-00032aa0: 2061 766f 6964 2063 6972 6375 6c61 7220   avoid circular 
-00032ab0: 6465 7065 6e64 656e 6379 0a20 2020 2020  dependency.     
-00032ac0: 2020 2066 726f 6d20 2e69 6f2e 6a73 6f6e     from .io.json
-00032ad0: 2069 6d70 6f72 7420 4a73 6f6e 4461 7461   import JsonData
-00032ae0: 7365 7457 7269 7465 720a 0a20 2020 2020  setWriter..     
-00032af0: 2020 2072 6574 7572 6e20 4a73 6f6e 4461     return JsonDa
-00032b00: 7461 7365 7457 7269 7465 7228 7365 6c66  tasetWriter(self
-00032b10: 2c20 7061 7468 5f6f 725f 6275 662c 2062  , path_or_buf, b
-00032b20: 6174 6368 5f73 697a 653d 6261 7463 685f  atch_size=batch_
-00032b30: 7369 7a65 2c20 6e75 6d5f 7072 6f63 3d6e  size, num_proc=n
-00032b40: 756d 5f70 726f 632c 202a 2a74 6f5f 6a73  um_proc, **to_js
-00032b50: 6f6e 5f6b 7761 7267 7329 2e77 7269 7465  on_kwargs).write
-00032b60: 2829 0a0a 2020 2020 6465 6620 746f 5f70  ()..    def to_p
-00032b70: 616e 6461 7328 0a20 2020 2020 2020 2073  andas(.        s
-00032b80: 656c 662c 2062 6174 6368 5f73 697a 653a  elf, batch_size:
-00032b90: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-00032ba0: 204e 6f6e 652c 2062 6174 6368 6564 3a20   None, batched: 
-00032bb0: 626f 6f6c 203d 2046 616c 7365 0a20 2020  bool = False.   
-00032bc0: 2029 202d 3e20 556e 696f 6e5b 7064 2e44   ) -> Union[pd.D
-00032bd0: 6174 6146 7261 6d65 2c20 4974 6572 6174  ataFrame, Iterat
-00032be0: 6f72 5b70 642e 4461 7461 4672 616d 655d  or[pd.DataFrame]
-00032bf0: 5d3a 0a20 2020 2020 2020 2022 2222 5265  ]:.        """Re
-00032c00: 7475 726e 7320 7468 6520 6461 7461 7365  turns the datase
-00032c10: 7420 6173 2061 2060 7061 6e64 6173 2e44  t as a `pandas.D
-00032c20: 6174 6146 7261 6d65 602e 2043 616e 2061  ataFrame`. Can a
-00032c30: 6c73 6f20 7265 7475 726e 2061 2067 656e  lso return a gen
-00032c40: 6572 6174 6f72 2066 6f72 206c 6172 6765  erator for large
-00032c50: 2064 6174 6173 6574 732e 0a0a 2020 2020   datasets...    
-00032c60: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00032c70: 2020 2020 2020 6261 7463 6865 6420 2860        batched (`
-00032c80: 626f 6f6c 6029 3a0a 2020 2020 2020 2020  bool`):.        
-00032c90: 2020 2020 2020 2020 5365 7420 746f 2060          Set to `
-00032ca0: 5472 7565 6020 746f 2072 6574 7572 6e20  True` to return 
-00032cb0: 6120 6765 6e65 7261 746f 7220 7468 6174  a generator that
-00032cc0: 2079 6965 6c64 7320 7468 6520 6461 7461   yields the data
-00032cd0: 7365 7420 6173 2062 6174 6368 6573 0a20  set as batches. 
-00032ce0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00032cf0: 6620 6062 6174 6368 5f73 697a 6560 2072  f `batch_size` r
-00032d00: 6f77 732e 2044 6566 6175 6c74 7320 746f  ows. Defaults to
-00032d10: 2060 4661 6c73 6560 2028 7265 7475 726e   `False` (return
-00032d20: 7320 7468 6520 7768 6f6c 6520 6461 7461  s the whole data
-00032d30: 7365 7473 206f 6e63 6529 2e0a 2020 2020  sets once)..    
-00032d40: 2020 2020 2020 2020 6261 7463 685f 7369          batch_si
-00032d50: 7a65 2028 6069 6e74 602c 202a 6f70 7469  ze (`int`, *opti
-00032d60: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
-00032d70: 2020 2020 2020 2020 5468 6520 7369 7a65          The size
-00032d80: 2028 6e75 6d62 6572 206f 6620 726f 7773   (number of rows
-00032d90: 2920 6f66 2074 6865 2062 6174 6368 6573  ) of the batches
-00032da0: 2069 6620 6062 6174 6368 6564 6020 6973   if `batched` is
-00032db0: 2060 5472 7565 602e 0a20 2020 2020 2020   `True`..       
-00032dc0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00032dd0: 7320 746f 2060 6461 7461 7365 7473 2e63  s to `datasets.c
-00032de0: 6f6e 6669 672e 4445 4641 554c 545f 4d41  onfig.DEFAULT_MA
-00032df0: 585f 4241 5443 485f 5349 5a45 602e 0a0a  X_BATCH_SIZE`...
-00032e00: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-00032e10: 0a20 2020 2020 2020 2020 2020 2060 7061  .            `pa
-00032e20: 6e64 6173 2e44 6174 6146 7261 6d65 6020  ndas.DataFrame` 
-00032e30: 6f72 2060 4974 6572 6174 6f72 5b70 616e  or `Iterator[pan
-00032e40: 6461 732e 4461 7461 4672 616d 655d 600a  das.DataFrame]`.
-00032e50: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-00032e60: 3a0a 0a20 2020 2020 2020 2060 6060 7079  :..        ```py
-00032e70: 0a20 2020 2020 2020 203e 3e3e 2064 732e  .        >>> ds.
-00032e80: 746f 5f70 616e 6461 7328 290a 2020 2020  to_pandas().    
-00032e90: 2020 2020 6060 600a 2020 2020 2020 2020      ```.        
-00032ea0: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
-00032eb0: 6f74 2062 6174 6368 6564 3a0a 2020 2020  ot batched:.    
-00032ec0: 2020 2020 2020 2020 7265 7475 726e 2071          return q
-00032ed0: 7565 7279 5f74 6162 6c65 280a 2020 2020  uery_table(.    
-00032ee0: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-00032ef0: 653d 7365 6c66 2e5f 6461 7461 2c0a 2020  e=self._data,.  
-00032f00: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00032f10: 793d 736c 6963 6528 302c 206c 656e 2873  y=slice(0, len(s
-00032f20: 656c 6629 292c 0a20 2020 2020 2020 2020  elf)),.         
-00032f30: 2020 2020 2020 2069 6e64 6963 6573 3d73         indices=s
-00032f40: 656c 662e 5f69 6e64 6963 6573 2069 6620  elf._indices if 
-00032f50: 7365 6c66 2e5f 696e 6469 6365 7320 6973  self._indices is
-00032f60: 206e 6f74 204e 6f6e 6520 656c 7365 204e   not None else N
-00032f70: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-00032f80: 2029 2e74 6f5f 7061 6e64 6173 2874 7970   ).to_pandas(typ
-00032f90: 6573 5f6d 6170 7065 723d 7061 6e64 6173  es_mapper=pandas
-00032fa0: 5f74 7970 6573 5f6d 6170 7065 7229 0a20  _types_mapper). 
-00032fb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00032fc0: 2020 2020 2020 2020 2062 6174 6368 5f73           batch_s
-00032fd0: 697a 6520 3d20 6261 7463 685f 7369 7a65  ize = batch_size
-00032fe0: 2069 6620 6261 7463 685f 7369 7a65 2065   if batch_size e
-00032ff0: 6c73 6520 636f 6e66 6967 2e44 4546 4155  lse config.DEFAU
-00033000: 4c54 5f4d 4158 5f42 4154 4348 5f53 495a  LT_MAX_BATCH_SIZ
-00033010: 450a 2020 2020 2020 2020 2020 2020 7265  E.            re
-00033020: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
-00033030: 2020 2020 2020 2071 7565 7279 5f74 6162         query_tab
-00033040: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-00033050: 2020 2020 2020 2020 7461 626c 653d 7365          table=se
-00033060: 6c66 2e5f 6461 7461 2c0a 2020 2020 2020  lf._data,.      
-00033070: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00033080: 793d 736c 6963 6528 6f66 6673 6574 2c20  y=slice(offset, 
-00033090: 6f66 6673 6574 202b 2062 6174 6368 5f73  offset + batch_s
-000330a0: 697a 6529 2c0a 2020 2020 2020 2020 2020  ize),.          
-000330b0: 2020 2020 2020 2020 2020 696e 6469 6365            indice
-000330c0: 733d 7365 6c66 2e5f 696e 6469 6365 7320  s=self._indices 
-000330d0: 6966 2073 656c 662e 5f69 6e64 6963 6573  if self._indices
-000330e0: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-000330f0: 6520 4e6f 6e65 2c0a 2020 2020 2020 2020  e None,.        
-00033100: 2020 2020 2020 2020 292e 746f 5f70 616e          ).to_pan
-00033110: 6461 7328 7479 7065 735f 6d61 7070 6572  das(types_mapper
-00033120: 3d70 616e 6461 735f 7479 7065 735f 6d61  =pandas_types_ma
-00033130: 7070 6572 290a 2020 2020 2020 2020 2020  pper).          
-00033140: 2020 2020 2020 666f 7220 6f66 6673 6574        for offset
-00033150: 2069 6e20 7261 6e67 6528 302c 206c 656e   in range(0, len
-00033160: 2873 656c 6629 2c20 6261 7463 685f 7369  (self), batch_si
-00033170: 7a65 290a 2020 2020 2020 2020 2020 2020  ze).            
-00033180: 290a 0a20 2020 2064 6566 2074 6f5f 7061  )..    def to_pa
-00033190: 7271 7565 7428 0a20 2020 2020 2020 2073  rquet(.        s
-000331a0: 656c 662c 0a20 2020 2020 2020 2070 6174  elf,.        pat
-000331b0: 685f 6f72 5f62 7566 3a20 556e 696f 6e5b  h_or_buf: Union[
-000331c0: 5061 7468 4c69 6b65 2c20 4269 6e61 7279  PathLike, Binary
-000331d0: 494f 5d2c 0a20 2020 2020 2020 2062 6174  IO],.        bat
-000331e0: 6368 5f73 697a 653a 204f 7074 696f 6e61  ch_size: Optiona
-000331f0: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
-00033200: 2020 2020 2020 202a 2a70 6172 7175 6574         **parquet
-00033210: 5f77 7269 7465 725f 6b77 6172 6773 2c0a  _writer_kwargs,.
-00033220: 2020 2020 2920 2d3e 2069 6e74 3a0a 2020      ) -> int:.  
-00033230: 2020 2020 2020 2222 2245 7870 6f72 7473        """Exports
-00033240: 2074 6865 2064 6174 6173 6574 2074 6f20   the dataset to 
-00033250: 7061 7271 7565 740a 0a20 2020 2020 2020  parquet..       
-00033260: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00033270: 2020 2070 6174 685f 6f72 5f62 7566 2028     path_or_buf (
-00033280: 6050 6174 684c 696b 6560 206f 7220 6046  `PathLike` or `F
-00033290: 696c 654f 7242 7566 6665 7260 293a 0a20  ileOrBuffer`):. 
-000332a0: 2020 2020 2020 2020 2020 2020 2020 2045                 E
-000332b0: 6974 6865 7220 6120 7061 7468 2074 6f20  ither a path to 
-000332c0: 6120 6669 6c65 206f 7220 6120 4269 6e61  a file or a Bina
-000332d0: 7279 494f 2e0a 2020 2020 2020 2020 2020  ryIO..          
-000332e0: 2020 6261 7463 685f 7369 7a65 2028 6069    batch_size (`i
-000332f0: 6e74 602c 202a 6f70 7469 6f6e 616c 2a29  nt`, *optional*)
-00033300: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00033310: 2020 5369 7a65 206f 6620 7468 6520 6261    Size of the ba
-00033320: 7463 6820 746f 206c 6f61 6420 696e 206d  tch to load in m
-00033330: 656d 6f72 7920 616e 6420 7772 6974 6520  emory and write 
-00033340: 6174 206f 6e63 652e 0a20 2020 2020 2020  at once..       
-00033350: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00033360: 7320 746f 2060 6461 7461 7365 7473 2e63  s to `datasets.c
-00033370: 6f6e 6669 672e 4445 4641 554c 545f 4d41  onfig.DEFAULT_MA
-00033380: 585f 4241 5443 485f 5349 5a45 602e 0a20  X_BATCH_SIZE`.. 
-00033390: 2020 2020 2020 2020 2020 202a 2a70 6172             **par
-000333a0: 7175 6574 5f77 7269 7465 725f 6b77 6172  quet_writer_kwar
-000333b0: 6773 2028 6164 6469 7469 6f6e 616c 206b  gs (additional k
-000333c0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-000333d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000333e0: 2020 2050 6172 616d 6574 6572 7320 746f     Parameters to
-000333f0: 2070 6173 7320 746f 2050 7941 7272 6f77   pass to PyArrow
-00033400: 2773 2060 7079 6172 726f 772e 7061 7271  's `pyarrow.parq
-00033410: 7565 742e 5061 7271 7565 7457 7269 7465  uet.ParquetWrite
-00033420: 7260 2e0a 0a20 2020 2020 2020 2052 6574  r`...        Ret
-00033430: 7572 6e73 3a0a 2020 2020 2020 2020 2020  urns:.          
-00033440: 2020 6069 6e74 603a 2054 6865 206e 756d    `int`: The num
-00033450: 6265 7220 6f66 2063 6861 7261 6374 6572  ber of character
-00033460: 7320 6f72 2062 7974 6573 2077 7269 7474  s or bytes writt
-00033470: 656e 2e0a 0a20 2020 2020 2020 2045 7861  en...        Exa
-00033480: 6d70 6c65 3a0a 0a20 2020 2020 2020 2060  mple:..        `
-00033490: 6060 7079 0a20 2020 2020 2020 203e 3e3e  ``py.        >>>
-000334a0: 2064 732e 746f 5f70 6172 7175 6574 2822   ds.to_parquet("
-000334b0: 7061 7468 2f74 6f2f 6461 7461 7365 742f  path/to/dataset/
-000334c0: 6469 7265 6374 6f72 7922 290a 2020 2020  directory").    
-000334d0: 2020 2020 6060 600a 2020 2020 2020 2020      ```.        
-000334e0: 2222 220a 2020 2020 2020 2020 2320 4479  """.        # Dy
-000334f0: 6e61 6d69 6320 696d 706f 7274 2074 6f20  namic import to 
-00033500: 6176 6f69 6420 6369 7263 756c 6172 2064  avoid circular d
-00033510: 6570 656e 6465 6e63 790a 2020 2020 2020  ependency.      
-00033520: 2020 6672 6f6d 202e 696f 2e70 6172 7175    from .io.parqu
-00033530: 6574 2069 6d70 6f72 7420 5061 7271 7565  et import Parque
-00033540: 7444 6174 6173 6574 5772 6974 6572 0a0a  tDatasetWriter..
-00033550: 2020 2020 2020 2020 7265 7475 726e 2050          return P
-00033560: 6172 7175 6574 4461 7461 7365 7457 7269  arquetDatasetWri
-00033570: 7465 7228 7365 6c66 2c20 7061 7468 5f6f  ter(self, path_o
-00033580: 725f 6275 662c 2062 6174 6368 5f73 697a  r_buf, batch_siz
-00033590: 653d 6261 7463 685f 7369 7a65 2c20 2a2a  e=batch_size, **
-000335a0: 7061 7271 7565 745f 7772 6974 6572 5f6b  parquet_writer_k
-000335b0: 7761 7267 7329 2e77 7269 7465 2829 0a0a  wargs).write()..
-000335c0: 2020 2020 6465 6620 746f 5f73 716c 280a      def to_sql(.
-000335d0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-000335e0: 2020 2020 2020 6e61 6d65 3a20 7374 722c        name: str,
-000335f0: 0a20 2020 2020 2020 2063 6f6e 3a20 556e  .        con: Un
-00033600: 696f 6e5b 7374 722c 2022 7371 6c61 6c63  ion[str, "sqlalc
-00033610: 6865 6d79 2e65 6e67 696e 652e 436f 6e6e  hemy.engine.Conn
-00033620: 6563 7469 6f6e 222c 2022 7371 6c61 6c63  ection", "sqlalc
-00033630: 6865 6d79 2e65 6e67 696e 652e 456e 6769  hemy.engine.Engi
-00033640: 6e65 222c 2022 7371 6c69 7465 332e 436f  ne", "sqlite3.Co
-00033650: 6e6e 6563 7469 6f6e 225d 2c0a 2020 2020  nnection"],.    
-00033660: 2020 2020 6261 7463 685f 7369 7a65 3a20      batch_size: 
-00033670: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
-00033680: 4e6f 6e65 2c0a 2020 2020 2020 2020 2a2a  None,.        **
-00033690: 7371 6c5f 7772 6974 6572 5f6b 7761 7267  sql_writer_kwarg
-000336a0: 732c 0a20 2020 2029 202d 3e20 696e 743a  s,.    ) -> int:
-000336b0: 0a20 2020 2020 2020 2022 2222 4578 706f  .        """Expo
-000336c0: 7274 7320 7468 6520 6461 7461 7365 7420  rts the dataset 
-000336d0: 746f 2061 2053 514c 2064 6174 6162 6173  to a SQL databas
-000336e0: 652e 0a0a 2020 2020 2020 2020 4172 6773  e...        Args
-000336f0: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
-00033700: 6d65 2028 6073 7472 6029 3a0a 2020 2020  me (`str`):.    
-00033710: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
-00033720: 206f 6620 5351 4c20 7461 626c 652e 0a20   of SQL table.. 
-00033730: 2020 2020 2020 2020 2020 2063 6f6e 2028             con (
-00033740: 6073 7472 6020 6f72 2060 7371 6c69 7465  `str` or `sqlite
-00033750: 332e 436f 6e6e 6563 7469 6f6e 6020 6f72  3.Connection` or
-00033760: 2060 7371 6c61 6c63 6865 6d79 2e65 6e67   `sqlalchemy.eng
-00033770: 696e 652e 436f 6e6e 6563 7469 6f6e 6020  ine.Connection` 
-00033780: 6f72 2060 7371 6c61 6c63 6865 6d79 2e65  or `sqlalchemy.e
-00033790: 6e67 696e 652e 436f 6e6e 6563 7469 6f6e  ngine.Connection
-000337a0: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
-000337b0: 2020 2020 4120 5b55 5249 2073 7472 696e      A [URI strin
-000337c0: 675d 2868 7474 7073 3a2f 2f64 6f63 732e  g](https://docs.
-000337d0: 7371 6c61 6c63 6865 6d79 2e6f 7267 2f65  sqlalchemy.org/e
-000337e0: 6e2f 3133 2f63 6f72 652f 656e 6769 6e65  n/13/core/engine
-000337f0: 732e 6874 6d6c 2364 6174 6162 6173 652d  s.html#database-
-00033800: 7572 6c73 2920 6f72 2061 2053 514c 6974  urls) or a SQLit
-00033810: 6533 2f53 514c 416c 6368 656d 7920 636f  e3/SQLAlchemy co
-00033820: 6e6e 6563 7469 6f6e 206f 626a 6563 7420  nnection object 
-00033830: 7573 6564 2074 6f20 7772 6974 6520 746f  used to write to
-00033840: 2061 2064 6174 6162 6173 652e 0a20 2020   a database..   
-00033850: 2020 2020 2020 2020 2062 6174 6368 5f73           batch_s
-00033860: 697a 6520 2860 696e 7460 2c20 2a6f 7074  ize (`int`, *opt
-00033870: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
-00033880: 2020 2020 2020 2020 2053 697a 6520 6f66           Size of
-00033890: 2074 6865 2062 6174 6368 2074 6f20 6c6f   the batch to lo
-000338a0: 6164 2069 6e20 6d65 6d6f 7279 2061 6e64  ad in memory and
-000338b0: 2077 7269 7465 2061 7420 6f6e 6365 2e0a   write at once..
-000338c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000338d0: 4465 6661 756c 7473 2074 6f20 6064 6174  Defaults to `dat
-000338e0: 6173 6574 732e 636f 6e66 6967 2e44 4546  asets.config.DEF
-000338f0: 4155 4c54 5f4d 4158 5f42 4154 4348 5f53  AULT_MAX_BATCH_S
-00033900: 495a 4560 2e0a 2020 2020 2020 2020 2020  IZE`..          
-00033910: 2020 2a2a 7371 6c5f 7772 6974 6572 5f6b    **sql_writer_k
-00033920: 7761 7267 7320 2861 6464 6974 696f 6e61  wargs (additiona
-00033930: 6c20 6b65 7977 6f72 6420 6172 6775 6d65  l keyword argume
-00033940: 6e74 7329 3a0a 2020 2020 2020 2020 2020  nts):.          
-00033950: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00033960: 2074 6f20 7061 7373 2074 6f20 7061 6e64   to pass to pand
-00033970: 6173 2773 205b 6044 6174 6166 7261 6d65  as's [`Dataframe
-00033980: 2e74 6f5f 7371 6c60 5d2e 0a0a 2020 2020  .to_sql`]...    
-00033990: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
-000339a0: 2020 2020 2020 2020 2060 696e 7460 3a20           `int`: 
-000339b0: 5468 6520 6e75 6d62 6572 206f 6620 7265  The number of re
-000339c0: 636f 7264 7320 7772 6974 7465 6e2e 0a0a  cords written...
-000339d0: 2020 2020 2020 2020 4578 616d 706c 653a          Example:
-000339e0: 0a0a 2020 2020 2020 2020 6060 6070 790a  ..        ```py.
-000339f0: 2020 2020 2020 2020 3e3e 3e20 2320 636f          >>> # co
-00033a00: 6e20 7072 6f76 6964 6564 2061 7320 6120  n provided as a 
-00033a10: 636f 6e6e 6563 7469 6f6e 2055 5249 2073  connection URI s
-00033a20: 7472 696e 670a 2020 2020 2020 2020 3e3e  tring.        >>
-00033a30: 3e20 6473 2e74 6f5f 7371 6c28 2264 6174  > ds.to_sql("dat
-00033a40: 6122 2c20 2273 716c 6974 653a 2f2f 2f6d  a", "sqlite:///m
-00033a50: 795f 6f77 6e5f 6462 2e73 716c 2229 0a20  y_own_db.sql"). 
-00033a60: 2020 2020 2020 203e 3e3e 2023 2063 6f6e         >>> # con
-00033a70: 2070 726f 7669 6465 6420 6173 2061 2073   provided as a s
-00033a80: 716c 6974 6533 2063 6f6e 6e65 6374 696f  qlite3 connectio
-00033a90: 6e20 6f62 6a65 6374 0a20 2020 2020 2020  n object.       
-00033aa0: 203e 3e3e 2069 6d70 6f72 7420 7371 6c69   >>> import sqli
-00033ab0: 7465 330a 2020 2020 2020 2020 3e3e 3e20  te3.        >>> 
-00033ac0: 636f 6e20 3d20 7371 6c69 7465 332e 636f  con = sqlite3.co
-00033ad0: 6e6e 6563 7428 226d 795f 6f77 6e5f 6462  nnect("my_own_db
-00033ae0: 2e73 716c 2229 0a20 2020 2020 2020 203e  .sql").        >
-00033af0: 3e3e 2077 6974 6820 636f 6e3a 0a20 2020  >> with con:.   
-00033b00: 2020 2020 202e 2e2e 2020 2020 2064 732e       ...     ds.
-00033b10: 746f 5f73 716c 2822 6461 7461 222c 2063  to_sql("data", c
-00033b20: 6f6e 290a 2020 2020 2020 2020 6060 600a  on).        ```.
-00033b30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00033b40: 2020 2020 2320 4479 6e61 6d69 6320 696d      # Dynamic im
-00033b50: 706f 7274 2074 6f20 6176 6f69 6420 6369  port to avoid ci
-00033b60: 7263 756c 6172 2064 6570 656e 6465 6e63  rcular dependenc
-00033b70: 790a 2020 2020 2020 2020 6672 6f6d 202e  y.        from .
-00033b80: 696f 2e73 716c 2069 6d70 6f72 7420 5371  io.sql import Sq
-00033b90: 6c44 6174 6173 6574 5772 6974 6572 0a0a  lDatasetWriter..
-00033ba0: 2020 2020 2020 2020 7265 7475 726e 2053          return S
-00033bb0: 716c 4461 7461 7365 7457 7269 7465 7228  qlDatasetWriter(
-00033bc0: 7365 6c66 2c20 6e61 6d65 2c20 636f 6e2c  self, name, con,
-00033bd0: 2062 6174 6368 5f73 697a 653d 6261 7463   batch_size=batc
-00033be0: 685f 7369 7a65 2c20 2a2a 7371 6c5f 7772  h_size, **sql_wr
-00033bf0: 6974 6572 5f6b 7761 7267 7329 2e77 7269  iter_kwargs).wri
-00033c00: 7465 2829 0a0a 2020 2020 6465 6620 5f65  te()..    def _e
-00033c10: 7374 696d 6174 655f 6e62 7974 6573 2873  stimate_nbytes(s
-00033c20: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
-00033c30: 2020 2020 2064 6174 6173 6574 5f6e 6279       dataset_nby
-00033c40: 7465 7320 3d20 7365 6c66 2e64 6174 612e  tes = self.data.
-00033c50: 6e62 7974 6573 0a0a 2020 2020 2020 2020  nbytes..        
-00033c60: 2320 4669 6e64 2064 6563 6f64 6162 6c65  # Find decodable
-00033c70: 2063 6f6c 756d 6e73 2c20 6265 6361 7573   columns, becaus
-00033c80: 6520 6966 2074 6865 7265 2061 7265 2061  e if there are a
-00033c90: 6e79 2c20 7765 206e 6565 6420 746f 0a20  ny, we need to. 
-00033ca0: 2020 2020 2020 2023 2061 646a 7573 7420         # adjust 
-00033cb0: 7468 6520 6461 7461 7365 7420 7369 7a65  the dataset size
-00033cc0: 2063 6f6d 7075 7461 7469 6f6e 2028 6e65   computation (ne
-00033cd0: 6564 6564 2066 6f72 2073 6861 7264 696e  eded for shardin
-00033ce0: 6729 2074 6f20 6163 636f 756e 7420 666f  g) to account fo
-00033cf0: 7220 706f 7373 6962 6c65 2065 7874 6572  r possible exter
-00033d00: 6e61 6c20 6669 6c65 730a 2020 2020 2020  nal files.      
-00033d10: 2020 6465 636f 6461 626c 655f 636f 6c75    decodable_colu
-00033d20: 6d6e 7320 3d20 5b6b 2066 6f72 206b 2c20  mns = [k for k, 
-00033d30: 7620 696e 2073 656c 662e 6665 6174 7572  v in self.featur
-00033d40: 6573 2e69 7465 6d73 2829 2069 6620 7265  es.items() if re
-00033d50: 7175 6972 655f 6465 636f 6469 6e67 2876  quire_decoding(v
-00033d60: 2c20 6967 6e6f 7265 5f64 6563 6f64 655f  , ignore_decode_
-00033d70: 6174 7472 6962 7574 653d 5472 7565 295d  attribute=True)]
-00033d80: 0a0a 2020 2020 2020 2020 6966 2064 6563  ..        if dec
-00033d90: 6f64 6162 6c65 5f63 6f6c 756d 6e73 3a0a  odable_columns:.
-00033da0: 2020 2020 2020 2020 2020 2020 2320 4170              # Ap
-00033db0: 7072 6f78 696d 6174 6520 7468 6520 7370  proximate the sp
-00033dc0: 6163 6520 6e65 6564 6564 2074 6f20 7374  ace needed to st
-00033dd0: 6f72 6520 7468 6520 6279 7465 7320 6672  ore the bytes fr
-00033de0: 6f6d 2074 6865 2065 7874 6572 6e61 6c20  om the external 
-00033df0: 6669 6c65 7320 6279 2061 6e61 6c79 7a69  files by analyzi
-00033e00: 6e67 2074 6865 2066 6972 7374 2031 3030  ng the first 100
-00033e10: 3020 6578 616d 706c 6573 0a20 2020 2020  0 examples.     
-00033e20: 2020 2020 2020 2065 7874 7261 5f6e 6279         extra_nby
-00033e30: 7465 7320 3d20 300a 0a20 2020 2020 2020  tes = 0..       
-00033e40: 2020 2020 2064 6566 2065 7874 7261 5f6e       def extra_n
-00033e50: 6279 7465 735f 7669 7369 746f 7228 6172  bytes_visitor(ar
-00033e60: 7261 792c 2066 6561 7475 7265 293a 0a20  ray, feature):. 
-00033e70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00033e80: 6f6e 6c6f 6361 6c20 6578 7472 615f 6e62  onlocal extra_nb
-00033e90: 7974 6573 0a20 2020 2020 2020 2020 2020  ytes.           
-00033ea0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00033eb0: 6365 2866 6561 7475 7265 2c20 2841 7564  ce(feature, (Aud
-00033ec0: 696f 2c20 496d 6167 6529 293a 0a20 2020  io, Image)):.   
-00033ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033ee0: 2066 6f72 2078 2069 6e20 6172 7261 792e   for x in array.
-00033ef0: 746f 5f70 796c 6973 7428 293a 0a20 2020  to_pylist():.   
-00033f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033f10: 2020 2020 2069 6620 7820 6973 206e 6f74       if x is not
-00033f20: 204e 6f6e 6520 616e 6420 785b 2262 7974   None and x["byt
-00033f30: 6573 225d 2069 7320 4e6f 6e65 2061 6e64  es"] is None and
-00033f40: 2078 5b22 7061 7468 225d 2069 7320 6e6f   x["path"] is no
-00033f50: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00033f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033f70: 2020 2020 7369 7a65 203d 2078 6765 7473      size = xgets
-00033f80: 697a 6528 785b 2270 6174 6822 5d29 0a20  ize(x["path"]). 
-00033f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033fa0: 2020 2020 2020 2020 2020 2065 7874 7261             extra
-00033fb0: 5f6e 6279 7465 7320 2b3d 2073 697a 650a  _nbytes += size.
-00033fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033fd0: 2020 2020 6578 7472 615f 6e62 7974 6573      extra_nbytes
-00033fe0: 202d 3d20 6172 7261 792e 6669 656c 6428   -= array.field(
-00033ff0: 2270 6174 6822 292e 6e62 7974 6573 0a0a  "path").nbytes..
-00034000: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-00034010: 6520 3d20 7365 6c66 2e77 6974 685f 666f  e = self.with_fo
-00034020: 726d 6174 2822 6172 726f 7722 295b 3a31  rmat("arrow")[:1
-00034030: 3030 305d 0a20 2020 2020 2020 2020 2020  000].           
-00034040: 2074 6162 6c65 5f76 6973 6974 6f72 2874   table_visitor(t
-00034050: 6162 6c65 2c20 6578 7472 615f 6e62 7974  able, extra_nbyt
-00034060: 6573 5f76 6973 6974 6f72 290a 0a20 2020  es_visitor)..   
-00034070: 2020 2020 2020 2020 2065 7874 7261 5f6e           extra_n
-00034080: 6279 7465 7320 3d20 6578 7472 615f 6e62  bytes = extra_nb
-00034090: 7974 6573 202a 206c 656e 2873 656c 662e  ytes * len(self.
-000340a0: 6461 7461 2920 2f20 6c65 6e28 7461 626c  data) / len(tabl
-000340b0: 6529 0a20 2020 2020 2020 2020 2020 2064  e).            d
-000340c0: 6174 6173 6574 5f6e 6279 7465 7320 3d20  ataset_nbytes = 
-000340d0: 6461 7461 7365 745f 6e62 7974 6573 202b  dataset_nbytes +
-000340e0: 2065 7874 7261 5f6e 6279 7465 730a 0a20   extra_nbytes.. 
-000340f0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00034100: 696e 6469 6365 7320 6973 206e 6f74 204e  indices is not N
-00034110: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00034120: 2064 6174 6173 6574 5f6e 6279 7465 7320   dataset_nbytes 
-00034130: 3d20 6461 7461 7365 745f 6e62 7974 6573  = dataset_nbytes
-00034140: 202a 206c 656e 2873 656c 662e 5f69 6e64   * len(self._ind
-00034150: 6963 6573 2920 2f20 6c65 6e28 7365 6c66  ices) / len(self
-00034160: 2e64 6174 6129 0a20 2020 2020 2020 2072  .data).        r
-00034170: 6574 7572 6e20 6461 7461 7365 745f 6e62  eturn dataset_nb
-00034180: 7974 6573 0a0a 2020 2020 6465 6620 5f70  ytes..    def _p
-00034190: 7573 685f 7061 7271 7565 745f 7368 6172  ush_parquet_shar
-000341a0: 6473 5f74 6f5f 6875 6228 0a20 2020 2020  ds_to_hub(.     
-000341b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000341c0: 2072 6570 6f5f 6964 3a20 7374 722c 0a20   repo_id: str,. 
-000341d0: 2020 2020 2020 2073 706c 6974 3a20 4f70         split: Op
-000341e0: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-000341f0: 6e65 2c0a 2020 2020 2020 2020 7072 6976  ne,.        priv
-00034200: 6174 653a 204f 7074 696f 6e61 6c5b 626f  ate: Optional[bo
-00034210: 6f6c 5d20 3d20 4661 6c73 652c 0a20 2020  ol] = False,.   
-00034220: 2020 2020 2074 6f6b 656e 3a20 4f70 7469       token: Opti
-00034230: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-00034240: 2c0a 2020 2020 2020 2020 6272 616e 6368  ,.        branch
-00034250: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-00034260: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00034270: 6d61 785f 7368 6172 645f 7369 7a65 3a20  max_shard_size: 
-00034280: 4f70 7469 6f6e 616c 5b55 6e69 6f6e 5b69  Optional[Union[i
-00034290: 6e74 2c20 7374 725d 5d20 3d20 4e6f 6e65  nt, str]] = None
-000342a0: 2c0a 2020 2020 2020 2020 6e75 6d5f 7368  ,.        num_sh
-000342b0: 6172 6473 3a20 4f70 7469 6f6e 616c 5b69  ards: Optional[i
-000342c0: 6e74 5d20 3d20 4e6f 6e65 2c0a 2020 2020  nt] = None,.    
-000342d0: 2020 2020 656d 6265 645f 6578 7465 726e      embed_extern
-000342e0: 616c 5f66 696c 6573 3a20 626f 6f6c 203d  al_files: bool =
-000342f0: 2054 7275 652c 0a20 2020 2029 202d 3e20   True,.    ) -> 
-00034300: 5475 706c 655b 7374 722c 2073 7472 2c20  Tuple[str, str, 
-00034310: 696e 742c 2069 6e74 5d3a 0a20 2020 2020  int, int]:.     
-00034320: 2020 2022 2222 5075 7368 6573 2074 6865     """Pushes the
-00034330: 2064 6174 6173 6574 2074 6f20 7468 6520   dataset to the 
-00034340: 6875 622e 0a20 2020 2020 2020 2054 6865  hub..        The
-00034350: 2064 6174 6173 6574 2069 7320 7075 7368   dataset is push
-00034360: 6564 2075 7369 6e67 2048 5454 5020 7265  ed using HTTP re
-00034370: 7175 6573 7473 2061 6e64 2064 6f65 7320  quests and does 
-00034380: 6e6f 7420 6e65 6564 2074 6f20 6861 7665  not need to have
-00034390: 206e 6569 7468 6572 2067 6974 206f 7220   neither git or 
-000343a0: 6769 742d 6c66 7320 696e 7374 616c 6c65  git-lfs installe
-000343b0: 642e 0a0a 2020 2020 2020 2020 4172 6773  d...        Args
-000343c0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000343d0: 706f 5f69 6420 2860 7374 7260 293a 0a20  po_id (`str`):. 
-000343e0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-000343f0: 6865 2049 4420 6f66 2074 6865 2072 6570  he ID of the rep
-00034400: 6f73 6974 6f72 7920 746f 2070 7573 6820  ository to push 
-00034410: 746f 2069 6e20 7468 6520 666f 6c6c 6f77  to in the follow
-00034420: 696e 6720 666f 726d 6174 3a20 603c 7573  ing format: `<us
-00034430: 6572 3e2f 3c64 6174 6173 6574 5f6e 616d  er>/<dataset_nam
-00034440: 653e 6020 6f72 0a20 2020 2020 2020 2020  e>` or.         
-00034450: 2020 2020 2020 2060 3c6f 7267 3e2f 3c64         `<org>/<d
-00034460: 6174 6173 6574 5f6e 616d 653e 602e 2041  ataset_name>`. A
-00034470: 6c73 6f20 6163 6365 7074 7320 603c 6461  lso accepts `<da
-00034480: 7461 7365 745f 6e61 6d65 3e60 2c20 7768  taset_name>`, wh
-00034490: 6963 6820 7769 6c6c 2064 6566 6175 6c74  ich will default
-000344a0: 2074 6f20 7468 6520 6e61 6d65 7370 6163   to the namespac
-000344b0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000344c0: 2020 6f66 2074 6865 206c 6f67 6765 642d    of the logged-
-000344d0: 696e 2075 7365 722e 0a20 2020 2020 2020  in user..       
-000344e0: 2020 2020 2073 706c 6974 2028 4f70 7469       split (Opti
-000344f0: 6f6e 616c 2c20 6073 7472 6029 3a0a 2020  onal, `str`):.  
-00034500: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-00034510: 6520 6e61 6d65 206f 6620 7468 6520 7370  e name of the sp
-00034520: 6c69 7420 7468 6174 2077 696c 6c20 6265  lit that will be
-00034530: 2067 6976 656e 2074 6f20 7468 6174 2064   given to that d
-00034540: 6174 6173 6574 2e20 4465 6661 756c 7473  ataset. Defaults
-00034550: 2074 6f20 6073 656c 662e 7370 6c69 7460   to `self.split`
-00034560: 2e0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00034570: 6976 6174 6520 284f 7074 696f 6e61 6c20  ivate (Optional 
-00034580: 6062 6f6f 6c60 2c20 6465 6661 756c 7473  `bool`, defaults
-00034590: 2074 6f20 6046 616c 7365 6029 3a0a 2020   to `False`):.  
-000345a0: 2020 2020 2020 2020 2020 2020 2020 5768                Wh
-000345b0: 6574 6865 7220 7468 6520 6461 7461 7365  ether the datase
-000345c0: 7420 7265 706f 7369 746f 7279 2073 686f  t repository sho
-000345d0: 756c 6420 6265 2073 6574 2074 6f20 7072  uld be set to pr
-000345e0: 6976 6174 6520 6f72 206e 6f74 2e20 4f6e  ivate or not. On
-000345f0: 6c79 2061 6666 6563 7473 2072 6570 6f73  ly affects repos
-00034600: 6974 6f72 7920 6372 6561 7469 6f6e 3a0a  itory creation:.
-00034610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034620: 6120 7265 706f 7369 746f 7279 2074 6861  a repository tha
-00034630: 7420 616c 7265 6164 7920 6578 6973 7473  t already exists
-00034640: 2077 696c 6c20 6e6f 7420 6265 2061 6666   will not be aff
-00034650: 6563 7465 6420 6279 2074 6861 7420 7061  ected by that pa
-00034660: 7261 6d65 7465 722e 0a20 2020 2020 2020  rameter..       
-00034670: 2020 2020 2074 6f6b 656e 2028 4f70 7469       token (Opti
-00034680: 6f6e 616c 2060 7374 7260 293a 0a20 2020  onal `str`):.   
-00034690: 2020 2020 2020 2020 2020 2020 2041 6e20               An 
-000346a0: 6f70 7469 6f6e 616c 2061 7574 6865 6e74  optional authent
-000346b0: 6963 6174 696f 6e20 746f 6b65 6e20 666f  ication token fo
-000346c0: 7220 7468 6520 4875 6767 696e 6720 4661  r the Hugging Fa
-000346d0: 6365 2048 7562 2e20 4966 206e 6f20 746f  ce Hub. If no to
-000346e0: 6b65 6e20 6973 2070 6173 7365 642c 2077  ken is passed, w
-000346f0: 696c 6c20 6465 6661 756c 740a 2020 2020  ill default.    
-00034700: 2020 2020 2020 2020 2020 2020 746f 2074              to t
-00034710: 6865 2074 6f6b 656e 2073 6176 6564 206c  he token saved l
-00034720: 6f63 616c 6c79 2077 6865 6e20 6c6f 6767  ocally when logg
-00034730: 696e 6720 696e 2077 6974 6820 6060 6875  ing in with ``hu
-00034740: 6767 696e 6766 6163 652d 636c 6920 6c6f  ggingface-cli lo
-00034750: 6769 6e60 602e 2057 696c 6c20 7261 6973  gin``. Will rais
-00034760: 6520 616e 2065 7272 6f72 0a20 2020 2020  e an error.     
-00034770: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00034780: 2074 6f6b 656e 2069 7320 7061 7373 6564   token is passed
-00034790: 2061 6e64 2074 6865 2075 7365 7220 6973   and the user is
-000347a0: 206e 6f74 206c 6f67 6765 642d 696e 2e0a   not logged-in..
-000347b0: 2020 2020 2020 2020 2020 2020 6272 616e              bran
-000347c0: 6368 2028 4f70 7469 6f6e 616c 2060 7374  ch (Optional `st
-000347d0: 7260 293a 0a20 2020 2020 2020 2020 2020  r`):.           
-000347e0: 2020 2020 2054 6865 2067 6974 2062 7261       The git bra
-000347f0: 6e63 6820 6f6e 2077 6869 6368 2074 6f20  nch on which to 
-00034800: 7075 7368 2074 6865 2064 6174 6173 6574  push the dataset
-00034810: 2e20 5468 6973 2064 6566 6175 6c74 7320  . This defaults 
-00034820: 746f 2074 6865 2064 6566 6175 6c74 2062  to the default b
-00034830: 7261 6e63 6820 6173 2073 7065 6369 6669  ranch as specifi
-00034840: 6564 0a20 2020 2020 2020 2020 2020 2020  ed.             
-00034850: 2020 2069 6e20 796f 7572 2072 6570 6f73     in your repos
-00034860: 6974 6f72 792c 2077 6869 6368 2064 6566  itory, which def
-00034870: 6175 6c74 7320 746f 2060 226d 6169 6e22  aults to `"main"
-00034880: 602e 0a20 2020 2020 2020 2020 2020 206d  `..            m
-00034890: 6178 5f73 6861 7264 5f73 697a 6520 2860  ax_shard_size (`
-000348a0: 696e 7460 206f 7220 6073 7472 602c 202a  int` or `str`, *
-000348b0: 6f70 7469 6f6e 616c 2a2c 2064 6566 6175  optional*, defau
-000348c0: 6c74 7320 746f 2060 2235 3030 4d42 2260  lts to `"500MB"`
-000348d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000348e0: 2020 2054 6865 206d 6178 696d 756d 2073     The maximum s
-000348f0: 697a 6520 6f66 2074 6865 2064 6174 6173  ize of the datas
-00034900: 6574 2073 6861 7264 7320 746f 2062 6520  et shards to be 
-00034910: 7570 6c6f 6164 6564 2074 6f20 7468 6520  uploaded to the 
-00034920: 6875 622e 2049 6620 6578 7072 6573 7365  hub. If expresse
-00034930: 6420 6173 2061 2073 7472 696e 672c 206e  d as a string, n
-00034940: 6565 6473 2074 6f20 6265 2064 6967 6974  eeds to be digit
-00034950: 7320 666f 6c6c 6f77 6564 2062 7920 610a  s followed by a.
-00034960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034970: 6120 756e 6974 2028 6c69 6b65 2060 2235  a unit (like `"5
-00034980: 4d42 2260 292e 0a20 2020 2020 2020 2020  MB"`)..         
-00034990: 2020 206e 756d 5f73 6861 7264 7320 2860     num_shards (`
-000349a0: 696e 7460 2c20 2a6f 7074 696f 6e61 6c2a  int`, *optional*
-000349b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000349c0: 2020 204e 756d 6265 7220 6f66 2073 6861     Number of sha
-000349d0: 7264 7320 746f 2077 7269 7465 2e20 4279  rds to write. By
-000349e0: 2064 6566 6175 6c74 2074 6865 206e 756d   default the num
-000349f0: 6265 7220 6f66 2073 6861 7264 7320 6465  ber of shards de
-00034a00: 7065 6e64 7320 6f6e 2060 6d61 785f 7368  pends on `max_sh
-00034a10: 6172 645f 7369 7a65 602e 0a0a 2020 2020  ard_size`...    
-00034a20: 2020 2020 2020 2020 2020 2020 3c41 6464              <Add
-00034a30: 6564 2076 6572 7369 6f6e 3d22 322e 382e  ed version="2.8.
-00034a40: 3022 2f3e 0a20 2020 2020 2020 2020 2020  0"/>.           
-00034a50: 2065 6d62 6564 5f65 7874 6572 6e61 6c5f   embed_external_
-00034a60: 6669 6c65 7320 2860 626f 6f6c 602c 2064  files (`bool`, d
-00034a70: 6566 6175 6c74 2060 6054 7275 6560 6029  efault ``True``)
-00034a80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00034a90: 2020 5768 6574 6865 7220 746f 2065 6d62    Whether to emb
-00034aa0: 6564 2066 696c 6520 6279 7465 7320 696e  ed file bytes in
-00034ab0: 2074 6865 2073 6861 7264 732e 0a20 2020   the shards..   
-00034ac0: 2020 2020 2020 2020 2020 2020 2049 6e20               In 
-00034ad0: 7061 7274 6963 756c 6172 2c20 7468 6973  particular, this
-00034ae0: 2077 696c 6c20 646f 2074 6865 2066 6f6c   will do the fol
-00034af0: 6c6f 7769 6e67 2062 6566 6f72 6520 7468  lowing before th
-00034b00: 6520 7075 7368 2066 6f72 2074 6865 2066  e push for the f
-00034b10: 6965 6c64 7320 6f66 2074 7970 653a 0a0a  ields of type:..
-00034b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034b30: 2d20 3a63 6c61 7373 3a60 4175 6469 6f60  - :class:`Audio`
-00034b40: 2061 6e64 2063 6c61 7373 3a60 496d 6167   and class:`Imag
-00034b50: 6560 3a20 7265 6d6f 7665 206c 6f63 616c  e`: remove local
-00034b60: 2070 6174 6820 696e 666f 726d 6174 696f   path informatio
-00034b70: 6e20 616e 6420 656d 6265 6420 6669 6c65  n and embed file
-00034b80: 2063 6f6e 7465 6e74 2069 6e20 7468 6520   content in the 
-00034b90: 5061 7271 7565 7420 6669 6c65 732e 0a0a  Parquet files...
-00034ba0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-00034bb0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00034bc0: 6f5f 6964 2028 6073 7472 6029 3a20 4944  o_id (`str`): ID
-00034bd0: 206f 6620 7468 6520 7265 706f 7369 746f   of the reposito
-00034be0: 7279 2069 6e20 3c75 7365 723e 2f3c 6461  ry in <user>/<da
-00034bf0: 7461 7365 745f 6e61 6d65 3e60 206f 7220  taset_name>` or 
-00034c00: 603c 6f72 673e 2f3c 6461 7461 7365 745f  `<org>/<dataset_
-00034c10: 6e61 6d65 3e60 2066 6f72 6d61 740a 2020  name>` format.  
-00034c20: 2020 2020 2020 2020 2020 7370 6c69 7420            split 
-00034c30: 2860 7374 7260 293a 206e 616d 6520 6f66  (`str`): name of
-00034c40: 2074 6865 2075 706c 6f61 6465 6420 7370   the uploaded sp
-00034c50: 6c69 740a 2020 2020 2020 2020 2020 2020  lit.            
-00034c60: 7570 6c6f 6164 6564 5f73 697a 6520 2860  uploaded_size (`
-00034c70: 696e 7460 293a 206e 756d 6265 7220 6f66  int`): number of
-00034c80: 2075 706c 6f61 6465 6420 6279 7465 7320   uploaded bytes 
-00034c90: 746f 2074 6865 2072 6570 6f73 6974 6f72  to the repositor
-00034ca0: 790a 2020 2020 2020 2020 2020 2020 6461  y.            da
-00034cb0: 7461 7365 745f 6e62 7974 6573 2028 6069  taset_nbytes (`i
-00034cc0: 6e74 6029 3a20 6170 7072 6f78 696d 6174  nt`): approximat
-00034cd0: 6520 7369 7a65 2069 6e20 6279 7465 7320  e size in bytes 
-00034ce0: 6f66 2074 6865 2075 706c 6f61 6465 6420  of the uploaded 
-00034cf0: 6461 7461 7365 7420 6166 6572 2075 6e63  dataset afer unc
-00034d00: 6f6d 7072 6573 7369 6f6e 0a20 2020 2020  ompression.     
-00034d10: 2020 2020 2020 2072 6570 6f5f 6669 6c65         repo_file
-00034d20: 7320 2860 7374 7260 293a 206c 6973 7420  s (`str`): list 
-00034d30: 6f66 2066 696c 6573 2069 6e20 7468 6520  of files in the 
-00034d40: 7265 706f 7369 746f 7279 0a20 2020 2020  repository.     
-00034d50: 2020 2020 2020 2064 656c 6574 6564 5f73         deleted_s
-00034d60: 697a 6520 2860 696e 7460 293a 206e 756d  ize (`int`): num
-00034d70: 6265 7220 6f66 2064 656c 6574 6564 2062  ber of deleted b
-00034d80: 7974 6573 2069 6e20 7468 6520 7265 706f  ytes in the repo
-00034d90: 7369 746f 7279 0a0a 2020 2020 2020 2020  sitory..        
-00034da0: 4578 616d 706c 653a 0a0a 2020 2020 2020  Example:..      
-00034db0: 2020 6060 6070 7974 686f 6e0a 2020 2020    ```python.    
-00034dc0: 2020 2020 3e3e 3e20 6461 7461 7365 742e      >>> dataset.
-00034dd0: 7075 7368 5f74 6f5f 6875 6228 223c 6f72  push_to_hub("<or
-00034de0: 6761 6e69 7a61 7469 6f6e 3e2f 3c64 6174  ganization>/<dat
-00034df0: 6173 6574 5f69 643e 222c 2073 706c 6974  aset_id>", split
-00034e00: 3d22 6576 616c 7561 7469 6f6e 2229 0a20  ="evaluation"). 
-00034e10: 2020 2020 2020 2060 6060 0a20 2020 2020         ```.     
-00034e20: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00034e30: 6620 6d61 785f 7368 6172 645f 7369 7a65  f max_shard_size
-00034e40: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00034e50: 206e 756d 5f73 6861 7264 7320 6973 206e   num_shards is n
-00034e60: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00034e70: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00034e80: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00034e90: 2020 2020 2020 2022 4661 696c 6564 2074         "Failed t
-00034ea0: 6f20 7075 7368 5f74 6f5f 6875 623a 2070  o push_to_hub: p
-00034eb0: 6c65 6173 6520 7370 6563 6966 7920 6569  lease specify ei
-00034ec0: 7468 6572 206d 6178 5f73 6861 7264 5f73  ther max_shard_s
-00034ed0: 697a 6520 6f72 206e 756d 5f73 6861 7264  ize or num_shard
-00034ee0: 732c 2062 7574 206e 6f74 2062 6f74 682e  s, but not both.
-00034ef0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00034f00: 0a20 2020 2020 2020 2061 7069 203d 2048  .        api = H
-00034f10: 6641 7069 2865 6e64 706f 696e 743d 636f  fApi(endpoint=co
-00034f20: 6e66 6967 2e48 465f 454e 4450 4f49 4e54  nfig.HF_ENDPOINT
-00034f30: 290a 2020 2020 2020 2020 746f 6b65 6e20  ).        token 
-00034f40: 3d20 746f 6b65 6e20 6966 2074 6f6b 656e  = token if token
-00034f50: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-00034f60: 6520 4866 466f 6c64 6572 2e67 6574 5f74  e HfFolder.get_t
-00034f70: 6f6b 656e 2829 0a0a 2020 2020 2020 2020  oken()..        
-00034f80: 6966 2074 6f6b 656e 2069 7320 4e6f 6e65  if token is None
-00034f90: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00034fa0: 6973 6520 456e 7669 726f 6e6d 656e 7445  ise EnvironmentE
-00034fb0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00034fc0: 2020 2020 2020 2259 6f75 206e 6565 6420        "You need 
-00034fd0: 746f 2070 726f 7669 6465 2061 2060 746f  to provide a `to
-00034fe0: 6b65 6e60 206f 7220 6265 206c 6f67 6765  ken` or be logge
-00034ff0: 6420 696e 2074 6f20 4875 6767 696e 6720  d in to Hugging 
-00035000: 4661 6365 2077 6974 6820 6068 7567 6769  Face with `huggi
-00035010: 6e67 6661 6365 2d63 6c69 206c 6f67 696e  ngface-cli login
-00035020: 602e 220a 2020 2020 2020 2020 2020 2020  `.".            
-00035030: 290a 0a20 2020 2020 2020 2069 6620 7370  )..        if sp
-00035040: 6c69 7420 6973 204e 6f6e 653a 0a20 2020  lit is None:.   
-00035050: 2020 2020 2020 2020 2073 706c 6974 203d           split =
-00035060: 2073 7472 2873 656c 662e 7370 6c69 7429   str(self.split)
-00035070: 2069 6620 7365 6c66 2e73 706c 6974 2069   if self.split i
-00035080: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-00035090: 2274 7261 696e 220a 0a20 2020 2020 2020  "train"..       
-000350a0: 2069 6620 6e6f 7420 7265 2e6d 6174 6368   if not re.match
-000350b0: 285f 7370 6c69 745f 7265 2c20 7370 6c69  (_split_re, spli
-000350c0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-000350d0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000350e0: 2866 2253 706c 6974 206e 616d 6520 7368  (f"Split name sh
-000350f0: 6f75 6c64 206d 6174 6368 2027 7b5f 7370  ould match '{_sp
-00035100: 6c69 745f 7265 7d27 2062 7574 2067 6f74  lit_re}' but got
-00035110: 2027 7b73 706c 6974 7d27 2e22 290a 0a20   '{split}'.").. 
-00035120: 2020 2020 2020 2069 6465 6e74 6966 6965         identifie
-00035130: 7220 3d20 7265 706f 5f69 642e 7370 6c69  r = repo_id.spli
-00035140: 7428 222f 2229 0a0a 2020 2020 2020 2020  t("/")..        
-00035150: 6966 206c 656e 2869 6465 6e74 6966 6965  if len(identifie
-00035160: 7229 203e 2032 3a0a 2020 2020 2020 2020  r) > 2:.        
-00035170: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00035180: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00035190: 2020 2020 2020 6622 5468 6520 6964 656e        f"The iden
-000351a0: 7469 6669 6572 2073 686f 756c 6420 6265  tifier should be
-000351b0: 2069 6e20 7468 6520 666f 726d 6174 203c   in the format <
-000351c0: 7265 706f 5f69 643e 206f 7220 3c6e 616d  repo_id> or <nam
-000351d0: 6573 7061 6365 3e2f 3c72 6570 6f5f 6964  espace>/<repo_id
-000351e0: 3e2e 2049 7420 6973 207b 6964 656e 7469  >. It is {identi
-000351f0: 6669 6572 7d2c 2022 0a20 2020 2020 2020  fier}, ".       
-00035200: 2020 2020 2020 2020 2022 7768 6963 6820           "which 
-00035210: 646f 6573 6e27 7420 636f 6e66 6f72 6d20  doesn't conform 
-00035220: 746f 2065 6974 6865 7220 666f 726d 6174  to either format
-00035230: 2e22 0a20 2020 2020 2020 2020 2020 2029  .".            )
-00035240: 0a20 2020 2020 2020 2065 6c69 6620 6c65  .        elif le
-00035250: 6e28 6964 656e 7469 6669 6572 2920 3d3d  n(identifier) ==
-00035260: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00035270: 6461 7461 7365 745f 6e61 6d65 203d 2069  dataset_name = i
-00035280: 6465 6e74 6966 6965 725b 305d 0a20 2020  dentifier[0].   
-00035290: 2020 2020 2020 2020 206f 7267 616e 697a           organiz
-000352a0: 6174 696f 6e5f 6f72 5f75 7365 726e 616d  ation_or_usernam
-000352b0: 6520 3d20 6170 692e 7768 6f61 6d69 2874  e = api.whoami(t
-000352c0: 6f6b 656e 295b 226e 616d 6522 5d0a 2020  oken)["name"].  
-000352d0: 2020 2020 2020 2020 2020 7265 706f 5f69            repo_i
-000352e0: 6420 3d20 6622 7b6f 7267 616e 697a 6174  d = f"{organizat
-000352f0: 696f 6e5f 6f72 5f75 7365 726e 616d 657d  ion_or_username}
-00035300: 2f7b 6461 7461 7365 745f 6e61 6d65 7d22  /{dataset_name}"
-00035310: 0a0a 2020 2020 2020 2020 6372 6561 7465  ..        create
-00035320: 5f72 6570 6f28 0a20 2020 2020 2020 2020  _repo(.         
-00035330: 2020 2061 7069 2c0a 2020 2020 2020 2020     api,.        
-00035340: 2020 2020 7265 706f 5f69 642c 0a20 2020      repo_id,.   
-00035350: 2020 2020 2020 2020 2074 6f6b 656e 3d74           token=t
-00035360: 6f6b 656e 2c0a 2020 2020 2020 2020 2020  oken,.          
-00035370: 2020 7265 706f 5f74 7970 653d 2264 6174    repo_type="dat
-00035380: 6173 6574 222c 0a20 2020 2020 2020 2020  aset",.         
-00035390: 2020 2070 7269 7661 7465 3d70 7269 7661     private=priva
-000353a0: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
-000353b0: 6578 6973 745f 6f6b 3d54 7275 652c 0a20  exist_ok=True,. 
-000353c0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-000353d0: 2020 2320 4669 6e64 2064 6563 6f64 6162    # Find decodab
-000353e0: 6c65 2063 6f6c 756d 6e73 2c20 6265 6361  le columns, beca
-000353f0: 7573 6520 6966 2074 6865 7265 2061 7265  use if there are
-00035400: 2061 6e79 2c20 7765 206e 6565 6420 746f   any, we need to
-00035410: 3a0a 2020 2020 2020 2020 2320 656d 6265  :.        # embe
-00035420: 6420 7468 6520 6279 7465 7320 6672 6f6d  d the bytes from
-00035430: 2074 6865 2066 696c 6573 2069 6e20 7468   the files in th
-00035440: 6520 7368 6172 6473 0a20 2020 2020 2020  e shards.       
-00035450: 2064 6563 6f64 6162 6c65 5f63 6f6c 756d   decodable_colum
-00035460: 6e73 203d 2028 0a20 2020 2020 2020 2020  ns = (.         
-00035470: 2020 205b 6b20 666f 7220 6b2c 2076 2069     [k for k, v i
-00035480: 6e20 7365 6c66 2e66 6561 7475 7265 732e  n self.features.
-00035490: 6974 656d 7328 2920 6966 2072 6571 7569  items() if requi
-000354a0: 7265 5f64 6563 6f64 696e 6728 762c 2069  re_decoding(v, i
-000354b0: 676e 6f72 655f 6465 636f 6465 5f61 7474  gnore_decode_att
-000354c0: 7269 6275 7465 3d54 7275 6529 5d0a 2020  ribute=True)].  
-000354d0: 2020 2020 2020 2020 2020 6966 2065 6d62            if emb
-000354e0: 6564 5f65 7874 6572 6e61 6c5f 6669 6c65  ed_external_file
-000354f0: 730a 2020 2020 2020 2020 2020 2020 656c  s.            el
-00035500: 7365 205b 5d0a 2020 2020 2020 2020 290a  se [].        ).
-00035510: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
-00035520: 5f6e 6279 7465 7320 3d20 7365 6c66 2e5f  _nbytes = self._
-00035530: 6573 7469 6d61 7465 5f6e 6279 7465 7328  estimate_nbytes(
-00035540: 290a 0a20 2020 2020 2020 2069 6620 6e75  )..        if nu
-00035550: 6d5f 7368 6172 6473 2069 7320 4e6f 6e65  m_shards is None
-00035560: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-00035570: 785f 7368 6172 645f 7369 7a65 203d 2063  x_shard_size = c
-00035580: 6f6e 7665 7274 5f66 696c 655f 7369 7a65  onvert_file_size
-00035590: 5f74 6f5f 696e 7428 6d61 785f 7368 6172  _to_int(max_shar
-000355a0: 645f 7369 7a65 206f 7220 636f 6e66 6967  d_size or config
-000355b0: 2e4d 4158 5f53 4841 5244 5f53 495a 4529  .MAX_SHARD_SIZE)
-000355c0: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
-000355d0: 5f73 6861 7264 7320 3d20 696e 7428 6461  _shards = int(da
-000355e0: 7461 7365 745f 6e62 7974 6573 202f 206d  taset_nbytes / m
-000355f0: 6178 5f73 6861 7264 5f73 697a 6529 202b  ax_shard_size) +
-00035600: 2031 0a20 2020 2020 2020 2020 2020 206e   1.            n
-00035610: 756d 5f73 6861 7264 7320 3d20 6d61 7828  um_shards = max(
-00035620: 6e75 6d5f 7368 6172 6473 2c20 3129 0a0a  num_shards, 1)..
-00035630: 2020 2020 2020 2020 7368 6172 6473 203d          shards =
-00035640: 2028 7365 6c66 2e73 6861 7264 286e 756d   (self.shard(num
-00035650: 5f73 6861 7264 733d 6e75 6d5f 7368 6172  _shards=num_shar
-00035660: 6473 2c20 696e 6465 783d 692c 2063 6f6e  ds, index=i, con
-00035670: 7469 6775 6f75 733d 5472 7565 2920 666f  tiguous=True) fo
-00035680: 7220 6920 696e 2072 616e 6765 286e 756d  r i in range(num
-00035690: 5f73 6861 7264 7329 290a 0a20 2020 2020  _shards))..     
-000356a0: 2020 2069 6620 6465 636f 6461 626c 655f     if decodable_
-000356b0: 636f 6c75 6d6e 733a 0a0a 2020 2020 2020  columns:..      
-000356c0: 2020 2020 2020 6465 6620 7368 6172 6473        def shards
-000356d0: 5f77 6974 685f 656d 6265 6464 6564 5f65  _with_embedded_e
-000356e0: 7874 6572 6e61 6c5f 6669 6c65 7328 7368  xternal_files(sh
-000356f0: 6172 6473 293a 0a20 2020 2020 2020 2020  ards):.         
-00035700: 2020 2020 2020 2066 6f72 2073 6861 7264         for shard
-00035710: 2069 6e20 7368 6172 6473 3a0a 2020 2020   in shards:.    
-00035720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035730: 666f 726d 6174 203d 2073 6861 7264 2e66  format = shard.f
-00035740: 6f72 6d61 740a 2020 2020 2020 2020 2020  ormat.          
-00035750: 2020 2020 2020 2020 2020 7368 6172 6420            shard 
-00035760: 3d20 7368 6172 642e 7769 7468 5f66 6f72  = shard.with_for
-00035770: 6d61 7428 2261 7272 6f77 2229 0a20 2020  mat("arrow").   
-00035780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035790: 2073 6861 7264 203d 2073 6861 7264 2e6d   shard = shard.m
-000357a0: 6170 280a 2020 2020 2020 2020 2020 2020  ap(.            
-000357b0: 2020 2020 2020 2020 2020 2020 656d 6265              embe
-000357c0: 645f 7461 626c 655f 7374 6f72 6167 652c  d_table_storage,
-000357d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000357e0: 2020 2020 2020 2020 2062 6174 6368 6564           batched
-000357f0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-00035800: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00035810: 6174 6368 5f73 697a 653d 3130 3030 2c0a  atch_size=1000,.
-00035820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035830: 2020 2020 2020 2020 6b65 6570 5f69 6e5f          keep_in_
-00035840: 6d65 6d6f 7279 3d54 7275 652c 0a20 2020  memory=True,.   
-00035850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035860: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00035870: 2020 2020 2020 2073 6861 7264 203d 2073         shard = s
-00035880: 6861 7264 2e77 6974 685f 666f 726d 6174  hard.with_format
-00035890: 282a 2a66 6f72 6d61 7429 0a20 2020 2020  (**format).     
-000358a0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-000358b0: 6965 6c64 2073 6861 7264 0a0a 2020 2020  ield shard..    
-000358c0: 2020 2020 2020 2020 7368 6172 6473 203d          shards =
-000358d0: 2073 6861 7264 735f 7769 7468 5f65 6d62   shards_with_emb
-000358e0: 6564 6465 645f 6578 7465 726e 616c 5f66  edded_external_f
-000358f0: 696c 6573 2873 6861 7264 7329 0a0a 2020  iles(shards)..  
-00035900: 2020 2020 2020 6669 6c65 7320 3d20 6866        files = hf
-00035910: 5f61 7069 5f6c 6973 745f 7265 706f 5f66  _api_list_repo_f
-00035920: 696c 6573 2861 7069 2c20 7265 706f 5f69  iles(api, repo_i
-00035930: 642c 2072 6570 6f5f 7479 7065 3d22 6461  d, repo_type="da
-00035940: 7461 7365 7422 2c20 7265 7669 7369 6f6e  taset", revision
-00035950: 3d62 7261 6e63 682c 2075 7365 5f61 7574  =branch, use_aut
-00035960: 685f 746f 6b65 6e3d 746f 6b65 6e29 0a20  h_token=token). 
-00035970: 2020 2020 2020 2064 6174 615f 6669 6c65         data_file
-00035980: 7320 3d20 5b66 696c 6520 666f 7220 6669  s = [file for fi
-00035990: 6c65 2069 6e20 6669 6c65 7320 6966 2066  le in files if f
-000359a0: 696c 652e 7374 6172 7473 7769 7468 2822  ile.startswith("
-000359b0: 6461 7461 2f22 295d 0a0a 2020 2020 2020  data/")]..      
-000359c0: 2020 6465 6620 7061 7468 5f69 6e5f 7265    def path_in_re
-000359d0: 706f 285f 696e 6465 782c 2073 6861 7264  po(_index, shard
-000359e0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-000359f0: 6574 7572 6e20 6622 6461 7461 2f7b 7370  eturn f"data/{sp
-00035a00: 6c69 747d 2d7b 5f69 6e64 6578 3a30 3564  lit}-{_index:05d
-00035a10: 7d2d 6f66 2d7b 6e75 6d5f 7368 6172 6473  }-of-{num_shards
-00035a20: 3a30 3564 7d2d 7b73 6861 7264 2e5f 6669  :05d}-{shard._fi
-00035a30: 6e67 6572 7072 696e 747d 2e70 6172 7175  ngerprint}.parqu
-00035a40: 6574 220a 0a20 2020 2020 2020 2073 6861  et"..        sha
-00035a50: 7264 735f 6974 6572 203d 2069 7465 7228  rds_iter = iter(
-00035a60: 7368 6172 6473 290a 2020 2020 2020 2020  shards).        
-00035a70: 6669 7273 745f 7368 6172 6420 3d20 6e65  first_shard = ne
-00035a80: 7874 2873 6861 7264 735f 6974 6572 290a  xt(shards_iter).
-00035a90: 2020 2020 2020 2020 6669 7273 745f 7368          first_sh
-00035aa0: 6172 645f 7061 7468 5f69 6e5f 7265 706f  ard_path_in_repo
-00035ab0: 203d 2070 6174 685f 696e 5f72 6570 6f28   = path_in_repo(
-00035ac0: 302c 2066 6972 7374 5f73 6861 7264 290a  0, first_shard).
-00035ad0: 2020 2020 2020 2020 6966 2066 6972 7374          if first
-00035ae0: 5f73 6861 7264 5f70 6174 685f 696e 5f72  _shard_path_in_r
-00035af0: 6570 6f20 696e 2064 6174 615f 6669 6c65  epo in data_file
-00035b00: 7320 616e 6420 6e75 6d5f 7368 6172 6473  s and num_shards
-00035b10: 203c 206c 656e 2864 6174 615f 6669 6c65   < len(data_file
-00035b20: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00035b30: 6c6f 6767 6572 2e77 6172 6e69 6e67 2822  logger.warning("
-00035b40: 5265 7375 6d69 6e67 2075 706c 6f61 6420  Resuming upload 
-00035b50: 6f66 2074 6865 2064 6174 6173 6574 2073  of the dataset s
-00035b60: 6861 7264 732e 2229 0a0a 2020 2020 2020  hards.")..      
-00035b70: 2020 7570 6c6f 6164 6564 5f73 697a 6520    uploaded_size 
-00035b80: 3d20 300a 2020 2020 2020 2020 7368 6172  = 0.        shar
-00035b90: 6473 5f70 6174 685f 696e 5f72 6570 6f20  ds_path_in_repo 
-00035ba0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-00035bb0: 2069 6e64 6578 2c20 7368 6172 6420 696e   index, shard in
-00035bc0: 206c 6f67 6769 6e67 2e74 7164 6d28 0a20   logging.tqdm(. 
-00035bd0: 2020 2020 2020 2020 2020 2065 6e75 6d65             enume
-00035be0: 7261 7465 2869 7465 7274 6f6f 6c73 2e63  rate(itertools.c
-00035bf0: 6861 696e 285b 6669 7273 745f 7368 6172  hain([first_shar
-00035c00: 645d 2c20 7368 6172 6473 5f69 7465 7229  d], shards_iter)
-00035c10: 292c 0a20 2020 2020 2020 2020 2020 2064  ),.            d
-00035c20: 6573 633d 2250 7573 6869 6e67 2064 6174  esc="Pushing dat
-00035c30: 6173 6574 2073 6861 7264 7320 746f 2074  aset shards to t
-00035c40: 6865 2064 6174 6173 6574 2068 7562 222c  he dataset hub",
-00035c50: 0a20 2020 2020 2020 2020 2020 2074 6f74  .            tot
-00035c60: 616c 3d6e 756d 5f73 6861 7264 732c 0a20  al=num_shards,. 
-00035c70: 2020 2020 2020 2020 2020 2064 6973 6162             disab
-00035c80: 6c65 3d6e 6f74 206c 6f67 6769 6e67 2e69  le=not logging.i
-00035c90: 735f 7072 6f67 7265 7373 5f62 6172 5f65  s_progress_bar_e
-00035ca0: 6e61 626c 6564 2829 2c0a 2020 2020 2020  nabled(),.      
-00035cb0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-00035cc0: 2073 6861 7264 5f70 6174 685f 696e 5f72   shard_path_in_r
-00035cd0: 6570 6f20 3d20 7061 7468 5f69 6e5f 7265  epo = path_in_re
-00035ce0: 706f 2869 6e64 6578 2c20 7368 6172 6429  po(index, shard)
-00035cf0: 0a20 2020 2020 2020 2020 2020 2023 2055  .            # U
-00035d00: 706c 6f61 6420 6120 7368 6172 6420 6f6e  pload a shard on
-00035d10: 6c79 2069 6620 6974 2064 6f65 736e 2774  ly if it doesn't
-00035d20: 2061 6c72 6561 6479 2065 7869 7374 2069   already exist i
-00035d30: 6e20 7468 6520 7265 706f 7369 746f 7279  n the repository
-00035d40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00035d50: 7368 6172 645f 7061 7468 5f69 6e5f 7265  shard_path_in_re
-00035d60: 706f 206e 6f74 2069 6e20 6461 7461 5f66  po not in data_f
-00035d70: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
-00035d80: 2020 2020 2020 6275 6666 6572 203d 2042        buffer = B
-00035d90: 7974 6573 494f 2829 0a20 2020 2020 2020  ytesIO().       
-00035da0: 2020 2020 2020 2020 2073 6861 7264 2e74           shard.t
-00035db0: 6f5f 7061 7271 7565 7428 6275 6666 6572  o_parquet(buffer
-00035dc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00035dd0: 2020 7570 6c6f 6164 6564 5f73 697a 6520    uploaded_size 
-00035de0: 2b3d 2062 7566 6665 722e 7465 6c6c 2829  += buffer.tell()
-00035df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00035e00: 205f 7265 7472 7928 0a20 2020 2020 2020   _retry(.       
-00035e10: 2020 2020 2020 2020 2020 2020 2061 7069               api
-00035e20: 2e75 706c 6f61 645f 6669 6c65 2c0a 2020  .upload_file,.  
-00035e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035e40: 2020 6675 6e63 5f6b 7761 7267 733d 6469    func_kwargs=di
-00035e50: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
-00035e60: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00035e70: 5f6f 725f 6669 6c65 6f62 6a3d 6275 6666  _or_fileobj=buff
-00035e80: 6572 2e67 6574 7661 6c75 6528 292c 0a20  er.getvalue(),. 
-00035e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035ea0: 2020 2020 2020 2070 6174 685f 696e 5f72         path_in_r
-00035eb0: 6570 6f3d 7368 6172 645f 7061 7468 5f69  epo=shard_path_i
-00035ec0: 6e5f 7265 706f 2c0a 2020 2020 2020 2020  n_repo,.        
-00035ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035ee0: 7265 706f 5f69 643d 7265 706f 5f69 642c  repo_id=repo_id,
-00035ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00035f00: 2020 2020 2020 2020 2074 6f6b 656e 3d74           token=t
-00035f10: 6f6b 656e 2c0a 2020 2020 2020 2020 2020  oken,.          
-00035f20: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00035f30: 706f 5f74 7970 653d 2264 6174 6173 6574  po_type="dataset
-00035f40: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00035f50: 2020 2020 2020 2020 2020 2072 6576 6973             revis
-00035f60: 696f 6e3d 6272 616e 6368 2c0a 2020 2020  ion=branch,.    
-00035f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035f80: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00035f90: 2020 2020 2020 2065 7863 6570 7469 6f6e         exception
-00035fa0: 733d 4854 5450 4572 726f 722c 0a20 2020  s=HTTPError,.   
-00035fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035fc0: 2073 7461 7475 735f 636f 6465 733d 5b35   status_codes=[5
-00035fd0: 3034 5d2c 0a20 2020 2020 2020 2020 2020  04],.           
-00035fe0: 2020 2020 2020 2020 2062 6173 655f 7761           base_wa
-00035ff0: 6974 5f74 696d 653d 322e 302c 0a20 2020  it_time=2.0,.   
-00036000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036010: 206d 6178 5f72 6574 7269 6573 3d35 2c0a   max_retries=5,.
-00036020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036030: 2020 2020 6d61 785f 7761 6974 5f74 696d      max_wait_tim
-00036040: 653d 3230 2e30 2c0a 2020 2020 2020 2020  e=20.0,.        
-00036050: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00036060: 2020 2020 2020 7368 6172 6473 5f70 6174        shards_pat
-00036070: 685f 696e 5f72 6570 6f2e 6170 7065 6e64  h_in_repo.append
-00036080: 2873 6861 7264 5f70 6174 685f 696e 5f72  (shard_path_in_r
-00036090: 6570 6f29 0a0a 2020 2020 2020 2020 2320  epo)..        # 
-000360a0: 436c 6561 6e75 7020 746f 2072 656d 6f76  Cleanup to remov
-000360b0: 6520 756e 7573 6564 2066 696c 6573 0a20  e unused files. 
-000360c0: 2020 2020 2020 2064 6174 615f 6669 6c65         data_file
-000360d0: 735f 746f 5f64 656c 6574 6520 3d20 5b0a  s_to_delete = [.
-000360e0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-000360f0: 5f66 696c 650a 2020 2020 2020 2020 2020  _file.          
-00036100: 2020 666f 7220 6461 7461 5f66 696c 6520    for data_file 
-00036110: 696e 2064 6174 615f 6669 6c65 730a 2020  in data_files.  
-00036120: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
-00036130: 615f 6669 6c65 2e73 7461 7274 7377 6974  a_file.startswit
-00036140: 6828 6622 6461 7461 2f7b 7370 6c69 747d  h(f"data/{split}
-00036150: 2d22 2920 616e 6420 6461 7461 5f66 696c  -") and data_fil
-00036160: 6520 6e6f 7420 696e 2073 6861 7264 735f  e not in shards_
-00036170: 7061 7468 5f69 6e5f 7265 706f 0a20 2020  path_in_repo.   
-00036180: 2020 2020 205d 0a20 2020 2020 2020 2064       ].        d
-00036190: 656c 6574 6564 5f73 697a 6520 3d20 7375  eleted_size = su
-000361a0: 6d28 0a20 2020 2020 2020 2020 2020 2078  m(.            x
-000361b0: 6765 7473 697a 6528 6866 5f68 7562 5f75  getsize(hf_hub_u
-000361c0: 726c 2872 6570 6f5f 6964 2c20 6461 7461  rl(repo_id, data
-000361d0: 5f66 696c 6529 2c20 7573 655f 6175 7468  _file), use_auth
-000361e0: 5f74 6f6b 656e 3d74 6f6b 656e 2920 666f  _token=token) fo
-000361f0: 7220 6461 7461 5f66 696c 6520 696e 2064  r data_file in d
-00036200: 6174 615f 6669 6c65 735f 746f 5f64 656c  ata_files_to_del
-00036210: 6574 650a 2020 2020 2020 2020 290a 0a20  ete.        ).. 
-00036220: 2020 2020 2020 2064 6566 2064 656c 6574         def delet
-00036230: 655f 6669 6c65 2866 696c 6529 3a0a 2020  e_file(file):.  
-00036240: 2020 2020 2020 2020 2020 6170 692e 6465            api.de
-00036250: 6c65 7465 5f66 696c 6528 6669 6c65 2c20  lete_file(file, 
-00036260: 7265 706f 5f69 643d 7265 706f 5f69 642c  repo_id=repo_id,
-00036270: 2074 6f6b 656e 3d74 6f6b 656e 2c20 7265   token=token, re
-00036280: 706f 5f74 7970 653d 2264 6174 6173 6574  po_type="dataset
-00036290: 222c 2072 6576 6973 696f 6e3d 6272 616e  ", revision=bran
-000362a0: 6368 290a 0a20 2020 2020 2020 2069 6620  ch)..        if 
-000362b0: 6c65 6e28 6461 7461 5f66 696c 6573 5f74  len(data_files_t
-000362c0: 6f5f 6465 6c65 7465 293a 0a20 2020 2020  o_delete):.     
-000362d0: 2020 2020 2020 2066 6f72 2064 6174 615f         for data_
-000362e0: 6669 6c65 2069 6e20 6c6f 6767 696e 672e  file in logging.
-000362f0: 7471 646d 280a 2020 2020 2020 2020 2020  tqdm(.          
-00036300: 2020 2020 2020 6461 7461 5f66 696c 6573        data_files
-00036310: 5f74 6f5f 6465 6c65 7465 2c0a 2020 2020  _to_delete,.    
-00036320: 2020 2020 2020 2020 2020 2020 6465 7363              desc
-00036330: 3d22 4465 6c65 7469 6e67 2075 6e75 7365  ="Deleting unuse
-00036340: 6420 6669 6c65 7320 6672 6f6d 2064 6174  d files from dat
-00036350: 6173 6574 2072 6570 6f73 6974 6f72 7922  aset repository"
-00036360: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00036370: 2020 746f 7461 6c3d 6c65 6e28 6461 7461    total=len(data
-00036380: 5f66 696c 6573 5f74 6f5f 6465 6c65 7465  _files_to_delete
-00036390: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-000363a0: 2020 2064 6973 6162 6c65 3d6e 6f74 206c     disable=not l
-000363b0: 6f67 6769 6e67 2e69 735f 7072 6f67 7265  ogging.is_progre
-000363c0: 7373 5f62 6172 5f65 6e61 626c 6564 2829  ss_bar_enabled()
-000363d0: 2c0a 2020 2020 2020 2020 2020 2020 293a  ,.            ):
-000363e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000363f0: 2064 656c 6574 655f 6669 6c65 2864 6174   delete_file(dat
-00036400: 615f 6669 6c65 290a 0a20 2020 2020 2020  a_file)..       
-00036410: 2072 6570 6f5f 6669 6c65 7320 3d20 6c69   repo_files = li
-00036420: 7374 2873 6574 2866 696c 6573 2920 2d20  st(set(files) - 
-00036430: 7365 7428 6461 7461 5f66 696c 6573 5f74  set(data_files_t
-00036440: 6f5f 6465 6c65 7465 2929 0a0a 2020 2020  o_delete))..    
-00036450: 2020 2020 7265 7475 726e 2072 6570 6f5f      return repo_
-00036460: 6964 2c20 7370 6c69 742c 2075 706c 6f61  id, split, uploa
-00036470: 6465 645f 7369 7a65 2c20 6461 7461 7365  ded_size, datase
-00036480: 745f 6e62 7974 6573 2c20 7265 706f 5f66  t_nbytes, repo_f
-00036490: 696c 6573 2c20 6465 6c65 7465 645f 7369  iles, deleted_si
-000364a0: 7a65 0a0a 2020 2020 6465 6620 7075 7368  ze..    def push
-000364b0: 5f74 6f5f 6875 6228 0a20 2020 2020 2020  _to_hub(.       
-000364c0: 2073 656c 662c 0a20 2020 2020 2020 2072   self,.        r
-000364d0: 6570 6f5f 6964 3a20 7374 722c 0a20 2020  epo_id: str,.   
-000364e0: 2020 2020 2073 706c 6974 3a20 4f70 7469       split: Opti
-000364f0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-00036500: 2c0a 2020 2020 2020 2020 7072 6976 6174  ,.        privat
-00036510: 653a 204f 7074 696f 6e61 6c5b 626f 6f6c  e: Optional[bool
-00036520: 5d20 3d20 4661 6c73 652c 0a20 2020 2020  ] = False,.     
-00036530: 2020 2074 6f6b 656e 3a20 4f70 7469 6f6e     token: Option
-00036540: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-00036550: 2020 2020 2020 2020 6272 616e 6368 3a20          branch: 
-00036560: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-00036570: 4e6f 6e65 2c0a 2020 2020 2020 2020 6d61  None,.        ma
-00036580: 785f 7368 6172 645f 7369 7a65 3a20 4f70  x_shard_size: Op
-00036590: 7469 6f6e 616c 5b55 6e69 6f6e 5b69 6e74  tional[Union[int
-000365a0: 2c20 7374 725d 5d20 3d20 4e6f 6e65 2c0a  , str]] = None,.
-000365b0: 2020 2020 2020 2020 6e75 6d5f 7368 6172          num_shar
-000365c0: 6473 3a20 4f70 7469 6f6e 616c 5b69 6e74  ds: Optional[int
-000365d0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-000365e0: 2020 7368 6172 645f 7369 7a65 3a20 4f70    shard_size: Op
-000365f0: 7469 6f6e 616c 5b69 6e74 5d20 3d20 2264  tional[int] = "d
-00036600: 6570 7265 6361 7465 6422 2c0a 2020 2020  eprecated",.    
-00036610: 2020 2020 656d 6265 645f 6578 7465 726e      embed_extern
-00036620: 616c 5f66 696c 6573 3a20 626f 6f6c 203d  al_files: bool =
-00036630: 2054 7275 652c 0a20 2020 2029 3a0a 2020   True,.    ):.  
-00036640: 2020 2020 2020 2222 2250 7573 6865 7320        """Pushes 
-00036650: 7468 6520 6461 7461 7365 7420 746f 2074  the dataset to t
-00036660: 6865 2068 7562 2061 7320 6120 5061 7271  he hub as a Parq
-00036670: 7565 7420 6461 7461 7365 742e 0a20 2020  uet dataset..   
-00036680: 2020 2020 2054 6865 2064 6174 6173 6574       The dataset
-00036690: 2069 7320 7075 7368 6564 2075 7369 6e67   is pushed using
-000366a0: 2048 5454 5020 7265 7175 6573 7473 2061   HTTP requests a
-000366b0: 6e64 2064 6f65 7320 6e6f 7420 6e65 6564  nd does not need
-000366c0: 2074 6f20 6861 7665 206e 6569 7468 6572   to have neither
-000366d0: 2067 6974 206f 7220 6769 742d 6c66 7320   git or git-lfs 
-000366e0: 696e 7374 616c 6c65 642e 0a0a 2020 2020  installed...    
-000366f0: 2020 2020 5468 6520 7265 7375 6c74 696e      The resultin
-00036700: 6720 5061 7271 7565 7420 6669 6c65 7320  g Parquet files 
-00036710: 6172 6520 7365 6c66 2d63 6f6e 7461 696e  are self-contain
-00036720: 6564 2062 7920 6465 6661 756c 742e 2049  ed by default. I
-00036730: 6620 796f 7572 2064 6174 6173 6574 2063  f your dataset c
-00036740: 6f6e 7461 696e 7320 5b60 496d 6167 6560  ontains [`Image`
-00036750: 5d20 6f72 205b 6041 7564 696f 605d 0a20  ] or [`Audio`]. 
-00036760: 2020 2020 2020 2064 6174 612c 2074 6865         data, the
-00036770: 2050 6172 7175 6574 2066 696c 6573 2077   Parquet files w
-00036780: 696c 6c20 7374 6f72 6520 7468 6520 6279  ill store the by
-00036790: 7465 7320 6f66 2079 6f75 7220 696d 6167  tes of your imag
-000367a0: 6573 206f 7220 6175 6469 6f20 6669 6c65  es or audio file
-000367b0: 732e 0a20 2020 2020 2020 2059 6f75 2063  s..        You c
-000367c0: 616e 2064 6973 6162 6c65 2074 6869 7320  an disable this 
-000367d0: 6279 2073 6574 7469 6e67 2060 656d 6265  by setting `embe
-000367e0: 645f 6578 7465 726e 616c 5f66 696c 6573  d_external_files
-000367f0: 6020 746f 2060 4661 6c73 6560 2e0a 0a20  ` to `False`... 
-00036800: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00036810: 2020 2020 2020 2020 2072 6570 6f5f 6964           repo_id
-00036820: 2028 6073 7472 6029 3a0a 2020 2020 2020   (`str`):.      
-00036830: 2020 2020 2020 2020 2020 5468 6520 4944            The ID
-00036840: 206f 6620 7468 6520 7265 706f 7369 746f   of the reposito
-00036850: 7279 2074 6f20 7075 7368 2074 6f20 696e  ry to push to in
-00036860: 2074 6865 2066 6f6c 6c6f 7769 6e67 2066   the following f
-00036870: 6f72 6d61 743a 2060 3c75 7365 723e 2f3c  ormat: `<user>/<
-00036880: 6461 7461 7365 745f 6e61 6d65 3e60 206f  dataset_name>` o
-00036890: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-000368a0: 2020 603c 6f72 673e 2f3c 6461 7461 7365    `<org>/<datase
-000368b0: 745f 6e61 6d65 3e60 2e20 416c 736f 2061  t_name>`. Also a
-000368c0: 6363 6570 7473 2060 3c64 6174 6173 6574  ccepts `<dataset
-000368d0: 5f6e 616d 653e 602c 2077 6869 6368 2077  _name>`, which w
-000368e0: 696c 6c20 6465 6661 756c 7420 746f 2074  ill default to t
-000368f0: 6865 206e 616d 6573 7061 6365 0a20 2020  he namespace.   
-00036900: 2020 2020 2020 2020 2020 2020 206f 6620               of 
-00036910: 7468 6520 6c6f 6767 6564 2d69 6e20 7573  the logged-in us
-00036920: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
-00036930: 7370 6c69 7420 2860 7374 7260 2c20 2a6f  split (`str`, *o
-00036940: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
-00036950: 2020 2020 2020 2020 2020 2054 6865 206e             The n
-00036960: 616d 6520 6f66 2074 6865 2073 706c 6974  ame of the split
-00036970: 2074 6861 7420 7769 6c6c 2062 6520 6769   that will be gi
-00036980: 7665 6e20 746f 2074 6861 7420 6461 7461  ven to that data
-00036990: 7365 742e 2044 6566 6175 6c74 7320 746f  set. Defaults to
-000369a0: 2060 7365 6c66 2e73 706c 6974 602e 0a20   `self.split`.. 
-000369b0: 2020 2020 2020 2020 2020 2070 7269 7661             priva
-000369c0: 7465 2028 6062 6f6f 6c60 2c20 2a6f 7074  te (`bool`, *opt
-000369d0: 696f 6e61 6c2a 2c20 6465 6661 756c 7473  ional*, defaults
-000369e0: 2074 6f20 6046 616c 7365 6029 3a0a 2020   to `False`):.  
-000369f0: 2020 2020 2020 2020 2020 2020 2020 5768                Wh
-00036a00: 6574 6865 7220 7468 6520 6461 7461 7365  ether the datase
-00036a10: 7420 7265 706f 7369 746f 7279 2073 686f  t repository sho
-00036a20: 756c 6420 6265 2073 6574 2074 6f20 7072  uld be set to pr
-00036a30: 6976 6174 6520 6f72 206e 6f74 2e20 4f6e  ivate or not. On
-00036a40: 6c79 2061 6666 6563 7473 2072 6570 6f73  ly affects repos
-00036a50: 6974 6f72 7920 6372 6561 7469 6f6e 3a0a  itory creation:.
-00036a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036a70: 6120 7265 706f 7369 746f 7279 2074 6861  a repository tha
-00036a80: 7420 616c 7265 6164 7920 6578 6973 7473  t already exists
-00036a90: 2077 696c 6c20 6e6f 7420 6265 2061 6666   will not be aff
-00036aa0: 6563 7465 6420 6279 2074 6861 7420 7061  ected by that pa
-00036ab0: 7261 6d65 7465 722e 0a20 2020 2020 2020  rameter..       
-00036ac0: 2020 2020 2074 6f6b 656e 2028 6073 7472       token (`str
-00036ad0: 602c 202a 6f70 7469 6f6e 616c 2a29 3a0a  `, *optional*):.
-00036ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036af0: 416e 206f 7074 696f 6e61 6c20 6175 7468  An optional auth
-00036b00: 656e 7469 6361 7469 6f6e 2074 6f6b 656e  entication token
-00036b10: 2066 6f72 2074 6865 2048 7567 6769 6e67   for the Hugging
-00036b20: 2046 6163 6520 4875 622e 2049 6620 6e6f   Face Hub. If no
-00036b30: 2074 6f6b 656e 2069 7320 7061 7373 6564   token is passed
-00036b40: 2c20 7769 6c6c 2064 6566 6175 6c74 0a20  , will default. 
-00036b50: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00036b60: 6f20 7468 6520 746f 6b65 6e20 7361 7665  o the token save
-00036b70: 6420 6c6f 6361 6c6c 7920 7768 656e 206c  d locally when l
-00036b80: 6f67 6769 6e67 2069 6e20 7769 7468 2060  ogging in with `
-00036b90: 6875 6767 696e 6766 6163 652d 636c 6920  huggingface-cli 
-00036ba0: 6c6f 6769 6e60 2e20 5769 6c6c 2072 6169  login`. Will rai
-00036bb0: 7365 2061 6e20 6572 726f 720a 2020 2020  se an error.    
-00036bc0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00036bd0: 6f20 746f 6b65 6e20 6973 2070 6173 7365  o token is passe
-00036be0: 6420 616e 6420 7468 6520 7573 6572 2069  d and the user i
-00036bf0: 7320 6e6f 7420 6c6f 6767 6564 2d69 6e2e  s not logged-in.
-00036c00: 0a20 2020 2020 2020 2020 2020 2062 7261  .            bra
-00036c10: 6e63 6820 2860 7374 7260 2c20 2a6f 7074  nch (`str`, *opt
-00036c20: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
-00036c30: 2020 2020 2020 2020 2054 6865 2067 6974           The git
-00036c40: 2062 7261 6e63 6820 6f6e 2077 6869 6368   branch on which
-00036c50: 2074 6f20 7075 7368 2074 6865 2064 6174   to push the dat
-00036c60: 6173 6574 2e20 5468 6973 2064 6566 6175  aset. This defau
-00036c70: 6c74 7320 746f 2074 6865 2064 6566 6175  lts to the defau
-00036c80: 6c74 2062 7261 6e63 6820 6173 2073 7065  lt branch as spe
-00036c90: 6369 6669 6564 0a20 2020 2020 2020 2020  cified.         
-00036ca0: 2020 2020 2020 2069 6e20 796f 7572 2072         in your r
-00036cb0: 6570 6f73 6974 6f72 792c 2077 6869 6368  epository, which
-00036cc0: 2064 6566 6175 6c74 7320 746f 2060 226d   defaults to `"m
-00036cd0: 6169 6e22 602e 0a20 2020 2020 2020 2020  ain"`..         
-00036ce0: 2020 206d 6178 5f73 6861 7264 5f73 697a     max_shard_siz
-00036cf0: 6520 2860 696e 7460 206f 7220 6073 7472  e (`int` or `str
-00036d00: 602c 202a 6f70 7469 6f6e 616c 2a2c 2064  `, *optional*, d
-00036d10: 6566 6175 6c74 7320 746f 2060 2235 3030  efaults to `"500
-00036d20: 4d42 2260 293a 0a20 2020 2020 2020 2020  MB"`):.         
-00036d30: 2020 2020 2020 2054 6865 206d 6178 696d         The maxim
-00036d40: 756d 2073 697a 6520 6f66 2074 6865 2064  um size of the d
-00036d50: 6174 6173 6574 2073 6861 7264 7320 746f  ataset shards to
-00036d60: 2062 6520 7570 6c6f 6164 6564 2074 6f20   be uploaded to 
-00036d70: 7468 6520 6875 622e 2049 6620 6578 7072  the hub. If expr
-00036d80: 6573 7365 6420 6173 2061 2073 7472 696e  essed as a strin
-00036d90: 672c 206e 6565 6473 2074 6f20 6265 2064  g, needs to be d
-00036da0: 6967 6974 7320 666f 6c6c 6f77 6564 2062  igits followed b
-00036db0: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-00036dc0: 2020 6120 756e 6974 2028 6c69 6b65 2060    a unit (like `
-00036dd0: 2235 4d42 2260 292e 0a20 2020 2020 2020  "5MB"`)..       
-00036de0: 2020 2020 206e 756d 5f73 6861 7264 7320       num_shards 
-00036df0: 2860 696e 7460 2c20 2a6f 7074 696f 6e61  (`int`, *optiona
-00036e00: 6c2a 293a 204e 756d 6265 7220 6f66 2073  l*): Number of s
-00036e10: 6861 7264 7320 746f 2077 7269 7465 2e20  hards to write. 
-00036e20: 4279 2064 6566 6175 6c74 2074 6865 206e  By default the n
-00036e30: 756d 6265 7220 6f66 2073 6861 7264 7320  umber of shards 
-00036e40: 6465 7065 6e64 7320 6f6e 2060 6d61 785f  depends on `max_
-00036e50: 7368 6172 645f 7369 7a65 602e 0a0a 2020  shard_size`...  
-00036e60: 2020 2020 2020 2020 2020 2020 2020 3c41                <A
-00036e70: 6464 6564 2076 6572 7369 6f6e 3d22 322e  dded version="2.
-00036e80: 382e 3022 2f3e 0a20 2020 2020 2020 2020  8.0"/>.         
-00036e90: 2020 2073 6861 7264 5f73 697a 6520 2860     shard_size (`
-00036ea0: 696e 7460 2c20 2a6f 7074 696f 6e61 6c2a  int`, *optional*
-00036eb0: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
-00036ec0: 2020 2020 3c44 6570 7265 6361 7465 6420      <Deprecated 
-00036ed0: 7665 7273 696f 6e3d 2232 2e34 2e30 223e  version="2.4.0">
-00036ee0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00036ef0: 2020 6073 6861 7264 5f73 697a 6560 2077    `shard_size` w
-00036f00: 6173 2072 656e 616d 6564 2074 6f20 606d  as renamed to `m
-00036f10: 6178 5f73 6861 7264 5f73 697a 6560 2069  ax_shard_size` i
-00036f20: 6e20 7665 7273 696f 6e20 322e 312e 3120  n version 2.1.1 
-00036f30: 616e 6420 7769 6c6c 2062 6520 7265 6d6f  and will be remo
-00036f40: 7665 6420 696e 2032 2e34 2e30 2e0a 0a20  ved in 2.4.0... 
-00036f50: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-00036f60: 2f44 6570 7265 6361 7465 643e 0a0a 2020  /Deprecated>..  
-00036f70: 2020 2020 2020 2020 2020 656d 6265 645f            embed_
-00036f80: 6578 7465 726e 616c 5f66 696c 6573 2028  external_files (
-00036f90: 6062 6f6f 6c60 2c20 6465 6661 756c 7473  `bool`, defaults
-00036fa0: 2074 6f20 6054 7275 6560 293a 0a20 2020   to `True`):.   
-00036fb0: 2020 2020 2020 2020 2020 2020 2057 6865               Whe
-00036fc0: 7468 6572 2074 6f20 656d 6265 6420 6669  ther to embed fi
-00036fd0: 6c65 2062 7974 6573 2069 6e20 7468 6520  le bytes in the 
-00036fe0: 7368 6172 6473 2e0a 2020 2020 2020 2020  shards..        
-00036ff0: 2020 2020 2020 2020 496e 2070 6172 7469          In parti
-00037000: 6375 6c61 722c 2074 6869 7320 7769 6c6c  cular, this will
-00037010: 2064 6f20 7468 6520 666f 6c6c 6f77 696e   do the followin
-00037020: 6720 6265 666f 7265 2074 6865 2070 7573  g before the pus
-00037030: 6820 666f 7220 7468 6520 6669 656c 6473  h for the fields
-00037040: 206f 6620 7479 7065 3a0a 0a20 2020 2020   of type:..     
-00037050: 2020 2020 2020 2020 2020 202d 205b 6041             - [`A
-00037060: 7564 696f 605d 2061 6e64 205b 6049 6d61  udio`] and [`Ima
-00037070: 6765 605d 3a20 7265 6d6f 7665 206c 6f63  ge`]: remove loc
-00037080: 616c 2070 6174 6820 696e 666f 726d 6174  al path informat
-00037090: 696f 6e20 616e 6420 656d 6265 6420 6669  ion and embed fi
-000370a0: 6c65 2063 6f6e 7465 6e74 2069 6e20 7468  le content in th
-000370b0: 6520 5061 7271 7565 7420 6669 6c65 732e  e Parquet files.
-000370c0: 0a0a 2020 2020 2020 2020 4578 616d 706c  ..        Exampl
-000370d0: 653a 0a0a 2020 2020 2020 2020 6060 6070  e:..        ```p
-000370e0: 7974 686f 6e0a 2020 2020 2020 2020 3e3e  ython.        >>
-000370f0: 3e20 6461 7461 7365 742e 7075 7368 5f74  > dataset.push_t
-00037100: 6f5f 6875 6228 223c 6f72 6761 6e69 7a61  o_hub("<organiza
-00037110: 7469 6f6e 3e2f 3c64 6174 6173 6574 5f69  tion>/<dataset_i
-00037120: 643e 2229 0a20 2020 2020 2020 203e 3e3e  d>").        >>>
-00037130: 2064 6174 6173 6574 2e70 7573 685f 746f   dataset.push_to
-00037140: 5f68 7562 2822 3c6f 7267 616e 697a 6174  _hub("<organizat
-00037150: 696f 6e3e 2f3c 6461 7461 7365 745f 6964  ion>/<dataset_id
-00037160: 3e22 2c20 7370 6c69 743d 2276 616c 6964  >", split="valid
-00037170: 6174 696f 6e22 290a 2020 2020 2020 2020  ation").        
-00037180: 3e3e 3e20 6461 7461 7365 742e 7075 7368  >>> dataset.push
-00037190: 5f74 6f5f 6875 6228 223c 6f72 6761 6e69  _to_hub("<organi
-000371a0: 7a61 7469 6f6e 3e2f 3c64 6174 6173 6574  zation>/<dataset
-000371b0: 5f69 643e 222c 206d 6178 5f73 6861 7264  _id>", max_shard
-000371c0: 5f73 697a 653d 2231 4742 2229 0a20 2020  _size="1GB").   
-000371d0: 2020 2020 203e 3e3e 2064 6174 6173 6574       >>> dataset
-000371e0: 2e70 7573 685f 746f 5f68 7562 2822 3c6f  .push_to_hub("<o
-000371f0: 7267 616e 697a 6174 696f 6e3e 2f3c 6461  rganization>/<da
-00037200: 7461 7365 745f 6964 3e22 2c20 6e75 6d5f  taset_id>", num_
-00037210: 7368 6172 6473 3d31 3032 3429 0a20 2020  shards=1024).   
-00037220: 2020 2020 2060 6060 0a20 2020 2020 2020       ```.       
-00037230: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00037240: 7368 6172 645f 7369 7a65 2021 3d20 2264  shard_size != "d
-00037250: 6570 7265 6361 7465 6422 3a0a 2020 2020  eprecated":.    
-00037260: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
-00037270: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
-00037280: 2020 2020 2020 2022 2773 6861 7264 5f73         "'shard_s
-00037290: 697a 6527 2077 6173 2072 656e 616d 6564  ize' was renamed
-000372a0: 2074 6f20 276d 6178 5f73 6861 7264 5f73   to 'max_shard_s
-000372b0: 697a 6527 2069 6e20 7665 7273 696f 6e20  ize' in version 
-000372c0: 322e 312e 3120 616e 6420 7769 6c6c 2062  2.1.1 and will b
-000372d0: 6520 7265 6d6f 7665 6420 696e 2032 2e34  e removed in 2.4
-000372e0: 2e30 2e22 2c0a 2020 2020 2020 2020 2020  .0.",.          
-000372f0: 2020 2020 2020 4675 7475 7265 5761 726e        FutureWarn
-00037300: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
-00037310: 2029 0a20 2020 2020 2020 2020 2020 206d   ).            m
-00037320: 6178 5f73 6861 7264 5f73 697a 6520 3d20  ax_shard_size = 
-00037330: 7368 6172 645f 7369 7a65 0a0a 2020 2020  shard_size..    
-00037340: 2020 2020 6966 206d 6178 5f73 6861 7264      if max_shard
-00037350: 5f73 697a 6520 6973 206e 6f74 204e 6f6e  _size is not Non
-00037360: 6520 616e 6420 6e75 6d5f 7368 6172 6473  e and num_shards
-00037370: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00037380: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00037390: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-000373a0: 2020 2020 2020 2020 2020 2020 2246 6169              "Fai
-000373b0: 6c65 6420 746f 2070 7573 685f 746f 5f68  led to push_to_h
-000373c0: 7562 3a20 706c 6561 7365 2073 7065 6369  ub: please speci
-000373d0: 6679 2065 6974 6865 7220 6d61 785f 7368  fy either max_sh
-000373e0: 6172 645f 7369 7a65 206f 7220 6e75 6d5f  ard_size or num_
-000373f0: 7368 6172 6473 2c20 6275 7420 6e6f 7420  shards, but not 
-00037400: 626f 7468 2e22 0a20 2020 2020 2020 2020  both.".         
-00037410: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
-00037420: 706f 5f69 642c 2073 706c 6974 2c20 7570  po_id, split, up
-00037430: 6c6f 6164 6564 5f73 697a 652c 2064 6174  loaded_size, dat
-00037440: 6173 6574 5f6e 6279 7465 732c 2072 6570  aset_nbytes, rep
-00037450: 6f5f 6669 6c65 732c 2064 656c 6574 6564  o_files, deleted
-00037460: 5f73 697a 6520 3d20 7365 6c66 2e5f 7075  _size = self._pu
-00037470: 7368 5f70 6172 7175 6574 5f73 6861 7264  sh_parquet_shard
-00037480: 735f 746f 5f68 7562 280a 2020 2020 2020  s_to_hub(.      
-00037490: 2020 2020 2020 7265 706f 5f69 643d 7265        repo_id=re
-000374a0: 706f 5f69 642c 0a20 2020 2020 2020 2020  po_id,.         
-000374b0: 2020 2073 706c 6974 3d73 706c 6974 2c0a     split=split,.
-000374c0: 2020 2020 2020 2020 2020 2020 7072 6976              priv
-000374d0: 6174 653d 7072 6976 6174 652c 0a20 2020  ate=private,.   
-000374e0: 2020 2020 2020 2020 2074 6f6b 656e 3d74           token=t
-000374f0: 6f6b 656e 2c0a 2020 2020 2020 2020 2020  oken,.          
-00037500: 2020 6272 616e 6368 3d62 7261 6e63 682c    branch=branch,
-00037510: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
-00037520: 5f73 6861 7264 5f73 697a 653d 6d61 785f  _shard_size=max_
-00037530: 7368 6172 645f 7369 7a65 2c0a 2020 2020  shard_size,.    
-00037540: 2020 2020 2020 2020 6e75 6d5f 7368 6172          num_shar
-00037550: 6473 3d6e 756d 5f73 6861 7264 732c 0a20  ds=num_shards,. 
-00037560: 2020 2020 2020 2020 2020 2065 6d62 6564             embed
-00037570: 5f65 7874 6572 6e61 6c5f 6669 6c65 733d  _external_files=
-00037580: 656d 6265 645f 6578 7465 726e 616c 5f66  embed_external_f
-00037590: 696c 6573 2c0a 2020 2020 2020 2020 290a  iles,.        ).
-000375a0: 2020 2020 2020 2020 6f72 6761 6e69 7a61          organiza
-000375b0: 7469 6f6e 2c20 6461 7461 7365 745f 6e61  tion, dataset_na
-000375c0: 6d65 203d 2072 6570 6f5f 6964 2e73 706c  me = repo_id.spl
-000375d0: 6974 2822 2f22 290a 2020 2020 2020 2020  it("/").        
-000375e0: 696e 666f 5f74 6f5f 6475 6d70 203d 2073  info_to_dump = s
-000375f0: 656c 662e 696e 666f 2e63 6f70 7928 290a  elf.info.copy().
-00037600: 2020 2020 2020 2020 696e 666f 5f74 6f5f          info_to_
-00037610: 6475 6d70 2e64 6f77 6e6c 6f61 645f 6368  dump.download_ch
-00037620: 6563 6b73 756d 7320 3d20 4e6f 6e65 0a20  ecksums = None. 
-00037630: 2020 2020 2020 2069 6e66 6f5f 746f 5f64         info_to_d
-00037640: 756d 702e 646f 776e 6c6f 6164 5f73 697a  ump.download_siz
-00037650: 6520 3d20 7570 6c6f 6164 6564 5f73 697a  e = uploaded_siz
-00037660: 650a 2020 2020 2020 2020 696e 666f 5f74  e.        info_t
-00037670: 6f5f 6475 6d70 2e64 6174 6173 6574 5f73  o_dump.dataset_s
-00037680: 697a 6520 3d20 6461 7461 7365 745f 6e62  ize = dataset_nb
-00037690: 7974 6573 0a20 2020 2020 2020 2069 6e66  ytes.        inf
-000376a0: 6f5f 746f 5f64 756d 702e 7369 7a65 5f69  o_to_dump.size_i
-000376b0: 6e5f 6279 7465 7320 3d20 7570 6c6f 6164  n_bytes = upload
-000376c0: 6564 5f73 697a 6520 2b20 6461 7461 7365  ed_size + datase
-000376d0: 745f 6e62 7974 6573 0a20 2020 2020 2020  t_nbytes.       
-000376e0: 2069 6e66 6f5f 746f 5f64 756d 702e 7370   info_to_dump.sp
-000376f0: 6c69 7473 203d 2053 706c 6974 4469 6374  lits = SplitDict
-00037700: 280a 2020 2020 2020 2020 2020 2020 7b73  (.            {s
-00037710: 706c 6974 3a20 5370 6c69 7449 6e66 6f28  plit: SplitInfo(
-00037720: 7370 6c69 742c 206e 756d 5f62 7974 6573  split, num_bytes
-00037730: 3d64 6174 6173 6574 5f6e 6279 7465 732c  =dataset_nbytes,
-00037740: 206e 756d 5f65 7861 6d70 6c65 733d 6c65   num_examples=le
-00037750: 6e28 7365 6c66 292c 2064 6174 6173 6574  n(self), dataset
-00037760: 5f6e 616d 653d 6461 7461 7365 745f 6e61  _name=dataset_na
-00037770: 6d65 297d 0a20 2020 2020 2020 2029 0a20  me)}.        ). 
-00037780: 2020 2020 2020 2023 2067 6574 2074 6865         # get the
-00037790: 2069 6e66 6f20 6672 6f6d 2074 6865 2052   info from the R
-000377a0: 4541 444d 4520 746f 2075 7064 6174 6520  EADME to update 
-000377b0: 7468 656d 0a20 2020 2020 2020 2069 6620  them.        if 
-000377c0: 2252 4541 444d 452e 6d64 2220 696e 2072  "README.md" in r
-000377d0: 6570 6f5f 6669 6c65 733a 0a20 2020 2020  epo_files:.     
-000377e0: 2020 2020 2020 2064 6f77 6e6c 6f61 645f         download_
-000377f0: 636f 6e66 6967 203d 2044 6f77 6e6c 6f61  config = Downloa
-00037800: 6443 6f6e 6669 6728 290a 2020 2020 2020  dConfig().      
-00037810: 2020 2020 2020 646f 776e 6c6f 6164 5f63        download_c
-00037820: 6f6e 6669 672e 646f 776e 6c6f 6164 5f64  onfig.download_d
-00037830: 6573 6320 3d20 2244 6f77 6e6c 6f61 6469  esc = "Downloadi
-00037840: 6e67 206d 6574 6164 6174 6122 0a20 2020  ng metadata".   
-00037850: 2020 2020 2020 2020 2064 6f77 6e6c 6f61           downloa
-00037860: 645f 636f 6e66 6967 2e75 7365 5f61 7574  d_config.use_aut
-00037870: 685f 746f 6b65 6e20 3d20 746f 6b65 6e0a  h_token = token.
-00037880: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00037890: 7365 745f 7265 6164 6d65 5f70 6174 6820  set_readme_path 
-000378a0: 3d20 6361 6368 6564 5f70 6174 6828 0a20  = cached_path(. 
-000378b0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-000378c0: 665f 6875 625f 7572 6c28 7265 706f 5f69  f_hub_url(repo_i
-000378d0: 642c 2022 5245 4144 4d45 2e6d 6422 292c  d, "README.md"),
-000378e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000378f0: 2064 6f77 6e6c 6f61 645f 636f 6e66 6967   download_config
-00037900: 3d64 6f77 6e6c 6f61 645f 636f 6e66 6967  =download_config
-00037910: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00037920: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00037930: 7365 745f 6d65 7461 6461 7461 203d 2044  set_metadata = D
-00037940: 6174 6173 6574 4d65 7461 6461 7461 2e66  atasetMetadata.f
-00037950: 726f 6d5f 7265 6164 6d65 2850 6174 6828  rom_readme(Path(
-00037960: 6461 7461 7365 745f 7265 6164 6d65 5f70  dataset_readme_p
-00037970: 6174 6829 290a 2020 2020 2020 2020 2020  ath)).          
-00037980: 2020 6461 7461 7365 745f 696e 666f 733a    dataset_infos:
-00037990: 2044 6174 6173 6574 496e 666f 7344 6963   DatasetInfosDic
-000379a0: 7420 3d20 4461 7461 7365 7449 6e66 6f73  t = DatasetInfos
-000379b0: 4469 6374 2e66 726f 6d5f 6d65 7461 6461  Dict.from_metada
-000379c0: 7461 2864 6174 6173 6574 5f6d 6574 6164  ta(dataset_metad
-000379d0: 6174 6129 0a20 2020 2020 2020 2020 2020  ata).           
-000379e0: 2072 6570 6f5f 696e 666f 203d 2064 6174   repo_info = dat
-000379f0: 6173 6574 5f69 6e66 6f73 5b6e 6578 7428  aset_infos[next(
-00037a00: 6974 6572 2864 6174 6173 6574 5f69 6e66  iter(dataset_inf
-00037a10: 6f73 2929 5d0a 2020 2020 2020 2020 2320  os))].        # 
-00037a20: 6765 7420 7468 6520 6465 7072 6563 6174  get the deprecat
-00037a30: 6564 2064 6174 6173 6574 5f69 6e66 6f73  ed dataset_infos
-00037a40: 2e6a 736f 6e20 746f 2075 6f64 6174 6520  .json to uodate 
-00037a50: 7468 656d 0a20 2020 2020 2020 2065 6c69  them.        eli
-00037a60: 6620 636f 6e66 6967 2e44 4154 4153 4554  f config.DATASET
-00037a70: 4449 4354 5f49 4e46 4f53 5f46 494c 454e  DICT_INFOS_FILEN
-00037a80: 414d 4520 696e 2072 6570 6f5f 6669 6c65  AME in repo_file
-00037a90: 733a 0a20 2020 2020 2020 2020 2020 2064  s:.            d
-00037aa0: 6174 6173 6574 5f6d 6574 6164 6174 6120  ataset_metadata 
-00037ab0: 3d20 4461 7461 7365 744d 6574 6164 6174  = DatasetMetadat
-00037ac0: 6128 290a 2020 2020 2020 2020 2020 2020  a().            
-00037ad0: 646f 776e 6c6f 6164 5f63 6f6e 6669 6720  download_config 
-00037ae0: 3d20 446f 776e 6c6f 6164 436f 6e66 6967  = DownloadConfig
-00037af0: 2829 0a20 2020 2020 2020 2020 2020 2064  ().            d
-00037b00: 6f77 6e6c 6f61 645f 636f 6e66 6967 2e64  ownload_config.d
-00037b10: 6f77 6e6c 6f61 645f 6465 7363 203d 2022  ownload_desc = "
-00037b20: 446f 776e 6c6f 6164 696e 6720 6d65 7461  Downloading meta
-00037b30: 6461 7461 220a 2020 2020 2020 2020 2020  data".          
-00037b40: 2020 646f 776e 6c6f 6164 5f63 6f6e 6669    download_confi
-00037b50: 672e 7573 655f 6175 7468 5f74 6f6b 656e  g.use_auth_token
-00037b60: 203d 2074 6f6b 656e 0a20 2020 2020 2020   = token.       
-00037b70: 2020 2020 2064 6174 6173 6574 5f69 6e66       dataset_inf
-00037b80: 6f73 5f70 6174 6820 3d20 6361 6368 6564  os_path = cached
-00037b90: 5f70 6174 6828 0a20 2020 2020 2020 2020  _path(.         
-00037ba0: 2020 2020 2020 2068 665f 6875 625f 7572         hf_hub_ur
-00037bb0: 6c28 7265 706f 5f69 642c 2063 6f6e 6669  l(repo_id, confi
-00037bc0: 672e 4441 5441 5345 5444 4943 545f 494e  g.DATASETDICT_IN
-00037bd0: 464f 535f 4649 4c45 4e41 4d45 292c 0a20  FOS_FILENAME),. 
-00037be0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00037bf0: 6f77 6e6c 6f61 645f 636f 6e66 6967 3d64  ownload_config=d
-00037c00: 6f77 6e6c 6f61 645f 636f 6e66 6967 2c0a  ownload_config,.
-00037c10: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00037c20: 2020 2020 2020 2020 2020 7769 7468 206f            with o
-00037c30: 7065 6e28 6461 7461 7365 745f 696e 666f  pen(dataset_info
-00037c40: 735f 7061 7468 2c20 656e 636f 6469 6e67  s_path, encoding
-00037c50: 3d22 7574 662d 3822 2920 6173 2066 3a0a  ="utf-8") as f:.
-00037c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037c70: 6461 7461 7365 745f 696e 666f 733a 2044  dataset_infos: D
-00037c80: 6174 6173 6574 496e 666f 7344 6963 7420  atasetInfosDict 
-00037c90: 3d20 6a73 6f6e 2e6c 6f61 6428 6629 0a20  = json.load(f). 
-00037ca0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00037cb0: 6570 6f5f 696e 666f 203d 2044 6174 6173  epo_info = Datas
-00037cc0: 6574 496e 666f 2e66 726f 6d5f 6469 6374  etInfo.from_dict
-00037cd0: 2864 6174 6173 6574 5f69 6e66 6f73 5b6e  (dataset_infos[n
-00037ce0: 6578 7428 6974 6572 2864 6174 6173 6574  ext(iter(dataset
-00037cf0: 5f69 6e66 6f73 2929 5d29 0a20 2020 2020  _infos))]).     
-00037d00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00037d10: 2020 2020 2064 6174 6173 6574 5f6d 6574       dataset_met
-00037d20: 6164 6174 6120 3d20 4461 7461 7365 744d  adata = DatasetM
-00037d30: 6574 6164 6174 6128 290a 2020 2020 2020  etadata().      
-00037d40: 2020 2020 2020 7265 706f 5f69 6e66 6f20        repo_info 
-00037d50: 3d20 4e6f 6e65 0a20 2020 2020 2020 2023  = None.        #
-00037d60: 2075 7064 6174 6520 7468 6520 746f 7461   update the tota
-00037d70: 6c20 696e 666f 2074 6f20 6475 6d70 2066  l info to dump f
-00037d80: 726f 6d20 6578 6973 7469 6e67 2069 6e66  rom existing inf
-00037d90: 6f0a 2020 2020 2020 2020 6966 2072 6570  o.        if rep
-00037da0: 6f5f 696e 666f 2069 7320 6e6f 7420 4e6f  o_info is not No
-00037db0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00037dc0: 6c6f 6767 6572 2e77 6172 6e69 6e67 2822  logger.warning("
-00037dd0: 5570 6461 7469 6e67 2064 6f77 6e6c 6f61  Updating downloa
-00037de0: 6465 6420 6d65 7461 6461 7461 2077 6974  ded metadata wit
-00037df0: 6820 7468 6520 6e65 7720 7370 6c69 742e  h the new split.
-00037e00: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-00037e10: 6620 7265 706f 5f69 6e66 6f2e 7370 6c69  f repo_info.spli
-00037e20: 7473 2061 6e64 206c 6973 7428 7265 706f  ts and list(repo
-00037e30: 5f69 6e66 6f2e 7370 6c69 7473 2920 213d  _info.splits) !=
-00037e40: 205b 7370 6c69 745d 3a0a 2020 2020 2020   [split]:.      
-00037e50: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00037e60: 662e 6665 6174 7572 6573 2021 3d20 7265  f.features != re
-00037e70: 706f 5f69 6e66 6f2e 6665 6174 7572 6573  po_info.features
-00037e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00037e90: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00037ea0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00037eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037ec0: 6622 4665 6174 7572 6573 206f 6620 7468  f"Features of th
-00037ed0: 6520 6e65 7720 7370 6c69 7420 646f 6e27  e new split don'
-00037ee0: 7420 6d61 7463 6820 7468 6520 6665 6174  t match the feat
-00037ef0: 7572 6573 206f 6620 7468 6520 6578 6973  ures of the exis
-00037f00: 7469 6e67 2073 706c 6974 7320 6f6e 2074  ting splits on t
-00037f10: 6865 2068 7562 3a20 7b73 656c 662e 6665  he hub: {self.fe
-00037f20: 6174 7572 6573 7d20 213d 207b 7265 706f  atures} != {repo
-00037f30: 5f69 6e66 6f2e 6665 6174 7572 6573 7d22  _info.features}"
-00037f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00037f50: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00037f60: 2020 2020 2020 2020 6966 2073 706c 6974          if split
-00037f70: 2069 6e20 7265 706f 5f69 6e66 6f2e 7370   in repo_info.sp
-00037f80: 6c69 7473 3a0a 2020 2020 2020 2020 2020  lits:.          
-00037f90: 2020 2020 2020 2020 2020 7265 706f 5f69            repo_i
-00037fa0: 6e66 6f2e 646f 776e 6c6f 6164 5f73 697a  nfo.download_siz
-00037fb0: 6520 2d3d 2064 656c 6574 6564 5f73 697a  e -= deleted_siz
-00037fc0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00037fd0: 2020 2020 2020 7265 706f 5f69 6e66 6f2e        repo_info.
-00037fe0: 6461 7461 7365 745f 7369 7a65 202d 3d20  dataset_size -= 
-00037ff0: 7265 706f 5f69 6e66 6f2e 7370 6c69 7473  repo_info.splits
-00038000: 2e67 6574 2873 706c 6974 2c20 5370 6c69  .get(split, Spli
-00038010: 7449 6e66 6f28 2929 2e6e 756d 5f62 7974  tInfo()).num_byt
-00038020: 6573 206f 7220 300a 0a20 2020 2020 2020  es or 0..       
-00038030: 2020 2020 2020 2020 2072 6570 6f5f 696e           repo_in
-00038040: 666f 2e64 6f77 6e6c 6f61 645f 6368 6563  fo.download_chec
-00038050: 6b73 756d 7320 3d20 4e6f 6e65 0a20 2020  ksums = None.   
-00038060: 2020 2020 2020 2020 2020 2020 2072 6570               rep
-00038070: 6f5f 696e 666f 2e64 6f77 6e6c 6f61 645f  o_info.download_
-00038080: 7369 7a65 203d 2028 7265 706f 5f69 6e66  size = (repo_inf
-00038090: 6f2e 646f 776e 6c6f 6164 5f73 697a 6520  o.download_size 
-000380a0: 6f72 2030 2920 2b20 7570 6c6f 6164 6564  or 0) + uploaded
-000380b0: 5f73 697a 650a 2020 2020 2020 2020 2020  _size.          
-000380c0: 2020 2020 2020 7265 706f 5f69 6e66 6f2e        repo_info.
-000380d0: 6461 7461 7365 745f 7369 7a65 203d 2028  dataset_size = (
-000380e0: 7265 706f 5f69 6e66 6f2e 6461 7461 7365  repo_info.datase
-000380f0: 745f 7369 7a65 206f 7220 3029 202b 2064  t_size or 0) + d
-00038100: 6174 6173 6574 5f6e 6279 7465 730a 2020  ataset_nbytes.  
-00038110: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00038120: 706f 5f69 6e66 6f2e 7369 7a65 5f69 6e5f  po_info.size_in_
-00038130: 6279 7465 7320 3d20 7265 706f 5f69 6e66  bytes = repo_inf
-00038140: 6f2e 646f 776e 6c6f 6164 5f73 697a 6520  o.download_size 
-00038150: 2b20 7265 706f 5f69 6e66 6f2e 6461 7461  + repo_info.data
-00038160: 7365 745f 7369 7a65 0a20 2020 2020 2020  set_size.       
-00038170: 2020 2020 2020 2020 2072 6570 6f5f 696e           repo_in
-00038180: 666f 2e73 706c 6974 735b 7370 6c69 745d  fo.splits[split]
-00038190: 203d 2053 706c 6974 496e 666f 280a 2020   = SplitInfo(.  
-000381a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000381b0: 2020 7370 6c69 742c 206e 756d 5f62 7974    split, num_byt
-000381c0: 6573 3d64 6174 6173 6574 5f6e 6279 7465  es=dataset_nbyte
-000381d0: 732c 206e 756d 5f65 7861 6d70 6c65 733d  s, num_examples=
-000381e0: 6c65 6e28 7365 6c66 292c 2064 6174 6173  len(self), datas
-000381f0: 6574 5f6e 616d 653d 6461 7461 7365 745f  et_name=dataset_
-00038200: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
-00038210: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00038220: 2020 2020 2020 2069 6e66 6f5f 746f 5f64         info_to_d
-00038230: 756d 7020 3d20 7265 706f 5f69 6e66 6f0a  ump = repo_info.
-00038240: 2020 2020 2020 2020 2320 7075 7368 2074          # push t
-00038250: 6f20 7468 6520 6465 7072 6563 6174 6564  o the deprecated
-00038260: 2064 6174 6173 6574 5f69 6e66 6f73 2e6a   dataset_infos.j
-00038270: 736f 6e0a 2020 2020 2020 2020 6966 2063  son.        if c
-00038280: 6f6e 6669 672e 4441 5441 5345 5444 4943  onfig.DATASETDIC
-00038290: 545f 494e 464f 535f 4649 4c45 4e41 4d45  T_INFOS_FILENAME
-000382a0: 2069 6e20 7265 706f 5f66 696c 6573 3a0a   in repo_files:.
-000382b0: 2020 2020 2020 2020 2020 2020 6275 6666              buff
-000382c0: 6572 203d 2042 7974 6573 494f 2829 0a20  er = BytesIO(). 
-000382d0: 2020 2020 2020 2020 2020 2062 7566 6665             buffe
-000382e0: 722e 7772 6974 6528 6227 7b22 6465 6661  r.write(b'{"defa
-000382f0: 756c 7422 3a20 2729 0a20 2020 2020 2020  ult": ').       
-00038300: 2020 2020 2069 6e66 6f5f 746f 5f64 756d       info_to_dum
-00038310: 702e 5f64 756d 705f 696e 666f 2862 7566  p._dump_info(buf
-00038320: 6665 722c 2070 7265 7474 795f 7072 696e  fer, pretty_prin
-00038330: 743d 5472 7565 290a 2020 2020 2020 2020  t=True).        
-00038340: 2020 2020 6275 6666 6572 2e77 7269 7465      buffer.write
-00038350: 2862 227d 2229 0a20 2020 2020 2020 2020  (b"}").         
-00038360: 2020 2048 6641 7069 2865 6e64 706f 696e     HfApi(endpoin
-00038370: 743d 636f 6e66 6967 2e48 465f 454e 4450  t=config.HF_ENDP
-00038380: 4f49 4e54 292e 7570 6c6f 6164 5f66 696c  OINT).upload_fil
-00038390: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-000383a0: 2020 2070 6174 685f 6f72 5f66 696c 656f     path_or_fileo
-000383b0: 626a 3d62 7566 6665 722e 6765 7476 616c  bj=buffer.getval
-000383c0: 7565 2829 2c0a 2020 2020 2020 2020 2020  ue(),.          
-000383d0: 2020 2020 2020 7061 7468 5f69 6e5f 7265        path_in_re
-000383e0: 706f 3d63 6f6e 6669 672e 4441 5441 5345  po=config.DATASE
-000383f0: 5444 4943 545f 494e 464f 535f 4649 4c45  TDICT_INFOS_FILE
-00038400: 4e41 4d45 2c0a 2020 2020 2020 2020 2020  NAME,.          
-00038410: 2020 2020 2020 7265 706f 5f69 643d 7265        repo_id=re
-00038420: 706f 5f69 642c 0a20 2020 2020 2020 2020  po_id,.         
-00038430: 2020 2020 2020 2074 6f6b 656e 3d74 6f6b         token=tok
-00038440: 656e 2c0a 2020 2020 2020 2020 2020 2020  en,.            
-00038450: 2020 2020 7265 706f 5f74 7970 653d 2264      repo_type="d
-00038460: 6174 6173 6574 222c 0a20 2020 2020 2020  ataset",.       
-00038470: 2020 2020 2020 2020 2072 6576 6973 696f           revisio
-00038480: 6e3d 6272 616e 6368 2c0a 2020 2020 2020  n=branch,.      
-00038490: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000384a0: 2320 7075 7368 2074 6f20 5245 4144 4d45  # push to README
-000384b0: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
-000384c0: 496e 666f 7344 6963 7428 7b22 6465 6661  InfosDict({"defa
-000384d0: 756c 7422 3a20 696e 666f 5f74 6f5f 6475  ult": info_to_du
-000384e0: 6d70 7d29 2e74 6f5f 6d65 7461 6461 7461  mp}).to_metadata
-000384f0: 2864 6174 6173 6574 5f6d 6574 6164 6174  (dataset_metadat
-00038500: 6129 0a20 2020 2020 2020 2069 6620 2252  a).        if "R
-00038510: 4541 444d 452e 6d64 2220 696e 2072 6570  EADME.md" in rep
-00038520: 6f5f 6669 6c65 733a 0a20 2020 2020 2020  o_files:.       
-00038530: 2020 2020 2077 6974 6820 6f70 656e 2864       with open(d
-00038540: 6174 6173 6574 5f72 6561 646d 655f 7061  ataset_readme_pa
-00038550: 7468 2c20 656e 636f 6469 6e67 3d22 7574  th, encoding="ut
-00038560: 662d 3822 2920 6173 2072 6561 646d 655f  f-8") as readme_
-00038570: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
-00038580: 2020 2020 2020 7265 6164 6d65 5f63 6f6e        readme_con
-00038590: 7465 6e74 203d 2072 6561 646d 655f 6669  tent = readme_fi
-000385a0: 6c65 2e72 6561 6428 290a 2020 2020 2020  le.read().      
-000385b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000385c0: 2020 2020 7265 6164 6d65 5f63 6f6e 7465      readme_conte
-000385d0: 6e74 203d 2066 2723 2044 6174 6173 6574  nt = f'# Dataset
-000385e0: 2043 6172 6420 666f 7220 227b 7265 706f   Card for "{repo
-000385f0: 5f69 642e 7370 6c69 7428 222f 2229 5b2d  _id.split("/")[-
-00038600: 315d 7d22 5c6e 5c6e 5b4d 6f72 6520 496e  1]}"\n\n[More In
-00038610: 666f 726d 6174 696f 6e20 6e65 6564 6564  formation needed
-00038620: 5d28 6874 7470 733a 2f2f 6769 7468 7562  ](https://github
-00038630: 2e63 6f6d 2f68 7567 6769 6e67 6661 6365  .com/huggingface
-00038640: 2f64 6174 6173 6574 732f 626c 6f62 2f6d  /datasets/blob/m
-00038650: 6169 6e2f 434f 4e54 5249 4255 5449 4e47  ain/CONTRIBUTING
-00038660: 2e6d 6423 686f 772d 746f 2d63 6f6e 7472  .md#how-to-contr
-00038670: 6962 7574 652d 746f 2d74 6865 2d64 6174  ibute-to-the-dat
-00038680: 6173 6574 2d63 6172 6473 2927 0a20 2020  aset-cards)'.   
-00038690: 2020 2020 2048 6641 7069 2865 6e64 706f       HfApi(endpo
-000386a0: 696e 743d 636f 6e66 6967 2e48 465f 454e  int=config.HF_EN
-000386b0: 4450 4f49 4e54 292e 7570 6c6f 6164 5f66  DPOINT).upload_f
-000386c0: 696c 6528 0a20 2020 2020 2020 2020 2020  ile(.           
-000386d0: 2070 6174 685f 6f72 5f66 696c 656f 626a   path_or_fileobj
-000386e0: 3d64 6174 6173 6574 5f6d 6574 6164 6174  =dataset_metadat
-000386f0: 612e 5f74 6f5f 7265 6164 6d65 2872 6561  a._to_readme(rea
-00038700: 646d 655f 636f 6e74 656e 7429 2e65 6e63  dme_content).enc
-00038710: 6f64 6528 292c 0a20 2020 2020 2020 2020  ode(),.         
-00038720: 2020 2070 6174 685f 696e 5f72 6570 6f3d     path_in_repo=
-00038730: 2252 4541 444d 452e 6d64 222c 0a20 2020  "README.md",.   
-00038740: 2020 2020 2020 2020 2072 6570 6f5f 6964           repo_id
-00038750: 3d72 6570 6f5f 6964 2c0a 2020 2020 2020  =repo_id,.      
-00038760: 2020 2020 2020 746f 6b65 6e3d 746f 6b65        token=toke
-00038770: 6e2c 0a20 2020 2020 2020 2020 2020 2072  n,.            r
-00038780: 6570 6f5f 7479 7065 3d22 6461 7461 7365  epo_type="datase
-00038790: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-000387a0: 7265 7669 7369 6f6e 3d62 7261 6e63 682c  revision=branch,
-000387b0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000387c0: 4074 7261 6e73 6d69 745f 666f 726d 6174  @transmit_format
-000387d0: 0a20 2020 2040 6669 6e67 6572 7072 696e  .    @fingerprin
-000387e0: 745f 7472 616e 7366 6f72 6d28 696e 706c  t_transform(inpl
-000387f0: 6163 653d 4661 6c73 6529 0a20 2020 2064  ace=False).    d
-00038800: 6566 2061 6464 5f63 6f6c 756d 6e28 7365  ef add_column(se
-00038810: 6c66 2c20 6e61 6d65 3a20 7374 722c 2063  lf, name: str, c
-00038820: 6f6c 756d 6e3a 2055 6e69 6f6e 5b6c 6973  olumn: Union[lis
-00038830: 742c 206e 702e 6172 7261 795d 2c20 6e65  t, np.array], ne
-00038840: 775f 6669 6e67 6572 7072 696e 743a 2073  w_fingerprint: s
-00038850: 7472 293a 0a20 2020 2020 2020 2022 2222  tr):.        """
-00038860: 4164 6420 636f 6c75 6d6e 2074 6f20 4461  Add column to Da
-00038870: 7461 7365 742e 0a0a 2020 2020 2020 2020  taset...        
-00038880: 3c41 6464 6564 2076 6572 7369 6f6e 3d22  <Added version="
-00038890: 312e 3722 2f3e 0a0a 2020 2020 2020 2020  1.7"/>..        
-000388a0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-000388b0: 2020 6e61 6d65 2028 6073 7472 6029 3a0a    name (`str`):.
-000388c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000388d0: 436f 6c75 6d6e 206e 616d 652e 0a20 2020  Column name..   
-000388e0: 2020 2020 2020 2020 2063 6f6c 756d 6e20           column 
-000388f0: 2860 6c69 7374 6020 6f72 2060 6e70 2e61  (`list` or `np.a
-00038900: 7272 6179 6029 3a0a 2020 2020 2020 2020  rray`):.        
-00038910: 2020 2020 2020 2020 436f 6c75 6d6e 2064          Column d
-00038920: 6174 6120 746f 2062 6520 6164 6465 642e  ata to be added.
-00038930: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00038940: 733a 0a20 2020 2020 2020 2020 2020 205b  s:.            [
-00038950: 6044 6174 6173 6574 605d 0a0a 2020 2020  `Dataset`]..    
-00038960: 2020 2020 4578 616d 706c 653a 0a0a 2020      Example:..  
-00038970: 2020 2020 2020 6060 6070 790a 2020 2020        ```py.    
-00038980: 2020 2020 3e3e 3e20 6672 6f6d 2064 6174      >>> from dat
-00038990: 6173 6574 7320 696d 706f 7274 206c 6f61  asets import loa
-000389a0: 645f 6461 7461 7365 740a 2020 2020 2020  d_dataset.      
-000389b0: 2020 3e3e 3e20 6473 203d 206c 6f61 645f    >>> ds = load_
-000389c0: 6461 7461 7365 7428 2272 6f74 7465 6e5f  dataset("rotten_
-000389d0: 746f 6d61 746f 6573 222c 2073 706c 6974  tomatoes", split
-000389e0: 3d22 7661 6c69 6461 7469 6f6e 2229 0a20  ="validation"). 
-000389f0: 2020 2020 2020 203e 3e3e 206d 6f72 655f         >>> more_
-00038a00: 7465 7874 203d 2064 735b 2274 6578 7422  text = ds["text"
-00038a10: 5d0a 2020 2020 2020 2020 3e3e 3e20 6473  ].        >>> ds
-00038a20: 2e61 6464 5f63 6f6c 756d 6e28 6e61 6d65  .add_column(name
-00038a30: 3d22 7465 7874 5f32 222c 2063 6f6c 756d  ="text_2", colum
-00038a40: 6e3d 6d6f 7265 5f74 6578 7429 0a20 2020  n=more_text).   
-00038a50: 2020 2020 2044 6174 6173 6574 287b 0a20       Dataset({. 
-00038a60: 2020 2020 2020 2020 2020 2066 6561 7475             featu
-00038a70: 7265 733a 205b 2774 6578 7427 2c20 276c  res: ['text', 'l
-00038a80: 6162 656c 272c 2027 7465 7874 5f32 275d  abel', 'text_2']
-00038a90: 2c0a 2020 2020 2020 2020 2020 2020 6e75  ,.            nu
-00038aa0: 6d5f 726f 7773 3a20 3130 3636 0a20 2020  m_rows: 1066.   
-00038ab0: 2020 2020 207d 290a 2020 2020 2020 2020       }).        
-00038ac0: 6060 600a 2020 2020 2020 2020 2222 220a  ```.        """.
-00038ad0: 2020 2020 2020 2020 636f 6c75 6d6e 5f74          column_t
-00038ae0: 6162 6c65 203d 2049 6e4d 656d 6f72 7954  able = InMemoryT
-00038af0: 6162 6c65 2e66 726f 6d5f 7079 6469 6374  able.from_pydict
-00038b00: 287b 6e61 6d65 3a20 636f 6c75 6d6e 7d29  ({name: column})
-00038b10: 0a20 2020 2020 2020 205f 6368 6563 6b5f  .        _check_
-00038b20: 636f 6c75 6d6e 5f6e 616d 6573 2873 656c  column_names(sel
-00038b30: 662e 5f64 6174 612e 636f 6c75 6d6e 5f6e  f._data.column_n
-00038b40: 616d 6573 202b 2063 6f6c 756d 6e5f 7461  ames + column_ta
-00038b50: 626c 652e 636f 6c75 6d6e 5f6e 616d 6573  ble.column_names
-00038b60: 290a 2020 2020 2020 2020 6461 7461 7365  ).        datase
-00038b70: 7420 3d20 7365 6c66 2e66 6c61 7474 656e  t = self.flatten
-00038b80: 5f69 6e64 6963 6573 2829 2069 6620 7365  _indices() if se
-00038b90: 6c66 2e5f 696e 6469 6365 7320 6973 206e  lf._indices is n
-00038ba0: 6f74 204e 6f6e 6520 656c 7365 2073 656c  ot None else sel
-00038bb0: 660a 2020 2020 2020 2020 2320 436f 6e63  f.        # Conc
-00038bc0: 6174 656e 6174 6520 7461 626c 6573 2068  atenate tables h
-00038bd0: 6f72 697a 6f6e 7461 6c6c 790a 2020 2020  orizontally.    
-00038be0: 2020 2020 7461 626c 6520 3d20 636f 6e63      table = conc
-00038bf0: 6174 5f74 6162 6c65 7328 5b64 6174 6173  at_tables([datas
-00038c00: 6574 2e5f 6461 7461 2c20 636f 6c75 6d6e  et._data, column
-00038c10: 5f74 6162 6c65 5d2c 2061 7869 733d 3129  _table], axis=1)
-00038c20: 0a20 2020 2020 2020 2023 2055 7064 6174  .        # Updat
-00038c30: 6520 6665 6174 7572 6573 0a20 2020 2020  e features.     
-00038c40: 2020 2069 6e66 6f20 3d20 6461 7461 7365     info = datase
-00038c50: 742e 696e 666f 2e63 6f70 7928 290a 2020  t.info.copy().  
-00038c60: 2020 2020 2020 696e 666f 2e66 6561 7475        info.featu
-00038c70: 7265 732e 7570 6461 7465 2846 6561 7475  res.update(Featu
-00038c80: 7265 732e 6672 6f6d 5f61 7272 6f77 5f73  res.from_arrow_s
-00038c90: 6368 656d 6128 636f 6c75 6d6e 5f74 6162  chema(column_tab
-00038ca0: 6c65 2e73 6368 656d 6129 290a 2020 2020  le.schema)).    
-00038cb0: 2020 2020 7461 626c 6520 3d20 7570 6461      table = upda
-00038cc0: 7465 5f6d 6574 6164 6174 615f 7769 7468  te_metadata_with
-00038cd0: 5f66 6561 7475 7265 7328 7461 626c 652c  _features(table,
-00038ce0: 2069 6e66 6f2e 6665 6174 7572 6573 290a   info.features).
-00038cf0: 2020 2020 2020 2020 7265 7475 726e 2044          return D
-00038d00: 6174 6173 6574 2874 6162 6c65 2c20 696e  ataset(table, in
-00038d10: 666f 3d69 6e66 6f2c 2073 706c 6974 3d73  fo=info, split=s
-00038d20: 656c 662e 7370 6c69 742c 2069 6e64 6963  elf.split, indic
-00038d30: 6573 5f74 6162 6c65 3d4e 6f6e 652c 2066  es_table=None, f
-00038d40: 696e 6765 7270 7269 6e74 3d6e 6577 5f66  ingerprint=new_f
-00038d50: 696e 6765 7270 7269 6e74 290a 0a20 2020  ingerprint)..   
-00038d60: 2064 6566 2061 6464 5f66 6169 7373 5f69   def add_faiss_i
-00038d70: 6e64 6578 280a 2020 2020 2020 2020 7365  ndex(.        se
-00038d80: 6c66 2c0a 2020 2020 2020 2020 636f 6c75  lf,.        colu
-00038d90: 6d6e 3a20 7374 722c 0a20 2020 2020 2020  mn: str,.       
-00038da0: 2069 6e64 6578 5f6e 616d 653a 204f 7074   index_name: Opt
-00038db0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-00038dc0: 652c 0a20 2020 2020 2020 2064 6576 6963  e,.        devic
-00038dd0: 653a 204f 7074 696f 6e61 6c5b 696e 745d  e: Optional[int]
-00038de0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00038df0: 2073 7472 696e 675f 6661 6374 6f72 793a   string_factory:
-00038e00: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-00038e10: 204e 6f6e 652c 0a20 2020 2020 2020 206d   None,.        m
-00038e20: 6574 7269 635f 7479 7065 3a20 4f70 7469  etric_type: Opti
-00038e30: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
-00038e40: 2c0a 2020 2020 2020 2020 6375 7374 6f6d  ,.        custom
-00038e50: 5f69 6e64 6578 3a20 4f70 7469 6f6e 616c  _index: Optional
-00038e60: 5b22 6661 6973 732e 496e 6465 7822 5d20  ["faiss.Index"] 
-00038e70: 3d20 4e6f 6e65 2c20 2023 206e 6f71 613a  = None,  # noqa:
-00038e80: 2046 3832 310a 2020 2020 2020 2020 6261   F821.        ba
-00038e90: 7463 685f 7369 7a65 3a20 696e 7420 3d20  tch_size: int = 
-00038ea0: 3130 3030 2c0a 2020 2020 2020 2020 7472  1000,.        tr
-00038eb0: 6169 6e5f 7369 7a65 3a20 4f70 7469 6f6e  ain_size: Option
-00038ec0: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a  al[int] = None,.
-00038ed0: 2020 2020 2020 2020 6661 6973 735f 7665          faiss_ve
-00038ee0: 7262 6f73 653a 2062 6f6f 6c20 3d20 4661  rbose: bool = Fa
-00038ef0: 6c73 652c 0a20 2020 2020 2020 2064 7479  lse,.        dty
-00038f00: 7065 3d6e 702e 666c 6f61 7433 322c 0a20  pe=np.float32,. 
-00038f10: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-00038f20: 2241 6464 2061 2064 656e 7365 2069 6e64  "Add a dense ind
-00038f30: 6578 2075 7369 6e67 2046 6169 7373 2066  ex using Faiss f
-00038f40: 6f72 2066 6173 7420 7265 7472 6965 7661  or fast retrieva
-00038f50: 6c2e 0a20 2020 2020 2020 2042 7920 6465  l..        By de
-00038f60: 6661 756c 7420 7468 6520 696e 6465 7820  fault the index 
-00038f70: 6973 2064 6f6e 6520 6f76 6572 2074 6865  is done over the
-00038f80: 2076 6563 746f 7273 206f 6620 7468 6520   vectors of the 
-00038f90: 7370 6563 6966 6965 6420 636f 6c75 6d6e  specified column
-00038fa0: 2e0a 2020 2020 2020 2020 596f 7520 6361  ..        You ca
-00038fb0: 6e20 7370 6563 6966 7920 6064 6576 6963  n specify `devic
-00038fc0: 6560 2069 6620 796f 7520 7761 6e74 2074  e` if you want t
-00038fd0: 6f20 7275 6e20 6974 206f 6e20 4750 5520  o run it on GPU 
-00038fe0: 2860 6465 7669 6365 6020 6d75 7374 2062  (`device` must b
-00038ff0: 6520 7468 6520 4750 5520 696e 6465 7829  e the GPU index)
-00039000: 2e0a 2020 2020 2020 2020 596f 7520 6361  ..        You ca
-00039010: 6e20 6669 6e64 206d 6f72 6520 696e 666f  n find more info
-00039020: 726d 6174 696f 6e20 6162 6f75 7420 4661  rmation about Fa
-00039030: 6973 7320 6865 7265 3a0a 0a20 2020 2020  iss here:..     
-00039040: 2020 202d 2046 6f72 205b 7374 7269 6e67     - For [string
-00039050: 2066 6163 746f 7279 5d28 6874 7470 733a   factory](https:
-00039060: 2f2f 6769 7468 7562 2e63 6f6d 2f66 6163  //github.com/fac
-00039070: 6562 6f6f 6b72 6573 6561 7263 682f 6661  ebookresearch/fa
-00039080: 6973 732f 7769 6b69 2f54 6865 2d69 6e64  iss/wiki/The-ind
-00039090: 6578 2d66 6163 746f 7279 290a 0a20 2020  ex-factory)..   
-000390a0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-000390b0: 2020 2020 2020 2063 6f6c 756d 6e20 2860         column (`
-000390c0: 7374 7260 293a 0a20 2020 2020 2020 2020  str`):.         
-000390d0: 2020 2020 2020 2054 6865 2063 6f6c 756d         The colum
-000390e0: 6e20 6f66 2074 6865 2076 6563 746f 7273  n of the vectors
-000390f0: 2074 6f20 6164 6420 746f 2074 6865 2069   to add to the i
-00039100: 6e64 6578 2e0a 2020 2020 2020 2020 2020  ndex..          
-00039110: 2020 696e 6465 785f 6e61 6d65 2028 6073    index_name (`s
-00039120: 7472 602c 202a 6f70 7469 6f6e 616c 2a29  tr`, *optional*)
-00039130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00039140: 2020 5468 6520 6069 6e64 6578 5f6e 616d    The `index_nam
-00039150: 6560 2f69 6465 6e74 6966 6965 7220 6f66  e`/identifier of
-00039160: 2074 6865 2069 6e64 6578 2e0a 2020 2020   the index..    
-00039170: 2020 2020 2020 2020 2020 2020 5468 6973              This
-00039180: 2069 7320 7468 6520 6069 6e64 6578 5f6e   is the `index_n
-00039190: 616d 6560 2074 6861 7420 6973 2075 7365  ame` that is use
-000391a0: 6420 746f 2063 616c 6c20 5b60 7e64 6174  d to call [`~dat
-000391b0: 6173 6574 732e 4461 7461 7365 742e 6765  asets.Dataset.ge
-000391c0: 745f 6e65 6172 6573 745f 6578 616d 706c  t_nearest_exampl
-000391d0: 6573 605d 206f 7220 5b60 7e64 6174 6173  es`] or [`~datas
-000391e0: 6574 732e 4461 7461 7365 742e 7365 6172  ets.Dataset.sear
-000391f0: 6368 605d 2e0a 2020 2020 2020 2020 2020  ch`]..          
-00039200: 2020 2020 2020 4279 2064 6566 6175 6c74        By default
-00039210: 2069 7420 636f 7272 6573 706f 6e64 7320   it corresponds 
-00039220: 746f 2060 636f 6c75 6d6e 602e 0a20 2020  to `column`..   
-00039230: 2020 2020 2020 2020 2064 6576 6963 6520           device 
-00039240: 2860 556e 696f 6e5b 696e 742c 204c 6973  (`Union[int, Lis
-00039250: 745b 696e 745d 5d60 2c20 2a6f 7074 696f  t[int]]`, *optio
-00039260: 6e61 6c2a 293a 0a20 2020 2020 2020 2020  nal*):.         
-00039270: 2020 2020 2020 2049 6620 706f 7369 7469         If positi
-00039280: 7665 2069 6e74 6567 6572 2c20 7468 6973  ve integer, this
-00039290: 2069 7320 7468 6520 696e 6465 7820 6f66   is the index of
-000392a0: 2074 6865 2047 5055 2074 6f20 7573 652e   the GPU to use.
-000392b0: 2049 6620 6e65 6761 7469 7665 2069 6e74   If negative int
-000392c0: 6567 6572 2c20 7573 6520 616c 6c20 4750  eger, use all GP
-000392d0: 5573 2e0a 2020 2020 2020 2020 2020 2020  Us..            
-000392e0: 2020 2020 4966 2061 206c 6973 7420 6f66      If a list of
-000392f0: 2070 6f73 6974 6976 6520 696e 7465 6765   positive intege
-00039300: 7273 2069 7320 7061 7373 6564 2069 6e2c  rs is passed in,
-00039310: 2072 756e 206f 6e6c 7920 6f6e 2074 686f   run only on tho
-00039320: 7365 2047 5055 732e 2042 7920 6465 6661  se GPUs. By defa
-00039330: 756c 7420 6974 2075 7365 7320 7468 6520  ult it uses the 
-00039340: 4350 552e 0a20 2020 2020 2020 2020 2020  CPU..           
-00039350: 2073 7472 696e 675f 6661 6374 6f72 7920   string_factory 
-00039360: 2860 7374 7260 2c20 2a6f 7074 696f 6e61  (`str`, *optiona
-00039370: 6c2a 293a 0a20 2020 2020 2020 2020 2020  l*):.           
-00039380: 2020 2020 2054 6869 7320 6973 2070 6173       This is pas
-00039390: 7365 6420 746f 2074 6865 2069 6e64 6578  sed to the index
-000393a0: 2066 6163 746f 7279 206f 6620 4661 6973   factory of Fais
-000393b0: 7320 746f 2063 7265 6174 6520 7468 6520  s to create the 
-000393c0: 696e 6465 782e 0a20 2020 2020 2020 2020  index..         
-000393d0: 2020 2020 2020 2044 6566 6175 6c74 2069         Default i
-000393e0: 6e64 6578 2063 6c61 7373 2069 7320 6049  ndex class is `I
-000393f0: 6e64 6578 466c 6174 602e 0a20 2020 2020  ndexFlat`..     
-00039400: 2020 2020 2020 206d 6574 7269 635f 7479         metric_ty
-00039410: 7065 2028 6069 6e74 602c 202a 6f70 7469  pe (`int`, *opti
-00039420: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
-00039430: 2020 2020 2020 2020 5479 7065 206f 6620          Type of 
-00039440: 6d65 7472 6963 2e20 4578 3a20 6066 6169  metric. Ex: `fai
-00039450: 7373 2e4d 4554 5249 435f 494e 4e45 525f  ss.METRIC_INNER_
-00039460: 5052 4f44 5543 5460 206f 7220 6066 6169  PRODUCT` or `fai
-00039470: 7373 2e4d 4554 5249 435f 4c32 602e 0a20  ss.METRIC_L2`.. 
-00039480: 2020 2020 2020 2020 2020 2063 7573 746f             custo
-00039490: 6d5f 696e 6465 7820 2860 6661 6973 732e  m_index (`faiss.
-000394a0: 496e 6465 7860 2c20 2a6f 7074 696f 6e61  Index`, *optiona
-000394b0: 6c2a 293a 0a20 2020 2020 2020 2020 2020  l*):.           
-000394c0: 2020 2020 2043 7573 746f 6d20 4661 6973       Custom Fais
-000394d0: 7320 696e 6465 7820 7468 6174 2079 6f75  s index that you
-000394e0: 2061 6c72 6561 6479 2068 6176 6520 696e   already have in
-000394f0: 7374 616e 7469 6174 6564 2061 6e64 2063  stantiated and c
-00039500: 6f6e 6669 6775 7265 6420 666f 7220 796f  onfigured for yo
-00039510: 7572 206e 6565 6473 2e0a 2020 2020 2020  ur needs..      
-00039520: 2020 2020 2020 6261 7463 685f 7369 7a65        batch_size
-00039530: 2028 6069 6e74 6029 3a0a 2020 2020 2020   (`int`):.      
-00039540: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
-00039550: 6620 7468 6520 6261 7463 6820 746f 2075  f the batch to u
-00039560: 7365 2077 6869 6c65 2061 6464 696e 6720  se while adding 
-00039570: 7665 6374 6f72 7320 746f 2074 6865 2060  vectors to the `
-00039580: 4661 6973 7349 6e64 6578 602e 2044 6566  FaissIndex`. Def
-00039590: 6175 6c74 2076 616c 7565 2069 7320 6031  ault value is `1
-000395a0: 3030 3060 2e0a 2020 2020 2020 2020 2020  000`..          
-000395b0: 2020 2020 2020 3c41 6464 6564 2076 6572        <Added ver
-000395c0: 7369 6f6e 3d22 322e 342e 3022 2f3e 0a20  sion="2.4.0"/>. 
-000395d0: 2020 2020 2020 2020 2020 2074 7261 696e             train
-000395e0: 5f73 697a 6520 2860 696e 7460 2c20 2a6f  _size (`int`, *o
-000395f0: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
-00039600: 2020 2020 2020 2020 2020 2049 6620 7468             If th
-00039610: 6520 696e 6465 7820 6e65 6564 7320 6120  e index needs a 
-00039620: 7472 6169 6e69 6e67 2073 7465 702c 2073  training step, s
-00039630: 7065 6369 6669 6573 2068 6f77 206d 616e  pecifies how man
-00039640: 7920 7665 6374 6f72 7320 7769 6c6c 2062  y vectors will b
-00039650: 6520 7573 6564 2074 6f20 7472 6169 6e20  e used to train 
-00039660: 7468 6520 696e 6465 782e 0a20 2020 2020  the index..     
-00039670: 2020 2020 2020 2066 6169 7373 5f76 6572         faiss_ver
-00039680: 626f 7365 2028 6062 6f6f 6c60 2c20 6465  bose (`bool`, de
-00039690: 6661 756c 7473 2074 6f20 6046 616c 7365  faults to `False
-000396a0: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
-000396b0: 2020 2020 456e 6162 6c65 2074 6865 2076      Enable the v
-000396c0: 6572 626f 7369 7479 206f 6620 7468 6520  erbosity of the 
-000396d0: 4661 6973 7320 696e 6465 782e 0a20 2020  Faiss index..   
-000396e0: 2020 2020 2020 2020 2064 7479 7065 2028           dtype (
-000396f0: 6064 6174 612d 7479 7065 6029 3a0a 2020  `data-type`):.  
-00039700: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-00039710: 6520 6474 7970 6520 6f66 2074 6865 206e  e dtype of the n
-00039720: 756d 7079 2061 7272 6179 7320 7468 6174  umpy arrays that
-00039730: 2061 7265 2069 6e64 6578 6564 2e0a 2020   are indexed..  
-00039740: 2020 2020 2020 2020 2020 2020 2020 4465                De
-00039750: 6661 756c 7420 6973 2060 6e70 2e66 6c6f  fault is `np.flo
-00039760: 6174 3332 602e 0a0a 2020 2020 2020 2020  at32`...        
-00039770: 4578 616d 706c 653a 0a0a 2020 2020 2020  Example:..      
-00039780: 2020 6060 6070 7974 686f 6e0a 2020 2020    ```python.    
-00039790: 2020 2020 3e3e 3e20 6473 203d 2064 6174      >>> ds = dat
-000397a0: 6173 6574 732e 6c6f 6164 5f64 6174 6173  asets.load_datas
-000397b0: 6574 2827 6372 696d 655f 616e 645f 7075  et('crime_and_pu
-000397c0: 6e69 7368 272c 2073 706c 6974 3d27 7472  nish', split='tr
-000397d0: 6169 6e27 290a 2020 2020 2020 2020 3e3e  ain').        >>
-000397e0: 3e20 6473 5f77 6974 685f 656d 6265 6464  > ds_with_embedd
-000397f0: 696e 6773 203d 2064 732e 6d61 7028 6c61  ings = ds.map(la
-00039800: 6d62 6461 2065 7861 6d70 6c65 3a20 7b27  mbda example: {'
-00039810: 656d 6265 6464 696e 6773 273a 2065 6d62  embeddings': emb
-00039820: 6564 2865 7861 6d70 6c65 5b27 6c69 6e65  ed(example['line
-00039830: 275d 7d29 290a 2020 2020 2020 2020 3e3e  ']})).        >>
-00039840: 3e20 6473 5f77 6974 685f 656d 6265 6464  > ds_with_embedd
-00039850: 696e 6773 2e61 6464 5f66 6169 7373 5f69  ings.add_faiss_i
-00039860: 6e64 6578 2863 6f6c 756d 6e3d 2765 6d62  ndex(column='emb
-00039870: 6564 6469 6e67 7327 290a 2020 2020 2020  eddings').      
-00039880: 2020 3e3e 3e20 2320 7175 6572 790a 2020    >>> # query.  
-00039890: 2020 2020 2020 3e3e 3e20 7363 6f72 6573        >>> scores
-000398a0: 2c20 7265 7472 6965 7665 645f 6578 616d  , retrieved_exam
-000398b0: 706c 6573 203d 2064 735f 7769 7468 5f65  ples = ds_with_e
-000398c0: 6d62 6564 6469 6e67 732e 6765 745f 6e65  mbeddings.get_ne
-000398d0: 6172 6573 745f 6578 616d 706c 6573 2827  arest_examples('
-000398e0: 656d 6265 6464 696e 6773 272c 2065 6d62  embeddings', emb
-000398f0: 6564 2827 6d79 206e 6577 2071 7565 7279  ed('my new query
-00039900: 2729 2c20 6b3d 3130 290a 2020 2020 2020  '), k=10).      
-00039910: 2020 3e3e 3e20 2320 7361 7665 2069 6e64    >>> # save ind
-00039920: 6578 0a20 2020 2020 2020 203e 3e3e 2064  ex.        >>> d
-00039930: 735f 7769 7468 5f65 6d62 6564 6469 6e67  s_with_embedding
-00039940: 732e 7361 7665 5f66 6169 7373 5f69 6e64  s.save_faiss_ind
-00039950: 6578 2827 656d 6265 6464 696e 6773 272c  ex('embeddings',
-00039960: 2027 6d79 5f69 6e64 6578 2e66 6169 7373   'my_index.faiss
-00039970: 2729 0a0a 2020 2020 2020 2020 3e3e 3e20  ')..        >>> 
-00039980: 6473 203d 2064 6174 6173 6574 732e 6c6f  ds = datasets.lo
-00039990: 6164 5f64 6174 6173 6574 2827 6372 696d  ad_dataset('crim
-000399a0: 655f 616e 645f 7075 6e69 7368 272c 2073  e_and_punish', s
-000399b0: 706c 6974 3d27 7472 6169 6e27 290a 2020  plit='train').  
-000399c0: 2020 2020 2020 3e3e 3e20 2320 6c6f 6164        >>> # load
-000399d0: 2069 6e64 6578 0a20 2020 2020 2020 203e   index.        >
-000399e0: 3e3e 2064 732e 6c6f 6164 5f66 6169 7373  >> ds.load_faiss
-000399f0: 5f69 6e64 6578 2827 656d 6265 6464 696e  _index('embeddin
-00039a00: 6773 272c 2027 6d79 5f69 6e64 6578 2e66  gs', 'my_index.f
-00039a10: 6169 7373 2729 0a20 2020 2020 2020 203e  aiss').        >
-00039a20: 3e3e 2023 2071 7565 7279 0a20 2020 2020  >> # query.     
-00039a30: 2020 203e 3e3e 2073 636f 7265 732c 2072     >>> scores, r
-00039a40: 6574 7269 6576 6564 5f65 7861 6d70 6c65  etrieved_example
-00039a50: 7320 3d20 6473 2e67 6574 5f6e 6561 7265  s = ds.get_neare
-00039a60: 7374 5f65 7861 6d70 6c65 7328 2765 6d62  st_examples('emb
-00039a70: 6564 6469 6e67 7327 2c20 656d 6265 6428  eddings', embed(
-00039a80: 276d 7920 6e65 7720 7175 6572 7927 292c  'my new query'),
-00039a90: 206b 3d31 3029 0a20 2020 2020 2020 2060   k=10).        `
-00039aa0: 6060 0a20 2020 2020 2020 2022 2222 0a20  ``.        """. 
-00039ab0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00039ac0: 2e66 6f72 6d61 7474 6564 5f61 7328 7479  .formatted_as(ty
-00039ad0: 7065 3d22 6e75 6d70 7922 2c20 636f 6c75  pe="numpy", colu
-00039ae0: 6d6e 733d 5b63 6f6c 756d 6e5d 2c20 6474  mns=[column], dt
-00039af0: 7970 653d 6474 7970 6529 3a0a 2020 2020  ype=dtype):.    
-00039b00: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-00039b10: 6164 645f 6661 6973 735f 696e 6465 7828  add_faiss_index(
-00039b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039b30: 2063 6f6c 756d 6e3d 636f 6c75 6d6e 2c0a   column=column,.
-00039b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039b50: 696e 6465 785f 6e61 6d65 3d69 6e64 6578  index_name=index
-00039b60: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
-00039b70: 2020 2020 2020 2064 6576 6963 653d 6465         device=de
-00039b80: 7669 6365 2c0a 2020 2020 2020 2020 2020  vice,.          
-00039b90: 2020 2020 2020 7374 7269 6e67 5f66 6163        string_fac
-00039ba0: 746f 7279 3d73 7472 696e 675f 6661 6374  tory=string_fact
-00039bb0: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
-00039bc0: 2020 2020 206d 6574 7269 635f 7479 7065       metric_type
-00039bd0: 3d6d 6574 7269 635f 7479 7065 2c0a 2020  =metric_type,.  
-00039be0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-00039bf0: 7374 6f6d 5f69 6e64 6578 3d63 7573 746f  stom_index=custo
-00039c00: 6d5f 696e 6465 782c 0a20 2020 2020 2020  m_index,.       
-00039c10: 2020 2020 2020 2020 2062 6174 6368 5f73           batch_s
-00039c20: 697a 653d 6261 7463 685f 7369 7a65 2c0a  ize=batch_size,.
-00039c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039c40: 7472 6169 6e5f 7369 7a65 3d74 7261 696e  train_size=train
-00039c50: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-00039c60: 2020 2020 2020 2066 6169 7373 5f76 6572         faiss_ver
-00039c70: 626f 7365 3d66 6169 7373 5f76 6572 626f  bose=faiss_verbo
-00039c80: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-00039c90: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00039ca0: 2073 656c 660a 0a20 2020 2064 6566 2061   self..    def a
-00039cb0: 6464 5f66 6169 7373 5f69 6e64 6578 5f66  dd_faiss_index_f
-00039cc0: 726f 6d5f 6578 7465 726e 616c 5f61 7272  rom_external_arr
-00039cd0: 6179 7328 0a20 2020 2020 2020 2073 656c  ays(.        sel
-00039ce0: 662c 0a20 2020 2020 2020 2065 7874 6572  f,.        exter
-00039cf0: 6e61 6c5f 6172 7261 7973 3a20 6e70 2e61  nal_arrays: np.a
-00039d00: 7272 6179 2c0a 2020 2020 2020 2020 696e  rray,.        in
-00039d10: 6465 785f 6e61 6d65 3a20 7374 722c 0a20  dex_name: str,. 
-00039d20: 2020 2020 2020 2064 6576 6963 653a 204f         device: O
-00039d30: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
-00039d40: 6f6e 652c 0a20 2020 2020 2020 2073 7472  one,.        str
-00039d50: 696e 675f 6661 6374 6f72 793a 204f 7074  ing_factory: Opt
-00039d60: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-00039d70: 652c 0a20 2020 2020 2020 206d 6574 7269  e,.        metri
-00039d80: 635f 7479 7065 3a20 4f70 7469 6f6e 616c  c_type: Optional
-00039d90: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
-00039da0: 2020 2020 2020 6375 7374 6f6d 5f69 6e64        custom_ind
-00039db0: 6578 3a20 4f70 7469 6f6e 616c 5b22 6661  ex: Optional["fa
-00039dc0: 6973 732e 496e 6465 7822 5d20 3d20 4e6f  iss.Index"] = No
-00039dd0: 6e65 2c20 2023 206e 6f71 613a 2046 3832  ne,  # noqa: F82
-00039de0: 310a 2020 2020 2020 2020 6261 7463 685f  1.        batch_
-00039df0: 7369 7a65 3a20 696e 7420 3d20 3130 3030  size: int = 1000
-00039e00: 2c0a 2020 2020 2020 2020 7472 6169 6e5f  ,.        train_
-00039e10: 7369 7a65 3a20 4f70 7469 6f6e 616c 5b69  size: Optional[i
-00039e20: 6e74 5d20 3d20 4e6f 6e65 2c0a 2020 2020  nt] = None,.    
-00039e30: 2020 2020 6661 6973 735f 7665 7262 6f73      faiss_verbos
-00039e40: 653a 2062 6f6f 6c20 3d20 4661 6c73 652c  e: bool = False,
-00039e50: 0a20 2020 2020 2020 2064 7479 7065 3d6e  .        dtype=n
-00039e60: 702e 666c 6f61 7433 322c 0a20 2020 2029  p.float32,.    )
-00039e70: 3a0a 2020 2020 2020 2020 2222 2241 6464  :.        """Add
-00039e80: 2061 2064 656e 7365 2069 6e64 6578 2075   a dense index u
-00039e90: 7369 6e67 2046 6169 7373 2066 6f72 2066  sing Faiss for f
-00039ea0: 6173 7420 7265 7472 6965 7661 6c2e 0a20  ast retrieval.. 
-00039eb0: 2020 2020 2020 2054 6865 2069 6e64 6578         The index
-00039ec0: 2069 7320 6372 6561 7465 6420 7573 696e   is created usin
-00039ed0: 6720 7468 6520 7665 6374 6f72 7320 6f66  g the vectors of
-00039ee0: 2060 6578 7465 726e 616c 5f61 7272 6179   `external_array
-00039ef0: 7360 2e0a 2020 2020 2020 2020 596f 7520  s`..        You 
-00039f00: 6361 6e20 7370 6563 6966 7920 6064 6576  can specify `dev
-00039f10: 6963 6560 2069 6620 796f 7520 7761 6e74  ice` if you want
-00039f20: 2074 6f20 7275 6e20 6974 206f 6e20 4750   to run it on GP
-00039f30: 5520 2860 6465 7669 6365 6020 6d75 7374  U (`device` must
-00039f40: 2062 6520 7468 6520 4750 5520 696e 6465   be the GPU inde
-00039f50: 7829 2e0a 2020 2020 2020 2020 596f 7520  x)..        You 
-00039f60: 6361 6e20 6669 6e64 206d 6f72 6520 696e  can find more in
-00039f70: 666f 726d 6174 696f 6e20 6162 6f75 7420  formation about 
-00039f80: 4661 6973 7320 6865 7265 3a0a 0a20 2020  Faiss here:..   
-00039f90: 2020 2020 202d 2046 6f72 205b 7374 7269       - For [stri
-00039fa0: 6e67 2066 6163 746f 7279 5d28 6874 7470  ng factory](http
-00039fb0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f66  s://github.com/f
-00039fc0: 6163 6562 6f6f 6b72 6573 6561 7263 682f  acebookresearch/
-00039fd0: 6661 6973 732f 7769 6b69 2f54 6865 2d69  faiss/wiki/The-i
-00039fe0: 6e64 6578 2d66 6163 746f 7279 290a 0a20  ndex-factory).. 
-00039ff0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-0003a000: 2020 2020 2020 2020 2065 7874 6572 6e61           externa
-0003a010: 6c5f 6172 7261 7973 2028 606e 702e 6172  l_arrays (`np.ar
-0003a020: 7261 7960 293a 0a20 2020 2020 2020 2020  ray`):.         
-0003a030: 2020 2020 2020 2049 6620 796f 7520 7761         If you wa
-0003a040: 6e74 2074 6f20 7573 6520 6172 7261 7973  nt to use arrays
-0003a050: 2066 726f 6d20 6f75 7473 6964 6520 7468   from outside th
-0003a060: 6520 6c69 6220 666f 7220 7468 6520 696e  e lib for the in
-0003a070: 6465 782c 2079 6f75 2063 616e 2073 6574  dex, you can set
-0003a080: 2060 6578 7465 726e 616c 5f61 7272 6179   `external_array
-0003a090: 7360 2e0a 2020 2020 2020 2020 2020 2020  s`..            
-0003a0a0: 2020 2020 4974 2077 696c 6c20 7573 6520      It will use 
-0003a0b0: 6065 7874 6572 6e61 6c5f 6172 7261 7973  `external_arrays
-0003a0c0: 6020 746f 2063 7265 6174 6520 7468 6520  ` to create the 
-0003a0d0: 4661 6973 7320 696e 6465 7820 696e 7374  Faiss index inst
-0003a0e0: 6561 6420 6f66 2074 6865 2061 7272 6179  ead of the array
-0003a0f0: 7320 696e 2074 6865 2067 6976 656e 2060  s in the given `
-0003a100: 636f 6c75 6d6e 602e 0a20 2020 2020 2020  column`..       
-0003a110: 2020 2020 2069 6e64 6578 5f6e 616d 6520       index_name 
-0003a120: 2860 7374 7260 293a 0a20 2020 2020 2020  (`str`):.       
-0003a130: 2020 2020 2020 2020 2054 6865 2060 696e           The `in
-0003a140: 6465 785f 6e61 6d65 602f 6964 656e 7469  dex_name`/identi
-0003a150: 6669 6572 206f 6620 7468 6520 696e 6465  fier of the inde
-0003a160: 782e 0a20 2020 2020 2020 2020 2020 2020  x..             
-0003a170: 2020 2054 6869 7320 6973 2074 6865 2060     This is the `
-0003a180: 696e 6465 785f 6e61 6d65 6020 7468 6174  index_name` that
-0003a190: 2069 7320 7573 6564 2074 6f20 6361 6c6c   is used to call
-0003a1a0: 205b 607e 6461 7461 7365 7473 2e44 6174   [`~datasets.Dat
-0003a1b0: 6173 6574 2e67 6574 5f6e 6561 7265 7374  aset.get_nearest
-0003a1c0: 5f65 7861 6d70 6c65 7360 5d20 6f72 205b  _examples`] or [
-0003a1d0: 607e 6461 7461 7365 7473 2e44 6174 6173  `~datasets.Datas
-0003a1e0: 6574 2e73 6561 7263 6860 5d2e 0a20 2020  et.search`]..   
-0003a1f0: 2020 2020 2020 2020 2064 6576 6963 6520           device 
-0003a200: 284f 7074 696f 6e61 6c20 6055 6e69 6f6e  (Optional `Union
-0003a210: 5b69 6e74 2c20 4c69 7374 5b69 6e74 5d5d  [int, List[int]]
-0003a220: 602c 202a 6f70 7469 6f6e 616c 2a29 3a0a  `, *optional*):.
-0003a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a240: 4966 2070 6f73 6974 6976 6520 696e 7465  If positive inte
-0003a250: 6765 722c 2074 6869 7320 6973 2074 6865  ger, this is the
-0003a260: 2069 6e64 6578 206f 6620 7468 6520 4750   index of the GP
-0003a270: 5520 746f 2075 7365 2e20 4966 206e 6567  U to use. If neg
-0003a280: 6174 6976 6520 696e 7465 6765 722c 2075  ative integer, u
-0003a290: 7365 2061 6c6c 2047 5055 732e 0a20 2020  se all GPUs..   
-0003a2a0: 2020 2020 2020 2020 2020 2020 2049 6620               If 
-0003a2b0: 6120 6c69 7374 206f 6620 706f 7369 7469  a list of positi
-0003a2c0: 7665 2069 6e74 6567 6572 7320 6973 2070  ve integers is p
-0003a2d0: 6173 7365 6420 696e 2c20 7275 6e20 6f6e  assed in, run on
-0003a2e0: 6c79 206f 6e20 7468 6f73 6520 4750 5573  ly on those GPUs
-0003a2f0: 2e20 4279 2064 6566 6175 6c74 2069 7420  . By default it 
-0003a300: 7573 6573 2074 6865 2043 5055 2e0a 2020  uses the CPU..  
-0003a310: 2020 2020 2020 2020 2020 7374 7269 6e67            string
-0003a320: 5f66 6163 746f 7279 2028 6073 7472 602c  _factory (`str`,
-0003a330: 202a 6f70 7469 6f6e 616c 2a29 3a0a 2020   *optional*):.  
-0003a340: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-0003a350: 6973 2069 7320 7061 7373 6564 2074 6f20  is is passed to 
-0003a360: 7468 6520 696e 6465 7820 6661 6374 6f72  the index factor
-0003a370: 7920 6f66 2046 6169 7373 2074 6f20 6372  y of Faiss to cr
-0003a380: 6561 7465 2074 6865 2069 6e64 6578 2e0a  eate the index..
-0003a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a3a0: 4465 6661 756c 7420 696e 6465 7820 636c  Default index cl
-0003a3b0: 6173 7320 6973 2060 496e 6465 7846 6c61  ass is `IndexFla
-0003a3c0: 7460 2e0a 2020 2020 2020 2020 2020 2020  t`..            
-0003a3d0: 6d65 7472 6963 5f74 7970 6520 2860 696e  metric_type (`in
-0003a3e0: 7460 2c20 2a6f 7074 696f 6e61 6c2a 293a  t`, *optional*):
-0003a3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a400: 2054 7970 6520 6f66 206d 6574 7269 632e   Type of metric.
-0003a410: 2045 783a 2060 6661 6973 732e 6661 6973   Ex: `faiss.fais
-0003a420: 732e 4d45 5452 4943 5f49 4e4e 4552 5f50  s.METRIC_INNER_P
-0003a430: 524f 4455 4354 6020 6f72 2060 6661 6973  RODUCT` or `fais
-0003a440: 732e 4d45 5452 4943 5f4c 3260 2e0a 2020  s.METRIC_L2`..  
-0003a450: 2020 2020 2020 2020 2020 6375 7374 6f6d            custom
-0003a460: 5f69 6e64 6578 2028 6066 6169 7373 2e49  _index (`faiss.I
-0003a470: 6e64 6578 602c 202a 6f70 7469 6f6e 616c  ndex`, *optional
-0003a480: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
-0003a490: 2020 2020 4375 7374 6f6d 2046 6169 7373      Custom Faiss
-0003a4a0: 2069 6e64 6578 2074 6861 7420 796f 7520   index that you 
-0003a4b0: 616c 7265 6164 7920 6861 7665 2069 6e73  already have ins
-0003a4c0: 7461 6e74 6961 7465 6420 616e 6420 636f  tantiated and co
-0003a4d0: 6e66 6967 7572 6564 2066 6f72 2079 6f75  nfigured for you
-0003a4e0: 7220 6e65 6564 732e 0a20 2020 2020 2020  r needs..       
-0003a4f0: 2020 2020 2062 6174 6368 5f73 697a 6520       batch_size 
-0003a500: 2860 696e 7460 2c20 2a6f 7074 696f 6e61  (`int`, *optiona
-0003a510: 6c2a 293a 0a20 2020 2020 2020 2020 2020  l*):.           
-0003a520: 2020 2020 2053 697a 6520 6f66 2074 6865       Size of the
-0003a530: 2062 6174 6368 2074 6f20 7573 6520 7768   batch to use wh
-0003a540: 696c 6520 6164 6469 6e67 2076 6563 746f  ile adding vecto
-0003a550: 7273 2074 6f20 7468 6520 4661 6973 7349  rs to the FaissI
-0003a560: 6e64 6578 2e20 4465 6661 756c 7420 7661  ndex. Default va
-0003a570: 6c75 6520 6973 2031 3030 302e 0a20 2020  lue is 1000..   
-0003a580: 2020 2020 2020 2020 2020 2020 203c 4164               <Ad
-0003a590: 6465 6420 7665 7273 696f 6e3d 2232 2e34  ded version="2.4
-0003a5a0: 2e30 222f 3e0a 2020 2020 2020 2020 2020  .0"/>.          
-0003a5b0: 2020 7472 6169 6e5f 7369 7a65 2028 6069    train_size (`i
-0003a5c0: 6e74 602c 202a 6f70 7469 6f6e 616c 2a29  nt`, *optional*)
-0003a5d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003a5e0: 2020 4966 2074 6865 2069 6e64 6578 206e    If the index n
-0003a5f0: 6565 6473 2061 2074 7261 696e 696e 6720  eeds a training 
-0003a600: 7374 6570 2c20 7370 6563 6966 6965 7320  step, specifies 
-0003a610: 686f 7720 6d61 6e79 2076 6563 746f 7273  how many vectors
-0003a620: 2077 696c 6c20 6265 2075 7365 6420 746f   will be used to
-0003a630: 2074 7261 696e 2074 6865 2069 6e64 6578   train the index
-0003a640: 2e0a 2020 2020 2020 2020 2020 2020 6661  ..            fa
-0003a650: 6973 735f 7665 7262 6f73 6520 2860 626f  iss_verbose (`bo
-0003a660: 6f6c 602c 2064 6566 6175 6c74 7320 746f  ol`, defaults to
-0003a670: 2046 616c 7365 293a 0a20 2020 2020 2020   False):.       
-0003a680: 2020 2020 2020 2020 2045 6e61 626c 6520           Enable 
-0003a690: 7468 6520 7665 7262 6f73 6974 7920 6f66  the verbosity of
-0003a6a0: 2074 6865 2046 6169 7373 2069 6e64 6578   the Faiss index
-0003a6b0: 2e0a 2020 2020 2020 2020 2020 2020 6474  ..            dt
-0003a6c0: 7970 6520 2860 6e75 6d70 792e 6474 7970  ype (`numpy.dtyp
-0003a6d0: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
-0003a6e0: 2020 2020 2054 6865 2064 7479 7065 206f       The dtype o
-0003a6f0: 6620 7468 6520 6e75 6d70 7920 6172 7261  f the numpy arra
-0003a700: 7973 2074 6861 7420 6172 6520 696e 6465  ys that are inde
-0003a710: 7865 642e 2044 6566 6175 6c74 2069 7320  xed. Default is 
-0003a720: 6e70 2e66 6c6f 6174 3332 2e0a 2020 2020  np.float32..    
-0003a730: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0003a740: 7375 7065 7228 292e 6164 645f 6661 6973  super().add_fais
-0003a750: 735f 696e 6465 785f 6672 6f6d 5f65 7874  s_index_from_ext
-0003a760: 6572 6e61 6c5f 6172 7261 7973 280a 2020  ernal_arrays(.  
-0003a770: 2020 2020 2020 2020 2020 6578 7465 726e            extern
-0003a780: 616c 5f61 7272 6179 733d 6578 7465 726e  al_arrays=extern
-0003a790: 616c 5f61 7272 6179 732e 6173 7479 7065  al_arrays.astype
-0003a7a0: 2864 7479 7065 292c 0a20 2020 2020 2020  (dtype),.       
-0003a7b0: 2020 2020 2069 6e64 6578 5f6e 616d 653d       index_name=
-0003a7c0: 696e 6465 785f 6e61 6d65 2c0a 2020 2020  index_name,.    
-0003a7d0: 2020 2020 2020 2020 6465 7669 6365 3d64          device=d
-0003a7e0: 6576 6963 652c 0a20 2020 2020 2020 2020  evice,.         
-0003a7f0: 2020 2073 7472 696e 675f 6661 6374 6f72     string_factor
-0003a800: 793d 7374 7269 6e67 5f66 6163 746f 7279  y=string_factory
-0003a810: 2c0a 2020 2020 2020 2020 2020 2020 6d65  ,.            me
-0003a820: 7472 6963 5f74 7970 653d 6d65 7472 6963  tric_type=metric
-0003a830: 5f74 7970 652c 0a20 2020 2020 2020 2020  _type,.         
-0003a840: 2020 2063 7573 746f 6d5f 696e 6465 783d     custom_index=
-0003a850: 6375 7374 6f6d 5f69 6e64 6578 2c0a 2020  custom_index,.  
-0003a860: 2020 2020 2020 2020 2020 6261 7463 685f            batch_
-0003a870: 7369 7a65 3d62 6174 6368 5f73 697a 652c  size=batch_size,
-0003a880: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
-0003a890: 696e 5f73 697a 653d 7472 6169 6e5f 7369  in_size=train_si
-0003a8a0: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-0003a8b0: 6661 6973 735f 7665 7262 6f73 653d 6661  faiss_verbose=fa
-0003a8c0: 6973 735f 7665 7262 6f73 652c 0a20 2020  iss_verbose,.   
-0003a8d0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-0003a8e0: 6164 645f 656c 6173 7469 6373 6561 7263  add_elasticsearc
-0003a8f0: 685f 696e 6465 7828 0a20 2020 2020 2020  h_index(.       
-0003a900: 2073 656c 662c 0a20 2020 2020 2020 2063   self,.        c
-0003a910: 6f6c 756d 6e3a 2073 7472 2c0a 2020 2020  olumn: str,.    
-0003a920: 2020 2020 696e 6465 785f 6e61 6d65 3a20      index_name: 
-0003a930: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-0003a940: 4e6f 6e65 2c0a 2020 2020 2020 2020 686f  None,.        ho
-0003a950: 7374 3a20 4f70 7469 6f6e 616c 5b73 7472  st: Optional[str
-0003a960: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-0003a970: 2020 706f 7274 3a20 4f70 7469 6f6e 616c    port: Optional
-0003a980: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
-0003a990: 2020 2020 2020 6573 5f63 6c69 656e 743a        es_client:
-0003a9a0: 204f 7074 696f 6e61 6c5b 2265 6c61 7374   Optional["elast
-0003a9b0: 6963 7365 6172 6368 2e45 6c61 7374 6963  icsearch.Elastic
-0003a9c0: 7365 6172 6368 225d 203d 204e 6f6e 652c  search"] = None,
-0003a9d0: 2020 2320 6e6f 7161 3a20 4638 3231 0a20    # noqa: F821. 
-0003a9e0: 2020 2020 2020 2065 735f 696e 6465 785f         es_index_
-0003a9f0: 6e61 6d65 3a20 4f70 7469 6f6e 616c 5b73  name: Optional[s
-0003aa00: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-0003aa10: 2020 2020 6573 5f69 6e64 6578 5f63 6f6e      es_index_con
-0003aa20: 6669 673a 204f 7074 696f 6e61 6c5b 6469  fig: Optional[di
-0003aa30: 6374 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ct] = None,.    
-0003aa40: 293a 0a20 2020 2020 2020 2022 2222 4164  ):.        """Ad
-0003aa50: 6420 6120 7465 7874 2069 6e64 6578 2075  d a text index u
-0003aa60: 7369 6e67 2045 6c61 7374 6963 5365 6172  sing ElasticSear
-0003aa70: 6368 2066 6f72 2066 6173 7420 7265 7472  ch for fast retr
-0003aa80: 6965 7661 6c2e 2054 6869 7320 6973 2064  ieval. This is d
-0003aa90: 6f6e 6520 696e 2d70 6c61 6365 2e0a 0a20  one in-place... 
-0003aaa0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-0003aab0: 2020 2020 2020 2020 2063 6f6c 756d 6e20           column 
-0003aac0: 2860 7374 7260 293a 0a20 2020 2020 2020  (`str`):.       
-0003aad0: 2020 2020 2020 2020 2054 6865 2063 6f6c           The col
-0003aae0: 756d 6e20 6f66 2074 6865 2064 6f63 756d  umn of the docum
-0003aaf0: 656e 7473 2074 6f20 6164 6420 746f 2074  ents to add to t
-0003ab00: 6865 2069 6e64 6578 2e0a 2020 2020 2020  he index..      
-0003ab10: 2020 2020 2020 696e 6465 785f 6e61 6d65        index_name
-0003ab20: 2028 6073 7472 602c 202a 6f70 7469 6f6e   (`str`, *option
-0003ab30: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
-0003ab40: 2020 2020 2020 5468 6520 6069 6e64 6578        The `index
-0003ab50: 5f6e 616d 6560 2f69 6465 6e74 6966 6965  _name`/identifie
-0003ab60: 7220 6f66 2074 6865 2069 6e64 6578 2e0a  r of the index..
+00023d20: 2020 2020 2020 2020 2020 2020 2020 7772                wr
+00023d30: 6974 6572 2e77 7269 7465 5f74 6162 6c65  iter.write_table
+00023d40: 2862 6174 6368 290a 2020 2020 2020 2020  (batch).        
+00023d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d60: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00023d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d80: 2020 2020 2020 2020 2020 7772 6974 6572            writer
+00023d90: 2e77 7269 7465 5f62 6174 6368 2862 6174  .write_batch(bat
+00023da0: 6368 290a 2020 2020 2020 2020 2020 2020  ch).            
+00023db0: 2020 2020 6966 2075 7064 6174 655f 6461      if update_da
+00023dc0: 7461 2061 6e64 2077 7269 7465 7220 6973  ta and writer is
+00023dd0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00023de0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00023df0: 7269 7465 722e 6669 6e61 6c69 7a65 2829  riter.finalize()
+00023e00: 2020 2320 636c 6f73 655f 7374 7265 616d    # close_stream
+00023e10: 3d62 6f6f 6c28 6275 665f 7772 6974 6572  =bool(buf_writer
+00023e20: 2069 7320 4e6f 6e65 2929 2020 2320 5765   is None))  # We
+00023e30: 206f 6e6c 7920 636c 6f73 6520 6966 2077   only close if w
+00023e40: 6520 6172 6520 7772 6974 696e 6720 696e  e are writing in
+00023e50: 2061 2066 696c 650a 2020 2020 2020 2020   a file.        
+00023e60: 2020 2020 6578 6365 7074 2028 4578 6365      except (Exce
+00023e70: 7074 696f 6e2c 204b 6579 626f 6172 6449  ption, KeyboardI
+00023e80: 6e74 6572 7275 7074 293a 0a20 2020 2020  nterrupt):.     
+00023e90: 2020 2020 2020 2020 2020 2069 6620 7570             if up
+00023ea0: 6461 7465 5f64 6174 613a 0a20 2020 2020  date_data:.     
+00023eb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00023ec0: 6620 7772 6974 6572 2069 7320 6e6f 7420  f writer is not 
+00023ed0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00023ee0: 2020 2020 2020 2020 2020 2020 2020 7772                wr
+00023ef0: 6974 6572 2e66 696e 616c 697a 6528 290a  iter.finalize().
+00023f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f10: 2020 2020 6966 2074 6d70 5f66 696c 6520      if tmp_file 
+00023f20: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00023f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f40: 2020 2020 2074 6d70 5f66 696c 652e 636c       tmp_file.cl
+00023f50: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
+00023f60: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00023f70: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00023f80: 746d 705f 6669 6c65 2e6e 616d 6529 3a0a  tmp_file.name):.
+00023f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023fa0: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
+00023fb0: 656d 6f76 6528 746d 705f 6669 6c65 2e6e  emove(tmp_file.n
+00023fc0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00023fd0: 2020 2020 2072 6169 7365 0a0a 2020 2020       raise..    
+00023fe0: 2020 2020 6966 2075 7064 6174 655f 6461      if update_da
+00023ff0: 7461 2061 6e64 2074 6d70 5f66 696c 6520  ta and tmp_file 
+00024000: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00024010: 2020 2020 2020 2020 2074 6d70 5f66 696c           tmp_fil
+00024020: 652e 636c 6f73 6528 290a 2020 2020 2020  e.close().      
+00024030: 2020 2020 2020 7368 7574 696c 2e6d 6f76        shutil.mov
+00024040: 6528 746d 705f 6669 6c65 2e6e 616d 652c  e(tmp_file.name,
+00024050: 2063 6163 6865 5f66 696c 655f 6e61 6d65   cache_file_name
+00024060: 290a 2020 2020 2020 2020 2020 2020 756d  ).            um
+00024070: 6173 6b20 3d20 6f73 2e75 6d61 736b 2830  ask = os.umask(0
+00024080: 6f36 3636 290a 2020 2020 2020 2020 2020  o666).          
+00024090: 2020 6f73 2e75 6d61 736b 2875 6d61 736b    os.umask(umask
+000240a0: 290a 2020 2020 2020 2020 2020 2020 6f73  ).            os
+000240b0: 2e63 686d 6f64 2863 6163 6865 5f66 696c  .chmod(cache_fil
+000240c0: 655f 6e61 6d65 2c20 306f 3636 3620 2620  e_name, 0o666 & 
+000240d0: 7e75 6d61 736b 290a 0a20 2020 2020 2020  ~umask)..       
+000240e0: 2069 6620 7570 6461 7465 5f64 6174 613a   if update_data:
+000240f0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00024100: 7265 6174 6520 6e65 7720 4461 7461 7365  reate new Datase
+00024110: 7420 6672 6f6d 2062 7566 6665 7220 6f72  t from buffer or
+00024120: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
+00024130: 2020 696e 666f 203d 2073 656c 662e 696e    info = self.in
+00024140: 666f 2e63 6f70 7928 290a 2020 2020 2020  fo.copy().      
+00024150: 2020 2020 2020 696e 666f 2e66 6561 7475        info.featu
+00024160: 7265 7320 3d20 7772 6974 6572 2e5f 6665  res = writer._fe
+00024170: 6174 7572 6573 0a20 2020 2020 2020 2020  atures.         
+00024180: 2020 2069 6e66 6f2e 7461 736b 5f74 656d     info.task_tem
+00024190: 706c 6174 6573 203d 204e 6f6e 650a 2020  plates = None.  
+000241a0: 2020 2020 2020 2020 2020 6966 2062 7566            if buf
+000241b0: 5f77 7269 7465 7220 6973 204e 6f6e 653a  _writer is None:
+000241c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000241d0: 2072 6574 7572 6e20 4461 7461 7365 742e   return Dataset.
+000241e0: 6672 6f6d 5f66 696c 6528 6361 6368 655f  from_file(cache_
+000241f0: 6669 6c65 5f6e 616d 652c 2069 6e66 6f3d  file_name, info=
+00024200: 696e 666f 2c20 7370 6c69 743d 7365 6c66  info, split=self
+00024210: 2e73 706c 6974 290a 2020 2020 2020 2020  .split).        
+00024220: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00024230: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00024240: 2044 6174 6173 6574 2e66 726f 6d5f 6275   Dataset.from_bu
+00024250: 6666 6572 2862 7566 5f77 7269 7465 722e  ffer(buf_writer.
+00024260: 6765 7476 616c 7565 2829 2c20 696e 666f  getvalue(), info
+00024270: 3d69 6e66 6f2c 2073 706c 6974 3d73 656c  =info, split=sel
+00024280: 662e 7370 6c69 7429 0a20 2020 2020 2020  f.split).       
+00024290: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000242a0: 2020 2072 6574 7572 6e20 7365 6c66 0a0a     return self..
+000242b0: 2020 2020 4074 7261 6e73 6d69 745f 666f      @transmit_fo
+000242c0: 726d 6174 0a20 2020 2040 6669 6e67 6572  rmat.    @finger
+000242d0: 7072 696e 745f 7472 616e 7366 6f72 6d28  print_transform(
+000242e0: 0a20 2020 2020 2020 2069 6e70 6c61 6365  .        inplace
+000242f0: 3d46 616c 7365 2c20 6967 6e6f 7265 5f6b  =False, ignore_k
+00024300: 7761 7267 733d 5b22 6c6f 6164 5f66 726f  wargs=["load_fro
+00024310: 6d5f 6361 6368 655f 6669 6c65 222c 2022  m_cache_file", "
+00024320: 6361 6368 655f 6669 6c65 5f6e 616d 6522  cache_file_name"
+00024330: 2c20 2264 6573 6322 5d2c 2076 6572 7369  , "desc"], versi
+00024340: 6f6e 3d22 322e 302e 3122 0a20 2020 2029  on="2.0.1".    )
+00024350: 0a20 2020 2064 6566 2066 696c 7465 7228  .    def filter(
+00024360: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00024370: 2020 2020 2020 2066 756e 6374 696f 6e3a         function:
+00024380: 204f 7074 696f 6e61 6c5b 4361 6c6c 6162   Optional[Callab
+00024390: 6c65 5d20 3d20 4e6f 6e65 2c0a 2020 2020  le] = None,.    
+000243a0: 2020 2020 7769 7468 5f69 6e64 6963 6573      with_indices
+000243b0: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+000243c0: 696e 7075 745f 636f 6c75 6d6e 733a 204f  input_columns: O
+000243d0: 7074 696f 6e61 6c5b 556e 696f 6e5b 7374  ptional[Union[st
+000243e0: 722c 204c 6973 745b 7374 725d 5d5d 203d  r, List[str]]] =
+000243f0: 204e 6f6e 652c 0a20 2020 2020 2020 2062   None,.        b
+00024400: 6174 6368 6564 3a20 626f 6f6c 203d 2046  atched: bool = F
+00024410: 616c 7365 2c0a 2020 2020 2020 2020 6261  alse,.        ba
+00024420: 7463 685f 7369 7a65 3a20 4f70 7469 6f6e  tch_size: Option
+00024430: 616c 5b69 6e74 5d20 3d20 3130 3030 2c0a  al[int] = 1000,.
+00024440: 2020 2020 2020 2020 6b65 6570 5f69 6e5f          keep_in_
+00024450: 6d65 6d6f 7279 3a20 626f 6f6c 203d 2046  memory: bool = F
+00024460: 616c 7365 2c0a 2020 2020 2020 2020 6c6f  alse,.        lo
+00024470: 6164 5f66 726f 6d5f 6361 6368 655f 6669  ad_from_cache_fi
+00024480: 6c65 3a20 626f 6f6c 203d 2054 7275 652c  le: bool = True,
+00024490: 0a20 2020 2020 2020 2063 6163 6865 5f66  .        cache_f
+000244a0: 696c 655f 6e61 6d65 3a20 4f70 7469 6f6e  ile_name: Option
+000244b0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+000244c0: 2020 2020 2020 2020 7772 6974 6572 5f62          writer_b
+000244d0: 6174 6368 5f73 697a 653a 204f 7074 696f  atch_size: Optio
+000244e0: 6e61 6c5b 696e 745d 203d 2031 3030 302c  nal[int] = 1000,
+000244f0: 0a20 2020 2020 2020 2066 6e5f 6b77 6172  .        fn_kwar
+00024500: 6773 3a20 4f70 7469 6f6e 616c 5b64 6963  gs: Optional[dic
+00024510: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
+00024520: 2020 206e 756d 5f70 726f 633a 204f 7074     num_proc: Opt
+00024530: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
+00024540: 652c 0a20 2020 2020 2020 2073 7566 6669  e,.        suffi
+00024550: 785f 7465 6d70 6c61 7465 3a20 7374 7220  x_template: str 
+00024560: 3d20 225f 7b72 616e 6b3a 3035 647d 5f6f  = "_{rank:05d}_o
+00024570: 665f 7b6e 756d 5f70 726f 633a 3035 647d  f_{num_proc:05d}
+00024580: 222c 0a20 2020 2020 2020 206e 6577 5f66  ",.        new_f
+00024590: 696e 6765 7270 7269 6e74 3a20 4f70 7469  ingerprint: Opti
+000245a0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+000245b0: 2c0a 2020 2020 2020 2020 6465 7363 3a20  ,.        desc: 
+000245c0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+000245d0: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 2022  None,.    ) -> "
+000245e0: 4461 7461 7365 7422 3a0a 2020 2020 2020  Dataset":.      
+000245f0: 2020 2222 2241 7070 6c79 2061 2066 696c    """Apply a fil
+00024600: 7465 7220 6675 6e63 7469 6f6e 2074 6f20  ter function to 
+00024610: 616c 6c20 7468 6520 656c 656d 656e 7473  all the elements
+00024620: 2069 6e20 7468 6520 7461 626c 6520 696e   in the table in
+00024630: 2062 6174 6368 6573 0a20 2020 2020 2020   batches.       
+00024640: 2061 6e64 2075 7064 6174 6520 7468 6520   and update the 
+00024650: 7461 626c 6520 736f 2074 6861 7420 7468  table so that th
+00024660: 6520 6461 7461 7365 7420 6f6e 6c79 2069  e dataset only i
+00024670: 6e63 6c75 6465 7320 6578 616d 706c 6573  ncludes examples
+00024680: 2061 6363 6f72 6469 6e67 2074 6f20 7468   according to th
+00024690: 6520 6669 6c74 6572 2066 756e 6374 696f  e filter functio
+000246a0: 6e2e 0a0a 2020 2020 2020 2020 4172 6773  n...        Args
+000246b0: 3a0a 2020 2020 2020 2020 2020 2020 6675  :.            fu
+000246c0: 6e63 7469 6f6e 2028 6043 616c 6c61 626c  nction (`Callabl
+000246d0: 6560 293a 2043 616c 6c61 626c 6520 7769  e`): Callable wi
+000246e0: 7468 206f 6e65 206f 6620 7468 6520 666f  th one of the fo
+000246f0: 6c6c 6f77 696e 6720 7369 676e 6174 7572  llowing signatur
+00024700: 6573 3a0a 0a20 2020 2020 2020 2020 2020  es:..           
+00024710: 2020 2020 202d 2060 6675 6e63 7469 6f6e       - `function
+00024720: 2865 7861 6d70 6c65 3a20 4469 6374 5b73  (example: Dict[s
+00024730: 7472 2c20 416e 795d 2920 2d3e 2062 6f6f  tr, Any]) -> boo
+00024740: 6c60 2069 6620 6077 6974 685f 696e 6469  l` if `with_indi
+00024750: 6365 733d 4661 6c73 652c 2062 6174 6368  ces=False, batch
+00024760: 6564 3d46 616c 7365 600a 2020 2020 2020  ed=False`.      
+00024770: 2020 2020 2020 2020 2020 2d20 6066 756e            - `fun
+00024780: 6374 696f 6e28 6578 616d 706c 653a 2044  ction(example: D
+00024790: 6963 745b 7374 722c 2041 6e79 5d2c 2069  ict[str, Any], i
+000247a0: 6e64 6963 6573 3a20 696e 7429 202d 3e20  ndices: int) -> 
+000247b0: 626f 6f6c 6020 6966 2060 7769 7468 5f69  bool` if `with_i
+000247c0: 6e64 6963 6573 3d54 7275 652c 2062 6174  ndices=True, bat
+000247d0: 6368 6564 3d46 616c 7365 600a 2020 2020  ched=False`.    
+000247e0: 2020 2020 2020 2020 2020 2020 2d20 6066              - `f
+000247f0: 756e 6374 696f 6e28 6578 616d 706c 653a  unction(example:
+00024800: 2044 6963 745b 7374 722c 204c 6973 745d   Dict[str, List]
+00024810: 2920 2d3e 204c 6973 745b 626f 6f6c 5d60  ) -> List[bool]`
+00024820: 2069 6620 6077 6974 685f 696e 6469 6365   if `with_indice
+00024830: 733d 4661 6c73 652c 2062 6174 6368 6564  s=False, batched
+00024840: 3d54 7275 6560 0a20 2020 2020 2020 2020  =True`.         
+00024850: 2020 2020 2020 202d 2060 6675 6e63 7469         - `functi
+00024860: 6f6e 2865 7861 6d70 6c65 3a20 4469 6374  on(example: Dict
+00024870: 5b73 7472 2c20 4c69 7374 5d2c 2069 6e64  [str, List], ind
+00024880: 6963 6573 3a20 4c69 7374 5b69 6e74 5d29  ices: List[int])
+00024890: 202d 3e20 4c69 7374 5b62 6f6f 6c5d 6020   -> List[bool]` 
+000248a0: 6966 2060 7769 7468 5f69 6e64 6963 6573  if `with_indices
+000248b0: 3d54 7275 652c 2062 6174 6368 6564 3d54  =True, batched=T
+000248c0: 7275 6560 0a0a 2020 2020 2020 2020 2020  rue`..          
+000248d0: 2020 2020 2020 4966 206e 6f20 6675 6e63        If no func
+000248e0: 7469 6f6e 2069 7320 7072 6f76 6964 6564  tion is provided
+000248f0: 2c20 6465 6661 756c 7473 2074 6f20 616e  , defaults to an
+00024900: 2061 6c77 6179 7320 6054 7275 6560 2066   always `True` f
+00024910: 756e 6374 696f 6e3a 2060 6c61 6d62 6461  unction: `lambda
+00024920: 2078 3a20 5472 7565 602e 0a20 2020 2020   x: True`..     
+00024930: 2020 2020 2020 2077 6974 685f 696e 6469         with_indi
+00024940: 6365 7320 2860 626f 6f6c 602c 2064 6566  ces (`bool`, def
+00024950: 6175 6c74 7320 746f 2060 4661 6c73 6560  aults to `False`
+00024960: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00024970: 2020 2050 726f 7669 6465 2065 7861 6d70     Provide examp
+00024980: 6c65 2069 6e64 6963 6573 2074 6f20 6066  le indices to `f
+00024990: 756e 6374 696f 6e60 2e20 4e6f 7465 2074  unction`. Note t
+000249a0: 6861 7420 696e 2074 6869 7320 6361 7365  hat in this case
+000249b0: 2074 6865 2073 6967 6e61 7475 7265 206f   the signature o
+000249c0: 6620 6066 756e 6374 696f 6e60 2073 686f  f `function` sho
+000249d0: 756c 6420 6265 2060 6465 6620 6675 6e63  uld be `def func
+000249e0: 7469 6f6e 2865 7861 6d70 6c65 2c20 6964  tion(example, id
+000249f0: 7829 3a20 2e2e 2e60 2e0a 2020 2020 2020  x): ...`..      
+00024a00: 2020 2020 2020 696e 7075 745f 636f 6c75        input_colu
+00024a10: 6d6e 7320 2860 7374 7260 206f 7220 604c  mns (`str` or `L
+00024a20: 6973 745b 7374 725d 602c 202a 6f70 7469  ist[str]`, *opti
+00024a30: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
+00024a40: 2020 2020 2020 2020 5468 6520 636f 6c75          The colu
+00024a50: 6d6e 7320 746f 2062 6520 7061 7373 6564  mns to be passed
+00024a60: 2069 6e74 6f20 6066 756e 6374 696f 6e60   into `function`
+00024a70: 2061 730a 2020 2020 2020 2020 2020 2020   as.            
+00024a80: 2020 2020 706f 7369 7469 6f6e 616c 2061      positional a
+00024a90: 7267 756d 656e 7473 2e20 4966 2060 4e6f  rguments. If `No
+00024aa0: 6e65 602c 2061 2060 6469 6374 6020 6d61  ne`, a `dict` ma
+00024ab0: 7070 696e 6720 746f 2061 6c6c 2066 6f72  pping to all for
+00024ac0: 6d61 7474 6564 2063 6f6c 756d 6e73 2069  matted columns i
+00024ad0: 7320 7061 7373 6564 2061 7320 6f6e 6520  s passed as one 
+00024ae0: 6172 6775 6d65 6e74 2e0a 2020 2020 2020  argument..      
+00024af0: 2020 2020 2020 6261 7463 6865 6420 2860        batched (`
+00024b00: 626f 6f6c 602c 2064 6566 6175 6c74 7320  bool`, defaults 
+00024b10: 746f 2060 4661 6c73 6560 293a 0a20 2020  to `False`):.   
+00024b20: 2020 2020 2020 2020 2020 2020 2050 726f               Pro
+00024b30: 7669 6465 2062 6174 6368 206f 6620 6578  vide batch of ex
+00024b40: 616d 706c 6573 2074 6f20 6066 756e 6374  amples to `funct
+00024b50: 696f 6e60 2e0a 2020 2020 2020 2020 2020  ion`..          
+00024b60: 2020 6261 7463 685f 7369 7a65 2028 6069    batch_size (`i
+00024b70: 6e74 602c 202a 6f70 7469 6f6e 616c 2a2c  nt`, *optional*,
+00024b80: 2064 6566 6175 6c74 7320 746f 2060 3130   defaults to `10
+00024b90: 3030 6029 3a0a 2020 2020 2020 2020 2020  00`):.          
+00024ba0: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
+00024bb0: 6578 616d 706c 6573 2070 6572 2062 6174  examples per bat
+00024bc0: 6368 2070 726f 7669 6465 6420 746f 2060  ch provided to `
+00024bd0: 6675 6e63 7469 6f6e 6020 6966 0a20 2020  function` if.   
+00024be0: 2020 2020 2020 2020 2020 2020 2060 6261               `ba
+00024bf0: 7463 6865 6420 3d20 5472 7565 602e 2049  tched = True`. I
+00024c00: 6620 6062 6174 6368 6564 203d 2046 616c  f `batched = Fal
+00024c10: 7365 602c 206f 6e65 2065 7861 6d70 6c65  se`, one example
+00024c20: 2070 6572 2062 6174 6368 2069 7320 7061   per batch is pa
+00024c30: 7373 6564 2074 6f20 6066 756e 6374 696f  ssed to `functio
+00024c40: 6e60 2e0a 2020 2020 2020 2020 2020 2020  n`..            
+00024c50: 2020 2020 4966 2060 6261 7463 685f 7369      If `batch_si
+00024c60: 7a65 203c 3d20 3060 206f 7220 6062 6174  ze <= 0` or `bat
+00024c70: 6368 5f73 697a 6520 3d3d 204e 6f6e 6560  ch_size == None`
+00024c80: 2c20 7072 6f76 6964 6520 7468 6520 6675  , provide the fu
+00024c90: 6c6c 2064 6174 6173 6574 2061 7320 6120  ll dataset as a 
+00024ca0: 7369 6e67 6c65 2062 6174 6368 2074 6f20  single batch to 
+00024cb0: 6066 756e 6374 696f 6e60 2e0a 2020 2020  `function`..    
+00024cc0: 2020 2020 2020 2020 6b65 6570 5f69 6e5f          keep_in_
+00024cd0: 6d65 6d6f 7279 2028 6062 6f6f 6c60 2c20  memory (`bool`, 
+00024ce0: 6465 6661 756c 7473 2074 6f20 6046 616c  defaults to `Fal
+00024cf0: 7365 6029 3a0a 2020 2020 2020 2020 2020  se`):.          
+00024d00: 2020 2020 2020 4b65 6570 2074 6865 2064        Keep the d
+00024d10: 6174 6173 6574 2069 6e20 6d65 6d6f 7279  ataset in memory
+00024d20: 2069 6e73 7465 6164 206f 6620 7772 6974   instead of writ
+00024d30: 696e 6720 6974 2074 6f20 6120 6361 6368  ing it to a cach
+00024d40: 6520 6669 6c65 2e0a 2020 2020 2020 2020  e file..        
+00024d50: 2020 2020 6c6f 6164 5f66 726f 6d5f 6361      load_from_ca
+00024d60: 6368 655f 6669 6c65 2028 6062 6f6f 6c60  che_file (`bool`
+00024d70: 2c20 6465 6661 756c 7473 2074 6f20 6054  , defaults to `T
+00024d80: 7275 6560 293a 0a20 2020 2020 2020 2020  rue`):.         
+00024d90: 2020 2020 2020 2049 6620 6120 6361 6368         If a cach
+00024da0: 6520 6669 6c65 2073 746f 7269 6e67 2074  e file storing t
+00024db0: 6865 2063 7572 7265 6e74 2063 6f6d 7075  he current compu
+00024dc0: 7461 7469 6f6e 2066 726f 6d20 6066 756e  tation from `fun
+00024dd0: 6374 696f 6e60 0a20 2020 2020 2020 2020  ction`.         
+00024de0: 2020 2020 2020 2063 616e 2062 6520 6964         can be id
+00024df0: 656e 7469 6669 6564 2c20 7573 6520 6974  entified, use it
+00024e00: 2069 6e73 7465 6164 206f 6620 7265 636f   instead of reco
+00024e10: 6d70 7574 696e 672e 0a20 2020 2020 2020  mputing..       
+00024e20: 2020 2020 2063 6163 6865 5f66 696c 655f       cache_file_
+00024e30: 6e61 6d65 2028 6073 7472 602c 202a 6f70  name (`str`, *op
+00024e40: 7469 6f6e 616c 2a29 3a0a 2020 2020 2020  tional*):.      
+00024e50: 2020 2020 2020 2020 2020 5072 6f76 6964            Provid
+00024e60: 6520 7468 6520 6e61 6d65 206f 6620 6120  e the name of a 
+00024e70: 7061 7468 2066 6f72 2074 6865 2063 6163  path for the cac
+00024e80: 6865 2066 696c 652e 2049 7420 6973 2075  he file. It is u
+00024e90: 7365 6420 746f 2073 746f 7265 2074 6865  sed to store the
+00024ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024eb0: 2072 6573 756c 7473 206f 6620 7468 6520   results of the 
+00024ec0: 636f 6d70 7574 6174 696f 6e20 696e 7374  computation inst
+00024ed0: 6561 6420 6f66 2074 6865 2061 7574 6f6d  ead of the autom
+00024ee0: 6174 6963 616c 6c79 2067 656e 6572 6174  atically generat
+00024ef0: 6564 2063 6163 6865 2066 696c 6520 6e61  ed cache file na
+00024f00: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
+00024f10: 7772 6974 6572 5f62 6174 6368 5f73 697a  writer_batch_siz
+00024f20: 6520 2860 696e 7460 2c20 6465 6661 756c  e (`int`, defaul
+00024f30: 7473 2074 6f20 6031 3030 3060 293a 0a20  ts to `1000`):. 
+00024f40: 2020 2020 2020 2020 2020 2020 2020 204e                 N
+00024f50: 756d 6265 7220 6f66 2072 6f77 7320 7065  umber of rows pe
+00024f60: 7220 7772 6974 6520 6f70 6572 6174 696f  r write operatio
+00024f70: 6e20 666f 7220 7468 6520 6361 6368 6520  n for the cache 
+00024f80: 6669 6c65 2077 7269 7465 722e 0a20 2020  file writer..   
+00024f90: 2020 2020 2020 2020 2020 2020 2054 6869               Thi
+00024fa0: 7320 7661 6c75 6520 6973 2061 2067 6f6f  s value is a goo
+00024fb0: 6420 7472 6164 652d 6f66 6620 6265 7477  d trade-off betw
+00024fc0: 6565 6e20 6d65 6d6f 7279 2075 7361 6765  een memory usage
+00024fd0: 2064 7572 696e 6720 7468 6520 7072 6f63   during the proc
+00024fe0: 6573 7369 6e67 2c20 616e 6420 7072 6f63  essing, and proc
+00024ff0: 6573 7369 6e67 2073 7065 6564 2e0a 2020  essing speed..  
+00025000: 2020 2020 2020 2020 2020 2020 2020 4869                Hi
+00025010: 6768 6572 2076 616c 7565 206d 616b 6573  gher value makes
+00025020: 2074 6865 2070 726f 6365 7373 696e 6720   the processing 
+00025030: 646f 2066 6577 6572 206c 6f6f 6b75 7073  do fewer lookups
+00025040: 2c20 6c6f 7765 7220 7661 6c75 6520 636f  , lower value co
+00025050: 6e73 756d 6520 6c65 7373 2074 656d 706f  nsume less tempo
+00025060: 7261 7279 206d 656d 6f72 7920 7768 696c  rary memory whil
+00025070: 6520 7275 6e6e 696e 6720 606d 6170 602e  e running `map`.
+00025080: 0a20 2020 2020 2020 2020 2020 2066 6e5f  .            fn_
+00025090: 6b77 6172 6773 2028 6064 6963 7460 2c20  kwargs (`dict`, 
+000250a0: 2a6f 7074 696f 6e61 6c2a 293a 0a20 2020  *optional*):.   
+000250b0: 2020 2020 2020 2020 2020 2020 204b 6579               Key
+000250c0: 776f 7264 2061 7267 756d 656e 7473 2074  word arguments t
+000250d0: 6f20 6265 2070 6173 7365 6420 746f 2060  o be passed to `
+000250e0: 6675 6e63 7469 6f6e 602e 0a20 2020 2020  function`..     
+000250f0: 2020 2020 2020 206e 756d 5f70 726f 6320         num_proc 
+00025100: 2860 696e 7460 2c20 2a6f 7074 696f 6e61  (`int`, *optiona
+00025110: 6c2a 293a 0a20 2020 2020 2020 2020 2020  l*):.           
+00025120: 2020 2020 204e 756d 6265 7220 6f66 2070       Number of p
+00025130: 726f 6365 7373 6573 2066 6f72 206d 756c  rocesses for mul
+00025140: 7469 7072 6f63 6573 7369 6e67 2e20 4279  tiprocessing. By
+00025150: 2064 6566 6175 6c74 2069 7420 646f 6573   default it does
+00025160: 6e27 740a 2020 2020 2020 2020 2020 2020  n't.            
+00025170: 2020 2020 7573 6520 6d75 6c74 6970 726f      use multipro
+00025180: 6365 7373 696e 672e 0a20 2020 2020 2020  cessing..       
+00025190: 2020 2020 2073 7566 6669 785f 7465 6d70       suffix_temp
+000251a0: 6c61 7465 2028 6073 7472 6029 3a0a 2020  late (`str`):.  
+000251b0: 2020 2020 2020 2020 2020 2020 2020 4966                If
+000251c0: 2060 6361 6368 655f 6669 6c65 5f6e 616d   `cache_file_nam
+000251d0: 6560 2069 7320 7370 6563 6966 6965 642c  e` is specified,
+000251e0: 2074 6865 6e20 7468 6973 2073 7566 6669   then this suffi
+000251f0: 7820 7769 6c6c 2062 6520 6164 6465 6420  x will be added 
+00025200: 6174 2074 6865 2065 6e64 206f 6620 7468  at the end of th
+00025210: 6520 6261 7365 206e 616d 6520 6f66 2065  e base name of e
+00025220: 6163 682e 0a20 2020 2020 2020 2020 2020  ach..           
+00025230: 2020 2020 2046 6f72 2065 7861 6d70 6c65       For example
+00025240: 2c20 6966 2060 6361 6368 655f 6669 6c65  , if `cache_file
+00025250: 5f6e 616d 6560 2069 7320 6022 7072 6f63  _name` is `"proc
+00025260: 6573 7365 642e 6172 726f 7722 602c 2074  essed.arrow"`, t
+00025270: 6865 6e20 666f 7220 6072 616e 6b20 3d20  hen for `rank = 
+00025280: 3160 2061 6e64 2060 6e75 6d5f 7072 6f63  1` and `num_proc
+00025290: 203d 2034 602c 0a20 2020 2020 2020 2020   = 4`,.         
+000252a0: 2020 2020 2020 2074 6865 2072 6573 756c         the resul
+000252b0: 7469 6e67 2066 696c 6520 776f 756c 6420  ting file would 
+000252c0: 6265 2060 2270 726f 6365 7373 6564 5f30  be `"processed_0
+000252d0: 3030 3031 5f6f 665f 3030 3030 342e 6172  0001_of_00004.ar
+000252e0: 726f 7722 6020 666f 7220 7468 6520 6465  row"` for the de
+000252f0: 6661 756c 7420 7375 6666 6978 2028 6465  fault suffix (de
+00025300: 6661 756c 740a 2020 2020 2020 2020 2020  fault.          
+00025310: 2020 2020 2020 605f 7b72 616e 6b3a 3035        `_{rank:05
+00025320: 647d 5f6f 665f 7b6e 756d 5f70 726f 633a  d}_of_{num_proc:
+00025330: 3035 647d 6029 2e0a 2020 2020 2020 2020  05d}`)..        
+00025340: 2020 2020 6e65 775f 6669 6e67 6572 7072      new_fingerpr
+00025350: 696e 7420 2860 7374 7260 2c20 2a6f 7074  int (`str`, *opt
+00025360: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
+00025370: 2020 2020 2020 2020 2054 6865 206e 6577           The new
+00025380: 2066 696e 6765 7270 7269 6e74 206f 6620   fingerprint of 
+00025390: 7468 6520 6461 7461 7365 7420 6166 7465  the dataset afte
+000253a0: 7220 7472 616e 7366 6f72 6d2e 0a20 2020  r transform..   
+000253b0: 2020 2020 2020 2020 2020 2020 2049 6620               If 
+000253c0: 604e 6f6e 6560 2c20 7468 6520 6e65 7720  `None`, the new 
+000253d0: 6669 6e67 6572 7072 696e 7420 6973 2063  fingerprint is c
+000253e0: 6f6d 7075 7465 6420 7573 696e 6720 6120  omputed using a 
+000253f0: 6861 7368 206f 6620 7468 6520 7072 6576  hash of the prev
+00025400: 696f 7573 2066 696e 6765 7270 7269 6e74  ious fingerprint
+00025410: 2c20 616e 6420 7468 6520 7472 616e 7366  , and the transf
+00025420: 6f72 6d20 6172 6775 6d65 6e74 732e 0a20  orm arguments.. 
+00025430: 2020 2020 2020 2020 2020 2064 6573 6320             desc 
+00025440: 2860 7374 7260 2c20 2a6f 7074 696f 6e61  (`str`, *optiona
+00025450: 6c2a 2c20 6465 6661 756c 7473 2074 6f20  l*, defaults to 
+00025460: 604e 6f6e 6560 293a 0a20 2020 2020 2020  `None`):.       
+00025470: 2020 2020 2020 2020 204d 6561 6e69 6e67           Meaning
+00025480: 6675 6c20 6465 7363 7269 7074 696f 6e20  ful description 
+00025490: 746f 2062 6520 6469 7370 6c61 7965 6420  to be displayed 
+000254a0: 616c 6f6e 6773 6964 6520 7769 7468 2074  alongside with t
+000254b0: 6865 2070 726f 6772 6573 7320 6261 7220  he progress bar 
+000254c0: 7768 696c 6520 6669 6c74 6572 696e 6720  while filtering 
+000254d0: 6578 616d 706c 6573 2e0a 0a20 2020 2020  examples...     
+000254e0: 2020 2045 7861 6d70 6c65 3a0a 0a20 2020     Example:..   
+000254f0: 2020 2020 2060 6060 7079 0a20 2020 2020       ```py.     
+00025500: 2020 203e 3e3e 2066 726f 6d20 6461 7461     >>> from data
+00025510: 7365 7473 2069 6d70 6f72 7420 6c6f 6164  sets import load
+00025520: 5f64 6174 6173 6574 0a20 2020 2020 2020  _dataset.       
+00025530: 203e 3e3e 2064 7320 3d20 6c6f 6164 5f64   >>> ds = load_d
+00025540: 6174 6173 6574 2822 726f 7474 656e 5f74  ataset("rotten_t
+00025550: 6f6d 6174 6f65 7322 2c20 7370 6c69 743d  omatoes", split=
+00025560: 2276 616c 6964 6174 696f 6e22 290a 2020  "validation").  
+00025570: 2020 2020 2020 3e3e 3e20 6473 2e66 696c        >>> ds.fil
+00025580: 7465 7228 6c61 6d62 6461 2078 3a20 785b  ter(lambda x: x[
+00025590: 226c 6162 656c 225d 203d 3d20 3129 0a20  "label"] == 1). 
+000255a0: 2020 2020 2020 2044 6174 6173 6574 287b         Dataset({
+000255b0: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
+000255c0: 7475 7265 733a 205b 2774 6578 7427 2c20  tures: ['text', 
+000255d0: 276c 6162 656c 275d 2c0a 2020 2020 2020  'label'],.      
+000255e0: 2020 2020 2020 6e75 6d5f 726f 7773 3a20        num_rows: 
+000255f0: 3533 330a 2020 2020 2020 2020 7d29 0a20  533.        }). 
+00025600: 2020 2020 2020 2060 6060 0a20 2020 2020         ```.     
+00025610: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00025620: 6620 6c65 6e28 7365 6c66 2e6c 6973 745f  f len(self.list_
+00025630: 696e 6465 7865 7328 2929 203e 2030 3a0a  indexes()) > 0:.
+00025640: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00025650: 6520 4461 7461 7365 7454 7261 6e73 666f  e DatasetTransfo
+00025660: 726d 6174 696f 6e4e 6f74 416c 6c6f 7765  rmationNotAllowe
+00025670: 6445 7272 6f72 280a 2020 2020 2020 2020  dError(.        
+00025680: 2020 2020 2020 2020 2255 7369 6e67 2060          "Using `
+00025690: 2e66 696c 7465 7260 206f 6e20 6120 6461  .filter` on a da
+000256a0: 7461 7365 7420 7769 7468 2061 7474 6163  taset with attac
+000256b0: 6865 6420 696e 6465 7865 7320 6973 206e  hed indexes is n
+000256c0: 6f74 2061 6c6c 6f77 6564 2e20 596f 7520  ot allowed. You 
+000256d0: 6361 6e20 6669 7273 7420 7275 6e20 602e  can first run `.
+000256e0: 6472 6f70 5f69 6e64 6578 2829 2074 6f20  drop_index() to 
+000256f0: 7265 6d6f 7665 2079 6f75 7220 696e 6465  remove your inde
+00025700: 7820 616e 6420 7468 656e 2072 652d 6164  x and then re-ad
+00025710: 6420 6974 2e60 220a 2020 2020 2020 2020  d it.`".        
+00025720: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
+00025730: 6620 6675 6e63 7469 6f6e 2069 7320 4e6f  f function is No
+00025740: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00025750: 6675 6e63 7469 6f6e 203d 206c 616d 6264  function = lambd
+00025760: 6120 783a 2054 7275 6520 2023 206e 6f71  a x: True  # noq
+00025770: 613a 2045 3733 310a 0a20 2020 2020 2020  a: E731..       
+00025780: 2069 6620 6c65 6e28 7365 6c66 2920 3d3d   if len(self) ==
+00025790: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+000257a0: 7265 7475 726e 2073 656c 660a 0a20 2020  return self..   
+000257b0: 2020 2020 2069 6e64 6963 6573 203d 2073       indices = s
+000257c0: 656c 662e 6d61 7028 0a20 2020 2020 2020  elf.map(.       
+000257d0: 2020 2020 2066 756e 6374 696f 6e3d 7061       function=pa
+000257e0: 7274 6961 6c28 0a20 2020 2020 2020 2020  rtial(.         
+000257f0: 2020 2020 2020 2067 6574 5f69 6e64 6963         get_indic
+00025800: 6573 5f66 726f 6d5f 6d61 736b 5f66 756e  es_from_mask_fun
+00025810: 6374 696f 6e2c 2066 756e 6374 696f 6e2c  ction, function,
+00025820: 2062 6174 6368 6564 2c20 7769 7468 5f69   batched, with_i
+00025830: 6e64 6963 6573 2c20 696e 7075 745f 636f  ndices, input_co
+00025840: 6c75 6d6e 732c 2073 656c 662e 5f69 6e64  lumns, self._ind
+00025850: 6963 6573 0a20 2020 2020 2020 2020 2020  ices.           
+00025860: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+00025870: 7769 7468 5f69 6e64 6963 6573 3d54 7275  with_indices=Tru
+00025880: 652c 0a20 2020 2020 2020 2020 2020 2066  e,.            f
+00025890: 6561 7475 7265 733d 4665 6174 7572 6573  eatures=Features
+000258a0: 287b 2269 6e64 6963 6573 223a 2056 616c  ({"indices": Val
+000258b0: 7565 2822 7569 6e74 3634 2229 7d29 2c0a  ue("uint64")}),.
+000258c0: 2020 2020 2020 2020 2020 2020 6261 7463              batc
+000258d0: 6865 643d 5472 7565 2c0a 2020 2020 2020  hed=True,.      
+000258e0: 2020 2020 2020 6261 7463 685f 7369 7a65        batch_size
+000258f0: 3d62 6174 6368 5f73 697a 652c 0a20 2020  =batch_size,.   
+00025900: 2020 2020 2020 2020 2072 656d 6f76 655f           remove_
+00025910: 636f 6c75 6d6e 733d 7365 6c66 2e63 6f6c  columns=self.col
+00025920: 756d 6e5f 6e61 6d65 732c 0a20 2020 2020  umn_names,.     
+00025930: 2020 2020 2020 206b 6565 705f 696e 5f6d         keep_in_m
+00025940: 656d 6f72 793d 6b65 6570 5f69 6e5f 6d65  emory=keep_in_me
+00025950: 6d6f 7279 2c0a 2020 2020 2020 2020 2020  mory,.          
+00025960: 2020 6c6f 6164 5f66 726f 6d5f 6361 6368    load_from_cach
+00025970: 655f 6669 6c65 3d6c 6f61 645f 6672 6f6d  e_file=load_from
+00025980: 5f63 6163 6865 5f66 696c 652c 0a20 2020  _cache_file,.   
+00025990: 2020 2020 2020 2020 2063 6163 6865 5f66           cache_f
+000259a0: 696c 655f 6e61 6d65 3d63 6163 6865 5f66  ile_name=cache_f
+000259b0: 696c 655f 6e61 6d65 2c0a 2020 2020 2020  ile_name,.      
+000259c0: 2020 2020 2020 7772 6974 6572 5f62 6174        writer_bat
+000259d0: 6368 5f73 697a 653d 7772 6974 6572 5f62  ch_size=writer_b
+000259e0: 6174 6368 5f73 697a 652c 0a20 2020 2020  atch_size,.     
+000259f0: 2020 2020 2020 2066 6e5f 6b77 6172 6773         fn_kwargs
+00025a00: 3d66 6e5f 6b77 6172 6773 2c0a 2020 2020  =fn_kwargs,.    
+00025a10: 2020 2020 2020 2020 6e75 6d5f 7072 6f63          num_proc
+00025a20: 3d6e 756d 5f70 726f 632c 0a20 2020 2020  =num_proc,.     
+00025a30: 2020 2020 2020 2073 7566 6669 785f 7465         suffix_te
+00025a40: 6d70 6c61 7465 3d73 7566 6669 785f 7465  mplate=suffix_te
+00025a50: 6d70 6c61 7465 2c0a 2020 2020 2020 2020  mplate,.        
+00025a60: 2020 2020 6e65 775f 6669 6e67 6572 7072      new_fingerpr
+00025a70: 696e 743d 6e65 775f 6669 6e67 6572 7072  int=new_fingerpr
+00025a80: 696e 742c 0a20 2020 2020 2020 2020 2020  int,.           
+00025a90: 2069 6e70 7574 5f63 6f6c 756d 6e73 3d69   input_columns=i
+00025aa0: 6e70 7574 5f63 6f6c 756d 6e73 2c0a 2020  nput_columns,.  
+00025ab0: 2020 2020 2020 2020 2020 6465 7363 3d64            desc=d
+00025ac0: 6573 632c 0a20 2020 2020 2020 2029 0a20  esc,.        ). 
+00025ad0: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+00025ae0: 6574 203d 2063 6f70 792e 6465 6570 636f  et = copy.deepco
+00025af0: 7079 2873 656c 6629 0a20 2020 2020 2020  py(self).       
+00025b00: 206e 6577 5f64 6174 6173 6574 2e5f 696e   new_dataset._in
+00025b10: 6469 6365 7320 3d20 696e 6469 6365 732e  dices = indices.
+00025b20: 6461 7461 0a20 2020 2020 2020 206e 6577  data.        new
+00025b30: 5f64 6174 6173 6574 2e5f 6669 6e67 6572  _dataset._finger
+00025b40: 7072 696e 7420 3d20 6e65 775f 6669 6e67  print = new_fing
+00025b50: 6572 7072 696e 740a 2020 2020 2020 2020  erprint.        
+00025b60: 7265 7475 726e 206e 6577 5f64 6174 6173  return new_datas
+00025b70: 6574 0a0a 2020 2020 4074 7261 6e73 6d69  et..    @transmi
+00025b80: 745f 666f 726d 6174 0a20 2020 2040 6669  t_format.    @fi
+00025b90: 6e67 6572 7072 696e 745f 7472 616e 7366  ngerprint_transf
+00025ba0: 6f72 6d28 696e 706c 6163 653d 4661 6c73  orm(inplace=Fals
+00025bb0: 652c 2069 676e 6f72 655f 6b77 6172 6773  e, ignore_kwargs
+00025bc0: 3d5b 2263 6163 6865 5f66 696c 655f 6e61  =["cache_file_na
+00025bd0: 6d65 225d 290a 2020 2020 6465 6620 666c  me"]).    def fl
+00025be0: 6174 7465 6e5f 696e 6469 6365 7328 0a20  atten_indices(. 
+00025bf0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00025c00: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
+00025c10: 6f72 793a 2062 6f6f 6c20 3d20 4661 6c73  ory: bool = Fals
+00025c20: 652c 0a20 2020 2020 2020 2063 6163 6865  e,.        cache
+00025c30: 5f66 696c 655f 6e61 6d65 3a20 4f70 7469  _file_name: Opti
+00025c40: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+00025c50: 2c0a 2020 2020 2020 2020 7772 6974 6572  ,.        writer
+00025c60: 5f62 6174 6368 5f73 697a 653a 204f 7074  _batch_size: Opt
+00025c70: 696f 6e61 6c5b 696e 745d 203d 2031 3030  ional[int] = 100
+00025c80: 302c 0a20 2020 2020 2020 2066 6561 7475  0,.        featu
+00025c90: 7265 733a 204f 7074 696f 6e61 6c5b 4665  res: Optional[Fe
+00025ca0: 6174 7572 6573 5d20 3d20 4e6f 6e65 2c0a  atures] = None,.
+00025cb0: 2020 2020 2020 2020 6469 7361 626c 655f          disable_
+00025cc0: 6e75 6c6c 6162 6c65 3a20 626f 6f6c 203d  nullable: bool =
+00025cd0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+00025ce0: 6e75 6d5f 7072 6f63 3a20 4f70 7469 6f6e  num_proc: Option
+00025cf0: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a  al[int] = None,.
+00025d00: 2020 2020 2020 2020 6e65 775f 6669 6e67          new_fing
+00025d10: 6572 7072 696e 743a 204f 7074 696f 6e61  erprint: Optiona
+00025d20: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
+00025d30: 2020 2029 202d 3e20 2244 6174 6173 6574     ) -> "Dataset
+00025d40: 223a 0a20 2020 2020 2020 2022 2222 4372  ":.        """Cr
+00025d50: 6561 7465 2061 6e64 2063 6163 6865 2061  eate and cache a
+00025d60: 206e 6577 2044 6174 6173 6574 2062 7920   new Dataset by 
+00025d70: 666c 6174 7465 6e69 6e67 2074 6865 2069  flattening the i
+00025d80: 6e64 6963 6573 206d 6170 7069 6e67 2e0a  ndices mapping..
+00025d90: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00025da0: 2020 2020 2020 2020 2020 206b 6565 705f             keep_
+00025db0: 696e 5f6d 656d 6f72 7920 2860 626f 6f6c  in_memory (`bool
+00025dc0: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
+00025dd0: 4661 6c73 6560 293a 0a20 2020 2020 2020  False`):.       
+00025de0: 2020 2020 2020 2020 204b 6565 7020 7468           Keep th
+00025df0: 6520 6461 7461 7365 7420 696e 206d 656d  e dataset in mem
+00025e00: 6f72 7920 696e 7374 6561 6420 6f66 2077  ory instead of w
+00025e10: 7269 7469 6e67 2069 7420 746f 2061 2063  riting it to a c
+00025e20: 6163 6865 2066 696c 652e 0a20 2020 2020  ache file..     
+00025e30: 2020 2020 2020 2063 6163 6865 5f66 696c         cache_fil
+00025e40: 655f 6e61 6d65 2028 6073 7472 602c 202a  e_name (`str`, *
+00025e50: 6f70 7469 6f6e 616c 2a2c 2064 6566 6175  optional*, defau
+00025e60: 6c74 2060 4e6f 6e65 6029 3a0a 2020 2020  lt `None`):.    
+00025e70: 2020 2020 2020 2020 2020 2020 5072 6f76              Prov
+00025e80: 6964 6520 7468 6520 6e61 6d65 206f 6620  ide the name of 
+00025e90: 6120 7061 7468 2066 6f72 2074 6865 2063  a path for the c
+00025ea0: 6163 6865 2066 696c 652e 2049 7420 6973  ache file. It is
+00025eb0: 2075 7365 6420 746f 2073 746f 7265 2074   used to store t
+00025ec0: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
+00025ed0: 2020 2072 6573 756c 7473 206f 6620 7468     results of th
+00025ee0: 6520 636f 6d70 7574 6174 696f 6e20 696e  e computation in
+00025ef0: 7374 6561 6420 6f66 2074 6865 2061 7574  stead of the aut
+00025f00: 6f6d 6174 6963 616c 6c79 2067 656e 6572  omatically gener
+00025f10: 6174 6564 2063 6163 6865 2066 696c 6520  ated cache file 
+00025f20: 6e61 6d65 2e0a 2020 2020 2020 2020 2020  name..          
+00025f30: 2020 7772 6974 6572 5f62 6174 6368 5f73    writer_batch_s
+00025f40: 697a 6520 2860 696e 7460 2c20 6465 6661  ize (`int`, defa
+00025f50: 756c 7473 2074 6f20 6031 3030 3060 293a  ults to `1000`):
+00025f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025f70: 204e 756d 6265 7220 6f66 2072 6f77 7320   Number of rows 
+00025f80: 7065 7220 7772 6974 6520 6f70 6572 6174  per write operat
+00025f90: 696f 6e20 666f 7220 7468 6520 6361 6368  ion for the cach
+00025fa0: 6520 6669 6c65 2077 7269 7465 722e 0a20  e file writer.. 
+00025fb0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+00025fc0: 6869 7320 7661 6c75 6520 6973 2061 2067  his value is a g
+00025fd0: 6f6f 6420 7472 6164 652d 6f66 6620 6265  ood trade-off be
+00025fe0: 7477 6565 6e20 6d65 6d6f 7279 2075 7361  tween memory usa
+00025ff0: 6765 2064 7572 696e 6720 7468 6520 7072  ge during the pr
+00026000: 6f63 6573 7369 6e67 2c20 616e 6420 7072  ocessing, and pr
+00026010: 6f63 6573 7369 6e67 2073 7065 6564 2e0a  ocessing speed..
+00026020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026030: 4869 6768 6572 2076 616c 7565 206d 616b  Higher value mak
+00026040: 6573 2074 6865 2070 726f 6365 7373 696e  es the processin
+00026050: 6720 646f 2066 6577 6572 206c 6f6f 6b75  g do fewer looku
+00026060: 7073 2c20 6c6f 7765 7220 7661 6c75 6520  ps, lower value 
+00026070: 636f 6e73 756d 6520 6c65 7373 2074 656d  consume less tem
+00026080: 706f 7261 7279 206d 656d 6f72 7920 7768  porary memory wh
+00026090: 696c 6520 7275 6e6e 696e 6720 606d 6170  ile running `map
+000260a0: 602e 0a20 2020 2020 2020 2020 2020 2066  `..            f
+000260b0: 6561 7475 7265 7320 2860 4f70 7469 6f6e  eatures (`Option
+000260c0: 616c 5b64 6174 6173 6574 732e 4665 6174  al[datasets.Feat
+000260d0: 7572 6573 5d60 2c20 6465 6661 756c 7473  ures]`, defaults
+000260e0: 2074 6f20 604e 6f6e 6560 293a 0a20 2020   to `None`):.   
+000260f0: 2020 2020 2020 2020 2020 2020 2055 7365               Use
+00026100: 2061 2073 7065 6369 6669 6320 5b60 4665   a specific [`Fe
+00026110: 6174 7572 6573 605d 2074 6f20 7374 6f72  atures`] to stor
+00026120: 6520 7468 6520 6361 6368 6520 6669 6c65  e the cache file
+00026130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026140: 2069 6e73 7465 6164 206f 6620 7468 6520   instead of the 
+00026150: 6175 746f 6d61 7469 6361 6c6c 7920 6765  automatically ge
+00026160: 6e65 7261 7465 6420 6f6e 652e 0a20 2020  nerated one..   
+00026170: 2020 2020 2020 2020 2064 6973 6162 6c65           disable
+00026180: 5f6e 756c 6c61 626c 6520 2860 626f 6f6c  _nullable (`bool
+00026190: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
+000261a0: 4661 6c73 6560 293a 0a20 2020 2020 2020  False`):.       
+000261b0: 2020 2020 2020 2020 2041 6c6c 6f77 206e           Allow n
+000261c0: 756c 6c20 7661 6c75 6573 2069 6e20 7468  ull values in th
+000261d0: 6520 7461 626c 652e 0a20 2020 2020 2020  e table..       
+000261e0: 2020 2020 206e 756d 5f70 726f 6320 2860       num_proc (`
+000261f0: 696e 7460 2c20 6f70 7469 6f6e 616c 2c20  int`, optional, 
+00026200: 6465 6661 756c 7420 604e 6f6e 6560 293a  default `None`):
+00026210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026220: 204d 6178 206e 756d 6265 7220 6f66 2070   Max number of p
+00026230: 726f 6365 7373 6573 2077 6865 6e20 6765  rocesses when ge
+00026240: 6e65 7261 7469 6e67 2063 6163 6865 2e20  nerating cache. 
+00026250: 416c 7265 6164 7920 6361 6368 6564 2073  Already cached s
+00026260: 6861 7264 7320 6172 6520 6c6f 6164 6564  hards are loaded
+00026270: 2073 6571 7565 6e74 6961 6c6c 790a 2020   sequentially.  
+00026280: 2020 2020 2020 2020 2020 6e65 775f 6669            new_fi
+00026290: 6e67 6572 7072 696e 7420 2860 7374 7260  ngerprint (`str`
+000262a0: 2c20 2a6f 7074 696f 6e61 6c2a 2c20 6465  , *optional*, de
+000262b0: 6661 756c 7473 2074 6f20 604e 6f6e 6560  faults to `None`
+000262c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000262d0: 2020 2054 6865 206e 6577 2066 696e 6765     The new finge
+000262e0: 7270 7269 6e74 206f 6620 7468 6520 6461  rprint of the da
+000262f0: 7461 7365 7420 6166 7465 7220 7472 616e  taset after tran
+00026300: 7366 6f72 6d2e 0a20 2020 2020 2020 2020  sform..         
+00026310: 2020 2020 2020 2049 6620 604e 6f6e 6560         If `None`
+00026320: 2c20 7468 6520 6e65 7720 6669 6e67 6572  , the new finger
+00026330: 7072 696e 7420 6973 2063 6f6d 7075 7465  print is compute
+00026340: 6420 7573 696e 6720 6120 6861 7368 206f  d using a hash o
+00026350: 6620 7468 6520 7072 6576 696f 7573 2066  f the previous f
+00026360: 696e 6765 7270 7269 6e74 2c20 616e 6420  ingerprint, and 
+00026370: 7468 6520 7472 616e 7366 6f72 6d20 6172  the transform ar
+00026380: 6775 6d65 6e74 730a 2020 2020 2020 2020  guments.        
+00026390: 2222 220a 0a20 2020 2020 2020 2072 6574  """..        ret
+000263a0: 7572 6e20 7365 6c66 2e6d 6170 280a 2020  urn self.map(.  
+000263b0: 2020 2020 2020 2020 2020 6261 7463 6865            batche
+000263c0: 643d 5472 7565 2c20 2023 2066 6f72 2073  d=True,  # for s
+000263d0: 7065 6564 0a20 2020 2020 2020 2020 2020  peed.           
+000263e0: 206b 6565 705f 696e 5f6d 656d 6f72 793d   keep_in_memory=
+000263f0: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 2c0a  keep_in_memory,.
+00026400: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+00026410: 655f 6669 6c65 5f6e 616d 653d 6361 6368  e_file_name=cach
+00026420: 655f 6669 6c65 5f6e 616d 652c 0a20 2020  e_file_name,.   
+00026430: 2020 2020 2020 2020 2077 7269 7465 725f           writer_
+00026440: 6261 7463 685f 7369 7a65 3d77 7269 7465  batch_size=write
+00026450: 725f 6261 7463 685f 7369 7a65 2c0a 2020  r_batch_size,.  
+00026460: 2020 2020 2020 2020 2020 6665 6174 7572            featur
+00026470: 6573 3d66 6561 7475 7265 732c 0a20 2020  es=features,.   
+00026480: 2020 2020 2020 2020 2064 6973 6162 6c65           disable
+00026490: 5f6e 756c 6c61 626c 653d 6469 7361 626c  _nullable=disabl
+000264a0: 655f 6e75 6c6c 6162 6c65 2c0a 2020 2020  e_nullable,.    
+000264b0: 2020 2020 2020 2020 6e65 775f 6669 6e67          new_fing
+000264c0: 6572 7072 696e 743d 6e65 775f 6669 6e67  erprint=new_fing
+000264d0: 6572 7072 696e 742c 0a20 2020 2020 2020  erprint,.       
+000264e0: 2020 2020 2064 6573 633d 2246 6c61 7474       desc="Flatt
+000264f0: 656e 696e 6720 7468 6520 696e 6469 6365  ening the indice
+00026500: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+00026510: 6e75 6d5f 7072 6f63 3d6e 756d 5f70 726f  num_proc=num_pro
+00026520: 632c 0a20 2020 2020 2020 2029 0a0a 2020  c,.        )..  
+00026530: 2020 6465 6620 5f6e 6577 5f64 6174 6173    def _new_datas
+00026540: 6574 5f77 6974 685f 696e 6469 6365 7328  et_with_indices(
+00026550: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00026560: 2020 2020 2020 2069 6e64 6963 6573 5f63         indices_c
+00026570: 6163 6865 5f66 696c 655f 6e61 6d65 3a20  ache_file_name: 
+00026580: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00026590: 4e6f 6e65 2c0a 2020 2020 2020 2020 696e  None,.        in
+000265a0: 6469 6365 735f 6275 6666 6572 3a20 4f70  dices_buffer: Op
+000265b0: 7469 6f6e 616c 5b70 612e 4275 6666 6572  tional[pa.Buffer
+000265c0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+000265d0: 2020 6669 6e67 6572 7072 696e 743a 204f    fingerprint: O
+000265e0: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+000265f0: 6f6e 652c 0a20 2020 2029 202d 3e20 2244  one,.    ) -> "D
+00026600: 6174 6173 6574 223a 0a20 2020 2020 2020  ataset":.       
+00026610: 2022 2222 5265 7475 726e 2061 206e 6577   """Return a new
+00026620: 2044 6174 6173 6574 206f 6274 6169 6e65   Dataset obtaine
+00026630: 6420 6279 2061 6464 696e 6720 696e 6469  d by adding indi
+00026640: 6365 7320 2870 726f 7669 6465 6420 696e  ces (provided in
+00026650: 2069 6e64 6963 6573 5f63 6163 6865 5f66   indices_cache_f
+00026660: 696c 655f 6e61 6d65 206f 7220 696e 2061  ile_name or in a
+00026670: 2062 7566 6665 7229 2074 6f20 7468 650a   buffer) to the.
+00026680: 2020 2020 2020 2020 6375 7272 656e 7420          current 
+00026690: 4461 7461 7365 742e 0a20 2020 2020 2020  Dataset..       
+000266a0: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
+000266b0: 2069 6e64 6963 6573 5f63 6163 6865 5f66   indices_cache_f
+000266c0: 696c 655f 6e61 6d65 2069 7320 4e6f 6e65  ile_name is None
+000266d0: 2061 6e64 2069 6e64 6963 6573 5f62 7566   and indices_buf
+000266e0: 6665 7220 6973 204e 6f6e 653a 0a20 2020  fer is None:.   
+000266f0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00026700: 616c 7565 4572 726f 7228 2241 7420 6c65  alueError("At le
+00026710: 6173 7420 6f6e 6520 6f66 2069 6e64 6963  ast one of indic
+00026720: 6573 5f63 6163 6865 5f66 696c 655f 6e61  es_cache_file_na
+00026730: 6d65 206f 7220 696e 6469 6365 735f 6275  me or indices_bu
+00026740: 6666 6572 206d 7573 7420 6265 2070 726f  ffer must be pro
+00026750: 7669 6465 642e 2229 0a0a 2020 2020 2020  vided.")..      
+00026760: 2020 6966 2066 696e 6765 7270 7269 6e74    if fingerprint
+00026770: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00026780: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00026790: 6545 7272 6f72 2822 706c 6561 7365 2073  eError("please s
+000267a0: 7065 6369 6679 2061 2066 696e 6765 7270  pecify a fingerp
+000267b0: 7269 6e74 2066 6f72 2074 6865 2064 6174  rint for the dat
+000267c0: 6173 6574 2077 6974 6820 696e 6469 6365  aset with indice
+000267d0: 7322 290a 0a20 2020 2020 2020 2069 6620  s")..        if 
+000267e0: 696e 6469 6365 735f 6361 6368 655f 6669  indices_cache_fi
+000267f0: 6c65 5f6e 616d 6520 6973 206e 6f74 204e  le_name is not N
+00026800: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00026810: 2069 6e64 6963 6573 5f74 6162 6c65 203d   indices_table =
+00026820: 204d 656d 6f72 794d 6170 7065 6454 6162   MemoryMappedTab
+00026830: 6c65 2e66 726f 6d5f 6669 6c65 2869 6e64  le.from_file(ind
+00026840: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
+00026850: 6e61 6d65 290a 2020 2020 2020 2020 656c  name).        el
+00026860: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00026870: 696e 6469 6365 735f 7461 626c 6520 3d20  indices_table = 
+00026880: 496e 4d65 6d6f 7279 5461 626c 652e 6672  InMemoryTable.fr
+00026890: 6f6d 5f62 7566 6665 7228 696e 6469 6365  om_buffer(indice
+000268a0: 735f 6275 6666 6572 290a 0a20 2020 2020  s_buffer)..     
+000268b0: 2020 2023 2052 6574 7572 6e20 6e65 7720     # Return new 
+000268c0: 4461 7461 7365 7420 6f62 6a65 6374 0a20  Dataset object. 
+000268d0: 2020 2020 2020 2023 2064 6f6e 2774 2066         # don't f
+000268e0: 6f72 6765 7420 746f 2063 6f70 7920 7468  orget to copy th
+000268f0: 6520 6f62 6a65 6374 730a 2020 2020 2020  e objects.      
+00026900: 2020 7265 7475 726e 2044 6174 6173 6574    return Dataset
+00026910: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00026920: 6c66 2e5f 6461 7461 2c0a 2020 2020 2020  lf._data,.      
+00026930: 2020 2020 2020 696e 666f 3d73 656c 662e        info=self.
+00026940: 696e 666f 2e63 6f70 7928 292c 0a20 2020  info.copy(),.   
+00026950: 2020 2020 2020 2020 2073 706c 6974 3d73           split=s
+00026960: 656c 662e 7370 6c69 742c 0a20 2020 2020  elf.split,.     
+00026970: 2020 2020 2020 2069 6e64 6963 6573 5f74         indices_t
+00026980: 6162 6c65 3d69 6e64 6963 6573 5f74 6162  able=indices_tab
+00026990: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+000269a0: 6669 6e67 6572 7072 696e 743d 6669 6e67  fingerprint=fing
+000269b0: 6572 7072 696e 742c 0a20 2020 2020 2020  erprint,.       
+000269c0: 2029 0a0a 2020 2020 4074 7261 6e73 6d69   )..    @transmi
+000269d0: 745f 666f 726d 6174 0a20 2020 2040 6669  t_format.    @fi
+000269e0: 6e67 6572 7072 696e 745f 7472 616e 7366  ngerprint_transf
+000269f0: 6f72 6d28 696e 706c 6163 653d 4661 6c73  orm(inplace=Fals
+00026a00: 652c 2069 676e 6f72 655f 6b77 6172 6773  e, ignore_kwargs
+00026a10: 3d5b 2269 6e64 6963 6573 5f63 6163 6865  =["indices_cache
+00026a20: 5f66 696c 655f 6e61 6d65 225d 290a 2020  _file_name"]).  
+00026a30: 2020 6465 6620 7365 6c65 6374 280a 2020    def select(.  
+00026a40: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00026a50: 2020 2020 696e 6469 6365 733a 2049 7465      indices: Ite
+00026a60: 7261 626c 652c 0a20 2020 2020 2020 206b  rable,.        k
+00026a70: 6565 705f 696e 5f6d 656d 6f72 793a 2062  eep_in_memory: b
+00026a80: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+00026a90: 2020 2020 2069 6e64 6963 6573 5f63 6163       indices_cac
+00026aa0: 6865 5f66 696c 655f 6e61 6d65 3a20 4f70  he_file_name: Op
+00026ab0: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+00026ac0: 6e65 2c0a 2020 2020 2020 2020 7772 6974  ne,.        writ
+00026ad0: 6572 5f62 6174 6368 5f73 697a 653a 204f  er_batch_size: O
+00026ae0: 7074 696f 6e61 6c5b 696e 745d 203d 2031  ptional[int] = 1
+00026af0: 3030 302c 0a20 2020 2020 2020 206e 6577  000,.        new
+00026b00: 5f66 696e 6765 7270 7269 6e74 3a20 4f70  _fingerprint: Op
+00026b10: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+00026b20: 6e65 2c0a 2020 2020 2920 2d3e 2022 4461  ne,.    ) -> "Da
+00026b30: 7461 7365 7422 3a0a 2020 2020 2020 2020  taset":.        
+00026b40: 2222 2243 7265 6174 6520 6120 6e65 7720  """Create a new 
+00026b50: 6461 7461 7365 7420 7769 7468 2072 6f77  dataset with row
+00026b60: 7320 7365 6c65 6374 6564 2066 6f6c 6c6f  s selected follo
+00026b70: 7769 6e67 2074 6865 206c 6973 742f 6172  wing the list/ar
+00026b80: 7261 7920 6f66 2069 6e64 6963 6573 2e0a  ray of indices..
+00026b90: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00026ba0: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
+00026bb0: 6573 2028 6072 616e 6765 602c 2060 6c69  es (`range`, `li
+00026bc0: 7374 602c 2060 6974 6572 6162 6c65 602c  st`, `iterable`,
+00026bd0: 2060 6e64 6172 7261 7960 206f 7220 6053   `ndarray` or `S
+00026be0: 6572 6965 7360 293a 0a20 2020 2020 2020  eries`):.       
+00026bf0: 2020 2020 2020 2020 2052 616e 6765 2c20           Range, 
+00026c00: 6c69 7374 206f 7220 3144 2d61 7272 6179  list or 1D-array
+00026c10: 206f 6620 696e 7465 6765 7220 696e 6469   of integer indi
+00026c20: 6365 7320 666f 7220 696e 6465 7869 6e67  ces for indexing
+00026c30: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00026c40: 2020 4966 2074 6865 2069 6e64 6963 6573    If the indices
+00026c50: 2063 6f72 7265 7370 6f6e 6420 746f 2061   correspond to a
+00026c60: 2063 6f6e 7469 6775 6f75 7320 7261 6e67   contiguous rang
+00026c70: 652c 2074 6865 2041 7272 6f77 2074 6162  e, the Arrow tab
+00026c80: 6c65 2069 7320 7369 6d70 6c79 2073 6c69  le is simply sli
+00026c90: 6365 642e 0a20 2020 2020 2020 2020 2020  ced..           
+00026ca0: 2020 2020 2048 6f77 6576 6572 2070 6173       However pas
+00026cb0: 7369 6e67 2061 206c 6973 7420 6f66 2069  sing a list of i
+00026cc0: 6e64 6963 6573 2074 6861 7420 6172 6520  ndices that are 
+00026cd0: 6e6f 7420 636f 6e74 6967 756f 7573 2063  not contiguous c
+00026ce0: 7265 6174 6573 2069 6e64 6963 6573 206d  reates indices m
+00026cf0: 6170 7069 6e67 2c20 7768 6963 6820 6973  apping, which is
+00026d00: 206d 7563 6820 6c65 7373 2065 6666 6963   much less effic
+00026d10: 6965 6e74 2c0a 2020 2020 2020 2020 2020  ient,.          
+00026d20: 2020 2020 2020 6275 7420 7374 696c 6c20        but still 
+00026d30: 6661 7374 6572 2074 6861 6e20 7265 6372  faster than recr
+00026d40: 6561 7469 6e67 2061 6e20 4172 726f 7720  eating an Arrow 
+00026d50: 7461 626c 6520 6d61 6465 206f 6620 7468  table made of th
+00026d60: 6520 7265 7175 6573 7465 6420 726f 7773  e requested rows
+00026d70: 2e0a 2020 2020 2020 2020 2020 2020 6b65  ..            ke
+00026d80: 6570 5f69 6e5f 6d65 6d6f 7279 2028 6062  ep_in_memory (`b
+00026d90: 6f6f 6c60 2c20 6465 6661 756c 7473 2074  ool`, defaults t
+00026da0: 6f20 6046 616c 7365 6029 3a0a 2020 2020  o `False`):.    
+00026db0: 2020 2020 2020 2020 2020 2020 4b65 6570              Keep
+00026dc0: 2074 6865 2069 6e64 6963 6573 206d 6170   the indices map
+00026dd0: 7069 6e67 2069 6e20 6d65 6d6f 7279 2069  ping in memory i
+00026de0: 6e73 7465 6164 206f 6620 7772 6974 696e  nstead of writin
+00026df0: 6720 6974 2074 6f20 6120 6361 6368 6520  g it to a cache 
+00026e00: 6669 6c65 2e0a 2020 2020 2020 2020 2020  file..          
+00026e10: 2020 696e 6469 6365 735f 6361 6368 655f    indices_cache_
+00026e20: 6669 6c65 5f6e 616d 6520 2860 7374 7260  file_name (`str`
+00026e30: 2c20 2a6f 7074 696f 6e61 6c2a 2c20 6465  , *optional*, de
+00026e40: 6661 756c 7473 2074 6f20 604e 6f6e 6560  faults to `None`
+00026e50: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00026e60: 2020 2050 726f 7669 6465 2074 6865 206e     Provide the n
+00026e70: 616d 6520 6f66 2061 2070 6174 6820 666f  ame of a path fo
+00026e80: 7220 7468 6520 6361 6368 6520 6669 6c65  r the cache file
+00026e90: 2e20 4974 2069 7320 7573 6564 2074 6f20  . It is used to 
+00026ea0: 7374 6f72 6520 7468 650a 2020 2020 2020  store the.      
+00026eb0: 2020 2020 2020 2020 2020 696e 6469 6365            indice
+00026ec0: 7320 6d61 7070 696e 6720 696e 7374 6561  s mapping instea
+00026ed0: 6420 6f66 2074 6865 2061 7574 6f6d 6174  d of the automat
+00026ee0: 6963 616c 6c79 2067 656e 6572 6174 6564  ically generated
+00026ef0: 2063 6163 6865 2066 696c 6520 6e61 6d65   cache file name
+00026f00: 2e0a 2020 2020 2020 2020 2020 2020 7772  ..            wr
+00026f10: 6974 6572 5f62 6174 6368 5f73 697a 6520  iter_batch_size 
+00026f20: 2860 696e 7460 2c20 6465 6661 756c 7473  (`int`, defaults
+00026f30: 2074 6f20 6031 3030 3060 293a 0a20 2020   to `1000`):.   
+00026f40: 2020 2020 2020 2020 2020 2020 204e 756d               Num
+00026f50: 6265 7220 6f66 2072 6f77 7320 7065 7220  ber of rows per 
+00026f60: 7772 6974 6520 6f70 6572 6174 696f 6e20  write operation 
+00026f70: 666f 7220 7468 6520 6361 6368 6520 6669  for the cache fi
+00026f80: 6c65 2077 7269 7465 722e 0a20 2020 2020  le writer..     
+00026f90: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+00026fa0: 7661 6c75 6520 6973 2061 2067 6f6f 6420  value is a good 
+00026fb0: 7472 6164 652d 6f66 6620 6265 7477 6565  trade-off betwee
+00026fc0: 6e20 6d65 6d6f 7279 2075 7361 6765 2064  n memory usage d
+00026fd0: 7572 696e 6720 7468 6520 7072 6f63 6573  uring the proces
+00026fe0: 7369 6e67 2c20 616e 6420 7072 6f63 6573  sing, and proces
+00026ff0: 7369 6e67 2073 7065 6564 2e0a 2020 2020  sing speed..    
+00027000: 2020 2020 2020 2020 2020 2020 4869 6768              High
+00027010: 6572 2076 616c 7565 206d 616b 6573 2074  er value makes t
+00027020: 6865 2070 726f 6365 7373 696e 6720 646f  he processing do
+00027030: 2066 6577 6572 206c 6f6f 6b75 7073 2c20   fewer lookups, 
+00027040: 6c6f 7765 7220 7661 6c75 6520 636f 6e73  lower value cons
+00027050: 756d 6520 6c65 7373 2074 656d 706f 7261  ume less tempora
+00027060: 7279 206d 656d 6f72 7920 7768 696c 6520  ry memory while 
+00027070: 7275 6e6e 696e 6720 606d 6170 602e 0a20  running `map`.. 
+00027080: 2020 2020 2020 2020 2020 206e 6577 5f66             new_f
+00027090: 696e 6765 7270 7269 6e74 2028 6073 7472  ingerprint (`str
+000270a0: 602c 202a 6f70 7469 6f6e 616c 2a2c 2064  `, *optional*, d
+000270b0: 6566 6175 6c74 7320 746f 2060 4e6f 6e65  efaults to `None
+000270c0: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
+000270d0: 2020 2020 5468 6520 6e65 7720 6669 6e67      The new fing
+000270e0: 6572 7072 696e 7420 6f66 2074 6865 2064  erprint of the d
+000270f0: 6174 6173 6574 2061 6674 6572 2074 7261  ataset after tra
+00027100: 6e73 666f 726d 2e0a 2020 2020 2020 2020  nsform..        
+00027110: 2020 2020 2020 2020 4966 2060 4e6f 6e65          If `None
+00027120: 602c 2074 6865 206e 6577 2066 696e 6765  `, the new finge
+00027130: 7270 7269 6e74 2069 7320 636f 6d70 7574  rprint is comput
+00027140: 6564 2075 7369 6e67 2061 2068 6173 6820  ed using a hash 
+00027150: 6f66 2074 6865 2070 7265 7669 6f75 7320  of the previous 
+00027160: 6669 6e67 6572 7072 696e 742c 2061 6e64  fingerprint, and
+00027170: 2074 6865 2074 7261 6e73 666f 726d 2061   the transform a
+00027180: 7267 756d 656e 7473 2e0a 0a20 2020 2020  rguments...     
+00027190: 2020 2045 7861 6d70 6c65 3a0a 0a20 2020     Example:..   
+000271a0: 2020 2020 2060 6060 7079 0a20 2020 2020       ```py.     
+000271b0: 2020 203e 3e3e 2066 726f 6d20 6461 7461     >>> from data
+000271c0: 7365 7473 2069 6d70 6f72 7420 6c6f 6164  sets import load
+000271d0: 5f64 6174 6173 6574 0a20 2020 2020 2020  _dataset.       
+000271e0: 203e 3e3e 2064 7320 3d20 6c6f 6164 5f64   >>> ds = load_d
+000271f0: 6174 6173 6574 2822 726f 7474 656e 5f74  ataset("rotten_t
+00027200: 6f6d 6174 6f65 7322 2c20 7370 6c69 743d  omatoes", split=
+00027210: 2276 616c 6964 6174 696f 6e22 290a 2020  "validation").  
+00027220: 2020 2020 2020 3e3e 3e20 6473 2e73 656c        >>> ds.sel
+00027230: 6563 7428 7261 6e67 6528 3429 290a 2020  ect(range(4)).  
+00027240: 2020 2020 2020 4461 7461 7365 7428 7b0a        Dataset({.
+00027250: 2020 2020 2020 2020 2020 2020 6665 6174              feat
+00027260: 7572 6573 3a20 5b27 7465 7874 272c 2027  ures: ['text', '
+00027270: 6c61 6265 6c27 5d2c 0a20 2020 2020 2020  label'],.       
+00027280: 2020 2020 206e 756d 5f72 6f77 733a 2034       num_rows: 4
+00027290: 0a20 2020 2020 2020 207d 290a 2020 2020  .        }).    
+000272a0: 2020 2020 6060 600a 2020 2020 2020 2020      ```.        
+000272b0: 2222 220a 2020 2020 2020 2020 6966 206b  """.        if k
+000272c0: 6565 705f 696e 5f6d 656d 6f72 7920 616e  eep_in_memory an
+000272d0: 6420 696e 6469 6365 735f 6361 6368 655f  d indices_cache_
+000272e0: 6669 6c65 5f6e 616d 6520 6973 206e 6f74  file_name is not
+000272f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00027300: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00027310: 726f 7228 2250 6c65 6173 6520 7573 6520  ror("Please use 
+00027320: 6569 7468 6572 2060 6b65 6570 5f69 6e5f  either `keep_in_
+00027330: 6d65 6d6f 7279 6020 6f72 2060 696e 6469  memory` or `indi
+00027340: 6365 735f 6361 6368 655f 6669 6c65 5f6e  ces_cache_file_n
+00027350: 616d 6560 2062 7574 206e 6f74 2062 6f74  ame` but not bot
+00027360: 682e 2229 0a0a 2020 2020 2020 2020 6966  h.")..        if
+00027370: 206c 656e 2873 656c 662e 6c69 7374 5f69   len(self.list_i
+00027380: 6e64 6578 6573 2829 2920 3e20 303a 0a20  ndexes()) > 0:. 
+00027390: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000273a0: 2044 6174 6173 6574 5472 616e 7366 6f72   DatasetTransfor
+000273b0: 6d61 7469 6f6e 4e6f 7441 6c6c 6f77 6564  mationNotAllowed
+000273c0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+000273d0: 2020 2020 2020 2022 5573 696e 6720 602e         "Using `.
+000273e0: 7365 6c65 6374 6020 6f6e 2061 2064 6174  select` on a dat
+000273f0: 6173 6574 2077 6974 6820 6174 7461 6368  aset with attach
+00027400: 6564 2069 6e64 6578 6573 2069 7320 6e6f  ed indexes is no
+00027410: 7420 616c 6c6f 7765 642e 2059 6f75 2063  t allowed. You c
+00027420: 616e 2066 6972 7374 2072 756e 2060 2e64  an first run `.d
+00027430: 726f 705f 696e 6465 7828 2920 746f 2072  rop_index() to r
+00027440: 656d 6f76 6520 796f 7572 2069 6e64 6578  emove your index
+00027450: 2061 6e64 2074 6865 6e20 7265 2d61 6464   and then re-add
+00027460: 2069 742e 220a 2020 2020 2020 2020 2020   it.".          
+00027470: 2020 290a 0a20 2020 2020 2020 2023 2049    )..        # I
+00027480: 6620 7468 6520 6172 7261 7920 6973 2065  f the array is e
+00027490: 6d70 7479 2077 6520 646f 206e 6f74 6869  mpty we do nothi
+000274a0: 6e67 0a20 2020 2020 2020 2069 6620 6c65  ng.        if le
+000274b0: 6e28 7365 6c66 2920 3d3d 2030 3a0a 2020  n(self) == 0:.  
+000274c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000274d0: 2073 656c 660a 0a20 2020 2020 2020 2023   self..        #
+000274e0: 2043 6f6e 7665 7274 2067 656e 6572 6174   Convert generat
+000274f0: 6f72 206f 626a 6563 7473 2074 6f20 6c69  or objects to li
+00027500: 7374 730a 2020 2020 2020 2020 6966 2069  sts.        if i
+00027510: 7369 6e73 7461 6e63 6528 696e 6469 6365  sinstance(indice
+00027520: 732c 2049 7465 7261 746f 7229 3a0a 2020  s, Iterator):.  
+00027530: 2020 2020 2020 2020 2020 696e 6469 6365            indice
+00027540: 7320 3d20 6c69 7374 2869 6e64 6963 6573  s = list(indices
+00027550: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
+00027560: 7468 6520 696e 6469 6365 7320 6172 6520  the indices are 
+00027570: 636f 6e74 6967 756f 7573 2c20 7369 6d70  contiguous, simp
+00027580: 6c79 2073 6c69 6365 2074 6865 2061 7272  ly slice the arr
+00027590: 6f77 2074 6162 6c65 0a20 2020 2020 2020  ow table.       
+000275a0: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
+000275b0: 6e64 6963 6573 2c20 7261 6e67 6529 3a0a  ndices, range):.
+000275c0: 2020 2020 2020 2020 2020 2020 6966 205f              if _
+000275d0: 6973 5f72 616e 6765 5f63 6f6e 7469 6775  is_range_contigu
+000275e0: 6f75 7328 696e 6469 6365 7329 2061 6e64  ous(indices) and
+000275f0: 2069 6e64 6963 6573 2e73 7461 7274 203e   indices.start >
+00027600: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00027610: 2020 2020 2073 7461 7274 2c20 6c65 6e67       start, leng
+00027620: 7468 203d 2069 6e64 6963 6573 2e73 7461  th = indices.sta
+00027630: 7274 2c20 696e 6469 6365 732e 7374 6f70  rt, indices.stop
+00027640: 202d 2069 6e64 6963 6573 2e73 7461 7274   - indices.start
+00027650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027660: 2072 6574 7572 6e20 7365 6c66 2e5f 7365   return self._se
+00027670: 6c65 6374 5f63 6f6e 7469 6775 6f75 7328  lect_contiguous(
+00027680: 7374 6172 742c 206c 656e 6774 682c 206e  start, length, n
+00027690: 6577 5f66 696e 6765 7270 7269 6e74 3d6e  ew_fingerprint=n
+000276a0: 6577 5f66 696e 6765 7270 7269 6e74 290a  ew_fingerprint).
+000276b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000276c0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+000276d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000276e0: 7461 7274 203d 206e 6578 7428 6974 6572  tart = next(iter
+000276f0: 2869 6e64 6963 6573 2929 0a20 2020 2020  (indices)).     
+00027700: 2020 2020 2020 2065 7863 6570 7420 5374         except St
+00027710: 6f70 4974 6572 6174 696f 6e3a 0a20 2020  opIteration:.   
+00027720: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00027730: 6620 6069 6e64 6963 6573 6020 6973 2061  f `indices` is a
+00027740: 6e20 656d 7074 7920 6974 6572 6162 6c65  n empty iterable
+00027750: 2c20 7765 2072 6574 7572 6e20 616e 2065  , we return an e
+00027760: 6d70 7479 2064 6174 6173 6574 0a20 2020  mpty dataset.   
+00027770: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00027780: 7572 6e20 7365 6c66 2e5f 7365 6c65 6374  urn self._select
+00027790: 5f63 6f6e 7469 6775 6f75 7328 302c 2030  _contiguous(0, 0
+000277a0: 2c20 6e65 775f 6669 6e67 6572 7072 696e  , new_fingerprin
+000277b0: 743d 6e65 775f 6669 6e67 6572 7072 696e  t=new_fingerprin
+000277c0: 7429 0a20 2020 2020 2020 2020 2020 2069  t).            i
+000277d0: 6620 7374 6172 7420 3e3d 2030 3a0a 2020  f start >= 0:.  
+000277e0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000277f0: 756e 7465 725f 6672 6f6d 5f73 7461 7274  unter_from_start
+00027800: 203d 2069 7465 7274 6f6f 6c73 2e63 6f75   = itertools.cou
+00027810: 6e74 2873 7461 7274 3d73 7461 7274 290a  nt(start=start).
+00027820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027830: 6966 2061 6c6c 2869 203d 3d20 6a20 666f  if all(i == j fo
+00027840: 7220 692c 206a 2069 6e20 7a69 7028 696e  r i, j in zip(in
+00027850: 6469 6365 732c 2063 6f75 6e74 6572 5f66  dices, counter_f
+00027860: 726f 6d5f 7374 6172 7429 293a 0a20 2020  rom_start)):.   
+00027870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027880: 206c 656e 6774 6820 3d20 6e65 7874 2863   length = next(c
+00027890: 6f75 6e74 6572 5f66 726f 6d5f 7374 6172  ounter_from_star
+000278a0: 7429 202d 2073 7461 7274 0a20 2020 2020  t) - start.     
+000278b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000278c0: 6574 7572 6e20 7365 6c66 2e5f 7365 6c65  eturn self._sele
+000278d0: 6374 5f63 6f6e 7469 6775 6f75 7328 7374  ct_contiguous(st
+000278e0: 6172 742c 206c 656e 6774 682c 206e 6577  art, length, new
+000278f0: 5f66 696e 6765 7270 7269 6e74 3d6e 6577  _fingerprint=new
+00027900: 5f66 696e 6765 7270 7269 6e74 290a 0a20  _fingerprint).. 
+00027910: 2020 2020 2020 2023 2049 6620 6e6f 7420         # If not 
+00027920: 636f 6e74 6967 756f 7573 2c20 7765 206e  contiguous, we n
+00027930: 6565 6420 746f 2063 7265 6174 6520 6120  eed to create a 
+00027940: 6e65 7720 696e 6469 6365 7320 6d61 7070  new indices mapp
+00027950: 696e 670a 2020 2020 2020 2020 7265 7475  ing.        retu
+00027960: 726e 2073 656c 662e 5f73 656c 6563 745f  rn self._select_
+00027970: 7769 7468 5f69 6e64 6963 6573 5f6d 6170  with_indices_map
+00027980: 7069 6e67 280a 2020 2020 2020 2020 2020  ping(.          
+00027990: 2020 696e 6469 6365 732c 0a20 2020 2020    indices,.     
+000279a0: 2020 2020 2020 206b 6565 705f 696e 5f6d         keep_in_m
+000279b0: 656d 6f72 793d 6b65 6570 5f69 6e5f 6d65  emory=keep_in_me
+000279c0: 6d6f 7279 2c0a 2020 2020 2020 2020 2020  mory,.          
+000279d0: 2020 696e 6469 6365 735f 6361 6368 655f    indices_cache_
+000279e0: 6669 6c65 5f6e 616d 653d 696e 6469 6365  file_name=indice
+000279f0: 735f 6361 6368 655f 6669 6c65 5f6e 616d  s_cache_file_nam
+00027a00: 652c 0a20 2020 2020 2020 2020 2020 2077  e,.            w
+00027a10: 7269 7465 725f 6261 7463 685f 7369 7a65  riter_batch_size
+00027a20: 3d77 7269 7465 725f 6261 7463 685f 7369  =writer_batch_si
+00027a30: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
+00027a40: 6e65 775f 6669 6e67 6572 7072 696e 743d  new_fingerprint=
+00027a50: 6e65 775f 6669 6e67 6572 7072 696e 742c  new_fingerprint,
+00027a60: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00027a70: 4074 7261 6e73 6d69 745f 666f 726d 6174  @transmit_format
+00027a80: 0a20 2020 2040 6669 6e67 6572 7072 696e  .    @fingerprin
+00027a90: 745f 7472 616e 7366 6f72 6d28 696e 706c  t_transform(inpl
+00027aa0: 6163 653d 4661 6c73 6529 0a20 2020 2064  ace=False).    d
+00027ab0: 6566 205f 7365 6c65 6374 5f63 6f6e 7469  ef _select_conti
+00027ac0: 6775 6f75 7328 0a20 2020 2020 2020 2073  guous(.        s
+00027ad0: 656c 662c 0a20 2020 2020 2020 2073 7461  elf,.        sta
+00027ae0: 7274 3a20 696e 742c 0a20 2020 2020 2020  rt: int,.       
+00027af0: 206c 656e 6774 683a 2069 6e74 2c0a 2020   length: int,.  
+00027b00: 2020 2020 2020 6e65 775f 6669 6e67 6572        new_finger
+00027b10: 7072 696e 743a 204f 7074 696f 6e61 6c5b  print: Optional[
+00027b20: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00027b30: 2029 202d 3e20 2244 6174 6173 6574 223a   ) -> "Dataset":
+00027b40: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
+00027b50: 7465 2061 206e 6577 2064 6174 6173 6574  te a new dataset
+00027b60: 2077 6974 6820 726f 7773 2066 726f 6d20   with rows from 
+00027b70: 6120 636f 6e74 6967 756f 7573 2073 6c69  a contiguous sli
+00027b80: 6365 206f 6620 6461 7461 2e0a 2020 2020  ce of data..    
+00027b90: 2020 2020 5468 6520 736c 6963 6520 6973      The slice is
+00027ba0: 2064 6566 696e 6564 2062 7920 7468 6174   defined by that
+00027bb0: 2073 7461 7274 2069 6e64 6578 2061 6e64   start index and
+00027bc0: 2069 7473 206c 656e 6774 682e 0a0a 2020   its length...  
+00027bd0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+00027be0: 2020 2020 2020 2020 7374 6172 7420 2860          start (`
+00027bf0: 696e 7460 293a 2073 7461 7274 2069 6e64  int`): start ind
+00027c00: 6578 2e0a 2020 2020 2020 2020 2020 2020  ex..            
+00027c10: 6c65 6e67 7468 2028 6069 6e74 6029 3a20  length (`int`): 
+00027c20: 6c65 6e67 7468 206f 6620 7468 6520 736c  length of the sl
+00027c30: 6963 6520 746f 2073 656c 6563 742e 0a20  ice to select.. 
+00027c40: 2020 2020 2020 2020 2020 206e 6577 5f66             new_f
+00027c50: 696e 6765 7270 7269 6e74 2028 6073 7472  ingerprint (`str
+00027c60: 602c 206f 7074 696f 6e61 6c2c 2064 6566  `, optional, def
+00027c70: 6175 6c74 2060 4e6f 6e65 6029 3a20 7468  ault `None`): th
+00027c80: 6520 6e65 7720 6669 6e67 6572 7072 696e  e new fingerprin
+00027c90: 7420 6f66 2074 6865 2064 6174 6173 6574  t of the dataset
+00027ca0: 2061 6674 6572 2074 7261 6e73 666f 726d   after transform
+00027cb0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00027cc0: 2020 4966 2060 4e6f 6e65 602c 2074 6865    If `None`, the
+00027cd0: 206e 6577 2066 696e 6765 7270 7269 6e74   new fingerprint
+00027ce0: 2069 7320 636f 6d70 7574 6564 2075 7369   is computed usi
+00027cf0: 6e67 2061 2068 6173 6820 6f66 2074 6865  ng a hash of the
+00027d00: 2070 7265 7669 6f75 7320 6669 6e67 6572   previous finger
+00027d10: 7072 696e 742c 2061 6e64 2074 6865 2074  print, and the t
+00027d20: 7261 6e73 666f 726d 2061 7267 756d 656e  ransform argumen
+00027d30: 7473 0a0a 2020 2020 2020 2020 4578 616d  ts..        Exam
+00027d40: 706c 653a 0a0a 2020 2020 2020 2020 6060  ple:..        ``
+00027d50: 6070 790a 2020 2020 2020 2020 3e3e 3e20  `py.        >>> 
+00027d60: 6672 6f6d 2064 6174 6173 6574 7320 696d  from datasets im
+00027d70: 706f 7274 206c 6f61 645f 6461 7461 7365  port load_datase
+00027d80: 740a 2020 2020 2020 2020 3e3e 3e20 6473  t.        >>> ds
+00027d90: 203d 206c 6f61 645f 6461 7461 7365 7428   = load_dataset(
+00027da0: 2272 6f74 7465 6e5f 746f 6d61 746f 6573  "rotten_tomatoes
+00027db0: 222c 2073 706c 6974 3d22 7661 6c69 6461  ", split="valida
+00027dc0: 7469 6f6e 2229 0a20 2020 2020 2020 203e  tion").        >
+00027dd0: 3e3e 2064 732e 5f73 656c 6563 745f 636f  >> ds._select_co
+00027de0: 6e74 6967 756f 7573 2830 2c20 3429 0a20  ntiguous(0, 4). 
+00027df0: 2020 2020 2020 2044 6174 6173 6574 287b         Dataset({
+00027e00: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
+00027e10: 7475 7265 733a 205b 2774 6578 7427 2c20  tures: ['text', 
+00027e20: 276c 6162 656c 275d 2c0a 2020 2020 2020  'label'],.      
+00027e30: 2020 2020 2020 6e75 6d5f 726f 7773 3a20        num_rows: 
+00027e40: 340a 2020 2020 2020 2020 7d29 0a20 2020  4.        }).   
+00027e50: 2020 2020 2060 6060 0a20 2020 2020 2020       ```.       
+00027e60: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00027e70: 6c65 6e28 7365 6c66 2e6c 6973 745f 696e  len(self.list_in
+00027e80: 6465 7865 7328 2929 203e 2030 3a0a 2020  dexes()) > 0:.  
+00027e90: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00027ea0: 4461 7461 7365 7454 7261 6e73 666f 726d  DatasetTransform
+00027eb0: 6174 696f 6e4e 6f74 416c 6c6f 7765 6445  ationNotAllowedE
+00027ec0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00027ed0: 2020 2020 2020 2255 7369 6e67 2060 2e73        "Using `.s
+00027ee0: 656c 6563 7460 206f 6e20 6120 6461 7461  elect` on a data
+00027ef0: 7365 7420 7769 7468 2061 7474 6163 6865  set with attache
+00027f00: 6420 696e 6465 7865 7320 6973 206e 6f74  d indexes is not
+00027f10: 2061 6c6c 6f77 6564 2e20 596f 7520 6361   allowed. You ca
+00027f20: 6e20 6669 7273 7420 7275 6e20 602e 6472  n first run `.dr
+00027f30: 6f70 5f69 6e64 6578 2829 2074 6f20 7265  op_index() to re
+00027f40: 6d6f 7665 2079 6f75 7220 696e 6465 7820  move your index 
+00027f50: 616e 6420 7468 656e 2072 652d 6164 6420  and then re-add 
+00027f60: 6974 2e22 0a20 2020 2020 2020 2020 2020  it.".           
+00027f70: 2029 0a0a 2020 2020 2020 2020 2320 4966   )..        # If
+00027f80: 2074 6865 2061 7272 6179 2069 7320 656d   the array is em
+00027f90: 7074 7920 7765 2064 6f20 6e6f 7468 696e  pty we do nothin
+00027fa0: 670a 2020 2020 2020 2020 6966 206c 656e  g.        if len
+00027fb0: 2873 656c 6629 203d 3d20 303a 0a20 2020  (self) == 0:.   
+00027fc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00027fd0: 7365 6c66 0a0a 2020 2020 2020 2020 5f63  self..        _c
+00027fe0: 6865 636b 5f76 616c 6964 5f69 6e64 6963  heck_valid_indic
+00027ff0: 6573 5f76 616c 7565 2873 7461 7274 2c20  es_value(start, 
+00028000: 6c65 6e28 7365 6c66 2929 0a20 2020 2020  len(self)).     
+00028010: 2020 205f 6368 6563 6b5f 7661 6c69 645f     _check_valid_
+00028020: 696e 6469 6365 735f 7661 6c75 6528 7374  indices_value(st
+00028030: 6172 7420 2b20 6c65 6e67 7468 202d 2031  art + length - 1
+00028040: 2c20 6c65 6e28 7365 6c66 2929 0a20 2020  , len(self)).   
+00028050: 2020 2020 2069 6620 7365 6c66 2e5f 696e       if self._in
+00028060: 6469 6365 7320 6973 204e 6f6e 6520 6f72  dices is None or
+00028070: 206c 656e 6774 6820 3d3d 2030 3a0a 2020   length == 0:.  
+00028080: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00028090: 2044 6174 6173 6574 280a 2020 2020 2020   Dataset(.      
+000280a0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+000280b0: 6174 612e 736c 6963 6528 7374 6172 742c  ata.slice(start,
+000280c0: 206c 656e 6774 6829 2c0a 2020 2020 2020   length),.      
+000280d0: 2020 2020 2020 2020 2020 696e 666f 3d73            info=s
+000280e0: 656c 662e 696e 666f 2e63 6f70 7928 292c  elf.info.copy(),
+000280f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028100: 2073 706c 6974 3d73 656c 662e 7370 6c69   split=self.spli
+00028110: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00028120: 2020 2066 696e 6765 7270 7269 6e74 3d6e     fingerprint=n
+00028130: 6577 5f66 696e 6765 7270 7269 6e74 2c0a  ew_fingerprint,.
+00028140: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00028150: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00028160: 2020 2020 2020 2020 7265 7475 726e 2044          return D
+00028170: 6174 6173 6574 280a 2020 2020 2020 2020  ataset(.        
+00028180: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+00028190: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
+000281a0: 2020 2069 6e66 6f3d 7365 6c66 2e69 6e66     info=self.inf
+000281b0: 6f2e 636f 7079 2829 2c0a 2020 2020 2020  o.copy(),.      
+000281c0: 2020 2020 2020 2020 2020 7370 6c69 743d            split=
+000281d0: 7365 6c66 2e73 706c 6974 2c0a 2020 2020  self.split,.    
+000281e0: 2020 2020 2020 2020 2020 2020 696e 6469              indi
+000281f0: 6365 735f 7461 626c 653d 7365 6c66 2e5f  ces_table=self._
+00028200: 696e 6469 6365 732e 736c 6963 6528 7374  indices.slice(st
+00028210: 6172 742c 206c 656e 6774 6829 2c0a 2020  art, length),.  
+00028220: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00028230: 6e67 6572 7072 696e 743d 6e65 775f 6669  ngerprint=new_fi
+00028240: 6e67 6572 7072 696e 742c 0a20 2020 2020  ngerprint,.     
+00028250: 2020 2020 2020 2029 0a0a 2020 2020 4074         )..    @t
+00028260: 7261 6e73 6d69 745f 666f 726d 6174 0a20  ransmit_format. 
+00028270: 2020 2040 6669 6e67 6572 7072 696e 745f     @fingerprint_
+00028280: 7472 616e 7366 6f72 6d28 696e 706c 6163  transform(inplac
+00028290: 653d 4661 6c73 652c 2069 676e 6f72 655f  e=False, ignore_
+000282a0: 6b77 6172 6773 3d5b 2269 6e64 6963 6573  kwargs=["indices
+000282b0: 5f63 6163 6865 5f66 696c 655f 6e61 6d65  _cache_file_name
+000282c0: 225d 290a 2020 2020 6465 6620 5f73 656c  "]).    def _sel
+000282d0: 6563 745f 7769 7468 5f69 6e64 6963 6573  ect_with_indices
+000282e0: 5f6d 6170 7069 6e67 280a 2020 2020 2020  _mapping(.      
+000282f0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00028300: 696e 6469 6365 733a 2049 7465 7261 626c  indices: Iterabl
+00028310: 652c 0a20 2020 2020 2020 206b 6565 705f  e,.        keep_
+00028320: 696e 5f6d 656d 6f72 793a 2062 6f6f 6c20  in_memory: bool 
+00028330: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+00028340: 2069 6e64 6963 6573 5f63 6163 6865 5f66   indices_cache_f
+00028350: 696c 655f 6e61 6d65 3a20 4f70 7469 6f6e  ile_name: Option
+00028360: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+00028370: 2020 2020 2020 2020 7772 6974 6572 5f62          writer_b
+00028380: 6174 6368 5f73 697a 653a 204f 7074 696f  atch_size: Optio
+00028390: 6e61 6c5b 696e 745d 203d 2031 3030 302c  nal[int] = 1000,
+000283a0: 0a20 2020 2020 2020 206e 6577 5f66 696e  .        new_fin
+000283b0: 6765 7270 7269 6e74 3a20 4f70 7469 6f6e  gerprint: Option
+000283c0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+000283d0: 2020 2020 2920 2d3e 2022 4461 7461 7365      ) -> "Datase
+000283e0: 7422 3a0a 2020 2020 2020 2020 2222 2243  t":.        """C
+000283f0: 7265 6174 6520 6120 6e65 7720 6461 7461  reate a new data
+00028400: 7365 7420 7769 7468 2072 6f77 7320 7365  set with rows se
+00028410: 6c65 6374 6564 2066 6f6c 6c6f 7769 6e67  lected following
+00028420: 2074 6865 206c 6973 742f 6172 7261 7920   the list/array 
+00028430: 6f66 2069 6e64 6963 6573 2e0a 2020 2020  of indices..    
+00028440: 2020 2020 5468 6520 6e65 7720 6461 7461      The new data
+00028450: 7365 7420 6973 206d 6164 6520 6279 2063  set is made by c
+00028460: 7265 6174 696e 6720 6120 6e65 7720 696e  reating a new in
+00028470: 6469 6365 7320 6d61 7070 696e 6720 6f6e  dices mapping on
+00028480: 2074 6f70 206f 6620 7468 6520 6d61 696e   top of the main
+00028490: 2061 7272 6f77 2074 6162 6c65 2e0a 0a20   arrow table... 
+000284a0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+000284b0: 2020 2020 2020 2020 2069 6e64 6963 6573           indices
+000284c0: 2028 7365 7175 656e 6365 2c20 6974 6572   (sequence, iter
+000284d0: 6162 6c65 2c20 7261 6e67 652c 206e 6461  able, range, nda
+000284e0: 7272 6179 206f 7220 5365 7269 6573 293a  rray or Series):
+000284f0: 204c 6973 7420 6f72 2031 442d 6172 7261   List or 1D-arra
+00028500: 7920 6f66 2069 6e74 6567 6572 2069 6e64  y of integer ind
+00028510: 6963 6573 2066 6f72 2069 6e64 6578 696e  ices for indexin
+00028520: 672e 0a20 2020 2020 2020 2020 2020 206b  g..            k
+00028530: 6565 705f 696e 5f6d 656d 6f72 7920 2860  eep_in_memory (`
+00028540: 626f 6f6c 602c 2064 6566 6175 6c74 2060  bool`, default `
+00028550: 4661 6c73 6560 293a 204b 6565 7020 7468  False`): Keep th
+00028560: 6520 696e 6469 6365 7320 6d61 7070 696e  e indices mappin
+00028570: 6720 696e 206d 656d 6f72 7920 696e 7374  g in memory inst
+00028580: 6561 6420 6f66 2077 7269 7469 6e67 2069  ead of writing i
+00028590: 7420 746f 2061 2063 6163 6865 2066 696c  t to a cache fil
+000285a0: 652e 0a20 2020 2020 2020 2020 2020 2069  e..            i
+000285b0: 6e64 6963 6573 5f63 6163 6865 5f66 696c  ndices_cache_fil
+000285c0: 655f 6e61 6d65 2028 6073 7472 602c 206f  e_name (`str`, o
+000285d0: 7074 696f 6e61 6c2c 2064 6566 6175 6c74  ptional, default
+000285e0: 2060 4e6f 6e65 6029 3a20 5072 6f76 6964   `None`): Provid
+000285f0: 6520 7468 6520 6e61 6d65 206f 6620 6120  e the name of a 
+00028600: 7061 7468 2066 6f72 2074 6865 2063 6163  path for the cac
+00028610: 6865 2066 696c 652e 2049 7420 6973 2075  he file. It is u
+00028620: 7365 6420 746f 2073 746f 7265 2074 6865  sed to store the
+00028630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028640: 2069 6e64 6963 6573 206d 6170 7069 6e67   indices mapping
+00028650: 2069 6e73 7465 6164 206f 6620 7468 6520   instead of the 
+00028660: 6175 746f 6d61 7469 6361 6c6c 7920 6765  automatically ge
+00028670: 6e65 7261 7465 6420 6361 6368 6520 6669  nerated cache fi
+00028680: 6c65 206e 616d 652e 0a20 2020 2020 2020  le name..       
+00028690: 2020 2020 2077 7269 7465 725f 6261 7463       writer_batc
+000286a0: 685f 7369 7a65 2028 6069 6e74 602c 2064  h_size (`int`, d
+000286b0: 6566 6175 6c74 2060 3130 3030 6029 3a20  efault `1000`): 
+000286c0: 4e75 6d62 6572 206f 6620 726f 7773 2070  Number of rows p
+000286d0: 6572 2077 7269 7465 206f 7065 7261 7469  er write operati
+000286e0: 6f6e 2066 6f72 2074 6865 2063 6163 6865  on for the cache
+000286f0: 2066 696c 6520 7772 6974 6572 2e0a 2020   file writer..  
+00028700: 2020 2020 2020 2020 2020 2020 2020 5468                Th
+00028710: 6973 2076 616c 7565 2069 7320 6120 676f  is value is a go
+00028720: 6f64 2074 7261 6465 2d6f 6666 2062 6574  od trade-off bet
+00028730: 7765 656e 206d 656d 6f72 7920 7573 6167  ween memory usag
+00028740: 6520 6475 7269 6e67 2074 6865 2070 726f  e during the pro
+00028750: 6365 7373 696e 672c 2061 6e64 2070 726f  cessing, and pro
+00028760: 6365 7373 696e 6720 7370 6565 642e 0a20  cessing speed.. 
+00028770: 2020 2020 2020 2020 2020 2020 2020 2048                 H
+00028780: 6967 6865 7220 7661 6c75 6520 6d61 6b65  igher value make
+00028790: 7320 7468 6520 7072 6f63 6573 7369 6e67  s the processing
+000287a0: 2064 6f20 6665 7765 7220 6c6f 6f6b 7570   do fewer lookup
+000287b0: 732c 206c 6f77 6572 2076 616c 7565 2063  s, lower value c
+000287c0: 6f6e 7375 6d65 206c 6573 7320 7465 6d70  onsume less temp
+000287d0: 6f72 6172 7920 6d65 6d6f 7279 2077 6869  orary memory whi
+000287e0: 6c65 2072 756e 6e69 6e67 2060 2e6d 6170  le running `.map
+000287f0: 2829 602e 0a20 2020 2020 2020 2020 2020  ()`..           
+00028800: 206e 6577 5f66 696e 6765 7270 7269 6e74   new_fingerprint
+00028810: 2028 6073 7472 602c 206f 7074 696f 6e61   (`str`, optiona
+00028820: 6c2c 2064 6566 6175 6c74 2060 4e6f 6e65  l, default `None
+00028830: 6029 3a20 7468 6520 6e65 7720 6669 6e67  `): the new fing
+00028840: 6572 7072 696e 7420 6f66 2074 6865 2064  erprint of the d
+00028850: 6174 6173 6574 2061 6674 6572 2074 7261  ataset after tra
+00028860: 6e73 666f 726d 2e0a 2020 2020 2020 2020  nsform..        
+00028870: 2020 2020 2020 2020 4966 2060 4e6f 6e65          If `None
+00028880: 602c 2074 6865 206e 6577 2066 696e 6765  `, the new finge
+00028890: 7270 7269 6e74 2069 7320 636f 6d70 7574  rprint is comput
+000288a0: 6564 2075 7369 6e67 2061 2068 6173 6820  ed using a hash 
+000288b0: 6f66 2074 6865 2070 7265 7669 6f75 7320  of the previous 
+000288c0: 6669 6e67 6572 7072 696e 742c 2061 6e64  fingerprint, and
+000288d0: 2074 6865 2074 7261 6e73 666f 726d 2061   the transform a
+000288e0: 7267 756d 656e 7473 0a0a 2020 2020 2020  rguments..      
+000288f0: 2020 4578 616d 706c 653a 0a0a 2020 2020    Example:..    
+00028900: 2020 2020 6060 6070 790a 2020 2020 2020      ```py.      
+00028910: 2020 3e3e 3e20 6672 6f6d 2064 6174 6173    >>> from datas
+00028920: 6574 7320 696d 706f 7274 206c 6f61 645f  ets import load_
+00028930: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
+00028940: 3e3e 3e20 6473 203d 206c 6f61 645f 6461  >>> ds = load_da
+00028950: 7461 7365 7428 2272 6f74 7465 6e5f 746f  taset("rotten_to
+00028960: 6d61 746f 6573 222c 2073 706c 6974 3d22  matoes", split="
+00028970: 7661 6c69 6461 7469 6f6e 2229 0a20 2020  validation").   
+00028980: 2020 2020 203e 3e3e 2064 732e 5f73 656c       >>> ds._sel
+00028990: 6563 745f 7769 7468 5f69 6e64 6963 6573  ect_with_indices
+000289a0: 5f6d 6170 7069 6e67 2872 616e 6765 2834  _mapping(range(4
+000289b0: 2929 0a20 2020 2020 2020 2044 6174 6173  )).        Datas
+000289c0: 6574 287b 0a20 2020 2020 2020 2020 2020  et({.           
+000289d0: 2066 6561 7475 7265 733a 205b 2774 6578   features: ['tex
+000289e0: 7427 2c20 276c 6162 656c 275d 2c0a 2020  t', 'label'],.  
+000289f0: 2020 2020 2020 2020 2020 6e75 6d5f 726f            num_ro
+00028a00: 7773 3a20 340a 2020 2020 2020 2020 7d29  ws: 4.        })
+00028a10: 0a20 2020 2020 2020 2060 6060 0a20 2020  .        ```.   
+00028a20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00028a30: 2069 6620 6b65 6570 5f69 6e5f 6d65 6d6f   if keep_in_memo
+00028a40: 7279 2061 6e64 2069 6e64 6963 6573 5f63  ry and indices_c
+00028a50: 6163 6865 5f66 696c 655f 6e61 6d65 2069  ache_file_name i
+00028a60: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00028a70: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00028a80: 6c75 6545 7272 6f72 2822 506c 6561 7365  lueError("Please
+00028a90: 2075 7365 2065 6974 6865 7220 606b 6565   use either `kee
+00028aa0: 705f 696e 5f6d 656d 6f72 7960 206f 7220  p_in_memory` or 
+00028ab0: 6069 6e64 6963 6573 5f63 6163 6865 5f66  `indices_cache_f
+00028ac0: 696c 655f 6e61 6d65 6020 6275 7420 6e6f  ile_name` but no
+00028ad0: 7420 626f 7468 2e22 290a 0a20 2020 2020  t both.")..     
+00028ae0: 2020 2069 6620 6c65 6e28 7365 6c66 2e6c     if len(self.l
+00028af0: 6973 745f 696e 6465 7865 7328 2929 203e  ist_indexes()) >
+00028b00: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00028b10: 7261 6973 6520 4461 7461 7365 7454 7261  raise DatasetTra
+00028b20: 6e73 666f 726d 6174 696f 6e4e 6f74 416c  nsformationNotAl
+00028b30: 6c6f 7765 6445 7272 6f72 280a 2020 2020  lowedError(.    
+00028b40: 2020 2020 2020 2020 2020 2020 2255 7369              "Usi
+00028b50: 6e67 2060 2e73 656c 6563 7460 206f 6e20  ng `.select` on 
+00028b60: 6120 6461 7461 7365 7420 7769 7468 2061  a dataset with a
+00028b70: 7474 6163 6865 6420 696e 6465 7865 7320  ttached indexes 
+00028b80: 6973 206e 6f74 2061 6c6c 6f77 6564 2e20  is not allowed. 
+00028b90: 596f 7520 6361 6e20 6669 7273 7420 7275  You can first ru
+00028ba0: 6e20 602e 6472 6f70 5f69 6e64 6578 2829  n `.drop_index()
+00028bb0: 2074 6f20 7265 6d6f 7665 2079 6f75 7220   to remove your 
+00028bc0: 696e 6465 7820 616e 6420 7468 656e 2072  index and then r
+00028bd0: 652d 6164 6420 6974 2e22 0a20 2020 2020  e-add it.".     
+00028be0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00028bf0: 2020 2320 4966 2074 6865 2061 7272 6179    # If the array
+00028c00: 2069 7320 656d 7074 7920 7765 2064 6f20   is empty we do 
+00028c10: 6e6f 7468 696e 670a 2020 2020 2020 2020  nothing.        
+00028c20: 6966 206c 656e 2873 656c 6629 203d 3d20  if len(self) == 
+00028c30: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+00028c40: 6574 7572 6e20 7365 6c66 0a0a 2020 2020  eturn self..    
+00028c50: 2020 2020 2320 5072 6570 6172 6520 7468      # Prepare th
+00028c60: 6520 7772 6974 6572 2066 6f72 206f 7572  e writer for our
+00028c70: 2069 6e64 6963 6573 2061 7272 6f77 2074   indices arrow t
+00028c80: 6162 6c65 0a20 2020 2020 2020 2069 6620  able.        if 
+00028c90: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 206f  keep_in_memory o
+00028ca0: 7220 696e 6469 6365 735f 6361 6368 655f  r indices_cache_
+00028cb0: 6669 6c65 5f6e 616d 6520 6973 204e 6f6e  file_name is Non
+00028cc0: 653a 0a20 2020 2020 2020 2020 2020 2062  e:.            b
+00028cd0: 7566 5f77 7269 7465 7220 3d20 7061 2e42  uf_writer = pa.B
+00028ce0: 7566 6665 724f 7574 7075 7453 7472 6561  ufferOutputStrea
+00028cf0: 6d28 290a 2020 2020 2020 2020 2020 2020  m().            
+00028d00: 746d 705f 6669 6c65 203d 204e 6f6e 650a  tmp_file = None.
+00028d10: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+00028d20: 6572 203d 2041 7272 6f77 5772 6974 6572  er = ArrowWriter
+00028d30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00028d40: 2020 7374 7265 616d 3d62 7566 5f77 7269    stream=buf_wri
+00028d50: 7465 722c 2077 7269 7465 725f 6261 7463  ter, writer_batc
+00028d60: 685f 7369 7a65 3d77 7269 7465 725f 6261  h_size=writer_ba
+00028d70: 7463 685f 7369 7a65 2c20 6669 6e67 6572  tch_size, finger
+00028d80: 7072 696e 743d 6e65 775f 6669 6e67 6572  print=new_finger
+00028d90: 7072 696e 742c 2075 6e69 743d 2269 6e64  print, unit="ind
+00028da0: 6963 6573 220a 2020 2020 2020 2020 2020  ices".          
+00028db0: 2020 290a 2020 2020 2020 2020 656c 7365    ).        else
+00028dc0: 3a0a 2020 2020 2020 2020 2020 2020 6275  :.            bu
+00028dd0: 665f 7772 6974 6572 203d 204e 6f6e 650a  f_writer = None.
+00028de0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+00028df0: 6572 2e69 6e66 6f28 6622 4361 6368 696e  er.info(f"Cachin
+00028e00: 6720 696e 6469 6365 7320 6d61 7070 696e  g indices mappin
+00028e10: 6720 6174 207b 696e 6469 6365 735f 6361  g at {indices_ca
+00028e20: 6368 655f 6669 6c65 5f6e 616d 657d 2229  che_file_name}")
+00028e30: 0a20 2020 2020 2020 2020 2020 2074 6d70  .            tmp
+00028e40: 5f66 696c 6520 3d20 7465 6d70 6669 6c65  _file = tempfile
+00028e50: 2e4e 616d 6564 5465 6d70 6f72 6172 7946  .NamedTemporaryF
+00028e60: 696c 6528 2277 6222 2c20 6469 723d 6f73  ile("wb", dir=os
+00028e70: 2e70 6174 682e 6469 726e 616d 6528 696e  .path.dirname(in
+00028e80: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
+00028e90: 5f6e 616d 6529 2c20 6465 6c65 7465 3d46  _name), delete=F
+00028ea0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+00028eb0: 2020 7772 6974 6572 203d 2041 7272 6f77    writer = Arrow
+00028ec0: 5772 6974 6572 280a 2020 2020 2020 2020  Writer(.        
+00028ed0: 2020 2020 2020 2020 7061 7468 3d74 6d70          path=tmp
+00028ee0: 5f66 696c 652e 6e61 6d65 2c20 7772 6974  _file.name, writ
+00028ef0: 6572 5f62 6174 6368 5f73 697a 653d 7772  er_batch_size=wr
+00028f00: 6974 6572 5f62 6174 6368 5f73 697a 652c  iter_batch_size,
+00028f10: 2066 696e 6765 7270 7269 6e74 3d6e 6577   fingerprint=new
+00028f20: 5f66 696e 6765 7270 7269 6e74 2c20 756e  _fingerprint, un
+00028f30: 6974 3d22 696e 6469 6365 7322 0a20 2020  it="indices".   
+00028f40: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00028f50: 2020 2020 696e 6469 6365 7320 3d20 696e      indices = in
+00028f60: 6469 6365 7320 6966 2069 7369 6e73 7461  dices if isinsta
+00028f70: 6e63 6528 696e 6469 6365 732c 206c 6973  nce(indices, lis
+00028f80: 7429 2065 6c73 6520 6c69 7374 2869 6e64  t) else list(ind
+00028f90: 6963 6573 290a 0a20 2020 2020 2020 2073  ices)..        s
+00028fa0: 697a 6520 3d20 6c65 6e28 7365 6c66 290a  ize = len(self).
+00028fb0: 2020 2020 2020 2020 6966 2069 6e64 6963          if indic
+00028fc0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00028fd0: 5f63 6865 636b 5f76 616c 6964 5f69 6e64  _check_valid_ind
+00028fe0: 6963 6573 5f76 616c 7565 2869 6e74 286d  ices_value(int(m
+00028ff0: 6178 2869 6e64 6963 6573 2929 2c20 7369  ax(indices)), si
+00029000: 7a65 3d73 697a 6529 0a20 2020 2020 2020  ze=size).       
+00029010: 2020 2020 205f 6368 6563 6b5f 7661 6c69       _check_vali
+00029020: 645f 696e 6469 6365 735f 7661 6c75 6528  d_indices_value(
+00029030: 696e 7428 6d69 6e28 696e 6469 6365 7329  int(min(indices)
+00029040: 292c 2073 697a 653d 7369 7a65 290a 2020  ), size=size).  
+00029050: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00029060: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00029070: 656c 662e 5f73 656c 6563 745f 636f 6e74  elf._select_cont
+00029080: 6967 756f 7573 2830 2c20 302c 206e 6577  iguous(0, 0, new
+00029090: 5f66 696e 6765 7270 7269 6e74 3d6e 6577  _fingerprint=new
+000290a0: 5f66 696e 6765 7270 7269 6e74 290a 0a20  _fingerprint).. 
+000290b0: 2020 2020 2020 2069 6e64 6963 6573 5f61         indices_a
+000290c0: 7272 6179 203d 2070 612e 6172 7261 7928  rray = pa.array(
+000290d0: 696e 6469 6365 732c 2074 7970 653d 7061  indices, type=pa
+000290e0: 2e75 696e 7436 3428 2929 0a20 2020 2020  .uint64()).     
+000290f0: 2020 2023 2043 6865 636b 2069 6620 7765     # Check if we
+00029100: 206e 6565 6420 746f 2063 6f6e 7665 7274   need to convert
+00029110: 2069 6e64 6963 6573 0a20 2020 2020 2020   indices.       
+00029120: 2069 6620 7365 6c66 2e5f 696e 6469 6365   if self._indice
+00029130: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+00029140: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
+00029150: 6573 5f61 7272 6179 203d 2073 656c 662e  es_array = self.
+00029160: 5f69 6e64 6963 6573 2e63 6f6c 756d 6e28  _indices.column(
+00029170: 3029 2e74 616b 6528 696e 6469 6365 735f  0).take(indices_
+00029180: 6172 7261 7929 0a0a 2020 2020 2020 2020  array)..        
+00029190: 696e 6469 6365 735f 7461 626c 6520 3d20  indices_table = 
+000291a0: 7061 2e54 6162 6c65 2e66 726f 6d5f 6172  pa.Table.from_ar
+000291b0: 7261 7973 285b 696e 6469 6365 735f 6172  rays([indices_ar
+000291c0: 7261 795d 2c20 6e61 6d65 733d 5b22 696e  ray], names=["in
+000291d0: 6469 6365 7322 5d29 0a0a 2020 2020 2020  dices"])..      
+000291e0: 2020 7769 7468 2077 7269 7465 723a 0a20    with writer:. 
+000291f0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00029200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029210: 7772 6974 6572 2e77 7269 7465 5f74 6162  writer.write_tab
+00029220: 6c65 2869 6e64 6963 6573 5f74 6162 6c65  le(indices_table
+00029230: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00029240: 2020 7772 6974 6572 2e66 696e 616c 697a    writer.finaliz
+00029250: 6528 2920 2023 2063 6c6f 7365 5f73 7472  e()  # close_str
+00029260: 6561 6d3d 626f 6f6c 2862 7566 5f77 7269  eam=bool(buf_wri
+00029270: 7465 7220 6973 204e 6f6e 6529 2920 2057  ter is None))  W
+00029280: 6520 6f6e 6c79 2063 6c6f 7365 2069 6620  e only close if 
+00029290: 7765 2061 7265 2077 7269 7469 6e67 2069  we are writing i
+000292a0: 6e20 6120 6669 6c65 0a20 2020 2020 2020  n a file.       
+000292b0: 2020 2020 2065 7863 6570 7420 2845 7863       except (Exc
+000292c0: 6570 7469 6f6e 2c20 4b65 7962 6f61 7264  eption, Keyboard
+000292d0: 496e 7465 7272 7570 7429 3a0a 2020 2020  Interrupt):.    
+000292e0: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+000292f0: 6d70 5f66 696c 6520 6973 206e 6f74 204e  mp_file is not N
+00029300: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00029310: 2020 2020 2020 2020 2074 6d70 5f66 696c           tmp_fil
+00029320: 652e 636c 6f73 6528 290a 2020 2020 2020  e.close().      
+00029330: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00029340: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00029350: 746d 705f 6669 6c65 2e6e 616d 6529 3a0a  tmp_file.name):.
+00029360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029370: 2020 2020 2020 2020 6f73 2e72 656d 6f76          os.remov
+00029380: 6528 746d 705f 6669 6c65 2e6e 616d 6529  e(tmp_file.name)
+00029390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000293a0: 2072 6169 7365 0a0a 2020 2020 2020 2020   raise..        
+000293b0: 6966 2074 6d70 5f66 696c 6520 6973 206e  if tmp_file is n
+000293c0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000293d0: 2020 2020 2074 6d70 5f66 696c 652e 636c       tmp_file.cl
+000293e0: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
+000293f0: 2020 7368 7574 696c 2e6d 6f76 6528 746d    shutil.move(tm
+00029400: 705f 6669 6c65 2e6e 616d 652c 2069 6e64  p_file.name, ind
+00029410: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
+00029420: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+00029430: 2020 756d 6173 6b20 3d20 6f73 2e75 6d61    umask = os.uma
+00029440: 736b 2830 6f36 3636 290a 2020 2020 2020  sk(0o666).      
+00029450: 2020 2020 2020 6f73 2e75 6d61 736b 2875        os.umask(u
+00029460: 6d61 736b 290a 2020 2020 2020 2020 2020  mask).          
+00029470: 2020 6f73 2e63 686d 6f64 2869 6e64 6963    os.chmod(indic
+00029480: 6573 5f63 6163 6865 5f66 696c 655f 6e61  es_cache_file_na
+00029490: 6d65 2c20 306f 3636 3620 2620 7e75 6d61  me, 0o666 & ~uma
+000294a0: 736b 290a 0a20 2020 2020 2020 2023 2052  sk)..        # R
+000294b0: 6574 7572 6e20 6e65 7720 4461 7461 7365  eturn new Datase
+000294c0: 7420 6f62 6a65 6374 0a20 2020 2020 2020  t object.       
+000294d0: 2069 6620 6275 665f 7772 6974 6572 2069   if buf_writer i
+000294e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000294f0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00029500: 5f6e 6577 5f64 6174 6173 6574 5f77 6974  _new_dataset_wit
+00029510: 685f 696e 6469 6365 7328 0a20 2020 2020  h_indices(.     
+00029520: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
+00029530: 6573 5f63 6163 6865 5f66 696c 655f 6e61  es_cache_file_na
+00029540: 6d65 3d69 6e64 6963 6573 5f63 6163 6865  me=indices_cache
+00029550: 5f66 696c 655f 6e61 6d65 2c20 6669 6e67  _file_name, fing
+00029560: 6572 7072 696e 743d 6e65 775f 6669 6e67  erprint=new_fing
+00029570: 6572 7072 696e 740a 2020 2020 2020 2020  erprint.        
+00029580: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
+00029590: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000295a0: 7265 7475 726e 2073 656c 662e 5f6e 6577  return self._new
+000295b0: 5f64 6174 6173 6574 5f77 6974 685f 696e  _dataset_with_in
+000295c0: 6469 6365 7328 696e 6469 6365 735f 6275  dices(indices_bu
+000295d0: 6666 6572 3d62 7566 5f77 7269 7465 722e  ffer=buf_writer.
+000295e0: 6765 7476 616c 7565 2829 2c20 6669 6e67  getvalue(), fing
+000295f0: 6572 7072 696e 743d 6e65 775f 6669 6e67  erprint=new_fing
+00029600: 6572 7072 696e 7429 0a0a 2020 2020 4074  erprint)..    @t
+00029610: 7261 6e73 6d69 745f 666f 726d 6174 0a20  ransmit_format. 
+00029620: 2020 2040 6669 6e67 6572 7072 696e 745f     @fingerprint_
+00029630: 7472 616e 7366 6f72 6d28 696e 706c 6163  transform(inplac
+00029640: 653d 4661 6c73 652c 2069 676e 6f72 655f  e=False, ignore_
+00029650: 6b77 6172 6773 3d5b 226c 6f61 645f 6672  kwargs=["load_fr
+00029660: 6f6d 5f63 6163 6865 5f66 696c 6522 2c20  om_cache_file", 
+00029670: 2269 6e64 6963 6573 5f63 6163 6865 5f66  "indices_cache_f
+00029680: 696c 655f 6e61 6d65 225d 290a 2020 2020  ile_name"]).    
+00029690: 6465 6620 736f 7274 280a 2020 2020 2020  def sort(.      
+000296a0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+000296b0: 636f 6c75 6d6e 3a20 7374 722c 0a20 2020  column: str,.   
+000296c0: 2020 2020 2072 6576 6572 7365 3a20 626f       reverse: bo
+000296d0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+000296e0: 2020 2020 6b69 6e64 3a20 7374 7220 3d20      kind: str = 
+000296f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6e75  None,.        nu
+00029700: 6c6c 5f70 6c61 6365 6d65 6e74 3a20 7374  ll_placement: st
+00029710: 7220 3d20 226c 6173 7422 2c0a 2020 2020  r = "last",.    
+00029720: 2020 2020 6b65 6570 5f69 6e5f 6d65 6d6f      keep_in_memo
+00029730: 7279 3a20 626f 6f6c 203d 2046 616c 7365  ry: bool = False
+00029740: 2c0a 2020 2020 2020 2020 6c6f 6164 5f66  ,.        load_f
+00029750: 726f 6d5f 6361 6368 655f 6669 6c65 3a20  rom_cache_file: 
+00029760: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
+00029770: 2020 2020 2069 6e64 6963 6573 5f63 6163       indices_cac
+00029780: 6865 5f66 696c 655f 6e61 6d65 3a20 4f70  he_file_name: Op
+00029790: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+000297a0: 6e65 2c0a 2020 2020 2020 2020 7772 6974  ne,.        writ
+000297b0: 6572 5f62 6174 6368 5f73 697a 653a 204f  er_batch_size: O
+000297c0: 7074 696f 6e61 6c5b 696e 745d 203d 2031  ptional[int] = 1
+000297d0: 3030 302c 0a20 2020 2020 2020 206e 6577  000,.        new
+000297e0: 5f66 696e 6765 7270 7269 6e74 3a20 4f70  _fingerprint: Op
+000297f0: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+00029800: 6e65 2c0a 2020 2020 2920 2d3e 2022 4461  ne,.    ) -> "Da
+00029810: 7461 7365 7422 3a0a 2020 2020 2020 2020  taset":.        
+00029820: 2222 2243 7265 6174 6520 6120 6e65 7720  """Create a new 
+00029830: 6461 7461 7365 7420 736f 7274 6564 2061  dataset sorted a
+00029840: 6363 6f72 6469 6e67 2074 6f20 6120 636f  ccording to a co
+00029850: 6c75 6d6e 2e0a 0a20 2020 2020 2020 2043  lumn...        C
+00029860: 7572 7265 6e74 6c79 2073 6f72 7469 6e67  urrently sorting
+00029870: 2061 6363 6f72 6469 6e67 2074 6f20 6120   according to a 
+00029880: 636f 6c75 6d6e 206e 616d 6520 7573 6573  column name uses
+00029890: 2070 616e 6461 7320 736f 7274 696e 6720   pandas sorting 
+000298a0: 616c 676f 7269 7468 6d20 756e 6465 7220  algorithm under 
+000298b0: 7468 6520 686f 6f64 2e0a 2020 2020 2020  the hood..      
+000298c0: 2020 5468 6520 636f 6c75 6d6e 2073 686f    The column sho
+000298d0: 756c 6420 7468 7573 2062 6520 6120 7061  uld thus be a pa
+000298e0: 6e64 6173 2063 6f6d 7061 7469 626c 6520  ndas compatible 
+000298f0: 7479 7065 2028 696e 2070 6172 7469 6375  type (in particu
+00029900: 6c61 7220 6e6f 7420 6120 6e65 7374 6564  lar not a nested
+00029910: 2074 7970 6529 2e0a 2020 2020 2020 2020   type)..        
+00029920: 5468 6973 2061 6c73 6f20 6d65 616e 7320  This also means 
+00029930: 7468 6174 2074 6865 2063 6f6c 756d 6e20  that the column 
+00029940: 7573 6564 2066 6f72 2073 6f72 7469 6e67  used for sorting
+00029950: 2069 7320 6675 6c6c 7920 6c6f 6164 6564   is fully loaded
+00029960: 2069 6e20 6d65 6d6f 7279 2028 7768 6963   in memory (whic
+00029970: 6820 7368 6f75 6c64 2062 6520 6669 6e65  h should be fine
+00029980: 2069 6e20 6d6f 7374 2063 6173 6573 292e   in most cases).
+00029990: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+000299a0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+000299b0: 6d6e 2028 6073 7472 6029 3a0a 2020 2020  mn (`str`):.    
+000299c0: 2020 2020 2020 2020 2020 2020 436f 6c75              Colu
+000299d0: 6d6e 206e 616d 6520 746f 2073 6f72 7420  mn name to sort 
+000299e0: 6279 2e0a 2020 2020 2020 2020 2020 2020  by..            
+000299f0: 7265 7665 7273 6520 2860 626f 6f6c 602c  reverse (`bool`,
+00029a00: 2064 6566 6175 6c74 7320 746f 2060 4661   defaults to `Fa
+00029a10: 6c73 6560 293a 0a20 2020 2020 2020 2020  lse`):.         
+00029a20: 2020 2020 2020 2049 6620 6054 7275 6560         If `True`
+00029a30: 2c20 736f 7274 2062 7920 6465 7363 656e  , sort by descen
+00029a40: 6469 6e67 206f 7264 6572 2072 6174 6865  ding order rathe
+00029a50: 7220 7468 656e 2061 7363 656e 6469 6e67  r then ascending
+00029a60: 2e0a 2020 2020 2020 2020 2020 2020 6b69  ..            ki
+00029a70: 6e64 2028 6073 7472 602c 202a 6f70 7469  nd (`str`, *opti
+00029a80: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
+00029a90: 2020 2020 2020 2020 5061 6e64 6173 2061          Pandas a
+00029aa0: 6c67 6f72 6974 686d 2066 6f72 2073 6f72  lgorithm for sor
+00029ab0: 7469 6e67 2073 656c 6563 7465 6420 696e  ting selected in
+00029ac0: 2060 7b71 7569 636b 736f 7274 2c20 6d65   `{quicksort, me
+00029ad0: 7267 6573 6f72 742c 2068 6561 7073 6f72  rgesort, heapsor
+00029ae0: 742c 2073 7461 626c 657d 602c 0a20 2020  t, stable}`,.   
+00029af0: 2020 2020 2020 2020 2020 2020 2054 6865               The
+00029b00: 2064 6566 6175 6c74 2069 7320 6071 7569   default is `qui
+00029b10: 636b 736f 7274 602e 204e 6f74 6520 7468  cksort`. Note th
+00029b20: 6174 2062 6f74 6820 6073 7461 626c 6560  at both `stable`
+00029b30: 2061 6e64 2060 6d65 7267 6573 6f72 7460   and `mergesort`
+00029b40: 2075 7365 2060 7469 6d73 6f72 7460 2075   use `timsort` u
+00029b50: 6e64 6572 2074 6865 2063 6f76 6572 7320  nder the covers 
+00029b60: 616e 642c 2069 6e20 6765 6e65 7261 6c2c  and, in general,
+00029b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029b80: 2074 6865 2061 6374 7561 6c20 696d 706c   the actual impl
+00029b90: 656d 656e 7461 7469 6f6e 2077 696c 6c20  ementation will 
+00029ba0: 7661 7279 2077 6974 6820 6461 7461 2074  vary with data t
+00029bb0: 7970 652e 2054 6865 2060 6d65 7267 6573  ype. The `merges
+00029bc0: 6f72 7460 206f 7074 696f 6e20 6973 2072  ort` option is r
+00029bd0: 6574 6169 6e65 6420 666f 7220 6261 636b  etained for back
+00029be0: 7761 7264 7320 636f 6d70 6174 6962 696c  wards compatibil
+00029bf0: 6974 792e 0a20 2020 2020 2020 2020 2020  ity..           
+00029c00: 206e 756c 6c5f 706c 6163 656d 656e 7420   null_placement 
+00029c10: 2860 7374 7260 2c20 6465 6661 756c 7473  (`str`, defaults
+00029c20: 2074 6f20 606c 6173 7460 293a 0a20 2020   to `last`):.   
+00029c30: 2020 2020 2020 2020 2020 2020 2050 7574               Put
+00029c40: 2060 4e6f 6e65 6020 7661 6c75 6573 2061   `None` values a
+00029c50: 7420 7468 6520 6265 6769 6e6e 696e 6720  t the beginning 
+00029c60: 6966 2066 6972 7374 3b20 6c61 7374 2070  if first; last p
+00029c70: 7574 7320 604e 6f6e 6560 2076 616c 7565  uts `None` value
+00029c80: 7320 6174 2074 6865 2065 6e64 2e0a 0a20  s at the end... 
+00029c90: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+00029ca0: 4164 6465 6420 7665 7273 696f 6e3d 2231  Added version="1
+00029cb0: 2e31 342e 3222 2f3e 0a20 2020 2020 2020  .14.2"/>.       
+00029cc0: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
+00029cd0: 6f72 7920 2860 626f 6f6c 602c 2064 6566  ory (`bool`, def
+00029ce0: 6175 6c74 7320 746f 2060 4661 6c73 6560  aults to `False`
+00029cf0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00029d00: 2020 204b 6565 7020 7468 6520 736f 7274     Keep the sort
+00029d10: 6564 2069 6e64 6963 6573 2069 6e20 6d65  ed indices in me
+00029d20: 6d6f 7279 2069 6e73 7465 6164 206f 6620  mory instead of 
+00029d30: 7772 6974 696e 6720 6974 2074 6f20 6120  writing it to a 
+00029d40: 6361 6368 6520 6669 6c65 2e0a 2020 2020  cache file..    
+00029d50: 2020 2020 2020 2020 6c6f 6164 5f66 726f          load_fro
+00029d60: 6d5f 6361 6368 655f 6669 6c65 2028 6062  m_cache_file (`b
+00029d70: 6f6f 6c60 2c20 6465 6661 756c 7473 2074  ool`, defaults t
+00029d80: 6f20 6054 7275 6560 293a 0a20 2020 2020  o `True`):.     
+00029d90: 2020 2020 2020 2020 2020 2049 6620 6120             If a 
+00029da0: 6361 6368 6520 6669 6c65 2073 746f 7269  cache file stori
+00029db0: 6e67 2074 6865 2073 6f72 7465 6420 696e  ng the sorted in
+00029dc0: 6469 6365 730a 2020 2020 2020 2020 2020  dices.          
+00029dd0: 2020 2020 2020 6361 6e20 6265 2069 6465        can be ide
+00029de0: 6e74 6966 6965 642c 2075 7365 2069 7420  ntified, use it 
+00029df0: 696e 7374 6561 6420 6f66 2072 6563 6f6d  instead of recom
+00029e00: 7075 7469 6e67 2e0a 2020 2020 2020 2020  puting..        
+00029e10: 2020 2020 696e 6469 6365 735f 6361 6368      indices_cach
+00029e20: 655f 6669 6c65 5f6e 616d 6520 2860 7374  e_file_name (`st
+00029e30: 7260 2c20 2a6f 7074 696f 6e61 6c2a 2c20  r`, *optional*, 
+00029e40: 6465 6661 756c 7473 2074 6f20 604e 6f6e  defaults to `Non
+00029e50: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
+00029e60: 2020 2020 2050 726f 7669 6465 2074 6865       Provide the
+00029e70: 206e 616d 6520 6f66 2061 2070 6174 6820   name of a path 
+00029e80: 666f 7220 7468 6520 6361 6368 6520 6669  for the cache fi
+00029e90: 6c65 2e20 4974 2069 7320 7573 6564 2074  le. It is used t
+00029ea0: 6f20 7374 6f72 6520 7468 650a 2020 2020  o store the.    
+00029eb0: 2020 2020 2020 2020 2020 2020 736f 7274              sort
+00029ec0: 6564 2069 6e64 6963 6573 2069 6e73 7465  ed indices inste
+00029ed0: 6164 206f 6620 7468 6520 6175 746f 6d61  ad of the automa
+00029ee0: 7469 6361 6c6c 7920 6765 6e65 7261 7465  tically generate
+00029ef0: 6420 6361 6368 6520 6669 6c65 206e 616d  d cache file nam
+00029f00: 652e 0a20 2020 2020 2020 2020 2020 2077  e..            w
+00029f10: 7269 7465 725f 6261 7463 685f 7369 7a65  riter_batch_size
+00029f20: 2028 6069 6e74 602c 2064 6566 6175 6c74   (`int`, default
+00029f30: 7320 746f 2060 3130 3030 6029 3a0a 2020  s to `1000`):.  
+00029f40: 2020 2020 2020 2020 2020 2020 2020 4e75                Nu
+00029f50: 6d62 6572 206f 6620 726f 7773 2070 6572  mber of rows per
+00029f60: 2077 7269 7465 206f 7065 7261 7469 6f6e   write operation
+00029f70: 2066 6f72 2074 6865 2063 6163 6865 2066   for the cache f
+00029f80: 696c 6520 7772 6974 6572 2e0a 2020 2020  ile writer..    
+00029f90: 2020 2020 2020 2020 2020 2020 4869 6768              High
+00029fa0: 6572 2076 616c 7565 2067 6976 6573 2073  er value gives s
+00029fb0: 6d61 6c6c 6572 2063 6163 6865 2066 696c  maller cache fil
+00029fc0: 6573 2c20 6c6f 7765 7220 7661 6c75 6520  es, lower value 
+00029fd0: 636f 6e73 756d 6520 6c65 7373 2074 656d  consume less tem
+00029fe0: 706f 7261 7279 206d 656d 6f72 792e 0a20  porary memory.. 
+00029ff0: 2020 2020 2020 2020 2020 206e 6577 5f66             new_f
+0002a000: 696e 6765 7270 7269 6e74 2028 6073 7472  ingerprint (`str
+0002a010: 602c 202a 6f70 7469 6f6e 616c 2a2c 2064  `, *optional*, d
+0002a020: 6566 6175 6c74 7320 746f 2060 4e6f 6e65  efaults to `None
+0002a030: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
+0002a040: 2020 2020 5468 6520 6e65 7720 6669 6e67      The new fing
+0002a050: 6572 7072 696e 7420 6f66 2074 6865 2064  erprint of the d
+0002a060: 6174 6173 6574 2061 6674 6572 2074 7261  ataset after tra
+0002a070: 6e73 666f 726d 2e0a 2020 2020 2020 2020  nsform..        
+0002a080: 2020 2020 2020 2020 4966 2060 4e6f 6e65          If `None
+0002a090: 602c 2074 6865 206e 6577 2066 696e 6765  `, the new finge
+0002a0a0: 7270 7269 6e74 2069 7320 636f 6d70 7574  rprint is comput
+0002a0b0: 6564 2075 7369 6e67 2061 2068 6173 6820  ed using a hash 
+0002a0c0: 6f66 2074 6865 2070 7265 7669 6f75 7320  of the previous 
+0002a0d0: 6669 6e67 6572 7072 696e 742c 2061 6e64  fingerprint, and
+0002a0e0: 2074 6865 2074 7261 6e73 666f 726d 2061   the transform a
+0002a0f0: 7267 756d 656e 7473 0a0a 2020 2020 2020  rguments..      
+0002a100: 2020 4578 616d 706c 653a 0a0a 2020 2020    Example:..    
+0002a110: 2020 2020 6060 6070 790a 2020 2020 2020      ```py.      
+0002a120: 2020 3e3e 3e20 6672 6f6d 2064 6174 6173    >>> from datas
+0002a130: 6574 7320 696d 706f 7274 206c 6f61 645f  ets import load_
+0002a140: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
+0002a150: 3e3e 3e20 6473 203d 206c 6f61 645f 6461  >>> ds = load_da
+0002a160: 7461 7365 7428 2272 6f74 7465 6e5f 746f  taset("rotten_to
+0002a170: 6d61 746f 6573 222c 2073 706c 6974 3d22  matoes", split="
+0002a180: 7661 6c69 6461 7469 6f6e 2229 0a20 2020  validation").   
+0002a190: 2020 2020 203e 3e3e 2064 735b 276c 6162       >>> ds['lab
+0002a1a0: 656c 275d 5b3a 3130 5d0a 2020 2020 2020  el'][:10].      
+0002a1b0: 2020 5b31 2c20 312c 2031 2c20 312c 2031    [1, 1, 1, 1, 1
+0002a1c0: 2c20 312c 2031 2c20 312c 2031 2c20 315d  , 1, 1, 1, 1, 1]
+0002a1d0: 0a20 2020 2020 2020 203e 3e3e 2073 6f72  .        >>> sor
+0002a1e0: 7465 645f 6473 203d 2064 732e 736f 7274  ted_ds = ds.sort
+0002a1f0: 2827 6c61 6265 6c27 290a 2020 2020 2020  ('label').      
+0002a200: 2020 3e3e 3e20 736f 7274 6564 5f64 735b    >>> sorted_ds[
+0002a210: 276c 6162 656c 275d 5b3a 3130 5d0a 2020  'label'][:10].  
+0002a220: 2020 2020 2020 5b30 2c20 302c 2030 2c20        [0, 0, 0, 
+0002a230: 302c 2030 2c20 302c 2030 2c20 302c 2030  0, 0, 0, 0, 0, 0
+0002a240: 2c20 305d 0a20 2020 2020 2020 2060 6060  , 0].        ```
+0002a250: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0002a260: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
+0002a270: 2e6c 6973 745f 696e 6465 7865 7328 2929  .list_indexes())
+0002a280: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0002a290: 2020 7261 6973 6520 4461 7461 7365 7454    raise DatasetT
+0002a2a0: 7261 6e73 666f 726d 6174 696f 6e4e 6f74  ransformationNot
+0002a2b0: 416c 6c6f 7765 6445 7272 6f72 280a 2020  AllowedError(.  
+0002a2c0: 2020 2020 2020 2020 2020 2020 2020 2255                "U
+0002a2d0: 7369 6e67 2060 2e73 6f72 7460 206f 6e20  sing `.sort` on 
+0002a2e0: 6120 6461 7461 7365 7420 7769 7468 2061  a dataset with a
+0002a2f0: 7474 6163 6865 6420 696e 6465 7865 7320  ttached indexes 
+0002a300: 6973 206e 6f74 2061 6c6c 6f77 6564 2e20  is not allowed. 
+0002a310: 596f 7520 6361 6e20 6669 7273 7420 7275  You can first ru
+0002a320: 6e20 602e 6472 6f70 5f69 6e64 6578 2829  n `.drop_index()
+0002a330: 2074 6f20 7265 6d6f 7665 2079 6f75 7220   to remove your 
+0002a340: 696e 6465 7820 616e 6420 7468 656e 2072  index and then r
+0002a350: 652d 6164 6420 6974 2e22 0a20 2020 2020  e-add it.".     
+0002a360: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0002a370: 2023 2049 6620 7468 6520 6172 7261 7920   # If the array 
+0002a380: 6973 2065 6d70 7479 2077 6520 646f 206e  is empty we do n
+0002a390: 6f74 6869 6e67 0a20 2020 2020 2020 2069  othing.        i
+0002a3a0: 6620 6c65 6e28 7365 6c66 2920 3d3d 2030  f len(self) == 0
+0002a3b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0002a3c0: 7475 726e 2073 656c 660a 0a20 2020 2020  turn self..     
+0002a3d0: 2020 2023 2043 6865 636b 2074 6865 2063     # Check the c
+0002a3e0: 6f6c 756d 6e20 6e61 6d65 0a20 2020 2020  olumn name.     
+0002a3f0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+0002a400: 616e 6365 2863 6f6c 756d 6e2c 2073 7472  ance(column, str
+0002a410: 2920 6f72 2063 6f6c 756d 6e20 6e6f 7420  ) or column not 
+0002a420: 696e 2073 656c 662e 5f64 6174 612e 636f  in self._data.co
+0002a430: 6c75 6d6e 5f6e 616d 6573 3a0a 2020 2020  lumn_names:.    
+0002a440: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0002a450: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+0002a460: 2020 2020 2020 2020 2020 6622 436f 6c75            f"Colu
+0002a470: 6d6e 2027 7b63 6f6c 756d 6e7d 2720 6e6f  mn '{column}' no
+0002a480: 7420 666f 756e 6420 696e 2074 6865 2064  t found in the d
+0002a490: 6174 6173 6574 2e20 506c 6561 7365 2070  ataset. Please p
+0002a4a0: 726f 7669 6465 2061 2063 6f6c 756d 6e20  rovide a column 
+0002a4b0: 7365 6c65 6374 6564 2069 6e3a 207b 7365  selected in: {se
+0002a4c0: 6c66 2e5f 6461 7461 2e63 6f6c 756d 6e5f  lf._data.column_
+0002a4d0: 6e61 6d65 737d 220a 2020 2020 2020 2020  names}".        
+0002a4e0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+0002a4f0: 2043 6865 636b 2069 6620 7765 2776 6520   Check if we've 
+0002a500: 616c 7265 6164 7920 6361 6368 6564 2074  already cached t
+0002a510: 6869 7320 636f 6d70 7574 6174 696f 6e20  his computation 
+0002a520: 2869 6e64 6578 6564 2062 7920 6120 6861  (indexed by a ha
+0002a530: 7368 290a 2020 2020 2020 2020 6966 2073  sh).        if s
+0002a540: 656c 662e 6361 6368 655f 6669 6c65 733a  elf.cache_files:
+0002a550: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002a560: 696e 6469 6365 735f 6361 6368 655f 6669  indices_cache_fi
+0002a570: 6c65 5f6e 616d 6520 6973 204e 6f6e 653a  le_name is None:
+0002a580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a590: 2023 2077 6520 6372 6561 7465 2061 2075   # we create a u
+0002a5a0: 6e69 7175 6520 6861 7368 2066 726f 6d20  nique hash from 
+0002a5b0: 7468 6520 6675 6e63 7469 6f6e 2c20 6375  the function, cu
+0002a5c0: 7272 656e 7420 6461 7461 7365 7420 6669  rrent dataset fi
+0002a5d0: 6c65 2061 6e64 2074 6865 206d 6170 7069  le and the mappi
+0002a5e0: 6e67 2061 7267 730a 2020 2020 2020 2020  ng args.        
+0002a5f0: 2020 2020 2020 2020 696e 6469 6365 735f          indices_
+0002a600: 6361 6368 655f 6669 6c65 5f6e 616d 6520  cache_file_name 
+0002a610: 3d20 7365 6c66 2e5f 6765 745f 6361 6368  = self._get_cach
+0002a620: 655f 6669 6c65 5f70 6174 6828 6e65 775f  e_file_path(new_
+0002a630: 6669 6e67 6572 7072 696e 7429 0a20 2020  fingerprint).   
+0002a640: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+0002a650: 6174 682e 6578 6973 7473 2869 6e64 6963  ath.exists(indic
+0002a660: 6573 5f63 6163 6865 5f66 696c 655f 6e61  es_cache_file_na
+0002a670: 6d65 2920 616e 6420 6c6f 6164 5f66 726f  me) and load_fro
+0002a680: 6d5f 6361 6368 655f 6669 6c65 3a0a 2020  m_cache_file:.  
+0002a690: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+0002a6a0: 6767 6572 2e77 6172 6e69 6e67 2866 224c  gger.warning(f"L
+0002a6b0: 6f61 6469 6e67 2063 6163 6865 6420 736f  oading cached so
+0002a6c0: 7274 6564 2069 6e64 6963 6573 2066 6f72  rted indices for
+0002a6d0: 2064 6174 6173 6574 2061 7420 7b69 6e64   dataset at {ind
+0002a6e0: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
+0002a6f0: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
+0002a700: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0002a710: 656c 662e 5f6e 6577 5f64 6174 6173 6574  elf._new_dataset
+0002a720: 5f77 6974 685f 696e 6469 6365 7328 0a20  _with_indices(. 
+0002a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a740: 2020 2066 696e 6765 7270 7269 6e74 3d6e     fingerprint=n
+0002a750: 6577 5f66 696e 6765 7270 7269 6e74 2c20  ew_fingerprint, 
+0002a760: 696e 6469 6365 735f 6361 6368 655f 6669  indices_cache_fi
+0002a770: 6c65 5f6e 616d 653d 696e 6469 6365 735f  le_name=indices_
+0002a780: 6361 6368 655f 6669 6c65 5f6e 616d 650a  cache_file_name.
+0002a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a7a0: 290a 0a20 2020 2020 2020 2063 6f6c 756d  )..        colum
+0002a7b0: 6e5f 6461 7461 203d 2073 656c 662e 5f67  n_data = self._g
+0002a7c0: 6574 6974 656d 280a 2020 2020 2020 2020  etitem(.        
+0002a7d0: 2020 2020 636f 6c75 6d6e 2c20 666f 726d      column, form
+0002a7e0: 6174 5f74 7970 653d 2270 616e 6461 7322  at_type="pandas"
+0002a7f0: 2c20 666f 726d 6174 5f63 6f6c 756d 6e73  , format_columns
+0002a800: 3d4e 6f6e 652c 206f 7574 7075 745f 616c  =None, output_al
+0002a810: 6c5f 636f 6c75 6d6e 733d 4661 6c73 652c  l_columns=False,
+0002a820: 2066 6f72 6d61 745f 6b77 6172 6773 3d4e   format_kwargs=N
+0002a830: 6f6e 650a 2020 2020 2020 2020 290a 0a20  one.        ).. 
+0002a840: 2020 2020 2020 2064 665f 736f 7274 6564         df_sorted
+0002a850: 203d 2063 6f6c 756d 6e5f 6461 7461 2e74   = column_data.t
+0002a860: 6f5f 6672 616d 6528 292e 736f 7274 5f76  o_frame().sort_v
+0002a870: 616c 7565 7328 0a20 2020 2020 2020 2020  alues(.         
+0002a880: 2020 2063 6f6c 756d 6e2c 2061 7363 656e     column, ascen
+0002a890: 6469 6e67 3d6e 6f74 2072 6576 6572 7365  ding=not reverse
+0002a8a0: 2c20 6b69 6e64 3d6b 696e 642c 206e 615f  , kind=kind, na_
+0002a8b0: 706f 7369 7469 6f6e 3d6e 756c 6c5f 706c  position=null_pl
+0002a8c0: 6163 656d 656e 740a 2020 2020 2020 2020  acement.        
+0002a8d0: 290a 2020 2020 2020 2020 696e 6469 6365  ).        indice
+0002a8e0: 7320 3d20 6466 5f73 6f72 7465 642e 696e  s = df_sorted.in
+0002a8f0: 6465 782e 746f 5f6e 756d 7079 2829 0a0a  dex.to_numpy()..
+0002a900: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0002a910: 656c 662e 7365 6c65 6374 280a 2020 2020  elf.select(.    
+0002a920: 2020 2020 2020 2020 696e 6469 6365 733d          indices=
+0002a930: 696e 6469 6365 732c 0a20 2020 2020 2020  indices,.       
+0002a940: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
+0002a950: 6f72 793d 6b65 6570 5f69 6e5f 6d65 6d6f  ory=keep_in_memo
+0002a960: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
+0002a970: 696e 6469 6365 735f 6361 6368 655f 6669  indices_cache_fi
+0002a980: 6c65 5f6e 616d 653d 696e 6469 6365 735f  le_name=indices_
+0002a990: 6361 6368 655f 6669 6c65 5f6e 616d 652c  cache_file_name,
+0002a9a0: 0a20 2020 2020 2020 2020 2020 2077 7269  .            wri
+0002a9b0: 7465 725f 6261 7463 685f 7369 7a65 3d77  ter_batch_size=w
+0002a9c0: 7269 7465 725f 6261 7463 685f 7369 7a65  riter_batch_size
+0002a9d0: 2c0a 2020 2020 2020 2020 2020 2020 6e65  ,.            ne
+0002a9e0: 775f 6669 6e67 6572 7072 696e 743d 6e65  w_fingerprint=ne
+0002a9f0: 775f 6669 6e67 6572 7072 696e 742c 0a20  w_fingerprint,. 
+0002aa00: 2020 2020 2020 2029 0a0a 2020 2020 4074         )..    @t
+0002aa10: 7261 6e73 6d69 745f 666f 726d 6174 0a20  ransmit_format. 
+0002aa20: 2020 2040 6669 6e67 6572 7072 696e 745f     @fingerprint_
+0002aa30: 7472 616e 7366 6f72 6d28 0a20 2020 2020  transform(.     
+0002aa40: 2020 2069 6e70 6c61 6365 3d46 616c 7365     inplace=False
+0002aa50: 2c20 7261 6e64 6f6d 697a 6564 5f66 756e  , randomized_fun
+0002aa60: 6374 696f 6e3d 5472 7565 2c20 6967 6e6f  ction=True, igno
+0002aa70: 7265 5f6b 7761 7267 733d 5b22 6c6f 6164  re_kwargs=["load
+0002aa80: 5f66 726f 6d5f 6361 6368 655f 6669 6c65  _from_cache_file
+0002aa90: 222c 2022 696e 6469 6365 735f 6361 6368  ", "indices_cach
+0002aaa0: 655f 6669 6c65 5f6e 616d 6522 5d0a 2020  e_file_name"].  
+0002aab0: 2020 290a 2020 2020 6465 6620 7368 7566    ).    def shuf
+0002aac0: 666c 6528 0a20 2020 2020 2020 2073 656c  fle(.        sel
+0002aad0: 662c 0a20 2020 2020 2020 2073 6565 643a  f,.        seed:
+0002aae0: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
+0002aaf0: 204e 6f6e 652c 0a20 2020 2020 2020 2067   None,.        g
+0002ab00: 656e 6572 6174 6f72 3a20 4f70 7469 6f6e  enerator: Option
+0002ab10: 616c 5b6e 702e 7261 6e64 6f6d 2e47 656e  al[np.random.Gen
+0002ab20: 6572 6174 6f72 5d20 3d20 4e6f 6e65 2c0a  erator] = None,.
+0002ab30: 2020 2020 2020 2020 6b65 6570 5f69 6e5f          keep_in_
+0002ab40: 6d65 6d6f 7279 3a20 626f 6f6c 203d 2046  memory: bool = F
+0002ab50: 616c 7365 2c0a 2020 2020 2020 2020 6c6f  alse,.        lo
+0002ab60: 6164 5f66 726f 6d5f 6361 6368 655f 6669  ad_from_cache_fi
+0002ab70: 6c65 3a20 626f 6f6c 203d 2054 7275 652c  le: bool = True,
+0002ab80: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
+0002ab90: 5f63 6163 6865 5f66 696c 655f 6e61 6d65  _cache_file_name
+0002aba0: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+0002abb0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0002abc0: 7772 6974 6572 5f62 6174 6368 5f73 697a  writer_batch_siz
+0002abd0: 653a 204f 7074 696f 6e61 6c5b 696e 745d  e: Optional[int]
+0002abe0: 203d 2031 3030 302c 0a20 2020 2020 2020   = 1000,.       
+0002abf0: 206e 6577 5f66 696e 6765 7270 7269 6e74   new_fingerprint
+0002ac00: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+0002ac10: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
+0002ac20: 2022 4461 7461 7365 7422 3a0a 2020 2020   "Dataset":.    
+0002ac30: 2020 2020 2222 2243 7265 6174 6520 6120      """Create a 
+0002ac40: 6e65 7720 4461 7461 7365 7420 7768 6572  new Dataset wher
+0002ac50: 6520 7468 6520 726f 7773 2061 7265 2073  e the rows are s
+0002ac60: 6875 6666 6c65 642e 0a0a 2020 2020 2020  huffled...      
+0002ac70: 2020 4375 7272 656e 746c 7920 7368 7566    Currently shuf
+0002ac80: 666c 696e 6720 7573 6573 206e 756d 7079  fling uses numpy
+0002ac90: 2072 616e 646f 6d20 6765 6e65 7261 746f   random generato
+0002aca0: 7273 2e0a 2020 2020 2020 2020 596f 7520  rs..        You 
+0002acb0: 6361 6e20 6569 7468 6572 2073 7570 706c  can either suppl
+0002acc0: 7920 6120 4e75 6d50 7920 4269 7447 656e  y a NumPy BitGen
+0002acd0: 6572 6174 6f72 2074 6f20 7573 652c 206f  erator to use, o
+0002ace0: 7220 6120 7365 6564 2074 6f20 696e 6974  r a seed to init
+0002acf0: 6961 7465 204e 756d 5079 2773 2064 6566  iate NumPy's def
+0002ad00: 6175 6c74 2072 616e 646f 6d20 6765 6e65  ault random gene
+0002ad10: 7261 746f 7220 2850 4347 3634 292e 0a0a  rator (PCG64)...
+0002ad20: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+0002ad30: 2020 2020 2020 2020 2020 7365 6564 2028            seed (
+0002ad40: 6069 6e74 602c 202a 6f70 7469 6f6e 616c  `int`, *optional
+0002ad50: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
+0002ad60: 2020 2020 4120 7365 6564 2074 6f20 696e      A seed to in
+0002ad70: 6974 6961 6c69 7a65 2074 6865 2064 6566  itialize the def
+0002ad80: 6175 6c74 2042 6974 4765 6e65 7261 746f  ault BitGenerato
+0002ad90: 7220 6966 2060 6765 6e65 7261 746f 723d  r if `generator=
+0002ada0: 4e6f 6e65 602e 0a20 2020 2020 2020 2020  None`..         
+0002adb0: 2020 2020 2020 2049 6620 604e 6f6e 6560         If `None`
+0002adc0: 2c20 7468 656e 2066 7265 7368 2c20 756e  , then fresh, un
+0002add0: 7072 6564 6963 7461 626c 6520 656e 7472  predictable entr
+0002ade0: 6f70 7920 7769 6c6c 2062 6520 7075 6c6c  opy will be pull
+0002adf0: 6564 2066 726f 6d20 7468 6520 4f53 2e0a  ed from the OS..
+0002ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ae10: 4966 2061 6e20 6069 6e74 6020 6f72 2060  If an `int` or `
+0002ae20: 6172 7261 795f 6c69 6b65 5b69 6e74 735d  array_like[ints]
+0002ae30: 6020 6973 2070 6173 7365 642c 2074 6865  ` is passed, the
+0002ae40: 6e20 6974 2077 696c 6c20 6265 2070 6173  n it will be pas
+0002ae50: 7365 6420 746f 2053 6565 6453 6571 7565  sed to SeedSeque
+0002ae60: 6e63 6520 746f 2064 6572 6976 6520 7468  nce to derive th
+0002ae70: 6520 696e 6974 6961 6c20 4269 7447 656e  e initial BitGen
+0002ae80: 6572 6174 6f72 2073 7461 7465 2e0a 2020  erator state..  
+0002ae90: 2020 2020 2020 2020 2020 6765 6e65 7261            genera
+0002aea0: 746f 7220 2860 6e75 6d70 792e 7261 6e64  tor (`numpy.rand
+0002aeb0: 6f6d 2e47 656e 6572 6174 6f72 602c 202a  om.Generator`, *
+0002aec0: 6f70 7469 6f6e 616c 2a29 3a0a 2020 2020  optional*):.    
+0002aed0: 2020 2020 2020 2020 2020 2020 4e75 6d70              Nump
+0002aee0: 7920 7261 6e64 6f6d 2047 656e 6572 6174  y random Generat
+0002aef0: 6f72 2074 6f20 7573 6520 746f 2063 6f6d  or to use to com
+0002af00: 7075 7465 2074 6865 2070 6572 6d75 7461  pute the permuta
+0002af10: 7469 6f6e 206f 6620 7468 6520 6461 7461  tion of the data
+0002af20: 7365 7420 726f 7773 2e0a 2020 2020 2020  set rows..      
+0002af30: 2020 2020 2020 2020 2020 4966 2060 6765            If `ge
+0002af40: 6e65 7261 746f 723d 4e6f 6e65 6020 2864  nerator=None` (d
+0002af50: 6566 6175 6c74 292c 2075 7365 7320 606e  efault), uses `n
+0002af60: 702e 7261 6e64 6f6d 2e64 6566 6175 6c74  p.random.default
+0002af70: 5f72 6e67 6020 2874 6865 2064 6566 6175  _rng` (the defau
+0002af80: 6c74 2042 6974 4765 6e65 7261 746f 7220  lt BitGenerator 
+0002af90: 2850 4347 3634 2920 6f66 204e 756d 5079  (PCG64) of NumPy
+0002afa0: 292e 0a20 2020 2020 2020 2020 2020 206b  )..            k
+0002afb0: 6565 705f 696e 5f6d 656d 6f72 7920 2860  eep_in_memory (`
+0002afc0: 626f 6f6c 602c 2064 6566 6175 6c74 2060  bool`, default `
+0002afd0: 4661 6c73 6560 293a 0a20 2020 2020 2020  False`):.       
+0002afe0: 2020 2020 2020 2020 204b 6565 7020 7468           Keep th
+0002aff0: 6520 7368 7566 666c 6564 2069 6e64 6963  e shuffled indic
+0002b000: 6573 2069 6e20 6d65 6d6f 7279 2069 6e73  es in memory ins
+0002b010: 7465 6164 206f 6620 7772 6974 696e 6720  tead of writing 
+0002b020: 6974 2074 6f20 6120 6361 6368 6520 6669  it to a cache fi
+0002b030: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
+0002b040: 6c6f 6164 5f66 726f 6d5f 6361 6368 655f  load_from_cache_
+0002b050: 6669 6c65 2028 6062 6f6f 6c60 2c20 6465  file (`bool`, de
+0002b060: 6661 756c 7473 2074 6f20 6054 7275 6560  faults to `True`
+0002b070: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0002b080: 2020 2049 6620 6120 6361 6368 6520 6669     If a cache fi
+0002b090: 6c65 2073 746f 7269 6e67 2074 6865 2073  le storing the s
+0002b0a0: 6875 6666 6c65 6420 696e 6469 6365 730a  huffled indices.
+0002b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b0c0: 6361 6e20 6265 2069 6465 6e74 6966 6965  can be identifie
+0002b0d0: 642c 2075 7365 2069 7420 696e 7374 6561  d, use it instea
+0002b0e0: 6420 6f66 2072 6563 6f6d 7075 7469 6e67  d of recomputing
+0002b0f0: 2e0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+0002b100: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
+0002b110: 5f6e 616d 6520 2860 7374 7260 2c20 2a6f  _name (`str`, *o
+0002b120: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
+0002b130: 2020 2020 2020 2020 2020 2050 726f 7669             Provi
+0002b140: 6465 2074 6865 206e 616d 6520 6f66 2061  de the name of a
+0002b150: 2070 6174 6820 666f 7220 7468 6520 6361   path for the ca
+0002b160: 6368 6520 6669 6c65 2e20 4974 2069 7320  che file. It is 
+0002b170: 7573 6564 2074 6f20 7374 6f72 6520 7468  used to store th
+0002b180: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0002b190: 2020 7368 7566 666c 6564 2069 6e64 6963    shuffled indic
+0002b1a0: 6573 2069 6e73 7465 6164 206f 6620 7468  es instead of th
+0002b1b0: 6520 6175 746f 6d61 7469 6361 6c6c 7920  e automatically 
+0002b1c0: 6765 6e65 7261 7465 6420 6361 6368 6520  generated cache 
+0002b1d0: 6669 6c65 206e 616d 652e 0a20 2020 2020  file name..     
+0002b1e0: 2020 2020 2020 2077 7269 7465 725f 6261         writer_ba
+0002b1f0: 7463 685f 7369 7a65 2028 6069 6e74 602c  tch_size (`int`,
+0002b200: 2064 6566 6175 6c74 7320 746f 2060 3130   defaults to `10
+0002b210: 3030 6029 3a0a 2020 2020 2020 2020 2020  00`):.          
+0002b220: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
+0002b230: 726f 7773 2070 6572 2077 7269 7465 206f  rows per write o
+0002b240: 7065 7261 7469 6f6e 2066 6f72 2074 6865  peration for the
+0002b250: 2063 6163 6865 2066 696c 6520 7772 6974   cache file writ
+0002b260: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
+0002b270: 2020 2020 5468 6973 2076 616c 7565 2069      This value i
+0002b280: 7320 6120 676f 6f64 2074 7261 6465 2d6f  s a good trade-o
+0002b290: 6666 2062 6574 7765 656e 206d 656d 6f72  ff between memor
+0002b2a0: 7920 7573 6167 6520 6475 7269 6e67 2074  y usage during t
+0002b2b0: 6865 2070 726f 6365 7373 696e 672c 2061  he processing, a
+0002b2c0: 6e64 2070 726f 6365 7373 696e 6720 7370  nd processing sp
+0002b2d0: 6565 642e 0a20 2020 2020 2020 2020 2020  eed..           
+0002b2e0: 2020 2020 2048 6967 6865 7220 7661 6c75       Higher valu
+0002b2f0: 6520 6d61 6b65 7320 7468 6520 7072 6f63  e makes the proc
+0002b300: 6573 7369 6e67 2064 6f20 6665 7765 7220  essing do fewer 
+0002b310: 6c6f 6f6b 7570 732c 206c 6f77 6572 2076  lookups, lower v
+0002b320: 616c 7565 2063 6f6e 7375 6d65 206c 6573  alue consume les
+0002b330: 7320 7465 6d70 6f72 6172 7920 6d65 6d6f  s temporary memo
+0002b340: 7279 2077 6869 6c65 2072 756e 6e69 6e67  ry while running
+0002b350: 2060 6d61 7060 2e0a 2020 2020 2020 2020   `map`..        
+0002b360: 2020 2020 6e65 775f 6669 6e67 6572 7072      new_fingerpr
+0002b370: 696e 7420 2860 7374 7260 2c20 2a6f 7074  int (`str`, *opt
+0002b380: 696f 6e61 6c2a 2c20 6465 6661 756c 7473  ional*, defaults
+0002b390: 2074 6f20 604e 6f6e 6560 293a 0a20 2020   to `None`):.   
+0002b3a0: 2020 2020 2020 2020 2020 2020 2054 6865               The
+0002b3b0: 206e 6577 2066 696e 6765 7270 7269 6e74   new fingerprint
+0002b3c0: 206f 6620 7468 6520 6461 7461 7365 7420   of the dataset 
+0002b3d0: 6166 7465 7220 7472 616e 7366 6f72 6d2e  after transform.
+0002b3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b3f0: 2049 6620 604e 6f6e 6560 2c20 7468 6520   If `None`, the 
+0002b400: 6e65 7720 6669 6e67 6572 7072 696e 7420  new fingerprint 
+0002b410: 6973 2063 6f6d 7075 7465 6420 7573 696e  is computed usin
+0002b420: 6720 6120 6861 7368 206f 6620 7468 6520  g a hash of the 
+0002b430: 7072 6576 696f 7573 2066 696e 6765 7270  previous fingerp
+0002b440: 7269 6e74 2c20 616e 6420 7468 6520 7472  rint, and the tr
+0002b450: 616e 7366 6f72 6d20 6172 6775 6d65 6e74  ansform argument
+0002b460: 732e 0a0a 2020 2020 2020 2020 4578 616d  s...        Exam
+0002b470: 706c 653a 0a0a 2020 2020 2020 2020 6060  ple:..        ``
+0002b480: 6070 790a 2020 2020 2020 2020 3e3e 3e20  `py.        >>> 
+0002b490: 6672 6f6d 2064 6174 6173 6574 7320 696d  from datasets im
+0002b4a0: 706f 7274 206c 6f61 645f 6461 7461 7365  port load_datase
+0002b4b0: 740a 2020 2020 2020 2020 3e3e 3e20 6473  t.        >>> ds
+0002b4c0: 203d 206c 6f61 645f 6461 7461 7365 7428   = load_dataset(
+0002b4d0: 2272 6f74 7465 6e5f 746f 6d61 746f 6573  "rotten_tomatoes
+0002b4e0: 222c 2073 706c 6974 3d22 7661 6c69 6461  ", split="valida
+0002b4f0: 7469 6f6e 2229 0a20 2020 2020 2020 203e  tion").        >
+0002b500: 3e3e 2064 735b 276c 6162 656c 275d 5b3a  >> ds['label'][:
+0002b510: 3130 5d0a 2020 2020 2020 2020 5b31 2c20  10].        [1, 
+0002b520: 312c 2031 2c20 312c 2031 2c20 312c 2031  1, 1, 1, 1, 1, 1
+0002b530: 2c20 312c 2031 2c20 315d 0a0a 2020 2020  , 1, 1, 1]..    
+0002b540: 2020 2020 2320 7365 7420 6120 7365 6564      # set a seed
+0002b550: 0a20 2020 2020 2020 203e 3e3e 2073 6875  .        >>> shu
+0002b560: 6666 6c65 645f 6473 203d 2064 732e 7368  ffled_ds = ds.sh
+0002b570: 7566 666c 6528 7365 6564 3d34 3229 0a20  uffle(seed=42). 
+0002b580: 2020 2020 2020 203e 3e3e 2073 6875 6666         >>> shuff
+0002b590: 6c65 645f 6473 5b27 6c61 6265 6c27 5d5b  led_ds['label'][
+0002b5a0: 3a31 305d 0a20 2020 2020 2020 205b 312c  :10].        [1,
+0002b5b0: 2030 2c20 312c 2031 2c20 302c 2030 2c20   0, 1, 1, 0, 0, 
+0002b5c0: 302c 2030 2c20 302c 2030 5d0a 2020 2020  0, 0, 0, 0].    
+0002b5d0: 2020 2020 6060 600a 2020 2020 2020 2020      ```.        
+0002b5e0: 2222 220a 2020 2020 2020 2020 6966 206c  """.        if l
+0002b5f0: 656e 2873 656c 662e 6c69 7374 5f69 6e64  en(self.list_ind
+0002b600: 6578 6573 2829 2920 3e20 303a 0a20 2020  exes()) > 0:.   
+0002b610: 2020 2020 2020 2020 2072 6169 7365 2044           raise D
+0002b620: 6174 6173 6574 5472 616e 7366 6f72 6d61  atasetTransforma
+0002b630: 7469 6f6e 4e6f 7441 6c6c 6f77 6564 4572  tionNotAllowedEr
+0002b640: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0002b650: 2020 2020 2022 5573 696e 6720 602e 7368       "Using `.sh
+0002b660: 7566 666c 6560 206f 6e20 6120 6461 7461  uffle` on a data
+0002b670: 7365 7420 7769 7468 2061 7474 6163 6865  set with attache
+0002b680: 6420 696e 6465 7865 7320 6973 206e 6f74  d indexes is not
+0002b690: 2061 6c6c 6f77 6564 2e20 596f 7520 6361   allowed. You ca
+0002b6a0: 6e20 6669 7273 7420 7275 6e20 602e 6472  n first run `.dr
+0002b6b0: 6f70 5f69 6e64 6578 2829 2074 6f20 7265  op_index() to re
+0002b6c0: 6d6f 7665 2079 6f75 7220 696e 6465 7820  move your index 
+0002b6d0: 616e 6420 7468 656e 2072 652d 6164 6420  and then re-add 
+0002b6e0: 6974 2e22 0a20 2020 2020 2020 2020 2020  it.".           
+0002b6f0: 2029 0a20 2020 2020 2020 2023 2049 6620   ).        # If 
+0002b700: 7468 6520 6172 7261 7920 6973 2065 6d70  the array is emp
+0002b710: 7479 2077 6520 646f 206e 6f74 6869 6e67  ty we do nothing
+0002b720: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0002b730: 7365 6c66 2920 3d3d 2030 3a0a 2020 2020  self) == 0:.    
+0002b740: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0002b750: 656c 660a 0a20 2020 2020 2020 2069 6620  elf..        if 
+0002b760: 6b65 6570 5f69 6e5f 6d65 6d6f 7279 2061  keep_in_memory a
+0002b770: 6e64 2069 6e64 6963 6573 5f63 6163 6865  nd indices_cache
+0002b780: 5f66 696c 655f 6e61 6d65 2069 7320 6e6f  _file_name is no
+0002b790: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0002b7a0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0002b7b0: 7272 6f72 2822 506c 6561 7365 2075 7365  rror("Please use
+0002b7c0: 2065 6974 6865 7220 606b 6565 705f 696e   either `keep_in
+0002b7d0: 5f6d 656d 6f72 7960 206f 7220 6069 6e64  _memory` or `ind
+0002b7e0: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
+0002b7f0: 6e61 6d65 6020 6275 7420 6e6f 7420 626f  name` but not bo
+0002b800: 7468 2e22 290a 0a20 2020 2020 2020 2069  th.")..        i
+0002b810: 6620 7365 6564 2069 7320 6e6f 7420 4e6f  f seed is not No
+0002b820: 6e65 2061 6e64 2067 656e 6572 6174 6f72  ne and generator
+0002b830: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0002b840: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0002b850: 5661 6c75 6545 7272 6f72 2822 426f 7468  ValueError("Both
+0002b860: 2060 7365 6564 6020 616e 6420 6067 656e   `seed` and `gen
+0002b870: 6572 6174 6f72 6020 7765 7265 2070 726f  erator` were pro
+0002b880: 7669 6465 642e 2050 6c65 6173 6520 7370  vided. Please sp
+0002b890: 6563 6966 7920 6a75 7374 206f 6e65 206f  ecify just one o
+0002b8a0: 6620 7468 656d 2e22 290a 0a20 2020 2020  f them.")..     
+0002b8b0: 2020 2069 6620 6765 6e65 7261 746f 7220     if generator 
+0002b8c0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+0002b8d0: 6e6f 7420 6973 696e 7374 616e 6365 2867  not isinstance(g
+0002b8e0: 656e 6572 6174 6f72 2c20 6e70 2e72 616e  enerator, np.ran
+0002b8f0: 646f 6d2e 4765 6e65 7261 746f 7229 3a0a  dom.Generator):.
+0002b900: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0002b910: 6520 5661 6c75 6545 7272 6f72 2822 5468  e ValueError("Th
+0002b920: 6520 7072 6f76 6964 6564 2067 656e 6572  e provided gener
+0002b930: 6174 6f72 206d 7573 7420 6265 2061 6e20  ator must be an 
+0002b940: 696e 7374 616e 6365 206f 6620 6e75 6d70  instance of nump
+0002b950: 792e 7261 6e64 6f6d 2e47 656e 6572 6174  y.random.Generat
+0002b960: 6f72 2229 0a0a 2020 2020 2020 2020 6966  or")..        if
+0002b970: 2067 656e 6572 6174 6f72 2069 7320 4e6f   generator is No
+0002b980: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0002b990: 6966 2073 6565 6420 6973 204e 6f6e 653a  if seed is None:
+0002b9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b9b0: 205f 2c20 7365 6564 2c20 706f 732c 202a   _, seed, pos, *
+0002b9c0: 5f20 3d20 6e70 2e72 616e 646f 6d2e 6765  _ = np.random.ge
+0002b9d0: 745f 7374 6174 6528 290a 2020 2020 2020  t_state().      
+0002b9e0: 2020 2020 2020 2020 2020 7365 6564 203d            seed =
+0002b9f0: 2073 6565 645b 706f 735d 2069 6620 706f   seed[pos] if po
+0002ba00: 7320 3c20 3632 3420 656c 7365 2073 6565  s < 624 else see
+0002ba10: 645b 305d 0a20 2020 2020 2020 2020 2020  d[0].           
+0002ba20: 2020 2020 205f 203d 206e 702e 7261 6e64       _ = np.rand
+0002ba30: 6f6d 2e72 616e 646f 6d28 2920 2023 2064  om.random()  # d
+0002ba40: 6f20 3120 7374 6570 206f 6620 726e 670a  o 1 step of rng.
+0002ba50: 2020 2020 2020 2020 2020 2020 6765 6e65              gene
+0002ba60: 7261 746f 7220 3d20 6e70 2e72 616e 646f  rator = np.rando
+0002ba70: 6d2e 6465 6661 756c 745f 726e 6728 7365  m.default_rng(se
+0002ba80: 6564 290a 0a20 2020 2020 2020 2023 2043  ed)..        # C
+0002ba90: 6865 636b 2069 6620 7765 2776 6520 616c  heck if we've al
+0002baa0: 7265 6164 7920 6361 6368 6564 2074 6869  ready cached thi
+0002bab0: 7320 636f 6d70 7574 6174 696f 6e20 2869  s computation (i
+0002bac0: 6e64 6578 6564 2062 7920 6120 6861 7368  ndexed by a hash
+0002bad0: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
+0002bae0: 662e 6361 6368 655f 6669 6c65 733a 0a20  f.cache_files:. 
+0002baf0: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+0002bb00: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
+0002bb10: 5f6e 616d 6520 6973 204e 6f6e 653a 0a20  _name is None:. 
+0002bb20: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0002bb30: 2077 6520 6372 6561 7465 2061 2075 6e69   we create a uni
+0002bb40: 7175 6520 6861 7368 2066 726f 6d20 7468  que hash from th
+0002bb50: 6520 6675 6e63 7469 6f6e 2c20 6375 7272  e function, curr
+0002bb60: 656e 7420 6461 7461 7365 7420 6669 6c65  ent dataset file
+0002bb70: 2061 6e64 2074 6865 206d 6170 7069 6e67   and the mapping
+0002bb80: 2061 7267 730a 2020 2020 2020 2020 2020   args.          
+0002bb90: 2020 2020 2020 696e 6469 6365 735f 6361        indices_ca
+0002bba0: 6368 655f 6669 6c65 5f6e 616d 6520 3d20  che_file_name = 
+0002bbb0: 7365 6c66 2e5f 6765 745f 6361 6368 655f  self._get_cache_
+0002bbc0: 6669 6c65 5f70 6174 6828 6e65 775f 6669  file_path(new_fi
+0002bbd0: 6e67 6572 7072 696e 7429 0a20 2020 2020  ngerprint).     
+0002bbe0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+0002bbf0: 682e 6578 6973 7473 2869 6e64 6963 6573  h.exists(indices
+0002bc00: 5f63 6163 6865 5f66 696c 655f 6e61 6d65  _cache_file_name
+0002bc10: 2920 616e 6420 6c6f 6164 5f66 726f 6d5f  ) and load_from_
+0002bc20: 6361 6368 655f 6669 6c65 3a0a 2020 2020  cache_file:.    
+0002bc30: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0002bc40: 6572 2e77 6172 6e69 6e67 2866 224c 6f61  er.warning(f"Loa
+0002bc50: 6469 6e67 2063 6163 6865 6420 7368 7566  ding cached shuf
+0002bc60: 666c 6564 2069 6e64 6963 6573 2066 6f72  fled indices for
+0002bc70: 2064 6174 6173 6574 2061 7420 7b69 6e64   dataset at {ind
+0002bc80: 6963 6573 5f63 6163 6865 5f66 696c 655f  ices_cache_file_
+0002bc90: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
+0002bca0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0002bcb0: 656c 662e 5f6e 6577 5f64 6174 6173 6574  elf._new_dataset
+0002bcc0: 5f77 6974 685f 696e 6469 6365 7328 0a20  _with_indices(. 
+0002bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bce0: 2020 2066 696e 6765 7270 7269 6e74 3d6e     fingerprint=n
+0002bcf0: 6577 5f66 696e 6765 7270 7269 6e74 2c20  ew_fingerprint, 
+0002bd00: 696e 6469 6365 735f 6361 6368 655f 6669  indices_cache_fi
+0002bd10: 6c65 5f6e 616d 653d 696e 6469 6365 735f  le_name=indices_
+0002bd20: 6361 6368 655f 6669 6c65 5f6e 616d 650a  cache_file_name.
+0002bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bd40: 290a 0a20 2020 2020 2020 2070 6572 6d75  )..        permu
+0002bd50: 7461 7469 6f6e 203d 2067 656e 6572 6174  tation = generat
+0002bd60: 6f72 2e70 6572 6d75 7461 7469 6f6e 286c  or.permutation(l
+0002bd70: 656e 2873 656c 6629 290a 0a20 2020 2020  en(self))..     
+0002bd80: 2020 2072 6574 7572 6e20 7365 6c66 2e73     return self.s
+0002bd90: 656c 6563 7428 0a20 2020 2020 2020 2020  elect(.         
+0002bda0: 2020 2069 6e64 6963 6573 3d70 6572 6d75     indices=permu
+0002bdb0: 7461 7469 6f6e 2c0a 2020 2020 2020 2020  tation,.        
+0002bdc0: 2020 2020 6b65 6570 5f69 6e5f 6d65 6d6f      keep_in_memo
+0002bdd0: 7279 3d6b 6565 705f 696e 5f6d 656d 6f72  ry=keep_in_memor
+0002bde0: 792c 0a20 2020 2020 2020 2020 2020 2069  y,.            i
+0002bdf0: 6e64 6963 6573 5f63 6163 6865 5f66 696c  ndices_cache_fil
+0002be00: 655f 6e61 6d65 3d69 6e64 6963 6573 5f63  e_name=indices_c
+0002be10: 6163 6865 5f66 696c 655f 6e61 6d65 2069  ache_file_name i
+0002be20: 6620 6e6f 7420 6b65 6570 5f69 6e5f 6d65  f not keep_in_me
+0002be30: 6d6f 7279 2065 6c73 6520 4e6f 6e65 2c0a  mory else None,.
+0002be40: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+0002be50: 6572 5f62 6174 6368 5f73 697a 653d 7772  er_batch_size=wr
+0002be60: 6974 6572 5f62 6174 6368 5f73 697a 652c  iter_batch_size,
+0002be70: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+0002be80: 5f66 696e 6765 7270 7269 6e74 3d6e 6577  _fingerprint=new
+0002be90: 5f66 696e 6765 7270 7269 6e74 2c0a 2020  _fingerprint,.  
+0002bea0: 2020 2020 2020 290a 0a20 2020 2040 7472        )..    @tr
+0002beb0: 616e 736d 6974 5f66 6f72 6d61 740a 2020  ansmit_format.  
+0002bec0: 2020 4066 696e 6765 7270 7269 6e74 5f74    @fingerprint_t
+0002bed0: 7261 6e73 666f 726d 280a 2020 2020 2020  ransform(.      
+0002bee0: 2020 696e 706c 6163 653d 4661 6c73 652c    inplace=False,
+0002bef0: 0a20 2020 2020 2020 2072 616e 646f 6d69  .        randomi
+0002bf00: 7a65 645f 6675 6e63 7469 6f6e 3d54 7275  zed_function=Tru
+0002bf10: 652c 0a20 2020 2020 2020 2066 696e 6765  e,.        finge
+0002bf20: 7270 7269 6e74 5f6e 616d 6573 3d5b 2274  rprint_names=["t
+0002bf30: 7261 696e 5f6e 6577 5f66 696e 6765 7270  rain_new_fingerp
+0002bf40: 7269 6e74 222c 2022 7465 7374 5f6e 6577  rint", "test_new
+0002bf50: 5f66 696e 6765 7270 7269 6e74 225d 2c0a  _fingerprint"],.
+0002bf60: 2020 2020 2020 2020 6967 6e6f 7265 5f6b          ignore_k
+0002bf70: 7761 7267 733d 5b22 6c6f 6164 5f66 726f  wargs=["load_fro
+0002bf80: 6d5f 6361 6368 655f 6669 6c65 222c 2022  m_cache_file", "
+0002bf90: 7472 6169 6e5f 696e 6469 6365 735f 6361  train_indices_ca
+0002bfa0: 6368 655f 6669 6c65 5f6e 616d 6522 2c20  che_file_name", 
+0002bfb0: 2274 6573 745f 696e 6469 6365 735f 6361  "test_indices_ca
+0002bfc0: 6368 655f 6669 6c65 5f6e 616d 6522 5d2c  che_file_name"],
+0002bfd0: 0a20 2020 2029 0a20 2020 2064 6566 2074  .    ).    def t
+0002bfe0: 7261 696e 5f74 6573 745f 7370 6c69 7428  rain_test_split(
+0002bff0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+0002c000: 2020 2020 2020 2074 6573 745f 7369 7a65         test_size
+0002c010: 3a20 556e 696f 6e5b 666c 6f61 742c 2069  : Union[float, i
+0002c020: 6e74 2c20 4e6f 6e65 5d20 3d20 4e6f 6e65  nt, None] = None
+0002c030: 2c0a 2020 2020 2020 2020 7472 6169 6e5f  ,.        train_
+0002c040: 7369 7a65 3a20 556e 696f 6e5b 666c 6f61  size: Union[floa
+0002c050: 742c 2069 6e74 2c20 4e6f 6e65 5d20 3d20  t, int, None] = 
+0002c060: 4e6f 6e65 2c0a 2020 2020 2020 2020 7368  None,.        sh
+0002c070: 7566 666c 653a 2062 6f6f 6c20 3d20 5472  uffle: bool = Tr
+0002c080: 7565 2c0a 2020 2020 2020 2020 7374 7261  ue,.        stra
+0002c090: 7469 6679 5f62 795f 636f 6c75 6d6e 3a20  tify_by_column: 
+0002c0a0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+0002c0b0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7365  None,.        se
+0002c0c0: 6564 3a20 4f70 7469 6f6e 616c 5b69 6e74  ed: Optional[int
+0002c0d0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0002c0e0: 2020 6765 6e65 7261 746f 723a 204f 7074    generator: Opt
+0002c0f0: 696f 6e61 6c5b 6e70 2e72 616e 646f 6d2e  ional[np.random.
+0002c100: 4765 6e65 7261 746f 725d 203d 204e 6f6e  Generator] = Non
+0002c110: 652c 0a20 2020 2020 2020 206b 6565 705f  e,.        keep_
+0002c120: 696e 5f6d 656d 6f72 793a 2062 6f6f 6c20  in_memory: bool 
+0002c130: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+0002c140: 206c 6f61 645f 6672 6f6d 5f63 6163 6865   load_from_cache
+0002c150: 5f66 696c 653a 2062 6f6f 6c20 3d20 5472  _file: bool = Tr
+0002c160: 7565 2c0a 2020 2020 2020 2020 7472 6169  ue,.        trai
+0002c170: 6e5f 696e 6469 6365 735f 6361 6368 655f  n_indices_cache_
+0002c180: 6669 6c65 5f6e 616d 653a 204f 7074 696f  file_name: Optio
+0002c190: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+0002c1a0: 0a20 2020 2020 2020 2074 6573 745f 696e  .        test_in
+0002c1b0: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
+0002c1c0: 5f6e 616d 653a 204f 7074 696f 6e61 6c5b  _name: Optional[
+0002c1d0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+0002c1e0: 2020 2020 2077 7269 7465 725f 6261 7463       writer_batc
+0002c1f0: 685f 7369 7a65 3a20 4f70 7469 6f6e 616c  h_size: Optional
+0002c200: 5b69 6e74 5d20 3d20 3130 3030 2c0a 2020  [int] = 1000,.  
+0002c210: 2020 2020 2020 7472 6169 6e5f 6e65 775f        train_new_
+0002c220: 6669 6e67 6572 7072 696e 743a 204f 7074  fingerprint: Opt
+0002c230: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0002c240: 652c 0a20 2020 2020 2020 2074 6573 745f  e,.        test_
+0002c250: 6e65 775f 6669 6e67 6572 7072 696e 743a  new_fingerprint:
+0002c260: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+0002c270: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
+0002c280: 2244 6174 6173 6574 4469 6374 223a 0a20  "DatasetDict":. 
+0002c290: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+0002c2a0: 2061 2064 6963 7469 6f6e 6172 7920 285b   a dictionary ([
+0002c2b0: 6064 6174 6173 6574 732e 4461 7461 7365  `datasets.Datase
+0002c2c0: 7444 6963 7460 5d29 2077 6974 6820 7477  tDict`]) with tw
+0002c2d0: 6f20 7261 6e64 6f6d 2074 7261 696e 2061  o random train a
+0002c2e0: 6e64 2074 6573 7420 7375 6273 6574 7320  nd test subsets 
+0002c2f0: 2860 7472 6169 6e60 2061 6e64 2060 7465  (`train` and `te
+0002c300: 7374 6020 6044 6174 6173 6574 6020 7370  st` `Dataset` sp
+0002c310: 6c69 7473 292e 0a20 2020 2020 2020 2053  lits)..        S
+0002c320: 706c 6974 7320 6172 6520 6372 6561 7465  plits are create
+0002c330: 6420 6672 6f6d 2074 6865 2064 6174 6173  d from the datas
+0002c340: 6574 2061 6363 6f72 6469 6e67 2074 6f20  et according to 
+0002c350: 6074 6573 745f 7369 7a65 602c 2060 7472  `test_size`, `tr
+0002c360: 6169 6e5f 7369 7a65 6020 616e 6420 6073  ain_size` and `s
+0002c370: 6875 6666 6c65 602e 0a0a 2020 2020 2020  huffle`...      
+0002c380: 2020 5468 6973 206d 6574 686f 6420 6973    This method is
+0002c390: 2073 696d 696c 6172 2074 6f20 7363 696b   similar to scik
+0002c3a0: 6974 2d6c 6561 726e 2060 7472 6169 6e5f  it-learn `train_
+0002c3b0: 7465 7374 5f73 706c 6974 602e 0a0a 2020  test_split`...  
+0002c3c0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+0002c3d0: 2020 2020 2020 2020 7465 7374 5f73 697a          test_siz
+0002c3e0: 6520 2860 6e75 6d70 792e 7261 6e64 6f6d  e (`numpy.random
+0002c3f0: 2e47 656e 6572 6174 6f72 602c 202a 6f70  .Generator`, *op
+0002c400: 7469 6f6e 616c 2a29 3a0a 2020 2020 2020  tional*):.      
+0002c410: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
+0002c420: 6620 7468 6520 7465 7374 2073 706c 6974  f the test split
+0002c430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c440: 2049 6620 6066 6c6f 6174 602c 2073 686f   If `float`, sho
+0002c450: 756c 6420 6265 2062 6574 7765 656e 2060  uld be between `
+0002c460: 302e 3060 2061 6e64 2060 312e 3060 2061  0.0` and `1.0` a
+0002c470: 6e64 2072 6570 7265 7365 6e74 2074 6865  nd represent the
+0002c480: 2070 726f 706f 7274 696f 6e20 6f66 2074   proportion of t
+0002c490: 6865 2064 6174 6173 6574 2074 6f20 696e  he dataset to in
+0002c4a0: 636c 7564 6520 696e 2074 6865 2074 6573  clude in the tes
+0002c4b0: 7420 7370 6c69 742e 0a20 2020 2020 2020  t split..       
+0002c4c0: 2020 2020 2020 2020 2049 6620 6069 6e74           If `int
+0002c4d0: 602c 2072 6570 7265 7365 6e74 7320 7468  `, represents th
+0002c4e0: 6520 6162 736f 6c75 7465 206e 756d 6265  e absolute numbe
+0002c4f0: 7220 6f66 2074 6573 7420 7361 6d70 6c65  r of test sample
+0002c500: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
+0002c510: 2020 2049 6620 604e 6f6e 6560 2c20 7468     If `None`, th
+0002c520: 6520 7661 6c75 6520 6973 2073 6574 2074  e value is set t
+0002c530: 6f20 7468 6520 636f 6d70 6c65 6d65 6e74  o the complement
+0002c540: 206f 6620 7468 6520 7472 6169 6e20 7369   of the train si
+0002c550: 7a65 2e0a 2020 2020 2020 2020 2020 2020  ze..            
+0002c560: 2020 2020 4966 2060 7472 6169 6e5f 7369      If `train_si
+0002c570: 7a65 6020 6973 2061 6c73 6f20 604e 6f6e  ze` is also `Non
+0002c580: 6560 2c20 6974 2077 696c 6c20 6265 2073  e`, it will be s
+0002c590: 6574 2074 6f20 6030 2e32 3560 2e0a 2020  et to `0.25`..  
+0002c5a0: 2020 2020 2020 2020 2020 7472 6169 6e5f            train_
+0002c5b0: 7369 7a65 2028 606e 756d 7079 2e72 616e  size (`numpy.ran
+0002c5c0: 646f 6d2e 4765 6e65 7261 746f 7260 2c20  dom.Generator`, 
+0002c5d0: 2a6f 7074 696f 6e61 6c2a 293a 0a20 2020  *optional*):.   
+0002c5e0: 2020 2020 2020 2020 2020 2020 2053 697a               Siz
+0002c5f0: 6520 6f66 2074 6865 2074 7261 696e 2073  e of the train s
+0002c600: 706c 6974 0a20 2020 2020 2020 2020 2020  plit.           
+0002c610: 2020 2020 2049 6620 6066 6c6f 6174 602c       If `float`,
+0002c620: 2073 686f 756c 6420 6265 2062 6574 7765   should be betwe
+0002c630: 656e 2060 302e 3060 2061 6e64 2060 312e  en `0.0` and `1.
+0002c640: 3060 2061 6e64 2072 6570 7265 7365 6e74  0` and represent
+0002c650: 2074 6865 2070 726f 706f 7274 696f 6e20   the proportion 
+0002c660: 6f66 2074 6865 2064 6174 6173 6574 2074  of the dataset t
+0002c670: 6f20 696e 636c 7564 6520 696e 2074 6865  o include in the
+0002c680: 2074 7261 696e 2073 706c 6974 2e0a 2020   train split..  
+0002c690: 2020 2020 2020 2020 2020 2020 2020 4966                If
+0002c6a0: 2060 696e 7460 2c20 7265 7072 6573 656e   `int`, represen
+0002c6b0: 7473 2074 6865 2061 6273 6f6c 7574 6520  ts the absolute 
+0002c6c0: 6e75 6d62 6572 206f 6620 7472 6169 6e20  number of train 
+0002c6d0: 7361 6d70 6c65 732e 0a20 2020 2020 2020  samples..       
+0002c6e0: 2020 2020 2020 2020 2049 6620 604e 6f6e           If `Non
+0002c6f0: 6560 2c20 7468 6520 7661 6c75 6520 6973  e`, the value is
+0002c700: 2061 7574 6f6d 6174 6963 616c 6c79 2073   automatically s
+0002c710: 6574 2074 6f20 7468 6520 636f 6d70 6c65  et to the comple
+0002c720: 6d65 6e74 206f 6620 7468 6520 7465 7374  ment of the test
+0002c730: 2073 697a 652e 0a20 2020 2020 2020 2020   size..         
+0002c740: 2020 2073 6875 6666 6c65 2028 6062 6f6f     shuffle (`boo
+0002c750: 6c60 2c20 2a6f 7074 696f 6e61 6c2a 2c20  l`, *optional*, 
+0002c760: 6465 6661 756c 7473 2074 6f20 6054 7275  defaults to `Tru
+0002c770: 6560 293a 0a20 2020 2020 2020 2020 2020  e`):.           
+0002c780: 2020 2020 2057 6865 7468 6572 206f 7220       Whether or 
+0002c790: 6e6f 7420 746f 2073 6875 6666 6c65 2074  not to shuffle t
+0002c7a0: 6865 2064 6174 6120 6265 666f 7265 2073  he data before s
+0002c7b0: 706c 6974 7469 6e67 2e0a 2020 2020 2020  plitting..      
+0002c7c0: 2020 2020 2020 7374 7261 7469 6679 5f62        stratify_b
+0002c7d0: 795f 636f 6c75 6d6e 2028 6073 7472 602c  y_column (`str`,
+0002c7e0: 202a 6f70 7469 6f6e 616c 2a2c 2064 6566   *optional*, def
+0002c7f0: 6175 6c74 7320 746f 2060 4e6f 6e65 6029  aults to `None`)
+0002c800: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002c810: 2020 5468 6520 636f 6c75 6d6e 206e 616d    The column nam
+0002c820: 6520 6f66 206c 6162 656c 7320 746f 2062  e of labels to b
+0002c830: 6520 7573 6564 2074 6f20 7065 7266 6f72  e used to perfor
+0002c840: 6d20 7374 7261 7469 6669 6564 2073 706c  m stratified spl
+0002c850: 6974 206f 6620 6461 7461 2e0a 2020 2020  it of data..    
+0002c860: 2020 2020 2020 2020 7365 6564 2028 6069          seed (`i
+0002c870: 6e74 602c 202a 6f70 7469 6f6e 616c 2a29  nt`, *optional*)
+0002c880: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002c890: 2020 4120 7365 6564 2074 6f20 696e 6974    A seed to init
+0002c8a0: 6961 6c69 7a65 2074 6865 2064 6566 6175  ialize the defau
+0002c8b0: 6c74 2042 6974 4765 6e65 7261 746f 7220  lt BitGenerator 
+0002c8c0: 6966 2060 6765 6e65 7261 746f 723d 4e6f  if `generator=No
+0002c8d0: 6e65 602e 0a20 2020 2020 2020 2020 2020  ne`..           
+0002c8e0: 2020 2020 2049 6620 604e 6f6e 6560 2c20       If `None`, 
+0002c8f0: 7468 656e 2066 7265 7368 2c20 756e 7072  then fresh, unpr
+0002c900: 6564 6963 7461 626c 6520 656e 7472 6f70  edictable entrop
+0002c910: 7920 7769 6c6c 2062 6520 7075 6c6c 6564  y will be pulled
+0002c920: 2066 726f 6d20 7468 6520 4f53 2e0a 2020   from the OS..  
+0002c930: 2020 2020 2020 2020 2020 2020 2020 4966                If
+0002c940: 2061 6e20 6069 6e74 6020 6f72 2060 6172   an `int` or `ar
+0002c950: 7261 795f 6c69 6b65 5b69 6e74 735d 6020  ray_like[ints]` 
+0002c960: 6973 2070 6173 7365 642c 2074 6865 6e20  is passed, then 
+0002c970: 6974 2077 696c 6c20 6265 2070 6173 7365  it will be passe
+0002c980: 6420 746f 2053 6565 6453 6571 7565 6e63  d to SeedSequenc
+0002c990: 6520 746f 2064 6572 6976 6520 7468 6520  e to derive the 
+0002c9a0: 696e 6974 6961 6c20 4269 7447 656e 6572  initial BitGener
+0002c9b0: 6174 6f72 2073 7461 7465 2e0a 2020 2020  ator state..    
+0002c9c0: 2020 2020 2020 2020 6765 6e65 7261 746f          generato
+0002c9d0: 7220 2860 6e75 6d70 792e 7261 6e64 6f6d  r (`numpy.random
+0002c9e0: 2e47 656e 6572 6174 6f72 602c 202a 6f70  .Generator`, *op
+0002c9f0: 7469 6f6e 616c 2a29 3a0a 2020 2020 2020  tional*):.      
+0002ca00: 2020 2020 2020 2020 2020 4e75 6d70 7920            Numpy 
+0002ca10: 7261 6e64 6f6d 2047 656e 6572 6174 6f72  random Generator
+0002ca20: 2074 6f20 7573 6520 746f 2063 6f6d 7075   to use to compu
+0002ca30: 7465 2074 6865 2070 6572 6d75 7461 7469  te the permutati
+0002ca40: 6f6e 206f 6620 7468 6520 6461 7461 7365  on of the datase
+0002ca50: 7420 726f 7773 2e0a 2020 2020 2020 2020  t rows..        
+0002ca60: 2020 2020 2020 2020 4966 2060 6765 6e65          If `gene
+0002ca70: 7261 746f 723d 4e6f 6e65 6020 2864 6566  rator=None` (def
+0002ca80: 6175 6c74 292c 2075 7365 7320 606e 702e  ault), uses `np.
+0002ca90: 7261 6e64 6f6d 2e64 6566 6175 6c74 5f72  random.default_r
+0002caa0: 6e67 6020 2874 6865 2064 6566 6175 6c74  ng` (the default
+0002cab0: 2042 6974 4765 6e65 7261 746f 7220 2850   BitGenerator (P
+0002cac0: 4347 3634 2920 6f66 204e 756d 5079 292e  CG64) of NumPy).
+0002cad0: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
+0002cae0: 705f 696e 5f6d 656d 6f72 7920 2860 626f  p_in_memory (`bo
+0002caf0: 6f6c 602c 2064 6566 6175 6c74 7320 746f  ol`, defaults to
+0002cb00: 2060 4661 6c73 6560 293a 0a20 2020 2020   `False`):.     
+0002cb10: 2020 2020 2020 2020 2020 204b 6565 7020             Keep 
+0002cb20: 7468 6520 7370 6c69 7473 2069 6e64 6963  the splits indic
+0002cb30: 6573 2069 6e20 6d65 6d6f 7279 2069 6e73  es in memory ins
+0002cb40: 7465 6164 206f 6620 7772 6974 696e 6720  tead of writing 
+0002cb50: 6974 2074 6f20 6120 6361 6368 6520 6669  it to a cache fi
+0002cb60: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
+0002cb70: 6c6f 6164 5f66 726f 6d5f 6361 6368 655f  load_from_cache_
+0002cb80: 6669 6c65 2028 6062 6f6f 6c60 2c20 6465  file (`bool`, de
+0002cb90: 6661 756c 7473 2074 6f20 6054 7275 6560  faults to `True`
+0002cba0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0002cbb0: 2020 2049 6620 6120 6361 6368 6520 6669     If a cache fi
+0002cbc0: 6c65 2073 746f 7269 6e67 2074 6865 2073  le storing the s
+0002cbd0: 706c 6974 7320 696e 6469 6365 730a 2020  plits indices.  
+0002cbe0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+0002cbf0: 6e20 6265 2069 6465 6e74 6966 6965 642c  n be identified,
+0002cc00: 2075 7365 2069 7420 696e 7374 6561 6420   use it instead 
+0002cc10: 6f66 2072 6563 6f6d 7075 7469 6e67 2e0a  of recomputing..
+0002cc20: 2020 2020 2020 2020 2020 2020 7472 6169              trai
+0002cc30: 6e5f 6361 6368 655f 6669 6c65 5f6e 616d  n_cache_file_nam
+0002cc40: 6520 2860 7374 7260 2c20 2a6f 7074 696f  e (`str`, *optio
+0002cc50: 6e61 6c2a 293a 0a20 2020 2020 2020 2020  nal*):.         
+0002cc60: 2020 2020 2020 2050 726f 7669 6465 2074         Provide t
+0002cc70: 6865 206e 616d 6520 6f66 2061 2070 6174  he name of a pat
+0002cc80: 6820 666f 7220 7468 6520 6361 6368 6520  h for the cache 
+0002cc90: 6669 6c65 2e20 4974 2069 7320 7573 6564  file. It is used
+0002cca0: 2074 6f20 7374 6f72 6520 7468 650a 2020   to store the.  
+0002ccb0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+0002ccc0: 6169 6e20 7370 6c69 7420 696e 6469 6365  ain split indice
+0002ccd0: 7320 696e 7374 6561 6420 6f66 2074 6865  s instead of the
+0002cce0: 2061 7574 6f6d 6174 6963 616c 6c79 2067   automatically g
+0002ccf0: 656e 6572 6174 6564 2063 6163 6865 2066  enerated cache f
+0002cd00: 696c 6520 6e61 6d65 2e0a 2020 2020 2020  ile name..      
+0002cd10: 2020 2020 2020 7465 7374 5f63 6163 6865        test_cache
+0002cd20: 5f66 696c 655f 6e61 6d65 2028 6073 7472  _file_name (`str
+0002cd30: 602c 202a 6f70 7469 6f6e 616c 2a29 3a0a  `, *optional*):.
+0002cd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cd50: 5072 6f76 6964 6520 7468 6520 6e61 6d65  Provide the name
+0002cd60: 206f 6620 6120 7061 7468 2066 6f72 2074   of a path for t
+0002cd70: 6865 2063 6163 6865 2066 696c 652e 2049  he cache file. I
+0002cd80: 7420 6973 2075 7365 6420 746f 2073 746f  t is used to sto
+0002cd90: 7265 2074 6865 0a20 2020 2020 2020 2020  re the.         
+0002cda0: 2020 2020 2020 2074 6573 7420 7370 6c69         test spli
+0002cdb0: 7420 696e 6469 6365 7320 696e 7374 6561  t indices instea
+0002cdc0: 6420 6f66 2074 6865 2061 7574 6f6d 6174  d of the automat
+0002cdd0: 6963 616c 6c79 2067 656e 6572 6174 6564  ically generated
+0002cde0: 2063 6163 6865 2066 696c 6520 6e61 6d65   cache file name
+0002cdf0: 2e0a 2020 2020 2020 2020 2020 2020 7772  ..            wr
+0002ce00: 6974 6572 5f62 6174 6368 5f73 697a 6520  iter_batch_size 
+0002ce10: 2860 696e 7460 2c20 6465 6661 756c 7473  (`int`, defaults
+0002ce20: 2074 6f20 6031 3030 3060 293a 0a20 2020   to `1000`):.   
+0002ce30: 2020 2020 2020 2020 2020 2020 204e 756d               Num
+0002ce40: 6265 7220 6f66 2072 6f77 7320 7065 7220  ber of rows per 
+0002ce50: 7772 6974 6520 6f70 6572 6174 696f 6e20  write operation 
+0002ce60: 666f 7220 7468 6520 6361 6368 6520 6669  for the cache fi
+0002ce70: 6c65 2077 7269 7465 722e 0a20 2020 2020  le writer..     
+0002ce80: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+0002ce90: 7661 6c75 6520 6973 2061 2067 6f6f 6420  value is a good 
+0002cea0: 7472 6164 652d 6f66 6620 6265 7477 6565  trade-off betwee
+0002ceb0: 6e20 6d65 6d6f 7279 2075 7361 6765 2064  n memory usage d
+0002cec0: 7572 696e 6720 7468 6520 7072 6f63 6573  uring the proces
+0002ced0: 7369 6e67 2c20 616e 6420 7072 6f63 6573  sing, and proces
+0002cee0: 7369 6e67 2073 7065 6564 2e0a 2020 2020  sing speed..    
+0002cef0: 2020 2020 2020 2020 2020 2020 4869 6768              High
+0002cf00: 6572 2076 616c 7565 206d 616b 6573 2074  er value makes t
+0002cf10: 6865 2070 726f 6365 7373 696e 6720 646f  he processing do
+0002cf20: 2066 6577 6572 206c 6f6f 6b75 7073 2c20   fewer lookups, 
+0002cf30: 6c6f 7765 7220 7661 6c75 6520 636f 6e73  lower value cons
+0002cf40: 756d 6520 6c65 7373 2074 656d 706f 7261  ume less tempora
+0002cf50: 7279 206d 656d 6f72 7920 7768 696c 6520  ry memory while 
+0002cf60: 7275 6e6e 696e 6720 606d 6170 602e 0a20  running `map`.. 
+0002cf70: 2020 2020 2020 2020 2020 2074 7261 696e             train
+0002cf80: 5f6e 6577 5f66 696e 6765 7270 7269 6e74  _new_fingerprint
+0002cf90: 2028 6073 7472 602c 202a 6f70 7469 6f6e   (`str`, *option
+0002cfa0: 616c 2a2c 2064 6566 6175 6c74 7320 746f  al*, defaults to
+0002cfb0: 2060 4e6f 6e65 6029 3a0a 2020 2020 2020   `None`):.      
+0002cfc0: 2020 2020 2020 2020 2020 5468 6520 6e65            The ne
+0002cfd0: 7720 6669 6e67 6572 7072 696e 7420 6f66  w fingerprint of
+0002cfe0: 2074 6865 2074 7261 696e 2073 6574 2061   the train set a
+0002cff0: 6674 6572 2074 7261 6e73 666f 726d 2e0a  fter transform..
+0002d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d010: 4966 2060 4e6f 6e65 602c 2074 6865 206e  If `None`, the n
+0002d020: 6577 2066 696e 6765 7270 7269 6e74 2069  ew fingerprint i
+0002d030: 7320 636f 6d70 7574 6564 2075 7369 6e67  s computed using
+0002d040: 2061 2068 6173 6820 6f66 2074 6865 2070   a hash of the p
+0002d050: 7265 7669 6f75 7320 6669 6e67 6572 7072  revious fingerpr
+0002d060: 696e 742c 2061 6e64 2074 6865 2074 7261  int, and the tra
+0002d070: 6e73 666f 726d 2061 7267 756d 656e 7473  nsform arguments
+0002d080: 0a20 2020 2020 2020 2020 2020 2074 6573  .            tes
+0002d090: 745f 6e65 775f 6669 6e67 6572 7072 696e  t_new_fingerprin
+0002d0a0: 7420 2860 7374 7260 2c20 2a6f 7074 696f  t (`str`, *optio
+0002d0b0: 6e61 6c2a 2c20 6465 6661 756c 7473 2074  nal*, defaults t
+0002d0c0: 6f20 604e 6f6e 6560 293a 0a20 2020 2020  o `None`):.     
+0002d0d0: 2020 2020 2020 2020 2020 2054 6865 206e             The n
+0002d0e0: 6577 2066 696e 6765 7270 7269 6e74 206f  ew fingerprint o
+0002d0f0: 6620 7468 6520 7465 7374 2073 6574 2061  f the test set a
+0002d100: 6674 6572 2074 7261 6e73 666f 726d 2e0a  fter transform..
+0002d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d120: 4966 2060 4e6f 6e65 602c 2074 6865 206e  If `None`, the n
+0002d130: 6577 2066 696e 6765 7270 7269 6e74 2069  ew fingerprint i
+0002d140: 7320 636f 6d70 7574 6564 2075 7369 6e67  s computed using
+0002d150: 2061 2068 6173 6820 6f66 2074 6865 2070   a hash of the p
+0002d160: 7265 7669 6f75 7320 6669 6e67 6572 7072  revious fingerpr
+0002d170: 696e 742c 2061 6e64 2074 6865 2074 7261  int, and the tra
+0002d180: 6e73 666f 726d 2061 7267 756d 656e 7473  nsform arguments
+0002d190: 0a0a 2020 2020 2020 2020 4578 616d 706c  ..        Exampl
+0002d1a0: 653a 0a0a 2020 2020 2020 2020 6060 6070  e:..        ```p
+0002d1b0: 790a 2020 2020 2020 2020 3e3e 3e20 6672  y.        >>> fr
+0002d1c0: 6f6d 2064 6174 6173 6574 7320 696d 706f  om datasets impo
+0002d1d0: 7274 206c 6f61 645f 6461 7461 7365 740a  rt load_dataset.
+0002d1e0: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
+0002d1f0: 206c 6f61 645f 6461 7461 7365 7428 2272   load_dataset("r
+0002d200: 6f74 7465 6e5f 746f 6d61 746f 6573 222c  otten_tomatoes",
+0002d210: 2073 706c 6974 3d22 7661 6c69 6461 7469   split="validati
+0002d220: 6f6e 2229 0a20 2020 2020 2020 203e 3e3e  on").        >>>
+0002d230: 2064 7320 3d20 6473 2e74 7261 696e 5f74   ds = ds.train_t
+0002d240: 6573 745f 7370 6c69 7428 7465 7374 5f73  est_split(test_s
+0002d250: 697a 653d 302e 322c 2073 6875 6666 6c65  ize=0.2, shuffle
+0002d260: 3d54 7275 6529 0a20 2020 2020 2020 2044  =True).        D
+0002d270: 6174 6173 6574 4469 6374 287b 0a20 2020  atasetDict({.   
+0002d280: 2020 2020 2020 2020 2074 7261 696e 3a20           train: 
+0002d290: 4461 7461 7365 7428 7b0a 2020 2020 2020  Dataset({.      
+0002d2a0: 2020 2020 2020 2020 2020 6665 6174 7572            featur
+0002d2b0: 6573 3a20 5b27 7465 7874 272c 2027 6c61  es: ['text', 'la
+0002d2c0: 6265 6c27 5d2c 0a20 2020 2020 2020 2020  bel'],.         
+0002d2d0: 2020 2020 2020 206e 756d 5f72 6f77 733a         num_rows:
+0002d2e0: 2038 3532 0a20 2020 2020 2020 2020 2020   852.           
+0002d2f0: 207d 290a 2020 2020 2020 2020 2020 2020   }).            
+0002d300: 7465 7374 3a20 4461 7461 7365 7428 7b0a  test: Dataset({.
+0002d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d320: 6665 6174 7572 6573 3a20 5b27 7465 7874  features: ['text
+0002d330: 272c 2027 6c61 6265 6c27 5d2c 0a20 2020  ', 'label'],.   
+0002d340: 2020 2020 2020 2020 2020 2020 206e 756d               num
+0002d350: 5f72 6f77 733a 2032 3134 0a20 2020 2020  _rows: 214.     
+0002d360: 2020 2020 2020 207d 290a 2020 2020 2020         }).      
+0002d370: 2020 7d29 0a0a 2020 2020 2020 2020 2320    })..        # 
+0002d380: 7365 7420 6120 7365 6564 0a20 2020 2020  set a seed.     
+0002d390: 2020 203e 3e3e 2064 7320 3d20 6473 2e74     >>> ds = ds.t
+0002d3a0: 7261 696e 5f74 6573 745f 7370 6c69 7428  rain_test_split(
+0002d3b0: 7465 7374 5f73 697a 653d 302e 322c 2073  test_size=0.2, s
+0002d3c0: 6565 643d 3432 290a 0a20 2020 2020 2020  eed=42)..       
+0002d3d0: 2023 2073 7472 6174 6966 6965 6420 7370   # stratified sp
+0002d3e0: 6c69 740a 2020 2020 2020 2020 3e3e 3e20  lit.        >>> 
+0002d3f0: 6473 203d 206c 6f61 645f 6461 7461 7365  ds = load_datase
+0002d400: 7428 2269 6d64 6222 2c73 706c 6974 3d22  t("imdb",split="
+0002d410: 7472 6169 6e22 290a 2020 2020 2020 2020  train").        
+0002d420: 4461 7461 7365 7428 7b0a 2020 2020 2020  Dataset({.      
+0002d430: 2020 2020 2020 6665 6174 7572 6573 3a20        features: 
+0002d440: 5b27 7465 7874 272c 2027 6c61 6265 6c27  ['text', 'label'
+0002d450: 5d2c 0a20 2020 2020 2020 2020 2020 206e  ],.            n
+0002d460: 756d 5f72 6f77 733a 2032 3530 3030 0a20  um_rows: 25000. 
+0002d470: 2020 2020 2020 207d 290a 2020 2020 2020         }).      
+0002d480: 2020 3e3e 3e20 6473 203d 2064 732e 7472    >>> ds = ds.tr
+0002d490: 6169 6e5f 7465 7374 5f73 706c 6974 2874  ain_test_split(t
+0002d4a0: 6573 745f 7369 7a65 3d30 2e32 2c20 7374  est_size=0.2, st
+0002d4b0: 7261 7469 6679 5f62 795f 636f 6c75 6d6e  ratify_by_column
+0002d4c0: 3d22 6c61 6265 6c22 290a 2020 2020 2020  ="label").      
+0002d4d0: 2020 4461 7461 7365 7444 6963 7428 7b0a    DatasetDict({.
+0002d4e0: 2020 2020 2020 2020 2020 2020 7472 6169              trai
+0002d4f0: 6e3a 2044 6174 6173 6574 287b 0a20 2020  n: Dataset({.   
+0002d500: 2020 2020 2020 2020 2020 2020 2066 6561               fea
+0002d510: 7475 7265 733a 205b 2774 6578 7427 2c20  tures: ['text', 
+0002d520: 276c 6162 656c 275d 2c0a 2020 2020 2020  'label'],.      
+0002d530: 2020 2020 2020 2020 2020 6e75 6d5f 726f            num_ro
+0002d540: 7773 3a20 3230 3030 300a 2020 2020 2020  ws: 20000.      
+0002d550: 2020 2020 2020 7d29 0a20 2020 2020 2020        }).       
+0002d560: 2020 2020 2074 6573 743a 2044 6174 6173       test: Datas
+0002d570: 6574 287b 0a20 2020 2020 2020 2020 2020  et({.           
+0002d580: 2020 2020 2066 6561 7475 7265 733a 205b       features: [
+0002d590: 2774 6578 7427 2c20 276c 6162 656c 275d  'text', 'label']
+0002d5a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002d5b0: 2020 6e75 6d5f 726f 7773 3a20 3530 3030    num_rows: 5000
+0002d5c0: 0a20 2020 2020 2020 2020 2020 207d 290a  .            }).
+0002d5d0: 2020 2020 2020 2020 7d29 0a20 2020 2020          }).     
+0002d5e0: 2020 2060 6060 0a20 2020 2020 2020 2022     ```.        "
+0002d5f0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+0002d600: 2e64 6174 6173 6574 5f64 6963 7420 696d  .dataset_dict im
+0002d610: 706f 7274 2044 6174 6173 6574 4469 6374  port DatasetDict
+0002d620: 2020 2320 696d 706f 7274 2068 6572 6520    # import here 
+0002d630: 6265 6361 7573 6520 6f66 2063 6972 6375  because of circu
+0002d640: 6c61 7220 6465 7065 6e64 656e 6379 0a0a  lar dependency..
+0002d650: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+0002d660: 656c 662e 6c69 7374 5f69 6e64 6578 6573  elf.list_indexes
+0002d670: 2829 2920 3e20 303a 0a20 2020 2020 2020  ()) > 0:.       
+0002d680: 2020 2020 2072 6169 7365 2044 6174 6173       raise Datas
+0002d690: 6574 5472 616e 7366 6f72 6d61 7469 6f6e  etTransformation
+0002d6a0: 4e6f 7441 6c6c 6f77 6564 4572 726f 7228  NotAllowedError(
+0002d6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d6c0: 2022 5573 696e 6720 602e 7472 6169 6e5f   "Using `.train_
+0002d6d0: 7465 7374 5f73 706c 6974 6020 6f6e 2061  test_split` on a
+0002d6e0: 2064 6174 6173 6574 2077 6974 6820 6174   dataset with at
+0002d6f0: 7461 6368 6564 2069 6e64 6578 6573 2069  tached indexes i
+0002d700: 7320 6e6f 7420 616c 6c6f 7765 642e 2059  s not allowed. Y
+0002d710: 6f75 2063 616e 2066 6972 7374 2072 756e  ou can first run
+0002d720: 2060 2e64 726f 705f 696e 6465 7828 2920   `.drop_index() 
+0002d730: 746f 2072 656d 6f76 6520 796f 7572 2069  to remove your i
+0002d740: 6e64 6578 2061 6e64 2074 6865 6e20 7265  ndex and then re
+0002d750: 2d61 6464 2069 742e 220a 2020 2020 2020  -add it.".      
+0002d760: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0002d770: 2320 4966 2074 6865 2061 7272 6179 2069  # If the array i
+0002d780: 7320 656d 7074 7920 7765 2064 6f20 6e6f  s empty we do no
+0002d790: 7468 696e 670a 2020 2020 2020 2020 6966  thing.        if
+0002d7a0: 206c 656e 2873 656c 6629 203d 3d20 303a   len(self) == 0:
+0002d7b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0002d7c0: 7572 6e20 4461 7461 7365 7444 6963 7428  urn DatasetDict(
+0002d7d0: 7b22 7472 6169 6e22 3a20 7365 6c66 2c20  {"train": self, 
+0002d7e0: 2274 6573 7422 3a20 7365 6c66 7d29 0a0a  "test": self})..
+0002d7f0: 2020 2020 2020 2020 6966 2074 6573 745f          if test_
+0002d800: 7369 7a65 2069 7320 4e6f 6e65 2061 6e64  size is None and
+0002d810: 2074 7261 696e 5f73 697a 6520 6973 204e   train_size is N
+0002d820: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002d830: 2074 6573 745f 7369 7a65 203d 2030 2e32   test_size = 0.2
+0002d840: 350a 0a20 2020 2020 2020 2023 2053 6166  5..        # Saf
+0002d850: 6574 7920 6368 6563 6b73 2073 696d 696c  ety checks simil
+0002d860: 6172 2074 6f20 7363 696b 6974 2d6c 6561  ar to scikit-lea
+0002d870: 726e 2773 206f 6e65 732e 0a20 2020 2020  rn's ones..     
+0002d880: 2020 2023 2028 6164 6170 7465 6420 6672     # (adapted fr
+0002d890: 6f6d 2068 7474 7073 3a2f 2f67 6974 6875  om https://githu
+0002d8a0: 622e 636f 6d2f 7363 696b 6974 2d6c 6561  b.com/scikit-lea
+0002d8b0: 726e 2f73 6369 6b69 742d 6c65 6172 6e2f  rn/scikit-learn/
+0002d8c0: 626c 6f62 2f66 6432 3337 3237 3865 3839  blob/fd237278e89
+0002d8d0: 3562 3432 6162 6538 6438 6430 3931 3035  5b42abe8d8d09105
+0002d8e0: 6362 6238 3264 6332 6362 6261 372f 736b  cbb82dc2cbba7/sk
+0002d8f0: 6c65 6172 6e2f 6d6f 6465 6c5f 7365 6c65  learn/model_sele
+0002d900: 6374 696f 6e2f 5f73 706c 6974 2e70 7923  ction/_split.py#
+0002d910: 4c31 3735 3029 0a20 2020 2020 2020 206e  L1750).        n
+0002d920: 5f73 616d 706c 6573 203d 206c 656e 2873  _samples = len(s
+0002d930: 656c 6629 0a20 2020 2020 2020 2069 6620  elf).        if 
+0002d940: 280a 2020 2020 2020 2020 2020 2020 6973  (.            is
+0002d950: 696e 7374 616e 6365 2874 6573 745f 7369  instance(test_si
+0002d960: 7a65 2c20 696e 7429 0a20 2020 2020 2020  ze, int).       
+0002d970: 2020 2020 2061 6e64 2028 7465 7374 5f73       and (test_s
+0002d980: 697a 6520 3e3d 206e 5f73 616d 706c 6573  ize >= n_samples
+0002d990: 206f 7220 7465 7374 5f73 697a 6520 3c3d   or test_size <=
+0002d9a0: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
+0002d9b0: 6f72 2069 7369 6e73 7461 6e63 6528 7465  or isinstance(te
+0002d9c0: 7374 5f73 697a 652c 2066 6c6f 6174 290a  st_size, float).
+0002d9d0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0002d9e0: 2874 6573 745f 7369 7a65 203c 3d20 3020  (test_size <= 0 
+0002d9f0: 6f72 2074 6573 745f 7369 7a65 203e 3d20  or test_size >= 
+0002da00: 3129 0a20 2020 2020 2020 2029 3a0a 2020  1).        ):.  
+0002da10: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0002da20: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+0002da30: 2020 2020 2020 2020 2020 2020 6622 7465              f"te
+0002da40: 7374 5f73 697a 653d 7b74 6573 745f 7369  st_size={test_si
+0002da50: 7a65 7d20 7368 6f75 6c64 2062 6520 6569  ze} should be ei
+0002da60: 7468 6572 2070 6f73 6974 6976 6520 616e  ther positive an
+0002da70: 6420 736d 616c 6c65 7220 220a 2020 2020  d smaller ".    
+0002da80: 2020 2020 2020 2020 2020 2020 6622 7468              f"th
+0002da90: 616e 2074 6865 206e 756d 6265 7220 6f66  an the number of
+0002daa0: 2073 616d 706c 6573 207b 6e5f 7361 6d70   samples {n_samp
+0002dab0: 6c65 737d 206f 7220 6120 666c 6f61 7420  les} or a float 
+0002dac0: 696e 2074 6865 2028 302c 2031 2920 7261  in the (0, 1) ra
+0002dad0: 6e67 6522 0a20 2020 2020 2020 2020 2020  nge".           
+0002dae0: 2029 0a0a 2020 2020 2020 2020 6966 2028   )..        if (
+0002daf0: 0a20 2020 2020 2020 2020 2020 2069 7369  .            isi
+0002db00: 6e73 7461 6e63 6528 7472 6169 6e5f 7369  nstance(train_si
+0002db10: 7a65 2c20 696e 7429 0a20 2020 2020 2020  ze, int).       
+0002db20: 2020 2020 2061 6e64 2028 7472 6169 6e5f       and (train_
+0002db30: 7369 7a65 203e 3d20 6e5f 7361 6d70 6c65  size >= n_sample
+0002db40: 7320 6f72 2074 7261 696e 5f73 697a 6520  s or train_size 
+0002db50: 3c3d 2030 290a 2020 2020 2020 2020 2020  <= 0).          
+0002db60: 2020 6f72 2069 7369 6e73 7461 6e63 6528    or isinstance(
+0002db70: 7472 6169 6e5f 7369 7a65 2c20 666c 6f61  train_size, floa
+0002db80: 7429 0a20 2020 2020 2020 2020 2020 2061  t).            a
+0002db90: 6e64 2028 7472 6169 6e5f 7369 7a65 203c  nd (train_size <
+0002dba0: 3d20 3020 6f72 2074 7261 696e 5f73 697a  = 0 or train_siz
+0002dbb0: 6520 3e3d 2031 290a 2020 2020 2020 2020  e >= 1).        
+0002dbc0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0002dbd0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0002dbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002dbf0: 2066 2274 7261 696e 5f73 697a 653d 7b74   f"train_size={t
+0002dc00: 7261 696e 5f73 697a 657d 2073 686f 756c  rain_size} shoul
+0002dc10: 6420 6265 2065 6974 6865 7220 706f 7369  d be either posi
+0002dc20: 7469 7665 2061 6e64 2073 6d61 6c6c 6572  tive and smaller
+0002dc30: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0002dc40: 2020 2066 2274 6861 6e20 7468 6520 6e75     f"than the nu
+0002dc50: 6d62 6572 206f 6620 7361 6d70 6c65 7320  mber of samples 
+0002dc60: 7b6e 5f73 616d 706c 6573 7d20 6f72 2061  {n_samples} or a
+0002dc70: 2066 6c6f 6174 2069 6e20 7468 6520 2830   float in the (0
+0002dc80: 2c20 3129 2072 616e 6765 220a 2020 2020  , 1) range".    
+0002dc90: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0002dca0: 2020 2069 6620 7472 6169 6e5f 7369 7a65     if train_size
+0002dcb0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0002dcc0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0002dcd0: 7472 6169 6e5f 7369 7a65 2c20 2869 6e74  train_size, (int
+0002dce0: 2c20 666c 6f61 7429 293a 0a20 2020 2020  , float)):.     
+0002dcf0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0002dd00: 7565 4572 726f 7228 6622 496e 7661 6c69  ueError(f"Invali
+0002dd10: 6420 7661 6c75 6520 666f 7220 7472 6169  d value for trai
+0002dd20: 6e5f 7369 7a65 3a20 7b74 7261 696e 5f73  n_size: {train_s
+0002dd30: 697a 657d 206f 6620 7479 7065 207b 7479  ize} of type {ty
+0002dd40: 7065 2874 7261 696e 5f73 697a 6529 7d22  pe(train_size)}"
+0002dd50: 290a 2020 2020 2020 2020 6966 2074 6573  ).        if tes
+0002dd60: 745f 7369 7a65 2069 7320 6e6f 7420 4e6f  t_size is not No
+0002dd70: 6e65 2061 6e64 206e 6f74 2069 7369 6e73  ne and not isins
+0002dd80: 7461 6e63 6528 7465 7374 5f73 697a 652c  tance(test_size,
+0002dd90: 2028 696e 742c 2066 6c6f 6174 2929 3a0a   (int, float)):.
+0002dda0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0002ddb0: 6520 5661 6c75 6545 7272 6f72 2866 2249  e ValueError(f"I
+0002ddc0: 6e76 616c 6964 2076 616c 7565 2066 6f72  nvalid value for
+0002ddd0: 2074 6573 745f 7369 7a65 3a20 7b74 6573   test_size: {tes
+0002dde0: 745f 7369 7a65 7d20 6f66 2074 7970 6520  t_size} of type 
+0002ddf0: 7b74 7970 6528 7465 7374 5f73 697a 6529  {type(test_size)
+0002de00: 7d22 290a 0a20 2020 2020 2020 2069 6620  }")..        if 
+0002de10: 6973 696e 7374 616e 6365 2874 7261 696e  isinstance(train
+0002de20: 5f73 697a 652c 2066 6c6f 6174 2920 616e  _size, float) an
+0002de30: 6420 6973 696e 7374 616e 6365 2874 6573  d isinstance(tes
+0002de40: 745f 7369 7a65 2c20 666c 6f61 7429 2061  t_size, float) a
+0002de50: 6e64 2074 7261 696e 5f73 697a 6520 2b20  nd train_size + 
+0002de60: 7465 7374 5f73 697a 6520 3e20 313a 0a20  test_size > 1:. 
+0002de70: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0002de80: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0002de90: 2020 2020 2020 2020 2020 2020 2066 2254               f"T
+0002dea0: 6865 2073 756d 206f 6620 7465 7374 5f73  he sum of test_s
+0002deb0: 697a 6520 616e 6420 7472 6169 6e5f 7369  ize and train_si
+0002dec0: 7a65 203d 207b 7472 6169 6e5f 7369 7a65  ze = {train_size
+0002ded0: 202b 2074 6573 745f 7369 7a65 7d2c 2073   + test_size}, s
+0002dee0: 686f 756c 6420 6265 2069 6e20 7468 6520  hould be in the 
+0002def0: 2830 2c20 3129 220a 2020 2020 2020 2020  (0, 1)".        
+0002df00: 2020 2020 2020 2020 2220 7261 6e67 652e          " range.
+0002df10: 2052 6564 7563 6520 7465 7374 5f73 697a   Reduce test_siz
+0002df20: 6520 616e 642f 6f72 2074 7261 696e 5f73  e and/or train_s
+0002df30: 697a 652e 220a 2020 2020 2020 2020 2020  ize.".          
+0002df40: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+0002df50: 6973 696e 7374 616e 6365 2874 6573 745f  isinstance(test_
+0002df60: 7369 7a65 2c20 666c 6f61 7429 3a0a 2020  size, float):.  
+0002df70: 2020 2020 2020 2020 2020 6e5f 7465 7374            n_test
+0002df80: 203d 2063 6569 6c28 7465 7374 5f73 697a   = ceil(test_siz
+0002df90: 6520 2a20 6e5f 7361 6d70 6c65 7329 0a20  e * n_samples). 
+0002dfa0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+0002dfb0: 7374 616e 6365 2874 6573 745f 7369 7a65  stance(test_size
+0002dfc0: 2c20 696e 7429 3a0a 2020 2020 2020 2020  , int):.        
+0002dfd0: 2020 2020 6e5f 7465 7374 203d 2066 6c6f      n_test = flo
+0002dfe0: 6174 2874 6573 745f 7369 7a65 290a 0a20  at(test_size).. 
+0002dff0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0002e000: 616e 6365 2874 7261 696e 5f73 697a 652c  ance(train_size,
+0002e010: 2066 6c6f 6174 293a 0a20 2020 2020 2020   float):.       
+0002e020: 2020 2020 206e 5f74 7261 696e 203d 2066       n_train = f
+0002e030: 6c6f 6f72 2874 7261 696e 5f73 697a 6520  loor(train_size 
+0002e040: 2a20 6e5f 7361 6d70 6c65 7329 0a20 2020  * n_samples).   
+0002e050: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+0002e060: 616e 6365 2874 7261 696e 5f73 697a 652c  ance(train_size,
+0002e070: 2069 6e74 293a 0a20 2020 2020 2020 2020   int):.         
+0002e080: 2020 206e 5f74 7261 696e 203d 2066 6c6f     n_train = flo
+0002e090: 6174 2874 7261 696e 5f73 697a 6529 0a0a  at(train_size)..
+0002e0a0: 2020 2020 2020 2020 6966 2074 7261 696e          if train
+0002e0b0: 5f73 697a 6520 6973 204e 6f6e 653a 0a20  _size is None:. 
+0002e0c0: 2020 2020 2020 2020 2020 206e 5f74 7261             n_tra
+0002e0d0: 696e 203d 206e 5f73 616d 706c 6573 202d  in = n_samples -
+0002e0e0: 206e 5f74 6573 740a 2020 2020 2020 2020   n_test.        
+0002e0f0: 656c 6966 2074 6573 745f 7369 7a65 2069  elif test_size i
+0002e100: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0002e110: 2020 2020 6e5f 7465 7374 203d 206e 5f73      n_test = n_s
+0002e120: 616d 706c 6573 202d 206e 5f74 7261 696e  amples - n_train
+0002e130: 0a0a 2020 2020 2020 2020 6966 206e 5f74  ..        if n_t
+0002e140: 7261 696e 202b 206e 5f74 6573 7420 3e20  rain + n_test > 
+0002e150: 6e5f 7361 6d70 6c65 733a 0a20 2020 2020  n_samples:.     
+0002e160: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0002e170: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+0002e180: 2020 2020 2020 2020 2066 2254 6865 2073           f"The s
+0002e190: 756d 206f 6620 7472 6169 6e5f 7369 7a65  um of train_size
+0002e1a0: 2061 6e64 2074 6573 745f 7369 7a65 203d   and test_size =
+0002e1b0: 207b 6e5f 7472 6169 6e20 2b20 6e5f 7465   {n_train + n_te
+0002e1c0: 7374 7d2c 2022 0a20 2020 2020 2020 2020  st}, ".         
+0002e1d0: 2020 2020 2020 2022 7368 6f75 6c64 2062         "should b
+0002e1e0: 6520 736d 616c 6c65 7220 7468 616e 2074  e smaller than t
+0002e1f0: 6865 206e 756d 6265 7220 6f66 2022 0a20  he number of ". 
+0002e200: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0002e210: 2273 616d 706c 6573 207b 6e5f 7361 6d70  "samples {n_samp
+0002e220: 6c65 737d 2e20 5265 6475 6365 2074 6573  les}. Reduce tes
+0002e230: 745f 7369 7a65 2061 6e64 2f6f 7220 220a  t_size and/or ".
+0002e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e250: 2274 7261 696e 5f73 697a 652e 220a 2020  "train_size.".  
+0002e260: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0002e270: 2020 2020 206e 5f74 7261 696e 2c20 6e5f       n_train, n_
+0002e280: 7465 7374 203d 2069 6e74 286e 5f74 7261  test = int(n_tra
+0002e290: 696e 292c 2069 6e74 286e 5f74 6573 7429  in), int(n_test)
+0002e2a0: 0a0a 2020 2020 2020 2020 6966 206e 5f74  ..        if n_t
+0002e2b0: 7261 696e 203d 3d20 303a 0a20 2020 2020  rain == 0:.     
+0002e2c0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0002e2d0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+0002e2e0: 2020 2020 2020 2020 2066 2257 6974 6820           f"With 
+0002e2f0: 6e5f 7361 6d70 6c65 733d 7b6e 5f73 616d  n_samples={n_sam
+0002e300: 706c 6573 7d2c 2074 6573 745f 7369 7a65  ples}, test_size
+0002e310: 3d7b 7465 7374 5f73 697a 657d 2061 6e64  ={test_size} and
+0002e320: 2074 7261 696e 5f73 697a 653d 7b74 7261   train_size={tra
+0002e330: 696e 5f73 697a 657d 2c20 7468 6520 220a  in_size}, the ".
+0002e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e350: 2272 6573 756c 7469 6e67 2074 7261 696e  "resulting train
+0002e360: 2073 6574 2077 696c 6c20 6265 2065 6d70   set will be emp
+0002e370: 7479 2e20 4164 6a75 7374 2061 6e79 206f  ty. Adjust any o
+0002e380: 6620 7468 6520 220a 2020 2020 2020 2020  f the ".        
+0002e390: 2020 2020 2020 2020 2261 666f 7265 6d65          "aforeme
+0002e3a0: 6e74 696f 6e65 6420 7061 7261 6d65 7465  ntioned paramete
+0002e3b0: 7273 2e22 0a20 2020 2020 2020 2020 2020  rs.".           
+0002e3c0: 2029 0a0a 2020 2020 2020 2020 6966 2067   )..        if g
+0002e3d0: 656e 6572 6174 6f72 2069 7320 4e6f 6e65  enerator is None
+0002e3e0: 2061 6e64 2073 6875 6666 6c65 2069 7320   and shuffle is 
+0002e3f0: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
+0002e400: 2020 6966 2073 6565 6420 6973 204e 6f6e    if seed is Non
+0002e410: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002e420: 2020 205f 2c20 7365 6564 2c20 706f 732c     _, seed, pos,
+0002e430: 202a 5f20 3d20 6e70 2e72 616e 646f 6d2e   *_ = np.random.
+0002e440: 6765 745f 7374 6174 6528 290a 2020 2020  get_state().    
+0002e450: 2020 2020 2020 2020 2020 2020 7365 6564              seed
+0002e460: 203d 2073 6565 645b 706f 735d 2069 6620   = seed[pos] if 
+0002e470: 706f 7320 3c20 3632 3420 656c 7365 2073  pos < 624 else s
+0002e480: 6565 645b 305d 0a20 2020 2020 2020 2020  eed[0].         
+0002e490: 2020 2020 2020 205f 203d 206e 702e 7261         _ = np.ra
+0002e4a0: 6e64 6f6d 2e72 616e 646f 6d28 2920 2023  ndom.random()  #
+0002e4b0: 2064 6f20 3120 7374 6570 206f 6620 726e   do 1 step of rn
+0002e4c0: 670a 2020 2020 2020 2020 2020 2020 6765  g.            ge
+0002e4d0: 6e65 7261 746f 7220 3d20 6e70 2e72 616e  nerator = np.ran
+0002e4e0: 646f 6d2e 6465 6661 756c 745f 726e 6728  dom.default_rng(
+0002e4f0: 7365 6564 290a 0a20 2020 2020 2020 2023  seed)..        #
+0002e500: 2043 6865 636b 2069 6620 7765 2776 6520   Check if we've 
+0002e510: 616c 7265 6164 7920 6361 6368 6564 2074  already cached t
+0002e520: 6869 7320 636f 6d70 7574 6174 696f 6e20  his computation 
+0002e530: 2869 6e64 6578 6564 2062 7920 6120 6861  (indexed by a ha
+0002e540: 7368 290a 2020 2020 2020 2020 6966 2073  sh).        if s
+0002e550: 656c 662e 6361 6368 655f 6669 6c65 733a  elf.cache_files:
+0002e560: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002e570: 7472 6169 6e5f 696e 6469 6365 735f 6361  train_indices_ca
+0002e580: 6368 655f 6669 6c65 5f6e 616d 6520 6973  che_file_name is
+0002e590: 204e 6f6e 6520 6f72 2074 6573 745f 696e   None or test_in
+0002e5a0: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
+0002e5b0: 5f6e 616d 6520 6973 204e 6f6e 653a 0a20  _name is None:. 
+0002e5c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0002e5d0: 2077 6520 6372 6561 7465 2061 2075 6e69   we create a uni
+0002e5e0: 7175 6520 6861 7368 2066 726f 6d20 7468  que hash from th
+0002e5f0: 6520 6675 6e63 7469 6f6e 2c20 6375 7272  e function, curr
+0002e600: 656e 7420 6461 7461 7365 7420 6669 6c65  ent dataset file
+0002e610: 2061 6e64 2074 6865 206d 6170 7069 6e67   and the mapping
+0002e620: 2061 7267 730a 0a20 2020 2020 2020 2020   args..         
+0002e630: 2020 2020 2020 2069 6620 7472 6169 6e5f         if train_
+0002e640: 696e 6469 6365 735f 6361 6368 655f 6669  indices_cache_fi
+0002e650: 6c65 5f6e 616d 6520 6973 204e 6f6e 653a  le_name is None:
+0002e660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e670: 2020 2020 2074 7261 696e 5f69 6e64 6963       train_indic
+0002e680: 6573 5f63 6163 6865 5f66 696c 655f 6e61  es_cache_file_na
+0002e690: 6d65 203d 2073 656c 662e 5f67 6574 5f63  me = self._get_c
+0002e6a0: 6163 6865 5f66 696c 655f 7061 7468 2874  ache_file_path(t
+0002e6b0: 7261 696e 5f6e 6577 5f66 696e 6765 7270  rain_new_fingerp
+0002e6c0: 7269 6e74 290a 2020 2020 2020 2020 2020  rint).          
+0002e6d0: 2020 2020 2020 6966 2074 6573 745f 696e        if test_in
+0002e6e0: 6469 6365 735f 6361 6368 655f 6669 6c65  dices_cache_file
+0002e6f0: 5f6e 616d 6520 6973 204e 6f6e 653a 0a20  _name is None:. 
+0002e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e710: 2020 2074 6573 745f 696e 6469 6365 735f     test_indices_
+0002e720: 6361 6368 655f 6669 6c65 5f6e 616d 6520  cache_file_name 
+0002e730: 3d20 7365 6c66 2e5f 6765 745f 6361 6368  = self._get_cach
+0002e740: 655f 6669 6c65 5f70 6174 6828 7465 7374  e_file_path(test
+0002e750: 5f6e 6577 5f66 696e 6765 7270 7269 6e74  _new_fingerprint
+0002e760: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0002e770: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0002e780: 2020 206f 732e 7061 7468 2e65 7869 7374     os.path.exist
+0002e790: 7328 7472 6169 6e5f 696e 6469 6365 735f  s(train_indices_
+0002e7a0: 6361 6368 655f 6669 6c65 5f6e 616d 6529  cache_file_name)
+0002e7b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e7c0: 2061 6e64 206f 732e 7061 7468 2e65 7869   and os.path.exi
+0002e7d0: 7374 7328 7465 7374 5f69 6e64 6963 6573  sts(test_indices
+0002e7e0: 5f63 6163 6865 5f66 696c 655f 6e61 6d65  _cache_file_name
+0002e7f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002e800: 2020 616e 6420 6c6f 6164 5f66 726f 6d5f    and load_from_
+0002e810: 6361 6368 655f 6669 6c65 0a20 2020 2020  cache_file.     
+0002e820: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+0002e830: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+0002e840: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
+0002e850: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0002e860: 4c6f 6164 696e 6720 6361 6368 6564 2073  Loading cached s
+0002e870: 706c 6974 2069 6e64 6963 6573 2066 6f72  plit indices for
+0002e880: 2064 6174 6173 6574 2061 7420 7b74 7261   dataset at {tra
+0002e890: 696e 5f69 6e64 6963 6573 5f63 6163 6865  in_indices_cache
+0002e8a0: 5f66 696c 655f 6e61 6d65 7d20 616e 6420  _file_name} and 
+0002e8b0: 7b74 6573 745f 696e 6469 6365 735f 6361  {test_indices_ca
+0002e8c0: 6368 655f 6669 6c65 5f6e 616d 657d 220a  che_file_name}".
+0002e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e8e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002e8f0: 2020 7265 7475 726e 2044 6174 6173 6574    return Dataset
+0002e900: 4469 6374 280a 2020 2020 2020 2020 2020  Dict(.          
+0002e910: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
+0002e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e930: 2020 2020 2274 7261 696e 223a 2073 656c      "train": sel
+0002e940: 662e 5f6e 6577 5f64 6174 6173 6574 5f77  f._new_dataset_w
+0002e950: 6974 685f 696e 6469 6365 7328 0a20 2020  ith_indices(.   
+0002e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e970: 2020 2020 2020 2020 2066 696e 6765 7270           fingerp
+0002e980: 7269 6e74 3d74 7261 696e 5f6e 6577 5f66  rint=train_new_f
+0002e990: 696e 6765 7270 7269 6e74 2c20 696e 6469  ingerprint, indi
+0002e9a0: 6365 735f 6361 6368 655f 6669 6c65 5f6e  ces_cache_file_n
+0002e9b0: 616d 653d 7472 6169 6e5f 696e 6469 6365  ame=train_indice
+0002e9c0: 735f 6361 6368 655f 6669 6c65 5f6e 616d  s_cache_file_nam
+0002e9d0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0002e9e0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+0002e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ea00: 2020 2020 2022 7465 7374 223a 2073 656c       "test": sel
+0002ea10: 662e 5f6e 6577 5f64 6174 6173 6574 5f77  f._new_dataset_w
+0002ea20: 6974 685f 696e 6469 6365 7328 0a20 2020  ith_indices(.   
+0002ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ea40: 2020 2020 2020 2020 2066 696e 6765 7270           fingerp
+0002ea50: 7269 6e74 3d74 6573 745f 6e65 775f 6669  rint=test_new_fi
+0002ea60: 6e67 6572 7072 696e 742c 2069 6e64 6963  ngerprint, indic
+0002ea70: 6573 5f63 6163 6865 5f66 696c 655f 6e61  es_cache_file_na
+0002ea80: 6d65 3d74 6573 745f 696e 6469 6365 735f  me=test_indices_
+0002ea90: 6361 6368 655f 6669 6c65 5f6e 616d 650a  cache_file_name.
+0002eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002eab0: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+0002eac0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+0002ead0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002eae0: 2029 0a20 2020 2020 2020 2069 6620 6e6f   ).        if no
+0002eaf0: 7420 7368 7566 666c 653a 0a20 2020 2020  t shuffle:.     
+0002eb00: 2020 2020 2020 2069 6620 7374 7261 7469         if strati
+0002eb10: 6679 5f62 795f 636f 6c75 6d6e 2069 7320  fy_by_column is 
+0002eb20: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0002eb30: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0002eb40: 5661 6c75 6545 7272 6f72 2822 5374 7261  ValueError("Stra
+0002eb50: 7469 6669 6564 2074 7261 696e 2f74 6573  tified train/tes
+0002eb60: 7420 7370 6c69 7420 6973 206e 6f74 2069  t split is not i
+0002eb70: 6d70 6c65 6d65 6e74 6564 2066 6f72 2060  mplemented for `
+0002eb80: 7368 7566 666c 653d 4661 6c73 6560 2229  shuffle=False`")
+0002eb90: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+0002eba0: 696e 5f69 6e64 6963 6573 203d 206e 702e  in_indices = np.
+0002ebb0: 6172 616e 6765 286e 5f74 7261 696e 290a  arange(n_train).
+0002ebc0: 2020 2020 2020 2020 2020 2020 7465 7374              test
+0002ebd0: 5f69 6e64 6963 6573 203d 206e 702e 6172  _indices = np.ar
+0002ebe0: 616e 6765 286e 5f74 7261 696e 2c20 6e5f  ange(n_train, n_
+0002ebf0: 7472 6169 6e20 2b20 6e5f 7465 7374 290a  train + n_test).
+0002ec00: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002ec10: 2020 2020 2020 2020 2020 2320 7374 7261            # stra
+0002ec20: 7469 6669 6564 2070 6172 7469 7469 6f6e  tified partition
+0002ec30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002ec40: 7374 7261 7469 6679 5f62 795f 636f 6c75  stratify_by_colu
+0002ec50: 6d6e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  mn is not None:.
+0002ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ec70: 6966 2073 7472 6174 6966 795f 6279 5f63  if stratify_by_c
+0002ec80: 6f6c 756d 6e20 6e6f 7420 696e 2073 656c  olumn not in sel
+0002ec90: 662e 6665 6174 7572 6573 2e6b 6579 7328  f.features.keys(
+0002eca0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0002ecb0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0002ecc0: 7565 4572 726f 7228 6622 4b65 7920 7b73  ueError(f"Key {s
+0002ecd0: 7472 6174 6966 795f 6279 5f63 6f6c 756d  tratify_by_colum
+0002ece0: 6e7d 206e 6f74 2066 6f75 6e64 2069 6e20  n} not found in 
+0002ecf0: 7b73 656c 662e 6665 6174 7572 6573 2e6b  {self.features.k
+0002ed00: 6579 7328 297d 2229 0a20 2020 2020 2020  eys()}").       
+0002ed10: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0002ed20: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+0002ed30: 6665 6174 7572 6573 5b73 7472 6174 6966  features[stratif
+0002ed40: 795f 6279 5f63 6f6c 756d 6e5d 2c20 436c  y_by_column], Cl
+0002ed50: 6173 734c 6162 656c 293a 0a20 2020 2020  assLabel):.     
+0002ed60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0002ed70: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0002ed80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ed90: 2020 2020 2020 2020 2066 2253 7472 6174           f"Strat
+0002eda0: 6966 7969 6e67 2062 7920 636f 6c75 6d6e  ifying by column
+0002edb0: 2069 7320 6f6e 6c79 2073 7570 706f 7274   is only support
+0002edc0: 6564 2066 6f72 207b 436c 6173 734c 6162  ed for {ClassLab
+0002edd0: 656c 2e5f 5f6e 616d 655f 5f7d 2063 6f6c  el.__name__} col
+0002ede0: 756d 6e2c 2061 6e64 2063 6f6c 756d 6e20  umn, and column 
+0002edf0: 7b73 7472 6174 6966 795f 6279 5f63 6f6c  {stratify_by_col
+0002ee00: 756d 6e7d 2069 7320 7b74 7970 6528 7365  umn} is {type(se
+0002ee10: 6c66 2e66 6561 7475 7265 735b 7374 7261  lf.features[stra
+0002ee20: 7469 6679 5f62 795f 636f 6c75 6d6e 5d29  tify_by_column])
+0002ee30: 2e5f 5f6e 616d 655f 5f7d 2e22 0a20 2020  .__name__}.".   
+0002ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ee50: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0002ee60: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0002ee70: 2020 2020 2020 2020 2020 2020 7472 6169              trai
+0002ee80: 6e5f 696e 6469 6365 732c 2074 6573 745f  n_indices, test_
+0002ee90: 696e 6469 6365 7320 3d20 6e65 7874 280a  indices = next(.
+0002eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002eeb0: 2020 2020 2020 2020 7374 7261 7469 6669          stratifi
+0002eec0: 6564 5f73 6875 6666 6c65 5f73 706c 6974  ed_shuffle_split
+0002eed0: 5f67 656e 6572 6174 655f 696e 6469 6365  _generate_indice
+0002eee0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+0002eef0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002ef00: 656c 662e 7769 7468 5f66 6f72 6d61 7428  elf.with_format(
+0002ef10: 226e 756d 7079 2229 5b73 7472 6174 6966  "numpy")[stratif
+0002ef20: 795f 6279 5f63 6f6c 756d 6e5d 2c20 6e5f  y_by_column], n_
+0002ef30: 7472 6169 6e2c 206e 5f74 6573 742c 2072  train, n_test, r
+0002ef40: 6e67 3d67 656e 6572 6174 6f72 0a20 2020  ng=generator.   
+0002ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ef60: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0002ef70: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0002ef80: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0002ef90: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+0002efa0: 2065 7272 6f72 3a0a 2020 2020 2020 2020   error:.        
+0002efb0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0002efc0: 7472 2865 7272 6f72 2920 3d3d 2022 4d69  tr(error) == "Mi
+0002efd0: 6e69 6d75 6d20 636c 6173 7320 636f 756e  nimum class coun
+0002efe0: 7420 6572 726f 7222 3a0a 2020 2020 2020  t error":.      
+0002eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f000: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0002f010: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0002f020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f030: 6622 5468 6520 6c65 6173 7420 706f 7075  f"The least popu
+0002f040: 6c61 7465 6420 636c 6173 7320 696e 207b  lated class in {
+0002f050: 7374 7261 7469 6679 5f62 795f 636f 6c75  stratify_by_colu
+0002f060: 6d6e 7d20 636f 6c75 6d6e 2068 6173 206f  mn} column has o
+0002f070: 6e6c 7920 3122 0a20 2020 2020 2020 2020  nly 1".         
+0002f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f090: 2020 2022 206d 656d 6265 722c 2077 6869     " member, whi
+0002f0a0: 6368 2069 7320 746f 6f20 6665 772e 2054  ch is too few. T
+0002f0b0: 6865 206d 696e 696d 756d 220a 2020 2020  he minimum".    
+0002f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f0d0: 2020 2020 2020 2020 2220 6e75 6d62 6572          " number
+0002f0e0: 206f 6620 6772 6f75 7073 2066 6f72 2061   of groups for a
+0002f0f0: 6e79 2063 6c61 7373 2063 616e 6e6f 7422  ny class cannot"
+0002f100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f110: 2020 2020 2020 2020 2020 2020 2022 2062               " b
+0002f120: 6520 6c65 7373 2074 6861 6e20 322e 220a  e less than 2.".
+0002f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f140: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0002f150: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0002f160: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002f170: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0002f180: 6520 6572 726f 720a 0a20 2020 2020 2020  e error..       
+0002f190: 2020 2020 2023 2072 616e 646f 6d20 7061       # random pa
+0002f1a0: 7274 6974 696f 6e0a 2020 2020 2020 2020  rtition.        
+0002f1b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002f1c0: 2020 2020 2020 2020 2020 7065 726d 7574            permut
+0002f1d0: 6174 696f 6e20 3d20 6765 6e65 7261 746f  ation = generato
+0002f1e0: 722e 7065 726d 7574 6174 696f 6e28 6c65  r.permutation(le
+0002f1f0: 6e28 7365 6c66 2929 0a20 2020 2020 2020  n(self)).       
+0002f200: 2020 2020 2020 2020 2074 6573 745f 696e           test_in
+0002f210: 6469 6365 7320 3d20 7065 726d 7574 6174  dices = permutat
+0002f220: 696f 6e5b 3a6e 5f74 6573 745d 0a20 2020  ion[:n_test].   
+0002f230: 2020 2020 2020 2020 2020 2020 2074 7261               tra
+0002f240: 696e 5f69 6e64 6963 6573 203d 2070 6572  in_indices = per
+0002f250: 6d75 7461 7469 6f6e 5b6e 5f74 6573 7420  mutation[n_test 
+0002f260: 3a20 286e 5f74 6573 7420 2b20 6e5f 7472  : (n_test + n_tr
+0002f270: 6169 6e29 5d0a 0a20 2020 2020 2020 2074  ain)]..        t
+0002f280: 7261 696e 5f73 706c 6974 203d 2073 656c  rain_split = sel
+0002f290: 662e 7365 6c65 6374 280a 2020 2020 2020  f.select(.      
+0002f2a0: 2020 2020 2020 696e 6469 6365 733d 7472        indices=tr
+0002f2b0: 6169 6e5f 696e 6469 6365 732c 0a20 2020  ain_indices,.   
+0002f2c0: 2020 2020 2020 2020 206b 6565 705f 696e           keep_in
+0002f2d0: 5f6d 656d 6f72 793d 6b65 6570 5f69 6e5f  _memory=keep_in_
+0002f2e0: 6d65 6d6f 7279 2c0a 2020 2020 2020 2020  memory,.        
+0002f2f0: 2020 2020 696e 6469 6365 735f 6361 6368      indices_cach
+0002f300: 655f 6669 6c65 5f6e 616d 653d 7472 6169  e_file_name=trai
+0002f310: 6e5f 696e 6469 6365 735f 6361 6368 655f  n_indices_cache_
+0002f320: 6669 6c65 5f6e 616d 652c 0a20 2020 2020  file_name,.     
+0002f330: 2020 2020 2020 2077 7269 7465 725f 6261         writer_ba
+0002f340: 7463 685f 7369 7a65 3d77 7269 7465 725f  tch_size=writer_
+0002f350: 6261 7463 685f 7369 7a65 2c0a 2020 2020  batch_size,.    
+0002f360: 2020 2020 2020 2020 6e65 775f 6669 6e67          new_fing
+0002f370: 6572 7072 696e 743d 7472 6169 6e5f 6e65  erprint=train_ne
+0002f380: 775f 6669 6e67 6572 7072 696e 742c 0a20  w_fingerprint,. 
+0002f390: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0002f3a0: 2074 6573 745f 7370 6c69 7420 3d20 7365   test_split = se
+0002f3b0: 6c66 2e73 656c 6563 7428 0a20 2020 2020  lf.select(.     
+0002f3c0: 2020 2020 2020 2069 6e64 6963 6573 3d74         indices=t
+0002f3d0: 6573 745f 696e 6469 6365 732c 0a20 2020  est_indices,.   
+0002f3e0: 2020 2020 2020 2020 206b 6565 705f 696e           keep_in
+0002f3f0: 5f6d 656d 6f72 793d 6b65 6570 5f69 6e5f  _memory=keep_in_
+0002f400: 6d65 6d6f 7279 2c0a 2020 2020 2020 2020  memory,.        
+0002f410: 2020 2020 696e 6469 6365 735f 6361 6368      indices_cach
+0002f420: 655f 6669 6c65 5f6e 616d 653d 7465 7374  e_file_name=test
+0002f430: 5f69 6e64 6963 6573 5f63 6163 6865 5f66  _indices_cache_f
+0002f440: 696c 655f 6e61 6d65 2c0a 2020 2020 2020  ile_name,.      
+0002f450: 2020 2020 2020 7772 6974 6572 5f62 6174        writer_bat
+0002f460: 6368 5f73 697a 653d 7772 6974 6572 5f62  ch_size=writer_b
+0002f470: 6174 6368 5f73 697a 652c 0a20 2020 2020  atch_size,.     
+0002f480: 2020 2020 2020 206e 6577 5f66 696e 6765         new_finge
+0002f490: 7270 7269 6e74 3d74 6573 745f 6e65 775f  rprint=test_new_
+0002f4a0: 6669 6e67 6572 7072 696e 742c 0a20 2020  fingerprint,.   
+0002f4b0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0002f4c0: 7265 7475 726e 2044 6174 6173 6574 4469  return DatasetDi
+0002f4d0: 6374 287b 2274 7261 696e 223a 2074 7261  ct({"train": tra
+0002f4e0: 696e 5f73 706c 6974 2c20 2274 6573 7422  in_split, "test"
+0002f4f0: 3a20 7465 7374 5f73 706c 6974 7d29 0a0a  : test_split})..
+0002f500: 2020 2020 6465 6620 7368 6172 6428 0a20      def shard(. 
+0002f510: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0002f520: 2020 2020 206e 756d 5f73 6861 7264 733a       num_shards:
+0002f530: 2069 6e74 2c0a 2020 2020 2020 2020 696e   int,.        in
+0002f540: 6465 783a 2069 6e74 2c0a 2020 2020 2020  dex: int,.      
+0002f550: 2020 636f 6e74 6967 756f 7573 3a20 626f    contiguous: bo
+0002f560: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+0002f570: 2020 2020 6b65 6570 5f69 6e5f 6d65 6d6f      keep_in_memo
+0002f580: 7279 3a20 626f 6f6c 203d 2046 616c 7365  ry: bool = False
+0002f590: 2c0a 2020 2020 2020 2020 696e 6469 6365  ,.        indice
+0002f5a0: 735f 6361 6368 655f 6669 6c65 5f6e 616d  s_cache_file_nam
+0002f5b0: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
+0002f5c0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0002f5d0: 2077 7269 7465 725f 6261 7463 685f 7369   writer_batch_si
+0002f5e0: 7a65 3a20 4f70 7469 6f6e 616c 5b69 6e74  ze: Optional[int
+0002f5f0: 5d20 3d20 3130 3030 2c0a 2020 2020 2920  ] = 1000,.    ) 
+0002f600: 2d3e 2022 4461 7461 7365 7422 3a0a 2020  -> "Dataset":.  
+0002f610: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+0002f620: 7468 6520 6069 6e64 6578 602d 6e74 6820  the `index`-nth 
+0002f630: 7368 6172 6420 6672 6f6d 2064 6174 6173  shard from datas
+0002f640: 6574 2073 706c 6974 2069 6e74 6f20 606e  et split into `n
+0002f650: 756d 5f73 6861 7264 7360 2070 6965 6365  um_shards` piece
+0002f660: 732e 0a0a 2020 2020 2020 2020 5468 6973  s...        This
+0002f670: 2073 6861 7264 7320 6465 7465 726d 696e   shards determin
+0002f680: 6973 7469 6361 6c6c 792e 2060 6473 6574  istically. `dset
+0002f690: 2e73 6861 7264 286e 2c20 6929 6020 7769  .shard(n, i)` wi
+0002f6a0: 6c6c 2063 6f6e 7461 696e 2061 6c6c 2065  ll contain all e
+0002f6b0: 6c65 6d65 6e74 7320 6f66 2064 7365 7420  lements of dset 
+0002f6c0: 7768 6f73 650a 2020 2020 2020 2020 696e  whose.        in
+0002f6d0: 6465 7820 6d6f 6420 606e 203d 2069 602e  dex mod `n = i`.
+0002f6e0: 0a0a 2020 2020 2020 2020 6064 7365 742e  ..        `dset.
+0002f6f0: 7368 6172 6428 6e2c 2069 2c20 636f 6e74  shard(n, i, cont
+0002f700: 6967 756f 7573 3d54 7275 6529 6020 7769  iguous=True)` wi
+0002f710: 6c6c 2069 6e73 7465 6164 2073 706c 6974  ll instead split
+0002f720: 2064 7365 7420 696e 746f 2063 6f6e 7469   dset into conti
+0002f730: 6775 6f75 7320 6368 756e 6b73 2c0a 2020  guous chunks,.  
+0002f740: 2020 2020 2020 736f 2069 7420 6361 6e20        so it can 
+0002f750: 6265 2065 6173 696c 7920 636f 6e63 6174  be easily concat
+0002f760: 656e 6174 6564 2062 6163 6b20 746f 6765  enated back toge
+0002f770: 7468 6572 2061 6674 6572 2070 726f 6365  ther after proce
+0002f780: 7373 696e 672e 2049 6620 606e 2025 2069  ssing. If `n % i
+0002f790: 203d 3d20 6c60 2c20 7468 656e 2074 6865   == l`, then the
+0002f7a0: 0a20 2020 2020 2020 2066 6972 7374 2060  .        first `
+0002f7b0: 6c60 2073 6861 7264 7320 7769 6c6c 2068  l` shards will h
+0002f7c0: 6176 6520 6c65 6e67 7468 2060 286e 202f  ave length `(n /
+0002f7d0: 2f20 6929 202b 2031 602c 2061 6e64 2074  / i) + 1`, and t
+0002f7e0: 6865 2072 656d 6169 6e69 6e67 2073 6861  he remaining sha
+0002f7f0: 7264 7320 7769 6c6c 2068 6176 6520 6c65  rds will have le
+0002f800: 6e67 7468 2060 286e 202f 2f20 6929 602e  ngth `(n // i)`.
+0002f810: 0a20 2020 2020 2020 2060 6461 7461 7365  .        `datase
+0002f820: 7473 2e63 6f6e 6361 7465 6e61 7465 285b  ts.concatenate([
+0002f830: 6473 6574 2e73 6861 7264 286e 2c20 692c  dset.shard(n, i,
+0002f840: 2063 6f6e 7469 6775 6f75 733d 5472 7565   contiguous=True
+0002f850: 2920 666f 7220 6920 696e 2072 616e 6765  ) for i in range
+0002f860: 286e 295d 2960 2077 696c 6c20 7265 7475  (n)])` will retu
+0002f870: 726e 0a20 2020 2020 2020 2061 2064 6174  rn.        a dat
+0002f880: 6173 6574 2077 6974 6820 7468 6520 7361  aset with the sa
+0002f890: 6d65 206f 7264 6572 2061 7320 7468 6520  me order as the 
+0002f8a0: 6f72 6967 696e 616c 2e0a 0a20 2020 2020  original...     
+0002f8b0: 2020 2042 6520 7375 7265 2074 6f20 7368     Be sure to sh
+0002f8c0: 6172 6420 6265 666f 7265 2075 7369 6e67  ard before using
+0002f8d0: 2061 6e79 2072 616e 646f 6d69 7a69 6e67   any randomizing
+0002f8e0: 206f 7065 7261 746f 7220 2873 7563 6820   operator (such 
+0002f8f0: 6173 2060 7368 7566 666c 6560 292e 0a20  as `shuffle`).. 
+0002f900: 2020 2020 2020 2049 7420 6973 2062 6573         It is bes
+0002f910: 7420 6966 2074 6865 2073 6861 7264 206f  t if the shard o
+0002f920: 7065 7261 746f 7220 6973 2075 7365 6420  perator is used 
+0002f930: 6561 726c 7920 696e 2074 6865 2064 6174  early in the dat
+0002f940: 6173 6574 2070 6970 656c 696e 652e 0a0a  aset pipeline...
+0002f950: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+0002f960: 2020 2020 2020 2020 2020 206e 756d 5f73             num_s
+0002f970: 6861 7264 7320 2860 696e 7460 293a 0a20  hards (`int`):. 
+0002f980: 2020 2020 2020 2020 2020 2020 2020 2048                 H
+0002f990: 6f77 206d 616e 7920 7368 6172 6473 2074  ow many shards t
+0002f9a0: 6f20 7370 6c69 7420 7468 6520 6461 7461  o split the data
+0002f9b0: 7365 7420 696e 746f 2e0a 2020 2020 2020  set into..      
+0002f9c0: 2020 2020 2020 696e 6465 7820 2860 696e        index (`in
+0002f9d0: 7460 293a 0a20 2020 2020 2020 2020 2020  t`):.           
+0002f9e0: 2020 2020 2057 6869 6368 2073 6861 7264       Which shard
+0002f9f0: 2074 6f20 7365 6c65 6374 2061 6e64 2072   to select and r
+0002fa00: 6574 7572 6e2e 0a20 2020 2020 2020 2020  eturn..         
+0002fa10: 2020 2063 6f6e 7469 6775 6f75 733a 2028     contiguous: (
+0002fa20: 6062 6f6f 6c60 2c20 6465 6661 756c 7473  `bool`, defaults
+0002fa30: 2074 6f20 6046 616c 7365 6029 3a0a 2020   to `False`):.  
+0002fa40: 2020 2020 2020 2020 2020 2020 2020 5768                Wh
+0002fa50: 6574 6865 7220 746f 2073 656c 6563 7420  ether to select 
+0002fa60: 636f 6e74 6967 756f 7573 2062 6c6f 636b  contiguous block
+0002fa70: 7320 6f66 2069 6e64 6963 6573 2066 6f72  s of indices for
+0002fa80: 2073 6861 7264 732e 0a20 2020 2020 2020   shards..       
+0002fa90: 2020 2020 206b 6565 705f 696e 5f6d 656d       keep_in_mem
+0002faa0: 6f72 7920 2860 626f 6f6c 602c 2064 6566  ory (`bool`, def
+0002fab0: 6175 6c74 7320 746f 2060 4661 6c73 6560  aults to `False`
+0002fac0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0002fad0: 2020 204b 6565 7020 7468 6520 6461 7461     Keep the data
+0002fae0: 7365 7420 696e 206d 656d 6f72 7920 696e  set in memory in
+0002faf0: 7374 6561 6420 6f66 2077 7269 7469 6e67  stead of writing
+0002fb00: 2069 7420 746f 2061 2063 6163 6865 2066   it to a cache f
+0002fb10: 696c 652e 0a20 2020 2020 2020 2020 2020  ile..           
+0002fb20: 206c 6f61 645f 6672 6f6d 5f63 6163 6865   load_from_cache
+0002fb30: 5f66 696c 6520 2860 626f 6f6c 602c 2064  _file (`bool`, d
+0002fb40: 6566 6175 6c74 7320 746f 2060 5472 7565  efaults to `True
+0002fb50: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
+0002fb60: 2020 2020 4966 2061 2063 6163 6865 2066      If a cache f
+0002fb70: 696c 6520 7374 6f72 696e 6720 7468 6520  ile storing the 
+0002fb80: 6375 7272 656e 7420 636f 6d70 7574 6174  current computat
+0002fb90: 696f 6e20 6672 6f6d 2060 6675 6e63 7469  ion from `functi
+0002fba0: 6f6e 600a 2020 2020 2020 2020 2020 2020  on`.            
+0002fbb0: 2020 2020 6361 6e20 6265 2069 6465 6e74      can be ident
+0002fbc0: 6966 6965 642c 2075 7365 2069 7420 696e  ified, use it in
+0002fbd0: 7374 6561 6420 6f66 2072 6563 6f6d 7075  stead of recompu
+0002fbe0: 7469 6e67 2e0a 2020 2020 2020 2020 2020  ting..          
+0002fbf0: 2020 696e 6469 6365 735f 6361 6368 655f    indices_cache_
+0002fc00: 6669 6c65 5f6e 616d 6520 2860 7374 7260  file_name (`str`
+0002fc10: 2c20 2a6f 7074 696f 6e61 6c2a 293a 0a20  , *optional*):. 
+0002fc20: 2020 2020 2020 2020 2020 2020 2020 2050                 P
+0002fc30: 726f 7669 6465 2074 6865 206e 616d 6520  rovide the name 
+0002fc40: 6f66 2061 2070 6174 6820 666f 7220 7468  of a path for th
+0002fc50: 6520 6361 6368 6520 6669 6c65 2e20 4974  e cache file. It
+0002fc60: 2069 7320 7573 6564 2074 6f20 7374 6f72   is used to stor
+0002fc70: 6520 7468 650a 2020 2020 2020 2020 2020  e the.          
+0002fc80: 2020 2020 2020 696e 6469 6365 7320 6f66        indices of
+0002fc90: 2065 6163 6820 7368 6172 6420 696e 7374   each shard inst
+0002fca0: 6561 6420 6f66 2074 6865 2061 7574 6f6d  ead of the autom
+0002fcb0: 6174 6963 616c 6c79 2067 656e 6572 6174  atically generat
+0002fcc0: 6564 2063 6163 6865 2066 696c 6520 6e61  ed cache file na
+0002fcd0: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
+0002fce0: 7772 6974 6572 5f62 6174 6368 5f73 697a  writer_batch_siz
+0002fcf0: 6520 2860 696e 7460 2c20 6465 6661 756c  e (`int`, defaul
+0002fd00: 7473 2074 6f20 6031 3030 3060 293a 0a20  ts to `1000`):. 
+0002fd10: 2020 2020 2020 2020 2020 2020 2020 204e                 N
+0002fd20: 756d 6265 7220 6f66 2072 6f77 7320 7065  umber of rows pe
+0002fd30: 7220 7772 6974 6520 6f70 6572 6174 696f  r write operatio
+0002fd40: 6e20 666f 7220 7468 6520 6361 6368 6520  n for the cache 
+0002fd50: 6669 6c65 2077 7269 7465 722e 0a20 2020  file writer..   
+0002fd60: 2020 2020 2020 2020 2020 2020 2054 6869               Thi
+0002fd70: 7320 7661 6c75 6520 6973 2061 2067 6f6f  s value is a goo
+0002fd80: 6420 7472 6164 652d 6f66 6620 6265 7477  d trade-off betw
+0002fd90: 6565 6e20 6d65 6d6f 7279 2075 7361 6765  een memory usage
+0002fda0: 2064 7572 696e 6720 7468 6520 7072 6f63   during the proc
+0002fdb0: 6573 7369 6e67 2c20 616e 6420 7072 6f63  essing, and proc
+0002fdc0: 6573 7369 6e67 2073 7065 6564 2e0a 2020  essing speed..  
+0002fdd0: 2020 2020 2020 2020 2020 2020 2020 4869                Hi
+0002fde0: 6768 6572 2076 616c 7565 206d 616b 6573  gher value makes
+0002fdf0: 2074 6865 2070 726f 6365 7373 696e 6720   the processing 
+0002fe00: 646f 2066 6577 6572 206c 6f6f 6b75 7073  do fewer lookups
+0002fe10: 2c20 6c6f 7765 7220 7661 6c75 6520 636f  , lower value co
+0002fe20: 6e73 756d 6520 6c65 7373 2074 656d 706f  nsume less tempo
+0002fe30: 7261 7279 206d 656d 6f72 7920 7768 696c  rary memory whil
+0002fe40: 6520 7275 6e6e 696e 6720 606d 6170 602e  e running `map`.
+0002fe50: 0a0a 2020 2020 2020 2020 4578 616d 706c  ..        Exampl
+0002fe60: 653a 0a0a 2020 2020 2020 2020 6060 6070  e:..        ```p
+0002fe70: 790a 2020 2020 2020 2020 3e3e 3e20 6672  y.        >>> fr
+0002fe80: 6f6d 2064 6174 6173 6574 7320 696d 706f  om datasets impo
+0002fe90: 7274 206c 6f61 645f 6461 7461 7365 740a  rt load_dataset.
+0002fea0: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
+0002feb0: 206c 6f61 645f 6461 7461 7365 7428 2272   load_dataset("r
+0002fec0: 6f74 7465 6e5f 746f 6d61 746f 6573 222c  otten_tomatoes",
+0002fed0: 2073 706c 6974 3d22 7661 6c69 6461 7469   split="validati
+0002fee0: 6f6e 2229 0a20 2020 2020 2020 203e 3e3e  on").        >>>
+0002fef0: 2064 730a 2020 2020 2020 2020 4461 7461   ds.        Data
+0002ff00: 7365 7428 7b0a 2020 2020 2020 2020 2020  set({.          
+0002ff10: 2020 6665 6174 7572 6573 3a20 5b27 7465    features: ['te
+0002ff20: 7874 272c 2027 6c61 6265 6c27 5d2c 0a20  xt', 'label'],. 
+0002ff30: 2020 2020 2020 2020 2020 206e 756d 5f72             num_r
+0002ff40: 6f77 733a 2031 3036 360a 2020 2020 2020  ows: 1066.      
+0002ff50: 2020 7d29 0a20 2020 2020 2020 203e 3e3e    }).        >>>
+0002ff60: 2064 732e 7368 6172 6428 6e75 6d5f 7368   ds.shard(num_sh
+0002ff70: 6172 6473 3d32 2c20 696e 6465 783d 3029  ards=2, index=0)
+0002ff80: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+0002ff90: 287b 0a20 2020 2020 2020 2020 2020 2066  ({.            f
+0002ffa0: 6561 7475 7265 733a 205b 2774 6578 7427  eatures: ['text'
+0002ffb0: 2c20 276c 6162 656c 275d 2c0a 2020 2020  , 'label'],.    
+0002ffc0: 2020 2020 2020 2020 6e75 6d5f 726f 7773          num_rows
+0002ffd0: 3a20 3533 330a 2020 2020 2020 2020 7d29  : 533.        })
+0002ffe0: 0a20 2020 2020 2020 2060 6060 0a20 2020  .        ```.   
+0002fff0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00030000: 2069 6620 6e6f 7420 3020 3c3d 2069 6e64   if not 0 <= ind
+00030010: 6578 203c 206e 756d 5f73 6861 7264 733a  ex < num_shards:
+00030020: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00030030: 7365 2056 616c 7565 4572 726f 7228 2269  se ValueError("i
+00030040: 6e64 6578 2073 686f 756c 6420 6265 2069  ndex should be i
+00030050: 6e20 5b30 2c20 6e75 6d5f 7368 6172 6473  n [0, num_shards
+00030060: 2d31 5d22 290a 2020 2020 2020 2020 6966  -1]").        if
+00030070: 2063 6f6e 7469 6775 6f75 733a 0a20 2020   contiguous:.   
+00030080: 2020 2020 2020 2020 2064 6976 203d 206c           div = l
+00030090: 656e 2873 656c 6629 202f 2f20 6e75 6d5f  en(self) // num_
+000300a0: 7368 6172 6473 0a20 2020 2020 2020 2020  shards.         
+000300b0: 2020 206d 6f64 203d 206c 656e 2873 656c     mod = len(sel
+000300c0: 6629 2025 206e 756d 5f73 6861 7264 730a  f) % num_shards.
+000300d0: 2020 2020 2020 2020 2020 2020 7374 6172              star
+000300e0: 7420 3d20 6469 7620 2a20 696e 6465 7820  t = div * index 
+000300f0: 2b20 6d69 6e28 696e 6465 782c 206d 6f64  + min(index, mod
+00030100: 290a 2020 2020 2020 2020 2020 2020 656e  ).            en
+00030110: 6420 3d20 7374 6172 7420 2b20 6469 7620  d = start + div 
+00030120: 2b20 2831 2069 6620 696e 6465 7820 3c20  + (1 if index < 
+00030130: 6d6f 6420 656c 7365 2030 290a 2020 2020  mod else 0).    
+00030140: 2020 2020 2020 2020 696e 6469 6365 7320          indices 
+00030150: 3d20 7261 6e67 6528 7374 6172 742c 2065  = range(start, e
+00030160: 6e64 290a 2020 2020 2020 2020 656c 7365  nd).        else
+00030170: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+00030180: 6469 6365 7320 3d20 6e70 2e61 7261 6e67  dices = np.arang
+00030190: 6528 696e 6465 782c 206c 656e 2873 656c  e(index, len(sel
+000301a0: 6629 2c20 6e75 6d5f 7368 6172 6473 290a  f), num_shards).
+000301b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000301c0: 7365 6c66 2e73 656c 6563 7428 0a20 2020  self.select(.   
+000301d0: 2020 2020 2020 2020 2069 6e64 6963 6573           indices
+000301e0: 3d69 6e64 6963 6573 2c0a 2020 2020 2020  =indices,.      
+000301f0: 2020 2020 2020 6b65 6570 5f69 6e5f 6d65        keep_in_me
+00030200: 6d6f 7279 3d6b 6565 705f 696e 5f6d 656d  mory=keep_in_mem
+00030210: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
+00030220: 2069 6e64 6963 6573 5f63 6163 6865 5f66   indices_cache_f
+00030230: 696c 655f 6e61 6d65 3d69 6e64 6963 6573  ile_name=indices
+00030240: 5f63 6163 6865 5f66 696c 655f 6e61 6d65  _cache_file_name
+00030250: 2c0a 2020 2020 2020 2020 2020 2020 7772  ,.            wr
+00030260: 6974 6572 5f62 6174 6368 5f73 697a 653d  iter_batch_size=
+00030270: 7772 6974 6572 5f62 6174 6368 5f73 697a  writer_batch_siz
+00030280: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
+00030290: 2020 6465 6620 6578 706f 7274 280a 2020    def export(.  
+000302a0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+000302b0: 2020 2020 6669 6c65 6e61 6d65 3a20 7374      filename: st
+000302c0: 722c 0a20 2020 2020 2020 2066 6f72 6d61  r,.        forma
+000302d0: 743a 2073 7472 203d 2022 7466 7265 636f  t: str = "tfreco
+000302e0: 7264 222c 0a20 2020 2029 3a0a 2020 2020  rd",.    ):.    
+000302f0: 2020 2020 2222 2257 7269 7465 7320 7468      """Writes th
+00030300: 6520 4172 726f 7720 6461 7461 7365 7420  e Arrow dataset 
+00030310: 746f 2061 2054 4652 6563 6f72 6420 6669  to a TFRecord fi
+00030320: 6c65 2e0a 0a20 2020 2020 2020 2054 6865  le...        The
+00030330: 2064 6174 6173 6574 206d 7573 7420 616c   dataset must al
+00030340: 7265 6164 7920 6265 2069 6e20 7465 6e73  ready be in tens
+00030350: 6f72 666c 6f77 2066 6f72 6d61 742e 2054  orflow format. T
+00030360: 6865 2072 6563 6f72 6473 2077 696c 6c20  he records will 
+00030370: 6265 2077 7269 7474 656e 2077 6974 680a  be written with.
+00030380: 2020 2020 2020 2020 6b65 7973 2066 726f          keys fro
+00030390: 6d20 6064 6174 6173 6574 2e5f 666f 726d  m `dataset._form
+000303a0: 6174 5f63 6f6c 756d 6e73 602e 0a0a 2020  at_columns`...  
+000303b0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+000303c0: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
+000303d0: 2028 6073 7472 6029 3a20 5468 6520 6669   (`str`): The fi
+000303e0: 6c65 6e61 6d65 2c20 696e 636c 7564 696e  lename, includin
+000303f0: 6720 7468 6520 602e 7466 7265 636f 7264  g the `.tfrecord
+00030400: 6020 6578 7465 6e73 696f 6e2c 2074 6f20  ` extension, to 
+00030410: 7772 6974 6520 746f 2e0a 2020 2020 2020  write to..      
+00030420: 2020 2020 2020 666f 726d 6174 2028 6073        format (`s
+00030430: 7472 602c 206f 7074 696f 6e61 6c2c 2064  tr`, optional, d
+00030440: 6566 6175 6c74 2060 2274 6672 6563 6f72  efault `"tfrecor
+00030450: 6422 6029 3a20 5468 6520 7479 7065 206f  d"`): The type o
+00030460: 6620 6f75 7470 7574 2066 696c 652e 2043  f output file. C
+00030470: 7572 7265 6e74 6c79 2074 6869 7320 6973  urrently this is
+00030480: 2061 206e 6f2d 6f70 2c20 6173 0a20 2020   a no-op, as.   
+00030490: 2020 2020 2020 2020 2020 2020 2054 4652               TFR
+000304a0: 6563 6f72 6473 2061 7265 2074 6865 206f  ecords are the o
+000304b0: 6e6c 7920 6f70 7469 6f6e 2e20 5468 6973  nly option. This
+000304c0: 2065 6e61 626c 6573 2061 206d 6f72 6520   enables a more 
+000304d0: 666c 6578 6962 6c65 2066 756e 6374 696f  flexible functio
+000304e0: 6e20 7369 676e 6174 7572 6520 6c61 7465  n signature late
+000304f0: 722e 0a20 2020 2020 2020 2022 2222 0a20  r..        """. 
+00030500: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00030510: 2020 2020 2020 2020 696d 706f 7274 2074          import t
+00030520: 656e 736f 7266 6c6f 7720 6173 2074 6620  ensorflow as tf 
+00030530: 2023 206e 6f71 613a 2046 3430 310a 2020   # noqa: F401.  
+00030540: 2020 2020 2020 6578 6365 7074 2049 6d70        except Imp
+00030550: 6f72 7445 7272 6f72 3a0a 2020 2020 2020  ortError:.      
+00030560: 2020 2020 2020 6c6f 6767 6572 2e65 7272        logger.err
+00030570: 6f72 2822 5465 6e73 6f72 666c 6f77 206e  or("Tensorflow n
+00030580: 6565 6473 2074 6f20 6265 2069 6e73 7461  eeds to be insta
+00030590: 6c6c 6564 2074 6f20 6265 2061 626c 6520  lled to be able 
+000305a0: 746f 2072 6574 7572 6e20 5465 6e73 6f72  to return Tensor
+000305b0: 666c 6f77 2074 656e 736f 7273 2e22 290a  flow tensors.").
+000305c0: 0a20 2020 2020 2020 2023 2046 726f 6d20  .        # From 
+000305d0: 6874 7470 733a 2f2f 7777 772e 7465 6e73  https://www.tens
+000305e0: 6f72 666c 6f77 2e6f 7267 2f74 7574 6f72  orflow.org/tutor
+000305f0: 6961 6c73 2f6c 6f61 645f 6461 7461 2f74  ials/load_data/t
+00030600: 6672 6563 6f72 640a 2020 2020 2020 2020  frecord.        
+00030610: 6465 6620 5f62 7974 6573 5f66 6561 7475  def _bytes_featu
+00030620: 7265 2876 616c 7565 7329 3a0a 2020 2020  re(values):.    
+00030630: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00030640: 6e73 2061 2062 7974 6573 5f6c 6973 7420  ns a bytes_list 
+00030650: 6672 6f6d 2061 206c 6973 7420 6f66 2073  from a list of s
+00030660: 7472 696e 6720 2f20 6279 7465 2e22 2222  tring / byte."""
+00030670: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00030680: 7572 6e20 7466 2e74 7261 696e 2e46 6561  urn tf.train.Fea
+00030690: 7475 7265 2862 7974 6573 5f6c 6973 743d  ture(bytes_list=
+000306a0: 7466 2e74 7261 696e 2e42 7974 6573 4c69  tf.train.BytesLi
+000306b0: 7374 2876 616c 7565 3d76 616c 7565 7329  st(value=values)
+000306c0: 290a 0a20 2020 2020 2020 2064 6566 205f  )..        def _
+000306d0: 666c 6f61 745f 6665 6174 7572 6528 7661  float_feature(va
+000306e0: 6c75 6573 293a 0a20 2020 2020 2020 2020  lues):.         
+000306f0: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
+00030700: 666c 6f61 745f 6c69 7374 2066 726f 6d20  float_list from 
+00030710: 6120 6c69 7374 206f 6620 666c 6f61 7420  a list of float 
+00030720: 2f20 646f 7562 6c65 2e22 2222 0a20 2020  / double.""".   
+00030730: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00030740: 7466 2e74 7261 696e 2e46 6561 7475 7265  tf.train.Feature
+00030750: 2866 6c6f 6174 5f6c 6973 743d 7466 2e74  (float_list=tf.t
+00030760: 7261 696e 2e46 6c6f 6174 4c69 7374 2876  rain.FloatList(v
+00030770: 616c 7565 3d76 616c 7565 7329 290a 0a20  alue=values)).. 
+00030780: 2020 2020 2020 2064 6566 205f 696e 7436         def _int6
+00030790: 345f 6665 6174 7572 6528 7661 6c75 6573  4_feature(values
+000307a0: 293a 0a20 2020 2020 2020 2020 2020 2022  ):.            "
+000307b0: 2222 5265 7475 726e 7320 616e 2069 6e74  ""Returns an int
+000307c0: 3634 5f6c 6973 7420 6672 6f6d 2061 206c  64_list from a l
+000307d0: 6973 7420 6f66 2062 6f6f 6c20 2f20 656e  ist of bool / en
+000307e0: 756d 202f 2069 6e74 202f 2075 696e 742e  um / int / uint.
+000307f0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+00030800: 7265 7475 726e 2074 662e 7472 6169 6e2e  return tf.train.
+00030810: 4665 6174 7572 6528 696e 7436 345f 6c69  Feature(int64_li
+00030820: 7374 3d74 662e 7472 6169 6e2e 496e 7436  st=tf.train.Int6
+00030830: 344c 6973 7428 7661 6c75 653d 7661 6c75  4List(value=valu
+00030840: 6573 2929 0a0a 2020 2020 2020 2020 6465  es))..        de
+00030850: 6620 5f66 6561 7475 7265 2876 616c 7565  f _feature(value
+00030860: 733a 2055 6e69 6f6e 5b66 6c6f 6174 2c20  s: Union[float, 
+00030870: 696e 742c 2073 7472 2c20 6e70 2e6e 6461  int, str, np.nda
+00030880: 7272 6179 2c20 6c69 7374 5d29 202d 3e20  rray, list]) -> 
+00030890: 2274 662e 7472 6169 6e2e 4665 6174 7572  "tf.train.Featur
+000308a0: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
+000308b0: 2222 2254 7970 6563 6865 636b 7320 6076  """Typechecks `v
+000308c0: 616c 7565 7360 2061 6e64 2072 6574 7572  alues` and retur
+000308d0: 6e73 2074 6865 2063 6f72 7265 7370 6f6e  ns the correspon
+000308e0: 6469 6e67 2074 662e 7472 6169 6e2e 4665  ding tf.train.Fe
+000308f0: 6174 7572 652e 2222 220a 2020 2020 2020  ature.""".      
+00030900: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00030910: 6e63 6528 7661 6c75 6573 2c20 6c69 7374  nce(values, list
+00030920: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00030930: 2020 2069 6620 7661 6c75 6573 2061 6e64     if values and
+00030940: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
+00030950: 6573 5b30 5d2c 2073 7472 293a 0a20 2020  es[0], str):.   
+00030960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030970: 2072 6574 7572 6e20 5f62 7974 6573 5f66   return _bytes_f
+00030980: 6561 7475 7265 285b 762e 656e 636f 6465  eature([v.encode
+00030990: 2829 2066 6f72 2076 2069 6e20 7661 6c75  () for v in valu
+000309a0: 6573 5d29 0a20 2020 2020 2020 2020 2020  es]).           
+000309b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000309c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000309d0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+000309e0: 6622 7661 6c75 6573 3d7b 7661 6c75 6573  f"values={values
+000309f0: 7d20 6973 2065 6d70 7479 206f 7220 636f  } is empty or co
+00030a00: 6e74 6169 6e73 2069 7465 6d73 2074 6861  ntains items tha
+00030a10: 7420 6361 6e6e 6f74 2062 6520 7365 7269  t cannot be seri
+00030a20: 616c 697a 6564 2229 0a20 2020 2020 2020  alized").       
+00030a30: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00030a40: 616e 6365 2876 616c 7565 732c 206e 702e  ance(values, np.
+00030a50: 6e64 6172 7261 7929 3a0a 2020 2020 2020  ndarray):.      
+00030a60: 2020 2020 2020 2020 2020 6966 2076 616c            if val
+00030a70: 7565 732e 6474 7970 6520 3d3d 206e 702e  ues.dtype == np.
+00030a80: 6474 7970 6528 666c 6f61 7429 3a0a 2020  dtype(float):.  
+00030a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030aa0: 2020 7265 7475 726e 205f 666c 6f61 745f    return _float_
+00030ab0: 6665 6174 7572 6528 7661 6c75 6573 290a  feature(values).
+00030ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030ad0: 656c 6966 2076 616c 7565 732e 6474 7970  elif values.dtyp
+00030ae0: 6520 3d3d 206e 702e 696e 7436 343a 0a20  e == np.int64:. 
+00030af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030b00: 2020 2072 6574 7572 6e20 5f69 6e74 3634     return _int64
+00030b10: 5f66 6561 7475 7265 2876 616c 7565 7329  _feature(values)
+00030b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030b30: 2065 6c69 6620 7661 6c75 6573 2e64 7479   elif values.dty
+00030b40: 7065 203d 3d20 6e70 2e64 7479 7065 2873  pe == np.dtype(s
+00030b50: 7472 2920 6f72 2028 0a20 2020 2020 2020  tr) or (.       
+00030b60: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00030b70: 7565 732e 6474 7970 6520 3d3d 206e 702e  ues.dtype == np.
+00030b80: 6474 7970 6528 6f62 6a65 6374 2920 616e  dtype(object) an
+00030b90: 6420 6c65 6e28 7661 6c75 6573 2920 3e20  d len(values) > 
+00030ba0: 3020 616e 6420 6973 696e 7374 616e 6365  0 and isinstance
+00030bb0: 2876 616c 7565 735b 305d 2c20 7374 7229  (values[0], str)
+00030bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030bd0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00030be0: 2020 2020 2020 2020 7265 7475 726e 205f          return _
+00030bf0: 6279 7465 735f 6665 6174 7572 6528 5b76  bytes_feature([v
+00030c00: 2e65 6e63 6f64 6528 2920 666f 7220 7620  .encode() for v 
+00030c10: 696e 2076 616c 7565 735d 290a 2020 2020  in values]).    
+00030c20: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00030c30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00030c40: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00030c50: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00030c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030c70: 6622 7661 6c75 6573 3d7b 7661 6c75 6573  f"values={values
+00030c80: 7d20 6973 2065 6d70 7479 206f 7220 6973  } is empty or is
+00030c90: 2061 6e20 6e70 2e6e 6461 7272 6179 2077   an np.ndarray w
+00030ca0: 6974 6820 6974 656d 7320 6f66 2064 7479  ith items of dty
+00030cb0: 7065 207b 7661 6c75 6573 5b30 5d2e 6474  pe {values[0].dt
+00030cc0: 7970 657d 2c20 7768 6963 6820 6361 6e6e  ype}, which cann
+00030cd0: 6f74 2062 6520 7365 7269 616c 697a 6564  ot be serialized
+00030ce0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00030cf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00030d00: 2020 2020 656c 6966 2068 6173 6174 7472      elif hasattr
+00030d10: 2876 616c 7565 732c 2022 6474 7970 6522  (values, "dtype"
+00030d20: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00030d30: 2020 2069 6620 6e70 2e69 7373 7562 6474     if np.issubdt
+00030d40: 7970 6528 7661 6c75 6573 2e64 7479 7065  ype(values.dtype
+00030d50: 2c20 6e70 2e66 6c6f 6174 696e 6729 3a0a  , np.floating):.
+00030d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030d70: 2020 2020 7265 7475 726e 205f 666c 6f61      return _floa
+00030d80: 745f 6665 6174 7572 6528 5b76 616c 7565  t_feature([value
+00030d90: 732e 6974 656d 2829 5d29 0a20 2020 2020  s.item()]).     
+00030da0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00030db0: 6e70 2e69 7373 7562 6474 7970 6528 7661  np.issubdtype(va
+00030dc0: 6c75 6573 2e64 7479 7065 2c20 6e70 2e69  lues.dtype, np.i
+00030dd0: 6e74 6567 6572 293a 0a20 2020 2020 2020  nteger):.       
+00030de0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00030df0: 7572 6e20 5f69 6e74 3634 5f66 6561 7475  urn _int64_featu
+00030e00: 7265 285b 7661 6c75 6573 2e69 7465 6d28  re([values.item(
+00030e10: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
+00030e20: 2020 2020 656c 6966 206e 702e 6973 7375      elif np.issu
+00030e30: 6264 7479 7065 2876 616c 7565 732e 6474  bdtype(values.dt
+00030e40: 7970 652c 2073 7472 293a 0a20 2020 2020  ype, str):.     
+00030e50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00030e60: 6574 7572 6e20 5f62 7974 6573 5f66 6561  eturn _bytes_fea
+00030e70: 7475 7265 285b 7661 6c75 6573 2e69 7465  ture([values.ite
+00030e80: 6d28 292e 656e 636f 6465 2829 5d29 0a20  m().encode()]). 
+00030e90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00030ea0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00030eb0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00030ec0: 616c 7565 4572 726f 7228 6622 7661 6c75  alueError(f"valu
+00030ed0: 6573 3d7b 7661 6c75 6573 7d20 6861 7320  es={values} has 
+00030ee0: 6474 7970 6520 7b76 616c 7565 732e 6474  dtype {values.dt
+00030ef0: 7970 657d 2c20 7768 6963 6820 6361 6e6e  ype}, which cann
+00030f00: 6f74 2062 6520 7365 7269 616c 697a 6564  ot be serialized
+00030f10: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
+00030f20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00030f30: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00030f40: 4572 726f 7228 6622 7661 6c75 6573 3d7b  Error(f"values={
+00030f50: 7661 6c75 6573 7d20 6172 6520 6e6f 7420  values} are not 
+00030f60: 6e75 6d70 7920 6f62 6a65 6374 7320 6f72  numpy objects or
+00030f70: 2073 7472 696e 6773 2c20 616e 6420 736f   strings, and so
+00030f80: 2063 616e 6e6f 7420 6265 2073 6572 6961   cannot be seria
+00030f90: 6c69 7a65 6422 290a 0a20 2020 2020 2020  lized")..       
+00030fa0: 2064 6566 2073 6572 6961 6c69 7a65 5f65   def serialize_e
+00030fb0: 7861 6d70 6c65 2865 7829 3a0a 2020 2020  xample(ex):.    
+00030fc0: 2020 2020 2020 2020 6665 6174 7572 6520          feature 
+00030fd0: 3d20 7b6b 6579 3a20 5f66 6561 7475 7265  = {key: _feature
+00030fe0: 2876 616c 7565 2920 666f 7220 6b65 792c  (value) for key,
+00030ff0: 2076 616c 7565 2069 6e20 6578 2e69 7465   value in ex.ite
+00031000: 6d73 2829 7d0a 2020 2020 2020 2020 2020  ms()}.          
+00031010: 2020 6578 616d 706c 655f 7072 6f74 6f20    example_proto 
+00031020: 3d20 7466 2e74 7261 696e 2e45 7861 6d70  = tf.train.Examp
+00031030: 6c65 2866 6561 7475 7265 733d 7466 2e74  le(features=tf.t
+00031040: 7261 696e 2e46 6561 7475 7265 7328 6665  rain.Features(fe
+00031050: 6174 7572 653d 6665 6174 7572 6529 290a  ature=feature)).
+00031060: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00031070: 726e 2065 7861 6d70 6c65 5f70 726f 746f  rn example_proto
+00031080: 2e53 6572 6961 6c69 7a65 546f 5374 7269  .SerializeToStri
+00031090: 6e67 2829 0a0a 2020 2020 2020 2020 6465  ng()..        de
+000310a0: 6620 7466 5f73 6572 6961 6c69 7a65 5f65  f tf_serialize_e
+000310b0: 7861 6d70 6c65 2865 7829 3a0a 2020 2020  xample(ex):.    
+000310c0: 2020 2020 2020 2020 7466 5f73 7472 696e          tf_strin
+000310d0: 6720 3d20 7466 2e70 795f 6675 6e63 7469  g = tf.py_functi
+000310e0: 6f6e 2873 6572 6961 6c69 7a65 5f65 7861  on(serialize_exa
+000310f0: 6d70 6c65 2c20 2865 782c 292c 2074 662e  mple, (ex,), tf.
+00031100: 7374 7269 6e67 290a 2020 2020 2020 2020  string).        
+00031110: 2020 2020 7265 7475 726e 2074 662e 7265      return tf.re
+00031120: 7368 6170 6528 7466 5f73 7472 696e 672c  shape(tf_string,
+00031130: 2028 2929 0a0a 2020 2020 2020 2020 6465   ())..        de
+00031140: 6620 6765 6e65 7261 746f 7228 293a 0a20  f generator():. 
+00031150: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
+00031160: 7820 696e 2073 656c 663a 0a20 2020 2020  x in self:.     
+00031170: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+00031180: 2073 6572 6961 6c69 7a65 5f65 7861 6d70   serialize_examp
+00031190: 6c65 2865 7829 0a0a 2020 2020 2020 2020  le(ex)..        
+000311a0: 6966 2073 656c 662e 5f66 6f72 6d61 745f  if self._format_
+000311b0: 7479 7065 2021 3d20 226e 756d 7079 223a  type != "numpy":
+000311c0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+000311d0: 7365 2056 616c 7565 4572 726f 7228 2244  se ValueError("D
+000311e0: 6174 6173 6574 2066 6f72 6d61 7420 6d75  ataset format mu
+000311f0: 7374 2062 6520 6e75 6d70 7920 6265 666f  st be numpy befo
+00031200: 7265 2065 7870 6f72 7469 6e67 2229 0a20  re exporting"). 
+00031210: 2020 2020 2020 2069 6620 6e6f 7420 6669         if not fi
+00031220: 6c65 6e61 6d65 2e65 6e64 7377 6974 6828  lename.endswith(
+00031230: 222e 7466 7265 636f 7264 2229 3a0a 2020  ".tfrecord"):.  
+00031240: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00031250: 5661 6c75 6545 7272 6f72 2822 6669 6c65  ValueError("file
+00031260: 6e61 6d65 207b 6669 6c65 6e61 6d65 7d20  name {filename} 
+00031270: 6d75 7374 2065 6e64 2077 6974 6820 2e74  must end with .t
+00031280: 6672 6563 6f72 6422 290a 2020 2020 2020  frecord").      
+00031290: 2020 7466 5f64 6174 6173 6574 203d 2074    tf_dataset = t
+000312a0: 662e 6461 7461 2e44 6174 6173 6574 2e66  f.data.Dataset.f
+000312b0: 726f 6d5f 6765 6e65 7261 746f 7228 6765  rom_generator(ge
+000312c0: 6e65 7261 746f 722c 206f 7574 7075 745f  nerator, output_
+000312d0: 7479 7065 733d 7466 2e73 7472 696e 672c  types=tf.string,
+000312e0: 206f 7574 7075 745f 7368 6170 6573 3d28   output_shapes=(
+000312f0: 2929 0a20 2020 2020 2020 2077 7269 7465  )).        write
+00031300: 7220 3d20 7466 2e64 6174 612e 6578 7065  r = tf.data.expe
+00031310: 7269 6d65 6e74 616c 2e54 4652 6563 6f72  rimental.TFRecor
+00031320: 6457 7269 7465 7228 6669 6c65 6e61 6d65  dWriter(filename
+00031330: 290a 2020 2020 2020 2020 6c6f 6767 6572  ).        logger
+00031340: 2e69 6e66 6f28 6622 5772 6974 696e 6720  .info(f"Writing 
+00031350: 5446 5265 636f 7264 2074 6f20 7b66 696c  TFRecord to {fil
+00031360: 656e 616d 657d 2229 0a20 2020 2020 2020  ename}").       
+00031370: 2077 7269 7465 722e 7772 6974 6528 7466   writer.write(tf
+00031380: 5f64 6174 6173 6574 290a 2020 2020 2020  _dataset).      
+00031390: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
+000313a0: 4669 6e69 7368 6564 2077 7269 7469 6e67  Finished writing
+000313b0: 2054 4652 6563 6f72 6420 746f 207b 6669   TFRecord to {fi
+000313c0: 6c65 6e61 6d65 7d22 290a 2020 2020 2020  lename}").      
+000313d0: 2020 7365 6c66 203d 204e 6f6e 6520 2023    self = None  #
+000313e0: 2064 656c 6574 6520 7468 6520 6461 7461   delete the data
+000313f0: 7365 7420 7265 6665 7265 6e63 6520 7573  set reference us
+00031400: 6564 2062 7920 7466 5f64 6174 6173 6574  ed by tf_dataset
+00031410: 0a0a 2020 2020 6465 6620 746f 5f63 7376  ..    def to_csv
+00031420: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00031430: 2020 2020 2020 2020 7061 7468 5f6f 725f          path_or_
+00031440: 6275 663a 2055 6e69 6f6e 5b50 6174 684c  buf: Union[PathL
+00031450: 696b 652c 2042 696e 6172 7949 4f5d 2c0a  ike, BinaryIO],.
+00031460: 2020 2020 2020 2020 6261 7463 685f 7369          batch_si
+00031470: 7a65 3a20 4f70 7469 6f6e 616c 5b69 6e74  ze: Optional[int
+00031480: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00031490: 2020 6e75 6d5f 7072 6f63 3a20 4f70 7469    num_proc: Opti
+000314a0: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
+000314b0: 2c0a 2020 2020 2020 2020 2a2a 746f 5f63  ,.        **to_c
+000314c0: 7376 5f6b 7761 7267 732c 0a20 2020 2029  sv_kwargs,.    )
+000314d0: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
+000314e0: 2022 2222 4578 706f 7274 7320 7468 6520   """Exports the 
+000314f0: 6461 7461 7365 7420 746f 2063 7376 0a0a  dataset to csv..
+00031500: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00031510: 2020 2020 2020 2020 2020 7061 7468 5f6f            path_o
+00031520: 725f 6275 6620 2860 5061 7468 4c69 6b65  r_buf (`PathLike
+00031530: 6020 6f72 2060 4669 6c65 4f72 4275 6666  ` or `FileOrBuff
+00031540: 6572 6029 3a0a 2020 2020 2020 2020 2020  er`):.          
+00031550: 2020 2020 2020 4569 7468 6572 2061 2070        Either a p
+00031560: 6174 6820 746f 2061 2066 696c 6520 6f72  ath to a file or
+00031570: 2061 2042 696e 6172 7949 4f2e 0a20 2020   a BinaryIO..   
+00031580: 2020 2020 2020 2020 2062 6174 6368 5f73           batch_s
+00031590: 697a 6520 2860 696e 7460 2c20 2a6f 7074  ize (`int`, *opt
+000315a0: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
+000315b0: 2020 2020 2020 2020 2053 697a 6520 6f66           Size of
+000315c0: 2074 6865 2062 6174 6368 2074 6f20 6c6f   the batch to lo
+000315d0: 6164 2069 6e20 6d65 6d6f 7279 2061 6e64  ad in memory and
+000315e0: 2077 7269 7465 2061 7420 6f6e 6365 2e0a   write at once..
+000315f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031600: 4465 6661 756c 7473 2074 6f20 6064 6174  Defaults to `dat
+00031610: 6173 6574 732e 636f 6e66 6967 2e44 4546  asets.config.DEF
+00031620: 4155 4c54 5f4d 4158 5f42 4154 4348 5f53  AULT_MAX_BATCH_S
+00031630: 495a 4560 2e0a 2020 2020 2020 2020 2020  IZE`..          
+00031640: 2020 6e75 6d5f 7072 6f63 2028 6069 6e74    num_proc (`int
+00031650: 602c 202a 6f70 7469 6f6e 616c 2a29 3a0a  `, *optional*):.
+00031660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031670: 4e75 6d62 6572 206f 6620 7072 6f63 6573  Number of proces
+00031680: 7365 7320 666f 7220 6d75 6c74 6970 726f  ses for multipro
+00031690: 6365 7373 696e 672e 2042 7920 6465 6661  cessing. By defa
+000316a0: 756c 7420 6974 2064 6f65 736e 2774 0a20  ult it doesn't. 
+000316b0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+000316c0: 7365 206d 756c 7469 7072 6f63 6573 7369  se multiprocessi
+000316d0: 6e67 2e20 6062 6174 6368 5f73 697a 6560  ng. `batch_size`
+000316e0: 2069 6e20 7468 6973 2063 6173 6520 6465   in this case de
+000316f0: 6661 756c 7473 2074 6f0a 2020 2020 2020  faults to.      
+00031700: 2020 2020 2020 2020 2020 6064 6174 6173            `datas
+00031710: 6574 732e 636f 6e66 6967 2e44 4546 4155  ets.config.DEFAU
+00031720: 4c54 5f4d 4158 5f42 4154 4348 5f53 495a  LT_MAX_BATCH_SIZ
+00031730: 4560 2062 7574 2066 6565 6c20 6672 6565  E` but feel free
+00031740: 2074 6f20 6d61 6b65 2069 7420 3578 206f   to make it 5x o
+00031750: 7220 3130 7820 6f66 2074 6865 2064 6566  r 10x of the def
+00031760: 6175 6c74 0a20 2020 2020 2020 2020 2020  ault.           
+00031770: 2020 2020 2076 616c 7565 2069 6620 796f       value if yo
+00031780: 7520 6861 7665 2073 7566 6669 6369 656e  u have sufficien
+00031790: 7420 636f 6d70 7574 6520 706f 7765 722e  t compute power.
+000317a0: 0a20 2020 2020 2020 2020 2020 202a 2a74  .            **t
+000317b0: 6f5f 6373 765f 6b77 6172 6773 2028 6164  o_csv_kwargs (ad
+000317c0: 6469 7469 6f6e 616c 206b 6579 776f 7264  ditional keyword
+000317d0: 2061 7267 756d 656e 7473 293a 0a20 2020   arguments):.   
+000317e0: 2020 2020 2020 2020 2020 2020 2050 6172               Par
+000317f0: 616d 6574 6572 7320 746f 2070 6173 7320  ameters to pass 
+00031800: 746f 2070 616e 6461 7327 7320 6070 616e  to pandas's `pan
+00031810: 6461 732e 4461 7461 4672 616d 652e 746f  das.DataFrame.to
+00031820: 5f63 7376 602e 0a0a 2020 2020 2020 2020  _csv`...        
+00031830: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
+00031840: 2020 2020 2060 696e 7460 3a20 5468 6520       `int`: The 
+00031850: 6e75 6d62 6572 206f 6620 6368 6172 6163  number of charac
+00031860: 7465 7273 206f 7220 6279 7465 7320 7772  ters or bytes wr
+00031870: 6974 7465 6e2e 0a0a 2020 2020 2020 2020  itten...        
+00031880: 4578 616d 706c 653a 0a0a 2020 2020 2020  Example:..      
+00031890: 2020 6060 6070 790a 2020 2020 2020 2020    ```py.        
+000318a0: 3e3e 3e20 6473 2e74 6f5f 6373 7628 2270  >>> ds.to_csv("p
+000318b0: 6174 682f 746f 2f64 6174 6173 6574 2f64  ath/to/dataset/d
+000318c0: 6972 6563 746f 7279 2229 0a20 2020 2020  irectory").     
+000318d0: 2020 2060 6060 0a20 2020 2020 2020 2022     ```.        "
+000318e0: 2222 0a20 2020 2020 2020 2023 2044 796e  "".        # Dyn
+000318f0: 616d 6963 2069 6d70 6f72 7420 746f 2061  amic import to a
+00031900: 766f 6964 2063 6972 6375 6c61 7220 6465  void circular de
+00031910: 7065 6e64 656e 6379 0a20 2020 2020 2020  pendency.       
+00031920: 2066 726f 6d20 2e69 6f2e 6373 7620 696d   from .io.csv im
+00031930: 706f 7274 2043 7376 4461 7461 7365 7457  port CsvDatasetW
+00031940: 7269 7465 720a 0a20 2020 2020 2020 2072  riter..        r
+00031950: 6574 7572 6e20 4373 7644 6174 6173 6574  eturn CsvDataset
+00031960: 5772 6974 6572 2873 656c 662c 2070 6174  Writer(self, pat
+00031970: 685f 6f72 5f62 7566 2c20 6261 7463 685f  h_or_buf, batch_
+00031980: 7369 7a65 3d62 6174 6368 5f73 697a 652c  size=batch_size,
+00031990: 206e 756d 5f70 726f 633d 6e75 6d5f 7072   num_proc=num_pr
+000319a0: 6f63 2c20 2a2a 746f 5f63 7376 5f6b 7761  oc, **to_csv_kwa
+000319b0: 7267 7329 2e77 7269 7465 2829 0a0a 2020  rgs).write()..  
+000319c0: 2020 6465 6620 746f 5f64 6963 7428 7365    def to_dict(se
+000319d0: 6c66 2c20 6261 7463 685f 7369 7a65 3a20  lf, batch_size: 
+000319e0: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
+000319f0: 4e6f 6e65 2c20 6261 7463 6865 643a 2062  None, batched: b
+00031a00: 6f6f 6c20 3d20 4661 6c73 6529 202d 3e20  ool = False) -> 
+00031a10: 556e 696f 6e5b 6469 6374 2c20 4974 6572  Union[dict, Iter
+00031a20: 6174 6f72 5b64 6963 745d 5d3a 0a20 2020  ator[dict]]:.   
+00031a30: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+00031a40: 7468 6520 6461 7461 7365 7420 6173 2061  the dataset as a
+00031a50: 2050 7974 686f 6e20 6469 6374 2e20 4361   Python dict. Ca
+00031a60: 6e20 616c 736f 2072 6574 7572 6e20 6120  n also return a 
+00031a70: 6765 6e65 7261 746f 7220 666f 7220 6c61  generator for la
+00031a80: 7267 6520 6461 7461 7365 7473 2e0a 0a20  rge datasets... 
+00031a90: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00031aa0: 2020 2020 2020 2020 2062 6174 6368 6564           batched
+00031ab0: 2028 6062 6f6f 6c60 293a 0a20 2020 2020   (`bool`):.     
+00031ac0: 2020 2020 2020 2020 2020 2053 6574 2074             Set t
+00031ad0: 6f20 6054 7275 6560 2074 6f20 7265 7475  o `True` to retu
+00031ae0: 726e 2061 2067 656e 6572 6174 6f72 2074  rn a generator t
+00031af0: 6861 7420 7969 656c 6473 2074 6865 2064  hat yields the d
+00031b00: 6174 6173 6574 2061 7320 6261 7463 6865  ataset as batche
+00031b10: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00031b20: 2020 6f66 2060 6261 7463 685f 7369 7a65    of `batch_size
+00031b30: 6020 726f 7773 2e20 4465 6661 756c 7473  ` rows. Defaults
+00031b40: 2074 6f20 6046 616c 7365 6020 2872 6574   to `False` (ret
+00031b50: 7572 6e73 2074 6865 2077 686f 6c65 2064  urns the whole d
+00031b60: 6174 6173 6574 7320 6f6e 6365 292e 0a20  atasets once).. 
+00031b70: 2020 2020 2020 2020 2020 2062 6174 6368             batch
+00031b80: 5f73 697a 6520 2860 696e 7460 2c20 2a6f  _size (`int`, *o
+00031b90: 7074 696f 6e61 6c2a 293a 2054 6865 2073  ptional*): The s
+00031ba0: 697a 6520 286e 756d 6265 7220 6f66 2072  ize (number of r
+00031bb0: 6f77 7329 206f 6620 7468 6520 6261 7463  ows) of the batc
+00031bc0: 6865 7320 6966 2060 6261 7463 6865 6460  hes if `batched`
+00031bd0: 2069 7320 6054 7275 6560 2e0a 2020 2020   is `True`..    
+00031be0: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
+00031bf0: 756c 7473 2074 6f20 6064 6174 6173 6574  ults to `dataset
+00031c00: 732e 636f 6e66 6967 2e44 4546 4155 4c54  s.config.DEFAULT
+00031c10: 5f4d 4158 5f42 4154 4348 5f53 495a 4560  _MAX_BATCH_SIZE`
+00031c20: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00031c30: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00031c40: 6064 6963 7460 206f 7220 6049 7465 7261  `dict` or `Itera
+00031c50: 746f 725b 6469 6374 5d60 0a0a 2020 2020  tor[dict]`..    
+00031c60: 2020 2020 4578 616d 706c 653a 0a0a 2020      Example:..  
+00031c70: 2020 2020 2020 6060 6070 790a 2020 2020        ```py.    
+00031c80: 2020 2020 3e3e 3e20 6473 2e74 6f5f 6469      >>> ds.to_di
+00031c90: 6374 2829 0a20 2020 2020 2020 2060 6060  ct().        ```
+00031ca0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00031cb0: 2020 2020 2069 6620 6e6f 7420 6261 7463       if not batc
+00031cc0: 6865 643a 0a20 2020 2020 2020 2020 2020  hed:.           
+00031cd0: 2072 6574 7572 6e20 7175 6572 795f 7461   return query_ta
+00031ce0: 626c 6528 0a20 2020 2020 2020 2020 2020  ble(.           
+00031cf0: 2020 2020 2074 6162 6c65 3d73 656c 662e       table=self.
+00031d00: 5f64 6174 612c 0a20 2020 2020 2020 2020  _data,.         
+00031d10: 2020 2020 2020 206b 6579 3d73 6c69 6365         key=slice
+00031d20: 2830 2c20 6c65 6e28 7365 6c66 2929 2c0a  (0, len(self)),.
+00031d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031d40: 696e 6469 6365 733d 7365 6c66 2e5f 696e  indices=self._in
+00031d50: 6469 6365 7320 6966 2073 656c 662e 5f69  dices if self._i
+00031d60: 6e64 6963 6573 2069 7320 6e6f 7420 4e6f  ndices is not No
+00031d70: 6e65 2065 6c73 6520 4e6f 6e65 2c0a 2020  ne else None,.  
+00031d80: 2020 2020 2020 2020 2020 292e 746f 5f70            ).to_p
+00031d90: 7964 6963 7428 290a 2020 2020 2020 2020  ydict().        
+00031da0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00031db0: 2020 6261 7463 685f 7369 7a65 203d 2062    batch_size = b
+00031dc0: 6174 6368 5f73 697a 6520 6966 2062 6174  atch_size if bat
+00031dd0: 6368 5f73 697a 6520 656c 7365 2063 6f6e  ch_size else con
+00031de0: 6669 672e 4445 4641 554c 545f 4d41 585f  fig.DEFAULT_MAX_
+00031df0: 4241 5443 485f 5349 5a45 0a20 2020 2020  BATCH_SIZE.     
+00031e00: 2020 2020 2020 2072 6574 7572 6e20 280a         return (.
+00031e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031e20: 7175 6572 795f 7461 626c 6528 0a20 2020  query_table(.   
+00031e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031e40: 2074 6162 6c65 3d73 656c 662e 5f64 6174   table=self._dat
+00031e50: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
+00031e60: 2020 2020 2020 206b 6579 3d73 6c69 6365         key=slice
+00031e70: 286f 6666 7365 742c 206f 6666 7365 7420  (offset, offset 
+00031e80: 2b20 6261 7463 685f 7369 7a65 292c 0a20  + batch_size),. 
+00031e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031ea0: 2020 2069 6e64 6963 6573 3d73 656c 662e     indices=self.
+00031eb0: 5f69 6e64 6963 6573 2069 6620 7365 6c66  _indices if self
+00031ec0: 2e5f 696e 6469 6365 7320 6973 206e 6f74  ._indices is not
+00031ed0: 204e 6f6e 6520 656c 7365 204e 6f6e 652c   None else None,
+00031ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031ef0: 2029 2e74 6f5f 7079 6469 6374 2829 0a20   ).to_pydict(). 
+00031f00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00031f10: 6f72 206f 6666 7365 7420 696e 2072 616e  or offset in ran
+00031f20: 6765 2830 2c20 6c65 6e28 7365 6c66 292c  ge(0, len(self),
+00031f30: 2062 6174 6368 5f73 697a 6529 0a20 2020   batch_size).   
+00031f40: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00031f50: 6465 6620 746f 5f6a 736f 6e28 0a20 2020  def to_json(.   
+00031f60: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00031f70: 2020 2070 6174 685f 6f72 5f62 7566 3a20     path_or_buf: 
+00031f80: 556e 696f 6e5b 5061 7468 4c69 6b65 2c20  Union[PathLike, 
+00031f90: 4269 6e61 7279 494f 5d2c 0a20 2020 2020  BinaryIO],.     
+00031fa0: 2020 2062 6174 6368 5f73 697a 653a 204f     batch_size: O
+00031fb0: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
+00031fc0: 6f6e 652c 0a20 2020 2020 2020 206e 756d  one,.        num
+00031fd0: 5f70 726f 633a 204f 7074 696f 6e61 6c5b  _proc: Optional[
+00031fe0: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
+00031ff0: 2020 2020 202a 2a74 6f5f 6a73 6f6e 5f6b       **to_json_k
+00032000: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
+00032010: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
+00032020: 4578 706f 7274 2074 6865 2064 6174 6173  Export the datas
+00032030: 6574 2074 6f20 4a53 4f4e 204c 696e 6573  et to JSON Lines
+00032040: 206f 7220 4a53 4f4e 2e0a 0a20 2020 2020   or JSON...     
+00032050: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00032060: 2020 2020 2070 6174 685f 6f72 5f62 7566       path_or_buf
+00032070: 2028 6050 6174 684c 696b 6560 206f 7220   (`PathLike` or 
+00032080: 6046 696c 654f 7242 7566 6665 7260 293a  `FileOrBuffer`):
+00032090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000320a0: 2045 6974 6865 7220 6120 7061 7468 2074   Either a path t
+000320b0: 6f20 6120 6669 6c65 206f 7220 6120 4269  o a file or a Bi
+000320c0: 6e61 7279 494f 2e0a 2020 2020 2020 2020  naryIO..        
+000320d0: 2020 2020 6261 7463 685f 7369 7a65 2028      batch_size (
+000320e0: 6069 6e74 602c 202a 6f70 7469 6f6e 616c  `int`, *optional
+000320f0: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
+00032100: 2020 2020 5369 7a65 206f 6620 7468 6520      Size of the 
+00032110: 6261 7463 6820 746f 206c 6f61 6420 696e  batch to load in
+00032120: 206d 656d 6f72 7920 616e 6420 7772 6974   memory and writ
+00032130: 6520 6174 206f 6e63 652e 0a20 2020 2020  e at once..     
+00032140: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+00032150: 6c74 7320 746f 2060 6461 7461 7365 7473  lts to `datasets
+00032160: 2e63 6f6e 6669 672e 4445 4641 554c 545f  .config.DEFAULT_
+00032170: 4d41 585f 4241 5443 485f 5349 5a45 602e  MAX_BATCH_SIZE`.
+00032180: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+00032190: 5f70 726f 6320 2860 696e 7460 2c20 2a6f  _proc (`int`, *o
+000321a0: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
+000321b0: 2020 2020 2020 2020 2020 204e 756d 6265             Numbe
+000321c0: 7220 6f66 2070 726f 6365 7373 6573 2066  r of processes f
+000321d0: 6f72 206d 756c 7469 7072 6f63 6573 7369  or multiprocessi
+000321e0: 6e67 2e20 4279 2064 6566 6175 6c74 2069  ng. By default i
+000321f0: 7420 646f 6573 6e27 740a 2020 2020 2020  t doesn't.      
+00032200: 2020 2020 2020 2020 2020 7573 6520 6d75            use mu
+00032210: 6c74 6970 726f 6365 7373 696e 672e 2060  ltiprocessing. `
+00032220: 6261 7463 685f 7369 7a65 6020 696e 2074  batch_size` in t
+00032230: 6869 7320 6361 7365 2064 6566 6175 6c74  his case default
+00032240: 7320 746f 0a20 2020 2020 2020 2020 2020  s to.           
+00032250: 2020 2020 2060 6461 7461 7365 7473 2e63       `datasets.c
+00032260: 6f6e 6669 672e 4445 4641 554c 545f 4d41  onfig.DEFAULT_MA
+00032270: 585f 4241 5443 485f 5349 5a45 6020 6275  X_BATCH_SIZE` bu
+00032280: 7420 6665 656c 2066 7265 6520 746f 206d  t feel free to m
+00032290: 616b 6520 6974 2035 7820 6f72 2031 3078  ake it 5x or 10x
+000322a0: 206f 6620 7468 6520 6465 6661 756c 740a   of the default.
+000322b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000322c0: 7661 6c75 6520 6966 2079 6f75 2068 6176  value if you hav
+000322d0: 6520 7375 6666 6963 6965 6e74 2063 6f6d  e sufficient com
+000322e0: 7075 7465 2070 6f77 6572 2e0a 2020 2020  pute power..    
+000322f0: 2020 2020 2020 2020 6c69 6e65 7320 2860          lines (`
+00032300: 626f 6f6c 602c 2064 6566 6175 6c74 7320  bool`, defaults 
+00032310: 746f 2060 5472 7565 6029 3a0a 2020 2020  to `True`):.    
+00032320: 2020 2020 2020 2020 2020 2020 5768 6574              Whet
+00032330: 6865 7220 6f75 7470 7574 204a 534f 4e20  her output JSON 
+00032340: 6c69 6e65 7320 666f 726d 6174 2e0a 2020  lines format..  
+00032350: 2020 2020 2020 2020 2020 2020 2020 4f6e                On
+00032360: 6c79 2070 6f73 7369 626c 6520 6966 2060  ly possible if `
+00032370: 6f72 6965 6e74 3d22 7265 636f 7264 7322  orient="records"
+00032380: 602e 2049 7420 7769 6c6c 2074 6872 6f77  `. It will throw
+00032390: 2056 616c 7565 4572 726f 7220 7769 7468   ValueError with
+000323a0: 2060 6f72 6965 6e74 6020 6469 6666 6572   `orient` differ
+000323b0: 656e 7420 6672 6f6d 0a20 2020 2020 2020  ent from.       
+000323c0: 2020 2020 2020 2020 2060 2272 6563 6f72           `"recor
+000323d0: 6473 2260 2c20 7369 6e63 6520 7468 6520  ds"`, since the 
+000323e0: 6f74 6865 7273 2061 7265 206e 6f74 206c  others are not l
+000323f0: 6973 742d 6c69 6b65 2e0a 2020 2020 2020  ist-like..      
+00032400: 2020 2020 2020 6f72 6965 6e74 2028 6073        orient (`s
+00032410: 7472 602c 2064 6566 6175 6c74 7320 746f  tr`, defaults to
+00032420: 2060 2272 6563 6f72 6473 2260 293a 0a20   `"records"`):. 
+00032430: 2020 2020 2020 2020 2020 2020 2020 2046                 F
+00032440: 6f72 6d61 7420 6f66 2074 6865 204a 534f  ormat of the JSO
+00032450: 4e3a 0a0a 2020 2020 2020 2020 2020 2020  N:..            
+00032460: 2020 2020 2d20 6022 7265 636f 7264 7322      - `"records"
+00032470: 603a 206c 6973 7420 6c69 6b65 2060 5b7b  `: list like `[{
+00032480: 636f 6c75 6d6e 202d 3e20 7661 6c75 657d  column -> value}
+00032490: 2c20 e280 a620 2c20 7b63 6f6c 756d 6e20  , ... , {column 
+000324a0: 2d3e 2076 616c 7565 7d5d 600a 2020 2020  -> value}]`.    
+000324b0: 2020 2020 2020 2020 2020 2020 2d20 6022              - `"
+000324c0: 7370 6c69 7422 603a 2064 6963 7420 6c69  split"`: dict li
+000324d0: 6b65 2060 7b22 696e 6465 7822 202d 3e20  ke `{"index" -> 
+000324e0: 5b69 6e64 6578 5d2c 2022 636f 6c75 6d6e  [index], "column
+000324f0: 7322 202d 3e20 5b63 6f6c 756d 6e73 5d2c  s" -> [columns],
+00032500: 2022 6461 7461 2220 2d3e 205b 7661 6c75   "data" -> [valu
+00032510: 6573 5d7d 600a 2020 2020 2020 2020 2020  es]}`.          
+00032520: 2020 2020 2020 2d20 6022 696e 6465 7822        - `"index"
+00032530: 603a 2064 6963 7420 6c69 6b65 2060 7b69  `: dict like `{i
+00032540: 6e64 6578 202d 3e20 7b63 6f6c 756d 6e20  ndex -> {column 
+00032550: 2d3e 2076 616c 7565 7d7d 600a 2020 2020  -> value}}`.    
+00032560: 2020 2020 2020 2020 2020 2020 2d20 6022              - `"
+00032570: 636f 6c75 6d6e 7322 603a 2064 6963 7420  columns"`: dict 
+00032580: 6c69 6b65 2060 7b63 6f6c 756d 6e20 2d3e  like `{column ->
+00032590: 207b 696e 6465 7820 2d3e 2076 616c 7565   {index -> value
+000325a0: 7d7d 600a 2020 2020 2020 2020 2020 2020  }}`.            
+000325b0: 2020 2020 2d20 6022 7661 6c75 6573 2260      - `"values"`
+000325c0: 3a20 6a75 7374 2074 6865 2076 616c 7565  : just the value
+000325d0: 7320 6172 7261 790a 2020 2020 2020 2020  s array.        
+000325e0: 2020 2020 2020 2020 2d20 6022 7461 626c          - `"tabl
+000325f0: 6522 603a 2064 6963 7420 6c69 6b65 2060  e"`: dict like `
+00032600: 7b22 7363 6865 6d61 223a 207b 7363 6865  {"schema": {sche
+00032610: 6d61 7d2c 2022 6461 7461 223a 207b 6461  ma}, "data": {da
+00032620: 7461 7d7d 600a 2020 2020 2020 2020 2020  ta}}`.          
+00032630: 2020 2a2a 746f 5f6a 736f 6e5f 6b77 6172    **to_json_kwar
+00032640: 6773 2028 6164 6469 7469 6f6e 616c 206b  gs (additional k
+00032650: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+00032660: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00032670: 2020 2050 6172 616d 6574 6572 7320 746f     Parameters to
+00032680: 2070 6173 7320 746f 2070 616e 6461 7327   pass to pandas'
+00032690: 7320 5b60 7061 6e64 6173 2e44 6174 6146  s [`pandas.DataF
+000326a0: 7261 6d65 2e74 6f5f 6a73 6f6e 605d 2868  rame.to_json`](h
+000326b0: 7474 7073 3a2f 2f70 616e 6461 732e 7079  ttps://pandas.py
+000326c0: 6461 7461 2e6f 7267 2f64 6f63 732f 7265  data.org/docs/re
+000326d0: 6665 7265 6e63 652f 6170 692f 7061 6e64  ference/api/pand
+000326e0: 6173 2e44 6174 6146 7261 6d65 2e74 6f5f  as.DataFrame.to_
+000326f0: 6a73 6f6e 2e68 746d 6c29 2e0a 0a20 2020  json.html)...   
+00032700: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
+00032710: 2020 2020 2020 2020 2020 6069 6e74 603a            `int`:
+00032720: 2054 6865 206e 756d 6265 7220 6f66 2063   The number of c
+00032730: 6861 7261 6374 6572 7320 6f72 2062 7974  haracters or byt
+00032740: 6573 2077 7269 7474 656e 2e0a 0a20 2020  es written...   
+00032750: 2020 2020 2045 7861 6d70 6c65 3a0a 0a20       Example:.. 
+00032760: 2020 2020 2020 2060 6060 7079 0a20 2020         ```py.   
+00032770: 2020 2020 203e 3e3e 2064 732e 746f 5f6a       >>> ds.to_j
+00032780: 736f 6e28 2270 6174 682f 746f 2f64 6174  son("path/to/dat
+00032790: 6173 6574 2f64 6972 6563 746f 7279 2229  aset/directory")
+000327a0: 0a20 2020 2020 2020 2060 6060 0a20 2020  .        ```.   
+000327b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000327c0: 2023 2044 796e 616d 6963 2069 6d70 6f72   # Dynamic impor
+000327d0: 7420 746f 2061 766f 6964 2063 6972 6375  t to avoid circu
+000327e0: 6c61 7220 6465 7065 6e64 656e 6379 0a20  lar dependency. 
+000327f0: 2020 2020 2020 2066 726f 6d20 2e69 6f2e         from .io.
+00032800: 6a73 6f6e 2069 6d70 6f72 7420 4a73 6f6e  json import Json
+00032810: 4461 7461 7365 7457 7269 7465 720a 0a20  DatasetWriter.. 
+00032820: 2020 2020 2020 2072 6574 7572 6e20 4a73         return Js
+00032830: 6f6e 4461 7461 7365 7457 7269 7465 7228  onDatasetWriter(
+00032840: 7365 6c66 2c20 7061 7468 5f6f 725f 6275  self, path_or_bu
+00032850: 662c 2062 6174 6368 5f73 697a 653d 6261  f, batch_size=ba
+00032860: 7463 685f 7369 7a65 2c20 6e75 6d5f 7072  tch_size, num_pr
+00032870: 6f63 3d6e 756d 5f70 726f 632c 202a 2a74  oc=num_proc, **t
+00032880: 6f5f 6a73 6f6e 5f6b 7761 7267 7329 2e77  o_json_kwargs).w
+00032890: 7269 7465 2829 0a0a 2020 2020 6465 6620  rite()..    def 
+000328a0: 746f 5f70 616e 6461 7328 0a20 2020 2020  to_pandas(.     
+000328b0: 2020 2073 656c 662c 2062 6174 6368 5f73     self, batch_s
+000328c0: 697a 653a 204f 7074 696f 6e61 6c5b 696e  ize: Optional[in
+000328d0: 745d 203d 204e 6f6e 652c 2062 6174 6368  t] = None, batch
+000328e0: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
+000328f0: 0a20 2020 2029 202d 3e20 556e 696f 6e5b  .    ) -> Union[
+00032900: 7064 2e44 6174 6146 7261 6d65 2c20 4974  pd.DataFrame, It
+00032910: 6572 6174 6f72 5b70 642e 4461 7461 4672  erator[pd.DataFr
+00032920: 616d 655d 5d3a 0a20 2020 2020 2020 2022  ame]]:.        "
+00032930: 2222 5265 7475 726e 7320 7468 6520 6461  ""Returns the da
+00032940: 7461 7365 7420 6173 2061 2060 7061 6e64  taset as a `pand
+00032950: 6173 2e44 6174 6146 7261 6d65 602e 2043  as.DataFrame`. C
+00032960: 616e 2061 6c73 6f20 7265 7475 726e 2061  an also return a
+00032970: 2067 656e 6572 6174 6f72 2066 6f72 206c   generator for l
+00032980: 6172 6765 2064 6174 6173 6574 732e 0a0a  arge datasets...
+00032990: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+000329a0: 2020 2020 2020 2020 2020 6261 7463 6865            batche
+000329b0: 6420 2860 626f 6f6c 6029 3a0a 2020 2020  d (`bool`):.    
+000329c0: 2020 2020 2020 2020 2020 2020 5365 7420              Set 
+000329d0: 746f 2060 5472 7565 6020 746f 2072 6574  to `True` to ret
+000329e0: 7572 6e20 6120 6765 6e65 7261 746f 7220  urn a generator 
+000329f0: 7468 6174 2079 6965 6c64 7320 7468 6520  that yields the 
+00032a00: 6461 7461 7365 7420 6173 2062 6174 6368  dataset as batch
+00032a10: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00032a20: 2020 206f 6620 6062 6174 6368 5f73 697a     of `batch_siz
+00032a30: 6560 2072 6f77 732e 2044 6566 6175 6c74  e` rows. Default
+00032a40: 7320 746f 2060 4661 6c73 6560 2028 7265  s to `False` (re
+00032a50: 7475 726e 7320 7468 6520 7768 6f6c 6520  turns the whole 
+00032a60: 6461 7461 7365 7473 206f 6e63 6529 2e0a  datasets once)..
+00032a70: 2020 2020 2020 2020 2020 2020 6261 7463              batc
+00032a80: 685f 7369 7a65 2028 6069 6e74 602c 202a  h_size (`int`, *
+00032a90: 6f70 7469 6f6e 616c 2a29 3a0a 2020 2020  optional*):.    
+00032aa0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+00032ab0: 7369 7a65 2028 6e75 6d62 6572 206f 6620  size (number of 
+00032ac0: 726f 7773 2920 6f66 2074 6865 2062 6174  rows) of the bat
+00032ad0: 6368 6573 2069 6620 6062 6174 6368 6564  ches if `batched
+00032ae0: 6020 6973 2060 5472 7565 602e 0a20 2020  ` is `True`..   
+00032af0: 2020 2020 2020 2020 2020 2020 2044 6566               Def
+00032b00: 6175 6c74 7320 746f 2060 6461 7461 7365  aults to `datase
+00032b10: 7473 2e63 6f6e 6669 672e 4445 4641 554c  ts.config.DEFAUL
+00032b20: 545f 4d41 585f 4241 5443 485f 5349 5a45  T_MAX_BATCH_SIZE
+00032b30: 602e 0a0a 2020 2020 2020 2020 5265 7475  `...        Retu
+00032b40: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
+00032b50: 2060 7061 6e64 6173 2e44 6174 6146 7261   `pandas.DataFra
+00032b60: 6d65 6020 6f72 2060 4974 6572 6174 6f72  me` or `Iterator
+00032b70: 5b70 616e 6461 732e 4461 7461 4672 616d  [pandas.DataFram
+00032b80: 655d 600a 0a20 2020 2020 2020 2045 7861  e]`..        Exa
+00032b90: 6d70 6c65 3a0a 0a20 2020 2020 2020 2060  mple:..        `
+00032ba0: 6060 7079 0a20 2020 2020 2020 203e 3e3e  ``py.        >>>
+00032bb0: 2064 732e 746f 5f70 616e 6461 7328 290a   ds.to_pandas().
+00032bc0: 2020 2020 2020 2020 6060 600a 2020 2020          ```.    
+00032bd0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00032be0: 6966 206e 6f74 2062 6174 6368 6564 3a0a  if not batched:.
+00032bf0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00032c00: 726e 2071 7565 7279 5f74 6162 6c65 280a  rn query_table(.
+00032c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032c20: 7461 626c 653d 7365 6c66 2e5f 6461 7461  table=self._data
+00032c30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00032c40: 2020 6b65 793d 736c 6963 6528 302c 206c    key=slice(0, l
+00032c50: 656e 2873 656c 6629 292c 0a20 2020 2020  en(self)),.     
+00032c60: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
+00032c70: 6573 3d73 656c 662e 5f69 6e64 6963 6573  es=self._indices
+00032c80: 2069 6620 7365 6c66 2e5f 696e 6469 6365   if self._indice
+00032c90: 7320 6973 206e 6f74 204e 6f6e 6520 656c  s is not None el
+00032ca0: 7365 204e 6f6e 652c 0a20 2020 2020 2020  se None,.       
+00032cb0: 2020 2020 2029 2e74 6f5f 7061 6e64 6173       ).to_pandas
+00032cc0: 2874 7970 6573 5f6d 6170 7065 723d 7061  (types_mapper=pa
+00032cd0: 6e64 6173 5f74 7970 6573 5f6d 6170 7065  ndas_types_mappe
+00032ce0: 7229 0a20 2020 2020 2020 2065 6c73 653a  r).        else:
+00032cf0: 0a20 2020 2020 2020 2020 2020 2062 6174  .            bat
+00032d00: 6368 5f73 697a 6520 3d20 6261 7463 685f  ch_size = batch_
+00032d10: 7369 7a65 2069 6620 6261 7463 685f 7369  size if batch_si
+00032d20: 7a65 2065 6c73 6520 636f 6e66 6967 2e44  ze else config.D
+00032d30: 4546 4155 4c54 5f4d 4158 5f42 4154 4348  EFAULT_MAX_BATCH
+00032d40: 5f53 495a 450a 2020 2020 2020 2020 2020  _SIZE.          
+00032d50: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
+00032d60: 2020 2020 2020 2020 2020 2071 7565 7279             query
+00032d70: 5f74 6162 6c65 280a 2020 2020 2020 2020  _table(.        
+00032d80: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
+00032d90: 653d 7365 6c66 2e5f 6461 7461 2c0a 2020  e=self._data,.  
+00032da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032db0: 2020 6b65 793d 736c 6963 6528 6f66 6673    key=slice(offs
+00032dc0: 6574 2c20 6f66 6673 6574 202b 2062 6174  et, offset + bat
+00032dd0: 6368 5f73 697a 6529 2c0a 2020 2020 2020  ch_size),.      
+00032de0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00032df0: 6469 6365 733d 7365 6c66 2e5f 696e 6469  dices=self._indi
+00032e00: 6365 7320 6966 2073 656c 662e 5f69 6e64  ces if self._ind
+00032e10: 6963 6573 2069 7320 6e6f 7420 4e6f 6e65  ices is not None
+00032e20: 2065 6c73 6520 4e6f 6e65 2c0a 2020 2020   else None,.    
+00032e30: 2020 2020 2020 2020 2020 2020 292e 746f              ).to
+00032e40: 5f70 616e 6461 7328 7479 7065 735f 6d61  _pandas(types_ma
+00032e50: 7070 6572 3d70 616e 6461 735f 7479 7065  pper=pandas_type
+00032e60: 735f 6d61 7070 6572 290a 2020 2020 2020  s_mapper).      
+00032e70: 2020 2020 2020 2020 2020 666f 7220 6f66            for of
+00032e80: 6673 6574 2069 6e20 7261 6e67 6528 302c  fset in range(0,
+00032e90: 206c 656e 2873 656c 6629 2c20 6261 7463   len(self), batc
+00032ea0: 685f 7369 7a65 290a 2020 2020 2020 2020  h_size).        
+00032eb0: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
+00032ec0: 6f5f 7061 7271 7565 7428 0a20 2020 2020  o_parquet(.     
+00032ed0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00032ee0: 2070 6174 685f 6f72 5f62 7566 3a20 556e   path_or_buf: Un
+00032ef0: 696f 6e5b 5061 7468 4c69 6b65 2c20 4269  ion[PathLike, Bi
+00032f00: 6e61 7279 494f 5d2c 0a20 2020 2020 2020  naryIO],.       
+00032f10: 2062 6174 6368 5f73 697a 653a 204f 7074   batch_size: Opt
+00032f20: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
+00032f30: 652c 0a20 2020 2020 2020 202a 2a70 6172  e,.        **par
+00032f40: 7175 6574 5f77 7269 7465 725f 6b77 6172  quet_writer_kwar
+00032f50: 6773 2c0a 2020 2020 2920 2d3e 2069 6e74  gs,.    ) -> int
+00032f60: 3a0a 2020 2020 2020 2020 2222 2245 7870  :.        """Exp
+00032f70: 6f72 7473 2074 6865 2064 6174 6173 6574  orts the dataset
+00032f80: 2074 6f20 7061 7271 7565 740a 0a20 2020   to parquet..   
+00032f90: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+00032fa0: 2020 2020 2020 2070 6174 685f 6f72 5f62         path_or_b
+00032fb0: 7566 2028 6050 6174 684c 696b 6560 206f  uf (`PathLike` o
+00032fc0: 7220 6046 696c 654f 7242 7566 6665 7260  r `FileOrBuffer`
+00032fd0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00032fe0: 2020 2045 6974 6865 7220 6120 7061 7468     Either a path
+00032ff0: 2074 6f20 6120 6669 6c65 206f 7220 6120   to a file or a 
+00033000: 4269 6e61 7279 494f 2e0a 2020 2020 2020  BinaryIO..      
+00033010: 2020 2020 2020 6261 7463 685f 7369 7a65        batch_size
+00033020: 2028 6069 6e74 602c 202a 6f70 7469 6f6e   (`int`, *option
+00033030: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
+00033040: 2020 2020 2020 5369 7a65 206f 6620 7468        Size of th
+00033050: 6520 6261 7463 6820 746f 206c 6f61 6420  e batch to load 
+00033060: 696e 206d 656d 6f72 7920 616e 6420 7772  in memory and wr
+00033070: 6974 6520 6174 206f 6e63 652e 0a20 2020  ite at once..   
+00033080: 2020 2020 2020 2020 2020 2020 2044 6566               Def
+00033090: 6175 6c74 7320 746f 2060 6461 7461 7365  aults to `datase
+000330a0: 7473 2e63 6f6e 6669 672e 4445 4641 554c  ts.config.DEFAUL
+000330b0: 545f 4d41 585f 4241 5443 485f 5349 5a45  T_MAX_BATCH_SIZE
+000330c0: 602e 0a20 2020 2020 2020 2020 2020 202a  `..            *
+000330d0: 2a70 6172 7175 6574 5f77 7269 7465 725f  *parquet_writer_
+000330e0: 6b77 6172 6773 2028 6164 6469 7469 6f6e  kwargs (addition
+000330f0: 616c 206b 6579 776f 7264 2061 7267 756d  al keyword argum
+00033100: 656e 7473 293a 0a20 2020 2020 2020 2020  ents):.         
+00033110: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00033120: 7320 746f 2070 6173 7320 746f 2050 7941  s to pass to PyA
+00033130: 7272 6f77 2773 2060 7079 6172 726f 772e  rrow's `pyarrow.
+00033140: 7061 7271 7565 742e 5061 7271 7565 7457  parquet.ParquetW
+00033150: 7269 7465 7260 2e0a 0a20 2020 2020 2020  riter`...       
+00033160: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
+00033170: 2020 2020 2020 6069 6e74 603a 2054 6865        `int`: The
+00033180: 206e 756d 6265 7220 6f66 2063 6861 7261   number of chara
+00033190: 6374 6572 7320 6f72 2062 7974 6573 2077  cters or bytes w
+000331a0: 7269 7474 656e 2e0a 0a20 2020 2020 2020  ritten...       
+000331b0: 2045 7861 6d70 6c65 3a0a 0a20 2020 2020   Example:..     
+000331c0: 2020 2060 6060 7079 0a20 2020 2020 2020     ```py.       
+000331d0: 203e 3e3e 2064 732e 746f 5f70 6172 7175   >>> ds.to_parqu
+000331e0: 6574 2822 7061 7468 2f74 6f2f 6461 7461  et("path/to/data
+000331f0: 7365 742f 6469 7265 6374 6f72 7922 290a  set/directory").
+00033200: 2020 2020 2020 2020 6060 600a 2020 2020          ```.    
+00033210: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00033220: 2320 4479 6e61 6d69 6320 696d 706f 7274  # Dynamic import
+00033230: 2074 6f20 6176 6f69 6420 6369 7263 756c   to avoid circul
+00033240: 6172 2064 6570 656e 6465 6e63 790a 2020  ar dependency.  
+00033250: 2020 2020 2020 6672 6f6d 202e 696f 2e70        from .io.p
+00033260: 6172 7175 6574 2069 6d70 6f72 7420 5061  arquet import Pa
+00033270: 7271 7565 7444 6174 6173 6574 5772 6974  rquetDatasetWrit
+00033280: 6572 0a0a 2020 2020 2020 2020 7265 7475  er..        retu
+00033290: 726e 2050 6172 7175 6574 4461 7461 7365  rn ParquetDatase
+000332a0: 7457 7269 7465 7228 7365 6c66 2c20 7061  tWriter(self, pa
+000332b0: 7468 5f6f 725f 6275 662c 2062 6174 6368  th_or_buf, batch
+000332c0: 5f73 697a 653d 6261 7463 685f 7369 7a65  _size=batch_size
+000332d0: 2c20 2a2a 7061 7271 7565 745f 7772 6974  , **parquet_writ
+000332e0: 6572 5f6b 7761 7267 7329 2e77 7269 7465  er_kwargs).write
+000332f0: 2829 0a0a 2020 2020 6465 6620 746f 5f73  ()..    def to_s
+00033300: 716c 280a 2020 2020 2020 2020 7365 6c66  ql(.        self
+00033310: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
+00033320: 7374 722c 0a20 2020 2020 2020 2063 6f6e  str,.        con
+00033330: 3a20 556e 696f 6e5b 7374 722c 2022 7371  : Union[str, "sq
+00033340: 6c61 6c63 6865 6d79 2e65 6e67 696e 652e  lalchemy.engine.
+00033350: 436f 6e6e 6563 7469 6f6e 222c 2022 7371  Connection", "sq
+00033360: 6c61 6c63 6865 6d79 2e65 6e67 696e 652e  lalchemy.engine.
+00033370: 456e 6769 6e65 222c 2022 7371 6c69 7465  Engine", "sqlite
+00033380: 332e 436f 6e6e 6563 7469 6f6e 225d 2c0a  3.Connection"],.
+00033390: 2020 2020 2020 2020 6261 7463 685f 7369          batch_si
+000333a0: 7a65 3a20 4f70 7469 6f6e 616c 5b69 6e74  ze: Optional[int
+000333b0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+000333c0: 2020 2a2a 7371 6c5f 7772 6974 6572 5f6b    **sql_writer_k
+000333d0: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
+000333e0: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
+000333f0: 4578 706f 7274 7320 7468 6520 6461 7461  Exports the data
+00033400: 7365 7420 746f 2061 2053 514c 2064 6174  set to a SQL dat
+00033410: 6162 6173 652e 0a0a 2020 2020 2020 2020  abase...        
+00033420: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00033430: 2020 6e61 6d65 2028 6073 7472 6029 3a0a    name (`str`):.
+00033440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033450: 4e61 6d65 206f 6620 5351 4c20 7461 626c  Name of SQL tabl
+00033460: 652e 0a20 2020 2020 2020 2020 2020 2063  e..            c
+00033470: 6f6e 2028 6073 7472 6020 6f72 2060 7371  on (`str` or `sq
+00033480: 6c69 7465 332e 436f 6e6e 6563 7469 6f6e  lite3.Connection
+00033490: 6020 6f72 2060 7371 6c61 6c63 6865 6d79  ` or `sqlalchemy
+000334a0: 2e65 6e67 696e 652e 436f 6e6e 6563 7469  .engine.Connecti
+000334b0: 6f6e 6020 6f72 2060 7371 6c61 6c63 6865  on` or `sqlalche
+000334c0: 6d79 2e65 6e67 696e 652e 436f 6e6e 6563  my.engine.Connec
+000334d0: 7469 6f6e 6029 3a0a 2020 2020 2020 2020  tion`):.        
+000334e0: 2020 2020 2020 2020 4120 5b55 5249 2073          A [URI s
+000334f0: 7472 696e 675d 2868 7474 7073 3a2f 2f64  tring](https://d
+00033500: 6f63 732e 7371 6c61 6c63 6865 6d79 2e6f  ocs.sqlalchemy.o
+00033510: 7267 2f65 6e2f 3133 2f63 6f72 652f 656e  rg/en/13/core/en
+00033520: 6769 6e65 732e 6874 6d6c 2364 6174 6162  gines.html#datab
+00033530: 6173 652d 7572 6c73 2920 6f72 2061 2053  ase-urls) or a S
+00033540: 514c 6974 6533 2f53 514c 416c 6368 656d  QLite3/SQLAlchem
+00033550: 7920 636f 6e6e 6563 7469 6f6e 206f 626a  y connection obj
+00033560: 6563 7420 7573 6564 2074 6f20 7772 6974  ect used to writ
+00033570: 6520 746f 2061 2064 6174 6162 6173 652e  e to a database.
+00033580: 0a20 2020 2020 2020 2020 2020 2062 6174  .            bat
+00033590: 6368 5f73 697a 6520 2860 696e 7460 2c20  ch_size (`int`, 
+000335a0: 2a6f 7074 696f 6e61 6c2a 293a 0a20 2020  *optional*):.   
+000335b0: 2020 2020 2020 2020 2020 2020 2053 697a               Siz
+000335c0: 6520 6f66 2074 6865 2062 6174 6368 2074  e of the batch t
+000335d0: 6f20 6c6f 6164 2069 6e20 6d65 6d6f 7279  o load in memory
+000335e0: 2061 6e64 2077 7269 7465 2061 7420 6f6e   and write at on
+000335f0: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
+00033600: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
+00033610: 6064 6174 6173 6574 732e 636f 6e66 6967  `datasets.config
+00033620: 2e44 4546 4155 4c54 5f4d 4158 5f42 4154  .DEFAULT_MAX_BAT
+00033630: 4348 5f53 495a 4560 2e0a 2020 2020 2020  CH_SIZE`..      
+00033640: 2020 2020 2020 2a2a 7371 6c5f 7772 6974        **sql_writ
+00033650: 6572 5f6b 7761 7267 7320 2861 6464 6974  er_kwargs (addit
+00033660: 696f 6e61 6c20 6b65 7977 6f72 6420 6172  ional keyword ar
+00033670: 6775 6d65 6e74 7329 3a0a 2020 2020 2020  guments):.      
+00033680: 2020 2020 2020 2020 2020 5061 7261 6d65            Parame
+00033690: 7465 7273 2074 6f20 7061 7373 2074 6f20  ters to pass to 
+000336a0: 7061 6e64 6173 2773 205b 6044 6174 6166  pandas's [`Dataf
+000336b0: 7261 6d65 2e74 6f5f 7371 6c60 5d2e 0a0a  rame.to_sql`]...
+000336c0: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
+000336d0: 0a20 2020 2020 2020 2020 2020 2060 696e  .            `in
+000336e0: 7460 3a20 5468 6520 6e75 6d62 6572 206f  t`: The number o
+000336f0: 6620 7265 636f 7264 7320 7772 6974 7465  f records writte
+00033700: 6e2e 0a0a 2020 2020 2020 2020 4578 616d  n...        Exam
+00033710: 706c 653a 0a0a 2020 2020 2020 2020 6060  ple:..        ``
+00033720: 6070 790a 2020 2020 2020 2020 3e3e 3e20  `py.        >>> 
+00033730: 2320 636f 6e20 7072 6f76 6964 6564 2061  # con provided a
+00033740: 7320 6120 636f 6e6e 6563 7469 6f6e 2055  s a connection U
+00033750: 5249 2073 7472 696e 670a 2020 2020 2020  RI string.      
+00033760: 2020 3e3e 3e20 6473 2e74 6f5f 7371 6c28    >>> ds.to_sql(
+00033770: 2264 6174 6122 2c20 2273 716c 6974 653a  "data", "sqlite:
+00033780: 2f2f 2f6d 795f 6f77 6e5f 6462 2e73 716c  ///my_own_db.sql
+00033790: 2229 0a20 2020 2020 2020 203e 3e3e 2023  ").        >>> #
+000337a0: 2063 6f6e 2070 726f 7669 6465 6420 6173   con provided as
+000337b0: 2061 2073 716c 6974 6533 2063 6f6e 6e65   a sqlite3 conne
+000337c0: 6374 696f 6e20 6f62 6a65 6374 0a20 2020  ction object.   
+000337d0: 2020 2020 203e 3e3e 2069 6d70 6f72 7420       >>> import 
+000337e0: 7371 6c69 7465 330a 2020 2020 2020 2020  sqlite3.        
+000337f0: 3e3e 3e20 636f 6e20 3d20 7371 6c69 7465  >>> con = sqlite
+00033800: 332e 636f 6e6e 6563 7428 226d 795f 6f77  3.connect("my_ow
+00033810: 6e5f 6462 2e73 716c 2229 0a20 2020 2020  n_db.sql").     
+00033820: 2020 203e 3e3e 2077 6974 6820 636f 6e3a     >>> with con:
+00033830: 0a20 2020 2020 2020 202e 2e2e 2020 2020  .        ...    
+00033840: 2064 732e 746f 5f73 716c 2822 6461 7461   ds.to_sql("data
+00033850: 222c 2063 6f6e 290a 2020 2020 2020 2020  ", con).        
+00033860: 6060 600a 2020 2020 2020 2020 2222 220a  ```.        """.
+00033870: 2020 2020 2020 2020 2320 4479 6e61 6d69          # Dynami
+00033880: 6320 696d 706f 7274 2074 6f20 6176 6f69  c import to avoi
+00033890: 6420 6369 7263 756c 6172 2064 6570 656e  d circular depen
+000338a0: 6465 6e63 790a 2020 2020 2020 2020 6672  dency.        fr
+000338b0: 6f6d 202e 696f 2e73 716c 2069 6d70 6f72  om .io.sql impor
+000338c0: 7420 5371 6c44 6174 6173 6574 5772 6974  t SqlDatasetWrit
+000338d0: 6572 0a0a 2020 2020 2020 2020 7265 7475  er..        retu
+000338e0: 726e 2053 716c 4461 7461 7365 7457 7269  rn SqlDatasetWri
+000338f0: 7465 7228 7365 6c66 2c20 6e61 6d65 2c20  ter(self, name, 
+00033900: 636f 6e2c 2062 6174 6368 5f73 697a 653d  con, batch_size=
+00033910: 6261 7463 685f 7369 7a65 2c20 2a2a 7371  batch_size, **sq
+00033920: 6c5f 7772 6974 6572 5f6b 7761 7267 7329  l_writer_kwargs)
+00033930: 2e77 7269 7465 2829 0a0a 2020 2020 6465  .write()..    de
+00033940: 6620 5f65 7374 696d 6174 655f 6e62 7974  f _estimate_nbyt
+00033950: 6573 2873 656c 6629 202d 3e20 696e 743a  es(self) -> int:
+00033960: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
+00033970: 5f6e 6279 7465 7320 3d20 7365 6c66 2e64  _nbytes = self.d
+00033980: 6174 612e 6e62 7974 6573 0a0a 2020 2020  ata.nbytes..    
+00033990: 2020 2020 2320 4669 6e64 2064 6563 6f64      # Find decod
+000339a0: 6162 6c65 2063 6f6c 756d 6e73 2c20 6265  able columns, be
+000339b0: 6361 7573 6520 6966 2074 6865 7265 2061  cause if there a
+000339c0: 7265 2061 6e79 2c20 7765 206e 6565 6420  re any, we need 
+000339d0: 746f 0a20 2020 2020 2020 2023 2061 646a  to.        # adj
+000339e0: 7573 7420 7468 6520 6461 7461 7365 7420  ust the dataset 
+000339f0: 7369 7a65 2063 6f6d 7075 7461 7469 6f6e  size computation
+00033a00: 2028 6e65 6564 6564 2066 6f72 2073 6861   (needed for sha
+00033a10: 7264 696e 6729 2074 6f20 6163 636f 756e  rding) to accoun
+00033a20: 7420 666f 7220 706f 7373 6962 6c65 2065  t for possible e
+00033a30: 7874 6572 6e61 6c20 6669 6c65 730a 2020  xternal files.  
+00033a40: 2020 2020 2020 6465 636f 6461 626c 655f        decodable_
+00033a50: 636f 6c75 6d6e 7320 3d20 5b6b 2066 6f72  columns = [k for
+00033a60: 206b 2c20 7620 696e 2073 656c 662e 6665   k, v in self.fe
+00033a70: 6174 7572 6573 2e69 7465 6d73 2829 2069  atures.items() i
+00033a80: 6620 7265 7175 6972 655f 6465 636f 6469  f require_decodi
+00033a90: 6e67 2876 2c20 6967 6e6f 7265 5f64 6563  ng(v, ignore_dec
+00033aa0: 6f64 655f 6174 7472 6962 7574 653d 5472  ode_attribute=Tr
+00033ab0: 7565 295d 0a0a 2020 2020 2020 2020 6966  ue)]..        if
+00033ac0: 2064 6563 6f64 6162 6c65 5f63 6f6c 756d   decodable_colum
+00033ad0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00033ae0: 2320 4170 7072 6f78 696d 6174 6520 7468  # Approximate th
+00033af0: 6520 7370 6163 6520 6e65 6564 6564 2074  e space needed t
+00033b00: 6f20 7374 6f72 6520 7468 6520 6279 7465  o store the byte
+00033b10: 7320 6672 6f6d 2074 6865 2065 7874 6572  s from the exter
+00033b20: 6e61 6c20 6669 6c65 7320 6279 2061 6e61  nal files by ana
+00033b30: 6c79 7a69 6e67 2074 6865 2066 6972 7374  lyzing the first
+00033b40: 2031 3030 3020 6578 616d 706c 6573 0a20   1000 examples. 
+00033b50: 2020 2020 2020 2020 2020 2065 7874 7261             extra
+00033b60: 5f6e 6279 7465 7320 3d20 300a 0a20 2020  _nbytes = 0..   
+00033b70: 2020 2020 2020 2020 2064 6566 2065 7874           def ext
+00033b80: 7261 5f6e 6279 7465 735f 7669 7369 746f  ra_nbytes_visito
+00033b90: 7228 6172 7261 792c 2066 6561 7475 7265  r(array, feature
+00033ba0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00033bb0: 2020 206e 6f6e 6c6f 6361 6c20 6578 7472     nonlocal extr
+00033bc0: 615f 6e62 7974 6573 0a20 2020 2020 2020  a_nbytes.       
+00033bd0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00033be0: 7374 616e 6365 2866 6561 7475 7265 2c20  stance(feature, 
+00033bf0: 2841 7564 696f 2c20 496d 6167 6529 293a  (Audio, Image)):
+00033c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033c10: 2020 2020 2066 6f72 2078 2069 6e20 6172       for x in ar
+00033c20: 7261 792e 746f 5f70 796c 6973 7428 293a  ray.to_pylist():
+00033c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033c40: 2020 2020 2020 2020 2069 6620 7820 6973           if x is
+00033c50: 206e 6f74 204e 6f6e 6520 616e 6420 785b   not None and x[
+00033c60: 2262 7974 6573 225d 2069 7320 4e6f 6e65  "bytes"] is None
+00033c70: 2061 6e64 2078 5b22 7061 7468 225d 2069   and x["path"] i
+00033c80: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00033c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033ca0: 2020 2020 2020 2020 7369 7a65 203d 2078          size = x
+00033cb0: 6765 7473 697a 6528 785b 2270 6174 6822  getsize(x["path"
+00033cc0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00033cd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00033ce0: 7874 7261 5f6e 6279 7465 7320 2b3d 2073  xtra_nbytes += s
+00033cf0: 697a 650a 2020 2020 2020 2020 2020 2020  ize.            
+00033d00: 2020 2020 2020 2020 6578 7472 615f 6e62          extra_nb
+00033d10: 7974 6573 202d 3d20 6172 7261 792e 6669  ytes -= array.fi
+00033d20: 656c 6428 2270 6174 6822 292e 6e62 7974  eld("path").nbyt
+00033d30: 6573 0a0a 2020 2020 2020 2020 2020 2020  es..            
+00033d40: 7461 626c 6520 3d20 7365 6c66 2e77 6974  table = self.wit
+00033d50: 685f 666f 726d 6174 2822 6172 726f 7722  h_format("arrow"
+00033d60: 295b 3a31 3030 305d 0a20 2020 2020 2020  )[:1000].       
+00033d70: 2020 2020 2074 6162 6c65 5f76 6973 6974       table_visit
+00033d80: 6f72 2874 6162 6c65 2c20 6578 7472 615f  or(table, extra_
+00033d90: 6e62 7974 6573 5f76 6973 6974 6f72 290a  nbytes_visitor).
+00033da0: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
+00033db0: 7261 5f6e 6279 7465 7320 3d20 6578 7472  ra_nbytes = extr
+00033dc0: 615f 6e62 7974 6573 202a 206c 656e 2873  a_nbytes * len(s
+00033dd0: 656c 662e 6461 7461 2920 2f20 6c65 6e28  elf.data) / len(
+00033de0: 7461 626c 6529 0a20 2020 2020 2020 2020  table).         
+00033df0: 2020 2064 6174 6173 6574 5f6e 6279 7465     dataset_nbyte
+00033e00: 7320 3d20 6461 7461 7365 745f 6e62 7974  s = dataset_nbyt
+00033e10: 6573 202b 2065 7874 7261 5f6e 6279 7465  es + extra_nbyte
+00033e20: 730a 0a20 2020 2020 2020 2069 6620 7365  s..        if se
+00033e30: 6c66 2e5f 696e 6469 6365 7320 6973 206e  lf._indices is n
+00033e40: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00033e50: 2020 2020 2064 6174 6173 6574 5f6e 6279       dataset_nby
+00033e60: 7465 7320 3d20 6461 7461 7365 745f 6e62  tes = dataset_nb
+00033e70: 7974 6573 202a 206c 656e 2873 656c 662e  ytes * len(self.
+00033e80: 5f69 6e64 6963 6573 2920 2f20 6c65 6e28  _indices) / len(
+00033e90: 7365 6c66 2e64 6174 6129 0a20 2020 2020  self.data).     
+00033ea0: 2020 2072 6574 7572 6e20 6461 7461 7365     return datase
+00033eb0: 745f 6e62 7974 6573 0a0a 2020 2020 6465  t_nbytes..    de
+00033ec0: 6620 5f70 7573 685f 7061 7271 7565 745f  f _push_parquet_
+00033ed0: 7368 6172 6473 5f74 6f5f 6875 6228 0a20  shards_to_hub(. 
+00033ee0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00033ef0: 2020 2020 2072 6570 6f5f 6964 3a20 7374       repo_id: st
+00033f00: 722c 0a20 2020 2020 2020 2073 706c 6974  r,.        split
+00033f10: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+00033f20: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00033f30: 7072 6976 6174 653a 204f 7074 696f 6e61  private: Optiona
+00033f40: 6c5b 626f 6f6c 5d20 3d20 4661 6c73 652c  l[bool] = False,
+00033f50: 0a20 2020 2020 2020 2074 6f6b 656e 3a20  .        token: 
+00033f60: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00033f70: 4e6f 6e65 2c0a 2020 2020 2020 2020 6272  None,.        br
+00033f80: 616e 6368 3a20 4f70 7469 6f6e 616c 5b73  anch: Optional[s
+00033f90: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+00033fa0: 2020 2020 6d61 785f 7368 6172 645f 7369      max_shard_si
+00033fb0: 7a65 3a20 4f70 7469 6f6e 616c 5b55 6e69  ze: Optional[Uni
+00033fc0: 6f6e 5b69 6e74 2c20 7374 725d 5d20 3d20  on[int, str]] = 
+00033fd0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6e75  None,.        nu
+00033fe0: 6d5f 7368 6172 6473 3a20 4f70 7469 6f6e  m_shards: Option
+00033ff0: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a  al[int] = None,.
+00034000: 2020 2020 2020 2020 656d 6265 645f 6578          embed_ex
+00034010: 7465 726e 616c 5f66 696c 6573 3a20 626f  ternal_files: bo
+00034020: 6f6c 203d 2054 7275 652c 0a20 2020 2029  ol = True,.    )
+00034030: 202d 3e20 5475 706c 655b 7374 722c 2073   -> Tuple[str, s
+00034040: 7472 2c20 696e 742c 2069 6e74 5d3a 0a20  tr, int, int]:. 
+00034050: 2020 2020 2020 2022 2222 5075 7368 6573         """Pushes
+00034060: 2074 6865 2064 6174 6173 6574 2074 6f20   the dataset to 
+00034070: 7468 6520 6875 622e 0a20 2020 2020 2020  the hub..       
+00034080: 2054 6865 2064 6174 6173 6574 2069 7320   The dataset is 
+00034090: 7075 7368 6564 2075 7369 6e67 2048 5454  pushed using HTT
+000340a0: 5020 7265 7175 6573 7473 2061 6e64 2064  P requests and d
+000340b0: 6f65 7320 6e6f 7420 6e65 6564 2074 6f20  oes not need to 
+000340c0: 6861 7665 206e 6569 7468 6572 2067 6974  have neither git
+000340d0: 206f 7220 6769 742d 6c66 7320 696e 7374   or git-lfs inst
+000340e0: 616c 6c65 642e 0a0a 2020 2020 2020 2020  alled...        
+000340f0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00034100: 2020 7265 706f 5f69 6420 2860 7374 7260    repo_id (`str`
+00034110: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00034120: 2020 2054 6865 2049 4420 6f66 2074 6865     The ID of the
+00034130: 2072 6570 6f73 6974 6f72 7920 746f 2070   repository to p
+00034140: 7573 6820 746f 2069 6e20 7468 6520 666f  ush to in the fo
+00034150: 6c6c 6f77 696e 6720 666f 726d 6174 3a20  llowing format: 
+00034160: 603c 7573 6572 3e2f 3c64 6174 6173 6574  `<user>/<dataset
+00034170: 5f6e 616d 653e 6020 6f72 0a20 2020 2020  _name>` or.     
+00034180: 2020 2020 2020 2020 2020 2060 3c6f 7267             `<org
+00034190: 3e2f 3c64 6174 6173 6574 5f6e 616d 653e  >/<dataset_name>
+000341a0: 602e 2041 6c73 6f20 6163 6365 7074 7320  `. Also accepts 
+000341b0: 603c 6461 7461 7365 745f 6e61 6d65 3e60  `<dataset_name>`
+000341c0: 2c20 7768 6963 6820 7769 6c6c 2064 6566  , which will def
+000341d0: 6175 6c74 2074 6f20 7468 6520 6e61 6d65  ault to the name
+000341e0: 7370 6163 650a 2020 2020 2020 2020 2020  space.          
+000341f0: 2020 2020 2020 6f66 2074 6865 206c 6f67        of the log
+00034200: 6765 642d 696e 2075 7365 722e 0a20 2020  ged-in user..   
+00034210: 2020 2020 2020 2020 2073 706c 6974 2028           split (
+00034220: 4f70 7469 6f6e 616c 2c20 6073 7472 6029  Optional, `str`)
+00034230: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00034240: 2020 5468 6520 6e61 6d65 206f 6620 7468    The name of th
+00034250: 6520 7370 6c69 7420 7468 6174 2077 696c  e split that wil
+00034260: 6c20 6265 2067 6976 656e 2074 6f20 7468  l be given to th
+00034270: 6174 2064 6174 6173 6574 2e20 4465 6661  at dataset. Defa
+00034280: 756c 7473 2074 6f20 6073 656c 662e 7370  ults to `self.sp
+00034290: 6c69 7460 2e0a 2020 2020 2020 2020 2020  lit`..          
+000342a0: 2020 7072 6976 6174 6520 284f 7074 696f    private (Optio
+000342b0: 6e61 6c20 6062 6f6f 6c60 2c20 6465 6661  nal `bool`, defa
+000342c0: 756c 7473 2074 6f20 6046 616c 7365 6029  ults to `False`)
+000342d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000342e0: 2020 5768 6574 6865 7220 7468 6520 6461    Whether the da
+000342f0: 7461 7365 7420 7265 706f 7369 746f 7279  taset repository
+00034300: 2073 686f 756c 6420 6265 2073 6574 2074   should be set t
+00034310: 6f20 7072 6976 6174 6520 6f72 206e 6f74  o private or not
+00034320: 2e20 4f6e 6c79 2061 6666 6563 7473 2072  . Only affects r
+00034330: 6570 6f73 6974 6f72 7920 6372 6561 7469  epository creati
+00034340: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+00034350: 2020 2020 6120 7265 706f 7369 746f 7279      a repository
+00034360: 2074 6861 7420 616c 7265 6164 7920 6578   that already ex
+00034370: 6973 7473 2077 696c 6c20 6e6f 7420 6265  ists will not be
+00034380: 2061 6666 6563 7465 6420 6279 2074 6861   affected by tha
+00034390: 7420 7061 7261 6d65 7465 722e 0a20 2020  t parameter..   
+000343a0: 2020 2020 2020 2020 2074 6f6b 656e 2028           token (
+000343b0: 4f70 7469 6f6e 616c 2060 7374 7260 293a  Optional `str`):
+000343c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000343d0: 2041 6e20 6f70 7469 6f6e 616c 2061 7574   An optional aut
+000343e0: 6865 6e74 6963 6174 696f 6e20 746f 6b65  hentication toke
+000343f0: 6e20 666f 7220 7468 6520 4875 6767 696e  n for the Huggin
+00034400: 6720 4661 6365 2048 7562 2e20 4966 206e  g Face Hub. If n
+00034410: 6f20 746f 6b65 6e20 6973 2070 6173 7365  o token is passe
+00034420: 642c 2077 696c 6c20 6465 6661 756c 740a  d, will default.
+00034430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034440: 746f 2074 6865 2074 6f6b 656e 2073 6176  to the token sav
+00034450: 6564 206c 6f63 616c 6c79 2077 6865 6e20  ed locally when 
+00034460: 6c6f 6767 696e 6720 696e 2077 6974 6820  logging in with 
+00034470: 6060 6875 6767 696e 6766 6163 652d 636c  ``huggingface-cl
+00034480: 6920 6c6f 6769 6e60 602e 2057 696c 6c20  i login``. Will 
+00034490: 7261 6973 6520 616e 2065 7272 6f72 0a20  raise an error. 
+000344a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000344b0: 6620 6e6f 2074 6f6b 656e 2069 7320 7061  f no token is pa
+000344c0: 7373 6564 2061 6e64 2074 6865 2075 7365  ssed and the use
+000344d0: 7220 6973 206e 6f74 206c 6f67 6765 642d  r is not logged-
+000344e0: 696e 2e0a 2020 2020 2020 2020 2020 2020  in..            
+000344f0: 6272 616e 6368 2028 4f70 7469 6f6e 616c  branch (Optional
+00034500: 2060 7374 7260 293a 0a20 2020 2020 2020   `str`):.       
+00034510: 2020 2020 2020 2020 2054 6865 2067 6974           The git
+00034520: 2062 7261 6e63 6820 6f6e 2077 6869 6368   branch on which
+00034530: 2074 6f20 7075 7368 2074 6865 2064 6174   to push the dat
+00034540: 6173 6574 2e20 5468 6973 2064 6566 6175  aset. This defau
+00034550: 6c74 7320 746f 2074 6865 2064 6566 6175  lts to the defau
+00034560: 6c74 2062 7261 6e63 6820 6173 2073 7065  lt branch as spe
+00034570: 6369 6669 6564 0a20 2020 2020 2020 2020  cified.         
+00034580: 2020 2020 2020 2069 6e20 796f 7572 2072         in your r
+00034590: 6570 6f73 6974 6f72 792c 2077 6869 6368  epository, which
+000345a0: 2064 6566 6175 6c74 7320 746f 2060 226d   defaults to `"m
+000345b0: 6169 6e22 602e 0a20 2020 2020 2020 2020  ain"`..         
+000345c0: 2020 206d 6178 5f73 6861 7264 5f73 697a     max_shard_siz
+000345d0: 6520 2860 696e 7460 206f 7220 6073 7472  e (`int` or `str
+000345e0: 602c 202a 6f70 7469 6f6e 616c 2a2c 2064  `, *optional*, d
+000345f0: 6566 6175 6c74 7320 746f 2060 2235 3030  efaults to `"500
+00034600: 4d42 2260 293a 0a20 2020 2020 2020 2020  MB"`):.         
+00034610: 2020 2020 2020 2054 6865 206d 6178 696d         The maxim
+00034620: 756d 2073 697a 6520 6f66 2074 6865 2064  um size of the d
+00034630: 6174 6173 6574 2073 6861 7264 7320 746f  ataset shards to
+00034640: 2062 6520 7570 6c6f 6164 6564 2074 6f20   be uploaded to 
+00034650: 7468 6520 6875 622e 2049 6620 6578 7072  the hub. If expr
+00034660: 6573 7365 6420 6173 2061 2073 7472 696e  essed as a strin
+00034670: 672c 206e 6565 6473 2074 6f20 6265 2064  g, needs to be d
+00034680: 6967 6974 7320 666f 6c6c 6f77 6564 2062  igits followed b
+00034690: 7920 610a 2020 2020 2020 2020 2020 2020  y a.            
+000346a0: 2020 2020 6120 756e 6974 2028 6c69 6b65      a unit (like
+000346b0: 2060 2235 4d42 2260 292e 0a20 2020 2020   `"5MB"`)..     
+000346c0: 2020 2020 2020 206e 756d 5f73 6861 7264         num_shard
+000346d0: 7320 2860 696e 7460 2c20 2a6f 7074 696f  s (`int`, *optio
+000346e0: 6e61 6c2a 293a 0a20 2020 2020 2020 2020  nal*):.         
+000346f0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
+00034700: 2073 6861 7264 7320 746f 2077 7269 7465   shards to write
+00034710: 2e20 4279 2064 6566 6175 6c74 2074 6865  . By default the
+00034720: 206e 756d 6265 7220 6f66 2073 6861 7264   number of shard
+00034730: 7320 6465 7065 6e64 7320 6f6e 2060 6d61  s depends on `ma
+00034740: 785f 7368 6172 645f 7369 7a65 602e 0a0a  x_shard_size`...
+00034750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034760: 3c41 6464 6564 2076 6572 7369 6f6e 3d22  <Added version="
+00034770: 322e 382e 3022 2f3e 0a20 2020 2020 2020  2.8.0"/>.       
+00034780: 2020 2020 2065 6d62 6564 5f65 7874 6572       embed_exter
+00034790: 6e61 6c5f 6669 6c65 7320 2860 626f 6f6c  nal_files (`bool
+000347a0: 602c 2064 6566 6175 6c74 2060 6054 7275  `, default ``Tru
+000347b0: 6560 6029 3a0a 2020 2020 2020 2020 2020  e``):.          
+000347c0: 2020 2020 2020 5768 6574 6865 7220 746f        Whether to
+000347d0: 2065 6d62 6564 2066 696c 6520 6279 7465   embed file byte
+000347e0: 7320 696e 2074 6865 2073 6861 7264 732e  s in the shards.
+000347f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034800: 2049 6e20 7061 7274 6963 756c 6172 2c20   In particular, 
+00034810: 7468 6973 2077 696c 6c20 646f 2074 6865  this will do the
+00034820: 2066 6f6c 6c6f 7769 6e67 2062 6566 6f72   following befor
+00034830: 6520 7468 6520 7075 7368 2066 6f72 2074  e the push for t
+00034840: 6865 2066 6965 6c64 7320 6f66 2074 7970  he fields of typ
+00034850: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+00034860: 2020 2020 2d20 3a63 6c61 7373 3a60 4175      - :class:`Au
+00034870: 6469 6f60 2061 6e64 2063 6c61 7373 3a60  dio` and class:`
+00034880: 496d 6167 6560 3a20 7265 6d6f 7665 206c  Image`: remove l
+00034890: 6f63 616c 2070 6174 6820 696e 666f 726d  ocal path inform
+000348a0: 6174 696f 6e20 616e 6420 656d 6265 6420  ation and embed 
+000348b0: 6669 6c65 2063 6f6e 7465 6e74 2069 6e20  file content in 
+000348c0: 7468 6520 5061 7271 7565 7420 6669 6c65  the Parquet file
+000348d0: 732e 0a0a 2020 2020 2020 2020 5265 7475  s...        Retu
+000348e0: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
+000348f0: 2072 6570 6f5f 6964 2028 6073 7472 6029   repo_id (`str`)
+00034900: 3a20 4944 206f 6620 7468 6520 7265 706f  : ID of the repo
+00034910: 7369 746f 7279 2069 6e20 3c75 7365 723e  sitory in <user>
+00034920: 2f3c 6461 7461 7365 745f 6e61 6d65 3e60  /<dataset_name>`
+00034930: 206f 7220 603c 6f72 673e 2f3c 6461 7461   or `<org>/<data
+00034940: 7365 745f 6e61 6d65 3e60 2066 6f72 6d61  set_name>` forma
+00034950: 740a 2020 2020 2020 2020 2020 2020 7370  t.            sp
+00034960: 6c69 7420 2860 7374 7260 293a 206e 616d  lit (`str`): nam
+00034970: 6520 6f66 2074 6865 2075 706c 6f61 6465  e of the uploade
+00034980: 6420 7370 6c69 740a 2020 2020 2020 2020  d split.        
+00034990: 2020 2020 7570 6c6f 6164 6564 5f73 697a      uploaded_siz
+000349a0: 6520 2860 696e 7460 293a 206e 756d 6265  e (`int`): numbe
+000349b0: 7220 6f66 2075 706c 6f61 6465 6420 6279  r of uploaded by
+000349c0: 7465 7320 746f 2074 6865 2072 6570 6f73  tes to the repos
+000349d0: 6974 6f72 790a 2020 2020 2020 2020 2020  itory.          
+000349e0: 2020 6461 7461 7365 745f 6e62 7974 6573    dataset_nbytes
+000349f0: 2028 6069 6e74 6029 3a20 6170 7072 6f78   (`int`): approx
+00034a00: 696d 6174 6520 7369 7a65 2069 6e20 6279  imate size in by
+00034a10: 7465 7320 6f66 2074 6865 2075 706c 6f61  tes of the uploa
+00034a20: 6465 6420 6461 7461 7365 7420 6166 6572  ded dataset afer
+00034a30: 2075 6e63 6f6d 7072 6573 7369 6f6e 0a20   uncompression. 
+00034a40: 2020 2020 2020 2020 2020 2072 6570 6f5f             repo_
+00034a50: 6669 6c65 7320 2860 7374 7260 293a 206c  files (`str`): l
+00034a60: 6973 7420 6f66 2066 696c 6573 2069 6e20  ist of files in 
+00034a70: 7468 6520 7265 706f 7369 746f 7279 0a20  the repository. 
+00034a80: 2020 2020 2020 2020 2020 2064 656c 6574             delet
+00034a90: 6564 5f73 697a 6520 2860 696e 7460 293a  ed_size (`int`):
+00034aa0: 206e 756d 6265 7220 6f66 2064 656c 6574   number of delet
+00034ab0: 6564 2062 7974 6573 2069 6e20 7468 6520  ed bytes in the 
+00034ac0: 7265 706f 7369 746f 7279 0a0a 2020 2020  repository..    
+00034ad0: 2020 2020 4578 616d 706c 653a 0a0a 2020      Example:..  
+00034ae0: 2020 2020 2020 6060 6070 7974 686f 6e0a        ```python.
+00034af0: 2020 2020 2020 2020 3e3e 3e20 6461 7461          >>> data
+00034b00: 7365 742e 7075 7368 5f74 6f5f 6875 6228  set.push_to_hub(
+00034b10: 223c 6f72 6761 6e69 7a61 7469 6f6e 3e2f  "<organization>/
+00034b20: 3c64 6174 6173 6574 5f69 643e 222c 2073  <dataset_id>", s
+00034b30: 706c 6974 3d22 6576 616c 7561 7469 6f6e  plit="evaluation
+00034b40: 2229 0a20 2020 2020 2020 2060 6060 0a20  ").        ```. 
+00034b50: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00034b60: 2020 2069 6620 6d61 785f 7368 6172 645f     if max_shard_
+00034b70: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
+00034b80: 2061 6e64 206e 756d 5f73 6861 7264 7320   and num_shards 
+00034b90: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00034ba0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00034bb0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00034bc0: 2020 2020 2020 2020 2020 2022 4661 696c             "Fail
+00034bd0: 6564 2074 6f20 7075 7368 5f74 6f5f 6875  ed to push_to_hu
+00034be0: 623a 2070 6c65 6173 6520 7370 6563 6966  b: please specif
+00034bf0: 7920 6569 7468 6572 206d 6178 5f73 6861  y either max_sha
+00034c00: 7264 5f73 697a 6520 6f72 206e 756d 5f73  rd_size or num_s
+00034c10: 6861 7264 732c 2062 7574 206e 6f74 2062  hards, but not b
+00034c20: 6f74 682e 220a 2020 2020 2020 2020 2020  oth.".          
+00034c30: 2020 290a 0a20 2020 2020 2020 2061 7069    )..        api
+00034c40: 203d 2048 6641 7069 2865 6e64 706f 696e   = HfApi(endpoin
+00034c50: 743d 636f 6e66 6967 2e48 465f 454e 4450  t=config.HF_ENDP
+00034c60: 4f49 4e54 290a 2020 2020 2020 2020 746f  OINT).        to
+00034c70: 6b65 6e20 3d20 746f 6b65 6e20 6966 2074  ken = token if t
+00034c80: 6f6b 656e 2069 7320 6e6f 7420 4e6f 6e65  oken is not None
+00034c90: 2065 6c73 6520 4866 466f 6c64 6572 2e67   else HfFolder.g
+00034ca0: 6574 5f74 6f6b 656e 2829 0a0a 2020 2020  et_token()..    
+00034cb0: 2020 2020 6966 2074 6f6b 656e 2069 7320      if token is 
+00034cc0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00034cd0: 2020 7261 6973 6520 456e 7669 726f 6e6d    raise Environm
+00034ce0: 656e 7445 7272 6f72 280a 2020 2020 2020  entError(.      
+00034cf0: 2020 2020 2020 2020 2020 2259 6f75 206e            "You n
+00034d00: 6565 6420 746f 2070 726f 7669 6465 2061  eed to provide a
+00034d10: 2060 746f 6b65 6e60 206f 7220 6265 206c   `token` or be l
+00034d20: 6f67 6765 6420 696e 2074 6f20 4875 6767  ogged in to Hugg
+00034d30: 696e 6720 4661 6365 2077 6974 6820 6068  ing Face with `h
+00034d40: 7567 6769 6e67 6661 6365 2d63 6c69 206c  uggingface-cli l
+00034d50: 6f67 696e 602e 220a 2020 2020 2020 2020  ogin`.".        
+00034d60: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
+00034d70: 6620 7370 6c69 7420 6973 204e 6f6e 653a  f split is None:
+00034d80: 0a20 2020 2020 2020 2020 2020 2073 706c  .            spl
+00034d90: 6974 203d 2073 7472 2873 656c 662e 7370  it = str(self.sp
+00034da0: 6c69 7429 2069 6620 7365 6c66 2e73 706c  lit) if self.spl
+00034db0: 6974 2069 7320 6e6f 7420 4e6f 6e65 2065  it is not None e
+00034dc0: 6c73 6520 2274 7261 696e 220a 0a20 2020  lse "train"..   
+00034dd0: 2020 2020 2069 6620 6e6f 7420 7265 2e6d       if not re.m
+00034de0: 6174 6368 285f 7370 6c69 745f 7265 2c20  atch(_split_re, 
+00034df0: 7370 6c69 7429 3a0a 2020 2020 2020 2020  split):.        
+00034e00: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00034e10: 7272 6f72 2866 2253 706c 6974 206e 616d  rror(f"Split nam
+00034e20: 6520 7368 6f75 6c64 206d 6174 6368 2027  e should match '
+00034e30: 7b5f 7370 6c69 745f 7265 7d27 2062 7574  {_split_re}' but
+00034e40: 2067 6f74 2027 7b73 706c 6974 7d27 2e22   got '{split}'."
+00034e50: 290a 0a20 2020 2020 2020 2069 6465 6e74  )..        ident
+00034e60: 6966 6965 7220 3d20 7265 706f 5f69 642e  ifier = repo_id.
+00034e70: 7370 6c69 7428 222f 2229 0a0a 2020 2020  split("/")..    
+00034e80: 2020 2020 6966 206c 656e 2869 6465 6e74      if len(ident
+00034e90: 6966 6965 7229 203e 2032 3a0a 2020 2020  ifier) > 2:.    
+00034ea0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00034eb0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00034ec0: 2020 2020 2020 2020 2020 6622 5468 6520            f"The 
+00034ed0: 6964 656e 7469 6669 6572 2073 686f 756c  identifier shoul
+00034ee0: 6420 6265 2069 6e20 7468 6520 666f 726d  d be in the form
+00034ef0: 6174 203c 7265 706f 5f69 643e 206f 7220  at <repo_id> or 
+00034f00: 3c6e 616d 6573 7061 6365 3e2f 3c72 6570  <namespace>/<rep
+00034f10: 6f5f 6964 3e2e 2049 7420 6973 207b 6964  o_id>. It is {id
+00034f20: 656e 7469 6669 6572 7d2c 2022 0a20 2020  entifier}, ".   
+00034f30: 2020 2020 2020 2020 2020 2020 2022 7768               "wh
+00034f40: 6963 6820 646f 6573 6e27 7420 636f 6e66  ich doesn't conf
+00034f50: 6f72 6d20 746f 2065 6974 6865 7220 666f  orm to either fo
+00034f60: 726d 6174 2e22 0a20 2020 2020 2020 2020  rmat.".         
+00034f70: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
+00034f80: 6620 6c65 6e28 6964 656e 7469 6669 6572  f len(identifier
+00034f90: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+00034fa0: 2020 2020 6461 7461 7365 745f 6e61 6d65      dataset_name
+00034fb0: 203d 2069 6465 6e74 6966 6965 725b 305d   = identifier[0]
+00034fc0: 0a20 2020 2020 2020 2020 2020 206f 7267  .            org
+00034fd0: 616e 697a 6174 696f 6e5f 6f72 5f75 7365  anization_or_use
+00034fe0: 726e 616d 6520 3d20 6170 692e 7768 6f61  rname = api.whoa
+00034ff0: 6d69 2874 6f6b 656e 295b 226e 616d 6522  mi(token)["name"
+00035000: 5d0a 2020 2020 2020 2020 2020 2020 7265  ].            re
+00035010: 706f 5f69 6420 3d20 6622 7b6f 7267 616e  po_id = f"{organ
+00035020: 697a 6174 696f 6e5f 6f72 5f75 7365 726e  ization_or_usern
+00035030: 616d 657d 2f7b 6461 7461 7365 745f 6e61  ame}/{dataset_na
+00035040: 6d65 7d22 0a0a 2020 2020 2020 2020 6372  me}"..        cr
+00035050: 6561 7465 5f72 6570 6f28 0a20 2020 2020  eate_repo(.     
+00035060: 2020 2020 2020 2061 7069 2c0a 2020 2020         api,.    
+00035070: 2020 2020 2020 2020 7265 706f 5f69 642c          repo_id,
+00035080: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+00035090: 656e 3d74 6f6b 656e 2c0a 2020 2020 2020  en=token,.      
+000350a0: 2020 2020 2020 7265 706f 5f74 7970 653d        repo_type=
+000350b0: 2264 6174 6173 6574 222c 0a20 2020 2020  "dataset",.     
+000350c0: 2020 2020 2020 2070 7269 7661 7465 3d70         private=p
+000350d0: 7269 7661 7465 2c0a 2020 2020 2020 2020  rivate,.        
+000350e0: 2020 2020 6578 6973 745f 6f6b 3d54 7275      exist_ok=Tru
+000350f0: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
+00035100: 2020 2020 2020 2320 4669 6e64 2064 6563        # Find dec
+00035110: 6f64 6162 6c65 2063 6f6c 756d 6e73 2c20  odable columns, 
+00035120: 6265 6361 7573 6520 6966 2074 6865 7265  because if there
+00035130: 2061 7265 2061 6e79 2c20 7765 206e 6565   are any, we nee
+00035140: 6420 746f 3a0a 2020 2020 2020 2020 2320  d to:.        # 
+00035150: 656d 6265 6420 7468 6520 6279 7465 7320  embed the bytes 
+00035160: 6672 6f6d 2074 6865 2066 696c 6573 2069  from the files i
+00035170: 6e20 7468 6520 7368 6172 6473 0a20 2020  n the shards.   
+00035180: 2020 2020 2064 6563 6f64 6162 6c65 5f63       decodable_c
+00035190: 6f6c 756d 6e73 203d 2028 0a20 2020 2020  olumns = (.     
+000351a0: 2020 2020 2020 205b 6b20 666f 7220 6b2c         [k for k,
+000351b0: 2076 2069 6e20 7365 6c66 2e66 6561 7475   v in self.featu
+000351c0: 7265 732e 6974 656d 7328 2920 6966 2072  res.items() if r
+000351d0: 6571 7569 7265 5f64 6563 6f64 696e 6728  equire_decoding(
+000351e0: 762c 2069 676e 6f72 655f 6465 636f 6465  v, ignore_decode
+000351f0: 5f61 7474 7269 6275 7465 3d54 7275 6529  _attribute=True)
+00035200: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+00035210: 2065 6d62 6564 5f65 7874 6572 6e61 6c5f   embed_external_
+00035220: 6669 6c65 730a 2020 2020 2020 2020 2020  files.          
+00035230: 2020 656c 7365 205b 5d0a 2020 2020 2020    else [].      
+00035240: 2020 290a 0a20 2020 2020 2020 2064 6174    )..        dat
+00035250: 6173 6574 5f6e 6279 7465 7320 3d20 7365  aset_nbytes = se
+00035260: 6c66 2e5f 6573 7469 6d61 7465 5f6e 6279  lf._estimate_nby
+00035270: 7465 7328 290a 0a20 2020 2020 2020 2069  tes()..        i
+00035280: 6620 6e75 6d5f 7368 6172 6473 2069 7320  f num_shards is 
+00035290: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000352a0: 2020 6d61 785f 7368 6172 645f 7369 7a65    max_shard_size
+000352b0: 203d 2063 6f6e 7665 7274 5f66 696c 655f   = convert_file_
+000352c0: 7369 7a65 5f74 6f5f 696e 7428 6d61 785f  size_to_int(max_
+000352d0: 7368 6172 645f 7369 7a65 206f 7220 636f  shard_size or co
+000352e0: 6e66 6967 2e4d 4158 5f53 4841 5244 5f53  nfig.MAX_SHARD_S
+000352f0: 495a 4529 0a20 2020 2020 2020 2020 2020  IZE).           
+00035300: 206e 756d 5f73 6861 7264 7320 3d20 696e   num_shards = in
+00035310: 7428 6461 7461 7365 745f 6e62 7974 6573  t(dataset_nbytes
+00035320: 202f 206d 6178 5f73 6861 7264 5f73 697a   / max_shard_siz
+00035330: 6529 202b 2031 0a20 2020 2020 2020 2020  e) + 1.         
+00035340: 2020 206e 756d 5f73 6861 7264 7320 3d20     num_shards = 
+00035350: 6d61 7828 6e75 6d5f 7368 6172 6473 2c20  max(num_shards, 
+00035360: 3129 0a0a 2020 2020 2020 2020 7368 6172  1)..        shar
+00035370: 6473 203d 2028 7365 6c66 2e73 6861 7264  ds = (self.shard
+00035380: 286e 756d 5f73 6861 7264 733d 6e75 6d5f  (num_shards=num_
+00035390: 7368 6172 6473 2c20 696e 6465 783d 692c  shards, index=i,
+000353a0: 2063 6f6e 7469 6775 6f75 733d 5472 7565   contiguous=True
+000353b0: 2920 666f 7220 6920 696e 2072 616e 6765  ) for i in range
+000353c0: 286e 756d 5f73 6861 7264 7329 290a 0a20  (num_shards)).. 
+000353d0: 2020 2020 2020 2069 6620 6465 636f 6461         if decoda
+000353e0: 626c 655f 636f 6c75 6d6e 733a 0a0a 2020  ble_columns:..  
+000353f0: 2020 2020 2020 2020 2020 6465 6620 7368            def sh
+00035400: 6172 6473 5f77 6974 685f 656d 6265 6464  ards_with_embedd
+00035410: 6564 5f65 7874 6572 6e61 6c5f 6669 6c65  ed_external_file
+00035420: 7328 7368 6172 6473 293a 0a20 2020 2020  s(shards):.     
+00035430: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+00035440: 6861 7264 2069 6e20 7368 6172 6473 3a0a  hard in shards:.
+00035450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035460: 2020 2020 666f 726d 6174 203d 2073 6861      format = sha
+00035470: 7264 2e66 6f72 6d61 740a 2020 2020 2020  rd.format.      
+00035480: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00035490: 6172 6420 3d20 7368 6172 642e 7769 7468  ard = shard.with
+000354a0: 5f66 6f72 6d61 7428 2261 7272 6f77 2229  _format("arrow")
+000354b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000354c0: 2020 2020 2073 6861 7264 203d 2073 6861       shard = sha
+000354d0: 7264 2e6d 6170 280a 2020 2020 2020 2020  rd.map(.        
+000354e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000354f0: 656d 6265 645f 7461 626c 655f 7374 6f72  embed_table_stor
+00035500: 6167 652c 0a20 2020 2020 2020 2020 2020  age,.           
+00035510: 2020 2020 2020 2020 2020 2020 2062 6174               bat
+00035520: 6368 6564 3d54 7275 652c 0a20 2020 2020  ched=True,.     
+00035530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035540: 2020 2062 6174 6368 5f73 697a 653d 3130     batch_size=10
+00035550: 3030 2c0a 2020 2020 2020 2020 2020 2020  00,.            
+00035560: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
+00035570: 5f69 6e5f 6d65 6d6f 7279 3d54 7275 652c  _in_memory=True,
+00035580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035590: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000355a0: 2020 2020 2020 2020 2020 2073 6861 7264             shard
+000355b0: 203d 2073 6861 7264 2e77 6974 685f 666f   = shard.with_fo
+000355c0: 726d 6174 282a 2a66 6f72 6d61 7429 0a20  rmat(**format). 
+000355d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000355e0: 2020 2079 6965 6c64 2073 6861 7264 0a0a     yield shard..
+000355f0: 2020 2020 2020 2020 2020 2020 7368 6172              shar
+00035600: 6473 203d 2073 6861 7264 735f 7769 7468  ds = shards_with
+00035610: 5f65 6d62 6564 6465 645f 6578 7465 726e  _embedded_extern
+00035620: 616c 5f66 696c 6573 2873 6861 7264 7329  al_files(shards)
+00035630: 0a0a 2020 2020 2020 2020 6669 6c65 7320  ..        files 
+00035640: 3d20 6866 5f61 7069 5f6c 6973 745f 7265  = hf_api_list_re
+00035650: 706f 5f66 696c 6573 2861 7069 2c20 7265  po_files(api, re
+00035660: 706f 5f69 642c 2072 6570 6f5f 7479 7065  po_id, repo_type
+00035670: 3d22 6461 7461 7365 7422 2c20 7265 7669  ="dataset", revi
+00035680: 7369 6f6e 3d62 7261 6e63 682c 2075 7365  sion=branch, use
+00035690: 5f61 7574 685f 746f 6b65 6e3d 746f 6b65  _auth_token=toke
+000356a0: 6e29 0a20 2020 2020 2020 2064 6174 615f  n).        data_
+000356b0: 6669 6c65 7320 3d20 5b66 696c 6520 666f  files = [file fo
+000356c0: 7220 6669 6c65 2069 6e20 6669 6c65 7320  r file in files 
+000356d0: 6966 2066 696c 652e 7374 6172 7473 7769  if file.startswi
+000356e0: 7468 2822 6461 7461 2f22 295d 0a0a 2020  th("data/")]..  
+000356f0: 2020 2020 2020 6465 6620 7061 7468 5f69        def path_i
+00035700: 6e5f 7265 706f 285f 696e 6465 782c 2073  n_repo(_index, s
+00035710: 6861 7264 293a 0a20 2020 2020 2020 2020  hard):.         
+00035720: 2020 2072 6574 7572 6e20 6622 6461 7461     return f"data
+00035730: 2f7b 7370 6c69 747d 2d7b 5f69 6e64 6578  /{split}-{_index
+00035740: 3a30 3564 7d2d 6f66 2d7b 6e75 6d5f 7368  :05d}-of-{num_sh
+00035750: 6172 6473 3a30 3564 7d2d 7b73 6861 7264  ards:05d}-{shard
+00035760: 2e5f 6669 6e67 6572 7072 696e 747d 2e70  ._fingerprint}.p
+00035770: 6172 7175 6574 220a 0a20 2020 2020 2020  arquet"..       
+00035780: 2073 6861 7264 735f 6974 6572 203d 2069   shards_iter = i
+00035790: 7465 7228 7368 6172 6473 290a 2020 2020  ter(shards).    
+000357a0: 2020 2020 6669 7273 745f 7368 6172 6420      first_shard 
+000357b0: 3d20 6e65 7874 2873 6861 7264 735f 6974  = next(shards_it
+000357c0: 6572 290a 2020 2020 2020 2020 6669 7273  er).        firs
+000357d0: 745f 7368 6172 645f 7061 7468 5f69 6e5f  t_shard_path_in_
+000357e0: 7265 706f 203d 2070 6174 685f 696e 5f72  repo = path_in_r
+000357f0: 6570 6f28 302c 2066 6972 7374 5f73 6861  epo(0, first_sha
+00035800: 7264 290a 2020 2020 2020 2020 6966 2066  rd).        if f
+00035810: 6972 7374 5f73 6861 7264 5f70 6174 685f  irst_shard_path_
+00035820: 696e 5f72 6570 6f20 696e 2064 6174 615f  in_repo in data_
+00035830: 6669 6c65 7320 616e 6420 6e75 6d5f 7368  files and num_sh
+00035840: 6172 6473 203c 206c 656e 2864 6174 615f  ards < len(data_
+00035850: 6669 6c65 7329 3a0a 2020 2020 2020 2020  files):.        
+00035860: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
+00035870: 6e67 2822 5265 7375 6d69 6e67 2075 706c  ng("Resuming upl
+00035880: 6f61 6420 6f66 2074 6865 2064 6174 6173  oad of the datas
+00035890: 6574 2073 6861 7264 732e 2229 0a0a 2020  et shards.")..  
+000358a0: 2020 2020 2020 7570 6c6f 6164 6564 5f73        uploaded_s
+000358b0: 697a 6520 3d20 300a 2020 2020 2020 2020  ize = 0.        
+000358c0: 7368 6172 6473 5f70 6174 685f 696e 5f72  shards_path_in_r
+000358d0: 6570 6f20 3d20 5b5d 0a20 2020 2020 2020  epo = [].       
+000358e0: 2066 6f72 2069 6e64 6578 2c20 7368 6172   for index, shar
+000358f0: 6420 696e 206c 6f67 6769 6e67 2e74 7164  d in logging.tqd
+00035900: 6d28 0a20 2020 2020 2020 2020 2020 2065  m(.            e
+00035910: 6e75 6d65 7261 7465 2869 7465 7274 6f6f  numerate(itertoo
+00035920: 6c73 2e63 6861 696e 285b 6669 7273 745f  ls.chain([first_
+00035930: 7368 6172 645d 2c20 7368 6172 6473 5f69  shard], shards_i
+00035940: 7465 7229 292c 0a20 2020 2020 2020 2020  ter)),.         
+00035950: 2020 2064 6573 633d 2250 7573 6869 6e67     desc="Pushing
+00035960: 2064 6174 6173 6574 2073 6861 7264 7320   dataset shards 
+00035970: 746f 2074 6865 2064 6174 6173 6574 2068  to the dataset h
+00035980: 7562 222c 0a20 2020 2020 2020 2020 2020  ub",.           
+00035990: 2074 6f74 616c 3d6e 756d 5f73 6861 7264   total=num_shard
+000359a0: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
+000359b0: 6973 6162 6c65 3d6e 6f74 206c 6f67 6769  isable=not loggi
+000359c0: 6e67 2e69 735f 7072 6f67 7265 7373 5f62  ng.is_progress_b
+000359d0: 6172 5f65 6e61 626c 6564 2829 2c0a 2020  ar_enabled(),.  
+000359e0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+000359f0: 2020 2020 2073 6861 7264 5f70 6174 685f       shard_path_
+00035a00: 696e 5f72 6570 6f20 3d20 7061 7468 5f69  in_repo = path_i
+00035a10: 6e5f 7265 706f 2869 6e64 6578 2c20 7368  n_repo(index, sh
+00035a20: 6172 6429 0a20 2020 2020 2020 2020 2020  ard).           
+00035a30: 2023 2055 706c 6f61 6420 6120 7368 6172   # Upload a shar
+00035a40: 6420 6f6e 6c79 2069 6620 6974 2064 6f65  d only if it doe
+00035a50: 736e 2774 2061 6c72 6561 6479 2065 7869  sn't already exi
+00035a60: 7374 2069 6e20 7468 6520 7265 706f 7369  st in the reposi
+00035a70: 746f 7279 0a20 2020 2020 2020 2020 2020  tory.           
+00035a80: 2069 6620 7368 6172 645f 7061 7468 5f69   if shard_path_i
+00035a90: 6e5f 7265 706f 206e 6f74 2069 6e20 6461  n_repo not in da
+00035aa0: 7461 5f66 696c 6573 3a0a 2020 2020 2020  ta_files:.      
+00035ab0: 2020 2020 2020 2020 2020 6275 6666 6572            buffer
+00035ac0: 203d 2042 7974 6573 494f 2829 0a20 2020   = BytesIO().   
+00035ad0: 2020 2020 2020 2020 2020 2020 2073 6861               sha
+00035ae0: 7264 2e74 6f5f 7061 7271 7565 7428 6275  rd.to_parquet(bu
+00035af0: 6666 6572 290a 2020 2020 2020 2020 2020  ffer).          
+00035b00: 2020 2020 2020 7570 6c6f 6164 6564 5f73        uploaded_s
+00035b10: 697a 6520 2b3d 2062 7566 6665 722e 7465  ize += buffer.te
+00035b20: 6c6c 2829 0a20 2020 2020 2020 2020 2020  ll().           
+00035b30: 2020 2020 205f 7265 7472 7928 0a20 2020       _retry(.   
+00035b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035b50: 2061 7069 2e75 706c 6f61 645f 6669 6c65   api.upload_file
+00035b60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00035b70: 2020 2020 2020 6675 6e63 5f6b 7761 7267        func_kwarg
+00035b80: 733d 6469 6374 280a 2020 2020 2020 2020  s=dict(.        
+00035b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035ba0: 7061 7468 5f6f 725f 6669 6c65 6f62 6a3d  path_or_fileobj=
+00035bb0: 6275 6666 6572 2e67 6574 7661 6c75 6528  buffer.getvalue(
+00035bc0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00035bd0: 2020 2020 2020 2020 2020 2070 6174 685f             path_
+00035be0: 696e 5f72 6570 6f3d 7368 6172 645f 7061  in_repo=shard_pa
+00035bf0: 7468 5f69 6e5f 7265 706f 2c0a 2020 2020  th_in_repo,.    
+00035c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035c10: 2020 2020 7265 706f 5f69 643d 7265 706f      repo_id=repo
+00035c20: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
+00035c30: 2020 2020 2020 2020 2020 2020 2074 6f6b               tok
+00035c40: 656e 3d74 6f6b 656e 2c0a 2020 2020 2020  en=token,.      
+00035c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035c60: 2020 7265 706f 5f74 7970 653d 2264 6174    repo_type="dat
+00035c70: 6173 6574 222c 0a20 2020 2020 2020 2020  aset",.         
+00035c80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00035c90: 6576 6973 696f 6e3d 6272 616e 6368 2c0a  evision=branch,.
+00035ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035cb0: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+00035cc0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00035cd0: 7469 6f6e 733d 4854 5450 4572 726f 722c  tions=HTTPError,
+00035ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035cf0: 2020 2020 2073 7461 7475 735f 636f 6465       status_code
+00035d00: 733d 5b35 3034 5d2c 0a20 2020 2020 2020  s=[504],.       
+00035d10: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+00035d20: 655f 7761 6974 5f74 696d 653d 322e 302c  e_wait_time=2.0,
+00035d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035d40: 2020 2020 206d 6178 5f72 6574 7269 6573       max_retries
+00035d50: 3d35 2c0a 2020 2020 2020 2020 2020 2020  =5,.            
+00035d60: 2020 2020 2020 2020 6d61 785f 7761 6974          max_wait
+00035d70: 5f74 696d 653d 3230 2e30 2c0a 2020 2020  _time=20.0,.    
+00035d80: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00035d90: 2020 2020 2020 2020 2020 7368 6172 6473            shards
+00035da0: 5f70 6174 685f 696e 5f72 6570 6f2e 6170  _path_in_repo.ap
+00035db0: 7065 6e64 2873 6861 7264 5f70 6174 685f  pend(shard_path_
+00035dc0: 696e 5f72 6570 6f29 0a0a 2020 2020 2020  in_repo)..      
+00035dd0: 2020 2320 436c 6561 6e75 7020 746f 2072    # Cleanup to r
+00035de0: 656d 6f76 6520 756e 7573 6564 2066 696c  emove unused fil
+00035df0: 6573 0a20 2020 2020 2020 2064 6174 615f  es.        data_
+00035e00: 6669 6c65 735f 746f 5f64 656c 6574 6520  files_to_delete 
+00035e10: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+00035e20: 6461 7461 5f66 696c 650a 2020 2020 2020  data_file.      
+00035e30: 2020 2020 2020 666f 7220 6461 7461 5f66        for data_f
+00035e40: 696c 6520 696e 2064 6174 615f 6669 6c65  ile in data_file
+00035e50: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
+00035e60: 2064 6174 615f 6669 6c65 2e73 7461 7274   data_file.start
+00035e70: 7377 6974 6828 6622 6461 7461 2f7b 7370  swith(f"data/{sp
+00035e80: 6c69 747d 2d22 2920 616e 6420 6461 7461  lit}-") and data
+00035e90: 5f66 696c 6520 6e6f 7420 696e 2073 6861  _file not in sha
+00035ea0: 7264 735f 7061 7468 5f69 6e5f 7265 706f  rds_path_in_repo
+00035eb0: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
+00035ec0: 2020 2064 656c 6574 6564 5f73 697a 6520     deleted_size 
+00035ed0: 3d20 7375 6d28 0a20 2020 2020 2020 2020  = sum(.         
+00035ee0: 2020 2078 6765 7473 697a 6528 6866 5f68     xgetsize(hf_h
+00035ef0: 7562 5f75 726c 2872 6570 6f5f 6964 2c20  ub_url(repo_id, 
+00035f00: 6461 7461 5f66 696c 6529 2c20 7573 655f  data_file), use_
+00035f10: 6175 7468 5f74 6f6b 656e 3d74 6f6b 656e  auth_token=token
+00035f20: 2920 666f 7220 6461 7461 5f66 696c 6520  ) for data_file 
+00035f30: 696e 2064 6174 615f 6669 6c65 735f 746f  in data_files_to
+00035f40: 5f64 656c 6574 650a 2020 2020 2020 2020  _delete.        
+00035f50: 290a 0a20 2020 2020 2020 2064 6566 2064  )..        def d
+00035f60: 656c 6574 655f 6669 6c65 2866 696c 6529  elete_file(file)
+00035f70: 3a0a 2020 2020 2020 2020 2020 2020 6170  :.            ap
+00035f80: 692e 6465 6c65 7465 5f66 696c 6528 6669  i.delete_file(fi
+00035f90: 6c65 2c20 7265 706f 5f69 643d 7265 706f  le, repo_id=repo
+00035fa0: 5f69 642c 2074 6f6b 656e 3d74 6f6b 656e  _id, token=token
+00035fb0: 2c20 7265 706f 5f74 7970 653d 2264 6174  , repo_type="dat
+00035fc0: 6173 6574 222c 2072 6576 6973 696f 6e3d  aset", revision=
+00035fd0: 6272 616e 6368 290a 0a20 2020 2020 2020  branch)..       
+00035fe0: 2069 6620 6c65 6e28 6461 7461 5f66 696c   if len(data_fil
+00035ff0: 6573 5f74 6f5f 6465 6c65 7465 293a 0a20  es_to_delete):. 
+00036000: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
+00036010: 6174 615f 6669 6c65 2069 6e20 6c6f 6767  ata_file in logg
+00036020: 696e 672e 7471 646d 280a 2020 2020 2020  ing.tqdm(.      
+00036030: 2020 2020 2020 2020 2020 6461 7461 5f66            data_f
+00036040: 696c 6573 5f74 6f5f 6465 6c65 7465 2c0a  iles_to_delete,.
+00036050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036060: 6465 7363 3d22 4465 6c65 7469 6e67 2075  desc="Deleting u
+00036070: 6e75 7365 6420 6669 6c65 7320 6672 6f6d  nused files from
+00036080: 2064 6174 6173 6574 2072 6570 6f73 6974   dataset reposit
+00036090: 6f72 7922 2c0a 2020 2020 2020 2020 2020  ory",.          
+000360a0: 2020 2020 2020 746f 7461 6c3d 6c65 6e28        total=len(
+000360b0: 6461 7461 5f66 696c 6573 5f74 6f5f 6465  data_files_to_de
+000360c0: 6c65 7465 292c 0a20 2020 2020 2020 2020  lete),.         
+000360d0: 2020 2020 2020 2064 6973 6162 6c65 3d6e         disable=n
+000360e0: 6f74 206c 6f67 6769 6e67 2e69 735f 7072  ot logging.is_pr
+000360f0: 6f67 7265 7373 5f62 6172 5f65 6e61 626c  ogress_bar_enabl
+00036100: 6564 2829 2c0a 2020 2020 2020 2020 2020  ed(),.          
+00036110: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00036120: 2020 2020 2064 656c 6574 655f 6669 6c65       delete_file
+00036130: 2864 6174 615f 6669 6c65 290a 0a20 2020  (data_file)..   
+00036140: 2020 2020 2072 6570 6f5f 6669 6c65 7320       repo_files 
+00036150: 3d20 6c69 7374 2873 6574 2866 696c 6573  = list(set(files
+00036160: 2920 2d20 7365 7428 6461 7461 5f66 696c  ) - set(data_fil
+00036170: 6573 5f74 6f5f 6465 6c65 7465 2929 0a0a  es_to_delete))..
+00036180: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00036190: 6570 6f5f 6964 2c20 7370 6c69 742c 2075  epo_id, split, u
+000361a0: 706c 6f61 6465 645f 7369 7a65 2c20 6461  ploaded_size, da
+000361b0: 7461 7365 745f 6e62 7974 6573 2c20 7265  taset_nbytes, re
+000361c0: 706f 5f66 696c 6573 2c20 6465 6c65 7465  po_files, delete
+000361d0: 645f 7369 7a65 0a0a 2020 2020 6465 6620  d_size..    def 
+000361e0: 7075 7368 5f74 6f5f 6875 6228 0a20 2020  push_to_hub(.   
+000361f0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00036200: 2020 2072 6570 6f5f 6964 3a20 7374 722c     repo_id: str,
+00036210: 0a20 2020 2020 2020 2073 706c 6974 3a20  .        split: 
+00036220: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00036230: 4e6f 6e65 2c0a 2020 2020 2020 2020 7072  None,.        pr
+00036240: 6976 6174 653a 204f 7074 696f 6e61 6c5b  ivate: Optional[
+00036250: 626f 6f6c 5d20 3d20 4661 6c73 652c 0a20  bool] = False,. 
+00036260: 2020 2020 2020 2074 6f6b 656e 3a20 4f70         token: Op
+00036270: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+00036280: 6e65 2c0a 2020 2020 2020 2020 6272 616e  ne,.        bran
+00036290: 6368 3a20 4f70 7469 6f6e 616c 5b73 7472  ch: Optional[str
+000362a0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+000362b0: 2020 6d61 785f 7368 6172 645f 7369 7a65    max_shard_size
+000362c0: 3a20 4f70 7469 6f6e 616c 5b55 6e69 6f6e  : Optional[Union
+000362d0: 5b69 6e74 2c20 7374 725d 5d20 3d20 4e6f  [int, str]] = No
+000362e0: 6e65 2c0a 2020 2020 2020 2020 6e75 6d5f  ne,.        num_
+000362f0: 7368 6172 6473 3a20 4f70 7469 6f6e 616c  shards: Optional
+00036300: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
+00036310: 2020 2020 2020 656d 6265 645f 6578 7465        embed_exte
+00036320: 726e 616c 5f66 696c 6573 3a20 626f 6f6c  rnal_files: bool
+00036330: 203d 2054 7275 652c 0a20 2020 2029 3a0a   = True,.    ):.
+00036340: 2020 2020 2020 2020 2222 2250 7573 6865          """Pushe
+00036350: 7320 7468 6520 6461 7461 7365 7420 746f  s the dataset to
+00036360: 2074 6865 2068 7562 2061 7320 6120 5061   the hub as a Pa
+00036370: 7271 7565 7420 6461 7461 7365 742e 0a20  rquet dataset.. 
+00036380: 2020 2020 2020 2054 6865 2064 6174 6173         The datas
+00036390: 6574 2069 7320 7075 7368 6564 2075 7369  et is pushed usi
+000363a0: 6e67 2048 5454 5020 7265 7175 6573 7473  ng HTTP requests
+000363b0: 2061 6e64 2064 6f65 7320 6e6f 7420 6e65   and does not ne
+000363c0: 6564 2074 6f20 6861 7665 206e 6569 7468  ed to have neith
+000363d0: 6572 2067 6974 206f 7220 6769 742d 6c66  er git or git-lf
+000363e0: 7320 696e 7374 616c 6c65 642e 0a0a 2020  s installed...  
+000363f0: 2020 2020 2020 5468 6520 7265 7375 6c74        The result
+00036400: 696e 6720 5061 7271 7565 7420 6669 6c65  ing Parquet file
+00036410: 7320 6172 6520 7365 6c66 2d63 6f6e 7461  s are self-conta
+00036420: 696e 6564 2062 7920 6465 6661 756c 742e  ined by default.
+00036430: 2049 6620 796f 7572 2064 6174 6173 6574   If your dataset
+00036440: 2063 6f6e 7461 696e 7320 5b60 496d 6167   contains [`Imag
+00036450: 6560 5d20 6f72 205b 6041 7564 696f 605d  e`] or [`Audio`]
+00036460: 0a20 2020 2020 2020 2064 6174 612c 2074  .        data, t
+00036470: 6865 2050 6172 7175 6574 2066 696c 6573  he Parquet files
+00036480: 2077 696c 6c20 7374 6f72 6520 7468 6520   will store the 
+00036490: 6279 7465 7320 6f66 2079 6f75 7220 696d  bytes of your im
+000364a0: 6167 6573 206f 7220 6175 6469 6f20 6669  ages or audio fi
+000364b0: 6c65 732e 0a20 2020 2020 2020 2059 6f75  les..        You
+000364c0: 2063 616e 2064 6973 6162 6c65 2074 6869   can disable thi
+000364d0: 7320 6279 2073 6574 7469 6e67 2060 656d  s by setting `em
+000364e0: 6265 645f 6578 7465 726e 616c 5f66 696c  bed_external_fil
+000364f0: 6573 6020 746f 2060 4661 6c73 6560 2e0a  es` to `False`..
+00036500: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00036510: 2020 2020 2020 2020 2020 2072 6570 6f5f             repo_
+00036520: 6964 2028 6073 7472 6029 3a0a 2020 2020  id (`str`):.    
+00036530: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+00036540: 4944 206f 6620 7468 6520 7265 706f 7369  ID of the reposi
+00036550: 746f 7279 2074 6f20 7075 7368 2074 6f20  tory to push to 
+00036560: 696e 2074 6865 2066 6f6c 6c6f 7769 6e67  in the following
+00036570: 2066 6f72 6d61 743a 2060 3c75 7365 723e   format: `<user>
+00036580: 2f3c 6461 7461 7365 745f 6e61 6d65 3e60  /<dataset_name>`
+00036590: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
+000365a0: 2020 2020 603c 6f72 673e 2f3c 6461 7461      `<org>/<data
+000365b0: 7365 745f 6e61 6d65 3e60 2e20 416c 736f  set_name>`. Also
+000365c0: 2061 6363 6570 7473 2060 3c64 6174 6173   accepts `<datas
+000365d0: 6574 5f6e 616d 653e 602c 2077 6869 6368  et_name>`, which
+000365e0: 2077 696c 6c20 6465 6661 756c 7420 746f   will default to
+000365f0: 2074 6865 206e 616d 6573 7061 6365 0a20   the namespace. 
+00036600: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00036610: 6620 7468 6520 6c6f 6767 6564 2d69 6e20  f the logged-in 
+00036620: 7573 6572 2e0a 2020 2020 2020 2020 2020  user..          
+00036630: 2020 7370 6c69 7420 2860 7374 7260 2c20    split (`str`, 
+00036640: 2a6f 7074 696f 6e61 6c2a 293a 0a20 2020  *optional*):.   
+00036650: 2020 2020 2020 2020 2020 2020 2054 6865               The
+00036660: 206e 616d 6520 6f66 2074 6865 2073 706c   name of the spl
+00036670: 6974 2074 6861 7420 7769 6c6c 2062 6520  it that will be 
+00036680: 6769 7665 6e20 746f 2074 6861 7420 6461  given to that da
+00036690: 7461 7365 742e 2044 6566 6175 6c74 7320  taset. Defaults 
+000366a0: 746f 2060 7365 6c66 2e73 706c 6974 602e  to `self.split`.
+000366b0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+000366c0: 7661 7465 2028 6062 6f6f 6c60 2c20 2a6f  vate (`bool`, *o
+000366d0: 7074 696f 6e61 6c2a 2c20 6465 6661 756c  ptional*, defaul
+000366e0: 7473 2074 6f20 6046 616c 7365 6029 3a0a  ts to `False`):.
+000366f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036700: 5768 6574 6865 7220 7468 6520 6461 7461  Whether the data
+00036710: 7365 7420 7265 706f 7369 746f 7279 2073  set repository s
+00036720: 686f 756c 6420 6265 2073 6574 2074 6f20  hould be set to 
+00036730: 7072 6976 6174 6520 6f72 206e 6f74 2e20  private or not. 
+00036740: 4f6e 6c79 2061 6666 6563 7473 2072 6570  Only affects rep
+00036750: 6f73 6974 6f72 7920 6372 6561 7469 6f6e  ository creation
+00036760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00036770: 2020 6120 7265 706f 7369 746f 7279 2074    a repository t
+00036780: 6861 7420 616c 7265 6164 7920 6578 6973  hat already exis
+00036790: 7473 2077 696c 6c20 6e6f 7420 6265 2061  ts will not be a
+000367a0: 6666 6563 7465 6420 6279 2074 6861 7420  ffected by that 
+000367b0: 7061 7261 6d65 7465 722e 0a20 2020 2020  parameter..     
+000367c0: 2020 2020 2020 2074 6f6b 656e 2028 6073         token (`s
+000367d0: 7472 602c 202a 6f70 7469 6f6e 616c 2a29  tr`, *optional*)
+000367e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000367f0: 2020 416e 206f 7074 696f 6e61 6c20 6175    An optional au
+00036800: 7468 656e 7469 6361 7469 6f6e 2074 6f6b  thentication tok
+00036810: 656e 2066 6f72 2074 6865 2048 7567 6769  en for the Huggi
+00036820: 6e67 2046 6163 6520 4875 622e 2049 6620  ng Face Hub. If 
+00036830: 6e6f 2074 6f6b 656e 2069 7320 7061 7373  no token is pass
+00036840: 6564 2c20 7769 6c6c 2064 6566 6175 6c74  ed, will default
+00036850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036860: 2074 6f20 7468 6520 746f 6b65 6e20 7361   to the token sa
+00036870: 7665 6420 6c6f 6361 6c6c 7920 7768 656e  ved locally when
+00036880: 206c 6f67 6769 6e67 2069 6e20 7769 7468   logging in with
+00036890: 2060 6875 6767 696e 6766 6163 652d 636c   `huggingface-cl
+000368a0: 6920 6c6f 6769 6e60 2e20 5769 6c6c 2072  i login`. Will r
+000368b0: 6169 7365 2061 6e20 6572 726f 720a 2020  aise an error.  
+000368c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000368d0: 206e 6f20 746f 6b65 6e20 6973 2070 6173   no token is pas
+000368e0: 7365 6420 616e 6420 7468 6520 7573 6572  sed and the user
+000368f0: 2069 7320 6e6f 7420 6c6f 6767 6564 2d69   is not logged-i
+00036900: 6e2e 0a20 2020 2020 2020 2020 2020 2062  n..            b
+00036910: 7261 6e63 6820 2860 7374 7260 2c20 2a6f  ranch (`str`, *o
+00036920: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
+00036930: 2020 2020 2020 2020 2020 2054 6865 2067             The g
+00036940: 6974 2062 7261 6e63 6820 6f6e 2077 6869  it branch on whi
+00036950: 6368 2074 6f20 7075 7368 2074 6865 2064  ch to push the d
+00036960: 6174 6173 6574 2e20 5468 6973 2064 6566  ataset. This def
+00036970: 6175 6c74 7320 746f 2074 6865 2064 6566  aults to the def
+00036980: 6175 6c74 2062 7261 6e63 6820 6173 2073  ault branch as s
+00036990: 7065 6369 6669 6564 0a20 2020 2020 2020  pecified.       
+000369a0: 2020 2020 2020 2020 2069 6e20 796f 7572           in your
+000369b0: 2072 6570 6f73 6974 6f72 792c 2077 6869   repository, whi
+000369c0: 6368 2064 6566 6175 6c74 7320 746f 2060  ch defaults to `
+000369d0: 226d 6169 6e22 602e 0a20 2020 2020 2020  "main"`..       
+000369e0: 2020 2020 206d 6178 5f73 6861 7264 5f73       max_shard_s
+000369f0: 697a 6520 2860 696e 7460 206f 7220 6073  ize (`int` or `s
+00036a00: 7472 602c 202a 6f70 7469 6f6e 616c 2a2c  tr`, *optional*,
+00036a10: 2064 6566 6175 6c74 7320 746f 2060 2235   defaults to `"5
+00036a20: 3030 4d42 2260 293a 0a20 2020 2020 2020  00MB"`):.       
+00036a30: 2020 2020 2020 2020 2054 6865 206d 6178           The max
+00036a40: 696d 756d 2073 697a 6520 6f66 2074 6865  imum size of the
+00036a50: 2064 6174 6173 6574 2073 6861 7264 7320   dataset shards 
+00036a60: 746f 2062 6520 7570 6c6f 6164 6564 2074  to be uploaded t
+00036a70: 6f20 7468 6520 6875 622e 2049 6620 6578  o the hub. If ex
+00036a80: 7072 6573 7365 6420 6173 2061 2073 7472  pressed as a str
+00036a90: 696e 672c 206e 6565 6473 2074 6f20 6265  ing, needs to be
+00036aa0: 2064 6967 6974 7320 666f 6c6c 6f77 6564   digits followed
+00036ab0: 2062 790a 2020 2020 2020 2020 2020 2020   by.            
+00036ac0: 2020 2020 6120 756e 6974 2028 6c69 6b65      a unit (like
+00036ad0: 2060 2235 4d42 2260 292e 0a20 2020 2020   `"5MB"`)..     
+00036ae0: 2020 2020 2020 206e 756d 5f73 6861 7264         num_shard
+00036af0: 7320 2860 696e 7460 2c20 2a6f 7074 696f  s (`int`, *optio
+00036b00: 6e61 6c2a 293a 204e 756d 6265 7220 6f66  nal*): Number of
+00036b10: 2073 6861 7264 7320 746f 2077 7269 7465   shards to write
+00036b20: 2e20 4279 2064 6566 6175 6c74 2074 6865  . By default the
+00036b30: 206e 756d 6265 7220 6f66 2073 6861 7264   number of shard
+00036b40: 7320 6465 7065 6e64 7320 6f6e 2060 6d61  s depends on `ma
+00036b50: 785f 7368 6172 645f 7369 7a65 602e 0a0a  x_shard_size`...
+00036b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036b70: 3c41 6464 6564 2076 6572 7369 6f6e 3d22  <Added version="
+00036b80: 322e 382e 3022 2f3e 0a20 2020 2020 2020  2.8.0"/>.       
+00036b90: 2020 2020 2065 6d62 6564 5f65 7874 6572       embed_exter
+00036ba0: 6e61 6c5f 6669 6c65 7320 2860 626f 6f6c  nal_files (`bool
+00036bb0: 602c 2064 6566 6175 6c74 7320 746f 2060  `, defaults to `
+00036bc0: 5472 7565 6029 3a0a 2020 2020 2020 2020  True`):.        
+00036bd0: 2020 2020 2020 2020 5768 6574 6865 7220          Whether 
+00036be0: 746f 2065 6d62 6564 2066 696c 6520 6279  to embed file by
+00036bf0: 7465 7320 696e 2074 6865 2073 6861 7264  tes in the shard
+00036c00: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
+00036c10: 2020 2049 6e20 7061 7274 6963 756c 6172     In particular
+00036c20: 2c20 7468 6973 2077 696c 6c20 646f 2074  , this will do t
+00036c30: 6865 2066 6f6c 6c6f 7769 6e67 2062 6566  he following bef
+00036c40: 6f72 6520 7468 6520 7075 7368 2066 6f72  ore the push for
+00036c50: 2074 6865 2066 6965 6c64 7320 6f66 2074   the fields of t
+00036c60: 7970 653a 0a0a 2020 2020 2020 2020 2020  ype:..          
+00036c70: 2020 2020 2020 2d20 5b60 4175 6469 6f60        - [`Audio`
+00036c80: 5d20 616e 6420 5b60 496d 6167 6560 5d3a  ] and [`Image`]:
+00036c90: 2072 656d 6f76 6520 6c6f 6361 6c20 7061   remove local pa
+00036ca0: 7468 2069 6e66 6f72 6d61 7469 6f6e 2061  th information a
+00036cb0: 6e64 2065 6d62 6564 2066 696c 6520 636f  nd embed file co
+00036cc0: 6e74 656e 7420 696e 2074 6865 2050 6172  ntent in the Par
+00036cd0: 7175 6574 2066 696c 6573 2e0a 0a20 2020  quet files...   
+00036ce0: 2020 2020 2045 7861 6d70 6c65 3a0a 0a20       Example:.. 
+00036cf0: 2020 2020 2020 2060 6060 7079 7468 6f6e         ```python
+00036d00: 0a20 2020 2020 2020 203e 3e3e 2064 6174  .        >>> dat
+00036d10: 6173 6574 2e70 7573 685f 746f 5f68 7562  aset.push_to_hub
+00036d20: 2822 3c6f 7267 616e 697a 6174 696f 6e3e  ("<organization>
+00036d30: 2f3c 6461 7461 7365 745f 6964 3e22 290a  /<dataset_id>").
+00036d40: 2020 2020 2020 2020 3e3e 3e20 6461 7461          >>> data
+00036d50: 7365 742e 7075 7368 5f74 6f5f 6875 6228  set.push_to_hub(
+00036d60: 223c 6f72 6761 6e69 7a61 7469 6f6e 3e2f  "<organization>/
+00036d70: 3c64 6174 6173 6574 5f69 643e 222c 2073  <dataset_id>", s
+00036d80: 706c 6974 3d22 7661 6c69 6461 7469 6f6e  plit="validation
+00036d90: 2229 0a20 2020 2020 2020 203e 3e3e 2064  ").        >>> d
+00036da0: 6174 6173 6574 2e70 7573 685f 746f 5f68  ataset.push_to_h
+00036db0: 7562 2822 3c6f 7267 616e 697a 6174 696f  ub("<organizatio
+00036dc0: 6e3e 2f3c 6461 7461 7365 745f 6964 3e22  n>/<dataset_id>"
+00036dd0: 2c20 6d61 785f 7368 6172 645f 7369 7a65  , max_shard_size
+00036de0: 3d22 3147 4222 290a 2020 2020 2020 2020  ="1GB").        
+00036df0: 3e3e 3e20 6461 7461 7365 742e 7075 7368  >>> dataset.push
+00036e00: 5f74 6f5f 6875 6228 223c 6f72 6761 6e69  _to_hub("<organi
+00036e10: 7a61 7469 6f6e 3e2f 3c64 6174 6173 6574  zation>/<dataset
+00036e20: 5f69 643e 222c 206e 756d 5f73 6861 7264  _id>", num_shard
+00036e30: 733d 3130 3234 290a 2020 2020 2020 2020  s=1024).        
+00036e40: 6060 600a 2020 2020 2020 2020 2222 220a  ```.        """.
+00036e50: 2020 2020 2020 2020 6966 206d 6178 5f73          if max_s
+00036e60: 6861 7264 5f73 697a 6520 6973 206e 6f74  hard_size is not
+00036e70: 204e 6f6e 6520 616e 6420 6e75 6d5f 7368   None and num_sh
+00036e80: 6172 6473 2069 7320 6e6f 7420 4e6f 6e65  ards is not None
+00036e90: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00036ea0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+00036eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036ec0: 2246 6169 6c65 6420 746f 2070 7573 685f  "Failed to push_
+00036ed0: 746f 5f68 7562 3a20 706c 6561 7365 2073  to_hub: please s
+00036ee0: 7065 6369 6679 2065 6974 6865 7220 6d61  pecify either ma
+00036ef0: 785f 7368 6172 645f 7369 7a65 206f 7220  x_shard_size or 
+00036f00: 6e75 6d5f 7368 6172 6473 2c20 6275 7420  num_shards, but 
+00036f10: 6e6f 7420 626f 7468 2e22 0a20 2020 2020  not both.".     
+00036f20: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00036f30: 2020 7265 706f 5f69 642c 2073 706c 6974    repo_id, split
+00036f40: 2c20 7570 6c6f 6164 6564 5f73 697a 652c  , uploaded_size,
+00036f50: 2064 6174 6173 6574 5f6e 6279 7465 732c   dataset_nbytes,
+00036f60: 2072 6570 6f5f 6669 6c65 732c 2064 656c   repo_files, del
+00036f70: 6574 6564 5f73 697a 6520 3d20 7365 6c66  eted_size = self
+00036f80: 2e5f 7075 7368 5f70 6172 7175 6574 5f73  ._push_parquet_s
+00036f90: 6861 7264 735f 746f 5f68 7562 280a 2020  hards_to_hub(.  
+00036fa0: 2020 2020 2020 2020 2020 7265 706f 5f69            repo_i
+00036fb0: 643d 7265 706f 5f69 642c 0a20 2020 2020  d=repo_id,.     
+00036fc0: 2020 2020 2020 2073 706c 6974 3d73 706c         split=spl
+00036fd0: 6974 2c0a 2020 2020 2020 2020 2020 2020  it,.            
+00036fe0: 7072 6976 6174 653d 7072 6976 6174 652c  private=private,
+00036ff0: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
+00037000: 656e 3d74 6f6b 656e 2c0a 2020 2020 2020  en=token,.      
+00037010: 2020 2020 2020 6272 616e 6368 3d62 7261        branch=bra
+00037020: 6e63 682c 0a20 2020 2020 2020 2020 2020  nch,.           
+00037030: 206d 6178 5f73 6861 7264 5f73 697a 653d   max_shard_size=
+00037040: 6d61 785f 7368 6172 645f 7369 7a65 2c0a  max_shard_size,.
+00037050: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+00037060: 7368 6172 6473 3d6e 756d 5f73 6861 7264  shards=num_shard
+00037070: 732c 0a20 2020 2020 2020 2020 2020 2065  s,.            e
+00037080: 6d62 6564 5f65 7874 6572 6e61 6c5f 6669  mbed_external_fi
+00037090: 6c65 733d 656d 6265 645f 6578 7465 726e  les=embed_extern
+000370a0: 616c 5f66 696c 6573 2c0a 2020 2020 2020  al_files,.      
+000370b0: 2020 290a 2020 2020 2020 2020 6f72 6761    ).        orga
+000370c0: 6e69 7a61 7469 6f6e 2c20 6461 7461 7365  nization, datase
+000370d0: 745f 6e61 6d65 203d 2072 6570 6f5f 6964  t_name = repo_id
+000370e0: 2e73 706c 6974 2822 2f22 290a 2020 2020  .split("/").    
+000370f0: 2020 2020 696e 666f 5f74 6f5f 6475 6d70      info_to_dump
+00037100: 203d 2073 656c 662e 696e 666f 2e63 6f70   = self.info.cop
+00037110: 7928 290a 2020 2020 2020 2020 696e 666f  y().        info
+00037120: 5f74 6f5f 6475 6d70 2e64 6f77 6e6c 6f61  _to_dump.downloa
+00037130: 645f 6368 6563 6b73 756d 7320 3d20 4e6f  d_checksums = No
+00037140: 6e65 0a20 2020 2020 2020 2069 6e66 6f5f  ne.        info_
+00037150: 746f 5f64 756d 702e 646f 776e 6c6f 6164  to_dump.download
+00037160: 5f73 697a 6520 3d20 7570 6c6f 6164 6564  _size = uploaded
+00037170: 5f73 697a 650a 2020 2020 2020 2020 696e  _size.        in
+00037180: 666f 5f74 6f5f 6475 6d70 2e64 6174 6173  fo_to_dump.datas
+00037190: 6574 5f73 697a 6520 3d20 6461 7461 7365  et_size = datase
+000371a0: 745f 6e62 7974 6573 0a20 2020 2020 2020  t_nbytes.       
+000371b0: 2069 6e66 6f5f 746f 5f64 756d 702e 7369   info_to_dump.si
+000371c0: 7a65 5f69 6e5f 6279 7465 7320 3d20 7570  ze_in_bytes = up
+000371d0: 6c6f 6164 6564 5f73 697a 6520 2b20 6461  loaded_size + da
+000371e0: 7461 7365 745f 6e62 7974 6573 0a20 2020  taset_nbytes.   
+000371f0: 2020 2020 2069 6e66 6f5f 746f 5f64 756d       info_to_dum
+00037200: 702e 7370 6c69 7473 203d 2053 706c 6974  p.splits = Split
+00037210: 4469 6374 280a 2020 2020 2020 2020 2020  Dict(.          
+00037220: 2020 7b73 706c 6974 3a20 5370 6c69 7449    {split: SplitI
+00037230: 6e66 6f28 7370 6c69 742c 206e 756d 5f62  nfo(split, num_b
+00037240: 7974 6573 3d64 6174 6173 6574 5f6e 6279  ytes=dataset_nby
+00037250: 7465 732c 206e 756d 5f65 7861 6d70 6c65  tes, num_example
+00037260: 733d 6c65 6e28 7365 6c66 292c 2064 6174  s=len(self), dat
+00037270: 6173 6574 5f6e 616d 653d 6461 7461 7365  aset_name=datase
+00037280: 745f 6e61 6d65 297d 0a20 2020 2020 2020  t_name)}.       
+00037290: 2029 0a20 2020 2020 2020 2023 2067 6574   ).        # get
+000372a0: 2074 6865 2069 6e66 6f20 6672 6f6d 2074   the info from t
+000372b0: 6865 2052 4541 444d 4520 746f 2075 7064  he README to upd
+000372c0: 6174 6520 7468 656d 0a20 2020 2020 2020  ate them.       
+000372d0: 2069 6620 2252 4541 444d 452e 6d64 2220   if "README.md" 
+000372e0: 696e 2072 6570 6f5f 6669 6c65 733a 0a20  in repo_files:. 
+000372f0: 2020 2020 2020 2020 2020 2064 6f77 6e6c             downl
+00037300: 6f61 645f 636f 6e66 6967 203d 2044 6f77  oad_config = Dow
+00037310: 6e6c 6f61 6443 6f6e 6669 6728 290a 2020  nloadConfig().  
+00037320: 2020 2020 2020 2020 2020 646f 776e 6c6f            downlo
+00037330: 6164 5f63 6f6e 6669 672e 646f 776e 6c6f  ad_config.downlo
+00037340: 6164 5f64 6573 6320 3d20 2244 6f77 6e6c  ad_desc = "Downl
+00037350: 6f61 6469 6e67 206d 6574 6164 6174 6122  oading metadata"
+00037360: 0a20 2020 2020 2020 2020 2020 2064 6f77  .            dow
+00037370: 6e6c 6f61 645f 636f 6e66 6967 2e75 7365  nload_config.use
+00037380: 5f61 7574 685f 746f 6b65 6e20 3d20 746f  _auth_token = to
+00037390: 6b65 6e0a 2020 2020 2020 2020 2020 2020  ken.            
+000373a0: 6461 7461 7365 745f 7265 6164 6d65 5f70  dataset_readme_p
+000373b0: 6174 6820 3d20 6361 6368 6564 5f70 6174  ath = cached_pat
+000373c0: 6828 0a20 2020 2020 2020 2020 2020 2020  h(.             
+000373d0: 2020 2068 665f 6875 625f 7572 6c28 7265     hf_hub_url(re
+000373e0: 706f 5f69 642c 2022 5245 4144 4d45 2e6d  po_id, "README.m
+000373f0: 6422 292c 0a20 2020 2020 2020 2020 2020  d"),.           
+00037400: 2020 2020 2064 6f77 6e6c 6f61 645f 636f       download_co
+00037410: 6e66 6967 3d64 6f77 6e6c 6f61 645f 636f  nfig=download_co
+00037420: 6e66 6967 2c0a 2020 2020 2020 2020 2020  nfig,.          
+00037430: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00037440: 6461 7461 7365 745f 6d65 7461 6461 7461  dataset_metadata
+00037450: 203d 2044 6174 6173 6574 4d65 7461 6461   = DatasetMetada
+00037460: 7461 2e66 726f 6d5f 7265 6164 6d65 2850  ta.from_readme(P
+00037470: 6174 6828 6461 7461 7365 745f 7265 6164  ath(dataset_read
+00037480: 6d65 5f70 6174 6829 290a 2020 2020 2020  me_path)).      
+00037490: 2020 2020 2020 6461 7461 7365 745f 696e        dataset_in
+000374a0: 666f 733a 2044 6174 6173 6574 496e 666f  fos: DatasetInfo
+000374b0: 7344 6963 7420 3d20 4461 7461 7365 7449  sDict = DatasetI
+000374c0: 6e66 6f73 4469 6374 2e66 726f 6d5f 6d65  nfosDict.from_me
+000374d0: 7461 6461 7461 2864 6174 6173 6574 5f6d  tadata(dataset_m
+000374e0: 6574 6164 6174 6129 0a20 2020 2020 2020  etadata).       
+000374f0: 2020 2020 2072 6570 6f5f 696e 666f 203d       repo_info =
+00037500: 2064 6174 6173 6574 5f69 6e66 6f73 5b6e   dataset_infos[n
+00037510: 6578 7428 6974 6572 2864 6174 6173 6574  ext(iter(dataset
+00037520: 5f69 6e66 6f73 2929 5d0a 2020 2020 2020  _infos))].      
+00037530: 2020 2320 6765 7420 7468 6520 6465 7072    # get the depr
+00037540: 6563 6174 6564 2064 6174 6173 6574 5f69  ecated dataset_i
+00037550: 6e66 6f73 2e6a 736f 6e20 746f 2075 6f64  nfos.json to uod
+00037560: 6174 6520 7468 656d 0a20 2020 2020 2020  ate them.       
+00037570: 2065 6c69 6620 636f 6e66 6967 2e44 4154   elif config.DAT
+00037580: 4153 4554 4449 4354 5f49 4e46 4f53 5f46  ASETDICT_INFOS_F
+00037590: 494c 454e 414d 4520 696e 2072 6570 6f5f  ILENAME in repo_
+000375a0: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
+000375b0: 2020 2064 6174 6173 6574 5f6d 6574 6164     dataset_metad
+000375c0: 6174 6120 3d20 4461 7461 7365 744d 6574  ata = DatasetMet
+000375d0: 6164 6174 6128 290a 2020 2020 2020 2020  adata().        
+000375e0: 2020 2020 646f 776e 6c6f 6164 5f63 6f6e      download_con
+000375f0: 6669 6720 3d20 446f 776e 6c6f 6164 436f  fig = DownloadCo
+00037600: 6e66 6967 2829 0a20 2020 2020 2020 2020  nfig().         
+00037610: 2020 2064 6f77 6e6c 6f61 645f 636f 6e66     download_conf
+00037620: 6967 2e64 6f77 6e6c 6f61 645f 6465 7363  ig.download_desc
+00037630: 203d 2022 446f 776e 6c6f 6164 696e 6720   = "Downloading 
+00037640: 6d65 7461 6461 7461 220a 2020 2020 2020  metadata".      
+00037650: 2020 2020 2020 646f 776e 6c6f 6164 5f63        download_c
+00037660: 6f6e 6669 672e 7573 655f 6175 7468 5f74  onfig.use_auth_t
+00037670: 6f6b 656e 203d 2074 6f6b 656e 0a20 2020  oken = token.   
+00037680: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
+00037690: 5f69 6e66 6f73 5f70 6174 6820 3d20 6361  _infos_path = ca
+000376a0: 6368 6564 5f70 6174 6828 0a20 2020 2020  ched_path(.     
+000376b0: 2020 2020 2020 2020 2020 2068 665f 6875             hf_hu
+000376c0: 625f 7572 6c28 7265 706f 5f69 642c 2063  b_url(repo_id, c
+000376d0: 6f6e 6669 672e 4441 5441 5345 5444 4943  onfig.DATASETDIC
+000376e0: 545f 494e 464f 535f 4649 4c45 4e41 4d45  T_INFOS_FILENAME
+000376f0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00037700: 2020 2064 6f77 6e6c 6f61 645f 636f 6e66     download_conf
+00037710: 6967 3d64 6f77 6e6c 6f61 645f 636f 6e66  ig=download_conf
+00037720: 6967 2c0a 2020 2020 2020 2020 2020 2020  ig,.            
+00037730: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
+00037740: 7468 206f 7065 6e28 6461 7461 7365 745f  th open(dataset_
+00037750: 696e 666f 735f 7061 7468 2c20 656e 636f  infos_path, enco
+00037760: 6469 6e67 3d22 7574 662d 3822 2920 6173  ding="utf-8") as
+00037770: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+00037780: 2020 2020 6461 7461 7365 745f 696e 666f      dataset_info
+00037790: 733a 2044 6174 6173 6574 496e 666f 7344  s: DatasetInfosD
+000377a0: 6963 7420 3d20 6a73 6f6e 2e6c 6f61 6428  ict = json.load(
+000377b0: 6629 0a20 2020 2020 2020 2020 2020 2020  f).             
+000377c0: 2020 2072 6570 6f5f 696e 666f 203d 2044     repo_info = D
+000377d0: 6174 6173 6574 496e 666f 2e66 726f 6d5f  atasetInfo.from_
+000377e0: 6469 6374 2864 6174 6173 6574 5f69 6e66  dict(dataset_inf
+000377f0: 6f73 5b6e 6578 7428 6974 6572 2864 6174  os[next(iter(dat
+00037800: 6173 6574 5f69 6e66 6f73 2929 5d29 0a20  aset_infos))]). 
+00037810: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00037820: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
+00037830: 5f6d 6574 6164 6174 6120 3d20 4461 7461  _metadata = Data
+00037840: 7365 744d 6574 6164 6174 6128 290a 2020  setMetadata().  
+00037850: 2020 2020 2020 2020 2020 7265 706f 5f69            repo_i
+00037860: 6e66 6f20 3d20 4e6f 6e65 0a20 2020 2020  nfo = None.     
+00037870: 2020 2023 2075 7064 6174 6520 7468 6520     # update the 
+00037880: 746f 7461 6c20 696e 666f 2074 6f20 6475  total info to du
+00037890: 6d70 2066 726f 6d20 6578 6973 7469 6e67  mp from existing
+000378a0: 2069 6e66 6f0a 2020 2020 2020 2020 6966   info.        if
+000378b0: 2072 6570 6f5f 696e 666f 2069 7320 6e6f   repo_info is no
+000378c0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000378d0: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
+000378e0: 6e67 2822 5570 6461 7469 6e67 2064 6f77  ng("Updating dow
+000378f0: 6e6c 6f61 6465 6420 6d65 7461 6461 7461  nloaded metadata
+00037900: 2077 6974 6820 7468 6520 6e65 7720 7370   with the new sp
+00037910: 6c69 742e 2229 0a20 2020 2020 2020 2020  lit.").         
+00037920: 2020 2069 6620 7265 706f 5f69 6e66 6f2e     if repo_info.
+00037930: 7370 6c69 7473 2061 6e64 206c 6973 7428  splits and list(
+00037940: 7265 706f 5f69 6e66 6f2e 7370 6c69 7473  repo_info.splits
+00037950: 2920 213d 205b 7370 6c69 745d 3a0a 2020  ) != [split]:.  
+00037960: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00037970: 2073 656c 662e 6665 6174 7572 6573 2021   self.features !
+00037980: 3d20 7265 706f 5f69 6e66 6f2e 6665 6174  = repo_info.feat
+00037990: 7572 6573 3a0a 2020 2020 2020 2020 2020  ures:.          
+000379a0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000379b0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+000379c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000379d0: 2020 2020 6622 4665 6174 7572 6573 206f      f"Features o
+000379e0: 6620 7468 6520 6e65 7720 7370 6c69 7420  f the new split 
+000379f0: 646f 6e27 7420 6d61 7463 6820 7468 6520  don't match the 
+00037a00: 6665 6174 7572 6573 206f 6620 7468 6520  features of the 
+00037a10: 6578 6973 7469 6e67 2073 706c 6974 7320  existing splits 
+00037a20: 6f6e 2074 6865 2068 7562 3a20 7b73 656c  on the hub: {sel
+00037a30: 662e 6665 6174 7572 6573 7d20 213d 207b  f.features} != {
+00037a40: 7265 706f 5f69 6e66 6f2e 6665 6174 7572  repo_info.featur
+00037a50: 6573 7d22 0a20 2020 2020 2020 2020 2020  es}".           
+00037a60: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00037a70: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00037a80: 706c 6974 2069 6e20 7265 706f 5f69 6e66  plit in repo_inf
+00037a90: 6f2e 7370 6c69 7473 3a0a 2020 2020 2020  o.splits:.      
+00037aa0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00037ab0: 706f 5f69 6e66 6f2e 646f 776e 6c6f 6164  po_info.download
+00037ac0: 5f73 697a 6520 2d3d 2064 656c 6574 6564  _size -= deleted
+00037ad0: 5f73 697a 650a 2020 2020 2020 2020 2020  _size.          
+00037ae0: 2020 2020 2020 2020 2020 7265 706f 5f69            repo_i
+00037af0: 6e66 6f2e 6461 7461 7365 745f 7369 7a65  nfo.dataset_size
+00037b00: 202d 3d20 7265 706f 5f69 6e66 6f2e 7370   -= repo_info.sp
+00037b10: 6c69 7473 2e67 6574 2873 706c 6974 2c20  lits.get(split, 
+00037b20: 5370 6c69 7449 6e66 6f28 2929 2e6e 756d  SplitInfo()).num
+00037b30: 5f62 7974 6573 206f 7220 300a 0a20 2020  _bytes or 0..   
+00037b40: 2020 2020 2020 2020 2020 2020 2072 6570               rep
+00037b50: 6f5f 696e 666f 2e64 6f77 6e6c 6f61 645f  o_info.download_
+00037b60: 6368 6563 6b73 756d 7320 3d20 4e6f 6e65  checksums = None
+00037b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00037b80: 2072 6570 6f5f 696e 666f 2e64 6f77 6e6c   repo_info.downl
+00037b90: 6f61 645f 7369 7a65 203d 2028 7265 706f  oad_size = (repo
+00037ba0: 5f69 6e66 6f2e 646f 776e 6c6f 6164 5f73  _info.download_s
+00037bb0: 697a 6520 6f72 2030 2920 2b20 7570 6c6f  ize or 0) + uplo
+00037bc0: 6164 6564 5f73 697a 650a 2020 2020 2020  aded_size.      
+00037bd0: 2020 2020 2020 2020 2020 7265 706f 5f69            repo_i
+00037be0: 6e66 6f2e 6461 7461 7365 745f 7369 7a65  nfo.dataset_size
+00037bf0: 203d 2028 7265 706f 5f69 6e66 6f2e 6461   = (repo_info.da
+00037c00: 7461 7365 745f 7369 7a65 206f 7220 3029  taset_size or 0)
+00037c10: 202b 2064 6174 6173 6574 5f6e 6279 7465   + dataset_nbyte
+00037c20: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00037c30: 2020 7265 706f 5f69 6e66 6f2e 7369 7a65    repo_info.size
+00037c40: 5f69 6e5f 6279 7465 7320 3d20 7265 706f  _in_bytes = repo
+00037c50: 5f69 6e66 6f2e 646f 776e 6c6f 6164 5f73  _info.download_s
+00037c60: 697a 6520 2b20 7265 706f 5f69 6e66 6f2e  ize + repo_info.
+00037c70: 6461 7461 7365 745f 7369 7a65 0a20 2020  dataset_size.   
+00037c80: 2020 2020 2020 2020 2020 2020 2072 6570               rep
+00037c90: 6f5f 696e 666f 2e73 706c 6974 735b 7370  o_info.splits[sp
+00037ca0: 6c69 745d 203d 2053 706c 6974 496e 666f  lit] = SplitInfo
+00037cb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00037cc0: 2020 2020 2020 7370 6c69 742c 206e 756d        split, num
+00037cd0: 5f62 7974 6573 3d64 6174 6173 6574 5f6e  _bytes=dataset_n
+00037ce0: 6279 7465 732c 206e 756d 5f65 7861 6d70  bytes, num_examp
+00037cf0: 6c65 733d 6c65 6e28 7365 6c66 292c 2064  les=len(self), d
+00037d00: 6174 6173 6574 5f6e 616d 653d 6461 7461  ataset_name=data
+00037d10: 7365 745f 6e61 6d65 0a20 2020 2020 2020  set_name.       
+00037d20: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00037d30: 2020 2020 2020 2020 2020 2069 6e66 6f5f             info_
+00037d40: 746f 5f64 756d 7020 3d20 7265 706f 5f69  to_dump = repo_i
+00037d50: 6e66 6f0a 2020 2020 2020 2020 2320 7075  nfo.        # pu
+00037d60: 7368 2074 6f20 7468 6520 6465 7072 6563  sh to the deprec
+00037d70: 6174 6564 2064 6174 6173 6574 5f69 6e66  ated dataset_inf
+00037d80: 6f73 2e6a 736f 6e0a 2020 2020 2020 2020  os.json.        
+00037d90: 6966 2063 6f6e 6669 672e 4441 5441 5345  if config.DATASE
+00037da0: 5444 4943 545f 494e 464f 535f 4649 4c45  TDICT_INFOS_FILE
+00037db0: 4e41 4d45 2069 6e20 7265 706f 5f66 696c  NAME in repo_fil
+00037dc0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00037dd0: 6275 6666 6572 203d 2042 7974 6573 494f  buffer = BytesIO
+00037de0: 2829 0a20 2020 2020 2020 2020 2020 2062  ().            b
+00037df0: 7566 6665 722e 7772 6974 6528 6227 7b22  uffer.write(b'{"
+00037e00: 6465 6661 756c 7422 3a20 2729 0a20 2020  default": ').   
+00037e10: 2020 2020 2020 2020 2069 6e66 6f5f 746f           info_to
+00037e20: 5f64 756d 702e 5f64 756d 705f 696e 666f  _dump._dump_info
+00037e30: 2862 7566 6665 722c 2070 7265 7474 795f  (buffer, pretty_
+00037e40: 7072 696e 743d 5472 7565 290a 2020 2020  print=True).    
+00037e50: 2020 2020 2020 2020 6275 6666 6572 2e77          buffer.w
+00037e60: 7269 7465 2862 227d 2229 0a20 2020 2020  rite(b"}").     
+00037e70: 2020 2020 2020 2048 6641 7069 2865 6e64         HfApi(end
+00037e80: 706f 696e 743d 636f 6e66 6967 2e48 465f  point=config.HF_
+00037e90: 454e 4450 4f49 4e54 292e 7570 6c6f 6164  ENDPOINT).upload
+00037ea0: 5f66 696c 6528 0a20 2020 2020 2020 2020  _file(.         
+00037eb0: 2020 2020 2020 2070 6174 685f 6f72 5f66         path_or_f
+00037ec0: 696c 656f 626a 3d62 7566 6665 722e 6765  ileobj=buffer.ge
+00037ed0: 7476 616c 7565 2829 2c0a 2020 2020 2020  tvalue(),.      
+00037ee0: 2020 2020 2020 2020 2020 7061 7468 5f69            path_i
+00037ef0: 6e5f 7265 706f 3d63 6f6e 6669 672e 4441  n_repo=config.DA
+00037f00: 5441 5345 5444 4943 545f 494e 464f 535f  TASETDICT_INFOS_
+00037f10: 4649 4c45 4e41 4d45 2c0a 2020 2020 2020  FILENAME,.      
+00037f20: 2020 2020 2020 2020 2020 7265 706f 5f69            repo_i
+00037f30: 643d 7265 706f 5f69 642c 0a20 2020 2020  d=repo_id,.     
+00037f40: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+00037f50: 3d74 6f6b 656e 2c0a 2020 2020 2020 2020  =token,.        
+00037f60: 2020 2020 2020 2020 7265 706f 5f74 7970          repo_typ
+00037f70: 653d 2264 6174 6173 6574 222c 0a20 2020  e="dataset",.   
+00037f80: 2020 2020 2020 2020 2020 2020 2072 6576               rev
+00037f90: 6973 696f 6e3d 6272 616e 6368 2c0a 2020  ision=branch,.  
+00037fa0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00037fb0: 2020 2020 2320 7075 7368 2074 6f20 5245      # push to RE
+00037fc0: 4144 4d45 0a20 2020 2020 2020 2044 6174  ADME.        Dat
+00037fd0: 6173 6574 496e 666f 7344 6963 7428 7b22  asetInfosDict({"
+00037fe0: 6465 6661 756c 7422 3a20 696e 666f 5f74  default": info_t
+00037ff0: 6f5f 6475 6d70 7d29 2e74 6f5f 6d65 7461  o_dump}).to_meta
+00038000: 6461 7461 2864 6174 6173 6574 5f6d 6574  data(dataset_met
+00038010: 6164 6174 6129 0a20 2020 2020 2020 2069  adata).        i
+00038020: 6620 2252 4541 444d 452e 6d64 2220 696e  f "README.md" in
+00038030: 2072 6570 6f5f 6669 6c65 733a 0a20 2020   repo_files:.   
+00038040: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+00038050: 656e 2864 6174 6173 6574 5f72 6561 646d  en(dataset_readm
+00038060: 655f 7061 7468 2c20 656e 636f 6469 6e67  e_path, encoding
+00038070: 3d22 7574 662d 3822 2920 6173 2072 6561  ="utf-8") as rea
+00038080: 646d 655f 6669 6c65 3a0a 2020 2020 2020  dme_file:.      
+00038090: 2020 2020 2020 2020 2020 7265 6164 6d65            readme
+000380a0: 5f63 6f6e 7465 6e74 203d 2072 6561 646d  _content = readm
+000380b0: 655f 6669 6c65 2e72 6561 6428 290a 2020  e_file.read().  
+000380c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000380d0: 2020 2020 2020 2020 7265 6164 6d65 5f63          readme_c
+000380e0: 6f6e 7465 6e74 203d 2066 2723 2044 6174  ontent = f'# Dat
+000380f0: 6173 6574 2043 6172 6420 666f 7220 227b  aset Card for "{
+00038100: 7265 706f 5f69 642e 7370 6c69 7428 222f  repo_id.split("/
+00038110: 2229 5b2d 315d 7d22 5c6e 5c6e 5b4d 6f72  ")[-1]}"\n\n[Mor
+00038120: 6520 496e 666f 726d 6174 696f 6e20 6e65  e Information ne
+00038130: 6564 6564 5d28 6874 7470 733a 2f2f 6769  eded](https://gi
+00038140: 7468 7562 2e63 6f6d 2f68 7567 6769 6e67  thub.com/hugging
+00038150: 6661 6365 2f64 6174 6173 6574 732f 626c  face/datasets/bl
+00038160: 6f62 2f6d 6169 6e2f 434f 4e54 5249 4255  ob/main/CONTRIBU
+00038170: 5449 4e47 2e6d 6423 686f 772d 746f 2d63  TING.md#how-to-c
+00038180: 6f6e 7472 6962 7574 652d 746f 2d74 6865  ontribute-to-the
+00038190: 2d64 6174 6173 6574 2d63 6172 6473 2927  -dataset-cards)'
+000381a0: 0a20 2020 2020 2020 2048 6641 7069 2865  .        HfApi(e
+000381b0: 6e64 706f 696e 743d 636f 6e66 6967 2e48  ndpoint=config.H
+000381c0: 465f 454e 4450 4f49 4e54 292e 7570 6c6f  F_ENDPOINT).uplo
+000381d0: 6164 5f66 696c 6528 0a20 2020 2020 2020  ad_file(.       
+000381e0: 2020 2020 2070 6174 685f 6f72 5f66 696c       path_or_fil
+000381f0: 656f 626a 3d64 6174 6173 6574 5f6d 6574  eobj=dataset_met
+00038200: 6164 6174 612e 5f74 6f5f 7265 6164 6d65  adata._to_readme
+00038210: 2872 6561 646d 655f 636f 6e74 656e 7429  (readme_content)
+00038220: 2e65 6e63 6f64 6528 292c 0a20 2020 2020  .encode(),.     
+00038230: 2020 2020 2020 2070 6174 685f 696e 5f72         path_in_r
+00038240: 6570 6f3d 2252 4541 444d 452e 6d64 222c  epo="README.md",
+00038250: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00038260: 6f5f 6964 3d72 6570 6f5f 6964 2c0a 2020  o_id=repo_id,.  
+00038270: 2020 2020 2020 2020 2020 746f 6b65 6e3d            token=
+00038280: 746f 6b65 6e2c 0a20 2020 2020 2020 2020  token,.         
+00038290: 2020 2072 6570 6f5f 7479 7065 3d22 6461     repo_type="da
+000382a0: 7461 7365 7422 2c0a 2020 2020 2020 2020  taset",.        
+000382b0: 2020 2020 7265 7669 7369 6f6e 3d62 7261      revision=bra
+000382c0: 6e63 682c 0a20 2020 2020 2020 2029 0a0a  nch,.        )..
+000382d0: 2020 2020 4074 7261 6e73 6d69 745f 666f      @transmit_fo
+000382e0: 726d 6174 0a20 2020 2040 6669 6e67 6572  rmat.    @finger
+000382f0: 7072 696e 745f 7472 616e 7366 6f72 6d28  print_transform(
+00038300: 696e 706c 6163 653d 4661 6c73 6529 0a20  inplace=False). 
+00038310: 2020 2064 6566 2061 6464 5f63 6f6c 756d     def add_colum
+00038320: 6e28 7365 6c66 2c20 6e61 6d65 3a20 7374  n(self, name: st
+00038330: 722c 2063 6f6c 756d 6e3a 2055 6e69 6f6e  r, column: Union
+00038340: 5b6c 6973 742c 206e 702e 6172 7261 795d  [list, np.array]
+00038350: 2c20 6e65 775f 6669 6e67 6572 7072 696e  , new_fingerprin
+00038360: 743a 2073 7472 293a 0a20 2020 2020 2020  t: str):.       
+00038370: 2022 2222 4164 6420 636f 6c75 6d6e 2074   """Add column t
+00038380: 6f20 4461 7461 7365 742e 0a0a 2020 2020  o Dataset...    
+00038390: 2020 2020 3c41 6464 6564 2076 6572 7369      <Added versi
+000383a0: 6f6e 3d22 312e 3722 2f3e 0a0a 2020 2020  on="1.7"/>..    
+000383b0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+000383c0: 2020 2020 2020 6e61 6d65 2028 6073 7472        name (`str
+000383d0: 6029 3a0a 2020 2020 2020 2020 2020 2020  `):.            
+000383e0: 2020 2020 436f 6c75 6d6e 206e 616d 652e      Column name.
+000383f0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+00038400: 756d 6e20 2860 6c69 7374 6020 6f72 2060  umn (`list` or `
+00038410: 6e70 2e61 7272 6179 6029 3a0a 2020 2020  np.array`):.    
+00038420: 2020 2020 2020 2020 2020 2020 436f 6c75              Colu
+00038430: 6d6e 2064 6174 6120 746f 2062 6520 6164  mn data to be ad
+00038440: 6465 642e 0a0a 2020 2020 2020 2020 5265  ded...        Re
+00038450: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
+00038460: 2020 205b 6044 6174 6173 6574 605d 0a0a     [`Dataset`]..
+00038470: 2020 2020 2020 2020 4578 616d 706c 653a          Example:
+00038480: 0a0a 2020 2020 2020 2020 6060 6070 790a  ..        ```py.
+00038490: 2020 2020 2020 2020 3e3e 3e20 6672 6f6d          >>> from
+000384a0: 2064 6174 6173 6574 7320 696d 706f 7274   datasets import
+000384b0: 206c 6f61 645f 6461 7461 7365 740a 2020   load_dataset.  
+000384c0: 2020 2020 2020 3e3e 3e20 6473 203d 206c        >>> ds = l
+000384d0: 6f61 645f 6461 7461 7365 7428 2272 6f74  oad_dataset("rot
+000384e0: 7465 6e5f 746f 6d61 746f 6573 222c 2073  ten_tomatoes", s
+000384f0: 706c 6974 3d22 7661 6c69 6461 7469 6f6e  plit="validation
+00038500: 2229 0a20 2020 2020 2020 203e 3e3e 206d  ").        >>> m
+00038510: 6f72 655f 7465 7874 203d 2064 735b 2274  ore_text = ds["t
+00038520: 6578 7422 5d0a 2020 2020 2020 2020 3e3e  ext"].        >>
+00038530: 3e20 6473 2e61 6464 5f63 6f6c 756d 6e28  > ds.add_column(
+00038540: 6e61 6d65 3d22 7465 7874 5f32 222c 2063  name="text_2", c
+00038550: 6f6c 756d 6e3d 6d6f 7265 5f74 6578 7429  olumn=more_text)
+00038560: 0a20 2020 2020 2020 2044 6174 6173 6574  .        Dataset
+00038570: 287b 0a20 2020 2020 2020 2020 2020 2066  ({.            f
+00038580: 6561 7475 7265 733a 205b 2774 6578 7427  eatures: ['text'
+00038590: 2c20 276c 6162 656c 272c 2027 7465 7874  , 'label', 'text
+000385a0: 5f32 275d 2c0a 2020 2020 2020 2020 2020  _2'],.          
+000385b0: 2020 6e75 6d5f 726f 7773 3a20 3130 3636    num_rows: 1066
+000385c0: 0a20 2020 2020 2020 207d 290a 2020 2020  .        }).    
+000385d0: 2020 2020 6060 600a 2020 2020 2020 2020      ```.        
+000385e0: 2222 220a 2020 2020 2020 2020 636f 6c75  """.        colu
+000385f0: 6d6e 5f74 6162 6c65 203d 2049 6e4d 656d  mn_table = InMem
+00038600: 6f72 7954 6162 6c65 2e66 726f 6d5f 7079  oryTable.from_py
+00038610: 6469 6374 287b 6e61 6d65 3a20 636f 6c75  dict({name: colu
+00038620: 6d6e 7d29 0a20 2020 2020 2020 205f 6368  mn}).        _ch
+00038630: 6563 6b5f 636f 6c75 6d6e 5f6e 616d 6573  eck_column_names
+00038640: 2873 656c 662e 5f64 6174 612e 636f 6c75  (self._data.colu
+00038650: 6d6e 5f6e 616d 6573 202b 2063 6f6c 756d  mn_names + colum
+00038660: 6e5f 7461 626c 652e 636f 6c75 6d6e 5f6e  n_table.column_n
+00038670: 616d 6573 290a 2020 2020 2020 2020 6461  ames).        da
+00038680: 7461 7365 7420 3d20 7365 6c66 2e66 6c61  taset = self.fla
+00038690: 7474 656e 5f69 6e64 6963 6573 2829 2069  tten_indices() i
+000386a0: 6620 7365 6c66 2e5f 696e 6469 6365 7320  f self._indices 
+000386b0: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
+000386c0: 2073 656c 660a 2020 2020 2020 2020 2320   self.        # 
+000386d0: 436f 6e63 6174 656e 6174 6520 7461 626c  Concatenate tabl
+000386e0: 6573 2068 6f72 697a 6f6e 7461 6c6c 790a  es horizontally.
+000386f0: 2020 2020 2020 2020 7461 626c 6520 3d20          table = 
+00038700: 636f 6e63 6174 5f74 6162 6c65 7328 5b64  concat_tables([d
+00038710: 6174 6173 6574 2e5f 6461 7461 2c20 636f  ataset._data, co
+00038720: 6c75 6d6e 5f74 6162 6c65 5d2c 2061 7869  lumn_table], axi
+00038730: 733d 3129 0a20 2020 2020 2020 2023 2055  s=1).        # U
+00038740: 7064 6174 6520 6665 6174 7572 6573 0a20  pdate features. 
+00038750: 2020 2020 2020 2069 6e66 6f20 3d20 6461         info = da
+00038760: 7461 7365 742e 696e 666f 2e63 6f70 7928  taset.info.copy(
+00038770: 290a 2020 2020 2020 2020 696e 666f 2e66  ).        info.f
+00038780: 6561 7475 7265 732e 7570 6461 7465 2846  eatures.update(F
+00038790: 6561 7475 7265 732e 6672 6f6d 5f61 7272  eatures.from_arr
+000387a0: 6f77 5f73 6368 656d 6128 636f 6c75 6d6e  ow_schema(column
+000387b0: 5f74 6162 6c65 2e73 6368 656d 6129 290a  _table.schema)).
+000387c0: 2020 2020 2020 2020 7461 626c 6520 3d20          table = 
+000387d0: 7570 6461 7465 5f6d 6574 6164 6174 615f  update_metadata_
+000387e0: 7769 7468 5f66 6561 7475 7265 7328 7461  with_features(ta
+000387f0: 626c 652c 2069 6e66 6f2e 6665 6174 7572  ble, info.featur
+00038800: 6573 290a 2020 2020 2020 2020 7265 7475  es).        retu
+00038810: 726e 2044 6174 6173 6574 2874 6162 6c65  rn Dataset(table
+00038820: 2c20 696e 666f 3d69 6e66 6f2c 2073 706c  , info=info, spl
+00038830: 6974 3d73 656c 662e 7370 6c69 742c 2069  it=self.split, i
+00038840: 6e64 6963 6573 5f74 6162 6c65 3d4e 6f6e  ndices_table=Non
+00038850: 652c 2066 696e 6765 7270 7269 6e74 3d6e  e, fingerprint=n
+00038860: 6577 5f66 696e 6765 7270 7269 6e74 290a  ew_fingerprint).
+00038870: 0a20 2020 2064 6566 2061 6464 5f66 6169  .    def add_fai
+00038880: 7373 5f69 6e64 6578 280a 2020 2020 2020  ss_index(.      
+00038890: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+000388a0: 636f 6c75 6d6e 3a20 7374 722c 0a20 2020  column: str,.   
+000388b0: 2020 2020 2069 6e64 6578 5f6e 616d 653a       index_name:
+000388c0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+000388d0: 204e 6f6e 652c 0a20 2020 2020 2020 2064   None,.        d
+000388e0: 6576 6963 653a 204f 7074 696f 6e61 6c5b  evice: Optional[
+000388f0: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
+00038900: 2020 2020 2073 7472 696e 675f 6661 6374       string_fact
+00038910: 6f72 793a 204f 7074 696f 6e61 6c5b 7374  ory: Optional[st
+00038920: 725d 203d 204e 6f6e 652c 0a20 2020 2020  r] = None,.     
+00038930: 2020 206d 6574 7269 635f 7479 7065 3a20     metric_type: 
+00038940: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
+00038950: 4e6f 6e65 2c0a 2020 2020 2020 2020 6375  None,.        cu
+00038960: 7374 6f6d 5f69 6e64 6578 3a20 4f70 7469  stom_index: Opti
+00038970: 6f6e 616c 5b22 6661 6973 732e 496e 6465  onal["faiss.Inde
+00038980: 7822 5d20 3d20 4e6f 6e65 2c20 2023 206e  x"] = None,  # n
+00038990: 6f71 613a 2046 3832 310a 2020 2020 2020  oqa: F821.      
+000389a0: 2020 6261 7463 685f 7369 7a65 3a20 696e    batch_size: in
+000389b0: 7420 3d20 3130 3030 2c0a 2020 2020 2020  t = 1000,.      
+000389c0: 2020 7472 6169 6e5f 7369 7a65 3a20 4f70    train_size: Op
+000389d0: 7469 6f6e 616c 5b69 6e74 5d20 3d20 4e6f  tional[int] = No
+000389e0: 6e65 2c0a 2020 2020 2020 2020 6661 6973  ne,.        fais
+000389f0: 735f 7665 7262 6f73 653a 2062 6f6f 6c20  s_verbose: bool 
+00038a00: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+00038a10: 2064 7479 7065 3d6e 702e 666c 6f61 7433   dtype=np.float3
+00038a20: 322c 0a20 2020 2029 3a0a 2020 2020 2020  2,.    ):.      
+00038a30: 2020 2222 2241 6464 2061 2064 656e 7365    """Add a dense
+00038a40: 2069 6e64 6578 2075 7369 6e67 2046 6169   index using Fai
+00038a50: 7373 2066 6f72 2066 6173 7420 7265 7472  ss for fast retr
+00038a60: 6965 7661 6c2e 0a20 2020 2020 2020 2042  ieval..        B
+00038a70: 7920 6465 6661 756c 7420 7468 6520 696e  y default the in
+00038a80: 6465 7820 6973 2064 6f6e 6520 6f76 6572  dex is done over
+00038a90: 2074 6865 2076 6563 746f 7273 206f 6620   the vectors of 
+00038aa0: 7468 6520 7370 6563 6966 6965 6420 636f  the specified co
+00038ab0: 6c75 6d6e 2e0a 2020 2020 2020 2020 596f  lumn..        Yo
+00038ac0: 7520 6361 6e20 7370 6563 6966 7920 6064  u can specify `d
+00038ad0: 6576 6963 6560 2069 6620 796f 7520 7761  evice` if you wa
+00038ae0: 6e74 2074 6f20 7275 6e20 6974 206f 6e20  nt to run it on 
+00038af0: 4750 5520 2860 6465 7669 6365 6020 6d75  GPU (`device` mu
+00038b00: 7374 2062 6520 7468 6520 4750 5520 696e  st be the GPU in
+00038b10: 6465 7829 2e0a 2020 2020 2020 2020 596f  dex)..        Yo
+00038b20: 7520 6361 6e20 6669 6e64 206d 6f72 6520  u can find more 
+00038b30: 696e 666f 726d 6174 696f 6e20 6162 6f75  information abou
+00038b40: 7420 4661 6973 7320 6865 7265 3a0a 0a20  t Faiss here:.. 
+00038b50: 2020 2020 2020 202d 2046 6f72 205b 7374         - For [st
+00038b60: 7269 6e67 2066 6163 746f 7279 5d28 6874  ring factory](ht
+00038b70: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+00038b80: 2f66 6163 6562 6f6f 6b72 6573 6561 7263  /facebookresearc
+00038b90: 682f 6661 6973 732f 7769 6b69 2f54 6865  h/faiss/wiki/The
+00038ba0: 2d69 6e64 6578 2d66 6163 746f 7279 290a  -index-factory).
+00038bb0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00038bc0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+00038bd0: 6e20 2860 7374 7260 293a 0a20 2020 2020  n (`str`):.     
+00038be0: 2020 2020 2020 2020 2020 2054 6865 2063             The c
+00038bf0: 6f6c 756d 6e20 6f66 2074 6865 2076 6563  olumn of the vec
+00038c00: 746f 7273 2074 6f20 6164 6420 746f 2074  tors to add to t
+00038c10: 6865 2069 6e64 6578 2e0a 2020 2020 2020  he index..      
+00038c20: 2020 2020 2020 696e 6465 785f 6e61 6d65        index_name
+00038c30: 2028 6073 7472 602c 202a 6f70 7469 6f6e   (`str`, *option
+00038c40: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
+00038c50: 2020 2020 2020 5468 6520 6069 6e64 6578        The `index
+00038c60: 5f6e 616d 6560 2f69 6465 6e74 6966 6965  _name`/identifie
+00038c70: 7220 6f66 2074 6865 2069 6e64 6578 2e0a  r of the index..
+00038c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038c90: 5468 6973 2069 7320 7468 6520 6069 6e64  This is the `ind
+00038ca0: 6578 5f6e 616d 6560 2074 6861 7420 6973  ex_name` that is
+00038cb0: 2075 7365 6420 746f 2063 616c 6c20 5b60   used to call [`
+00038cc0: 7e64 6174 6173 6574 732e 4461 7461 7365  ~datasets.Datase
+00038cd0: 742e 6765 745f 6e65 6172 6573 745f 6578  t.get_nearest_ex
+00038ce0: 616d 706c 6573 605d 206f 7220 5b60 7e64  amples`] or [`~d
+00038cf0: 6174 6173 6574 732e 4461 7461 7365 742e  atasets.Dataset.
+00038d00: 7365 6172 6368 605d 2e0a 2020 2020 2020  search`]..      
+00038d10: 2020 2020 2020 2020 2020 4279 2064 6566            By def
+00038d20: 6175 6c74 2069 7420 636f 7272 6573 706f  ault it correspo
+00038d30: 6e64 7320 746f 2060 636f 6c75 6d6e 602e  nds to `column`.
+00038d40: 0a20 2020 2020 2020 2020 2020 2064 6576  .            dev
+00038d50: 6963 6520 2860 556e 696f 6e5b 696e 742c  ice (`Union[int,
+00038d60: 204c 6973 745b 696e 745d 5d60 2c20 2a6f   List[int]]`, *o
+00038d70: 7074 696f 6e61 6c2a 293a 0a20 2020 2020  ptional*):.     
+00038d80: 2020 2020 2020 2020 2020 2049 6620 706f             If po
+00038d90: 7369 7469 7665 2069 6e74 6567 6572 2c20  sitive integer, 
+00038da0: 7468 6973 2069 7320 7468 6520 696e 6465  this is the inde
+00038db0: 7820 6f66 2074 6865 2047 5055 2074 6f20  x of the GPU to 
+00038dc0: 7573 652e 2049 6620 6e65 6761 7469 7665  use. If negative
+00038dd0: 2069 6e74 6567 6572 2c20 7573 6520 616c   integer, use al
+00038de0: 6c20 4750 5573 2e0a 2020 2020 2020 2020  l GPUs..        
+00038df0: 2020 2020 2020 2020 4966 2061 206c 6973          If a lis
+00038e00: 7420 6f66 2070 6f73 6974 6976 6520 696e  t of positive in
+00038e10: 7465 6765 7273 2069 7320 7061 7373 6564  tegers is passed
+00038e20: 2069 6e2c 2072 756e 206f 6e6c 7920 6f6e   in, run only on
+00038e30: 2074 686f 7365 2047 5055 732e 2042 7920   those GPUs. By 
+00038e40: 6465 6661 756c 7420 6974 2075 7365 7320  default it uses 
+00038e50: 7468 6520 4350 552e 0a20 2020 2020 2020  the CPU..       
+00038e60: 2020 2020 2073 7472 696e 675f 6661 6374       string_fact
+00038e70: 6f72 7920 2860 7374 7260 2c20 2a6f 7074  ory (`str`, *opt
+00038e80: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
+00038e90: 2020 2020 2020 2020 2054 6869 7320 6973           This is
+00038ea0: 2070 6173 7365 6420 746f 2074 6865 2069   passed to the i
+00038eb0: 6e64 6578 2066 6163 746f 7279 206f 6620  ndex factory of 
+00038ec0: 4661 6973 7320 746f 2063 7265 6174 6520  Faiss to create 
+00038ed0: 7468 6520 696e 6465 782e 0a20 2020 2020  the index..     
+00038ee0: 2020 2020 2020 2020 2020 2044 6566 6175             Defau
+00038ef0: 6c74 2069 6e64 6578 2063 6c61 7373 2069  lt index class i
+00038f00: 7320 6049 6e64 6578 466c 6174 602e 0a20  s `IndexFlat`.. 
+00038f10: 2020 2020 2020 2020 2020 206d 6574 7269             metri
+00038f20: 635f 7479 7065 2028 6069 6e74 602c 202a  c_type (`int`, *
+00038f30: 6f70 7469 6f6e 616c 2a29 3a0a 2020 2020  optional*):.    
+00038f40: 2020 2020 2020 2020 2020 2020 5479 7065              Type
+00038f50: 206f 6620 6d65 7472 6963 2e20 4578 3a20   of metric. Ex: 
+00038f60: 6066 6169 7373 2e4d 4554 5249 435f 494e  `faiss.METRIC_IN
+00038f70: 4e45 525f 5052 4f44 5543 5460 206f 7220  NER_PRODUCT` or 
+00038f80: 6066 6169 7373 2e4d 4554 5249 435f 4c32  `faiss.METRIC_L2
+00038f90: 602e 0a20 2020 2020 2020 2020 2020 2063  `..            c
+00038fa0: 7573 746f 6d5f 696e 6465 7820 2860 6661  ustom_index (`fa
+00038fb0: 6973 732e 496e 6465 7860 2c20 2a6f 7074  iss.Index`, *opt
+00038fc0: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
+00038fd0: 2020 2020 2020 2020 2043 7573 746f 6d20           Custom 
+00038fe0: 4661 6973 7320 696e 6465 7820 7468 6174  Faiss index that
+00038ff0: 2079 6f75 2061 6c72 6561 6479 2068 6176   you already hav
+00039000: 6520 696e 7374 616e 7469 6174 6564 2061  e instantiated a
+00039010: 6e64 2063 6f6e 6669 6775 7265 6420 666f  nd configured fo
+00039020: 7220 796f 7572 206e 6565 6473 2e0a 2020  r your needs..  
+00039030: 2020 2020 2020 2020 2020 6261 7463 685f            batch_
+00039040: 7369 7a65 2028 6069 6e74 6029 3a0a 2020  size (`int`):.  
+00039050: 2020 2020 2020 2020 2020 2020 2020 5369                Si
+00039060: 7a65 206f 6620 7468 6520 6261 7463 6820  ze of the batch 
+00039070: 746f 2075 7365 2077 6869 6c65 2061 6464  to use while add
+00039080: 696e 6720 7665 6374 6f72 7320 746f 2074  ing vectors to t
+00039090: 6865 2060 4661 6973 7349 6e64 6578 602e  he `FaissIndex`.
+000390a0: 2044 6566 6175 6c74 2076 616c 7565 2069   Default value i
+000390b0: 7320 6031 3030 3060 2e0a 2020 2020 2020  s `1000`..      
+000390c0: 2020 2020 2020 2020 2020 3c41 6464 6564            <Added
+000390d0: 2076 6572 7369 6f6e 3d22 322e 342e 3022   version="2.4.0"
+000390e0: 2f3e 0a20 2020 2020 2020 2020 2020 2074  />.            t
+000390f0: 7261 696e 5f73 697a 6520 2860 696e 7460  rain_size (`int`
+00039100: 2c20 2a6f 7074 696f 6e61 6c2a 293a 0a20  , *optional*):. 
+00039110: 2020 2020 2020 2020 2020 2020 2020 2049                 I
+00039120: 6620 7468 6520 696e 6465 7820 6e65 6564  f the index need
+00039130: 7320 6120 7472 6169 6e69 6e67 2073 7465  s a training ste
+00039140: 702c 2073 7065 6369 6669 6573 2068 6f77  p, specifies how
+00039150: 206d 616e 7920 7665 6374 6f72 7320 7769   many vectors wi
+00039160: 6c6c 2062 6520 7573 6564 2074 6f20 7472  ll be used to tr
+00039170: 6169 6e20 7468 6520 696e 6465 782e 0a20  ain the index.. 
+00039180: 2020 2020 2020 2020 2020 2066 6169 7373             faiss
+00039190: 5f76 6572 626f 7365 2028 6062 6f6f 6c60  _verbose (`bool`
+000391a0: 2c20 6465 6661 756c 7473 2074 6f20 6046  , defaults to `F
+000391b0: 616c 7365 6029 3a0a 2020 2020 2020 2020  alse`):.        
+000391c0: 2020 2020 2020 2020 456e 6162 6c65 2074          Enable t
+000391d0: 6865 2076 6572 626f 7369 7479 206f 6620  he verbosity of 
+000391e0: 7468 6520 4661 6973 7320 696e 6465 782e  the Faiss index.
+000391f0: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
+00039200: 7065 2028 6064 6174 612d 7479 7065 6029  pe (`data-type`)
+00039210: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00039220: 2020 5468 6520 6474 7970 6520 6f66 2074    The dtype of t
+00039230: 6865 206e 756d 7079 2061 7272 6179 7320  he numpy arrays 
+00039240: 7468 6174 2061 7265 2069 6e64 6578 6564  that are indexed
+00039250: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00039260: 2020 4465 6661 756c 7420 6973 2060 6e70    Default is `np
+00039270: 2e66 6c6f 6174 3332 602e 0a0a 2020 2020  .float32`...    
+00039280: 2020 2020 4578 616d 706c 653a 0a0a 2020      Example:..  
+00039290: 2020 2020 2020 6060 6070 7974 686f 6e0a        ```python.
+000392a0: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
+000392b0: 2064 6174 6173 6574 732e 6c6f 6164 5f64   datasets.load_d
+000392c0: 6174 6173 6574 2827 6372 696d 655f 616e  ataset('crime_an
+000392d0: 645f 7075 6e69 7368 272c 2073 706c 6974  d_punish', split
+000392e0: 3d27 7472 6169 6e27 290a 2020 2020 2020  ='train').      
+000392f0: 2020 3e3e 3e20 6473 5f77 6974 685f 656d    >>> ds_with_em
+00039300: 6265 6464 696e 6773 203d 2064 732e 6d61  beddings = ds.ma
+00039310: 7028 6c61 6d62 6461 2065 7861 6d70 6c65  p(lambda example
+00039320: 3a20 7b27 656d 6265 6464 696e 6773 273a  : {'embeddings':
+00039330: 2065 6d62 6564 2865 7861 6d70 6c65 5b27   embed(example['
+00039340: 6c69 6e65 275d 7d29 290a 2020 2020 2020  line']})).      
+00039350: 2020 3e3e 3e20 6473 5f77 6974 685f 656d    >>> ds_with_em
+00039360: 6265 6464 696e 6773 2e61 6464 5f66 6169  beddings.add_fai
+00039370: 7373 5f69 6e64 6578 2863 6f6c 756d 6e3d  ss_index(column=
+00039380: 2765 6d62 6564 6469 6e67 7327 290a 2020  'embeddings').  
+00039390: 2020 2020 2020 3e3e 3e20 2320 7175 6572        >>> # quer
+000393a0: 790a 2020 2020 2020 2020 3e3e 3e20 7363  y.        >>> sc
+000393b0: 6f72 6573 2c20 7265 7472 6965 7665 645f  ores, retrieved_
+000393c0: 6578 616d 706c 6573 203d 2064 735f 7769  examples = ds_wi
+000393d0: 7468 5f65 6d62 6564 6469 6e67 732e 6765  th_embeddings.ge
+000393e0: 745f 6e65 6172 6573 745f 6578 616d 706c  t_nearest_exampl
+000393f0: 6573 2827 656d 6265 6464 696e 6773 272c  es('embeddings',
+00039400: 2065 6d62 6564 2827 6d79 206e 6577 2071   embed('my new q
+00039410: 7565 7279 2729 2c20 6b3d 3130 290a 2020  uery'), k=10).  
+00039420: 2020 2020 2020 3e3e 3e20 2320 7361 7665        >>> # save
+00039430: 2069 6e64 6578 0a20 2020 2020 2020 203e   index.        >
+00039440: 3e3e 2064 735f 7769 7468 5f65 6d62 6564  >> ds_with_embed
+00039450: 6469 6e67 732e 7361 7665 5f66 6169 7373  dings.save_faiss
+00039460: 5f69 6e64 6578 2827 656d 6265 6464 696e  _index('embeddin
+00039470: 6773 272c 2027 6d79 5f69 6e64 6578 2e66  gs', 'my_index.f
+00039480: 6169 7373 2729 0a0a 2020 2020 2020 2020  aiss')..        
+00039490: 3e3e 3e20 6473 203d 2064 6174 6173 6574  >>> ds = dataset
+000394a0: 732e 6c6f 6164 5f64 6174 6173 6574 2827  s.load_dataset('
+000394b0: 6372 696d 655f 616e 645f 7075 6e69 7368  crime_and_punish
+000394c0: 272c 2073 706c 6974 3d27 7472 6169 6e27  ', split='train'
+000394d0: 290a 2020 2020 2020 2020 3e3e 3e20 2320  ).        >>> # 
+000394e0: 6c6f 6164 2069 6e64 6578 0a20 2020 2020  load index.     
+000394f0: 2020 203e 3e3e 2064 732e 6c6f 6164 5f66     >>> ds.load_f
+00039500: 6169 7373 5f69 6e64 6578 2827 656d 6265  aiss_index('embe
+00039510: 6464 696e 6773 272c 2027 6d79 5f69 6e64  ddings', 'my_ind
+00039520: 6578 2e66 6169 7373 2729 0a20 2020 2020  ex.faiss').     
+00039530: 2020 203e 3e3e 2023 2071 7565 7279 0a20     >>> # query. 
+00039540: 2020 2020 2020 203e 3e3e 2073 636f 7265         >>> score
+00039550: 732c 2072 6574 7269 6576 6564 5f65 7861  s, retrieved_exa
+00039560: 6d70 6c65 7320 3d20 6473 2e67 6574 5f6e  mples = ds.get_n
+00039570: 6561 7265 7374 5f65 7861 6d70 6c65 7328  earest_examples(
+00039580: 2765 6d62 6564 6469 6e67 7327 2c20 656d  'embeddings', em
+00039590: 6265 6428 276d 7920 6e65 7720 7175 6572  bed('my new quer
+000395a0: 7927 292c 206b 3d31 3029 0a20 2020 2020  y'), k=10).     
+000395b0: 2020 2060 6060 0a20 2020 2020 2020 2022     ```.        "
+000395c0: 2222 0a20 2020 2020 2020 2077 6974 6820  "".        with 
+000395d0: 7365 6c66 2e66 6f72 6d61 7474 6564 5f61  self.formatted_a
+000395e0: 7328 7479 7065 3d22 6e75 6d70 7922 2c20  s(type="numpy", 
+000395f0: 636f 6c75 6d6e 733d 5b63 6f6c 756d 6e5d  columns=[column]
+00039600: 2c20 6474 7970 653d 6474 7970 6529 3a0a  , dtype=dtype):.
+00039610: 2020 2020 2020 2020 2020 2020 7375 7065              supe
+00039620: 7228 292e 6164 645f 6661 6973 735f 696e  r().add_faiss_in
+00039630: 6465 7828 0a20 2020 2020 2020 2020 2020  dex(.           
+00039640: 2020 2020 2063 6f6c 756d 6e3d 636f 6c75       column=colu
+00039650: 6d6e 2c0a 2020 2020 2020 2020 2020 2020  mn,.            
+00039660: 2020 2020 696e 6465 785f 6e61 6d65 3d69      index_name=i
+00039670: 6e64 6578 5f6e 616d 652c 0a20 2020 2020  ndex_name,.     
+00039680: 2020 2020 2020 2020 2020 2064 6576 6963             devic
+00039690: 653d 6465 7669 6365 2c0a 2020 2020 2020  e=device,.      
+000396a0: 2020 2020 2020 2020 2020 7374 7269 6e67            string
+000396b0: 5f66 6163 746f 7279 3d73 7472 696e 675f  _factory=string_
+000396c0: 6661 6374 6f72 792c 0a20 2020 2020 2020  factory,.       
+000396d0: 2020 2020 2020 2020 206d 6574 7269 635f           metric_
+000396e0: 7479 7065 3d6d 6574 7269 635f 7479 7065  type=metric_type
+000396f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00039700: 2020 6375 7374 6f6d 5f69 6e64 6578 3d63    custom_index=c
+00039710: 7573 746f 6d5f 696e 6465 782c 0a20 2020  ustom_index,.   
+00039720: 2020 2020 2020 2020 2020 2020 2062 6174               bat
+00039730: 6368 5f73 697a 653d 6261 7463 685f 7369  ch_size=batch_si
+00039740: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
+00039750: 2020 2020 7472 6169 6e5f 7369 7a65 3d74      train_size=t
+00039760: 7261 696e 5f73 697a 652c 0a20 2020 2020  rain_size,.     
+00039770: 2020 2020 2020 2020 2020 2066 6169 7373             faiss
+00039780: 5f76 6572 626f 7365 3d66 6169 7373 5f76  _verbose=faiss_v
+00039790: 6572 626f 7365 2c0a 2020 2020 2020 2020  erbose,.        
+000397a0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+000397b0: 7475 726e 2073 656c 660a 0a20 2020 2064  turn self..    d
+000397c0: 6566 2061 6464 5f66 6169 7373 5f69 6e64  ef add_faiss_ind
+000397d0: 6578 5f66 726f 6d5f 6578 7465 726e 616c  ex_from_external
+000397e0: 5f61 7272 6179 7328 0a20 2020 2020 2020  _arrays(.       
+000397f0: 2073 656c 662c 0a20 2020 2020 2020 2065   self,.        e
+00039800: 7874 6572 6e61 6c5f 6172 7261 7973 3a20  xternal_arrays: 
+00039810: 6e70 2e61 7272 6179 2c0a 2020 2020 2020  np.array,.      
+00039820: 2020 696e 6465 785f 6e61 6d65 3a20 7374    index_name: st
+00039830: 722c 0a20 2020 2020 2020 2064 6576 6963  r,.        devic
+00039840: 653a 204f 7074 696f 6e61 6c5b 696e 745d  e: Optional[int]
+00039850: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00039860: 2073 7472 696e 675f 6661 6374 6f72 793a   string_factory:
+00039870: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+00039880: 204e 6f6e 652c 0a20 2020 2020 2020 206d   None,.        m
+00039890: 6574 7269 635f 7479 7065 3a20 4f70 7469  etric_type: Opti
+000398a0: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
+000398b0: 2c0a 2020 2020 2020 2020 6375 7374 6f6d  ,.        custom
+000398c0: 5f69 6e64 6578 3a20 4f70 7469 6f6e 616c  _index: Optional
+000398d0: 5b22 6661 6973 732e 496e 6465 7822 5d20  ["faiss.Index"] 
+000398e0: 3d20 4e6f 6e65 2c20 2023 206e 6f71 613a  = None,  # noqa:
+000398f0: 2046 3832 310a 2020 2020 2020 2020 6261   F821.        ba
+00039900: 7463 685f 7369 7a65 3a20 696e 7420 3d20  tch_size: int = 
+00039910: 3130 3030 2c0a 2020 2020 2020 2020 7472  1000,.        tr
+00039920: 6169 6e5f 7369 7a65 3a20 4f70 7469 6f6e  ain_size: Option
+00039930: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a  al[int] = None,.
+00039940: 2020 2020 2020 2020 6661 6973 735f 7665          faiss_ve
+00039950: 7262 6f73 653a 2062 6f6f 6c20 3d20 4661  rbose: bool = Fa
+00039960: 6c73 652c 0a20 2020 2020 2020 2064 7479  lse,.        dty
+00039970: 7065 3d6e 702e 666c 6f61 7433 322c 0a20  pe=np.float32,. 
+00039980: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+00039990: 2241 6464 2061 2064 656e 7365 2069 6e64  "Add a dense ind
+000399a0: 6578 2075 7369 6e67 2046 6169 7373 2066  ex using Faiss f
+000399b0: 6f72 2066 6173 7420 7265 7472 6965 7661  or fast retrieva
+000399c0: 6c2e 0a20 2020 2020 2020 2054 6865 2069  l..        The i
+000399d0: 6e64 6578 2069 7320 6372 6561 7465 6420  ndex is created 
+000399e0: 7573 696e 6720 7468 6520 7665 6374 6f72  using the vector
+000399f0: 7320 6f66 2060 6578 7465 726e 616c 5f61  s of `external_a
+00039a00: 7272 6179 7360 2e0a 2020 2020 2020 2020  rrays`..        
+00039a10: 596f 7520 6361 6e20 7370 6563 6966 7920  You can specify 
+00039a20: 6064 6576 6963 6560 2069 6620 796f 7520  `device` if you 
+00039a30: 7761 6e74 2074 6f20 7275 6e20 6974 206f  want to run it o
+00039a40: 6e20 4750 5520 2860 6465 7669 6365 6020  n GPU (`device` 
+00039a50: 6d75 7374 2062 6520 7468 6520 4750 5520  must be the GPU 
+00039a60: 696e 6465 7829 2e0a 2020 2020 2020 2020  index)..        
+00039a70: 596f 7520 6361 6e20 6669 6e64 206d 6f72  You can find mor
+00039a80: 6520 696e 666f 726d 6174 696f 6e20 6162  e information ab
+00039a90: 6f75 7420 4661 6973 7320 6865 7265 3a0a  out Faiss here:.
+00039aa0: 0a20 2020 2020 2020 202d 2046 6f72 205b  .        - For [
+00039ab0: 7374 7269 6e67 2066 6163 746f 7279 5d28  string factory](
+00039ac0: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
+00039ad0: 6f6d 2f66 6163 6562 6f6f 6b72 6573 6561  om/facebookresea
+00039ae0: 7263 682f 6661 6973 732f 7769 6b69 2f54  rch/faiss/wiki/T
+00039af0: 6865 2d69 6e64 6578 2d66 6163 746f 7279  he-index-factory
+00039b00: 290a 0a20 2020 2020 2020 2041 7267 733a  )..        Args:
+00039b10: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
+00039b20: 6572 6e61 6c5f 6172 7261 7973 2028 606e  ernal_arrays (`n
+00039b30: 702e 6172 7261 7960 293a 0a20 2020 2020  p.array`):.     
+00039b40: 2020 2020 2020 2020 2020 2049 6620 796f             If yo
+00039b50: 7520 7761 6e74 2074 6f20 7573 6520 6172  u want to use ar
+00039b60: 7261 7973 2066 726f 6d20 6f75 7473 6964  rays from outsid
+00039b70: 6520 7468 6520 6c69 6220 666f 7220 7468  e the lib for th
+00039b80: 6520 696e 6465 782c 2079 6f75 2063 616e  e index, you can
+00039b90: 2073 6574 2060 6578 7465 726e 616c 5f61   set `external_a
+00039ba0: 7272 6179 7360 2e0a 2020 2020 2020 2020  rrays`..        
+00039bb0: 2020 2020 2020 2020 4974 2077 696c 6c20          It will 
+00039bc0: 7573 6520 6065 7874 6572 6e61 6c5f 6172  use `external_ar
+00039bd0: 7261 7973 6020 746f 2063 7265 6174 6520  rays` to create 
+00039be0: 7468 6520 4661 6973 7320 696e 6465 7820  the Faiss index 
+00039bf0: 696e 7374 6561 6420 6f66 2074 6865 2061  instead of the a
+00039c00: 7272 6179 7320 696e 2074 6865 2067 6976  rrays in the giv
+00039c10: 656e 2060 636f 6c75 6d6e 602e 0a20 2020  en `column`..   
+00039c20: 2020 2020 2020 2020 2069 6e64 6578 5f6e           index_n
+00039c30: 616d 6520 2860 7374 7260 293a 0a20 2020  ame (`str`):.   
+00039c40: 2020 2020 2020 2020 2020 2020 2054 6865               The
+00039c50: 2060 696e 6465 785f 6e61 6d65 602f 6964   `index_name`/id
+00039c60: 656e 7469 6669 6572 206f 6620 7468 6520  entifier of the 
+00039c70: 696e 6465 782e 0a20 2020 2020 2020 2020  index..         
+00039c80: 2020 2020 2020 2054 6869 7320 6973 2074         This is t
+00039c90: 6865 2060 696e 6465 785f 6e61 6d65 6020  he `index_name` 
+00039ca0: 7468 6174 2069 7320 7573 6564 2074 6f20  that is used to 
+00039cb0: 6361 6c6c 205b 607e 6461 7461 7365 7473  call [`~datasets
+00039cc0: 2e44 6174 6173 6574 2e67 6574 5f6e 6561  .Dataset.get_nea
+00039cd0: 7265 7374 5f65 7861 6d70 6c65 7360 5d20  rest_examples`] 
+00039ce0: 6f72 205b 607e 6461 7461 7365 7473 2e44  or [`~datasets.D
+00039cf0: 6174 6173 6574 2e73 6561 7263 6860 5d2e  ataset.search`].
+00039d00: 0a20 2020 2020 2020 2020 2020 2064 6576  .            dev
+00039d10: 6963 6520 284f 7074 696f 6e61 6c20 6055  ice (Optional `U
+00039d20: 6e69 6f6e 5b69 6e74 2c20 4c69 7374 5b69  nion[int, List[i
+00039d30: 6e74 5d5d 602c 202a 6f70 7469 6f6e 616c  nt]]`, *optional
+00039d40: 2a29 3a0a 2020 2020 2020 2020 2020 2020  *):.            
+00039d50: 2020 2020 4966 2070 6f73 6974 6976 6520      If positive 
+00039d60: 696e 7465 6765 722c 2074 6869 7320 6973  integer, this is
+00039d70: 2074 6865 2069 6e64 6578 206f 6620 7468   the index of th
+00039d80: 6520 4750 5520 746f 2075 7365 2e20 4966  e GPU to use. If
+00039d90: 206e 6567 6174 6976 6520 696e 7465 6765   negative intege
+00039da0: 722c 2075 7365 2061 6c6c 2047 5055 732e  r, use all GPUs.
+00039db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00039dc0: 2049 6620 6120 6c69 7374 206f 6620 706f   If a list of po
+00039dd0: 7369 7469 7665 2069 6e74 6567 6572 7320  sitive integers 
+00039de0: 6973 2070 6173 7365 6420 696e 2c20 7275  is passed in, ru
+00039df0: 6e20 6f6e 6c79 206f 6e20 7468 6f73 6520  n only on those 
+00039e00: 4750 5573 2e20 4279 2064 6566 6175 6c74  GPUs. By default
+00039e10: 2069 7420 7573 6573 2074 6865 2043 5055   it uses the CPU
+00039e20: 2e0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+00039e30: 7269 6e67 5f66 6163 746f 7279 2028 6073  ring_factory (`s
+00039e40: 7472 602c 202a 6f70 7469 6f6e 616c 2a29  tr`, *optional*)
+00039e50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00039e60: 2020 5468 6973 2069 7320 7061 7373 6564    This is passed
+00039e70: 2074 6f20 7468 6520 696e 6465 7820 6661   to the index fa
+00039e80: 6374 6f72 7920 6f66 2046 6169 7373 2074  ctory of Faiss t
+00039e90: 6f20 6372 6561 7465 2074 6865 2069 6e64  o create the ind
+00039ea0: 6578 2e0a 2020 2020 2020 2020 2020 2020  ex..            
+00039eb0: 2020 2020 4465 6661 756c 7420 696e 6465      Default inde
+00039ec0: 7820 636c 6173 7320 6973 2060 496e 6465  x class is `Inde
+00039ed0: 7846 6c61 7460 2e0a 2020 2020 2020 2020  xFlat`..        
+00039ee0: 2020 2020 6d65 7472 6963 5f74 7970 6520      metric_type 
+00039ef0: 2860 696e 7460 2c20 2a6f 7074 696f 6e61  (`int`, *optiona
+00039f00: 6c2a 293a 0a20 2020 2020 2020 2020 2020  l*):.           
+00039f10: 2020 2020 2054 7970 6520 6f66 206d 6574       Type of met
+00039f20: 7269 632e 2045 783a 2060 6661 6973 732e  ric. Ex: `faiss.
+00039f30: 6661 6973 732e 4d45 5452 4943 5f49 4e4e  faiss.METRIC_INN
+00039f40: 4552 5f50 524f 4455 4354 6020 6f72 2060  ER_PRODUCT` or `
+00039f50: 6661 6973 732e 4d45 5452 4943 5f4c 3260  faiss.METRIC_L2`
+00039f60: 2e0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
+00039f70: 7374 6f6d 5f69 6e64 6578 2028 6066 6169  stom_index (`fai
+00039f80: 7373 2e49 6e64 6578 602c 202a 6f70 7469  ss.Index`, *opti
+00039f90: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
+00039fa0: 2020 2020 2020 2020 4375 7374 6f6d 2046          Custom F
+00039fb0: 6169 7373 2069 6e64 6578 2074 6861 7420  aiss index that 
+00039fc0: 796f 7520 616c 7265 6164 7920 6861 7665  you already have
+00039fd0: 2069 6e73 7461 6e74 6961 7465 6420 616e   instantiated an
+00039fe0: 6420 636f 6e66 6967 7572 6564 2066 6f72  d configured for
+00039ff0: 2079 6f75 7220 6e65 6564 732e 0a20 2020   your needs..   
+0003a000: 2020 2020 2020 2020 2062 6174 6368 5f73           batch_s
+0003a010: 697a 6520 2860 696e 7460 2c20 2a6f 7074  ize (`int`, *opt
+0003a020: 696f 6e61 6c2a 293a 0a20 2020 2020 2020  ional*):.       
+0003a030: 2020 2020 2020 2020 2053 697a 6520 6f66           Size of
+0003a040: 2074 6865 2062 6174 6368 2074 6f20 7573   the batch to us
+0003a050: 6520 7768 696c 6520 6164 6469 6e67 2076  e while adding v
+0003a060: 6563 746f 7273 2074 6f20 7468 6520 4661  ectors to the Fa
+0003a070: 6973 7349 6e64 6578 2e20 4465 6661 756c  issIndex. Defaul
+0003a080: 7420 7661 6c75 6520 6973 2031 3030 302e  t value is 1000.
+0003a090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a0a0: 203c 4164 6465 6420 7665 7273 696f 6e3d   <Added version=
+0003a0b0: 2232 2e34 2e30 222f 3e0a 2020 2020 2020  "2.4.0"/>.      
+0003a0c0: 2020 2020 2020 7472 6169 6e5f 7369 7a65        train_size
+0003a0d0: 2028 6069 6e74 602c 202a 6f70 7469 6f6e   (`int`, *option
+0003a0e0: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
+0003a0f0: 2020 2020 2020 4966 2074 6865 2069 6e64        If the ind
+0003a100: 6578 206e 6565 6473 2061 2074 7261 696e  ex needs a train
+0003a110: 696e 6720 7374 6570 2c20 7370 6563 6966  ing step, specif
+0003a120: 6965 7320 686f 7720 6d61 6e79 2076 6563  ies how many vec
+0003a130: 746f 7273 2077 696c 6c20 6265 2075 7365  tors will be use
+0003a140: 6420 746f 2074 7261 696e 2074 6865 2069  d to train the i
+0003a150: 6e64 6578 2e0a 2020 2020 2020 2020 2020  ndex..          
+0003a160: 2020 6661 6973 735f 7665 7262 6f73 6520    faiss_verbose 
+0003a170: 2860 626f 6f6c 602c 2064 6566 6175 6c74  (`bool`, default
+0003a180: 7320 746f 2046 616c 7365 293a 0a20 2020  s to False):.   
+0003a190: 2020 2020 2020 2020 2020 2020 2045 6e61               Ena
+0003a1a0: 626c 6520 7468 6520 7665 7262 6f73 6974  ble the verbosit
+0003a1b0: 7920 6f66 2074 6865 2046 6169 7373 2069  y of the Faiss i
+0003a1c0: 6e64 6578 2e0a 2020 2020 2020 2020 2020  ndex..          
+0003a1d0: 2020 6474 7970 6520 2860 6e75 6d70 792e    dtype (`numpy.
+0003a1e0: 6474 7970 6560 293a 0a20 2020 2020 2020  dtype`):.       
+0003a1f0: 2020 2020 2020 2020 2054 6865 2064 7479           The dty
+0003a200: 7065 206f 6620 7468 6520 6e75 6d70 7920  pe of the numpy 
+0003a210: 6172 7261 7973 2074 6861 7420 6172 6520  arrays that are 
+0003a220: 696e 6465 7865 642e 2044 6566 6175 6c74  indexed. Default
+0003a230: 2069 7320 6e70 2e66 6c6f 6174 3332 2e0a   is np.float32..
+0003a240: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0003a250: 2020 2020 7375 7065 7228 292e 6164 645f      super().add_
+0003a260: 6661 6973 735f 696e 6465 785f 6672 6f6d  faiss_index_from
+0003a270: 5f65 7874 6572 6e61 6c5f 6172 7261 7973  _external_arrays
+0003a280: 280a 2020 2020 2020 2020 2020 2020 6578  (.            ex
+0003a290: 7465 726e 616c 5f61 7272 6179 733d 6578  ternal_arrays=ex
+0003a2a0: 7465 726e 616c 5f61 7272 6179 732e 6173  ternal_arrays.as
+0003a2b0: 7479 7065 2864 7479 7065 292c 0a20 2020  type(dtype),.   
+0003a2c0: 2020 2020 2020 2020 2069 6e64 6578 5f6e           index_n
+0003a2d0: 616d 653d 696e 6465 785f 6e61 6d65 2c0a  ame=index_name,.
+0003a2e0: 2020 2020 2020 2020 2020 2020 6465 7669              devi
+0003a2f0: 6365 3d64 6576 6963 652c 0a20 2020 2020  ce=device,.     
+0003a300: 2020 2020 2020 2073 7472 696e 675f 6661         string_fa
+0003a310: 6374 6f72 793d 7374 7269 6e67 5f66 6163  ctory=string_fac
+0003a320: 746f 7279 2c0a 2020 2020 2020 2020 2020  tory,.          
+0003a330: 2020 6d65 7472 6963 5f74 7970 653d 6d65    metric_type=me
+0003a340: 7472 6963 5f74 7970 652c 0a20 2020 2020  tric_type,.     
+0003a350: 2020 2020 2020 2063 7573 746f 6d5f 696e         custom_in
+0003a360: 6465 783d 6375 7374 6f6d 5f69 6e64 6578  dex=custom_index
+0003a370: 2c0a 2020 2020 2020 2020 2020 2020 6261  ,.            ba
+0003a380: 7463 685f 7369 7a65 3d62 6174 6368 5f73  tch_size=batch_s
+0003a390: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+0003a3a0: 2074 7261 696e 5f73 697a 653d 7472 6169   train_size=trai
+0003a3b0: 6e5f 7369 7a65 2c0a 2020 2020 2020 2020  n_size,.        
+0003a3c0: 2020 2020 6661 6973 735f 7665 7262 6f73      faiss_verbos
+0003a3d0: 653d 6661 6973 735f 7665 7262 6f73 652c  e=faiss_verbose,
+0003a3e0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0003a3f0: 6465 6620 6164 645f 656c 6173 7469 6373  def add_elastics
+0003a400: 6561 7263 685f 696e 6465 7828 0a20 2020  earch_index(.   
+0003a410: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0003a420: 2020 2063 6f6c 756d 6e3a 2073 7472 2c0a     column: str,.
+0003a430: 2020 2020 2020 2020 696e 6465 785f 6e61          index_na
+0003a440: 6d65 3a20 4f70 7469 6f6e 616c 5b73 7472  me: Optional[str
+0003a450: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0003a460: 2020 686f 7374 3a20 4f70 7469 6f6e 616c    host: Optional
+0003a470: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+0003a480: 2020 2020 2020 706f 7274 3a20 4f70 7469        port: Opti
+0003a490: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
+0003a4a0: 2c0a 2020 2020 2020 2020 6573 5f63 6c69  ,.        es_cli
+0003a4b0: 656e 743a 204f 7074 696f 6e61 6c5b 2265  ent: Optional["e
+0003a4c0: 6c61 7374 6963 7365 6172 6368 2e45 6c61  lasticsearch.Ela
+0003a4d0: 7374 6963 7365 6172 6368 225d 203d 204e  sticsearch"] = N
+0003a4e0: 6f6e 652c 2020 2320 6e6f 7161 3a20 4638  one,  # noqa: F8
+0003a4f0: 3231 0a20 2020 2020 2020 2065 735f 696e  21.        es_in
+0003a500: 6465 785f 6e61 6d65 3a20 4f70 7469 6f6e  dex_name: Option
+0003a510: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+0003a520: 2020 2020 2020 2020 6573 5f69 6e64 6578          es_index
+0003a530: 5f63 6f6e 6669 673a 204f 7074 696f 6e61  _config: Optiona
+0003a540: 6c5b 6469 6374 5d20 3d20 4e6f 6e65 2c0a  l[dict] = None,.
+0003a550: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+0003a560: 2222 4164 6420 6120 7465 7874 2069 6e64  ""Add a text ind
+0003a570: 6578 2075 7369 6e67 2045 6c61 7374 6963  ex using Elastic
+0003a580: 5365 6172 6368 2066 6f72 2066 6173 7420  Search for fast 
+0003a590: 7265 7472 6965 7661 6c2e 2054 6869 7320  retrieval. This 
+0003a5a0: 6973 2064 6f6e 6520 696e 2d70 6c61 6365  is done in-place
+0003a5b0: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+0003a5c0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+0003a5d0: 756d 6e20 2860 7374 7260 293a 0a20 2020  umn (`str`):.   
+0003a5e0: 2020 2020 2020 2020 2020 2020 2054 6865               The
+0003a5f0: 2063 6f6c 756d 6e20 6f66 2074 6865 2064   column of the d
+0003a600: 6f63 756d 656e 7473 2074 6f20 6164 6420  ocuments to add 
+0003a610: 746f 2074 6865 2069 6e64 6578 2e0a 2020  to the index..  
+0003a620: 2020 2020 2020 2020 2020 696e 6465 785f            index_
+0003a630: 6e61 6d65 2028 6073 7472 602c 202a 6f70  name (`str`, *op
+0003a640: 7469 6f6e 616c 2a29 3a0a 2020 2020 2020  tional*):.      
+0003a650: 2020 2020 2020 2020 2020 5468 6520 6069            The `i
+0003a660: 6e64 6578 5f6e 616d 6560 2f69 6465 6e74  ndex_name`/ident
+0003a670: 6966 6965 7220 6f66 2074 6865 2069 6e64  ifier of the ind
+0003a680: 6578 2e0a 2020 2020 2020 2020 2020 2020  ex..            
+0003a690: 2020 2020 5468 6973 2069 7320 7468 6520      This is the 
+0003a6a0: 696e 6465 7820 6e61 6d65 2074 6861 7420  index name that 
+0003a6b0: 6973 2075 7365 6420 746f 2063 616c 6c20  is used to call 
+0003a6c0: 5b60 7e44 6174 6173 6574 2e67 6574 5f6e  [`~Dataset.get_n
+0003a6d0: 6561 7265 7374 5f65 7861 6d70 6c65 7360  earest_examples`
+0003a6e0: 5d20 6f72 205b 6044 6174 6173 6574 2e73  ] or [`Dataset.s
+0003a6f0: 6561 7263 6860 5d2e 0a20 2020 2020 2020  earch`]..       
+0003a700: 2020 2020 2020 2020 2042 7920 6465 6661           By defa
+0003a710: 756c 7420 6974 2063 6f72 7265 7370 6f6e  ult it correspon
+0003a720: 6473 2074 6f20 6063 6f6c 756d 6e60 2e0a  ds to `column`..
+0003a730: 2020 2020 2020 2020 2020 2020 686f 7374              host
+0003a740: 2028 6073 7472 602c 202a 6f70 7469 6f6e   (`str`, *option
+0003a750: 616c 2a2c 2064 6566 6175 6c74 7320 746f  al*, defaults to
+0003a760: 2060 6c6f 6361 6c68 6f73 7460 293a 0a20   `localhost`):. 
+0003a770: 2020 2020 2020 2020 2020 2020 2020 2048                 H
+0003a780: 6f73 7420 6f66 2077 6865 7265 2045 6c61  ost of where Ela
+0003a790: 7374 6963 5365 6172 6368 2069 7320 7275  sticSearch is ru
+0003a7a0: 6e6e 696e 672e 0a20 2020 2020 2020 2020  nning..         
+0003a7b0: 2020 2070 6f72 7420 2860 7374 7260 2c20     port (`str`, 
+0003a7c0: 2a6f 7074 696f 6e61 6c2a 2c20 6465 6661  *optional*, defa
+0003a7d0: 756c 7473 2074 6f20 6039 3230 3060 293a  ults to `9200`):
+0003a7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a7f0: 2050 6f72 7420 6f66 2077 6865 7265 2045   Port of where E
+0003a800: 6c61 7374 6963 5365 6172 6368 2069 7320  lasticSearch is 
+0003a810: 7275 6e6e 696e 672e 0a20 2020 2020 2020  running..       
+0003a820: 2020 2020 2065 735f 636c 6965 6e74 2028       es_client (
+0003a830: 6065 6c61 7374 6963 7365 6172 6368 2e45  `elasticsearch.E
+0003a840: 6c61 7374 6963 7365 6172 6368 602c 202a  lasticsearch`, *
+0003a850: 6f70 7469 6f6e 616c 2a29 3a0a 2020 2020  optional*):.    
+0003a860: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0003a870: 656c 6173 7469 6373 6561 7263 6820 636c  elasticsearch cl
+0003a880: 6965 6e74 2075 7365 6420 746f 2063 7265  ient used to cre
+0003a890: 6174 6520 7468 6520 696e 6465 7820 6966  ate the index if
+0003a8a0: 2068 6f73 7420 616e 6420 706f 7274 2061   host and port a
+0003a8b0: 7265 2060 4e6f 6e65 602e 0a20 2020 2020  re `None`..     
+0003a8c0: 2020 2020 2020 2065 735f 696e 6465 785f         es_index_
+0003a8d0: 6e61 6d65 2028 6073 7472 602c 202a 6f70  name (`str`, *op
+0003a8e0: 7469 6f6e 616c 2a29 3a0a 2020 2020 2020  tional*):.      
+0003a8f0: 2020 2020 2020 2020 2020 5468 6520 656c            The el
+0003a900: 6173 7469 6373 6561 7263 6820 696e 6465  asticsearch inde
+0003a910: 7820 6e61 6d65 2075 7365 6420 746f 2063  x name used to c
+0003a920: 7265 6174 6520 7468 6520 696e 6465 782e  reate the index.
+0003a930: 0a20 2020 2020 2020 2020 2020 2065 735f  .            es_
+0003a940: 696e 6465 785f 636f 6e66 6967 2028 6064  index_config (`d
+0003a950: 6963 7460 2c20 2a6f 7074 696f 6e61 6c2a  ict`, *optional*
+0003a960: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0003a970: 2020 2054 6865 2063 6f6e 6669 6775 7261     The configura
+0003a980: 7469 6f6e 206f 6620 7468 6520 656c 6173  tion of the elas
+0003a990: 7469 6373 6561 7263 6820 696e 6465 782e  ticsearch index.
+0003a9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a9b0: 2044 6566 6175 6c74 2063 6f6e 6669 6720   Default config 
+0003a9c0: 6973 3a0a 2020 2020 2020 2020 2020 2020  is:.            
+0003a9d0: 2020 2020 2020 2020 6060 600a 2020 2020          ```.    
+0003a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a9f0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0003aa00: 2020 2020 2020 2020 2020 2273 6574 7469            "setti
+0003aa10: 6e67 7322 3a20 7b0a 2020 2020 2020 2020  ngs": {.        
+0003aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aa30: 2020 2020 226e 756d 6265 725f 6f66 5f73      "number_of_s
+0003aa40: 6861 7264 7322 3a20 312c 0a20 2020 2020  hards": 1,.     
+0003aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aa60: 2020 2020 2020 2022 616e 616c 7973 6973         "analysis
+0003aa70: 223a 207b 2261 6e61 6c79 7a65 7222 3a20  ": {"analyzer": 
+0003aa80: 7b22 7374 6f70 5f73 7461 6e64 6172 6422  {"stop_standard"
+0003aa90: 3a20 7b22 7479 7065 223a 2022 7374 616e  : {"type": "stan
+0003aaa0: 6461 7264 222c 2022 2073 746f 7077 6f72  dard", " stopwor
+0003aab0: 6473 223a 2022 5f65 6e67 6c69 7368 5f22  ds": "_english_"
+0003aac0: 7d7d 7d2c 0a20 2020 2020 2020 2020 2020  }}},.           
+0003aad0: 2020 2020 2020 2020 2020 2020 207d 2c0a               },.
+0003aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aaf0: 2020 2020 2020 2020 226d 6170 7069 6e67          "mapping
+0003ab00: 7322 3a20 7b0a 2020 2020 2020 2020 2020  s": {.          
+0003ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ab20: 2020 2270 726f 7065 7274 6965 7322 3a20    "properties": 
+0003ab30: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0003ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ab50: 2020 2274 6578 7422 3a20 7b0a 2020 2020    "text": {.    
+0003ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0003ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ab80: 5468 6973 2069 7320 7468 6520 696e 6465  This is the inde
-0003ab90: 7820 6e61 6d65 2074 6861 7420 6973 2075  x name that is u
-0003aba0: 7365 6420 746f 2063 616c 6c20 5b60 7e44  sed to call [`~D
-0003abb0: 6174 6173 6574 2e67 6574 5f6e 6561 7265  ataset.get_neare
-0003abc0: 7374 5f65 7861 6d70 6c65 7360 5d20 6f72  st_examples`] or
-0003abd0: 205b 6044 6174 6173 6574 2e73 6561 7263   [`Dataset.searc
-0003abe0: 6860 5d2e 0a20 2020 2020 2020 2020 2020  h`]..           
-0003abf0: 2020 2020 2042 7920 6465 6661 756c 7420       By default 
-0003ac00: 6974 2063 6f72 7265 7370 6f6e 6473 2074  it corresponds t
-0003ac10: 6f20 6063 6f6c 756d 6e60 2e0a 2020 2020  o `column`..    
-0003ac20: 2020 2020 2020 2020 686f 7374 2028 6073          host (`s
-0003ac30: 7472 602c 202a 6f70 7469 6f6e 616c 2a2c  tr`, *optional*,
-0003ac40: 2064 6566 6175 6c74 7320 746f 2060 6c6f   defaults to `lo
-0003ac50: 6361 6c68 6f73 7460 293a 0a20 2020 2020  calhost`):.     
-0003ac60: 2020 2020 2020 2020 2020 2048 6f73 7420             Host 
-0003ac70: 6f66 2077 6865 7265 2045 6c61 7374 6963  of where Elastic
-0003ac80: 5365 6172 6368 2069 7320 7275 6e6e 696e  Search is runnin
-0003ac90: 672e 0a20 2020 2020 2020 2020 2020 2070  g..            p
-0003aca0: 6f72 7420 2860 7374 7260 2c20 2a6f 7074  ort (`str`, *opt
-0003acb0: 696f 6e61 6c2a 2c20 6465 6661 756c 7473  ional*, defaults
-0003acc0: 2074 6f20 6039 3230 3060 293a 0a20 2020   to `9200`):.   
-0003acd0: 2020 2020 2020 2020 2020 2020 2050 6f72               Por
-0003ace0: 7420 6f66 2077 6865 7265 2045 6c61 7374  t of where Elast
-0003acf0: 6963 5365 6172 6368 2069 7320 7275 6e6e  icSearch is runn
-0003ad00: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-0003ad10: 2065 735f 636c 6965 6e74 2028 6065 6c61   es_client (`ela
-0003ad20: 7374 6963 7365 6172 6368 2e45 6c61 7374  sticsearch.Elast
-0003ad30: 6963 7365 6172 6368 602c 202a 6f70 7469  icsearch`, *opti
-0003ad40: 6f6e 616c 2a29 3a0a 2020 2020 2020 2020  onal*):.        
-0003ad50: 2020 2020 2020 2020 5468 6520 656c 6173          The elas
-0003ad60: 7469 6373 6561 7263 6820 636c 6965 6e74  ticsearch client
-0003ad70: 2075 7365 6420 746f 2063 7265 6174 6520   used to create 
-0003ad80: 7468 6520 696e 6465 7820 6966 2068 6f73  the index if hos
-0003ad90: 7420 616e 6420 706f 7274 2061 7265 2060  t and port are `
-0003ada0: 4e6f 6e65 602e 0a20 2020 2020 2020 2020  None`..         
-0003adb0: 2020 2065 735f 696e 6465 785f 6e61 6d65     es_index_name
-0003adc0: 2028 6073 7472 602c 202a 6f70 7469 6f6e   (`str`, *option
-0003add0: 616c 2a29 3a0a 2020 2020 2020 2020 2020  al*):.          
-0003ade0: 2020 2020 2020 5468 6520 656c 6173 7469        The elasti
-0003adf0: 6373 6561 7263 6820 696e 6465 7820 6e61  csearch index na
-0003ae00: 6d65 2075 7365 6420 746f 2063 7265 6174  me used to creat
-0003ae10: 6520 7468 6520 696e 6465 782e 0a20 2020  e the index..   
-0003ae20: 2020 2020 2020 2020 2065 735f 696e 6465           es_inde
-0003ae30: 785f 636f 6e66 6967 2028 6064 6963 7460  x_config (`dict`
-0003ae40: 2c20 2a6f 7074 696f 6e61 6c2a 293a 0a20  , *optional*):. 
-0003ae50: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-0003ae60: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
-0003ae70: 206f 6620 7468 6520 656c 6173 7469 6373   of the elastics
-0003ae80: 6561 7263 6820 696e 6465 782e 0a20 2020  earch index..   
-0003ae90: 2020 2020 2020 2020 2020 2020 2044 6566               Def
-0003aea0: 6175 6c74 2063 6f6e 6669 6720 6973 3a0a  ault config is:.
-0003aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aec0: 2020 2020 6060 600a 2020 2020 2020 2020      ```.        
-0003aed0: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
-0003aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aef0: 2020 2020 2020 2273 6574 7469 6e67 7322        "settings"
-0003af00: 3a20 7b0a 2020 2020 2020 2020 2020 2020  : {.            
-0003af10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003af20: 226e 756d 6265 725f 6f66 5f73 6861 7264  "number_of_shard
-0003af30: 7322 3a20 312c 0a20 2020 2020 2020 2020  s": 1,.         
-0003af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003af50: 2020 2022 616e 616c 7973 6973 223a 207b     "analysis": {
-0003af60: 2261 6e61 6c79 7a65 7222 3a20 7b22 7374  "analyzer": {"st
-0003af70: 6f70 5f73 7461 6e64 6172 6422 3a20 7b22  op_standard": {"
-0003af80: 7479 7065 223a 2022 7374 616e 6461 7264  type": "standard
-0003af90: 222c 2022 2073 746f 7077 6f72 6473 223a  ", " stopwords":
-0003afa0: 2022 5f65 6e67 6c69 7368 5f22 7d7d 7d2c   "_english_"}}},
-0003afb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003afc0: 2020 2020 2020 2020 207d 2c0a 2020 2020           },.    
-0003afd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003afe0: 2020 2020 226d 6170 7069 6e67 7322 3a20      "mappings": 
-0003aff0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0003b000: 2020 2020 2020 2020 2020 2020 2020 2270                "p
-0003b010: 726f 7065 7274 6965 7322 3a20 7b0a 2020  roperties": {.  
-0003b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b030: 2020 2020 2020 2020 2020 2020 2020 2274                "t
-0003b040: 6578 7422 3a20 7b0a 2020 2020 2020 2020  ext": {.        
-0003b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b060: 2020 2020 2020 2020 2020 2020 2274 7970              "typ
-0003b070: 6522 3a20 2274 6578 7422 2c0a 2020 2020  e": "text",.    
-0003b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b0a0: 2261 6e61 6c79 7a65 7222 3a20 2273 7461  "analyzer": "sta
-0003b0b0: 6e64 6172 6422 2c0a 2020 2020 2020 2020  ndard",.        
-0003b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b0d0: 2020 2020 2020 2020 2020 2020 2273 696d              "sim
-0003b0e0: 696c 6172 6974 7922 3a20 2242 4d32 3522  ilarity": "BM25"
-0003b0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b110: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
-0003b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b130: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0003b140: 2020 2020 2020 2020 2020 7d2c 0a20 2020            },.   
-0003b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b160: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
-0003b170: 2020 2020 2020 2060 6060 0a20 2020 2020         ```.     
-0003b180: 2020 2045 7861 6d70 6c65 3a0a 0a20 2020     Example:..   
-0003b190: 2020 2020 2060 6060 7079 7468 6f6e 0a20       ```python. 
-0003b1a0: 2020 2020 2020 203e 3e3e 2065 735f 636c         >>> es_cl
-0003b1b0: 6965 6e74 203d 2065 6c61 7374 6963 7365  ient = elasticse
-0003b1c0: 6172 6368 2e45 6c61 7374 6963 7365 6172  arch.Elasticsear
-0003b1d0: 6368 2829 0a20 2020 2020 2020 203e 3e3e  ch().        >>>
-0003b1e0: 2064 7320 3d20 6461 7461 7365 7473 2e6c   ds = datasets.l
-0003b1f0: 6f61 645f 6461 7461 7365 7428 2763 7269  oad_dataset('cri
-0003b200: 6d65 5f61 6e64 5f70 756e 6973 6827 2c20  me_and_punish', 
-0003b210: 7370 6c69 743d 2774 7261 696e 2729 0a20  split='train'). 
-0003b220: 2020 2020 2020 203e 3e3e 2064 732e 6164         >>> ds.ad
-0003b230: 645f 656c 6173 7469 6373 6561 7263 685f  d_elasticsearch_
-0003b240: 696e 6465 7828 636f 6c75 6d6e 3d27 6c69  index(column='li
-0003b250: 6e65 272c 2065 735f 636c 6965 6e74 3d65  ne', es_client=e
-0003b260: 735f 636c 6965 6e74 2c20 6573 5f69 6e64  s_client, es_ind
-0003b270: 6578 5f6e 616d 653d 226d 795f 6573 5f69  ex_name="my_es_i
-0003b280: 6e64 6578 2229 0a20 2020 2020 2020 203e  ndex").        >
-0003b290: 3e3e 2073 636f 7265 732c 2072 6574 7269  >> scores, retri
-0003b2a0: 6576 6564 5f65 7861 6d70 6c65 7320 3d20  eved_examples = 
-0003b2b0: 6473 2e67 6574 5f6e 6561 7265 7374 5f65  ds.get_nearest_e
-0003b2c0: 7861 6d70 6c65 7328 276c 696e 6527 2c20  xamples('line', 
-0003b2d0: 276d 7920 6e65 7720 7175 6572 7927 2c20  'my new query', 
-0003b2e0: 6b3d 3130 290a 2020 2020 2020 2020 6060  k=10).        ``
-0003b2f0: 600a 2020 2020 2020 2020 2222 220a 2020  `.        """.  
-0003b300: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-0003b310: 666f 726d 6174 7465 645f 6173 2874 7970  formatted_as(typ
-0003b320: 653d 4e6f 6e65 2c20 636f 6c75 6d6e 733d  e=None, columns=
-0003b330: 5b63 6f6c 756d 6e5d 293a 0a20 2020 2020  [column]):.     
-0003b340: 2020 2020 2020 2073 7570 6572 2829 2e61         super().a
-0003b350: 6464 5f65 6c61 7374 6963 7365 6172 6368  dd_elasticsearch
-0003b360: 5f69 6e64 6578 280a 2020 2020 2020 2020  _index(.        
-0003b370: 2020 2020 2020 2020 636f 6c75 6d6e 3d63          column=c
-0003b380: 6f6c 756d 6e2c 0a20 2020 2020 2020 2020  olumn,.         
-0003b390: 2020 2020 2020 2069 6e64 6578 5f6e 616d         index_nam
-0003b3a0: 653d 696e 6465 785f 6e61 6d65 2c0a 2020  e=index_name,.  
-0003b3b0: 2020 2020 2020 2020 2020 2020 2020 686f                ho
-0003b3c0: 7374 3d68 6f73 742c 0a20 2020 2020 2020  st=host,.       
-0003b3d0: 2020 2020 2020 2020 2070 6f72 743d 706f           port=po
-0003b3e0: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
-0003b3f0: 2020 2020 6573 5f63 6c69 656e 743d 6573      es_client=es
-0003b400: 5f63 6c69 656e 742c 0a20 2020 2020 2020  _client,.       
-0003b410: 2020 2020 2020 2020 2065 735f 696e 6465           es_inde
-0003b420: 785f 6e61 6d65 3d65 735f 696e 6465 785f  x_name=es_index_
-0003b430: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-0003b440: 2020 2020 2020 6573 5f69 6e64 6578 5f63        es_index_c
-0003b450: 6f6e 6669 673d 6573 5f69 6e64 6578 5f63  onfig=es_index_c
-0003b460: 6f6e 6669 672c 0a20 2020 2020 2020 2020  onfig,.         
-0003b470: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
-0003b480: 7572 6e20 7365 6c66 0a0a 2020 2020 4074  urn self..    @t
-0003b490: 7261 6e73 6d69 745f 666f 726d 6174 0a20  ransmit_format. 
-0003b4a0: 2020 2040 6669 6e67 6572 7072 696e 745f     @fingerprint_
-0003b4b0: 7472 616e 7366 6f72 6d28 696e 706c 6163  transform(inplac
-0003b4c0: 653d 4661 6c73 6529 0a20 2020 2064 6566  e=False).    def
-0003b4d0: 2061 6464 5f69 7465 6d28 7365 6c66 2c20   add_item(self, 
-0003b4e0: 6974 656d 3a20 6469 6374 2c20 6e65 775f  item: dict, new_
-0003b4f0: 6669 6e67 6572 7072 696e 743a 2073 7472  fingerprint: str
-0003b500: 293a 0a20 2020 2020 2020 2022 2222 4164  ):.        """Ad
-0003b510: 6420 6974 656d 2074 6f20 4461 7461 7365  d item to Datase
-0003b520: 742e 0a0a 2020 2020 2020 2020 3c41 6464  t...        <Add
-0003b530: 6564 2076 6572 7369 6f6e 3d22 312e 3722  ed version="1.7"
-0003b540: 2f3e 0a0a 2020 2020 2020 2020 4172 6773  />..        Args
-0003b550: 3a0a 2020 2020 2020 2020 2020 2020 6974  :.            it
-0003b560: 656d 2028 6064 6963 7460 293a 0a20 2020  em (`dict`):.   
-0003b570: 2020 2020 2020 2020 2020 2020 2049 7465               Ite
-0003b580: 6d20 6461 7461 2074 6f20 6265 2061 6464  m data to be add
-0003b590: 6564 2e0a 0a20 2020 2020 2020 2052 6574  ed...        Ret
-0003b5a0: 7572 6e73 3a0a 2020 2020 2020 2020 2020  urns:.          
-0003b5b0: 2020 5b60 4461 7461 7365 7460 5d0a 0a20    [`Dataset`].. 
-0003b5c0: 2020 2020 2020 2045 7861 6d70 6c65 3a0a         Example:.
-0003b5d0: 0a20 2020 2020 2020 2060 6060 7079 0a20  .        ```py. 
-0003b5e0: 2020 2020 2020 203e 3e3e 2066 726f 6d20         >>> from 
-0003b5f0: 6461 7461 7365 7473 2069 6d70 6f72 7420  datasets import 
-0003b600: 6c6f 6164 5f64 6174 6173 6574 0a20 2020  load_dataset.   
-0003b610: 2020 2020 203e 3e3e 2064 7320 3d20 6c6f       >>> ds = lo
-0003b620: 6164 5f64 6174 6173 6574 2822 726f 7474  ad_dataset("rott
-0003b630: 656e 5f74 6f6d 6174 6f65 7322 2c20 7370  en_tomatoes", sp
-0003b640: 6c69 743d 2276 616c 6964 6174 696f 6e22  lit="validation"
-0003b650: 290a 2020 2020 2020 2020 3e3e 3e20 6e65  ).        >>> ne
-0003b660: 775f 7265 7669 6577 203d 207b 276c 6162  w_review = {'lab
-0003b670: 656c 273a 2030 2c20 2774 6578 7427 3a20  el': 0, 'text': 
-0003b680: 2774 6869 7320 6d6f 7669 6520 6973 2074  'this movie is t
-0003b690: 6865 2061 6273 6f6c 7574 6520 776f 7273  he absolute wors
-0003b6a0: 7420 7468 696e 6720 4920 6861 7665 2065  t thing I have e
-0003b6b0: 7665 7220 7365 656e 277d 0a20 2020 2020  ver seen'}.     
-0003b6c0: 2020 203e 3e3e 2064 7320 3d20 6473 2e61     >>> ds = ds.a
-0003b6d0: 6464 5f69 7465 6d28 6e65 775f 7265 7669  dd_item(new_revi
-0003b6e0: 6577 290a 2020 2020 2020 2020 3e3e 3e20  ew).        >>> 
-0003b6f0: 6473 5b2d 315d 0a20 2020 2020 2020 207b  ds[-1].        {
-0003b700: 276c 6162 656c 273a 2030 2c20 2774 6578  'label': 0, 'tex
-0003b710: 7427 3a20 2774 6869 7320 6d6f 7669 6520  t': 'this movie 
-0003b720: 6973 2074 6865 2061 6273 6f6c 7574 6520  is the absolute 
-0003b730: 776f 7273 7420 7468 696e 6720 4920 6861  worst thing I ha
-0003b740: 7665 2065 7665 7220 7365 656e 277d 0a20  ve ever seen'}. 
-0003b750: 2020 2020 2020 2060 6060 0a20 2020 2020         ```.     
-0003b760: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0003b770: 7465 6d5f 7461 626c 6520 3d20 496e 4d65  tem_table = InMe
-0003b780: 6d6f 7279 5461 626c 652e 6672 6f6d 5f70  moryTable.from_p
-0003b790: 7964 6963 7428 7b6b 3a20 5b76 5d20 666f  ydict({k: [v] fo
-0003b7a0: 7220 6b2c 2076 2069 6e20 6974 656d 2e69  r k, v in item.i
-0003b7b0: 7465 6d73 2829 7d29 0a20 2020 2020 2020  tems()}).       
-0003b7c0: 2023 2057 6520 646f 6e27 7420 6361 6c6c   # We don't call
-0003b7d0: 205f 6368 6563 6b5f 6966 5f66 6561 7475   _check_if_featu
-0003b7e0: 7265 735f 6361 6e5f 6265 5f61 6c69 676e  res_can_be_align
-0003b7f0: 6564 2068 6572 6520 736f 2074 6869 7320  ed here so this 
-0003b800: 6361 7374 2069 7320 2275 6e73 6166 6522  cast is "unsafe"
-0003b810: 0a20 2020 2020 2020 2064 7365 745f 6665  .        dset_fe
-0003b820: 6174 7572 6573 2c20 6974 656d 5f66 6561  atures, item_fea
-0003b830: 7475 7265 7320 3d20 5f61 6c69 676e 5f66  tures = _align_f
-0003b840: 6561 7475 7265 7328 5b73 656c 662e 6665  eatures([self.fe
-0003b850: 6174 7572 6573 2c20 4665 6174 7572 6573  atures, Features
-0003b860: 2e66 726f 6d5f 6172 726f 775f 7363 6865  .from_arrow_sche
-0003b870: 6d61 2869 7465 6d5f 7461 626c 652e 7363  ma(item_table.sc
-0003b880: 6865 6d61 295d 290a 2020 2020 2020 2020  hema)]).        
-0003b890: 2320 4361 7374 2074 6f20 616c 6967 6e20  # Cast to align 
-0003b8a0: 7468 6520 7363 6865 6d61 7320 6f66 2074  the schemas of t
-0003b8b0: 6865 2074 6162 6c65 7320 616e 6420 636f  he tables and co
-0003b8c0: 6e63 6174 656e 6174 6520 7468 6520 7461  ncatenate the ta
-0003b8d0: 626c 6573 0a20 2020 2020 2020 2074 6162  bles.        tab
-0003b8e0: 6c65 203d 2063 6f6e 6361 745f 7461 626c  le = concat_tabl
-0003b8f0: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
-0003b900: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-0003b910: 2020 7365 6c66 2e5f 6461 7461 2e63 6173    self._data.cas
-0003b920: 7428 6473 6574 5f66 6561 7475 7265 732e  t(dset_features.
-0003b930: 6172 726f 775f 7363 6865 6d61 2920 6966  arrow_schema) if
-0003b940: 2073 656c 662e 6665 6174 7572 6573 2021   self.features !
-0003b950: 3d20 6473 6574 5f66 6561 7475 7265 7320  = dset_features 
-0003b960: 656c 7365 2073 656c 662e 5f64 6174 612c  else self._data,
-0003b970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003b980: 2069 7465 6d5f 7461 626c 652e 6361 7374   item_table.cast
-0003b990: 2869 7465 6d5f 6665 6174 7572 6573 2e61  (item_features.a
-0003b9a0: 7272 6f77 5f73 6368 656d 6129 2c0a 2020  rrow_schema),.  
-0003b9b0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-0003b9c0: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
-0003b9d0: 2073 656c 662e 5f69 6e64 6963 6573 2069   self._indices i
-0003b9e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0003b9f0: 2020 2020 696e 6469 6365 735f 7461 626c      indices_tabl
-0003ba00: 6520 3d20 4e6f 6e65 0a20 2020 2020 2020  e = None.       
-0003ba10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0003ba20: 2020 2069 7465 6d5f 696e 6469 6365 735f     item_indices_
-0003ba30: 6172 7261 7920 3d20 7061 2e61 7272 6179  array = pa.array
-0003ba40: 285b 6c65 6e28 7365 6c66 2e5f 6461 7461  ([len(self._data
-0003ba50: 295d 2c20 7479 7065 3d70 612e 7569 6e74  )], type=pa.uint
-0003ba60: 3634 2829 290a 2020 2020 2020 2020 2020  64()).          
-0003ba70: 2020 6974 656d 5f69 6e64 6963 6573 5f74    item_indices_t
-0003ba80: 6162 6c65 203d 2049 6e4d 656d 6f72 7954  able = InMemoryT
-0003ba90: 6162 6c65 2e66 726f 6d5f 6172 7261 7973  able.from_arrays
-0003baa0: 285b 6974 656d 5f69 6e64 6963 6573 5f61  ([item_indices_a
-0003bab0: 7272 6179 5d2c 206e 616d 6573 3d5b 2269  rray], names=["i
-0003bac0: 6e64 6963 6573 225d 290a 2020 2020 2020  ndices"]).      
-0003bad0: 2020 2020 2020 696e 6469 6365 735f 7461        indices_ta
-0003bae0: 626c 6520 3d20 636f 6e63 6174 5f74 6162  ble = concat_tab
-0003baf0: 6c65 7328 5b73 656c 662e 5f69 6e64 6963  les([self._indic
-0003bb00: 6573 2c20 6974 656d 5f69 6e64 6963 6573  es, item_indices
-0003bb10: 5f74 6162 6c65 5d29 0a20 2020 2020 2020  _table]).       
-0003bb20: 2069 6e66 6f20 3d20 7365 6c66 2e69 6e66   info = self.inf
-0003bb30: 6f2e 636f 7079 2829 0a20 2020 2020 2020  o.copy().       
-0003bb40: 2069 6e66 6f2e 6665 6174 7572 6573 2e75   info.features.u
-0003bb50: 7064 6174 6528 6974 656d 5f66 6561 7475  pdate(item_featu
-0003bb60: 7265 7329 0a20 2020 2020 2020 2074 6162  res).        tab
-0003bb70: 6c65 203d 2075 7064 6174 655f 6d65 7461  le = update_meta
-0003bb80: 6461 7461 5f77 6974 685f 6665 6174 7572  data_with_featur
-0003bb90: 6573 2874 6162 6c65 2c20 696e 666f 2e66  es(table, info.f
-0003bba0: 6561 7475 7265 7329 0a20 2020 2020 2020  eatures).       
-0003bbb0: 2072 6574 7572 6e20 4461 7461 7365 7428   return Dataset(
-0003bbc0: 0a20 2020 2020 2020 2020 2020 2074 6162  .            tab
-0003bbd0: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-0003bbe0: 696e 666f 3d69 6e66 6f2c 0a20 2020 2020  info=info,.     
-0003bbf0: 2020 2020 2020 2073 706c 6974 3d73 656c         split=sel
-0003bc00: 662e 7370 6c69 742c 0a20 2020 2020 2020  f.split,.       
-0003bc10: 2020 2020 2069 6e64 6963 6573 5f74 6162       indices_tab
-0003bc20: 6c65 3d69 6e64 6963 6573 5f74 6162 6c65  le=indices_table
-0003bc30: 2c0a 2020 2020 2020 2020 2020 2020 6669  ,.            fi
-0003bc40: 6e67 6572 7072 696e 743d 6e65 775f 6669  ngerprint=new_fi
-0003bc50: 6e67 6572 7072 696e 742c 0a20 2020 2020  ngerprint,.     
-0003bc60: 2020 2029 0a0a 2020 2020 6465 6620 616c     )..    def al
-0003bc70: 6967 6e5f 6c61 6265 6c73 5f77 6974 685f  ign_labels_with_
-0003bc80: 6d61 7070 696e 6728 7365 6c66 2c20 6c61  mapping(self, la
-0003bc90: 6265 6c32 6964 3a20 4469 6374 2c20 6c61  bel2id: Dict, la
-0003bca0: 6265 6c5f 636f 6c75 6d6e 3a20 7374 7229  bel_column: str)
-0003bcb0: 202d 3e20 2244 6174 6173 6574 223a 0a20   -> "Dataset":. 
-0003bcc0: 2020 2020 2020 2022 2222 416c 6967 6e20         """Align 
-0003bcd0: 7468 6520 6461 7461 7365 7427 7320 6c61  the dataset's la
-0003bce0: 6265 6c20 4944 2061 6e64 206c 6162 656c  bel ID and label
-0003bcf0: 206e 616d 6520 6d61 7070 696e 6720 746f   name mapping to
-0003bd00: 206d 6174 6368 2061 6e20 696e 7075 7420   match an input 
-0003bd10: 606c 6162 656c 3269 6460 206d 6170 7069  `label2id` mappi
-0003bd20: 6e67 2e0a 2020 2020 2020 2020 5468 6973  ng..        This
-0003bd30: 2069 7320 7573 6566 756c 2077 6865 6e20   is useful when 
-0003bd40: 796f 7520 7761 6e74 2074 6f20 656e 7375  you want to ensu
-0003bd50: 7265 2074 6861 7420 6120 6d6f 6465 6c27  re that a model'
-0003bd60: 7320 7072 6564 6963 7465 6420 6c61 6265  s predicted labe
-0003bd70: 6c73 2061 7265 2061 6c69 676e 6564 2077  ls are aligned w
-0003bd80: 6974 6820 7468 6520 6461 7461 7365 742e  ith the dataset.
-0003bd90: 0a20 2020 2020 2020 2054 6865 2061 6c69  .        The ali
-0003bda0: 676e 6d65 6e74 2069 6e20 646f 6e65 2075  gnment in done u
-0003bdb0: 7369 6e67 2074 6865 206c 6f77 6572 6361  sing the lowerca
-0003bdc0: 7365 206c 6162 656c 206e 616d 6573 2e0a  se label names..
-0003bdd0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-0003bde0: 2020 2020 2020 2020 2020 206c 6162 656c             label
-0003bdf0: 3269 6420 2860 6469 6374 6029 3a0a 2020  2id (`dict`):.  
-0003be00: 2020 2020 2020 2020 2020 2020 2020 5468                Th
-0003be10: 6520 6c61 6265 6c20 6e61 6d65 2074 6f20  e label name to 
-0003be20: 4944 206d 6170 7069 6e67 2074 6f20 616c  ID mapping to al
-0003be30: 6967 6e20 7468 6520 6461 7461 7365 7420  ign the dataset 
-0003be40: 7769 7468 2e0a 2020 2020 2020 2020 2020  with..          
-0003be50: 2020 6c61 6265 6c5f 636f 6c75 6d6e 2028    label_column (
-0003be60: 6073 7472 6029 3a0a 2020 2020 2020 2020  `str`):.        
-0003be70: 2020 2020 2020 2020 5468 6520 636f 6c75          The colu
-0003be80: 6d6e 206e 616d 6520 6f66 206c 6162 656c  mn name of label
-0003be90: 7320 746f 2061 6c69 676e 206f 6e2e 0a0a  s to align on...
-0003bea0: 2020 2020 2020 2020 4578 616d 706c 653a          Example:
-0003beb0: 0a0a 2020 2020 2020 2020 6060 6070 7974  ..        ```pyt
-0003bec0: 686f 6e0a 2020 2020 2020 2020 3e3e 3e20  hon.        >>> 
-0003bed0: 2320 6461 7461 7365 7420 7769 7468 206d  # dataset with m
-0003bee0: 6170 7069 6e67 207b 2765 6e74 6169 6c6d  apping {'entailm
-0003bef0: 656e 7427 3a20 302c 2027 6e65 7574 7261  ent': 0, 'neutra
-0003bf00: 6c27 3a20 312c 2027 636f 6e74 7261 6469  l': 1, 'contradi
-0003bf10: 6374 696f 6e27 3a20 327d 0a20 2020 2020  ction': 2}.     
-0003bf20: 2020 203e 3e3e 2064 7320 3d20 6c6f 6164     >>> ds = load
-0003bf30: 5f64 6174 6173 6574 2822 676c 7565 222c  _dataset("glue",
-0003bf40: 2022 6d6e 6c69 222c 2073 706c 6974 3d22   "mnli", split="
-0003bf50: 7472 6169 6e22 290a 2020 2020 2020 2020  train").        
-0003bf60: 3e3e 3e20 2320 6d61 7070 696e 6720 746f  >>> # mapping to
-0003bf70: 2061 6c69 676e 2077 6974 680a 2020 2020   align with.    
-0003bf80: 2020 2020 3e3e 3e20 6c61 6265 6c32 6964      >>> label2id
-0003bf90: 203d 207b 2743 4f4e 5452 4144 4943 5449   = {'CONTRADICTI
-0003bfa0: 4f4e 273a 2030 2c20 274e 4555 5452 414c  ON': 0, 'NEUTRAL
-0003bfb0: 273a 2031 2c20 2745 4e54 4149 4c4d 454e  ': 1, 'ENTAILMEN
-0003bfc0: 5427 3a20 327d 0a20 2020 2020 2020 203e  T': 2}.        >
-0003bfd0: 3e3e 2064 735f 616c 6967 6e65 6420 3d20  >> ds_aligned = 
-0003bfe0: 6473 2e61 6c69 676e 5f6c 6162 656c 735f  ds.align_labels_
-0003bff0: 7769 7468 5f6d 6170 7069 6e67 286c 6162  with_mapping(lab
-0003c000: 656c 3269 642c 2022 6c61 6265 6c22 290a  el2id, "label").
-0003c010: 2020 2020 2020 2020 6060 600a 0a20 2020          ```..   
-0003c020: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0003c030: 2023 2053 616e 6974 7920 6368 6563 6b73   # Sanity checks
-0003c040: 0a20 2020 2020 2020 2069 6620 6c61 6265  .        if labe
-0003c050: 6c5f 636f 6c75 6d6e 206e 6f74 2069 6e20  l_column not in 
-0003c060: 7365 6c66 2e5f 6461 7461 2e63 6f6c 756d  self._data.colum
-0003c070: 6e5f 6e61 6d65 733a 0a20 2020 2020 2020  n_names:.       
-0003c080: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0003c090: 4572 726f 7228 6622 436f 6c75 6d6e 2028  Error(f"Column (
-0003c0a0: 7b6c 6162 656c 5f63 6f6c 756d 6e7d 2920  {label_column}) 
-0003c0b0: 6e6f 7420 696e 2074 6162 6c65 2063 6f6c  not in table col
-0003c0c0: 756d 6e73 2028 7b73 656c 662e 5f64 6174  umns ({self._dat
-0003c0d0: 612e 636f 6c75 6d6e 5f6e 616d 6573 7d29  a.column_names})
-0003c0e0: 2e22 290a 0a20 2020 2020 2020 206c 6162  .")..        lab
-0003c0f0: 656c 5f66 6561 7475 7265 203d 2073 656c  el_feature = sel
-0003c100: 662e 6665 6174 7572 6573 5b6c 6162 656c  f.features[label
-0003c110: 5f63 6f6c 756d 6e5d 0a20 2020 2020 2020  _column].       
-0003c120: 2069 6620 6e6f 7420 280a 2020 2020 2020   if not (.      
-0003c130: 2020 2020 2020 6973 696e 7374 616e 6365        isinstance
-0003c140: 286c 6162 656c 5f66 6561 7475 7265 2c20  (label_feature, 
-0003c150: 436c 6173 734c 6162 656c 290a 2020 2020  ClassLabel).    
-0003c160: 2020 2020 2020 2020 6f72 2028 6973 696e          or (isin
-0003c170: 7374 616e 6365 286c 6162 656c 5f66 6561  stance(label_fea
-0003c180: 7475 7265 2c20 5365 7175 656e 6365 2920  ture, Sequence) 
-0003c190: 616e 6420 6973 696e 7374 616e 6365 286c  and isinstance(l
-0003c1a0: 6162 656c 5f66 6561 7475 7265 2e66 6561  abel_feature.fea
-0003c1b0: 7475 7265 2c20 436c 6173 734c 6162 656c  ture, ClassLabel
-0003c1c0: 2929 0a20 2020 2020 2020 2029 3a0a 2020  )).        ):.  
-0003c1d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0003c1e0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-0003c1f0: 2020 2020 2020 2020 2020 2020 6622 416c              f"Al
-0003c200: 6967 6e69 6e67 206c 6162 656c 7320 7769  igning labels wi
-0003c210: 7468 2061 206d 6170 7069 6e67 2069 7320  th a mapping is 
-0003c220: 6f6e 6c79 2073 7570 706f 7274 6564 2066  only supported f
-0003c230: 6f72 207b 436c 6173 734c 6162 656c 2e5f  or {ClassLabel._
-0003c240: 5f6e 616d 655f 5f7d 2063 6f6c 756d 6e20  _name__} column 
-0003c250: 6f72 207b 5365 7175 656e 6365 2e5f 5f6e  or {Sequence.__n
-0003c260: 616d 655f 5f7d 2063 6f6c 756d 6e20 7769  ame__} column wi
-0003c270: 7468 2074 6865 2069 6e6e 6572 2074 7970  th the inner typ
-0003c280: 6520 7b43 6c61 7373 4c61 6265 6c2e 5f5f  e {ClassLabel.__
-0003c290: 6e61 6d65 5f5f 7d2c 2061 6e64 2063 6f6c  name__}, and col
-0003c2a0: 756d 6e20 7b6c 6162 656c 5f66 6561 7475  umn {label_featu
-0003c2b0: 7265 7d20 6973 206f 6620 7479 7065 207b  re} is of type {
-0003c2c0: 7479 7065 286c 6162 656c 5f66 6561 7475  type(label_featu
-0003c2d0: 7265 292e 5f5f 6e61 6d65 5f5f 7d2e 220a  re).__name__}.".
-0003c2e0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0003c2f0: 2020 2020 2020 2023 2053 6f72 7420 696e         # Sort in
-0003c300: 7075 7420 6d61 7070 696e 6720 6279 2049  put mapping by I
-0003c310: 4420 7661 6c75 6520 746f 2065 6e73 7572  D value to ensur
-0003c320: 6520 7468 6520 6c61 6265 6c20 6e61 6d65  e the label name
-0003c330: 7320 6172 6520 616c 6967 6e65 640a 2020  s are aligned.  
-0003c340: 2020 2020 2020 6c61 6265 6c32 6964 203d        label2id =
-0003c350: 2064 6963 7428 736f 7274 6564 286c 6162   dict(sorted(lab
-0003c360: 656c 3269 642e 6974 656d 7328 292c 206b  el2id.items(), k
-0003c370: 6579 3d6c 616d 6264 6120 6974 656d 3a20  ey=lambda item: 
-0003c380: 6974 656d 5b31 5d29 290a 2020 2020 2020  item[1])).      
-0003c390: 2020 6c61 6265 6c5f 6e61 6d65 7320 3d20    label_names = 
-0003c3a0: 6c69 7374 286c 6162 656c 3269 642e 6b65  list(label2id.ke
-0003c3b0: 7973 2829 290a 2020 2020 2020 2020 2320  ys()).        # 
-0003c3c0: 536f 6d65 206c 6162 656c 206d 6170 7069  Some label mappi
-0003c3d0: 6e67 7320 7573 6520 7570 7065 7263 6173  ngs use uppercas
-0003c3e0: 6520 6c61 6265 6c20 6e61 6d65 7320 736f  e label names so
-0003c3f0: 2077 6520 6c6f 7765 7263 6173 6520 7468   we lowercase th
-0003c400: 656d 2064 7572 696e 6720 616c 6967 6e6d  em during alignm
-0003c410: 656e 740a 2020 2020 2020 2020 6c61 6265  ent.        labe
-0003c420: 6c32 6964 203d 207b 6b2e 6c6f 7765 7228  l2id = {k.lower(
-0003c430: 293a 2076 2066 6f72 206b 2c20 7620 696e  ): v for k, v in
-0003c440: 206c 6162 656c 3269 642e 6974 656d 7328   label2id.items(
-0003c450: 297d 0a20 2020 2020 2020 2069 6e74 3273  )}.        int2s
-0003c460: 7472 5f66 756e 6374 696f 6e20 3d20 280a  tr_function = (.
-0003c470: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-0003c480: 6c5f 6665 6174 7572 652e 696e 7432 7374  l_feature.int2st
-0003c490: 7220 6966 2069 7369 6e73 7461 6e63 6528  r if isinstance(
-0003c4a0: 6c61 6265 6c5f 6665 6174 7572 652c 2043  label_feature, C
-0003c4b0: 6c61 7373 4c61 6265 6c29 2065 6c73 6520  lassLabel) else 
-0003c4c0: 6c61 6265 6c5f 6665 6174 7572 652e 6665  label_feature.fe
-0003c4d0: 6174 7572 652e 696e 7432 7374 720a 2020  ature.int2str.  
-0003c4e0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0003c4f0: 2069 6620 6973 696e 7374 616e 6365 286c   if isinstance(l
-0003c500: 6162 656c 5f66 6561 7475 7265 2c20 436c  abel_feature, Cl
-0003c510: 6173 734c 6162 656c 293a 0a0a 2020 2020  assLabel):..    
-0003c520: 2020 2020 2020 2020 6465 6620 7072 6f63          def proc
-0003c530: 6573 735f 6c61 6265 6c5f 6964 7328 6261  ess_label_ids(ba
-0003c540: 7463 6829 3a0a 2020 2020 2020 2020 2020  tch):.          
-0003c550: 2020 2020 2020 6473 6574 5f6c 6162 656c        dset_label
-0003c560: 5f6e 616d 6573 203d 205b 0a20 2020 2020  _names = [.     
-0003c570: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003c580: 6e74 3273 7472 5f66 756e 6374 696f 6e28  nt2str_function(
-0003c590: 6c61 6265 6c5f 6964 292e 6c6f 7765 7228  label_id).lower(
-0003c5a0: 2920 6966 206c 6162 656c 5f69 6420 6973  ) if label_id is
-0003c5b0: 206e 6f74 204e 6f6e 6520 656c 7365 204e   not None else N
-0003c5c0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0003c5d0: 2020 2020 2020 2020 666f 7220 6c61 6265          for labe
-0003c5e0: 6c5f 6964 2069 6e20 6261 7463 685b 6c61  l_id in batch[la
-0003c5f0: 6265 6c5f 636f 6c75 6d6e 5d0a 2020 2020  bel_column].    
-0003c600: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
-0003c610: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-0003c620: 7463 685b 6c61 6265 6c5f 636f 6c75 6d6e  tch[label_column
-0003c630: 5d20 3d20 5b0a 2020 2020 2020 2020 2020  ] = [.          
-0003c640: 2020 2020 2020 2020 2020 6c61 6265 6c32            label2
-0003c650: 6964 5b6c 6162 656c 5f6e 616d 655d 2069  id[label_name] i
-0003c660: 6620 6c61 6265 6c5f 6e61 6d65 2069 7320  f label_name is 
-0003c670: 6e6f 7420 4e6f 6e65 2065 6c73 6520 4e6f  not None else No
-0003c680: 6e65 2066 6f72 206c 6162 656c 5f6e 616d  ne for label_nam
-0003c690: 6520 696e 2064 7365 745f 6c61 6265 6c5f  e in dset_label_
-0003c6a0: 6e61 6d65 730a 2020 2020 2020 2020 2020  names.          
-0003c6b0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-0003c6c0: 2020 2020 2020 2020 7265 7475 726e 2062          return b
-0003c6d0: 6174 6368 0a0a 2020 2020 2020 2020 656c  atch..        el
-0003c6e0: 7365 3a0a 0a20 2020 2020 2020 2020 2020  se:..           
-0003c6f0: 2064 6566 2070 726f 6365 7373 5f6c 6162   def process_lab
-0003c700: 656c 5f69 6473 2862 6174 6368 293a 0a20  el_ids(batch):. 
-0003c710: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0003c720: 7365 745f 6c61 6265 6c5f 6e61 6d65 7320  set_label_names 
-0003c730: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-0003c740: 2020 2020 2020 2020 5b69 6e74 3273 7472          [int2str
-0003c750: 5f66 756e 6374 696f 6e28 6c61 6265 6c5f  _function(label_
-0003c760: 6964 292e 6c6f 7765 7228 2920 6966 206c  id).lower() if l
-0003c770: 6162 656c 5f69 6420 6973 206e 6f74 204e  abel_id is not N
-0003c780: 6f6e 6520 656c 7365 204e 6f6e 6520 666f  one else None fo
-0003c790: 7220 6c61 6265 6c5f 6964 2069 6e20 7365  r label_id in se
-0003c7a0: 715d 0a20 2020 2020 2020 2020 2020 2020  q].             
-0003c7b0: 2020 2020 2020 2066 6f72 2073 6571 2069         for seq i
-0003c7c0: 6e20 6261 7463 685b 6c61 6265 6c5f 636f  n batch[label_co
-0003c7d0: 6c75 6d6e 5d0a 2020 2020 2020 2020 2020  lumn].          
-0003c7e0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-0003c7f0: 2020 2020 2020 2020 6261 7463 685b 6c61          batch[la
-0003c800: 6265 6c5f 636f 6c75 6d6e 5d20 3d20 5b0a  bel_column] = [.
-0003c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c820: 2020 2020 5b6c 6162 656c 3269 645b 6c61      [label2id[la
-0003c830: 6265 6c5f 6e61 6d65 5d20 6966 206c 6162  bel_name] if lab
-0003c840: 656c 5f6e 616d 6520 6973 206e 6f74 204e  el_name is not N
-0003c850: 6f6e 6520 656c 7365 204e 6f6e 6520 666f  one else None fo
-0003c860: 7220 6c61 6265 6c5f 6e61 6d65 2069 6e20  r label_name in 
-0003c870: 7365 715d 0a20 2020 2020 2020 2020 2020  seq].           
-0003c880: 2020 2020 2020 2020 2066 6f72 2073 6571           for seq
-0003c890: 2069 6e20 6473 6574 5f6c 6162 656c 5f6e   in dset_label_n
-0003c8a0: 616d 6573 0a20 2020 2020 2020 2020 2020  ames.           
-0003c8b0: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
-0003c8c0: 2020 2020 2020 2072 6574 7572 6e20 6261         return ba
-0003c8d0: 7463 680a 0a20 2020 2020 2020 2066 6561  tch..        fea
-0003c8e0: 7475 7265 7320 3d20 7365 6c66 2e66 6561  tures = self.fea
-0003c8f0: 7475 7265 732e 636f 7079 2829 0a20 2020  tures.copy().   
-0003c900: 2020 2020 2066 6561 7475 7265 735b 6c61       features[la
-0003c910: 6265 6c5f 636f 6c75 6d6e 5d20 3d20 280a  bel_column] = (.
-0003c920: 2020 2020 2020 2020 2020 2020 436c 6173              Clas
-0003c930: 734c 6162 656c 286e 756d 5f63 6c61 7373  sLabel(num_class
-0003c940: 6573 3d6c 656e 286c 6162 656c 5f6e 616d  es=len(label_nam
-0003c950: 6573 292c 206e 616d 6573 3d6c 6162 656c  es), names=label
-0003c960: 5f6e 616d 6573 290a 2020 2020 2020 2020  _names).        
-0003c970: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0003c980: 6528 6c61 6265 6c5f 6665 6174 7572 652c  e(label_feature,
-0003c990: 2043 6c61 7373 4c61 6265 6c29 0a20 2020   ClassLabel).   
-0003c9a0: 2020 2020 2020 2020 2065 6c73 6520 5365           else Se
-0003c9b0: 7175 656e 6365 2843 6c61 7373 4c61 6265  quence(ClassLabe
-0003c9c0: 6c28 6e75 6d5f 636c 6173 7365 733d 6c65  l(num_classes=le
-0003c9d0: 6e28 6c61 6265 6c5f 6e61 6d65 7329 2c20  n(label_names), 
-0003c9e0: 6e61 6d65 733d 6c61 6265 6c5f 6e61 6d65  names=label_name
-0003c9f0: 7329 290a 2020 2020 2020 2020 290a 2020  s)).        ).  
-0003ca00: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0003ca10: 662e 6d61 7028 7072 6f63 6573 735f 6c61  f.map(process_la
-0003ca20: 6265 6c5f 6964 732c 2066 6561 7475 7265  bel_ids, feature
-0003ca30: 733d 6665 6174 7572 6573 2c20 6261 7463  s=features, batc
-0003ca40: 6865 643d 5472 7565 2c20 6465 7363 3d22  hed=True, desc="
-0003ca50: 416c 6967 6e69 6e67 2074 6865 206c 6162  Aligning the lab
-0003ca60: 656c 7322 290a 0a0a 6465 6620 5f63 6f6e  els")...def _con
-0003ca70: 6361 7465 6e61 7465 5f6d 6170 5f73 7479  catenate_map_sty
-0003ca80: 6c65 5f64 6174 6173 6574 7328 0a20 2020  le_datasets(.   
-0003ca90: 2064 7365 7473 3a20 4c69 7374 5b44 6174   dsets: List[Dat
-0003caa0: 6173 6574 5d2c 0a20 2020 2069 6e66 6f3a  aset],.    info:
-0003cab0: 204f 7074 696f 6e61 6c5b 4461 7461 7365   Optional[Datase
-0003cac0: 7449 6e66 6f5d 203d 204e 6f6e 652c 0a20  tInfo] = None,. 
-0003cad0: 2020 2073 706c 6974 3a20 4f70 7469 6f6e     split: Option
-0003cae0: 616c 5b4e 616d 6564 5370 6c69 745d 203d  al[NamedSplit] =
-0003caf0: 204e 6f6e 652c 0a20 2020 2061 7869 733a   None,.    axis:
-0003cb00: 2069 6e74 203d 2030 2c0a 293a 0a20 2020   int = 0,.):.   
-0003cb10: 2022 2222 0a20 2020 2043 6f6e 7665 7274   """.    Convert
-0003cb20: 7320 6120 6c69 7374 206f 6620 3a63 6c61  s a list of :cla
-0003cb30: 7373 3a60 4461 7461 7365 7460 2077 6974  ss:`Dataset` wit
-0003cb40: 6820 7468 6520 7361 6d65 2073 6368 656d  h the same schem
-0003cb50: 6120 696e 746f 2061 2073 696e 676c 6520  a into a single 
-0003cb60: 3a63 6c61 7373 3a60 4461 7461 7365 7460  :class:`Dataset`
-0003cb70: 2e0a 2020 2020 5768 656e 2079 6f75 2063  ..    When you c
-0003cb80: 6f6e 6361 7465 6e61 7465 206f 6e20 6178  oncatenate on ax
-0003cb90: 6973 2030 2c20 6d69 7373 696e 6720 6461  is 0, missing da
-0003cba0: 7461 2061 7265 2066 696c 6c65 6420 7769  ta are filled wi
-0003cbb0: 7468 204e 6f6e 6520 7661 6c75 6573 2e0a  th None values..
-0003cbc0: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
-0003cbd0: 2020 2064 7365 7473 2028 604c 6973 745b     dsets (`List[
-0003cbe0: 6461 7461 7365 7473 2e44 6174 6173 6574  datasets.Dataset
-0003cbf0: 5d60 293a 204c 6973 7420 6f66 2044 6174  ]`): List of Dat
-0003cc00: 6173 6574 7320 746f 2063 6f6e 6361 7465  asets to concate
-0003cc10: 6e61 7465 2e0a 2020 2020 2020 2020 696e  nate..        in
-0003cc20: 666f 2028 3a63 6c61 7373 3a60 4461 7461  fo (:class:`Data
-0003cc30: 7365 7449 6e66 6f60 2c20 6f70 7469 6f6e  setInfo`, option
-0003cc40: 616c 293a 2044 6174 6173 6574 2069 6e66  al): Dataset inf
-0003cc50: 6f72 6d61 7469 6f6e 2c20 6c69 6b65 2064  ormation, like d
-0003cc60: 6573 6372 6970 7469 6f6e 2c20 6369 7461  escription, cita
-0003cc70: 7469 6f6e 2c20 6574 632e 0a20 2020 2020  tion, etc..     
-0003cc80: 2020 2073 706c 6974 2028 3a63 6c61 7373     split (:class
-0003cc90: 3a60 4e61 6d65 6453 706c 6974 602c 206f  :`NamedSplit`, o
-0003cca0: 7074 696f 6e61 6c29 3a20 4e61 6d65 206f  ptional): Name o
-0003ccb0: 6620 7468 6520 6461 7461 7365 7420 7370  f the dataset sp
-0003ccc0: 6c69 742e 0a20 2020 2020 2020 2061 7869  lit..        axi
-0003ccd0: 7320 2860 607b 302c 2031 7d60 602c 2064  s (``{0, 1}``, d
-0003cce0: 6566 6175 6c74 2060 6030 6060 2c20 6d65  efault ``0``, me
-0003ccf0: 616e 696e 6720 6f76 6572 2072 6f77 7329  aning over rows)
-0003cd00: 3a0a 2020 2020 2020 2020 2020 2020 4178  :.            Ax
-0003cd10: 6973 2074 6f20 636f 6e63 6174 656e 6174  is to concatenat
-0003cd20: 6520 6f76 6572 2c20 7768 6572 6520 6060  e over, where ``
-0003cd30: 3060 6020 6d65 616e 7320 6f76 6572 2072  0`` means over r
-0003cd40: 6f77 7320 2876 6572 7469 6361 6c6c 7929  ows (vertically)
-0003cd50: 2061 6e64 2060 6031 6060 206d 6561 6e73   and ``1`` means
-0003cd60: 206f 7665 7220 636f 6c75 6d6e 730a 2020   over columns.  
-0003cd70: 2020 2020 2020 2020 2020 2868 6f72 697a            (horiz
-0003cd80: 6f6e 7461 6c6c 7929 2e0a 0a20 2020 2020  ontally)...     
-0003cd90: 2020 2020 2020 202a 4e65 7720 696e 2076         *New in v
-0003cda0: 6572 7369 6f6e 2031 2e36 2e30 2a0a 0a20  ersion 1.6.0*.. 
-0003cdb0: 2020 2045 7861 6d70 6c65 3a0a 0a20 2020     Example:..   
-0003cdc0: 2060 6060 7079 0a20 2020 203e 3e3e 2064   ```py.    >>> d
-0003cdd0: 7333 203d 205f 636f 6e63 6174 656e 6174  s3 = _concatenat
-0003cde0: 655f 6d61 705f 7374 796c 655f 6461 7461  e_map_style_data
-0003cdf0: 7365 7473 285b 6473 312c 2064 7332 5d29  sets([ds1, ds2])
-0003ce00: 0a20 2020 2060 6060 0a20 2020 2022 2222  .    ```.    """
-0003ce10: 0a20 2020 2023 2049 676e 6f72 6520 6461  .    # Ignore da
-0003ce20: 7461 7365 7473 2077 6974 6820 6e6f 2072  tasets with no r
-0003ce30: 6f77 730a 2020 2020 6966 2061 6e79 2864  ows.    if any(d
-0003ce40: 7365 742e 6e75 6d5f 726f 7773 203e 2030  set.num_rows > 0
-0003ce50: 2066 6f72 2064 7365 7420 696e 2064 7365   for dset in dse
-0003ce60: 7473 293a 0a20 2020 2020 2020 2064 7365  ts):.        dse
-0003ce70: 7473 203d 205b 6473 6574 2066 6f72 2064  ts = [dset for d
-0003ce80: 7365 7420 696e 2064 7365 7473 2069 6620  set in dsets if 
-0003ce90: 6473 6574 2e6e 756d 5f72 6f77 7320 3e20  dset.num_rows > 
-0003cea0: 305d 0a20 2020 2065 6c73 653a 0a20 2020  0].    else:.   
-0003ceb0: 2020 2020 2023 2052 6574 7572 6e20 6669       # Return fi
-0003cec0: 7273 7420 6461 7461 7365 7420 6966 2061  rst dataset if a
-0003ced0: 6c6c 2064 6174 6173 6574 7320 6172 6520  ll datasets are 
-0003cee0: 656d 7074 790a 2020 2020 2020 2020 7265  empty.        re
-0003cef0: 7475 726e 2064 7365 7473 5b30 5d0a 0a20  turn dsets[0].. 
-0003cf00: 2020 2023 2050 6572 666f 726d 2063 6865     # Perform che
-0003cf10: 636b 7320 2861 6e64 2061 2070 6f74 656e  cks (and a poten
-0003cf20: 7469 6f6e 616c 2063 6173 7420 6966 2061  tional cast if a
-0003cf30: 7869 733d 3029 0a20 2020 2069 6620 6178  xis=0).    if ax
-0003cf40: 6973 203d 3d20 303a 0a20 2020 2020 2020  is == 0:.       
-0003cf50: 205f 6368 6563 6b5f 6966 5f66 6561 7475   _check_if_featu
-0003cf60: 7265 735f 6361 6e5f 6265 5f61 6c69 676e  res_can_be_align
-0003cf70: 6564 285b 6473 6574 2e66 6561 7475 7265  ed([dset.feature
-0003cf80: 7320 666f 7220 6473 6574 2069 6e20 6473  s for dset in ds
-0003cf90: 6574 735d 290a 2020 2020 656c 7365 3a0a  ets]).    else:.
-0003cfa0: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
-0003cfb0: 6c6c 285b 6473 6574 2e6e 756d 5f72 6f77  ll([dset.num_row
-0003cfc0: 7320 3d3d 2064 7365 7473 5b30 5d2e 6e75  s == dsets[0].nu
-0003cfd0: 6d5f 726f 7773 2066 6f72 2064 7365 7420  m_rows for dset 
-0003cfe0: 696e 2064 7365 7473 5d29 3a0a 2020 2020  in dsets]):.    
-0003cff0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0003d000: 6c75 6545 7272 6f72 2822 4e75 6d62 6572  lueError("Number
-0003d010: 206f 6620 726f 7773 206d 7573 7420 6d61   of rows must ma
-0003d020: 7463 6820 666f 7220 616c 6c20 6461 7461  tch for all data
-0003d030: 7365 7473 2229 0a20 2020 2020 2020 205f  sets").        _
-0003d040: 6368 6563 6b5f 636f 6c75 6d6e 5f6e 616d  check_column_nam
-0003d050: 6573 285b 636f 6c5f 6e61 6d65 2066 6f72  es([col_name for
-0003d060: 2064 7365 7420 696e 2064 7365 7473 2066   dset in dsets f
-0003d070: 6f72 2063 6f6c 5f6e 616d 6520 696e 2064  or col_name in d
-0003d080: 7365 742e 5f64 6174 612e 636f 6c75 6d6e  set._data.column
-0003d090: 5f6e 616d 6573 5d29 0a0a 2020 2020 2320  _names])..    # 
-0003d0a0: 4669 6e64 2063 6f6d 6d6f 6e20 666f 726d  Find common form
-0003d0b0: 6174 206f 7220 7265 7365 7420 666f 726d  at or reset form
-0003d0c0: 6174 0a20 2020 2066 6f72 6d61 7420 3d20  at.    format = 
-0003d0d0: 6473 6574 735b 305d 2e66 6f72 6d61 740a  dsets[0].format.
-0003d0e0: 2020 2020 6966 2061 6e79 2864 7365 742e      if any(dset.
-0003d0f0: 666f 726d 6174 2021 3d20 666f 726d 6174  format != format
-0003d100: 2066 6f72 2064 7365 7420 696e 2064 7365   for dset in dse
-0003d110: 7473 293a 0a20 2020 2020 2020 2066 6f72  ts):.        for
-0003d120: 6d61 7420 3d20 7b7d 0a20 2020 2020 2020  mat = {}.       
-0003d130: 206c 6f67 6765 722e 696e 666f 2822 536f   logger.info("So
-0003d140: 6d65 206f 6620 7468 6520 6461 7461 7365  me of the datase
-0003d150: 7473 2068 6176 6520 6469 7370 6172 6174  ts have disparat
-0003d160: 6520 666f 726d 6174 2e20 5265 7365 7474  e format. Resett
-0003d170: 696e 6720 7468 6520 666f 726d 6174 206f  ing the format o
-0003d180: 6620 7468 6520 636f 6e63 6174 656e 6174  f the concatenat
-0003d190: 6564 2064 6174 6173 6574 2e22 290a 0a20  ed dataset.").. 
-0003d1a0: 2020 2064 6566 2061 7070 6c79 5f6f 6666     def apply_off
-0003d1b0: 7365 745f 746f 5f69 6e64 6963 6573 5f74  set_to_indices_t
-0003d1c0: 6162 6c65 2874 6162 6c65 2c20 6f66 6673  able(table, offs
-0003d1d0: 6574 293a 0a20 2020 2020 2020 2069 6620  et):.        if 
-0003d1e0: 6f66 6673 6574 203d 3d20 303a 0a20 2020  offset == 0:.   
-0003d1f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0003d200: 7461 626c 650a 2020 2020 2020 2020 656c  table.        el
-0003d210: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0003d220: 6172 7261 7920 3d20 7461 626c 655b 2269  array = table["i
-0003d230: 6e64 6963 6573 225d 0a20 2020 2020 2020  ndices"].       
-0003d240: 2020 2020 206e 6577 5f61 7272 6179 203d       new_array =
-0003d250: 2070 632e 6164 6428 6172 7261 792c 2070   pc.add(array, p
-0003d260: 612e 7363 616c 6172 286f 6666 7365 742c  a.scalar(offset,
-0003d270: 2074 7970 653d 7061 2e75 696e 7436 3428   type=pa.uint64(
-0003d280: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
-0003d290: 7265 7475 726e 2049 6e4d 656d 6f72 7954  return InMemoryT
-0003d2a0: 6162 6c65 2e66 726f 6d5f 6172 7261 7973  able.from_arrays
-0003d2b0: 285b 6e65 775f 6172 7261 795d 2c20 6e61  ([new_array], na
-0003d2c0: 6d65 733d 5b22 696e 6469 6365 7322 5d29  mes=["indices"])
-0003d2d0: 0a0a 2020 2020 2320 436f 6e63 6174 656e  ..    # Concaten
-0003d2e0: 6174 6520 696e 6469 6365 7320 6966 2074  ate indices if t
-0003d2f0: 6865 7920 6578 6973 740a 2020 2020 6966  hey exist.    if
-0003d300: 2061 6e79 2864 7365 742e 5f69 6e64 6963   any(dset._indic
-0003d310: 6573 2069 7320 6e6f 7420 4e6f 6e65 2066  es is not None f
-0003d320: 6f72 2064 7365 7420 696e 2064 7365 7473  or dset in dsets
-0003d330: 293a 0a20 2020 2020 2020 2069 6620 6178  ):.        if ax
-0003d340: 6973 203d 3d20 303a 0a20 2020 2020 2020  is == 0:.       
-0003d350: 2020 2020 2023 2044 6174 6173 6574 7320       # Datasets 
-0003d360: 7769 7468 206e 6f20 696e 6469 6365 7320  with no indices 
-0003d370: 7461 626c 6573 2061 7265 2072 6570 6c61  tables are repla
-0003d380: 6365 6420 7769 7468 2061 2064 6174 6173  ced with a datas
-0003d390: 6574 2077 6974 6820 616e 2069 6e64 6963  et with an indic
-0003d3a0: 6573 2074 6162 6c65 2069 6e20 6d65 6d6f  es table in memo
-0003d3b0: 7279 2e0a 2020 2020 2020 2020 2020 2020  ry..            
-0003d3c0: 2320 4170 706c 7969 6e67 2061 6e20 6f66  # Applying an of
-0003d3d0: 6673 6574 2074 6f20 616e 2069 6e64 6963  fset to an indic
-0003d3e0: 6573 2074 6162 6c65 2061 6c73 6f20 6272  es table also br
-0003d3f0: 696e 6773 2074 6865 2074 6162 6c65 2069  ings the table i
-0003d400: 6e20 6d65 6d6f 7279 2e0a 2020 2020 2020  n memory..      
-0003d410: 2020 2020 2020 696e 6469 6365 735f 7461        indices_ta
-0003d420: 626c 6573 203d 205b 5d0a 2020 2020 2020  bles = [].      
-0003d430: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-0003d440: 616e 6765 286c 656e 2864 7365 7473 2929  ange(len(dsets))
-0003d450: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003d460: 2020 6966 2064 7365 7473 5b69 5d2e 5f69    if dsets[i]._i
-0003d470: 6e64 6963 6573 2069 7320 4e6f 6e65 3a0a  ndices is None:.
-0003d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d490: 2020 2020 6473 6574 735b 695d 203d 2064      dsets[i] = d
-0003d4a0: 7365 7473 5b69 5d2e 5f73 656c 6563 745f  sets[i]._select_
-0003d4b0: 7769 7468 5f69 6e64 6963 6573 5f6d 6170  with_indices_map
-0003d4c0: 7069 6e67 2872 616e 6765 286c 656e 2864  ping(range(len(d
-0003d4d0: 7365 7473 5b69 5d29 2929 0a20 2020 2020  sets[i]))).     
-0003d4e0: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
-0003d4f0: 6573 5f74 6162 6c65 732e 6170 7065 6e64  es_tables.append
-0003d500: 2864 7365 7473 5b69 5d2e 5f69 6e64 6963  (dsets[i]._indic
-0003d510: 6573 290a 0a20 2020 2020 2020 2020 2020  es)..           
-0003d520: 2023 2041 6e20 6f66 6673 6574 206e 6565   # An offset nee
-0003d530: 6473 2074 6f20 6265 2061 7070 6c69 6564  ds to be applied
-0003d540: 2074 6f20 7468 6520 696e 6469 6365 7320   to the indices 
-0003d550: 6265 666f 7265 2063 6f6e 6361 7465 6e61  before concatena
-0003d560: 7469 6e67 0a20 2020 2020 2020 2020 2020  ting.           
-0003d570: 206f 6666 7365 7420 3d20 300a 2020 2020   offset = 0.    
-0003d580: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-0003d590: 2072 616e 6765 286c 656e 2864 7365 7473   range(len(dsets
-0003d5a0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0003d5b0: 2020 2020 696e 6469 6365 735f 7461 626c      indices_tabl
-0003d5c0: 6573 5b69 5d20 3d20 6170 706c 795f 6f66  es[i] = apply_of
-0003d5d0: 6673 6574 5f74 6f5f 696e 6469 6365 735f  fset_to_indices_
-0003d5e0: 7461 626c 6528 696e 6469 6365 735f 7461  table(indices_ta
-0003d5f0: 626c 6573 5b69 5d2c 206f 6666 7365 7429  bles[i], offset)
-0003d600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003d610: 206f 6666 7365 7420 2b3d 206c 656e 2864   offset += len(d
-0003d620: 7365 7473 5b69 5d2e 5f64 6174 6129 0a0a  sets[i]._data)..
-0003d630: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
-0003d640: 6e63 6174 656e 6174 6520 696e 6469 6365  ncatenate indice
-0003d650: 730a 2020 2020 2020 2020 2020 2020 696e  s.            in
-0003d660: 6469 6365 735f 7461 626c 6573 203d 205b  dices_tables = [
-0003d670: 7420 666f 7220 7420 696e 2069 6e64 6963  t for t in indic
-0003d680: 6573 5f74 6162 6c65 7320 6966 206c 656e  es_tables if len
-0003d690: 2874 2920 3e20 305d 0a20 2020 2020 2020  (t) > 0].       
-0003d6a0: 2020 2020 2069 6620 696e 6469 6365 735f       if indices_
-0003d6b0: 7461 626c 6573 3a0a 2020 2020 2020 2020  tables:.        
-0003d6c0: 2020 2020 2020 2020 696e 6469 6365 735f          indices_
-0003d6d0: 7461 626c 6520 3d20 636f 6e63 6174 5f74  table = concat_t
-0003d6e0: 6162 6c65 7328 696e 6469 6365 735f 7461  ables(indices_ta
-0003d6f0: 626c 6573 290a 2020 2020 2020 2020 2020  bles).          
-0003d700: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0003d710: 2020 2020 2020 2020 696e 6469 6365 735f          indices_
-0003d720: 7461 626c 6520 3d20 496e 4d65 6d6f 7279  table = InMemory
-0003d730: 5461 626c 652e 6672 6f6d 5f62 6174 6368  Table.from_batch
-0003d740: 6573 285b 5d2c 2073 6368 656d 613d 7061  es([], schema=pa
-0003d750: 2e73 6368 656d 6128 7b22 696e 6469 6365  .schema({"indice
-0003d760: 7322 3a20 7061 2e69 6e74 3634 2829 7d29  s": pa.int64()})
-0003d770: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0003d780: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0003d790: 656e 2864 7365 7473 2920 3d3d 2031 3a0a  en(dsets) == 1:.
-0003d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d7b0: 696e 6469 6365 735f 7461 626c 6520 3d20  indices_table = 
-0003d7c0: 6473 6574 735b 305d 2e5f 696e 6469 6365  dsets[0]._indice
-0003d7d0: 730a 2020 2020 2020 2020 2020 2020 656c  s.            el
-0003d7e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0003d7f0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0003d800: 6765 286c 656e 2864 7365 7473 2929 3a0a  ge(len(dsets)):.
-0003d810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d820: 2020 2020 6473 6574 735b 695d 203d 2064      dsets[i] = d
-0003d830: 7365 7473 5b69 5d2e 666c 6174 7465 6e5f  sets[i].flatten_
-0003d840: 696e 6469 6365 7328 290a 2020 2020 2020  indices().      
-0003d850: 2020 2020 2020 2020 2020 696e 6469 6365            indice
-0003d860: 735f 7461 626c 6520 3d20 4e6f 6e65 0a20  s_table = None. 
-0003d870: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003d880: 2069 6e64 6963 6573 5f74 6162 6c65 203d   indices_table =
-0003d890: 204e 6f6e 650a 0a20 2020 2074 6162 6c65   None..    table
-0003d8a0: 203d 2063 6f6e 6361 745f 7461 626c 6573   = concat_tables
-0003d8b0: 285b 6473 6574 2e5f 6461 7461 2066 6f72  ([dset._data for
-0003d8c0: 2064 7365 7420 696e 2064 7365 7473 5d2c   dset in dsets],
-0003d8d0: 2061 7869 733d 6178 6973 290a 2020 2020   axis=axis).    
-0003d8e0: 6966 2061 7869 7320 3d3d 2030 3a0a 2020  if axis == 0:.  
-0003d8f0: 2020 2020 2020 6665 6174 7572 6573 5f6c        features_l
-0003d900: 6973 7420 3d20 5f61 6c69 676e 5f66 6561  ist = _align_fea
-0003d910: 7475 7265 7328 5b64 7365 742e 6665 6174  tures([dset.feat
-0003d920: 7572 6573 2066 6f72 2064 7365 7420 696e  ures for dset in
-0003d930: 2064 7365 7473 5d29 0a20 2020 2065 6c73   dsets]).    els
-0003d940: 653a 0a20 2020 2020 2020 2066 6561 7475  e:.        featu
-0003d950: 7265 735f 6c69 7374 203d 205b 6473 6574  res_list = [dset
-0003d960: 2e66 6561 7475 7265 7320 666f 7220 6473  .features for ds
-0003d970: 6574 2069 6e20 6473 6574 735d 0a20 2020  et in dsets].   
-0003d980: 2074 6162 6c65 203d 2075 7064 6174 655f   table = update_
-0003d990: 6d65 7461 6461 7461 5f77 6974 685f 6665  metadata_with_fe
-0003d9a0: 6174 7572 6573 2874 6162 6c65 2c20 7b6b  atures(table, {k
-0003d9b0: 3a20 7620 666f 7220 6665 6174 7572 6573  : v for features
-0003d9c0: 2069 6e20 6665 6174 7572 6573 5f6c 6973   in features_lis
-0003d9d0: 7420 666f 7220 6b2c 2076 2069 6e20 6665  t for k, v in fe
-0003d9e0: 6174 7572 6573 2e69 7465 6d73 2829 7d29  atures.items()})
-0003d9f0: 0a0a 2020 2020 2320 436f 6e63 6174 656e  ..    # Concaten
-0003da00: 6174 6520 696e 666f 730a 2020 2020 6966  ate infos.    if
-0003da10: 2069 6e66 6f20 6973 204e 6f6e 653a 0a20   info is None:. 
-0003da20: 2020 2020 2020 2069 6e66 6f20 3d20 4461         info = Da
-0003da30: 7461 7365 7449 6e66 6f2e 6672 6f6d 5f6d  tasetInfo.from_m
-0003da40: 6572 6765 285b 6473 6574 2e69 6e66 6f20  erge([dset.info 
-0003da50: 666f 7220 6473 6574 2069 6e20 6473 6574  for dset in dset
-0003da60: 735d 290a 2020 2020 6669 6e67 6572 7072  s]).    fingerpr
-0003da70: 696e 7420 3d20 7570 6461 7465 5f66 696e  int = update_fin
-0003da80: 6765 7270 7269 6e74 280a 2020 2020 2020  gerprint(.      
-0003da90: 2020 2222 2e6a 6f69 6e28 6473 6574 2e5f    "".join(dset._
-0003daa0: 6669 6e67 6572 7072 696e 7420 666f 7220  fingerprint for 
-0003dab0: 6473 6574 2069 6e20 6473 6574 7329 2c20  dset in dsets), 
-0003dac0: 5f63 6f6e 6361 7465 6e61 7465 5f6d 6170  _concatenate_map
-0003dad0: 5f73 7479 6c65 5f64 6174 6173 6574 732c  _style_datasets,
-0003dae0: 207b 2269 6e66 6f22 3a20 696e 666f 2c20   {"info": info, 
-0003daf0: 2273 706c 6974 223a 2073 706c 6974 7d0a  "split": split}.
-0003db00: 2020 2020 290a 0a20 2020 2023 204d 616b      )..    # Mak
-0003db10: 6520 6669 6e61 6c20 636f 6e63 6174 656e  e final concaten
-0003db20: 6174 6564 2064 6174 6173 6574 0a20 2020  ated dataset.   
-0003db30: 2063 6f6e 6361 7465 6e61 7465 645f 6461   concatenated_da
-0003db40: 7461 7365 7420 3d20 4461 7461 7365 7428  taset = Dataset(
-0003db50: 0a20 2020 2020 2020 2074 6162 6c65 2c0a  .        table,.
-0003db60: 2020 2020 2020 2020 696e 666f 3d69 6e66          info=inf
-0003db70: 6f2c 0a20 2020 2020 2020 2073 706c 6974  o,.        split
-0003db80: 3d73 706c 6974 2c0a 2020 2020 2020 2020  =split,.        
-0003db90: 696e 6469 6365 735f 7461 626c 653d 696e  indices_table=in
-0003dba0: 6469 6365 735f 7461 626c 652c 0a20 2020  dices_table,.   
-0003dbb0: 2020 2020 2066 696e 6765 7270 7269 6e74       fingerprint
-0003dbc0: 3d66 696e 6765 7270 7269 6e74 2c0a 2020  =fingerprint,.  
-0003dbd0: 2020 290a 2020 2020 636f 6e63 6174 656e    ).    concaten
-0003dbe0: 6174 6564 5f64 6174 6173 6574 2e73 6574  ated_dataset.set
-0003dbf0: 5f66 6f72 6d61 7428 2a2a 666f 726d 6174  _format(**format
-0003dc00: 290a 2020 2020 7265 7475 726e 2063 6f6e  ).    return con
-0003dc10: 6361 7465 6e61 7465 645f 6461 7461 7365  catenated_datase
-0003dc20: 740a 0a0a 6465 6620 5f69 6e74 6572 6c65  t...def _interle
-0003dc30: 6176 655f 6d61 705f 7374 796c 655f 6461  ave_map_style_da
-0003dc40: 7461 7365 7473 280a 2020 2020 6461 7461  tasets(.    data
-0003dc50: 7365 7473 3a20 4c69 7374 5b22 4461 7461  sets: List["Data
-0003dc60: 7365 7422 5d2c 0a20 2020 2070 726f 6261  set"],.    proba
-0003dc70: 6269 6c69 7469 6573 3a20 4f70 7469 6f6e  bilities: Option
-0003dc80: 616c 5b4c 6973 745b 666c 6f61 745d 5d20  al[List[float]] 
-0003dc90: 3d20 4e6f 6e65 2c0a 2020 2020 7365 6564  = None,.    seed
-0003dca0: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
-0003dcb0: 3d20 4e6f 6e65 2c0a 2020 2020 696e 666f  = None,.    info
-0003dcc0: 3a20 4f70 7469 6f6e 616c 5b44 6174 6173  : Optional[Datas
-0003dcd0: 6574 496e 666f 5d20 3d20 4e6f 6e65 2c0a  etInfo] = None,.
-0003dce0: 2020 2020 7370 6c69 743a 204f 7074 696f      split: Optio
-0003dcf0: 6e61 6c5b 4e61 6d65 6453 706c 6974 5d20  nal[NamedSplit] 
-0003dd00: 3d20 4e6f 6e65 2c0a 2020 2020 7374 6f70  = None,.    stop
-0003dd10: 7069 6e67 5f73 7472 6174 6567 793a 204f  ping_strategy: O
-0003dd20: 7074 696f 6e61 6c5b 7374 725d 203d 2022  ptional[str] = "
-0003dd30: 6669 7273 745f 6578 6861 7573 7465 6422  first_exhausted"
-0003dd40: 2c0a 2020 2020 2a2a 6b77 6172 6773 2c0a  ,.    **kwargs,.
-0003dd50: 2920 2d3e 2022 4461 7461 7365 7422 3a0a  ) -> "Dataset":.
-0003dd60: 2020 2020 2222 220a 2020 2020 496e 7465      """.    Inte
-0003dd70: 726c 6561 7665 2073 6576 6572 616c 206d  rleave several m
-0003dd80: 6170 2d73 7479 6c65 2064 6174 6173 6574  ap-style dataset
-0003dd90: 7320 2873 6f75 7263 6573 2920 696e 746f  s (sources) into
-0003dda0: 2061 2073 696e 676c 6520 6d61 702d 7374   a single map-st
-0003ddb0: 796c 6520 6461 7461 7365 742e 0a20 2020  yle dataset..   
-0003ddc0: 2054 6865 206e 6577 2064 6174 6173 6574   The new dataset
-0003ddd0: 2069 7320 636f 6e73 7472 7563 7465 6420   is constructed 
-0003dde0: 6279 2061 6c74 6572 6e61 7469 6e67 2062  by alternating b
-0003ddf0: 6574 7765 656e 2074 6865 2073 6f75 7263  etween the sourc
-0003de00: 6573 2074 6f20 6765 7420 7468 6520 6578  es to get the ex
-0003de10: 616d 706c 6573 2e0a 2020 2020 4966 2060  amples..    If `
-0003de20: 7072 6f62 6162 696c 6974 6965 7320 3d20  probabilities = 
-0003de30: 4e6f 6e65 6020 2864 6566 6175 6c74 2920  None` (default) 
-0003de40: 7468 6520 6e65 7720 6461 7461 7365 7420  the new dataset 
-0003de50: 6973 2063 6f6e 7374 7275 6374 6564 2062  is constructed b
-0003de60: 7920 6379 636c 696e 6720 6265 7477 6565  y cycling betwee
-0003de70: 6e20 6561 6368 2073 6f75 7263 6520 746f  n each source to
-0003de80: 2067 6574 2074 6865 2065 7861 6d70 6c65   get the example
-0003de90: 732e 0a20 2020 2049 6620 6070 726f 6261  s..    If `proba
-0003dea0: 6269 6c69 7469 6573 6020 6973 206e 6f74  bilities` is not
-0003deb0: 2060 4e6f 6e65 2c20 7468 6520 6e65 7720   `None, the new 
-0003dec0: 6461 7461 7365 7420 6973 2063 6f6e 7374  dataset is const
-0003ded0: 7275 6374 6564 2062 7920 6765 7474 696e  ructed by gettin
-0003dee0: 6720 6578 616d 706c 6573 2066 726f 6d20  g examples from 
-0003def0: 6120 7261 6e64 6f6d 2073 6f75 7263 6520  a random source 
-0003df00: 6174 2061 2074 696d 6520 6163 636f 7264  at a time accord
-0003df10: 696e 6720 746f 2074 6865 2070 726f 7669  ing to the provi
-0003df20: 6465 6420 7072 6f62 6162 696c 6974 6965  ded probabilitie
-0003df30: 732e 0a0a 2020 2020 4172 6773 3a0a 2020  s...    Args:.  
-0003df40: 2020 2020 2020 6461 7461 7365 7473 2028        datasets (
-0003df50: 604c 6973 745b 4461 7461 7365 745d 6029  `List[Dataset]`)
-0003df60: 3a20 6c69 7374 206f 6620 6461 7461 7365  : list of datase
-0003df70: 7473 2074 6f20 696e 7465 726c 6561 7665  ts to interleave
-0003df80: 0a20 2020 2020 2020 2070 726f 6261 6269  .        probabi
-0003df90: 6c69 7469 6573 2028 604c 6973 745b 666c  lities (`List[fl
-0003dfa0: 6f61 745d 602c 206f 7074 696f 6e61 6c2c  oat]`, optional,
-0003dfb0: 2064 6566 6175 6c74 204e 6f6e 6529 3a20   default None): 
-0003dfc0: 4966 2073 7065 6369 6669 6564 2c20 7468  If specified, th
-0003dfd0: 6520 6e65 7720 6461 7461 7365 7420 6973  e new dataset is
-0003dfe0: 2063 6f6e 7374 7275 6374 6564 2062 7920   constructed by 
-0003dff0: 7361 6d70 6c69 6e67 0a20 2020 2020 2020  sampling.       
-0003e000: 2020 2020 2065 7861 6d70 6c65 7320 6672       examples fr
-0003e010: 6f6d 206f 6e65 2073 6f75 7263 6520 6174  om one source at
-0003e020: 2061 2074 696d 6520 6163 636f 7264 696e   a time accordin
-0003e030: 6720 746f 2074 6865 7365 2070 726f 6261  g to these proba
-0003e040: 6269 6c69 7469 6573 2e0a 2020 2020 2020  bilities..      
-0003e050: 2020 7365 6564 2028 6069 6e74 602c 206f    seed (`int`, o
-0003e060: 7074 696f 6e61 6c2c 2064 6566 6175 6c74  ptional, default
-0003e070: 204e 6f6e 6529 3a20 5468 6520 7261 6e64   None): The rand
-0003e080: 6f6d 2073 6565 6420 7573 6564 2074 6f20  om seed used to 
-0003e090: 6368 6f6f 7365 2061 2073 6f75 7263 6520  choose a source 
-0003e0a0: 666f 7220 6561 6368 2065 7861 6d70 6c65  for each example
-0003e0b0: 2e0a 2020 2020 2020 2020 696e 666f 2028  ..        info (
-0003e0c0: 3a63 6c61 7373 3a60 4461 7461 7365 7449  :class:`DatasetI
-0003e0d0: 6e66 6f60 2c20 6f70 7469 6f6e 616c 293a  nfo`, optional):
-0003e0e0: 2044 6174 6173 6574 2069 6e66 6f72 6d61   Dataset informa
-0003e0f0: 7469 6f6e 2c20 6c69 6b65 2064 6573 6372  tion, like descr
-0003e100: 6970 7469 6f6e 2c20 6369 7461 7469 6f6e  iption, citation
-0003e110: 2c20 6574 632e 0a20 2020 2020 2020 2073  , etc..        s
-0003e120: 706c 6974 2028 3a63 6c61 7373 3a60 4e61  plit (:class:`Na
-0003e130: 6d65 6453 706c 6974 602c 206f 7074 696f  medSplit`, optio
-0003e140: 6e61 6c29 3a20 4e61 6d65 206f 6620 7468  nal): Name of th
-0003e150: 6520 6461 7461 7365 7420 7370 6c69 742e  e dataset split.
-0003e160: 0a20 2020 2020 2020 2073 746f 7070 696e  .        stoppin
-0003e170: 675f 7374 7261 7465 6779 2028 4f70 7469  g_strategy (Opti
-0003e180: 6f6e 616c 2060 7374 7260 2c20 6465 6661  onal `str`, defa
-0003e190: 756c 7473 2074 6f20 6066 6972 7374 5f65  ults to `first_e
-0003e1a0: 7868 6175 7374 6564 6029 3a0a 2020 2020  xhausted`):.    
-0003e1b0: 2020 2020 2020 2020 5477 6f20 7374 7261          Two stra
-0003e1c0: 7465 6769 6573 2061 7265 2070 726f 706f  tegies are propo
-0003e1d0: 7365 6420 7269 6768 7420 6e6f 772e 0a20  sed right now.. 
-0003e1e0: 2020 2020 2020 2020 2020 2042 7920 6465             By de
-0003e1f0: 6661 756c 742c 2060 6669 7273 745f 6578  fault, `first_ex
-0003e200: 6861 7573 7465 6460 2069 7320 616e 2075  hausted` is an u
-0003e210: 6e64 6572 7361 6d70 6c69 6e67 2073 7472  ndersampling str
-0003e220: 6174 6567 792c 2069 2e65 2074 6865 2064  ategy, i.e the d
-0003e230: 6174 6173 6574 2063 6f6e 7374 7275 6374  ataset construct
-0003e240: 696f 6e20 6973 2073 746f 7070 6564 2061  ion is stopped a
-0003e250: 7320 736f 6f6e 2061 7320 6f6e 6520 6461  s soon as one da
-0003e260: 7461 7365 7420 6861 7320 7261 6e20 6f75  taset has ran ou
-0003e270: 7420 6f66 2073 616d 706c 6573 2e0a 2020  t of samples..  
-0003e280: 2020 2020 2020 2020 2020 4966 2074 6865            If the
-0003e290: 2073 7472 6174 6567 7920 6973 2060 616c   strategy is `al
-0003e2a0: 6c5f 6578 6861 7573 7465 6460 2c20 2077  l_exhausted`,  w
-0003e2b0: 6520 7573 6520 616e 206f 7665 7273 616d  e use an oversam
-0003e2c0: 706c 696e 6720 7374 7261 7465 6779 2c20  pling strategy, 
-0003e2d0: 692e 6520 7468 6520 6461 7461 7365 7420  i.e the dataset 
-0003e2e0: 636f 6e73 7472 7563 7469 6f6e 2069 7320  construction is 
-0003e2f0: 7374 6f70 7065 6420 6173 2073 6f6f 6e20  stopped as soon 
-0003e300: 6173 2065 7665 7279 2073 616d 706c 6573  as every samples
-0003e310: 206f 6620 6576 6572 7920 6461 7461 7365   of every datase
-0003e320: 7420 6861 7320 6265 656e 2061 6464 6564  t has been added
-0003e330: 2061 7420 6c65 6173 7420 6f6e 6365 2e0a   at least once..
-0003e340: 2020 2020 2020 2020 2020 2020 4e6f 7465              Note
-0003e350: 2074 6861 7420 6966 2074 6865 2073 7472   that if the str
-0003e360: 6174 6567 7920 6973 2060 616c 6c5f 6578  ategy is `all_ex
-0003e370: 6861 7573 7465 6460 2c20 7468 6520 696e  hausted`, the in
-0003e380: 7465 726c 6561 7665 6420 6461 7461 7365  terleaved datase
-0003e390: 7420 7369 7a65 2063 616e 2067 6574 2065  t size can get e
-0003e3a0: 6e6f 726d 6f75 733a 0a20 2020 2020 2020  normous:.       
-0003e3b0: 2020 2020 202d 2077 6974 6820 6e6f 2070       - with no p
-0003e3c0: 726f 6261 6269 6c69 7469 6573 2c20 7468  robabilities, th
-0003e3d0: 6520 7265 7375 6c74 696e 6720 6461 7461  e resulting data
-0003e3e0: 7365 7420 7769 6c6c 2068 6176 6520 6d61  set will have ma
-0003e3f0: 785f 6c65 6e67 7468 5f64 6174 6173 6574  x_length_dataset
-0003e400: 732a 6e62 5f64 6174 6173 6574 2073 616d  s*nb_dataset sam
-0003e410: 706c 6573 2e0a 2020 2020 2020 2020 2020  ples..          
-0003e420: 2020 2d20 7769 7468 2067 6976 656e 2070    - with given p
-0003e430: 726f 6261 6269 6c69 7469 6573 2c20 7468  robabilities, th
-0003e440: 6520 7265 7375 6c74 696e 6720 6461 7461  e resulting data
-0003e450: 7365 7420 7769 6c6c 2068 6176 6520 6d6f  set will have mo
-0003e460: 7265 2073 616d 706c 6573 2069 6620 736f  re samples if so
-0003e470: 6d65 2064 6174 6173 6574 7320 6861 7665  me datasets have
-0003e480: 2072 6561 6c6c 7920 6c6f 7720 7072 6f62   really low prob
-0003e490: 6162 696c 6974 7920 6f66 2076 6973 6974  ability of visit
-0003e4a0: 696e 672e 0a20 2020 2020 2020 202a 2a6b  ing..        **k
-0003e4b0: 7761 7267 7320 2861 6464 6974 696f 6e61  wargs (additiona
-0003e4c0: 6c20 6b65 7977 6f72 6420 6172 6775 6d65  l keyword argume
-0003e4d0: 6e74 7329 3a20 4b65 7977 6f72 6420 6172  nts): Keyword ar
-0003e4e0: 6775 6d65 6e74 7320 746f 2062 6520 7061  guments to be pa
-0003e4f0: 7373 6564 2074 6f20 3a6d 6574 683a 6064  ssed to :meth:`d
-0003e500: 6174 6173 6574 732e 4461 7461 7365 7473  atasets.Datasets
-0003e510: 2e73 656c 6563 7460 2077 6865 6e20 7365  .select` when se
-0003e520: 6c65 6374 696e 6720 7468 6520 696e 6469  lecting the indi
-0003e530: 6365 7320 7573 6564 2074 6f20 696e 7465  ces used to inte
-0003e540: 726c 6561 7665 2074 6865 2064 6174 6173  rleave the datas
-0003e550: 6574 732e 0a0a 2020 2020 4f75 7470 7574  ets...    Output
-0003e560: 3a0a 2020 2020 2020 2020 3a63 6c61 7373  :.        :class
-0003e570: 3a60 6461 7461 7365 7473 2e44 6174 6173  :`datasets.Datas
-0003e580: 6574 600a 2020 2020 2222 220a 2020 2020  et`.    """.    
-0003e590: 6966 2073 746f 7070 696e 675f 7374 7261  if stopping_stra
-0003e5a0: 7465 6779 206e 6f74 2069 6e20 5b22 6669  tegy not in ["fi
-0003e5b0: 7273 745f 6578 6861 7573 7465 6422 2c20  rst_exhausted", 
-0003e5c0: 2261 6c6c 5f65 7868 6175 7374 6564 225d  "all_exhausted"]
-0003e5d0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-0003e5e0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-0003e5f0: 2020 2020 2020 2020 6622 7b73 746f 7070          f"{stopp
-0003e600: 696e 675f 7374 7261 7465 6779 7d20 7374  ing_strategy} st
-0003e610: 6f70 7069 6e67 2073 7472 6174 6567 7920  opping strategy 
-0003e620: 696e 2060 696e 7465 726c 6561 7665 5f64  in `interleave_d
-0003e630: 6174 6173 6574 7360 2069 7320 6e6f 7420  atasets` is not 
-0003e640: 696d 706c 656d 656e 7465 6420 7965 7420  implemented yet 
-0003e650: 7769 7468 2061 206c 6973 7420 6f66 207b  with a list of {
-0003e660: 7479 7065 2864 6174 6173 6574 735b 305d  type(datasets[0]
-0003e670: 297d 220a 2020 2020 2020 2020 290a 0a20  )}".        ).. 
-0003e680: 2020 2023 2054 6f20 696e 7465 726c 6561     # To interlea
-0003e690: 7665 2074 6865 2064 6174 6173 6574 732c  ve the datasets,
-0003e6a0: 2077 6520 636f 6e63 6174 656e 6174 6520   we concatenate 
-0003e6b0: 7468 656d 2061 6e64 2074 6865 6e20 7765  them and then we
-0003e6c0: 2072 652d 6f72 6465 7220 7468 6520 696e   re-order the in
-0003e6d0: 6469 6365 730a 2020 2020 636f 6e63 6174  dices.    concat
-0003e6e0: 656e 6174 6564 5f64 6174 6173 6574 7320  enated_datasets 
-0003e6f0: 3d20 5f63 6f6e 6361 7465 6e61 7465 5f6d  = _concatenate_m
-0003e700: 6170 5f73 7479 6c65 5f64 6174 6173 6574  ap_style_dataset
-0003e710: 7328 6461 7461 7365 7473 2c20 696e 666f  s(datasets, info
-0003e720: 3d69 6e66 6f2c 2073 706c 6974 3d73 706c  =info, split=spl
-0003e730: 6974 290a 0a20 2020 2023 204c 6574 2773  it)..    # Let's
-0003e740: 206e 6f77 2062 7569 6c64 2074 6865 2069   now build the i
-0003e750: 6e64 6963 6573 2074 6f20 7061 7373 2074  ndices to pass t
-0003e760: 6f20 2e73 656c 6563 7428 290a 2020 2020  o .select().    
-0003e770: 6c65 6e67 7468 7320 3d20 5b6c 656e 2864  lengths = [len(d
-0003e780: 7365 7429 2066 6f72 2064 7365 7420 696e  set) for dset in
-0003e790: 2064 6174 6173 6574 735d 0a20 2020 206f   datasets].    o
-0003e7a0: 6666 7365 7473 203d 206e 702e 6375 6d73  ffsets = np.cums
-0003e7b0: 756d 285b 305d 202b 206c 656e 6774 6873  um([0] + lengths
-0003e7c0: 5b3a 2d31 5d29 0a0a 2020 2020 2320 6966  [:-1])..    # if
-0003e7d0: 2073 746f 7070 696e 675f 7374 7261 7465   stopping_strate
-0003e7e0: 6779 2069 7320 2266 6972 7374 5f65 7868  gy is "first_exh
-0003e7f0: 6175 7374 6564 222c 2069 7420 6973 2061  austed", it is a
-0003e800: 6e20 756e 6465 7273 616d 706c 696e 6720  n undersampling 
-0003e810: 7369 7475 6174 696f 6e20 7768 6572 6561  situation wherea
-0003e820: 7320 6974 2069 7320 616e 206f 7665 7273  s it is an overs
-0003e830: 616d 706c 696e 6720 7369 7475 6174 696f  ampling situatio
-0003e840: 6e20 6966 2069 7420 6973 2022 616c 6c5f  n if it is "all_
-0003e850: 6578 6861 7573 7465 6422 0a20 2020 206f  exhausted".    o
-0003e860: 7665 7273 616d 706c 696e 6720 3d20 7374  versampling = st
-0003e870: 6f70 7069 6e67 5f73 7472 6174 6567 7920  opping_strategy 
-0003e880: 3d3d 2022 616c 6c5f 6578 6861 7573 7465  == "all_exhauste
-0003e890: 6422 0a0a 2020 2020 6966 2070 726f 6261  d"..    if proba
-0003e8a0: 6269 6c69 7469 6573 2069 7320 4e6f 6e65  bilities is None
-0003e8b0: 2061 6e64 206e 6f74 206f 7665 7273 616d   and not oversam
-0003e8c0: 706c 696e 673a 0a20 2020 2020 2020 2023  pling:.        #
-0003e8d0: 2055 6e64 6572 7361 6d70 6c69 6e67 2073   Undersampling s
-0003e8e0: 6974 7561 7469 6f6e 2077 6974 6820 6379  ituation with cy
-0003e8f0: 636c 696e 6720 6265 7477 6565 6e20 6561  cling between ea
-0003e900: 6368 2073 6f75 7263 6573 0a20 2020 2020  ch sources.     
-0003e910: 2020 2023 2045 7861 6d70 6c65 3a3a 2049     # Example:: I
-0003e920: 6620 6c65 6e67 7468 7320 6f66 2074 6865  f lengths of the
-0003e930: 2064 6174 6173 6574 7320 6172 6520 5b33   datasets are [3
-0003e940: 2c20 342c 2035 5d0a 2020 2020 2020 2020  , 4, 5].        
-0003e950: 2320 5468 656e 2074 6865 2072 6573 756c  # Then the resul
-0003e960: 7469 6e67 2069 6e64 6963 6573 2073 686f  ting indices sho
-0003e970: 756c 6420 6265 205b 302c 2033 2c20 372c  uld be [0, 3, 7,
-0003e980: 2031 2c20 342c 2038 2c20 322c 2036 2c20   1, 4, 8, 2, 6, 
-0003e990: 395d 0a20 2020 2020 2020 2023 204e 6f74  9].        # Not
-0003e9a0: 6520 7468 6174 2077 6520 6f6e 6c79 2068  e that we only h
-0003e9b0: 6176 6520 3320 6578 616d 706c 6573 2070  ave 3 examples p
-0003e9c0: 6572 2064 6174 6173 6574 2073 696e 6365  er dataset since
-0003e9d0: 2074 6865 2066 6972 7374 2064 6174 6173   the first datas
-0003e9e0: 6574 2072 616e 206f 7574 206f 6620 6578  et ran out of ex
-0003e9f0: 616d 706c 6573 0a0a 2020 2020 2020 2020  amples..        
-0003ea00: 2320 5265 6173 6f6e 696e 6720 6265 6869  # Reasoning behi
-0003ea10: 6e64 2074 6865 2066 6f6c 6c6f 7769 6e67  nd the following
-0003ea20: 206f 7065 7261 7469 6f6e 3a20 6b65 6570   operation: keep
-0003ea30: 696e 6720 7468 6520 6d69 6e5f 6c65 6e67  ing the min_leng
-0003ea40: 7468 2066 6972 7374 2069 6e64 6963 6573  th first indices
-0003ea50: 206f 6620 6561 6368 2064 6174 6173 6574   of each dataset
-0003ea60: 0a20 2020 2020 2020 2023 2077 6869 6c65  .        # while
-0003ea70: 206f 6666 7365 7474 696e 6720 696e 206f   offsetting in o
-0003ea80: 7264 6572 2074 6f20 636f 7272 6573 706f  rder to correspo
-0003ea90: 6e64 2074 6f20 7468 6520 7269 6768 7420  nd to the right 
-0003eaa0: 696e 6469 6365 7320 6f66 2074 6865 2063  indices of the c
-0003eab0: 6f6e 6361 7465 6e61 7465 6420 6461 7461  oncatenated data
-0003eac0: 7365 740a 2020 2020 2020 2020 2320 616e  set.        # an
-0003ead0: 6420 666c 6174 7465 6e69 6e67 2074 6f20  d flattening to 
-0003eae0: 6566 6665 6374 6976 656c 7920 696e 7465  effectively inte
-0003eaf0: 726c 6561 7665 2074 6865 2064 6174 6173  rleave the datas
-0003eb00: 6574 730a 2020 2020 2020 2020 696e 6469  ets.        indi
-0003eb10: 6365 7320 3d20 286f 6666 7365 7473 2e72  ces = (offsets.r
-0003eb20: 6573 6861 7065 2831 2c20 2d31 2920 2b20  eshape(1, -1) + 
-0003eb30: 6e70 2e61 7261 6e67 6528 6d69 6e28 6c65  np.arange(min(le
-0003eb40: 6e67 7468 7329 292e 7265 7368 6170 6528  ngths)).reshape(
-0003eb50: 2d31 2c20 3129 292e 666c 6174 7465 6e28  -1, 1)).flatten(
-0003eb60: 292e 746f 6c69 7374 2829 0a20 2020 2065  ).tolist().    e
-0003eb70: 6c69 6620 7072 6f62 6162 696c 6974 6965  lif probabilitie
-0003eb80: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-0003eb90: 2020 2023 204f 7665 7273 616d 706c 696e     # Oversamplin
-0003eba0: 6720 7369 7475 6174 696f 6e20 7769 7468  g situation with
-0003ebb0: 2063 7963 6c69 6e67 2062 6574 7765 656e   cycling between
-0003ebc0: 2065 6163 6820 736f 7572 6365 730a 2020   each sources.  
-0003ebd0: 2020 2020 2020 2320 5468 656e 2074 6865        # Then the
-0003ebe0: 2072 6573 756c 7469 6e67 2069 6e64 6963   resulting indic
-0003ebf0: 6573 2073 686f 756c 6420 6265 205b 302c  es should be [0,
-0003ec00: 2033 2c20 372c 2031 2c20 342c 2038 2c20   3, 7, 1, 4, 8, 
-0003ec10: 322c 2035 2c20 392c 2030 2c20 362c 2031  2, 5, 9, 0, 6, 1
-0003ec20: 302c 2031 2c20 332c 2031 315d 0a20 2020  0, 1, 3, 11].   
-0003ec30: 2020 2020 2023 204e 6f74 6520 7468 6174       # Note that
-0003ec40: 2077 6520 6861 7665 2035 2065 7861 6d70   we have 5 examp
-0003ec50: 6c65 7320 7065 7220 6461 7461 7365 7420  les per dataset 
-0003ec60: 7769 7468 2061 2072 6f6c 6c69 6e67 2077  with a rolling w
-0003ec70: 696e 646f 7720 7369 6e63 6520 7468 6520  indow since the 
-0003ec80: 6c6f 6e67 6573 7420 6461 7461 7365 7420  longest dataset 
-0003ec90: 6861 7320 3520 7361 6d70 6c65 730a 0a20  has 5 samples.. 
-0003eca0: 2020 2020 2020 2023 2052 6561 736f 6e69         # Reasoni
-0003ecb0: 6e67 2062 6568 696e 6420 7468 6520 666f  ng behind the fo
-0003ecc0: 6c6c 6f77 696e 6720 6f70 6572 6174 696f  llowing operatio
-0003ecd0: 6e3a 2066 6f72 2065 6163 6820 6461 7461  n: for each data
-0003ece0: 7365 7420 696e 6469 6365 7320 2869 2e65  set indices (i.e
-0003ecf0: 2063 6f6c 756d 6e29 2072 6570 6561 7420   column) repeat 
-0003ed00: 7468 6520 696e 6469 6365 7320 746f 2068  the indices to h
-0003ed10: 6176 6520 6d61 785f 6c65 6e67 7468 2069  ave max_length i
-0003ed20: 6e64 6963 6573 2070 6572 2064 6174 6173  ndices per datas
-0003ed30: 6574 0a20 2020 2020 2020 2023 2046 6f72  et.        # For
-0003ed40: 2065 7861 6d70 6c65 2c20 6966 2074 6865   example, if the
-0003ed50: 206d 6178 5f6c 656e 6774 6820 6973 2035   max_length is 5
-0003ed60: 2061 6e64 2074 6865 2069 2d74 6820 6461   and the i-th da
-0003ed70: 7461 7365 7420 6861 7320 3320 7361 6d70  taset has 3 samp
-0003ed80: 6c65 732c 2074 6865 2069 2d74 6820 636f  les, the i-th co
-0003ed90: 6c75 6d6e 2077 696c 6c20 6265 205b 302c  lumn will be [0,
-0003eda0: 312c 322c 302c 315d 0a20 2020 2020 2020  1,2,0,1].       
-0003edb0: 2069 6e64 6963 6573 203d 206e 702e 6d6f   indices = np.mo
-0003edc0: 6428 6e70 2e61 7261 6e67 6528 6d61 7828  d(np.arange(max(
-0003edd0: 6c65 6e67 7468 7329 292e 7265 7368 6170  lengths)).reshap
-0003ede0: 6528 2d31 2c20 3129 2c20 6e70 2e61 7272  e(-1, 1), np.arr
-0003edf0: 6179 286c 656e 6774 6873 292e 7265 7368  ay(lengths).resh
-0003ee00: 6170 6528 312c 202d 3129 290a 0a20 2020  ape(1, -1))..   
-0003ee10: 2020 2020 2023 2057 6520 6861 7665 2074       # We have t
-0003ee20: 6f20 6b65 6570 2074 6865 2069 6e64 6963  o keep the indic
-0003ee30: 6573 2074 6f20 7468 6569 7220 7265 7370  es to their resp
-0003ee40: 6563 7469 7665 2064 6174 6173 6574 206f  ective dataset o
-0003ee50: 6666 7365 7473 2061 6e64 2074 6f20 666c  ffsets and to fl
-0003ee60: 6174 7465 6e20 746f 2065 6666 6563 7469  atten to effecti
-0003ee70: 7665 6c79 2069 6e74 6572 6c65 6176 6520  vely interleave 
-0003ee80: 7468 6520 6461 7461 7365 7473 0a20 2020  the datasets.   
-0003ee90: 2020 2020 2069 6e64 6963 6573 203d 2028       indices = (
-0003eea0: 696e 6469 6365 7320 2b20 6f66 6673 6574  indices + offset
-0003eeb0: 7329 2e66 6c61 7474 656e 2829 2e74 6f6c  s).flatten().tol
-0003eec0: 6973 7428 290a 0a20 2020 2065 6c73 653a  ist()..    else:
-0003eed0: 0a20 2020 2020 2020 2023 2062 6f6f 6c65  .        # boole
-0003eee0: 616e 2061 7272 6179 2069 6e64 6963 6174  an array indicat
-0003eef0: 696e 6720 6966 2061 7420 696e 6465 7820  ing if at index 
-0003ef00: 6920 6966 2074 6865 2064 6174 6173 6574  i if the dataset
-0003ef10: 5f69 2068 6173 2062 6565 6e20 6675 6c6c  _i has been full
-0003ef20: 7920 6578 6861 7573 7465 640a 2020 2020  y exhausted.    
-0003ef30: 2020 2020 6973 5f65 7868 6175 7374 6564      is_exhausted
-0003ef40: 203d 206e 702e 6675 6c6c 286c 656e 286c   = np.full(len(l
-0003ef50: 656e 6774 6873 292c 2046 616c 7365 290a  engths), False).
-0003ef60: 0a20 2020 2020 2020 2023 2069 6620 756e  .        # if un
-0003ef70: 6465 7273 616d 706c 696e 6720 2822 6669  dersampling ("fi
-0003ef80: 7273 745f 6578 6861 7573 7465 6422 292c  rst_exhausted"),
-0003ef90: 2077 6520 7374 6f70 2061 7320 736f 6f6e   we stop as soon
-0003efa0: 2061 7320 6f6e 6520 6461 7461 7365 7420   as one dataset 
-0003efb0: 6973 2065 7868 6175 7374 6564 0a20 2020  is exhausted.   
-0003efc0: 2020 2020 2023 2069 6620 6f76 6572 7361       # if oversa
-0003efd0: 6d70 6c69 6e67 2028 2261 6c6c 5f65 7868  mpling ("all_exh
-0003efe0: 6175 7374 6564 2229 2c20 7765 2073 746f  austed"), we sto
-0003eff0: 7020 6173 2073 6f6f 6e73 2061 7320 6576  p as soons as ev
-0003f000: 6572 7920 6461 7461 7365 7420 6973 2065  ery dataset is e
-0003f010: 7868 6175 7374 6564 2c20 692e 6520 6173  xhausted, i.e as
-0003f020: 2073 6f6f 6e20 6173 2065 7665 7279 2073   soon as every s
-0003f030: 616d 706c 6573 206f 6620 6576 6572 7920  amples of every 
-0003f040: 6461 7461 7365 7420 6861 7320 6265 656e  dataset has been
-0003f050: 2076 6973 6974 6564 2061 7420 6c65 6173   visited at leas
-0003f060: 7420 6f6e 6365 0a20 2020 2020 2020 2062  t once.        b
-0003f070: 6f6f 6c5f 7374 7261 7465 6779 5f66 756e  ool_strategy_fun
-0003f080: 6320 3d20 6e70 2e61 6c6c 2069 6620 6f76  c = np.all if ov
-0003f090: 6572 7361 6d70 6c69 6e67 2065 6c73 6520  ersampling else 
-0003f0a0: 6e70 2e61 6e79 0a0a 2020 2020 2020 2020  np.any..        
-0003f0b0: 6465 6620 6974 6572 5f72 616e 646f 6d5f  def iter_random_
-0003f0c0: 696e 6469 6365 7328 293a 0a20 2020 2020  indices():.     
-0003f0d0: 2020 2020 2020 2022 2222 4765 7420 616e         """Get an
-0003f0e0: 2069 6e66 696e 6974 6520 6974 6572 6174   infinite iterat
-0003f0f0: 6f72 2074 6861 7420 7261 6e64 6f6d 6c79  or that randomly
-0003f100: 2073 616d 706c 6573 2074 6865 2069 6e64   samples the ind
-0003f110: 6578 206f 6620 7468 6520 736f 7572 6365  ex of the source
-0003f120: 2074 6f20 7069 636b 2065 7861 6d70 6c65   to pick example
-0003f130: 7320 6672 6f6d 2e22 2222 0a20 2020 2020  s from.""".     
-0003f140: 2020 2020 2020 2072 6e67 203d 206e 702e         rng = np.
-0003f150: 7261 6e64 6f6d 2e64 6566 6175 6c74 5f72  random.default_r
-0003f160: 6e67 2873 6565 6429 0a20 2020 2020 2020  ng(seed).       
-0003f170: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
-0003f180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003f190: 2079 6965 6c64 2066 726f 6d20 2869 6e74   yield from (int
-0003f1a0: 2869 2920 666f 7220 6920 696e 2072 6e67  (i) for i in rng
-0003f1b0: 2e63 686f 6963 6528 6c65 6e28 6461 7461  .choice(len(data
-0003f1c0: 7365 7473 292c 2073 697a 653d 3130 3030  sets), size=1000
-0003f1d0: 2c20 703d 7072 6f62 6162 696c 6974 6965  , p=probabilitie
-0003f1e0: 7329 290a 0a20 2020 2020 2020 2063 7572  s))..        cur
-0003f1f0: 7265 6e74 5f69 6e64 6578 203d 205b 305d  rent_index = [0]
-0003f200: 202a 206c 656e 2864 6174 6173 6574 7329   * len(datasets)
-0003f210: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
-0003f220: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-0003f230: 7220 736f 7572 6365 5f69 6478 2069 6e20  r source_idx in 
-0003f240: 6974 6572 5f72 616e 646f 6d5f 696e 6469  iter_random_indi
-0003f250: 6365 7328 293a 0a20 2020 2020 2020 2020  ces():.         
-0003f260: 2020 2023 2049 6620 6e6f 206f 7665 7273     # If no overs
-0003f270: 616d 706c 696e 672c 2077 6520 7374 6f70  ampling, we stop
-0003f280: 2061 7320 736f 6f6e 2061 7320 6120 6461   as soon as a da
-0003f290: 7461 7365 7420 6861 7320 7261 6e20 6f75  taset has ran ou
-0003f2a0: 7420 6f66 2065 7861 6d70 6c65 7320 286e  t of examples (n
-0003f2b0: 702e 616e 7929 0a20 2020 2020 2020 2020  p.any).         
-0003f2c0: 2020 2023 204f 7468 6572 7769 7365 2c20     # Otherwise, 
-0003f2d0: 7765 2073 746f 7020 6173 2073 6f6f 6e20  we stop as soon 
-0003f2e0: 6173 2065 7665 7279 2064 6174 6173 6574  as every dataset
-0003f2f0: 2068 6173 2072 616e 206f 7574 206f 6620   has ran out of 
-0003f300: 6578 616d 706c 6573 2028 6e70 2e61 6c6c  examples (np.all
-0003f310: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0003f320: 2062 6f6f 6c5f 7374 7261 7465 6779 5f66   bool_strategy_f
-0003f330: 756e 6328 6973 5f65 7868 6175 7374 6564  unc(is_exhausted
-0003f340: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0003f350: 2020 2023 2074 6865 2073 746f 7070 696e     # the stoppin
-0003f360: 6720 636f 6e64 6974 696f 6e20 7761 7320  g condition was 
-0003f370: 7265 6163 6865 642c 206c 6574 2773 2073  reached, let's s
-0003f380: 746f 700a 2020 2020 2020 2020 2020 2020  top.            
-0003f390: 2020 2020 6272 6561 6b0a 0a20 2020 2020      break..     
-0003f3a0: 2020 2020 2020 2023 206c 6574 2773 2061         # let's a
-0003f3b0: 6464 2074 6865 2065 7861 6d70 6c65 2061  dd the example a
-0003f3c0: 7420 7468 6520 6375 7272 656e 7420 696e  t the current in
-0003f3d0: 6465 7820 6f66 2074 6865 2060 736f 7572  dex of the `sour
-0003f3e0: 6365 5f69 6478 602d 7468 2064 6174 6173  ce_idx`-th datas
-0003f3f0: 6574 0a20 2020 2020 2020 2020 2020 2069  et.            i
-0003f400: 6e64 6963 6573 2e61 7070 656e 6428 6375  ndices.append(cu
-0003f410: 7272 656e 745f 696e 6465 785b 736f 7572  rrent_index[sour
-0003f420: 6365 5f69 6478 5d20 2b20 6f66 6673 6574  ce_idx] + offset
-0003f430: 735b 736f 7572 6365 5f69 6478 5d29 0a20  s[source_idx]). 
-0003f440: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0003f450: 6e74 5f69 6e64 6578 5b73 6f75 7263 655f  nt_index[source_
-0003f460: 6964 785d 202b 3d20 310a 0a20 2020 2020  idx] += 1..     
-0003f470: 2020 2020 2020 2023 2077 6527 7665 2072         # we've r
-0003f480: 616e 206f 7574 206f 6620 6578 616d 706c  an out of exampl
-0003f490: 6573 2066 6f72 2074 6865 2063 7572 7265  es for the curre
-0003f4a0: 6e74 2064 6174 6173 6574 2c20 6c65 7427  nt dataset, let'
-0003f4b0: 7320 7570 6461 7465 206f 7572 2062 6f6f  s update our boo
-0003f4c0: 6c65 616e 2061 7272 6179 2061 6e64 2062  lean array and b
-0003f4d0: 7269 6e67 2074 6865 2063 7572 7265 6e74  ring the current
-0003f4e0: 5f69 6e64 6578 2062 6163 6b20 746f 2030  _index back to 0
-0003f4f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0003f500: 6375 7272 656e 745f 696e 6465 785b 736f  current_index[so
-0003f510: 7572 6365 5f69 6478 5d20 3e3d 206c 656e  urce_idx] >= len
-0003f520: 6774 6873 5b73 6f75 7263 655f 6964 785d  gths[source_idx]
-0003f530: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003f540: 2020 6973 5f65 7868 6175 7374 6564 5b73    is_exhausted[s
-0003f550: 6f75 7263 655f 6964 785d 203d 2054 7275  ource_idx] = Tru
-0003f560: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0003f570: 2020 6375 7272 656e 745f 696e 6465 785b    current_index[
-0003f580: 736f 7572 6365 5f69 6478 5d20 3d20 300a  source_idx] = 0.
-0003f590: 0a20 2020 2072 6574 7572 6e20 636f 6e63  .    return conc
-0003f5a0: 6174 656e 6174 6564 5f64 6174 6173 6574  atenated_dataset
-0003f5b0: 732e 7365 6c65 6374 2869 6e64 6963 6573  s.select(indices
-0003f5c0: 2c20 2a2a 6b77 6172 6773 290a 0a0a 2320  , **kwargs)...# 
-0003f5d0: 5468 6973 2069 7320 6f75 7473 6964 6520  This is outside 
-0003f5e0: 4461 7461 7365 742e 6669 6c74 6572 2061  Dataset.filter a
-0003f5f0: 7320 6974 206e 6565 6473 2074 6f20 6265  s it needs to be
-0003f600: 2070 6963 6b6c 6162 6c65 2066 6f72 206d   picklable for m
-0003f610: 756c 7469 7072 6f63 6573 7369 6e67 0a0a  ultiprocessing..
-0003f620: 0a64 6566 2067 6574 5f69 6e64 6963 6573  .def get_indices
-0003f630: 5f66 726f 6d5f 6d61 736b 5f66 756e 6374  _from_mask_funct
-0003f640: 696f 6e28 0a20 2020 2066 756e 6374 696f  ion(.    functio
-0003f650: 6e3a 2043 616c 6c61 626c 652c 0a20 2020  n: Callable,.   
-0003f660: 2062 6174 6368 6564 3a20 626f 6f6c 2c0a   batched: bool,.
-0003f670: 2020 2020 7769 7468 5f69 6e64 6963 6573      with_indices
-0003f680: 3a20 626f 6f6c 2c0a 2020 2020 696e 7075  : bool,.    inpu
-0003f690: 745f 636f 6c75 6d6e 733a 204f 7074 696f  t_columns: Optio
-0003f6a0: 6e61 6c5b 556e 696f 6e5b 7374 722c 204c  nal[Union[str, L
-0003f6b0: 6973 745b 7374 725d 5d5d 2c0a 2020 2020  ist[str]]],.    
-0003f6c0: 696e 6469 6365 735f 6d61 7070 696e 673a  indices_mapping:
-0003f6d0: 204f 7074 696f 6e61 6c5b 5461 626c 655d   Optional[Table]
-0003f6e0: 203d 204e 6f6e 652c 0a20 2020 202a 6172   = None,.    *ar
-0003f6f0: 6773 2c0a 2020 2020 2a2a 666e 5f6b 7761  gs,.    **fn_kwa
-0003f700: 7267 732c 0a29 3a0a 2020 2020 6966 2062  rgs,.):.    if b
-0003f710: 6174 6368 6564 3a0a 2020 2020 2020 2020  atched:.        
-0003f720: 2320 7765 2065 7874 7261 6374 2069 6e64  # we extract ind
-0003f730: 6963 6573 2066 726f 6d20 6172 6773 0a20  ices from args. 
-0003f740: 2020 2020 2020 202a 696e 7075 7473 2c20         *inputs, 
-0003f750: 696e 6469 6365 7320 3d20 6172 6773 0a20  indices = args. 
-0003f760: 2020 2020 2020 2069 6620 7769 7468 5f69         if with_i
-0003f770: 6e64 6963 6573 3a0a 2020 2020 2020 2020  ndices:.        
-0003f780: 2020 2020 6d61 736b 203d 2066 756e 6374      mask = funct
-0003f790: 696f 6e28 2a69 6e70 7574 732c 2069 6e64  ion(*inputs, ind
-0003f7a0: 6963 6573 2c20 2a2a 666e 5f6b 7761 7267  ices, **fn_kwarg
-0003f7b0: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
-0003f7c0: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-0003f7d0: 6b20 3d20 6675 6e63 7469 6f6e 282a 696e  k = function(*in
-0003f7e0: 7075 7473 2c20 2a2a 666e 5f6b 7761 7267  puts, **fn_kwarg
-0003f7f0: 7329 0a20 2020 2065 6c73 653a 0a20 2020  s).    else:.   
-0003f800: 2020 2020 2023 2077 6520 6765 7420 6261       # we get ba
-0003f810: 7463 6865 6420 6461 7461 2028 746f 2064  tched data (to d
-0003f820: 6f20 6c65 7373 206c 6f6f 6b2d 7570 7329  o less look-ups)
-0003f830: 2062 7574 2060 6675 6e63 7469 6f6e 6020   but `function` 
-0003f840: 6f6e 6c79 2061 6363 6570 7473 206f 6e65  only accepts one
-0003f850: 2065 7861 6d70 6c65 0a20 2020 2020 2020   example.       
-0003f860: 2023 2074 6865 7265 666f 7265 2077 6520   # therefore we 
-0003f870: 6e65 6564 2074 6f20 6361 6c6c 2060 6675  need to call `fu
-0003f880: 6e63 7469 6f6e 6020 6f6e 2065 6163 6820  nction` on each 
-0003f890: 6578 616d 706c 6520 6f66 2074 6865 2062  example of the b
-0003f8a0: 6174 6368 2074 6f20 6765 7420 7468 6520  atch to get the 
-0003f8b0: 6d61 736b 0a20 2020 2020 2020 202a 696e  mask.        *in
-0003f8c0: 7075 7473 2c20 696e 6469 6365 7320 3d20  puts, indices = 
-0003f8d0: 6172 6773 0a20 2020 2020 2020 206d 6173  args.        mas
-0003f8e0: 6b20 3d20 5b5d 0a20 2020 2020 2020 2069  k = [].        i
-0003f8f0: 6620 696e 7075 745f 636f 6c75 6d6e 7320  f input_columns 
-0003f900: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0003f910: 2020 2020 2023 2069 6e70 7574 7320 6f6e       # inputs on
-0003f920: 6c79 2063 6f6e 7461 696e 7320 6120 6261  ly contains a ba
-0003f930: 7463 6820 6f66 2065 7861 6d70 6c65 730a  tch of examples.
-0003f940: 2020 2020 2020 2020 2020 2020 6261 7463              batc
-0003f950: 683a 2064 6963 7420 3d20 696e 7075 7473  h: dict = inputs
-0003f960: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-0003f970: 6e75 6d5f 6578 616d 706c 6573 203d 206c  num_examples = l
-0003f980: 656e 2862 6174 6368 5b6e 6578 7428 6974  en(batch[next(it
-0003f990: 6572 2862 6174 6368 2e6b 6579 7328 2929  er(batch.keys())
-0003f9a0: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
-0003f9b0: 666f 7220 6920 696e 2072 616e 6765 286e  for i in range(n
-0003f9c0: 756d 5f65 7861 6d70 6c65 7329 3a0a 2020  um_examples):.  
-0003f9d0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0003f9e0: 616d 706c 6520 3d20 7b6b 6579 3a20 6261  ample = {key: ba
-0003f9f0: 7463 685b 6b65 795d 5b69 5d20 666f 7220  tch[key][i] for 
-0003fa00: 6b65 7920 696e 2062 6174 6368 7d0a 2020  key in batch}.  
-0003fa10: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0003fa20: 736b 2e61 7070 656e 6428 0a20 2020 2020  sk.append(.     
-0003fa30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0003fa40: 756e 6374 696f 6e28 6578 616d 706c 652c  unction(example,
-0003fa50: 2069 6e64 6963 6573 5b69 5d2c 202a 2a66   indices[i], **f
-0003fa60: 6e5f 6b77 6172 6773 2920 6966 2077 6974  n_kwargs) if wit
-0003fa70: 685f 696e 6469 6365 7320 656c 7365 2066  h_indices else f
-0003fa80: 756e 6374 696f 6e28 6578 616d 706c 652c  unction(example,
-0003fa90: 202a 2a66 6e5f 6b77 6172 6773 290a 2020   **fn_kwargs).  
-0003faa0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0003fab0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0003fac0: 2020 2020 2020 2020 2020 2320 696e 7075            # inpu
-0003fad0: 7473 2069 7320 6120 6c69 7374 206f 6620  ts is a list of 
-0003fae0: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
-0003faf0: 2020 2020 636f 6c75 6d6e 733a 204c 6973      columns: Lis
-0003fb00: 745b 4c69 7374 5d20 3d20 696e 7075 7473  t[List] = inputs
-0003fb10: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
-0003fb20: 5f65 7861 6d70 6c65 7320 3d20 6c65 6e28  _examples = len(
-0003fb30: 636f 6c75 6d6e 735b 305d 290a 2020 2020  columns[0]).    
-0003fb40: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-0003fb50: 2072 616e 6765 286e 756d 5f65 7861 6d70   range(num_examp
-0003fb60: 6c65 7329 3a0a 2020 2020 2020 2020 2020  les):.          
-0003fb70: 2020 2020 2020 696e 7075 7420 3d20 5b63        input = [c
-0003fb80: 6f6c 756d 6e5b 695d 2066 6f72 2063 6f6c  olumn[i] for col
-0003fb90: 756d 6e20 696e 2063 6f6c 756d 6e73 5d0a  umn in columns].
-0003fba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fbb0: 6d61 736b 2e61 7070 656e 6428 0a20 2020  mask.append(.   
-0003fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fbd0: 2066 756e 6374 696f 6e28 2a69 6e70 7574   function(*input
-0003fbe0: 2c20 696e 6469 6365 735b 695d 2c20 2a2a  , indices[i], **
-0003fbf0: 666e 5f6b 7761 7267 7329 2069 6620 7769  fn_kwargs) if wi
-0003fc00: 7468 5f69 6e64 6963 6573 2065 6c73 6520  th_indices else 
-0003fc10: 6675 6e63 7469 6f6e 282a 696e 7075 742c  function(*input,
-0003fc20: 202a 2a66 6e5f 6b77 6172 6773 290a 2020   **fn_kwargs).  
-0003fc30: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0003fc40: 2020 2020 696e 6469 6365 735f 6172 7261      indices_arra
-0003fc50: 7920 3d20 5b69 2066 6f72 2069 2c20 746f  y = [i for i, to
-0003fc60: 5f6b 6565 7020 696e 207a 6970 2869 6e64  _keep in zip(ind
-0003fc70: 6963 6573 2c20 6d61 736b 2920 6966 2074  ices, mask) if t
-0003fc80: 6f5f 6b65 6570 5d0a 2020 2020 6966 2069  o_keep].    if i
-0003fc90: 6e64 6963 6573 5f6d 6170 7069 6e67 2069  ndices_mapping i
-0003fca0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0003fcb0: 2020 2020 696e 6469 6365 735f 6172 7261      indices_arra
-0003fcc0: 7920 3d20 7061 2e61 7272 6179 2869 6e64  y = pa.array(ind
-0003fcd0: 6963 6573 5f61 7272 6179 2c20 7479 7065  ices_array, type
-0003fce0: 3d70 612e 7569 6e74 3634 2829 290a 2020  =pa.uint64()).  
-0003fcf0: 2020 2020 2020 696e 6469 6365 735f 6172        indices_ar
-0003fd00: 7261 7920 3d20 696e 6469 6365 735f 6d61  ray = indices_ma
-0003fd10: 7070 696e 672e 636f 6c75 6d6e 2830 292e  pping.column(0).
-0003fd20: 7461 6b65 2869 6e64 6963 6573 5f61 7272  take(indices_arr
-0003fd30: 6179 290a 2020 2020 2020 2020 696e 6469  ay).        indi
-0003fd40: 6365 735f 6172 7261 7920 3d20 696e 6469  ces_array = indi
-0003fd50: 6365 735f 6172 7261 792e 746f 5f70 796c  ces_array.to_pyl
-0003fd60: 6973 7428 290a 2020 2020 7265 7475 726e  ist().    return
-0003fd70: 207b 2269 6e64 6963 6573 223a 2069 6e64   {"indices": ind
-0003fd80: 6963 6573 5f61 7272 6179 7d0a            ices_array}.
+0003ab80: 2274 7970 6522 3a20 2274 6578 7422 2c0a  "type": "text",.
+0003ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003abb0: 2020 2020 2261 6e61 6c79 7a65 7222 3a20      "analyzer": 
+0003abc0: 2273 7461 6e64 6172 6422 2c0a 2020 2020  "standard",.    
+0003abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003abf0: 2273 696d 696c 6172 6974 7922 3a20 2242  "similarity": "B
+0003ac00: 4d32 3522 0a20 2020 2020 2020 2020 2020  M25".           
+0003ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ac20: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+0003ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ac40: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+0003ac50: 2020 2020 2020 2020 2020 2020 2020 7d2c                },
+0003ac60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003ac70: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+0003ac80: 2020 2020 2020 2020 2020 2060 6060 0a20             ```. 
+0003ac90: 2020 2020 2020 2045 7861 6d70 6c65 3a0a         Example:.
+0003aca0: 0a20 2020 2020 2020 2060 6060 7079 7468  .        ```pyth
+0003acb0: 6f6e 0a20 2020 2020 2020 203e 3e3e 2065  on.        >>> e
+0003acc0: 735f 636c 6965 6e74 203d 2065 6c61 7374  s_client = elast
+0003acd0: 6963 7365 6172 6368 2e45 6c61 7374 6963  icsearch.Elastic
+0003ace0: 7365 6172 6368 2829 0a20 2020 2020 2020  search().       
+0003acf0: 203e 3e3e 2064 7320 3d20 6461 7461 7365   >>> ds = datase
+0003ad00: 7473 2e6c 6f61 645f 6461 7461 7365 7428  ts.load_dataset(
+0003ad10: 2763 7269 6d65 5f61 6e64 5f70 756e 6973  'crime_and_punis
+0003ad20: 6827 2c20 7370 6c69 743d 2774 7261 696e  h', split='train
+0003ad30: 2729 0a20 2020 2020 2020 203e 3e3e 2064  ').        >>> d
+0003ad40: 732e 6164 645f 656c 6173 7469 6373 6561  s.add_elasticsea
+0003ad50: 7263 685f 696e 6465 7828 636f 6c75 6d6e  rch_index(column
+0003ad60: 3d27 6c69 6e65 272c 2065 735f 636c 6965  ='line', es_clie
+0003ad70: 6e74 3d65 735f 636c 6965 6e74 2c20 6573  nt=es_client, es
+0003ad80: 5f69 6e64 6578 5f6e 616d 653d 226d 795f  _index_name="my_
+0003ad90: 6573 5f69 6e64 6578 2229 0a20 2020 2020  es_index").     
+0003ada0: 2020 203e 3e3e 2073 636f 7265 732c 2072     >>> scores, r
+0003adb0: 6574 7269 6576 6564 5f65 7861 6d70 6c65  etrieved_example
+0003adc0: 7320 3d20 6473 2e67 6574 5f6e 6561 7265  s = ds.get_neare
+0003add0: 7374 5f65 7861 6d70 6c65 7328 276c 696e  st_examples('lin
+0003ade0: 6527 2c20 276d 7920 6e65 7720 7175 6572  e', 'my new quer
+0003adf0: 7927 2c20 6b3d 3130 290a 2020 2020 2020  y', k=10).      
+0003ae00: 2020 6060 600a 2020 2020 2020 2020 2222    ```.        ""
+0003ae10: 220a 2020 2020 2020 2020 7769 7468 2073  ".        with s
+0003ae20: 656c 662e 666f 726d 6174 7465 645f 6173  elf.formatted_as
+0003ae30: 2874 7970 653d 4e6f 6e65 2c20 636f 6c75  (type=None, colu
+0003ae40: 6d6e 733d 5b63 6f6c 756d 6e5d 293a 0a20  mns=[column]):. 
+0003ae50: 2020 2020 2020 2020 2020 2073 7570 6572             super
+0003ae60: 2829 2e61 6464 5f65 6c61 7374 6963 7365  ().add_elasticse
+0003ae70: 6172 6368 5f69 6e64 6578 280a 2020 2020  arch_index(.    
+0003ae80: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+0003ae90: 6d6e 3d63 6f6c 756d 6e2c 0a20 2020 2020  mn=column,.     
+0003aea0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0003aeb0: 5f6e 616d 653d 696e 6465 785f 6e61 6d65  _name=index_name
+0003aec0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0003aed0: 2020 686f 7374 3d68 6f73 742c 0a20 2020    host=host,.   
+0003aee0: 2020 2020 2020 2020 2020 2020 2070 6f72               por
+0003aef0: 743d 706f 7274 2c0a 2020 2020 2020 2020  t=port,.        
+0003af00: 2020 2020 2020 2020 6573 5f63 6c69 656e          es_clien
+0003af10: 743d 6573 5f63 6c69 656e 742c 0a20 2020  t=es_client,.   
+0003af20: 2020 2020 2020 2020 2020 2020 2065 735f               es_
+0003af30: 696e 6465 785f 6e61 6d65 3d65 735f 696e  index_name=es_in
+0003af40: 6465 785f 6e61 6d65 2c0a 2020 2020 2020  dex_name,.      
+0003af50: 2020 2020 2020 2020 2020 6573 5f69 6e64            es_ind
+0003af60: 6578 5f63 6f6e 6669 673d 6573 5f69 6e64  ex_config=es_ind
+0003af70: 6578 5f63 6f6e 6669 672c 0a20 2020 2020  ex_config,.     
+0003af80: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0003af90: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
+0003afa0: 2020 4074 7261 6e73 6d69 745f 666f 726d    @transmit_form
+0003afb0: 6174 0a20 2020 2040 6669 6e67 6572 7072  at.    @fingerpr
+0003afc0: 696e 745f 7472 616e 7366 6f72 6d28 696e  int_transform(in
+0003afd0: 706c 6163 653d 4661 6c73 6529 0a20 2020  place=False).   
+0003afe0: 2064 6566 2061 6464 5f69 7465 6d28 7365   def add_item(se
+0003aff0: 6c66 2c20 6974 656d 3a20 6469 6374 2c20  lf, item: dict, 
+0003b000: 6e65 775f 6669 6e67 6572 7072 696e 743a  new_fingerprint:
+0003b010: 2073 7472 293a 0a20 2020 2020 2020 2022   str):.        "
+0003b020: 2222 4164 6420 6974 656d 2074 6f20 4461  ""Add item to Da
+0003b030: 7461 7365 742e 0a0a 2020 2020 2020 2020  taset...        
+0003b040: 3c41 6464 6564 2076 6572 7369 6f6e 3d22  <Added version="
+0003b050: 312e 3722 2f3e 0a0a 2020 2020 2020 2020  1.7"/>..        
+0003b060: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+0003b070: 2020 6974 656d 2028 6064 6963 7460 293a    item (`dict`):
+0003b080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003b090: 2049 7465 6d20 6461 7461 2074 6f20 6265   Item data to be
+0003b0a0: 2061 6464 6564 2e0a 0a20 2020 2020 2020   added...       
+0003b0b0: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
+0003b0c0: 2020 2020 2020 5b60 4461 7461 7365 7460        [`Dataset`
+0003b0d0: 5d0a 0a20 2020 2020 2020 2045 7861 6d70  ]..        Examp
+0003b0e0: 6c65 3a0a 0a20 2020 2020 2020 2060 6060  le:..        ```
+0003b0f0: 7079 0a20 2020 2020 2020 203e 3e3e 2066  py.        >>> f
+0003b100: 726f 6d20 6461 7461 7365 7473 2069 6d70  rom datasets imp
+0003b110: 6f72 7420 6c6f 6164 5f64 6174 6173 6574  ort load_dataset
+0003b120: 0a20 2020 2020 2020 203e 3e3e 2064 7320  .        >>> ds 
+0003b130: 3d20 6c6f 6164 5f64 6174 6173 6574 2822  = load_dataset("
+0003b140: 726f 7474 656e 5f74 6f6d 6174 6f65 7322  rotten_tomatoes"
+0003b150: 2c20 7370 6c69 743d 2276 616c 6964 6174  , split="validat
+0003b160: 696f 6e22 290a 2020 2020 2020 2020 3e3e  ion").        >>
+0003b170: 3e20 6e65 775f 7265 7669 6577 203d 207b  > new_review = {
+0003b180: 276c 6162 656c 273a 2030 2c20 2774 6578  'label': 0, 'tex
+0003b190: 7427 3a20 2774 6869 7320 6d6f 7669 6520  t': 'this movie 
+0003b1a0: 6973 2074 6865 2061 6273 6f6c 7574 6520  is the absolute 
+0003b1b0: 776f 7273 7420 7468 696e 6720 4920 6861  worst thing I ha
+0003b1c0: 7665 2065 7665 7220 7365 656e 277d 0a20  ve ever seen'}. 
+0003b1d0: 2020 2020 2020 203e 3e3e 2064 7320 3d20         >>> ds = 
+0003b1e0: 6473 2e61 6464 5f69 7465 6d28 6e65 775f  ds.add_item(new_
+0003b1f0: 7265 7669 6577 290a 2020 2020 2020 2020  review).        
+0003b200: 3e3e 3e20 6473 5b2d 315d 0a20 2020 2020  >>> ds[-1].     
+0003b210: 2020 207b 276c 6162 656c 273a 2030 2c20     {'label': 0, 
+0003b220: 2774 6578 7427 3a20 2774 6869 7320 6d6f  'text': 'this mo
+0003b230: 7669 6520 6973 2074 6865 2061 6273 6f6c  vie is the absol
+0003b240: 7574 6520 776f 7273 7420 7468 696e 6720  ute worst thing 
+0003b250: 4920 6861 7665 2065 7665 7220 7365 656e  I have ever seen
+0003b260: 277d 0a20 2020 2020 2020 2060 6060 0a20  '}.        ```. 
+0003b270: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0003b280: 2020 2069 7465 6d5f 7461 626c 6520 3d20     item_table = 
+0003b290: 496e 4d65 6d6f 7279 5461 626c 652e 6672  InMemoryTable.fr
+0003b2a0: 6f6d 5f70 7964 6963 7428 7b6b 3a20 5b76  om_pydict({k: [v
+0003b2b0: 5d20 666f 7220 6b2c 2076 2069 6e20 6974  ] for k, v in it
+0003b2c0: 656d 2e69 7465 6d73 2829 7d29 0a20 2020  em.items()}).   
+0003b2d0: 2020 2020 2023 2057 6520 646f 6e27 7420       # We don't 
+0003b2e0: 6361 6c6c 205f 6368 6563 6b5f 6966 5f66  call _check_if_f
+0003b2f0: 6561 7475 7265 735f 6361 6e5f 6265 5f61  eatures_can_be_a
+0003b300: 6c69 676e 6564 2068 6572 6520 736f 2074  ligned here so t
+0003b310: 6869 7320 6361 7374 2069 7320 2275 6e73  his cast is "uns
+0003b320: 6166 6522 0a20 2020 2020 2020 2064 7365  afe".        dse
+0003b330: 745f 6665 6174 7572 6573 2c20 6974 656d  t_features, item
+0003b340: 5f66 6561 7475 7265 7320 3d20 5f61 6c69  _features = _ali
+0003b350: 676e 5f66 6561 7475 7265 7328 5b73 656c  gn_features([sel
+0003b360: 662e 6665 6174 7572 6573 2c20 4665 6174  f.features, Feat
+0003b370: 7572 6573 2e66 726f 6d5f 6172 726f 775f  ures.from_arrow_
+0003b380: 7363 6865 6d61 2869 7465 6d5f 7461 626c  schema(item_tabl
+0003b390: 652e 7363 6865 6d61 295d 290a 2020 2020  e.schema)]).    
+0003b3a0: 2020 2020 2320 4361 7374 2074 6f20 616c      # Cast to al
+0003b3b0: 6967 6e20 7468 6520 7363 6865 6d61 7320  ign the schemas 
+0003b3c0: 6f66 2074 6865 2074 6162 6c65 7320 616e  of the tables an
+0003b3d0: 6420 636f 6e63 6174 656e 6174 6520 7468  d concatenate th
+0003b3e0: 6520 7461 626c 6573 0a20 2020 2020 2020  e tables.       
+0003b3f0: 2074 6162 6c65 203d 2063 6f6e 6361 745f   table = concat_
+0003b400: 7461 626c 6573 280a 2020 2020 2020 2020  tables(.        
+0003b410: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
+0003b420: 2020 2020 2020 7365 6c66 2e5f 6461 7461        self._data
+0003b430: 2e63 6173 7428 6473 6574 5f66 6561 7475  .cast(dset_featu
+0003b440: 7265 732e 6172 726f 775f 7363 6865 6d61  res.arrow_schema
+0003b450: 2920 6966 2073 656c 662e 6665 6174 7572  ) if self.featur
+0003b460: 6573 2021 3d20 6473 6574 5f66 6561 7475  es != dset_featu
+0003b470: 7265 7320 656c 7365 2073 656c 662e 5f64  res else self._d
+0003b480: 6174 612c 0a20 2020 2020 2020 2020 2020  ata,.           
+0003b490: 2020 2020 2069 7465 6d5f 7461 626c 652e       item_table.
+0003b4a0: 6361 7374 2869 7465 6d5f 6665 6174 7572  cast(item_featur
+0003b4b0: 6573 2e61 7272 6f77 5f73 6368 656d 6129  es.arrow_schema)
+0003b4c0: 2c0a 2020 2020 2020 2020 2020 2020 5d0a  ,.            ].
+0003b4d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0003b4e0: 2020 6966 2073 656c 662e 5f69 6e64 6963    if self._indic
+0003b4f0: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
+0003b500: 2020 2020 2020 2020 696e 6469 6365 735f          indices_
+0003b510: 7461 626c 6520 3d20 4e6f 6e65 0a20 2020  table = None.   
+0003b520: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0003b530: 2020 2020 2020 2069 7465 6d5f 696e 6469         item_indi
+0003b540: 6365 735f 6172 7261 7920 3d20 7061 2e61  ces_array = pa.a
+0003b550: 7272 6179 285b 6c65 6e28 7365 6c66 2e5f  rray([len(self._
+0003b560: 6461 7461 295d 2c20 7479 7065 3d70 612e  data)], type=pa.
+0003b570: 7569 6e74 3634 2829 290a 2020 2020 2020  uint64()).      
+0003b580: 2020 2020 2020 6974 656d 5f69 6e64 6963        item_indic
+0003b590: 6573 5f74 6162 6c65 203d 2049 6e4d 656d  es_table = InMem
+0003b5a0: 6f72 7954 6162 6c65 2e66 726f 6d5f 6172  oryTable.from_ar
+0003b5b0: 7261 7973 285b 6974 656d 5f69 6e64 6963  rays([item_indic
+0003b5c0: 6573 5f61 7272 6179 5d2c 206e 616d 6573  es_array], names
+0003b5d0: 3d5b 2269 6e64 6963 6573 225d 290a 2020  =["indices"]).  
+0003b5e0: 2020 2020 2020 2020 2020 696e 6469 6365            indice
+0003b5f0: 735f 7461 626c 6520 3d20 636f 6e63 6174  s_table = concat
+0003b600: 5f74 6162 6c65 7328 5b73 656c 662e 5f69  _tables([self._i
+0003b610: 6e64 6963 6573 2c20 6974 656d 5f69 6e64  ndices, item_ind
+0003b620: 6963 6573 5f74 6162 6c65 5d29 0a20 2020  ices_table]).   
+0003b630: 2020 2020 2069 6e66 6f20 3d20 7365 6c66       info = self
+0003b640: 2e69 6e66 6f2e 636f 7079 2829 0a20 2020  .info.copy().   
+0003b650: 2020 2020 2069 6e66 6f2e 6665 6174 7572       info.featur
+0003b660: 6573 2e75 7064 6174 6528 6974 656d 5f66  es.update(item_f
+0003b670: 6561 7475 7265 7329 0a20 2020 2020 2020  eatures).       
+0003b680: 2074 6162 6c65 203d 2075 7064 6174 655f   table = update_
+0003b690: 6d65 7461 6461 7461 5f77 6974 685f 6665  metadata_with_fe
+0003b6a0: 6174 7572 6573 2874 6162 6c65 2c20 696e  atures(table, in
+0003b6b0: 666f 2e66 6561 7475 7265 7329 0a20 2020  fo.features).   
+0003b6c0: 2020 2020 2072 6574 7572 6e20 4461 7461       return Data
+0003b6d0: 7365 7428 0a20 2020 2020 2020 2020 2020  set(.           
+0003b6e0: 2074 6162 6c65 2c0a 2020 2020 2020 2020   table,.        
+0003b6f0: 2020 2020 696e 666f 3d69 6e66 6f2c 0a20      info=info,. 
+0003b700: 2020 2020 2020 2020 2020 2073 706c 6974             split
+0003b710: 3d73 656c 662e 7370 6c69 742c 0a20 2020  =self.split,.   
+0003b720: 2020 2020 2020 2020 2069 6e64 6963 6573           indices
+0003b730: 5f74 6162 6c65 3d69 6e64 6963 6573 5f74  _table=indices_t
+0003b740: 6162 6c65 2c0a 2020 2020 2020 2020 2020  able,.          
+0003b750: 2020 6669 6e67 6572 7072 696e 743d 6e65    fingerprint=ne
+0003b760: 775f 6669 6e67 6572 7072 696e 742c 0a20  w_fingerprint,. 
+0003b770: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0003b780: 6620 616c 6967 6e5f 6c61 6265 6c73 5f77  f align_labels_w
+0003b790: 6974 685f 6d61 7070 696e 6728 7365 6c66  ith_mapping(self
+0003b7a0: 2c20 6c61 6265 6c32 6964 3a20 4469 6374  , label2id: Dict
+0003b7b0: 2c20 6c61 6265 6c5f 636f 6c75 6d6e 3a20  , label_column: 
+0003b7c0: 7374 7229 202d 3e20 2244 6174 6173 6574  str) -> "Dataset
+0003b7d0: 223a 0a20 2020 2020 2020 2022 2222 416c  ":.        """Al
+0003b7e0: 6967 6e20 7468 6520 6461 7461 7365 7427  ign the dataset'
+0003b7f0: 7320 6c61 6265 6c20 4944 2061 6e64 206c  s label ID and l
+0003b800: 6162 656c 206e 616d 6520 6d61 7070 696e  abel name mappin
+0003b810: 6720 746f 206d 6174 6368 2061 6e20 696e  g to match an in
+0003b820: 7075 7420 606c 6162 656c 3269 6460 206d  put `label2id` m
+0003b830: 6170 7069 6e67 2e0a 2020 2020 2020 2020  apping..        
+0003b840: 5468 6973 2069 7320 7573 6566 756c 2077  This is useful w
+0003b850: 6865 6e20 796f 7520 7761 6e74 2074 6f20  hen you want to 
+0003b860: 656e 7375 7265 2074 6861 7420 6120 6d6f  ensure that a mo
+0003b870: 6465 6c27 7320 7072 6564 6963 7465 6420  del's predicted 
+0003b880: 6c61 6265 6c73 2061 7265 2061 6c69 676e  labels are align
+0003b890: 6564 2077 6974 6820 7468 6520 6461 7461  ed with the data
+0003b8a0: 7365 742e 0a20 2020 2020 2020 2054 6865  set..        The
+0003b8b0: 2061 6c69 676e 6d65 6e74 2069 6e20 646f   alignment in do
+0003b8c0: 6e65 2075 7369 6e67 2074 6865 206c 6f77  ne using the low
+0003b8d0: 6572 6361 7365 206c 6162 656c 206e 616d  ercase label nam
+0003b8e0: 6573 2e0a 0a20 2020 2020 2020 2041 7267  es...        Arg
+0003b8f0: 733a 0a20 2020 2020 2020 2020 2020 206c  s:.            l
+0003b900: 6162 656c 3269 6420 2860 6469 6374 6029  abel2id (`dict`)
+0003b910: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003b920: 2020 5468 6520 6c61 6265 6c20 6e61 6d65    The label name
+0003b930: 2074 6f20 4944 206d 6170 7069 6e67 2074   to ID mapping t
+0003b940: 6f20 616c 6967 6e20 7468 6520 6461 7461  o align the data
+0003b950: 7365 7420 7769 7468 2e0a 2020 2020 2020  set with..      
+0003b960: 2020 2020 2020 6c61 6265 6c5f 636f 6c75        label_colu
+0003b970: 6d6e 2028 6073 7472 6029 3a0a 2020 2020  mn (`str`):.    
+0003b980: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0003b990: 636f 6c75 6d6e 206e 616d 6520 6f66 206c  column name of l
+0003b9a0: 6162 656c 7320 746f 2061 6c69 676e 206f  abels to align o
+0003b9b0: 6e2e 0a0a 2020 2020 2020 2020 4578 616d  n...        Exam
+0003b9c0: 706c 653a 0a0a 2020 2020 2020 2020 6060  ple:..        ``
+0003b9d0: 6070 7974 686f 6e0a 2020 2020 2020 2020  `python.        
+0003b9e0: 3e3e 3e20 2320 6461 7461 7365 7420 7769  >>> # dataset wi
+0003b9f0: 7468 206d 6170 7069 6e67 207b 2765 6e74  th mapping {'ent
+0003ba00: 6169 6c6d 656e 7427 3a20 302c 2027 6e65  ailment': 0, 'ne
+0003ba10: 7574 7261 6c27 3a20 312c 2027 636f 6e74  utral': 1, 'cont
+0003ba20: 7261 6469 6374 696f 6e27 3a20 327d 0a20  radiction': 2}. 
+0003ba30: 2020 2020 2020 203e 3e3e 2064 7320 3d20         >>> ds = 
+0003ba40: 6c6f 6164 5f64 6174 6173 6574 2822 676c  load_dataset("gl
+0003ba50: 7565 222c 2022 6d6e 6c69 222c 2073 706c  ue", "mnli", spl
+0003ba60: 6974 3d22 7472 6169 6e22 290a 2020 2020  it="train").    
+0003ba70: 2020 2020 3e3e 3e20 2320 6d61 7070 696e      >>> # mappin
+0003ba80: 6720 746f 2061 6c69 676e 2077 6974 680a  g to align with.
+0003ba90: 2020 2020 2020 2020 3e3e 3e20 6c61 6265          >>> labe
+0003baa0: 6c32 6964 203d 207b 2743 4f4e 5452 4144  l2id = {'CONTRAD
+0003bab0: 4943 5449 4f4e 273a 2030 2c20 274e 4555  ICTION': 0, 'NEU
+0003bac0: 5452 414c 273a 2031 2c20 2745 4e54 4149  TRAL': 1, 'ENTAI
+0003bad0: 4c4d 454e 5427 3a20 327d 0a20 2020 2020  LMENT': 2}.     
+0003bae0: 2020 203e 3e3e 2064 735f 616c 6967 6e65     >>> ds_aligne
+0003baf0: 6420 3d20 6473 2e61 6c69 676e 5f6c 6162  d = ds.align_lab
+0003bb00: 656c 735f 7769 7468 5f6d 6170 7069 6e67  els_with_mapping
+0003bb10: 286c 6162 656c 3269 642c 2022 6c61 6265  (label2id, "labe
+0003bb20: 6c22 290a 2020 2020 2020 2020 6060 600a  l").        ```.
+0003bb30: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0003bb40: 2020 2020 2023 2053 616e 6974 7920 6368       # Sanity ch
+0003bb50: 6563 6b73 0a20 2020 2020 2020 2069 6620  ecks.        if 
+0003bb60: 6c61 6265 6c5f 636f 6c75 6d6e 206e 6f74  label_column not
+0003bb70: 2069 6e20 7365 6c66 2e5f 6461 7461 2e63   in self._data.c
+0003bb80: 6f6c 756d 6e5f 6e61 6d65 733a 0a20 2020  olumn_names:.   
+0003bb90: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0003bba0: 616c 7565 4572 726f 7228 6622 436f 6c75  alueError(f"Colu
+0003bbb0: 6d6e 2028 7b6c 6162 656c 5f63 6f6c 756d  mn ({label_colum
+0003bbc0: 6e7d 2920 6e6f 7420 696e 2074 6162 6c65  n}) not in table
+0003bbd0: 2063 6f6c 756d 6e73 2028 7b73 656c 662e   columns ({self.
+0003bbe0: 5f64 6174 612e 636f 6c75 6d6e 5f6e 616d  _data.column_nam
+0003bbf0: 6573 7d29 2e22 290a 0a20 2020 2020 2020  es}).")..       
+0003bc00: 206c 6162 656c 5f66 6561 7475 7265 203d   label_feature =
+0003bc10: 2073 656c 662e 6665 6174 7572 6573 5b6c   self.features[l
+0003bc20: 6162 656c 5f63 6f6c 756d 6e5d 0a20 2020  abel_column].   
+0003bc30: 2020 2020 2069 6620 6e6f 7420 280a 2020       if not (.  
+0003bc40: 2020 2020 2020 2020 2020 6973 696e 7374            isinst
+0003bc50: 616e 6365 286c 6162 656c 5f66 6561 7475  ance(label_featu
+0003bc60: 7265 2c20 436c 6173 734c 6162 656c 290a  re, ClassLabel).
+0003bc70: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
+0003bc80: 6973 696e 7374 616e 6365 286c 6162 656c  isinstance(label
+0003bc90: 5f66 6561 7475 7265 2c20 5365 7175 656e  _feature, Sequen
+0003bca0: 6365 2920 616e 6420 6973 696e 7374 616e  ce) and isinstan
+0003bcb0: 6365 286c 6162 656c 5f66 6561 7475 7265  ce(label_feature
+0003bcc0: 2e66 6561 7475 7265 2c20 436c 6173 734c  .feature, ClassL
+0003bcd0: 6162 656c 2929 0a20 2020 2020 2020 2029  abel)).        )
+0003bce0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0003bcf0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+0003bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bd10: 6622 416c 6967 6e69 6e67 206c 6162 656c  f"Aligning label
+0003bd20: 7320 7769 7468 2061 206d 6170 7069 6e67  s with a mapping
+0003bd30: 2069 7320 6f6e 6c79 2073 7570 706f 7274   is only support
+0003bd40: 6564 2066 6f72 207b 436c 6173 734c 6162  ed for {ClassLab
+0003bd50: 656c 2e5f 5f6e 616d 655f 5f7d 2063 6f6c  el.__name__} col
+0003bd60: 756d 6e20 6f72 207b 5365 7175 656e 6365  umn or {Sequence
+0003bd70: 2e5f 5f6e 616d 655f 5f7d 2063 6f6c 756d  .__name__} colum
+0003bd80: 6e20 7769 7468 2074 6865 2069 6e6e 6572  n with the inner
+0003bd90: 2074 7970 6520 7b43 6c61 7373 4c61 6265   type {ClassLabe
+0003bda0: 6c2e 5f5f 6e61 6d65 5f5f 7d2c 2061 6e64  l.__name__}, and
+0003bdb0: 2063 6f6c 756d 6e20 7b6c 6162 656c 5f66   column {label_f
+0003bdc0: 6561 7475 7265 7d20 6973 206f 6620 7479  eature} is of ty
+0003bdd0: 7065 207b 7479 7065 286c 6162 656c 5f66  pe {type(label_f
+0003bde0: 6561 7475 7265 292e 5f5f 6e61 6d65 5f5f  eature).__name__
+0003bdf0: 7d2e 220a 2020 2020 2020 2020 2020 2020  }.".            
+0003be00: 290a 0a20 2020 2020 2020 2023 2053 6f72  )..        # Sor
+0003be10: 7420 696e 7075 7420 6d61 7070 696e 6720  t input mapping 
+0003be20: 6279 2049 4420 7661 6c75 6520 746f 2065  by ID value to e
+0003be30: 6e73 7572 6520 7468 6520 6c61 6265 6c20  nsure the label 
+0003be40: 6e61 6d65 7320 6172 6520 616c 6967 6e65  names are aligne
+0003be50: 640a 2020 2020 2020 2020 6c61 6265 6c32  d.        label2
+0003be60: 6964 203d 2064 6963 7428 736f 7274 6564  id = dict(sorted
+0003be70: 286c 6162 656c 3269 642e 6974 656d 7328  (label2id.items(
+0003be80: 292c 206b 6579 3d6c 616d 6264 6120 6974  ), key=lambda it
+0003be90: 656d 3a20 6974 656d 5b31 5d29 290a 2020  em: item[1])).  
+0003bea0: 2020 2020 2020 6c61 6265 6c5f 6e61 6d65        label_name
+0003beb0: 7320 3d20 6c69 7374 286c 6162 656c 3269  s = list(label2i
+0003bec0: 642e 6b65 7973 2829 290a 2020 2020 2020  d.keys()).      
+0003bed0: 2020 2320 536f 6d65 206c 6162 656c 206d    # Some label m
+0003bee0: 6170 7069 6e67 7320 7573 6520 7570 7065  appings use uppe
+0003bef0: 7263 6173 6520 6c61 6265 6c20 6e61 6d65  rcase label name
+0003bf00: 7320 736f 2077 6520 6c6f 7765 7263 6173  s so we lowercas
+0003bf10: 6520 7468 656d 2064 7572 696e 6720 616c  e them during al
+0003bf20: 6967 6e6d 656e 740a 2020 2020 2020 2020  ignment.        
+0003bf30: 6c61 6265 6c32 6964 203d 207b 6b2e 6c6f  label2id = {k.lo
+0003bf40: 7765 7228 293a 2076 2066 6f72 206b 2c20  wer(): v for k, 
+0003bf50: 7620 696e 206c 6162 656c 3269 642e 6974  v in label2id.it
+0003bf60: 656d 7328 297d 0a20 2020 2020 2020 2069  ems()}.        i
+0003bf70: 6e74 3273 7472 5f66 756e 6374 696f 6e20  nt2str_function 
+0003bf80: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0003bf90: 6c61 6265 6c5f 6665 6174 7572 652e 696e  label_feature.in
+0003bfa0: 7432 7374 7220 6966 2069 7369 6e73 7461  t2str if isinsta
+0003bfb0: 6e63 6528 6c61 6265 6c5f 6665 6174 7572  nce(label_featur
+0003bfc0: 652c 2043 6c61 7373 4c61 6265 6c29 2065  e, ClassLabel) e
+0003bfd0: 6c73 6520 6c61 6265 6c5f 6665 6174 7572  lse label_featur
+0003bfe0: 652e 6665 6174 7572 652e 696e 7432 7374  e.feature.int2st
+0003bff0: 720a 2020 2020 2020 2020 290a 0a20 2020  r.        )..   
+0003c000: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0003c010: 6365 286c 6162 656c 5f66 6561 7475 7265  ce(label_feature
+0003c020: 2c20 436c 6173 734c 6162 656c 293a 0a0a  , ClassLabel):..
+0003c030: 2020 2020 2020 2020 2020 2020 6465 6620              def 
+0003c040: 7072 6f63 6573 735f 6c61 6265 6c5f 6964  process_label_id
+0003c050: 7328 6261 7463 6829 3a0a 2020 2020 2020  s(batch):.      
+0003c060: 2020 2020 2020 2020 2020 6473 6574 5f6c            dset_l
+0003c070: 6162 656c 5f6e 616d 6573 203d 205b 0a20  abel_names = [. 
+0003c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c090: 2020 2069 6e74 3273 7472 5f66 756e 6374     int2str_funct
+0003c0a0: 696f 6e28 6c61 6265 6c5f 6964 292e 6c6f  ion(label_id).lo
+0003c0b0: 7765 7228 2920 6966 206c 6162 656c 5f69  wer() if label_i
+0003c0c0: 6420 6973 206e 6f74 204e 6f6e 6520 656c  d is not None el
+0003c0d0: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
+0003c0e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0003c0f0: 6c61 6265 6c5f 6964 2069 6e20 6261 7463  label_id in batc
+0003c100: 685b 6c61 6265 6c5f 636f 6c75 6d6e 5d0a  h[label_column].
+0003c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c120: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0003c130: 2020 6261 7463 685b 6c61 6265 6c5f 636f    batch[label_co
+0003c140: 6c75 6d6e 5d20 3d20 5b0a 2020 2020 2020  lumn] = [.      
+0003c150: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+0003c160: 6265 6c32 6964 5b6c 6162 656c 5f6e 616d  bel2id[label_nam
+0003c170: 655d 2069 6620 6c61 6265 6c5f 6e61 6d65  e] if label_name
+0003c180: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+0003c190: 6520 4e6f 6e65 2066 6f72 206c 6162 656c  e None for label
+0003c1a0: 5f6e 616d 6520 696e 2064 7365 745f 6c61  _name in dset_la
+0003c1b0: 6265 6c5f 6e61 6d65 730a 2020 2020 2020  bel_names.      
+0003c1c0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+0003c1d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0003c1e0: 726e 2062 6174 6368 0a0a 2020 2020 2020  rn batch..      
+0003c1f0: 2020 656c 7365 3a0a 0a20 2020 2020 2020    else:..       
+0003c200: 2020 2020 2064 6566 2070 726f 6365 7373       def process
+0003c210: 5f6c 6162 656c 5f69 6473 2862 6174 6368  _label_ids(batch
+0003c220: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0003c230: 2020 2064 7365 745f 6c61 6265 6c5f 6e61     dset_label_na
+0003c240: 6d65 7320 3d20 5b0a 2020 2020 2020 2020  mes = [.        
+0003c250: 2020 2020 2020 2020 2020 2020 5b69 6e74              [int
+0003c260: 3273 7472 5f66 756e 6374 696f 6e28 6c61  2str_function(la
+0003c270: 6265 6c5f 6964 292e 6c6f 7765 7228 2920  bel_id).lower() 
+0003c280: 6966 206c 6162 656c 5f69 6420 6973 206e  if label_id is n
+0003c290: 6f74 204e 6f6e 6520 656c 7365 204e 6f6e  ot None else Non
+0003c2a0: 6520 666f 7220 6c61 6265 6c5f 6964 2069  e for label_id i
+0003c2b0: 6e20 7365 715d 0a20 2020 2020 2020 2020  n seq].         
+0003c2c0: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+0003c2d0: 6571 2069 6e20 6261 7463 685b 6c61 6265  eq in batch[labe
+0003c2e0: 6c5f 636f 6c75 6d6e 5d0a 2020 2020 2020  l_column].      
+0003c2f0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+0003c300: 2020 2020 2020 2020 2020 2020 6261 7463              batc
+0003c310: 685b 6c61 6265 6c5f 636f 6c75 6d6e 5d20  h[label_column] 
+0003c320: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+0003c330: 2020 2020 2020 2020 5b6c 6162 656c 3269          [label2i
+0003c340: 645b 6c61 6265 6c5f 6e61 6d65 5d20 6966  d[label_name] if
+0003c350: 206c 6162 656c 5f6e 616d 6520 6973 206e   label_name is n
+0003c360: 6f74 204e 6f6e 6520 656c 7365 204e 6f6e  ot None else Non
+0003c370: 6520 666f 7220 6c61 6265 6c5f 6e61 6d65  e for label_name
+0003c380: 2069 6e20 7365 715d 0a20 2020 2020 2020   in seq].       
+0003c390: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0003c3a0: 2073 6571 2069 6e20 6473 6574 5f6c 6162   seq in dset_lab
+0003c3b0: 656c 5f6e 616d 6573 0a20 2020 2020 2020  el_names.       
+0003c3c0: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+0003c3d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0003c3e0: 6e20 6261 7463 680a 0a20 2020 2020 2020  n batch..       
+0003c3f0: 2066 6561 7475 7265 7320 3d20 7365 6c66   features = self
+0003c400: 2e66 6561 7475 7265 732e 636f 7079 2829  .features.copy()
+0003c410: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
+0003c420: 735b 6c61 6265 6c5f 636f 6c75 6d6e 5d20  s[label_column] 
+0003c430: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0003c440: 436c 6173 734c 6162 656c 286e 756d 5f63  ClassLabel(num_c
+0003c450: 6c61 7373 6573 3d6c 656e 286c 6162 656c  lasses=len(label
+0003c460: 5f6e 616d 6573 292c 206e 616d 6573 3d6c  _names), names=l
+0003c470: 6162 656c 5f6e 616d 6573 290a 2020 2020  abel_names).    
+0003c480: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0003c490: 7461 6e63 6528 6c61 6265 6c5f 6665 6174  tance(label_feat
+0003c4a0: 7572 652c 2043 6c61 7373 4c61 6265 6c29  ure, ClassLabel)
+0003c4b0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0003c4c0: 6520 5365 7175 656e 6365 2843 6c61 7373  e Sequence(Class
+0003c4d0: 4c61 6265 6c28 6e75 6d5f 636c 6173 7365  Label(num_classe
+0003c4e0: 733d 6c65 6e28 6c61 6265 6c5f 6e61 6d65  s=len(label_name
+0003c4f0: 7329 2c20 6e61 6d65 733d 6c61 6265 6c5f  s), names=label_
+0003c500: 6e61 6d65 7329 290a 2020 2020 2020 2020  names)).        
+0003c510: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0003c520: 2073 656c 662e 6d61 7028 7072 6f63 6573   self.map(proces
+0003c530: 735f 6c61 6265 6c5f 6964 732c 2066 6561  s_label_ids, fea
+0003c540: 7475 7265 733d 6665 6174 7572 6573 2c20  tures=features, 
+0003c550: 6261 7463 6865 643d 5472 7565 2c20 6465  batched=True, de
+0003c560: 7363 3d22 416c 6967 6e69 6e67 2074 6865  sc="Aligning the
+0003c570: 206c 6162 656c 7322 290a 0a0a 6465 6620   labels")...def 
+0003c580: 5f63 6f6e 6361 7465 6e61 7465 5f6d 6170  _concatenate_map
+0003c590: 5f73 7479 6c65 5f64 6174 6173 6574 7328  _style_datasets(
+0003c5a0: 0a20 2020 2064 7365 7473 3a20 4c69 7374  .    dsets: List
+0003c5b0: 5b44 6174 6173 6574 5d2c 0a20 2020 2069  [Dataset],.    i
+0003c5c0: 6e66 6f3a 204f 7074 696f 6e61 6c5b 4461  nfo: Optional[Da
+0003c5d0: 7461 7365 7449 6e66 6f5d 203d 204e 6f6e  tasetInfo] = Non
+0003c5e0: 652c 0a20 2020 2073 706c 6974 3a20 4f70  e,.    split: Op
+0003c5f0: 7469 6f6e 616c 5b4e 616d 6564 5370 6c69  tional[NamedSpli
+0003c600: 745d 203d 204e 6f6e 652c 0a20 2020 2061  t] = None,.    a
+0003c610: 7869 733a 2069 6e74 203d 2030 2c0a 293a  xis: int = 0,.):
+0003c620: 0a20 2020 2022 2222 0a20 2020 2043 6f6e  .    """.    Con
+0003c630: 7665 7274 7320 6120 6c69 7374 206f 6620  verts a list of 
+0003c640: 3a63 6c61 7373 3a60 4461 7461 7365 7460  :class:`Dataset`
+0003c650: 2077 6974 6820 7468 6520 7361 6d65 2073   with the same s
+0003c660: 6368 656d 6120 696e 746f 2061 2073 696e  chema into a sin
+0003c670: 676c 6520 3a63 6c61 7373 3a60 4461 7461  gle :class:`Data
+0003c680: 7365 7460 2e0a 2020 2020 5768 656e 2079  set`..    When y
+0003c690: 6f75 2063 6f6e 6361 7465 6e61 7465 206f  ou concatenate o
+0003c6a0: 6e20 6178 6973 2030 2c20 6d69 7373 696e  n axis 0, missin
+0003c6b0: 6720 6461 7461 2061 7265 2066 696c 6c65  g data are fille
+0003c6c0: 6420 7769 7468 204e 6f6e 6520 7661 6c75  d with None valu
+0003c6d0: 6573 2e0a 0a20 2020 2041 7267 733a 0a20  es...    Args:. 
+0003c6e0: 2020 2020 2020 2064 7365 7473 2028 604c         dsets (`L
+0003c6f0: 6973 745b 6461 7461 7365 7473 2e44 6174  ist[datasets.Dat
+0003c700: 6173 6574 5d60 293a 204c 6973 7420 6f66  aset]`): List of
+0003c710: 2044 6174 6173 6574 7320 746f 2063 6f6e   Datasets to con
+0003c720: 6361 7465 6e61 7465 2e0a 2020 2020 2020  catenate..      
+0003c730: 2020 696e 666f 2028 3a63 6c61 7373 3a60    info (:class:`
+0003c740: 4461 7461 7365 7449 6e66 6f60 2c20 6f70  DatasetInfo`, op
+0003c750: 7469 6f6e 616c 293a 2044 6174 6173 6574  tional): Dataset
+0003c760: 2069 6e66 6f72 6d61 7469 6f6e 2c20 6c69   information, li
+0003c770: 6b65 2064 6573 6372 6970 7469 6f6e 2c20  ke description, 
+0003c780: 6369 7461 7469 6f6e 2c20 6574 632e 0a20  citation, etc.. 
+0003c790: 2020 2020 2020 2073 706c 6974 2028 3a63         split (:c
+0003c7a0: 6c61 7373 3a60 4e61 6d65 6453 706c 6974  lass:`NamedSplit
+0003c7b0: 602c 206f 7074 696f 6e61 6c29 3a20 4e61  `, optional): Na
+0003c7c0: 6d65 206f 6620 7468 6520 6461 7461 7365  me of the datase
+0003c7d0: 7420 7370 6c69 742e 0a20 2020 2020 2020  t split..       
+0003c7e0: 2061 7869 7320 2860 607b 302c 2031 7d60   axis (``{0, 1}`
+0003c7f0: 602c 2064 6566 6175 6c74 2060 6030 6060  `, default ``0``
+0003c800: 2c20 6d65 616e 696e 6720 6f76 6572 2072  , meaning over r
+0003c810: 6f77 7329 3a0a 2020 2020 2020 2020 2020  ows):.          
+0003c820: 2020 4178 6973 2074 6f20 636f 6e63 6174    Axis to concat
+0003c830: 656e 6174 6520 6f76 6572 2c20 7768 6572  enate over, wher
+0003c840: 6520 6060 3060 6020 6d65 616e 7320 6f76  e ``0`` means ov
+0003c850: 6572 2072 6f77 7320 2876 6572 7469 6361  er rows (vertica
+0003c860: 6c6c 7929 2061 6e64 2060 6031 6060 206d  lly) and ``1`` m
+0003c870: 6561 6e73 206f 7665 7220 636f 6c75 6d6e  eans over column
+0003c880: 730a 2020 2020 2020 2020 2020 2020 2868  s.            (h
+0003c890: 6f72 697a 6f6e 7461 6c6c 7929 2e0a 0a20  orizontally)... 
+0003c8a0: 2020 2020 2020 2020 2020 202a 4e65 7720             *New 
+0003c8b0: 696e 2076 6572 7369 6f6e 2031 2e36 2e30  in version 1.6.0
+0003c8c0: 2a0a 0a20 2020 2045 7861 6d70 6c65 3a0a  *..    Example:.
+0003c8d0: 0a20 2020 2060 6060 7079 0a20 2020 203e  .    ```py.    >
+0003c8e0: 3e3e 2064 7333 203d 205f 636f 6e63 6174  >> ds3 = _concat
+0003c8f0: 656e 6174 655f 6d61 705f 7374 796c 655f  enate_map_style_
+0003c900: 6461 7461 7365 7473 285b 6473 312c 2064  datasets([ds1, d
+0003c910: 7332 5d29 0a20 2020 2060 6060 0a20 2020  s2]).    ```.   
+0003c920: 2022 2222 0a20 2020 2023 2049 676e 6f72   """.    # Ignor
+0003c930: 6520 6461 7461 7365 7473 2077 6974 6820  e datasets with 
+0003c940: 6e6f 2072 6f77 730a 2020 2020 6966 2061  no rows.    if a
+0003c950: 6e79 2864 7365 742e 6e75 6d5f 726f 7773  ny(dset.num_rows
+0003c960: 203e 2030 2066 6f72 2064 7365 7420 696e   > 0 for dset in
+0003c970: 2064 7365 7473 293a 0a20 2020 2020 2020   dsets):.       
+0003c980: 2064 7365 7473 203d 205b 6473 6574 2066   dsets = [dset f
+0003c990: 6f72 2064 7365 7420 696e 2064 7365 7473  or dset in dsets
+0003c9a0: 2069 6620 6473 6574 2e6e 756d 5f72 6f77   if dset.num_row
+0003c9b0: 7320 3e20 305d 0a20 2020 2065 6c73 653a  s > 0].    else:
+0003c9c0: 0a20 2020 2020 2020 2023 2052 6574 7572  .        # Retur
+0003c9d0: 6e20 6669 7273 7420 6461 7461 7365 7420  n first dataset 
+0003c9e0: 6966 2061 6c6c 2064 6174 6173 6574 7320  if all datasets 
+0003c9f0: 6172 6520 656d 7074 790a 2020 2020 2020  are empty.      
+0003ca00: 2020 7265 7475 726e 2064 7365 7473 5b30    return dsets[0
+0003ca10: 5d0a 0a20 2020 2023 2050 6572 666f 726d  ]..    # Perform
+0003ca20: 2063 6865 636b 7320 2861 6e64 2061 2070   checks (and a p
+0003ca30: 6f74 656e 7469 6f6e 616c 2063 6173 7420  otentional cast 
+0003ca40: 6966 2061 7869 733d 3029 0a20 2020 2069  if axis=0).    i
+0003ca50: 6620 6178 6973 203d 3d20 303a 0a20 2020  f axis == 0:.   
+0003ca60: 2020 2020 205f 6368 6563 6b5f 6966 5f66       _check_if_f
+0003ca70: 6561 7475 7265 735f 6361 6e5f 6265 5f61  eatures_can_be_a
+0003ca80: 6c69 676e 6564 285b 6473 6574 2e66 6561  ligned([dset.fea
+0003ca90: 7475 7265 7320 666f 7220 6473 6574 2069  tures for dset i
+0003caa0: 6e20 6473 6574 735d 290a 2020 2020 656c  n dsets]).    el
+0003cab0: 7365 3a0a 2020 2020 2020 2020 6966 206e  se:.        if n
+0003cac0: 6f74 2061 6c6c 285b 6473 6574 2e6e 756d  ot all([dset.num
+0003cad0: 5f72 6f77 7320 3d3d 2064 7365 7473 5b30  _rows == dsets[0
+0003cae0: 5d2e 6e75 6d5f 726f 7773 2066 6f72 2064  ].num_rows for d
+0003caf0: 7365 7420 696e 2064 7365 7473 5d29 3a0a  set in dsets]):.
+0003cb00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0003cb10: 6520 5661 6c75 6545 7272 6f72 2822 4e75  e ValueError("Nu
+0003cb20: 6d62 6572 206f 6620 726f 7773 206d 7573  mber of rows mus
+0003cb30: 7420 6d61 7463 6820 666f 7220 616c 6c20  t match for all 
+0003cb40: 6461 7461 7365 7473 2229 0a20 2020 2020  datasets").     
+0003cb50: 2020 205f 6368 6563 6b5f 636f 6c75 6d6e     _check_column
+0003cb60: 5f6e 616d 6573 285b 636f 6c5f 6e61 6d65  _names([col_name
+0003cb70: 2066 6f72 2064 7365 7420 696e 2064 7365   for dset in dse
+0003cb80: 7473 2066 6f72 2063 6f6c 5f6e 616d 6520  ts for col_name 
+0003cb90: 696e 2064 7365 742e 5f64 6174 612e 636f  in dset._data.co
+0003cba0: 6c75 6d6e 5f6e 616d 6573 5d29 0a0a 2020  lumn_names])..  
+0003cbb0: 2020 2320 4669 6e64 2063 6f6d 6d6f 6e20    # Find common 
+0003cbc0: 666f 726d 6174 206f 7220 7265 7365 7420  format or reset 
+0003cbd0: 666f 726d 6174 0a20 2020 2066 6f72 6d61  format.    forma
+0003cbe0: 7420 3d20 6473 6574 735b 305d 2e66 6f72  t = dsets[0].for
+0003cbf0: 6d61 740a 2020 2020 6966 2061 6e79 2864  mat.    if any(d
+0003cc00: 7365 742e 666f 726d 6174 2021 3d20 666f  set.format != fo
+0003cc10: 726d 6174 2066 6f72 2064 7365 7420 696e  rmat for dset in
+0003cc20: 2064 7365 7473 293a 0a20 2020 2020 2020   dsets):.       
+0003cc30: 2066 6f72 6d61 7420 3d20 7b7d 0a20 2020   format = {}.   
+0003cc40: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
+0003cc50: 2822 536f 6d65 206f 6620 7468 6520 6461  ("Some of the da
+0003cc60: 7461 7365 7473 2068 6176 6520 6469 7370  tasets have disp
+0003cc70: 6172 6174 6520 666f 726d 6174 2e20 5265  arate format. Re
+0003cc80: 7365 7474 696e 6720 7468 6520 666f 726d  setting the form
+0003cc90: 6174 206f 6620 7468 6520 636f 6e63 6174  at of the concat
+0003cca0: 656e 6174 6564 2064 6174 6173 6574 2e22  enated dataset."
+0003ccb0: 290a 0a20 2020 2064 6566 2061 7070 6c79  )..    def apply
+0003ccc0: 5f6f 6666 7365 745f 746f 5f69 6e64 6963  _offset_to_indic
+0003ccd0: 6573 5f74 6162 6c65 2874 6162 6c65 2c20  es_table(table, 
+0003cce0: 6f66 6673 6574 293a 0a20 2020 2020 2020  offset):.       
+0003ccf0: 2069 6620 6f66 6673 6574 203d 3d20 303a   if offset == 0:
+0003cd00: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0003cd10: 7572 6e20 7461 626c 650a 2020 2020 2020  urn table.      
+0003cd20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0003cd30: 2020 2020 6172 7261 7920 3d20 7461 626c      array = tabl
+0003cd40: 655b 2269 6e64 6963 6573 225d 0a20 2020  e["indices"].   
+0003cd50: 2020 2020 2020 2020 206e 6577 5f61 7272           new_arr
+0003cd60: 6179 203d 2070 632e 6164 6428 6172 7261  ay = pc.add(arra
+0003cd70: 792c 2070 612e 7363 616c 6172 286f 6666  y, pa.scalar(off
+0003cd80: 7365 742c 2074 7970 653d 7061 2e75 696e  set, type=pa.uin
+0003cd90: 7436 3428 2929 290a 2020 2020 2020 2020  t64())).        
+0003cda0: 2020 2020 7265 7475 726e 2049 6e4d 656d      return InMem
+0003cdb0: 6f72 7954 6162 6c65 2e66 726f 6d5f 6172  oryTable.from_ar
+0003cdc0: 7261 7973 285b 6e65 775f 6172 7261 795d  rays([new_array]
+0003cdd0: 2c20 6e61 6d65 733d 5b22 696e 6469 6365  , names=["indice
+0003cde0: 7322 5d29 0a0a 2020 2020 2320 436f 6e63  s"])..    # Conc
+0003cdf0: 6174 656e 6174 6520 696e 6469 6365 7320  atenate indices 
+0003ce00: 6966 2074 6865 7920 6578 6973 740a 2020  if they exist.  
+0003ce10: 2020 6966 2061 6e79 2864 7365 742e 5f69    if any(dset._i
+0003ce20: 6e64 6963 6573 2069 7320 6e6f 7420 4e6f  ndices is not No
+0003ce30: 6e65 2066 6f72 2064 7365 7420 696e 2064  ne for dset in d
+0003ce40: 7365 7473 293a 0a20 2020 2020 2020 2069  sets):.        i
+0003ce50: 6620 6178 6973 203d 3d20 303a 0a20 2020  f axis == 0:.   
+0003ce60: 2020 2020 2020 2020 2023 2044 6174 6173           # Datas
+0003ce70: 6574 7320 7769 7468 206e 6f20 696e 6469  ets with no indi
+0003ce80: 6365 7320 7461 626c 6573 2061 7265 2072  ces tables are r
+0003ce90: 6570 6c61 6365 6420 7769 7468 2061 2064  eplaced with a d
+0003cea0: 6174 6173 6574 2077 6974 6820 616e 2069  ataset with an i
+0003ceb0: 6e64 6963 6573 2074 6162 6c65 2069 6e20  ndices table in 
+0003cec0: 6d65 6d6f 7279 2e0a 2020 2020 2020 2020  memory..        
+0003ced0: 2020 2020 2320 4170 706c 7969 6e67 2061      # Applying a
+0003cee0: 6e20 6f66 6673 6574 2074 6f20 616e 2069  n offset to an i
+0003cef0: 6e64 6963 6573 2074 6162 6c65 2061 6c73  ndices table als
+0003cf00: 6f20 6272 696e 6773 2074 6865 2074 6162  o brings the tab
+0003cf10: 6c65 2069 6e20 6d65 6d6f 7279 2e0a 2020  le in memory..  
+0003cf20: 2020 2020 2020 2020 2020 696e 6469 6365            indice
+0003cf30: 735f 7461 626c 6573 203d 205b 5d0a 2020  s_tables = [].  
+0003cf40: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+0003cf50: 696e 2072 616e 6765 286c 656e 2864 7365  in range(len(dse
+0003cf60: 7473 2929 3a0a 2020 2020 2020 2020 2020  ts)):.          
+0003cf70: 2020 2020 2020 6966 2064 7365 7473 5b69        if dsets[i
+0003cf80: 5d2e 5f69 6e64 6963 6573 2069 7320 4e6f  ]._indices is No
+0003cf90: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0003cfa0: 2020 2020 2020 2020 6473 6574 735b 695d          dsets[i]
+0003cfb0: 203d 2064 7365 7473 5b69 5d2e 5f73 656c   = dsets[i]._sel
+0003cfc0: 6563 745f 7769 7468 5f69 6e64 6963 6573  ect_with_indices
+0003cfd0: 5f6d 6170 7069 6e67 2872 616e 6765 286c  _mapping(range(l
+0003cfe0: 656e 2864 7365 7473 5b69 5d29 2929 0a20  en(dsets[i]))). 
+0003cff0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003d000: 6e64 6963 6573 5f74 6162 6c65 732e 6170  ndices_tables.ap
+0003d010: 7065 6e64 2864 7365 7473 5b69 5d2e 5f69  pend(dsets[i]._i
+0003d020: 6e64 6963 6573 290a 0a20 2020 2020 2020  ndices)..       
+0003d030: 2020 2020 2023 2041 6e20 6f66 6673 6574       # An offset
+0003d040: 206e 6565 6473 2074 6f20 6265 2061 7070   needs to be app
+0003d050: 6c69 6564 2074 6f20 7468 6520 696e 6469  lied to the indi
+0003d060: 6365 7320 6265 666f 7265 2063 6f6e 6361  ces before conca
+0003d070: 7465 6e61 7469 6e67 0a20 2020 2020 2020  tenating.       
+0003d080: 2020 2020 206f 6666 7365 7420 3d20 300a       offset = 0.
+0003d090: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0003d0a0: 6920 696e 2072 616e 6765 286c 656e 2864  i in range(len(d
+0003d0b0: 7365 7473 2929 3a0a 2020 2020 2020 2020  sets)):.        
+0003d0c0: 2020 2020 2020 2020 696e 6469 6365 735f          indices_
+0003d0d0: 7461 626c 6573 5b69 5d20 3d20 6170 706c  tables[i] = appl
+0003d0e0: 795f 6f66 6673 6574 5f74 6f5f 696e 6469  y_offset_to_indi
+0003d0f0: 6365 735f 7461 626c 6528 696e 6469 6365  ces_table(indice
+0003d100: 735f 7461 626c 6573 5b69 5d2c 206f 6666  s_tables[i], off
+0003d110: 7365 7429 0a20 2020 2020 2020 2020 2020  set).           
+0003d120: 2020 2020 206f 6666 7365 7420 2b3d 206c       offset += l
+0003d130: 656e 2864 7365 7473 5b69 5d2e 5f64 6174  en(dsets[i]._dat
+0003d140: 6129 0a0a 2020 2020 2020 2020 2020 2020  a)..            
+0003d150: 2320 436f 6e63 6174 656e 6174 6520 696e  # Concatenate in
+0003d160: 6469 6365 730a 2020 2020 2020 2020 2020  dices.          
+0003d170: 2020 696e 6469 6365 735f 7461 626c 6573    indices_tables
+0003d180: 203d 205b 7420 666f 7220 7420 696e 2069   = [t for t in i
+0003d190: 6e64 6963 6573 5f74 6162 6c65 7320 6966  ndices_tables if
+0003d1a0: 206c 656e 2874 2920 3e20 305d 0a20 2020   len(t) > 0].   
+0003d1b0: 2020 2020 2020 2020 2069 6620 696e 6469           if indi
+0003d1c0: 6365 735f 7461 626c 6573 3a0a 2020 2020  ces_tables:.    
+0003d1d0: 2020 2020 2020 2020 2020 2020 696e 6469              indi
+0003d1e0: 6365 735f 7461 626c 6520 3d20 636f 6e63  ces_table = conc
+0003d1f0: 6174 5f74 6162 6c65 7328 696e 6469 6365  at_tables(indice
+0003d200: 735f 7461 626c 6573 290a 2020 2020 2020  s_tables).      
+0003d210: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0003d220: 2020 2020 2020 2020 2020 2020 696e 6469              indi
+0003d230: 6365 735f 7461 626c 6520 3d20 496e 4d65  ces_table = InMe
+0003d240: 6d6f 7279 5461 626c 652e 6672 6f6d 5f62  moryTable.from_b
+0003d250: 6174 6368 6573 285b 5d2c 2073 6368 656d  atches([], schem
+0003d260: 613d 7061 2e73 6368 656d 6128 7b22 696e  a=pa.schema({"in
+0003d270: 6469 6365 7322 3a20 7061 2e69 6e74 3634  dices": pa.int64
+0003d280: 2829 7d29 290a 2020 2020 2020 2020 656c  ()})).        el
+0003d290: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0003d2a0: 6966 206c 656e 2864 7365 7473 2920 3d3d  if len(dsets) ==
+0003d2b0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0003d2c0: 2020 2020 696e 6469 6365 735f 7461 626c      indices_tabl
+0003d2d0: 6520 3d20 6473 6574 735b 305d 2e5f 696e  e = dsets[0]._in
+0003d2e0: 6469 6365 730a 2020 2020 2020 2020 2020  dices.          
+0003d2f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0003d300: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+0003d310: 2072 616e 6765 286c 656e 2864 7365 7473   range(len(dsets
+0003d320: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0003d330: 2020 2020 2020 2020 6473 6574 735b 695d          dsets[i]
+0003d340: 203d 2064 7365 7473 5b69 5d2e 666c 6174   = dsets[i].flat
+0003d350: 7465 6e5f 696e 6469 6365 7328 290a 2020  ten_indices().  
+0003d360: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0003d370: 6469 6365 735f 7461 626c 6520 3d20 4e6f  dices_table = No
+0003d380: 6e65 0a20 2020 2065 6c73 653a 0a20 2020  ne.    else:.   
+0003d390: 2020 2020 2069 6e64 6963 6573 5f74 6162       indices_tab
+0003d3a0: 6c65 203d 204e 6f6e 650a 0a20 2020 2074  le = None..    t
+0003d3b0: 6162 6c65 203d 2063 6f6e 6361 745f 7461  able = concat_ta
+0003d3c0: 626c 6573 285b 6473 6574 2e5f 6461 7461  bles([dset._data
+0003d3d0: 2066 6f72 2064 7365 7420 696e 2064 7365   for dset in dse
+0003d3e0: 7473 5d2c 2061 7869 733d 6178 6973 290a  ts], axis=axis).
+0003d3f0: 2020 2020 6966 2061 7869 7320 3d3d 2030      if axis == 0
+0003d400: 3a0a 2020 2020 2020 2020 6665 6174 7572  :.        featur
+0003d410: 6573 5f6c 6973 7420 3d20 5f61 6c69 676e  es_list = _align
+0003d420: 5f66 6561 7475 7265 7328 5b64 7365 742e  _features([dset.
+0003d430: 6665 6174 7572 6573 2066 6f72 2064 7365  features for dse
+0003d440: 7420 696e 2064 7365 7473 5d29 0a20 2020  t in dsets]).   
+0003d450: 2065 6c73 653a 0a20 2020 2020 2020 2066   else:.        f
+0003d460: 6561 7475 7265 735f 6c69 7374 203d 205b  eatures_list = [
+0003d470: 6473 6574 2e66 6561 7475 7265 7320 666f  dset.features fo
+0003d480: 7220 6473 6574 2069 6e20 6473 6574 735d  r dset in dsets]
+0003d490: 0a20 2020 2074 6162 6c65 203d 2075 7064  .    table = upd
+0003d4a0: 6174 655f 6d65 7461 6461 7461 5f77 6974  ate_metadata_wit
+0003d4b0: 685f 6665 6174 7572 6573 2874 6162 6c65  h_features(table
+0003d4c0: 2c20 7b6b 3a20 7620 666f 7220 6665 6174  , {k: v for feat
+0003d4d0: 7572 6573 2069 6e20 6665 6174 7572 6573  ures in features
+0003d4e0: 5f6c 6973 7420 666f 7220 6b2c 2076 2069  _list for k, v i
+0003d4f0: 6e20 6665 6174 7572 6573 2e69 7465 6d73  n features.items
+0003d500: 2829 7d29 0a0a 2020 2020 2320 436f 6e63  ()})..    # Conc
+0003d510: 6174 656e 6174 6520 696e 666f 730a 2020  atenate infos.  
+0003d520: 2020 6966 2069 6e66 6f20 6973 204e 6f6e    if info is Non
+0003d530: 653a 0a20 2020 2020 2020 2069 6e66 6f20  e:.        info 
+0003d540: 3d20 4461 7461 7365 7449 6e66 6f2e 6672  = DatasetInfo.fr
+0003d550: 6f6d 5f6d 6572 6765 285b 6473 6574 2e69  om_merge([dset.i
+0003d560: 6e66 6f20 666f 7220 6473 6574 2069 6e20  nfo for dset in 
+0003d570: 6473 6574 735d 290a 2020 2020 6669 6e67  dsets]).    fing
+0003d580: 6572 7072 696e 7420 3d20 7570 6461 7465  erprint = update
+0003d590: 5f66 696e 6765 7270 7269 6e74 280a 2020  _fingerprint(.  
+0003d5a0: 2020 2020 2020 2222 2e6a 6f69 6e28 6473        "".join(ds
+0003d5b0: 6574 2e5f 6669 6e67 6572 7072 696e 7420  et._fingerprint 
+0003d5c0: 666f 7220 6473 6574 2069 6e20 6473 6574  for dset in dset
+0003d5d0: 7329 2c20 5f63 6f6e 6361 7465 6e61 7465  s), _concatenate
+0003d5e0: 5f6d 6170 5f73 7479 6c65 5f64 6174 6173  _map_style_datas
+0003d5f0: 6574 732c 207b 2269 6e66 6f22 3a20 696e  ets, {"info": in
+0003d600: 666f 2c20 2273 706c 6974 223a 2073 706c  fo, "split": spl
+0003d610: 6974 7d0a 2020 2020 290a 0a20 2020 2023  it}.    )..    #
+0003d620: 204d 616b 6520 6669 6e61 6c20 636f 6e63   Make final conc
+0003d630: 6174 656e 6174 6564 2064 6174 6173 6574  atenated dataset
+0003d640: 0a20 2020 2063 6f6e 6361 7465 6e61 7465  .    concatenate
+0003d650: 645f 6461 7461 7365 7420 3d20 4461 7461  d_dataset = Data
+0003d660: 7365 7428 0a20 2020 2020 2020 2074 6162  set(.        tab
+0003d670: 6c65 2c0a 2020 2020 2020 2020 696e 666f  le,.        info
+0003d680: 3d69 6e66 6f2c 0a20 2020 2020 2020 2073  =info,.        s
+0003d690: 706c 6974 3d73 706c 6974 2c0a 2020 2020  plit=split,.    
+0003d6a0: 2020 2020 696e 6469 6365 735f 7461 626c      indices_tabl
+0003d6b0: 653d 696e 6469 6365 735f 7461 626c 652c  e=indices_table,
+0003d6c0: 0a20 2020 2020 2020 2066 696e 6765 7270  .        fingerp
+0003d6d0: 7269 6e74 3d66 696e 6765 7270 7269 6e74  rint=fingerprint
+0003d6e0: 2c0a 2020 2020 290a 2020 2020 636f 6e63  ,.    ).    conc
+0003d6f0: 6174 656e 6174 6564 5f64 6174 6173 6574  atenated_dataset
+0003d700: 2e73 6574 5f66 6f72 6d61 7428 2a2a 666f  .set_format(**fo
+0003d710: 726d 6174 290a 2020 2020 7265 7475 726e  rmat).    return
+0003d720: 2063 6f6e 6361 7465 6e61 7465 645f 6461   concatenated_da
+0003d730: 7461 7365 740a 0a0a 6465 6620 5f69 6e74  taset...def _int
+0003d740: 6572 6c65 6176 655f 6d61 705f 7374 796c  erleave_map_styl
+0003d750: 655f 6461 7461 7365 7473 280a 2020 2020  e_datasets(.    
+0003d760: 6461 7461 7365 7473 3a20 4c69 7374 5b22  datasets: List["
+0003d770: 4461 7461 7365 7422 5d2c 0a20 2020 2070  Dataset"],.    p
+0003d780: 726f 6261 6269 6c69 7469 6573 3a20 4f70  robabilities: Op
+0003d790: 7469 6f6e 616c 5b4c 6973 745b 666c 6f61  tional[List[floa
+0003d7a0: 745d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  t]] = None,.    
+0003d7b0: 7365 6564 3a20 4f70 7469 6f6e 616c 5b69  seed: Optional[i
+0003d7c0: 6e74 5d20 3d20 4e6f 6e65 2c0a 2020 2020  nt] = None,.    
+0003d7d0: 696e 666f 3a20 4f70 7469 6f6e 616c 5b44  info: Optional[D
+0003d7e0: 6174 6173 6574 496e 666f 5d20 3d20 4e6f  atasetInfo] = No
+0003d7f0: 6e65 2c0a 2020 2020 7370 6c69 743a 204f  ne,.    split: O
+0003d800: 7074 696f 6e61 6c5b 4e61 6d65 6453 706c  ptional[NamedSpl
+0003d810: 6974 5d20 3d20 4e6f 6e65 2c0a 2020 2020  it] = None,.    
+0003d820: 7374 6f70 7069 6e67 5f73 7472 6174 6567  stopping_strateg
+0003d830: 793a 204f 7074 696f 6e61 6c5b 7374 725d  y: Optional[str]
+0003d840: 203d 2022 6669 7273 745f 6578 6861 7573   = "first_exhaus
+0003d850: 7465 6422 2c0a 2020 2020 2a2a 6b77 6172  ted",.    **kwar
+0003d860: 6773 2c0a 2920 2d3e 2022 4461 7461 7365  gs,.) -> "Datase
+0003d870: 7422 3a0a 2020 2020 2222 220a 2020 2020  t":.    """.    
+0003d880: 496e 7465 726c 6561 7665 2073 6576 6572  Interleave sever
+0003d890: 616c 206d 6170 2d73 7479 6c65 2064 6174  al map-style dat
+0003d8a0: 6173 6574 7320 2873 6f75 7263 6573 2920  asets (sources) 
+0003d8b0: 696e 746f 2061 2073 696e 676c 6520 6d61  into a single ma
+0003d8c0: 702d 7374 796c 6520 6461 7461 7365 742e  p-style dataset.
+0003d8d0: 0a20 2020 2054 6865 206e 6577 2064 6174  .    The new dat
+0003d8e0: 6173 6574 2069 7320 636f 6e73 7472 7563  aset is construc
+0003d8f0: 7465 6420 6279 2061 6c74 6572 6e61 7469  ted by alternati
+0003d900: 6e67 2062 6574 7765 656e 2074 6865 2073  ng between the s
+0003d910: 6f75 7263 6573 2074 6f20 6765 7420 7468  ources to get th
+0003d920: 6520 6578 616d 706c 6573 2e0a 2020 2020  e examples..    
+0003d930: 4966 2060 7072 6f62 6162 696c 6974 6965  If `probabilitie
+0003d940: 7320 3d20 4e6f 6e65 6020 2864 6566 6175  s = None` (defau
+0003d950: 6c74 2920 7468 6520 6e65 7720 6461 7461  lt) the new data
+0003d960: 7365 7420 6973 2063 6f6e 7374 7275 6374  set is construct
+0003d970: 6564 2062 7920 6379 636c 696e 6720 6265  ed by cycling be
+0003d980: 7477 6565 6e20 6561 6368 2073 6f75 7263  tween each sourc
+0003d990: 6520 746f 2067 6574 2074 6865 2065 7861  e to get the exa
+0003d9a0: 6d70 6c65 732e 0a20 2020 2049 6620 6070  mples..    If `p
+0003d9b0: 726f 6261 6269 6c69 7469 6573 6020 6973  robabilities` is
+0003d9c0: 206e 6f74 2060 4e6f 6e65 2c20 7468 6520   not `None, the 
+0003d9d0: 6e65 7720 6461 7461 7365 7420 6973 2063  new dataset is c
+0003d9e0: 6f6e 7374 7275 6374 6564 2062 7920 6765  onstructed by ge
+0003d9f0: 7474 696e 6720 6578 616d 706c 6573 2066  tting examples f
+0003da00: 726f 6d20 6120 7261 6e64 6f6d 2073 6f75  rom a random sou
+0003da10: 7263 6520 6174 2061 2074 696d 6520 6163  rce at a time ac
+0003da20: 636f 7264 696e 6720 746f 2074 6865 2070  cording to the p
+0003da30: 726f 7669 6465 6420 7072 6f62 6162 696c  rovided probabil
+0003da40: 6974 6965 732e 0a0a 2020 2020 4172 6773  ities...    Args
+0003da50: 3a0a 2020 2020 2020 2020 6461 7461 7365  :.        datase
+0003da60: 7473 2028 604c 6973 745b 4461 7461 7365  ts (`List[Datase
+0003da70: 745d 6029 3a20 6c69 7374 206f 6620 6461  t]`): list of da
+0003da80: 7461 7365 7473 2074 6f20 696e 7465 726c  tasets to interl
+0003da90: 6561 7665 0a20 2020 2020 2020 2070 726f  eave.        pro
+0003daa0: 6261 6269 6c69 7469 6573 2028 604c 6973  babilities (`Lis
+0003dab0: 745b 666c 6f61 745d 602c 206f 7074 696f  t[float]`, optio
+0003dac0: 6e61 6c2c 2064 6566 6175 6c74 204e 6f6e  nal, default Non
+0003dad0: 6529 3a20 4966 2073 7065 6369 6669 6564  e): If specified
+0003dae0: 2c20 7468 6520 6e65 7720 6461 7461 7365  , the new datase
+0003daf0: 7420 6973 2063 6f6e 7374 7275 6374 6564  t is constructed
+0003db00: 2062 7920 7361 6d70 6c69 6e67 0a20 2020   by sampling.   
+0003db10: 2020 2020 2020 2020 2065 7861 6d70 6c65           example
+0003db20: 7320 6672 6f6d 206f 6e65 2073 6f75 7263  s from one sourc
+0003db30: 6520 6174 2061 2074 696d 6520 6163 636f  e at a time acco
+0003db40: 7264 696e 6720 746f 2074 6865 7365 2070  rding to these p
+0003db50: 726f 6261 6269 6c69 7469 6573 2e0a 2020  robabilities..  
+0003db60: 2020 2020 2020 7365 6564 2028 6069 6e74        seed (`int
+0003db70: 602c 206f 7074 696f 6e61 6c2c 2064 6566  `, optional, def
+0003db80: 6175 6c74 204e 6f6e 6529 3a20 5468 6520  ault None): The 
+0003db90: 7261 6e64 6f6d 2073 6565 6420 7573 6564  random seed used
+0003dba0: 2074 6f20 6368 6f6f 7365 2061 2073 6f75   to choose a sou
+0003dbb0: 7263 6520 666f 7220 6561 6368 2065 7861  rce for each exa
+0003dbc0: 6d70 6c65 2e0a 2020 2020 2020 2020 696e  mple..        in
+0003dbd0: 666f 2028 3a63 6c61 7373 3a60 4461 7461  fo (:class:`Data
+0003dbe0: 7365 7449 6e66 6f60 2c20 6f70 7469 6f6e  setInfo`, option
+0003dbf0: 616c 293a 2044 6174 6173 6574 2069 6e66  al): Dataset inf
+0003dc00: 6f72 6d61 7469 6f6e 2c20 6c69 6b65 2064  ormation, like d
+0003dc10: 6573 6372 6970 7469 6f6e 2c20 6369 7461  escription, cita
+0003dc20: 7469 6f6e 2c20 6574 632e 0a20 2020 2020  tion, etc..     
+0003dc30: 2020 2073 706c 6974 2028 3a63 6c61 7373     split (:class
+0003dc40: 3a60 4e61 6d65 6453 706c 6974 602c 206f  :`NamedSplit`, o
+0003dc50: 7074 696f 6e61 6c29 3a20 4e61 6d65 206f  ptional): Name o
+0003dc60: 6620 7468 6520 6461 7461 7365 7420 7370  f the dataset sp
+0003dc70: 6c69 742e 0a20 2020 2020 2020 2073 746f  lit..        sto
+0003dc80: 7070 696e 675f 7374 7261 7465 6779 2028  pping_strategy (
+0003dc90: 4f70 7469 6f6e 616c 2060 7374 7260 2c20  Optional `str`, 
+0003dca0: 6465 6661 756c 7473 2074 6f20 6066 6972  defaults to `fir
+0003dcb0: 7374 5f65 7868 6175 7374 6564 6029 3a0a  st_exhausted`):.
+0003dcc0: 2020 2020 2020 2020 2020 2020 5477 6f20              Two 
+0003dcd0: 7374 7261 7465 6769 6573 2061 7265 2070  strategies are p
+0003dce0: 726f 706f 7365 6420 7269 6768 7420 6e6f  roposed right no
+0003dcf0: 772e 0a20 2020 2020 2020 2020 2020 2042  w..            B
+0003dd00: 7920 6465 6661 756c 742c 2060 6669 7273  y default, `firs
+0003dd10: 745f 6578 6861 7573 7465 6460 2069 7320  t_exhausted` is 
+0003dd20: 616e 2075 6e64 6572 7361 6d70 6c69 6e67  an undersampling
+0003dd30: 2073 7472 6174 6567 792c 2069 2e65 2074   strategy, i.e t
+0003dd40: 6865 2064 6174 6173 6574 2063 6f6e 7374  he dataset const
+0003dd50: 7275 6374 696f 6e20 6973 2073 746f 7070  ruction is stopp
+0003dd60: 6564 2061 7320 736f 6f6e 2061 7320 6f6e  ed as soon as on
+0003dd70: 6520 6461 7461 7365 7420 6861 7320 7261  e dataset has ra
+0003dd80: 6e20 6f75 7420 6f66 2073 616d 706c 6573  n out of samples
+0003dd90: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
+0003dda0: 2074 6865 2073 7472 6174 6567 7920 6973   the strategy is
+0003ddb0: 2060 616c 6c5f 6578 6861 7573 7465 6460   `all_exhausted`
+0003ddc0: 2c20 2077 6520 7573 6520 616e 206f 7665  ,  we use an ove
+0003ddd0: 7273 616d 706c 696e 6720 7374 7261 7465  rsampling strate
+0003dde0: 6779 2c20 692e 6520 7468 6520 6461 7461  gy, i.e the data
+0003ddf0: 7365 7420 636f 6e73 7472 7563 7469 6f6e  set construction
+0003de00: 2069 7320 7374 6f70 7065 6420 6173 2073   is stopped as s
+0003de10: 6f6f 6e20 6173 2065 7665 7279 2073 616d  oon as every sam
+0003de20: 706c 6573 206f 6620 6576 6572 7920 6461  ples of every da
+0003de30: 7461 7365 7420 6861 7320 6265 656e 2061  taset has been a
+0003de40: 6464 6564 2061 7420 6c65 6173 7420 6f6e  dded at least on
+0003de50: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
+0003de60: 4e6f 7465 2074 6861 7420 6966 2074 6865  Note that if the
+0003de70: 2073 7472 6174 6567 7920 6973 2060 616c   strategy is `al
+0003de80: 6c5f 6578 6861 7573 7465 6460 2c20 7468  l_exhausted`, th
+0003de90: 6520 696e 7465 726c 6561 7665 6420 6461  e interleaved da
+0003dea0: 7461 7365 7420 7369 7a65 2063 616e 2067  taset size can g
+0003deb0: 6574 2065 6e6f 726d 6f75 733a 0a20 2020  et enormous:.   
+0003dec0: 2020 2020 2020 2020 202d 2077 6974 6820           - with 
+0003ded0: 6e6f 2070 726f 6261 6269 6c69 7469 6573  no probabilities
+0003dee0: 2c20 7468 6520 7265 7375 6c74 696e 6720  , the resulting 
+0003def0: 6461 7461 7365 7420 7769 6c6c 2068 6176  dataset will hav
+0003df00: 6520 6d61 785f 6c65 6e67 7468 5f64 6174  e max_length_dat
+0003df10: 6173 6574 732a 6e62 5f64 6174 6173 6574  asets*nb_dataset
+0003df20: 2073 616d 706c 6573 2e0a 2020 2020 2020   samples..      
+0003df30: 2020 2020 2020 2d20 7769 7468 2067 6976        - with giv
+0003df40: 656e 2070 726f 6261 6269 6c69 7469 6573  en probabilities
+0003df50: 2c20 7468 6520 7265 7375 6c74 696e 6720  , the resulting 
+0003df60: 6461 7461 7365 7420 7769 6c6c 2068 6176  dataset will hav
+0003df70: 6520 6d6f 7265 2073 616d 706c 6573 2069  e more samples i
+0003df80: 6620 736f 6d65 2064 6174 6173 6574 7320  f some datasets 
+0003df90: 6861 7665 2072 6561 6c6c 7920 6c6f 7720  have really low 
+0003dfa0: 7072 6f62 6162 696c 6974 7920 6f66 2076  probability of v
+0003dfb0: 6973 6974 696e 672e 0a20 2020 2020 2020  isiting..       
+0003dfc0: 202a 2a6b 7761 7267 7320 2861 6464 6974   **kwargs (addit
+0003dfd0: 696f 6e61 6c20 6b65 7977 6f72 6420 6172  ional keyword ar
+0003dfe0: 6775 6d65 6e74 7329 3a20 4b65 7977 6f72  guments): Keywor
+0003dff0: 6420 6172 6775 6d65 6e74 7320 746f 2062  d arguments to b
+0003e000: 6520 7061 7373 6564 2074 6f20 3a6d 6574  e passed to :met
+0003e010: 683a 6064 6174 6173 6574 732e 4461 7461  h:`datasets.Data
+0003e020: 7365 7473 2e73 656c 6563 7460 2077 6865  sets.select` whe
+0003e030: 6e20 7365 6c65 6374 696e 6720 7468 6520  n selecting the 
+0003e040: 696e 6469 6365 7320 7573 6564 2074 6f20  indices used to 
+0003e050: 696e 7465 726c 6561 7665 2074 6865 2064  interleave the d
+0003e060: 6174 6173 6574 732e 0a0a 2020 2020 4f75  atasets...    Ou
+0003e070: 7470 7574 3a0a 2020 2020 2020 2020 3a63  tput:.        :c
+0003e080: 6c61 7373 3a60 6461 7461 7365 7473 2e44  lass:`datasets.D
+0003e090: 6174 6173 6574 600a 2020 2020 2222 220a  ataset`.    """.
+0003e0a0: 2020 2020 6966 2073 746f 7070 696e 675f      if stopping_
+0003e0b0: 7374 7261 7465 6779 206e 6f74 2069 6e20  strategy not in 
+0003e0c0: 5b22 6669 7273 745f 6578 6861 7573 7465  ["first_exhauste
+0003e0d0: 6422 2c20 2261 6c6c 5f65 7868 6175 7374  d", "all_exhaust
+0003e0e0: 6564 225d 3a0a 2020 2020 2020 2020 7261  ed"]:.        ra
+0003e0f0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+0003e100: 2020 2020 2020 2020 2020 2020 6622 7b73              f"{s
+0003e110: 746f 7070 696e 675f 7374 7261 7465 6779  topping_strategy
+0003e120: 7d20 7374 6f70 7069 6e67 2073 7472 6174  } stopping strat
+0003e130: 6567 7920 696e 2060 696e 7465 726c 6561  egy in `interlea
+0003e140: 7665 5f64 6174 6173 6574 7360 2069 7320  ve_datasets` is 
+0003e150: 6e6f 7420 696d 706c 656d 656e 7465 6420  not implemented 
+0003e160: 7965 7420 7769 7468 2061 206c 6973 7420  yet with a list 
+0003e170: 6f66 207b 7479 7065 2864 6174 6173 6574  of {type(dataset
+0003e180: 735b 305d 297d 220a 2020 2020 2020 2020  s[0])}".        
+0003e190: 290a 0a20 2020 2023 2054 6f20 696e 7465  )..    # To inte
+0003e1a0: 726c 6561 7665 2074 6865 2064 6174 6173  rleave the datas
+0003e1b0: 6574 732c 2077 6520 636f 6e63 6174 656e  ets, we concaten
+0003e1c0: 6174 6520 7468 656d 2061 6e64 2074 6865  ate them and the
+0003e1d0: 6e20 7765 2072 652d 6f72 6465 7220 7468  n we re-order th
+0003e1e0: 6520 696e 6469 6365 730a 2020 2020 636f  e indices.    co
+0003e1f0: 6e63 6174 656e 6174 6564 5f64 6174 6173  ncatenated_datas
+0003e200: 6574 7320 3d20 5f63 6f6e 6361 7465 6e61  ets = _concatena
+0003e210: 7465 5f6d 6170 5f73 7479 6c65 5f64 6174  te_map_style_dat
+0003e220: 6173 6574 7328 6461 7461 7365 7473 2c20  asets(datasets, 
+0003e230: 696e 666f 3d69 6e66 6f2c 2073 706c 6974  info=info, split
+0003e240: 3d73 706c 6974 290a 0a20 2020 2023 204c  =split)..    # L
+0003e250: 6574 2773 206e 6f77 2062 7569 6c64 2074  et's now build t
+0003e260: 6865 2069 6e64 6963 6573 2074 6f20 7061  he indices to pa
+0003e270: 7373 2074 6f20 2e73 656c 6563 7428 290a  ss to .select().
+0003e280: 2020 2020 6c65 6e67 7468 7320 3d20 5b6c      lengths = [l
+0003e290: 656e 2864 7365 7429 2066 6f72 2064 7365  en(dset) for dse
+0003e2a0: 7420 696e 2064 6174 6173 6574 735d 0a20  t in datasets]. 
+0003e2b0: 2020 206f 6666 7365 7473 203d 206e 702e     offsets = np.
+0003e2c0: 6375 6d73 756d 285b 305d 202b 206c 656e  cumsum([0] + len
+0003e2d0: 6774 6873 5b3a 2d31 5d29 0a0a 2020 2020  gths[:-1])..    
+0003e2e0: 2320 6966 2073 746f 7070 696e 675f 7374  # if stopping_st
+0003e2f0: 7261 7465 6779 2069 7320 2266 6972 7374  rategy is "first
+0003e300: 5f65 7868 6175 7374 6564 222c 2069 7420  _exhausted", it 
+0003e310: 6973 2061 6e20 756e 6465 7273 616d 706c  is an undersampl
+0003e320: 696e 6720 7369 7475 6174 696f 6e20 7768  ing situation wh
+0003e330: 6572 6561 7320 6974 2069 7320 616e 206f  ereas it is an o
+0003e340: 7665 7273 616d 706c 696e 6720 7369 7475  versampling situ
+0003e350: 6174 696f 6e20 6966 2069 7420 6973 2022  ation if it is "
+0003e360: 616c 6c5f 6578 6861 7573 7465 6422 0a20  all_exhausted". 
+0003e370: 2020 206f 7665 7273 616d 706c 696e 6720     oversampling 
+0003e380: 3d20 7374 6f70 7069 6e67 5f73 7472 6174  = stopping_strat
+0003e390: 6567 7920 3d3d 2022 616c 6c5f 6578 6861  egy == "all_exha
+0003e3a0: 7573 7465 6422 0a0a 2020 2020 6966 2070  usted"..    if p
+0003e3b0: 726f 6261 6269 6c69 7469 6573 2069 7320  robabilities is 
+0003e3c0: 4e6f 6e65 2061 6e64 206e 6f74 206f 7665  None and not ove
+0003e3d0: 7273 616d 706c 696e 673a 0a20 2020 2020  rsampling:.     
+0003e3e0: 2020 2023 2055 6e64 6572 7361 6d70 6c69     # Undersampli
+0003e3f0: 6e67 2073 6974 7561 7469 6f6e 2077 6974  ng situation wit
+0003e400: 6820 6379 636c 696e 6720 6265 7477 6565  h cycling betwee
+0003e410: 6e20 6561 6368 2073 6f75 7263 6573 0a20  n each sources. 
+0003e420: 2020 2020 2020 2023 2045 7861 6d70 6c65         # Example
+0003e430: 3a3a 2049 6620 6c65 6e67 7468 7320 6f66  :: If lengths of
+0003e440: 2074 6865 2064 6174 6173 6574 7320 6172   the datasets ar
+0003e450: 6520 5b33 2c20 342c 2035 5d0a 2020 2020  e [3, 4, 5].    
+0003e460: 2020 2020 2320 5468 656e 2074 6865 2072      # Then the r
+0003e470: 6573 756c 7469 6e67 2069 6e64 6963 6573  esulting indices
+0003e480: 2073 686f 756c 6420 6265 205b 302c 2033   should be [0, 3
+0003e490: 2c20 372c 2031 2c20 342c 2038 2c20 322c  , 7, 1, 4, 8, 2,
+0003e4a0: 2036 2c20 395d 0a20 2020 2020 2020 2023   6, 9].        #
+0003e4b0: 204e 6f74 6520 7468 6174 2077 6520 6f6e   Note that we on
+0003e4c0: 6c79 2068 6176 6520 3320 6578 616d 706c  ly have 3 exampl
+0003e4d0: 6573 2070 6572 2064 6174 6173 6574 2073  es per dataset s
+0003e4e0: 696e 6365 2074 6865 2066 6972 7374 2064  ince the first d
+0003e4f0: 6174 6173 6574 2072 616e 206f 7574 206f  ataset ran out o
+0003e500: 6620 6578 616d 706c 6573 0a0a 2020 2020  f examples..    
+0003e510: 2020 2020 2320 5265 6173 6f6e 696e 6720      # Reasoning 
+0003e520: 6265 6869 6e64 2074 6865 2066 6f6c 6c6f  behind the follo
+0003e530: 7769 6e67 206f 7065 7261 7469 6f6e 3a20  wing operation: 
+0003e540: 6b65 6570 696e 6720 7468 6520 6d69 6e5f  keeping the min_
+0003e550: 6c65 6e67 7468 2066 6972 7374 2069 6e64  length first ind
+0003e560: 6963 6573 206f 6620 6561 6368 2064 6174  ices of each dat
+0003e570: 6173 6574 0a20 2020 2020 2020 2023 2077  aset.        # w
+0003e580: 6869 6c65 206f 6666 7365 7474 696e 6720  hile offsetting 
+0003e590: 696e 206f 7264 6572 2074 6f20 636f 7272  in order to corr
+0003e5a0: 6573 706f 6e64 2074 6f20 7468 6520 7269  espond to the ri
+0003e5b0: 6768 7420 696e 6469 6365 7320 6f66 2074  ght indices of t
+0003e5c0: 6865 2063 6f6e 6361 7465 6e61 7465 6420  he concatenated 
+0003e5d0: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
+0003e5e0: 2320 616e 6420 666c 6174 7465 6e69 6e67  # and flattening
+0003e5f0: 2074 6f20 6566 6665 6374 6976 656c 7920   to effectively 
+0003e600: 696e 7465 726c 6561 7665 2074 6865 2064  interleave the d
+0003e610: 6174 6173 6574 730a 2020 2020 2020 2020  atasets.        
+0003e620: 696e 6469 6365 7320 3d20 286f 6666 7365  indices = (offse
+0003e630: 7473 2e72 6573 6861 7065 2831 2c20 2d31  ts.reshape(1, -1
+0003e640: 2920 2b20 6e70 2e61 7261 6e67 6528 6d69  ) + np.arange(mi
+0003e650: 6e28 6c65 6e67 7468 7329 292e 7265 7368  n(lengths)).resh
+0003e660: 6170 6528 2d31 2c20 3129 292e 666c 6174  ape(-1, 1)).flat
+0003e670: 7465 6e28 292e 746f 6c69 7374 2829 0a20  ten().tolist(). 
+0003e680: 2020 2065 6c69 6620 7072 6f62 6162 696c     elif probabil
+0003e690: 6974 6965 7320 6973 204e 6f6e 653a 0a20  ities is None:. 
+0003e6a0: 2020 2020 2020 2023 204f 7665 7273 616d         # Oversam
+0003e6b0: 706c 696e 6720 7369 7475 6174 696f 6e20  pling situation 
+0003e6c0: 7769 7468 2063 7963 6c69 6e67 2062 6574  with cycling bet
+0003e6d0: 7765 656e 2065 6163 6820 736f 7572 6365  ween each source
+0003e6e0: 730a 2020 2020 2020 2020 2320 5468 656e  s.        # Then
+0003e6f0: 2074 6865 2072 6573 756c 7469 6e67 2069   the resulting i
+0003e700: 6e64 6963 6573 2073 686f 756c 6420 6265  ndices should be
+0003e710: 205b 302c 2033 2c20 372c 2031 2c20 342c   [0, 3, 7, 1, 4,
+0003e720: 2038 2c20 322c 2035 2c20 392c 2030 2c20   8, 2, 5, 9, 0, 
+0003e730: 362c 2031 302c 2031 2c20 332c 2031 315d  6, 10, 1, 3, 11]
+0003e740: 0a20 2020 2020 2020 2023 204e 6f74 6520  .        # Note 
+0003e750: 7468 6174 2077 6520 6861 7665 2035 2065  that we have 5 e
+0003e760: 7861 6d70 6c65 7320 7065 7220 6461 7461  xamples per data
+0003e770: 7365 7420 7769 7468 2061 2072 6f6c 6c69  set with a rolli
+0003e780: 6e67 2077 696e 646f 7720 7369 6e63 6520  ng window since 
+0003e790: 7468 6520 6c6f 6e67 6573 7420 6461 7461  the longest data
+0003e7a0: 7365 7420 6861 7320 3520 7361 6d70 6c65  set has 5 sample
+0003e7b0: 730a 0a20 2020 2020 2020 2023 2052 6561  s..        # Rea
+0003e7c0: 736f 6e69 6e67 2062 6568 696e 6420 7468  soning behind th
+0003e7d0: 6520 666f 6c6c 6f77 696e 6720 6f70 6572  e following oper
+0003e7e0: 6174 696f 6e3a 2066 6f72 2065 6163 6820  ation: for each 
+0003e7f0: 6461 7461 7365 7420 696e 6469 6365 7320  dataset indices 
+0003e800: 2869 2e65 2063 6f6c 756d 6e29 2072 6570  (i.e column) rep
+0003e810: 6561 7420 7468 6520 696e 6469 6365 7320  eat the indices 
+0003e820: 746f 2068 6176 6520 6d61 785f 6c65 6e67  to have max_leng
+0003e830: 7468 2069 6e64 6963 6573 2070 6572 2064  th indices per d
+0003e840: 6174 6173 6574 0a20 2020 2020 2020 2023  ataset.        #
+0003e850: 2046 6f72 2065 7861 6d70 6c65 2c20 6966   For example, if
+0003e860: 2074 6865 206d 6178 5f6c 656e 6774 6820   the max_length 
+0003e870: 6973 2035 2061 6e64 2074 6865 2069 2d74  is 5 and the i-t
+0003e880: 6820 6461 7461 7365 7420 6861 7320 3320  h dataset has 3 
+0003e890: 7361 6d70 6c65 732c 2074 6865 2069 2d74  samples, the i-t
+0003e8a0: 6820 636f 6c75 6d6e 2077 696c 6c20 6265  h column will be
+0003e8b0: 205b 302c 312c 322c 302c 315d 0a20 2020   [0,1,2,0,1].   
+0003e8c0: 2020 2020 2069 6e64 6963 6573 203d 206e       indices = n
+0003e8d0: 702e 6d6f 6428 6e70 2e61 7261 6e67 6528  p.mod(np.arange(
+0003e8e0: 6d61 7828 6c65 6e67 7468 7329 292e 7265  max(lengths)).re
+0003e8f0: 7368 6170 6528 2d31 2c20 3129 2c20 6e70  shape(-1, 1), np
+0003e900: 2e61 7272 6179 286c 656e 6774 6873 292e  .array(lengths).
+0003e910: 7265 7368 6170 6528 312c 202d 3129 290a  reshape(1, -1)).
+0003e920: 0a20 2020 2020 2020 2023 2057 6520 6861  .        # We ha
+0003e930: 7665 2074 6f20 6b65 6570 2074 6865 2069  ve to keep the i
+0003e940: 6e64 6963 6573 2074 6f20 7468 6569 7220  ndices to their 
+0003e950: 7265 7370 6563 7469 7665 2064 6174 6173  respective datas
+0003e960: 6574 206f 6666 7365 7473 2061 6e64 2074  et offsets and t
+0003e970: 6f20 666c 6174 7465 6e20 746f 2065 6666  o flatten to eff
+0003e980: 6563 7469 7665 6c79 2069 6e74 6572 6c65  ectively interle
+0003e990: 6176 6520 7468 6520 6461 7461 7365 7473  ave the datasets
+0003e9a0: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
+0003e9b0: 203d 2028 696e 6469 6365 7320 2b20 6f66   = (indices + of
+0003e9c0: 6673 6574 7329 2e66 6c61 7474 656e 2829  fsets).flatten()
+0003e9d0: 2e74 6f6c 6973 7428 290a 0a20 2020 2065  .tolist()..    e
+0003e9e0: 6c73 653a 0a20 2020 2020 2020 2023 2062  lse:.        # b
+0003e9f0: 6f6f 6c65 616e 2061 7272 6179 2069 6e64  oolean array ind
+0003ea00: 6963 6174 696e 6720 6966 2061 7420 696e  icating if at in
+0003ea10: 6465 7820 6920 6966 2074 6865 2064 6174  dex i if the dat
+0003ea20: 6173 6574 5f69 2068 6173 2062 6565 6e20  aset_i has been 
+0003ea30: 6675 6c6c 7920 6578 6861 7573 7465 640a  fully exhausted.
+0003ea40: 2020 2020 2020 2020 6973 5f65 7868 6175          is_exhau
+0003ea50: 7374 6564 203d 206e 702e 6675 6c6c 286c  sted = np.full(l
+0003ea60: 656e 286c 656e 6774 6873 292c 2046 616c  en(lengths), Fal
+0003ea70: 7365 290a 0a20 2020 2020 2020 2023 2069  se)..        # i
+0003ea80: 6620 756e 6465 7273 616d 706c 696e 6720  f undersampling 
+0003ea90: 2822 6669 7273 745f 6578 6861 7573 7465  ("first_exhauste
+0003eaa0: 6422 292c 2077 6520 7374 6f70 2061 7320  d"), we stop as 
+0003eab0: 736f 6f6e 2061 7320 6f6e 6520 6461 7461  soon as one data
+0003eac0: 7365 7420 6973 2065 7868 6175 7374 6564  set is exhausted
+0003ead0: 0a20 2020 2020 2020 2023 2069 6620 6f76  .        # if ov
+0003eae0: 6572 7361 6d70 6c69 6e67 2028 2261 6c6c  ersampling ("all
+0003eaf0: 5f65 7868 6175 7374 6564 2229 2c20 7765  _exhausted"), we
+0003eb00: 2073 746f 7020 6173 2073 6f6f 6e73 2061   stop as soons a
+0003eb10: 7320 6576 6572 7920 6461 7461 7365 7420  s every dataset 
+0003eb20: 6973 2065 7868 6175 7374 6564 2c20 692e  is exhausted, i.
+0003eb30: 6520 6173 2073 6f6f 6e20 6173 2065 7665  e as soon as eve
+0003eb40: 7279 2073 616d 706c 6573 206f 6620 6576  ry samples of ev
+0003eb50: 6572 7920 6461 7461 7365 7420 6861 7320  ery dataset has 
+0003eb60: 6265 656e 2076 6973 6974 6564 2061 7420  been visited at 
+0003eb70: 6c65 6173 7420 6f6e 6365 0a20 2020 2020  least once.     
+0003eb80: 2020 2062 6f6f 6c5f 7374 7261 7465 6779     bool_strategy
+0003eb90: 5f66 756e 6320 3d20 6e70 2e61 6c6c 2069  _func = np.all i
+0003eba0: 6620 6f76 6572 7361 6d70 6c69 6e67 2065  f oversampling e
+0003ebb0: 6c73 6520 6e70 2e61 6e79 0a0a 2020 2020  lse np.any..    
+0003ebc0: 2020 2020 6465 6620 6974 6572 5f72 616e      def iter_ran
+0003ebd0: 646f 6d5f 696e 6469 6365 7328 293a 0a20  dom_indices():. 
+0003ebe0: 2020 2020 2020 2020 2020 2022 2222 4765             """Ge
+0003ebf0: 7420 616e 2069 6e66 696e 6974 6520 6974  t an infinite it
+0003ec00: 6572 6174 6f72 2074 6861 7420 7261 6e64  erator that rand
+0003ec10: 6f6d 6c79 2073 616d 706c 6573 2074 6865  omly samples the
+0003ec20: 2069 6e64 6578 206f 6620 7468 6520 736f   index of the so
+0003ec30: 7572 6365 2074 6f20 7069 636b 2065 7861  urce to pick exa
+0003ec40: 6d70 6c65 7320 6672 6f6d 2e22 2222 0a20  mples from.""". 
+0003ec50: 2020 2020 2020 2020 2020 2072 6e67 203d             rng =
+0003ec60: 206e 702e 7261 6e64 6f6d 2e64 6566 6175   np.random.defau
+0003ec70: 6c74 5f72 6e67 2873 6565 6429 0a20 2020  lt_rng(seed).   
+0003ec80: 2020 2020 2020 2020 2077 6869 6c65 2054           while T
+0003ec90: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+0003eca0: 2020 2020 2079 6965 6c64 2066 726f 6d20       yield from 
+0003ecb0: 2869 6e74 2869 2920 666f 7220 6920 696e  (int(i) for i in
+0003ecc0: 2072 6e67 2e63 686f 6963 6528 6c65 6e28   rng.choice(len(
+0003ecd0: 6461 7461 7365 7473 292c 2073 697a 653d  datasets), size=
+0003ece0: 3130 3030 2c20 703d 7072 6f62 6162 696c  1000, p=probabil
+0003ecf0: 6974 6965 7329 290a 0a20 2020 2020 2020  ities))..       
+0003ed00: 2063 7572 7265 6e74 5f69 6e64 6578 203d   current_index =
+0003ed10: 205b 305d 202a 206c 656e 2864 6174 6173   [0] * len(datas
+0003ed20: 6574 7329 0a20 2020 2020 2020 2069 6e64  ets).        ind
+0003ed30: 6963 6573 203d 205b 5d0a 2020 2020 2020  ices = [].      
+0003ed40: 2020 666f 7220 736f 7572 6365 5f69 6478    for source_idx
+0003ed50: 2069 6e20 6974 6572 5f72 616e 646f 6d5f   in iter_random_
+0003ed60: 696e 6469 6365 7328 293a 0a20 2020 2020  indices():.     
+0003ed70: 2020 2020 2020 2023 2049 6620 6e6f 206f         # If no o
+0003ed80: 7665 7273 616d 706c 696e 672c 2077 6520  versampling, we 
+0003ed90: 7374 6f70 2061 7320 736f 6f6e 2061 7320  stop as soon as 
+0003eda0: 6120 6461 7461 7365 7420 6861 7320 7261  a dataset has ra
+0003edb0: 6e20 6f75 7420 6f66 2065 7861 6d70 6c65  n out of example
+0003edc0: 7320 286e 702e 616e 7929 0a20 2020 2020  s (np.any).     
+0003edd0: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
+0003ede0: 7365 2c20 7765 2073 746f 7020 6173 2073  se, we stop as s
+0003edf0: 6f6f 6e20 6173 2065 7665 7279 2064 6174  oon as every dat
+0003ee00: 6173 6574 2068 6173 2072 616e 206f 7574  aset has ran out
+0003ee10: 206f 6620 6578 616d 706c 6573 2028 6e70   of examples (np
+0003ee20: 2e61 6c6c 290a 2020 2020 2020 2020 2020  .all).          
+0003ee30: 2020 6966 2062 6f6f 6c5f 7374 7261 7465    if bool_strate
+0003ee40: 6779 5f66 756e 6328 6973 5f65 7868 6175  gy_func(is_exhau
+0003ee50: 7374 6564 293a 0a20 2020 2020 2020 2020  sted):.         
+0003ee60: 2020 2020 2020 2023 2074 6865 2073 746f         # the sto
+0003ee70: 7070 696e 6720 636f 6e64 6974 696f 6e20  pping condition 
+0003ee80: 7761 7320 7265 6163 6865 642c 206c 6574  was reached, let
+0003ee90: 2773 2073 746f 700a 2020 2020 2020 2020  's stop.        
+0003eea0: 2020 2020 2020 2020 6272 6561 6b0a 0a20          break.. 
+0003eeb0: 2020 2020 2020 2020 2020 2023 206c 6574             # let
+0003eec0: 2773 2061 6464 2074 6865 2065 7861 6d70  's add the examp
+0003eed0: 6c65 2061 7420 7468 6520 6375 7272 656e  le at the curren
+0003eee0: 7420 696e 6465 7820 6f66 2074 6865 2060  t index of the `
+0003eef0: 736f 7572 6365 5f69 6478 602d 7468 2064  source_idx`-th d
+0003ef00: 6174 6173 6574 0a20 2020 2020 2020 2020  ataset.         
+0003ef10: 2020 2069 6e64 6963 6573 2e61 7070 656e     indices.appen
+0003ef20: 6428 6375 7272 656e 745f 696e 6465 785b  d(current_index[
+0003ef30: 736f 7572 6365 5f69 6478 5d20 2b20 6f66  source_idx] + of
+0003ef40: 6673 6574 735b 736f 7572 6365 5f69 6478  fsets[source_idx
+0003ef50: 5d29 0a20 2020 2020 2020 2020 2020 2063  ]).            c
+0003ef60: 7572 7265 6e74 5f69 6e64 6578 5b73 6f75  urrent_index[sou
+0003ef70: 7263 655f 6964 785d 202b 3d20 310a 0a20  rce_idx] += 1.. 
+0003ef80: 2020 2020 2020 2020 2020 2023 2077 6527             # we'
+0003ef90: 7665 2072 616e 206f 7574 206f 6620 6578  ve ran out of ex
+0003efa0: 616d 706c 6573 2066 6f72 2074 6865 2063  amples for the c
+0003efb0: 7572 7265 6e74 2064 6174 6173 6574 2c20  urrent dataset, 
+0003efc0: 6c65 7427 7320 7570 6461 7465 206f 7572  let's update our
+0003efd0: 2062 6f6f 6c65 616e 2061 7272 6179 2061   boolean array a
+0003efe0: 6e64 2062 7269 6e67 2074 6865 2063 7572  nd bring the cur
+0003eff0: 7265 6e74 5f69 6e64 6578 2062 6163 6b20  rent_index back 
+0003f000: 746f 2030 0a20 2020 2020 2020 2020 2020  to 0.           
+0003f010: 2069 6620 6375 7272 656e 745f 696e 6465   if current_inde
+0003f020: 785b 736f 7572 6365 5f69 6478 5d20 3e3d  x[source_idx] >=
+0003f030: 206c 656e 6774 6873 5b73 6f75 7263 655f   lengths[source_
+0003f040: 6964 785d 3a0a 2020 2020 2020 2020 2020  idx]:.          
+0003f050: 2020 2020 2020 6973 5f65 7868 6175 7374        is_exhaust
+0003f060: 6564 5b73 6f75 7263 655f 6964 785d 203d  ed[source_idx] =
+0003f070: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+0003f080: 2020 2020 2020 6375 7272 656e 745f 696e        current_in
+0003f090: 6465 785b 736f 7572 6365 5f69 6478 5d20  dex[source_idx] 
+0003f0a0: 3d20 300a 0a20 2020 2072 6574 7572 6e20  = 0..    return 
+0003f0b0: 636f 6e63 6174 656e 6174 6564 5f64 6174  concatenated_dat
+0003f0c0: 6173 6574 732e 7365 6c65 6374 2869 6e64  asets.select(ind
+0003f0d0: 6963 6573 2c20 2a2a 6b77 6172 6773 290a  ices, **kwargs).
+0003f0e0: 0a0a 6465 6620 5f73 706c 6974 5f62 795f  ..def _split_by_
+0003f0f0: 6e6f 6465 5f6d 6170 5f73 7479 6c65 5f64  node_map_style_d
+0003f100: 6174 6173 6574 2864 6174 6173 6574 3a20  ataset(dataset: 
+0003f110: 4461 7461 7365 742c 2072 616e 6b3a 2069  Dataset, rank: i
+0003f120: 6e74 2c20 776f 726c 645f 7369 7a65 3a20  nt, world_size: 
+0003f130: 696e 7429 202d 3e20 4461 7461 7365 743a  int) -> Dataset:
+0003f140: 0a20 2020 2022 2222 0a20 2020 2053 706c  .    """.    Spl
+0003f150: 6974 2061 2064 6174 6173 6574 2066 6f72  it a dataset for
+0003f160: 2074 6865 206e 6f64 6520 6174 2072 616e   the node at ran
+0003f170: 6b20 6072 616e 6b60 2069 6e20 6120 706f  k `rank` in a po
+0003f180: 6f6c 206f 6620 6e6f 6465 7320 6f66 2073  ol of nodes of s
+0003f190: 697a 6520 6077 6f72 6c64 5f73 697a 6560  ize `world_size`
+0003f1a0: 2e0a 2020 2020 4561 6368 206e 6f64 6520  ..    Each node 
+0003f1b0: 6973 2061 7373 6967 6e65 6420 6120 6368  is assigned a ch
+0003f1c0: 756e 6b20 6f66 2064 6174 612c 2065 2e67  unk of data, e.g
+0003f1d0: 2e20 7261 6e6b 2030 2069 7320 6769 7665  . rank 0 is give
+0003f1e0: 6e20 7468 6520 6669 7273 7420 6368 756e  n the first chun
+0003f1f0: 6b20 6f66 2074 6865 2064 6174 6173 6574  k of the dataset
+0003f200: 2e0a 2020 2020 546f 206d 6178 696d 697a  ..    To maximiz
+0003f210: 6520 6461 7461 206c 6f61 6469 6e67 2074  e data loading t
+0003f220: 6872 6f75 6768 7075 742c 2063 6875 6e6b  hroughput, chunk
+0003f230: 7320 6172 6520 6d61 6465 206f 6620 636f  s are made of co
+0003f240: 6e74 6967 756f 7573 2064 6174 6120 6f6e  ntiguous data on
+0003f250: 2064 6973 6b20 6966 2070 6f73 7369 626c   disk if possibl
+0003f260: 652e 0a0a 2020 2020 4172 6773 3a0a 2020  e...    Args:.  
+0003f270: 2020 2020 2020 6461 7461 7365 7420 285b        dataset ([
+0003f280: 6044 6174 6173 6574 605d 293a 0a20 2020  `Dataset`]):.   
+0003f290: 2020 2020 2020 2020 2054 6865 2064 6174           The dat
+0003f2a0: 6173 6574 2074 6f20 7370 6c69 7420 6279  aset to split by
+0003f2b0: 206e 6f64 652e 0a20 2020 2020 2020 2072   node..        r
+0003f2c0: 616e 6b20 2860 696e 7460 293a 0a20 2020  ank (`int`):.   
+0003f2d0: 2020 2020 2020 2020 2052 616e 6b20 6f66           Rank of
+0003f2e0: 2074 6865 2063 7572 7265 6e74 206e 6f64   the current nod
+0003f2f0: 652e 0a20 2020 2020 2020 2077 6f72 6c64  e..        world
+0003f300: 5f73 697a 6520 2860 696e 7460 293a 0a20  _size (`int`):. 
+0003f310: 2020 2020 2020 2020 2020 2054 6f74 616c             Total
+0003f320: 206e 756d 6265 7220 6f66 206e 6f64 6573   number of nodes
+0003f330: 2e0a 0a20 2020 2052 6574 7572 6e73 3a0a  ...    Returns:.
+0003f340: 2020 2020 2020 2020 5b60 4461 7461 7365          [`Datase
+0003f350: 7460 5d3a 2054 6865 2064 6174 6173 6574  t`]: The dataset
+0003f360: 2074 6f20 6265 2075 7365 6420 6f6e 2074   to be used on t
+0003f370: 6865 206e 6f64 6520 6174 2072 616e 6b20  he node at rank 
+0003f380: 6072 616e 6b60 2e0a 2020 2020 2222 220a  `rank`..    """.
+0003f390: 2020 2020 7265 7475 726e 2064 6174 6173      return datas
+0003f3a0: 6574 2e73 6861 7264 286e 756d 5f73 6861  et.shard(num_sha
+0003f3b0: 7264 733d 776f 726c 645f 7369 7a65 2c20  rds=world_size, 
+0003f3c0: 696e 6465 783d 7261 6e6b 2c20 636f 6e74  index=rank, cont
+0003f3d0: 6967 756f 7573 3d54 7275 6529 0a0a 0a23  iguous=True)...#
+0003f3e0: 2054 6869 7320 6973 206f 7574 7369 6465   This is outside
+0003f3f0: 2044 6174 6173 6574 2e66 696c 7465 7220   Dataset.filter 
+0003f400: 6173 2069 7420 6e65 6564 7320 746f 2062  as it needs to b
+0003f410: 6520 7069 636b 6c61 626c 6520 666f 7220  e picklable for 
+0003f420: 6d75 6c74 6970 726f 6365 7373 696e 670a  multiprocessing.
+0003f430: 0a0a 6465 6620 6765 745f 696e 6469 6365  ..def get_indice
+0003f440: 735f 6672 6f6d 5f6d 6173 6b5f 6675 6e63  s_from_mask_func
+0003f450: 7469 6f6e 280a 2020 2020 6675 6e63 7469  tion(.    functi
+0003f460: 6f6e 3a20 4361 6c6c 6162 6c65 2c0a 2020  on: Callable,.  
+0003f470: 2020 6261 7463 6865 643a 2062 6f6f 6c2c    batched: bool,
+0003f480: 0a20 2020 2077 6974 685f 696e 6469 6365  .    with_indice
+0003f490: 733a 2062 6f6f 6c2c 0a20 2020 2069 6e70  s: bool,.    inp
+0003f4a0: 7574 5f63 6f6c 756d 6e73 3a20 4f70 7469  ut_columns: Opti
+0003f4b0: 6f6e 616c 5b55 6e69 6f6e 5b73 7472 2c20  onal[Union[str, 
+0003f4c0: 4c69 7374 5b73 7472 5d5d 5d2c 0a20 2020  List[str]]],.   
+0003f4d0: 2069 6e64 6963 6573 5f6d 6170 7069 6e67   indices_mapping
+0003f4e0: 3a20 4f70 7469 6f6e 616c 5b54 6162 6c65  : Optional[Table
+0003f4f0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2a61  ] = None,.    *a
+0003f500: 7267 732c 0a20 2020 202a 2a66 6e5f 6b77  rgs,.    **fn_kw
+0003f510: 6172 6773 2c0a 293a 0a20 2020 2069 6620  args,.):.    if 
+0003f520: 6261 7463 6865 643a 0a20 2020 2020 2020  batched:.       
+0003f530: 2023 2077 6520 6578 7472 6163 7420 696e   # we extract in
+0003f540: 6469 6365 7320 6672 6f6d 2061 7267 730a  dices from args.
+0003f550: 2020 2020 2020 2020 2a69 6e70 7574 732c          *inputs,
+0003f560: 2069 6e64 6963 6573 203d 2061 7267 730a   indices = args.
+0003f570: 2020 2020 2020 2020 6966 2077 6974 685f          if with_
+0003f580: 696e 6469 6365 733a 0a20 2020 2020 2020  indices:.       
+0003f590: 2020 2020 206d 6173 6b20 3d20 6675 6e63       mask = func
+0003f5a0: 7469 6f6e 282a 696e 7075 7473 2c20 696e  tion(*inputs, in
+0003f5b0: 6469 6365 732c 202a 2a66 6e5f 6b77 6172  dices, **fn_kwar
+0003f5c0: 6773 290a 2020 2020 2020 2020 656c 7365  gs).        else
+0003f5d0: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
+0003f5e0: 736b 203d 2066 756e 6374 696f 6e28 2a69  sk = function(*i
+0003f5f0: 6e70 7574 732c 202a 2a66 6e5f 6b77 6172  nputs, **fn_kwar
+0003f600: 6773 290a 2020 2020 656c 7365 3a0a 2020  gs).    else:.  
+0003f610: 2020 2020 2020 2320 7765 2067 6574 2062        # we get b
+0003f620: 6174 6368 6564 2064 6174 6120 2874 6f20  atched data (to 
+0003f630: 646f 206c 6573 7320 6c6f 6f6b 2d75 7073  do less look-ups
+0003f640: 2920 6275 7420 6066 756e 6374 696f 6e60  ) but `function`
+0003f650: 206f 6e6c 7920 6163 6365 7074 7320 6f6e   only accepts on
+0003f660: 6520 6578 616d 706c 650a 2020 2020 2020  e example.      
+0003f670: 2020 2320 7468 6572 6566 6f72 6520 7765    # therefore we
+0003f680: 206e 6565 6420 746f 2063 616c 6c20 6066   need to call `f
+0003f690: 756e 6374 696f 6e60 206f 6e20 6561 6368  unction` on each
+0003f6a0: 2065 7861 6d70 6c65 206f 6620 7468 6520   example of the 
+0003f6b0: 6261 7463 6820 746f 2067 6574 2074 6865  batch to get the
+0003f6c0: 206d 6173 6b0a 2020 2020 2020 2020 2a69   mask.        *i
+0003f6d0: 6e70 7574 732c 2069 6e64 6963 6573 203d  nputs, indices =
+0003f6e0: 2061 7267 730a 2020 2020 2020 2020 6d61   args.        ma
+0003f6f0: 736b 203d 205b 5d0a 2020 2020 2020 2020  sk = [].        
+0003f700: 6966 2069 6e70 7574 5f63 6f6c 756d 6e73  if input_columns
+0003f710: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0003f720: 2020 2020 2020 2320 696e 7075 7473 206f        # inputs o
+0003f730: 6e6c 7920 636f 6e74 6169 6e73 2061 2062  nly contains a b
+0003f740: 6174 6368 206f 6620 6578 616d 706c 6573  atch of examples
+0003f750: 0a20 2020 2020 2020 2020 2020 2062 6174  .            bat
+0003f760: 6368 3a20 6469 6374 203d 2069 6e70 7574  ch: dict = input
+0003f770: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
+0003f780: 206e 756d 5f65 7861 6d70 6c65 7320 3d20   num_examples = 
+0003f790: 6c65 6e28 6261 7463 685b 6e65 7874 2869  len(batch[next(i
+0003f7a0: 7465 7228 6261 7463 682e 6b65 7973 2829  ter(batch.keys()
+0003f7b0: 2929 5d29 0a20 2020 2020 2020 2020 2020  ))]).           
+0003f7c0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0003f7d0: 6e75 6d5f 6578 616d 706c 6573 293a 0a20  num_examples):. 
+0003f7e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0003f7f0: 7861 6d70 6c65 203d 207b 6b65 793a 2062  xample = {key: b
+0003f800: 6174 6368 5b6b 6579 5d5b 695d 2066 6f72  atch[key][i] for
+0003f810: 206b 6579 2069 6e20 6261 7463 687d 0a20   key in batch}. 
+0003f820: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0003f830: 6173 6b2e 6170 7065 6e64 280a 2020 2020  ask.append(.    
+0003f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f850: 6675 6e63 7469 6f6e 2865 7861 6d70 6c65  function(example
+0003f860: 2c20 696e 6469 6365 735b 695d 2c20 2a2a  , indices[i], **
+0003f870: 666e 5f6b 7761 7267 7329 2069 6620 7769  fn_kwargs) if wi
+0003f880: 7468 5f69 6e64 6963 6573 2065 6c73 6520  th_indices else 
+0003f890: 6675 6e63 7469 6f6e 2865 7861 6d70 6c65  function(example
+0003f8a0: 2c20 2a2a 666e 5f6b 7761 7267 7329 0a20  , **fn_kwargs). 
+0003f8b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0003f8c0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0003f8d0: 2020 2020 2020 2020 2020 2023 2069 6e70             # inp
+0003f8e0: 7574 7320 6973 2061 206c 6973 7420 6f66  uts is a list of
+0003f8f0: 2063 6f6c 756d 6e73 0a20 2020 2020 2020   columns.       
+0003f900: 2020 2020 2063 6f6c 756d 6e73 3a20 4c69       columns: Li
+0003f910: 7374 5b4c 6973 745d 203d 2069 6e70 7574  st[List] = input
+0003f920: 730a 2020 2020 2020 2020 2020 2020 6e75  s.            nu
+0003f930: 6d5f 6578 616d 706c 6573 203d 206c 656e  m_examples = len
+0003f940: 2863 6f6c 756d 6e73 5b30 5d29 0a20 2020  (columns[0]).   
+0003f950: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+0003f960: 6e20 7261 6e67 6528 6e75 6d5f 6578 616d  n range(num_exam
+0003f970: 706c 6573 293a 0a20 2020 2020 2020 2020  ples):.         
+0003f980: 2020 2020 2020 2069 6e70 7574 203d 205b         input = [
+0003f990: 636f 6c75 6d6e 5b69 5d20 666f 7220 636f  column[i] for co
+0003f9a0: 6c75 6d6e 2069 6e20 636f 6c75 6d6e 735d  lumn in columns]
+0003f9b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f9c0: 206d 6173 6b2e 6170 7065 6e64 280a 2020   mask.append(.  
+0003f9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f9e0: 2020 6675 6e63 7469 6f6e 282a 696e 7075    function(*inpu
+0003f9f0: 742c 2069 6e64 6963 6573 5b69 5d2c 202a  t, indices[i], *
+0003fa00: 2a66 6e5f 6b77 6172 6773 2920 6966 2077  *fn_kwargs) if w
+0003fa10: 6974 685f 696e 6469 6365 7320 656c 7365  ith_indices else
+0003fa20: 2066 756e 6374 696f 6e28 2a69 6e70 7574   function(*input
+0003fa30: 2c20 2a2a 666e 5f6b 7761 7267 7329 0a20  , **fn_kwargs). 
+0003fa40: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0003fa50: 0a20 2020 2069 6e64 6963 6573 5f61 7272  .    indices_arr
+0003fa60: 6179 203d 205b 6920 666f 7220 692c 2074  ay = [i for i, t
+0003fa70: 6f5f 6b65 6570 2069 6e20 7a69 7028 696e  o_keep in zip(in
+0003fa80: 6469 6365 732c 206d 6173 6b29 2069 6620  dices, mask) if 
+0003fa90: 746f 5f6b 6565 705d 0a20 2020 2069 6620  to_keep].    if 
+0003faa0: 696e 6469 6365 735f 6d61 7070 696e 6720  indices_mapping 
+0003fab0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0003fac0: 2020 2020 2069 6e64 6963 6573 5f61 7272       indices_arr
+0003fad0: 6179 203d 2070 612e 6172 7261 7928 696e  ay = pa.array(in
+0003fae0: 6469 6365 735f 6172 7261 792c 2074 7970  dices_array, typ
+0003faf0: 653d 7061 2e75 696e 7436 3428 2929 0a20  e=pa.uint64()). 
+0003fb00: 2020 2020 2020 2069 6e64 6963 6573 5f61         indices_a
+0003fb10: 7272 6179 203d 2069 6e64 6963 6573 5f6d  rray = indices_m
+0003fb20: 6170 7069 6e67 2e63 6f6c 756d 6e28 3029  apping.column(0)
+0003fb30: 2e74 616b 6528 696e 6469 6365 735f 6172  .take(indices_ar
+0003fb40: 7261 7929 0a20 2020 2020 2020 2069 6e64  ray).        ind
+0003fb50: 6963 6573 5f61 7272 6179 203d 2069 6e64  ices_array = ind
+0003fb60: 6963 6573 5f61 7272 6179 2e74 6f5f 7079  ices_array.to_py
+0003fb70: 6c69 7374 2829 0a20 2020 2072 6574 7572  list().    retur
+0003fb80: 6e20 7b22 696e 6469 6365 7322 3a20 696e  n {"indices": in
+0003fb90: 6469 6365 735f 6172 7261 797d 0a         dices_array}.
```

### Comparing `datasets-2.8.0/src/datasets/arrow_reader.py` & `datasets-2.9.0/src/datasets/arrow_reader.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/arrow_writer.py` & `datasets-2.9.0/src/datasets/arrow_writer.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/builder.py` & `datasets-2.9.0/src/datasets/builder.py`

 * *Files 1% similar despite different names*

```diff
@@ -987,22 +987,22 @@
                         split, resource_name, dl_manager
                     )
                     if downloaded_resource_path:
                         logger.info(f"Downloaded post-processing resource {resource_name} as {resource_file_name}")
                         shutil.move(downloaded_resource_path, resource_path)
 
     def _load_info(self) -> DatasetInfo:
-        return DatasetInfo.from_directory(self._output_dir, fs=self._fs)
+        return DatasetInfo.from_directory(self._output_dir, storage_options=self._fs.storage_options)
 
     def _save_info(self):
         is_local = not is_remote_filesystem(self._fs)
         if is_local:
             lock_path = self._output_dir + "_info.lock"
         with FileLock(lock_path) if is_local else contextlib.nullcontext():
-            self.info.write_to_directory(self._output_dir, fs=self._fs)
+            self.info.write_to_directory(self._output_dir, storage_options=self._fs.storage_options)
 
     def _save_infos(self):
         is_local = not is_remote_filesystem(self._fs)
         if is_local:
             lock_path = self._output_dir + "_infos.lock"
         with FileLock(lock_path) if is_local else contextlib.nullcontext():
             DatasetInfosDict(**{self.config.name: self.info}).write_to_directory(self.get_imported_module_dir())
@@ -1410,25 +1410,26 @@
         else:
             split_info = split_generator.split_info
 
         SUFFIX = "-JJJJJ-SSSSS-of-NNNNN"
         fname = f"{self.name}-{split_generator.name}{SUFFIX}.{file_format}"
         fpath = path_join(self._output_dir, fname)
 
-        num_input_shards = _number_of_shards_in_gen_kwargs(split_generator.gen_kwargs)
-        if num_input_shards <= 1 and num_proc is not None:
-            logger.warning(
-                f"Setting num_proc from {num_proc} back to 1 for the {split_info.name} split to disable multiprocessing as it only contains one shard."
-            )
-            num_proc = 1
-        elif num_proc is not None and num_input_shards < num_proc:
-            logger.info(
-                f"Setting num_proc from {num_proc} to {num_input_shards} for the {split_info.name} split as it only contains {num_input_shards} shards."
-            )
-            num_proc = num_input_shards
+        if num_proc and num_proc > 1:
+            num_input_shards = _number_of_shards_in_gen_kwargs(split_generator.gen_kwargs)
+            if num_input_shards <= 1 and num_proc is not None:
+                logger.warning(
+                    f"Setting num_proc from {num_proc} back to 1 for the {split_info.name} split to disable multiprocessing as it only contains one shard."
+                )
+                num_proc = 1
+            elif num_proc is not None and num_input_shards < num_proc:
+                logger.info(
+                    f"Setting num_proc from {num_proc} to {num_input_shards} for the {split_info.name} split as it only contains {num_input_shards} shards."
+                )
+                num_proc = num_input_shards
 
         pbar = logging.tqdm(
             disable=not logging.is_progress_bar_enabled(),
             unit=" examples",
             total=split_info.num_examples,
             leave=False,
             desc=f"Generating {split_info.name} split",
@@ -1669,25 +1670,26 @@
         else:
             split_info = split_generator.split_info
 
         SUFFIX = "-JJJJJ-SSSSS-of-NNNNN"
         fname = f"{self.name}-{split_generator.name}{SUFFIX}.{file_format}"
         fpath = path_join(self._output_dir, fname)
 
-        num_input_shards = _number_of_shards_in_gen_kwargs(split_generator.gen_kwargs)
-        if num_input_shards <= 1 and num_proc is not None:
-            logger.warning(
-                f"Setting num_proc from {num_proc} back to 1 for the {split_info.name} split to disable multiprocessing as it only contains one shard."
-            )
-            num_proc = 1
-        elif num_proc is not None and num_input_shards < num_proc:
-            logger.info(
-                f"Setting num_proc from {num_proc} to {num_input_shards} for the {split_info.name} split as it only contains {num_input_shards} shards."
-            )
-            num_proc = num_input_shards
+        if num_proc and num_proc > 1:
+            num_input_shards = _number_of_shards_in_gen_kwargs(split_generator.gen_kwargs)
+            if num_input_shards <= 1 and num_proc is not None:
+                logger.warning(
+                    f"Setting num_proc from {num_proc} back to 1 for the {split_info.name} split to disable multiprocessing as it only contains one shard."
+                )
+                num_proc = 1
+            elif num_proc is not None and num_input_shards < num_proc:
+                logger.info(
+                    f"Setting num_proc from {num_proc} to {num_input_shards} for the {split_info.name} split as it only contains {num_input_shards} shards."
+                )
+                num_proc = num_input_shards
 
         pbar = logging.tqdm(
             disable=not logging.is_progress_bar_enabled(),
             unit=" examples",
             total=split_info.num_examples,
             leave=False,
             desc=f"Generating {split_info.name} split",
```

### Comparing `datasets-2.8.0/src/datasets/combine.py` & `datasets-2.9.0/src/datasets/combine.py`

 * *Files 0% similar despite different names*

```diff
@@ -6,15 +6,15 @@
 from .splits import NamedSplit
 from .utils import logging
 
 
 logger = logging.get_logger(__name__)
 
 
-DatasetType = TypeVar("DatasetType", "Dataset", "IterableDataset")
+DatasetType = TypeVar("DatasetType", Dataset, IterableDataset)
 
 
 def interleave_datasets(
     datasets: List[DatasetType],
     probabilities: Optional[List[float]] = None,
     seed: Optional[int] = None,
     info: Optional[DatasetInfo] = None,
@@ -133,19 +133,19 @@
     else:
         return _interleave_iterable_datasets(
             datasets, probabilities, seed, info=info, split=split, stopping_strategy=stopping_strategy
         )
 
 
 def concatenate_datasets(
-    dsets: List[Dataset],
+    dsets: List[DatasetType],
     info: Optional[DatasetInfo] = None,
     split: Optional[NamedSplit] = None,
     axis: int = 0,
-):
+) -> DatasetType:
     """
     Converts a list of [`Dataset`] with the same schema into a single [`Dataset`].
 
     Args:
         dsets (`List[datasets.Dataset]`):
             List of Datasets to concatenate.
         info (`DatasetInfo`, *optional*):
```

### Comparing `datasets-2.8.0/src/datasets/commands/convert.py` & `datasets-2.9.0/src/datasets/commands/convert.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/commands/datasets_cli.py` & `datasets-2.9.0/src/datasets/commands/datasets_cli.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/commands/dummy_data.py` & `datasets-2.9.0/src/datasets/commands/dummy_data.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/commands/env.py` & `datasets-2.9.0/src/datasets/commands/env.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/commands/run_beam.py` & `datasets-2.9.0/src/datasets/commands/run_beam.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/commands/test.py` & `datasets-2.9.0/src/datasets/commands/test.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/config.py` & `datasets-2.9.0/src/datasets/config.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/data_files.py` & `datasets-2.9.0/src/datasets/data_files.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/dataset_dict.py` & `datasets-2.9.0/src/datasets/dataset_dict.py`

 * *Files 0% similar despite different names*

```diff
@@ -1176,18 +1176,16 @@
             raise ValueError(
                 "Please provide one `num_shards` per dataset in the dataset dictionary, e.g. {{'train': 128, 'test': 4}}"
             )
 
         if is_local:
             Path(dataset_dict_path).resolve().mkdir(parents=True, exist_ok=True)
 
-        json.dump(
-            {"splits": list(self)},
-            fs.open(path_join(dataset_dict_path, config.DATASETDICT_JSON_FILENAME), "w", encoding="utf-8"),
-        )
+        with fs.open(path_join(dataset_dict_path, config.DATASETDICT_JSON_FILENAME), "w", encoding="utf-8") as f:
+            json.dump({"splits": list(self)}, f)
         for k, dataset in self.items():
             dataset.save_to_disk(
                 path_join(dataset_dict_path, k),
                 num_shards=num_shards.get(k),
                 max_shard_size=max_shard_size,
                 num_proc=num_proc,
                 storage_options=storage_options,
@@ -1218,15 +1216,15 @@
 
                 </Deprecated>
 
             keep_in_memory (`bool`, defaults to `None`):
                 Whether to copy the dataset in-memory. If `None`, the
                 dataset will not be copied in-memory unless explicitly enabled by setting
                 `datasets.config.IN_MEMORY_MAX_SIZE` to nonzero. See more details in the
-                [improve performance](./cache#improve-performance) section.
+                [improve performance](../cache#improve-performance) section.
             storage_options (`dict`, *optional*):
                 Key/value pairs to be passed on to the file-system backend, if any.
 
                 <Added version="2.8.0"/>
 
         Returns:
             [`DatasetDict`]
@@ -1256,15 +1254,18 @@
             dest_dataset_dict_path = dataset_dict_path
         dataset_dict_json_path = Path(dest_dataset_dict_path, config.DATASETDICT_JSON_FILENAME).as_posix()
         dataset_info_path = Path(dest_dataset_dict_path, config.DATASET_INFO_FILENAME).as_posix()
         if fs.isfile(dataset_info_path) and not fs.isfile(dataset_dict_json_path):
             raise FileNotFoundError(
                 f"No such file or directory: '{dataset_dict_json_path}'. Expected to load a DatasetDict object, but got a Dataset. Please use datasets.load_from_disk instead."
             )
-        for k in json.load(fs.open(dataset_dict_json_path, "r", encoding="utf-8"))["splits"]:
+
+        with fs.open(dataset_dict_json_path, "r", encoding="utf-8") as f:
+            splits = json.load(f)["splits"]
+        for k in splits:
             dataset_dict_split_path = (
                 dataset_dict_path.split("://")[0] + "://" + Path(dest_dataset_dict_path, k).as_posix()
                 if is_remote_filesystem(fs)
                 else Path(dest_dataset_dict_path, k).as_posix()
             )
             dataset_dict[k] = Dataset.load_from_disk(
                 dataset_dict_split_path, keep_in_memory=keep_in_memory, storage_options=storage_options
@@ -1456,15 +1457,14 @@
         self,
         repo_id,
         private: Optional[bool] = False,
         token: Optional[str] = None,
         branch: Optional[None] = None,
         max_shard_size: Optional[Union[int, str]] = None,
         num_shards: Optional[Dict[str, int]] = None,
-        shard_size: Optional[Union[int, str]] = "deprecated",
         embed_external_files: bool = True,
     ):
         """Pushes the [`DatasetDict`] to the hub as a Parquet dataset.
         The [`DatasetDict`] is pushed using HTTP requests and does not need to have neither git or git-lfs installed.
 
         Each dataset split will be pushed independently. The pushed dataset will keep the original split names.
 
@@ -1490,22 +1490,14 @@
                 The maximum size of the dataset shards to be uploaded to the hub. If expressed as a string, needs to be digits followed by a unit
                 (like `"500MB"` or `"1GB"`).
             num_shards (`Dict[str, int]`, *optional*):
                 Number of shards to write. By default the number of shards depends on `max_shard_size`.
                 Use a dictionary to define a different num_shards for each split.
 
                 <Added version="2.8.0"/>
-            shard_size (`int` or `str`, *optional*):
-
-                <Deprecated version="2.4.0">
-
-                `shard_size` was renamed to `max_shard_size` in version 2.1.1 and will be removed in 2.4.0.
-
-                </Deprecated>
-
             embed_external_files (`bool`, defaults to `True`):
                 Whether to embed file bytes in the shards.
                 In particular, this will do the following before the push for the fields of type:
 
                 - [`Audio`] and [`Image`] removes local path information and embed file content in the Parquet files.
 
         Example:
@@ -1513,20 +1505,14 @@
         ```python
         >>> dataset_dict.push_to_hub("<organization>/<dataset_id>")
         >>> dataset_dict.push_to_hub("<organization>/<dataset_id>", private=True)
         >>> dataset_dict.push_to_hub("<organization>/<dataset_id>", max_shard_size="1GB")
         >>> dataset_dict.push_to_hub("<organization>/<dataset_id>", num_shards={"train": 1024, "test": 8})
         ```
         """
-        if shard_size != "deprecated":
-            warnings.warn(
-                "'shard_size' was renamed to 'max_shard_size' in version 2.1.1 and will be removed in 2.4.0.",
-                FutureWarning,
-            )
-            max_shard_size = shard_size
 
         if num_shards is None:
             num_shards = {k: None for k in self}
         elif not isinstance(num_shards, dict):
             raise ValueError(
                 "Please provide one `num_shards` per dataset in the dataset dictionary, e.g. {{'train': 128, 'test': 4}}"
             )
```

### Comparing `datasets-2.8.0/src/datasets/download/download_config.py` & `datasets-2.9.0/src/datasets/download/download_config.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/download/download_manager.py` & `datasets-2.9.0/src/datasets/download/download_manager.py`

 * *Files 15% similar despite different names*

```diff
@@ -18,30 +18,66 @@
 import enum
 import io
 import os
 import posixpath
 import tarfile
 import time
 import warnings
+import zipfile
 from datetime import datetime
 from functools import partial
+from itertools import chain
 from typing import Callable, Dict, Generator, Iterable, List, Optional, Tuple, Union
 
 from .. import config
 from ..utils.deprecation_utils import DeprecatedEnum
 from ..utils.file_utils import cached_path, get_from_cache, hash_url_to_filename, is_relative_path, url_or_path_join
 from ..utils.info_utils import get_size_checksum_dict
 from ..utils.logging import get_logger, is_progress_bar_enabled, tqdm
 from ..utils.py_utils import NestedDataStructure, map_nested, size_str
 from .download_config import DownloadConfig
 
 
 logger = get_logger(__name__)
 
 
+BASE_KNOWN_EXTENSIONS = [
+    "txt",
+    "csv",
+    "json",
+    "jsonl",
+    "tsv",
+    "conll",
+    "conllu",
+    "orig",
+    "parquet",
+    "pkl",
+    "pickle",
+    "rel",
+    "xml",
+]
+MAGIC_NUMBER_TO_COMPRESSION_PROTOCOL = {
+    bytes.fromhex("504B0304"): "zip",
+    bytes.fromhex("504B0506"): "zip",  # empty archive
+    bytes.fromhex("504B0708"): "zip",  # spanned archive
+    bytes.fromhex("425A68"): "bz2",
+    bytes.fromhex("1F8B"): "gzip",
+    bytes.fromhex("FD377A585A00"): "xz",
+    bytes.fromhex("04224D18"): "lz4",
+    bytes.fromhex("28B52FFD"): "zstd",
+}
+MAGIC_NUMBER_TO_UNSUPPORTED_COMPRESSION_PROTOCOL = {
+    b"Rar!": "rar",
+}
+MAGIC_NUMBER_MAX_LENGTH = max(
+    len(magic_number)
+    for magic_number in chain(MAGIC_NUMBER_TO_COMPRESSION_PROTOCOL, MAGIC_NUMBER_TO_UNSUPPORTED_COMPRESSION_PROTOCOL)
+)
+
+
 class DownloadMode(enum.Enum):
     """`Enum` for how to treat pre-existing downloads and data.
 
     The default mode is `REUSE_DATASET_IF_EXISTS`, which will reuse both
     raw downloads and the prepared dataset if they exist.
 
     The generations modes:
@@ -65,14 +101,56 @@
     FORCE_REDOWNLOAD = "force_redownload"
 
     @property
     def help_message(self):
         return "Use 'DownloadMode' instead."
 
 
+def _get_path_extension(path: str) -> str:
+    # Get extension: train.json.gz -> gz
+    extension = path.split(".")[-1]
+    # Remove query params ("dl=1", "raw=true"): gz?dl=1 -> gz
+    # Remove shards infos (".txt_1", ".txt-00000-of-00100"): txt_1 -> txt
+    for symb in "?-_":
+        extension = extension.split(symb)[0]
+    return extension
+
+
+def _get_extraction_protocol_with_magic_number(f) -> Optional[str]:
+    """read the magic number from a file-like object and return the compression protocol"""
+    # Check if the file object is seekable even before reading the magic number (to avoid https://bugs.python.org/issue26440)
+    try:
+        f.seek(0)
+    except (AttributeError, io.UnsupportedOperation):
+        return None
+    magic_number = f.read(MAGIC_NUMBER_MAX_LENGTH)
+    f.seek(0)
+    for i in range(MAGIC_NUMBER_MAX_LENGTH):
+        compression = MAGIC_NUMBER_TO_COMPRESSION_PROTOCOL.get(magic_number[: MAGIC_NUMBER_MAX_LENGTH - i])
+        if compression is not None:
+            return compression
+        compression = MAGIC_NUMBER_TO_UNSUPPORTED_COMPRESSION_PROTOCOL.get(magic_number[: MAGIC_NUMBER_MAX_LENGTH - i])
+        if compression is not None:
+            raise NotImplementedError(f"Compression protocol '{compression}' not implemented.")
+
+
+def _get_extraction_protocol(path: str) -> Optional[str]:
+    path = str(path)
+    extension = _get_path_extension(path)
+    # TODO(mariosasko): The below check will be useful once we can preserve the original extension in the new cache layout (use the `filename` parameter of `hf_hub_download`)
+    if (
+        extension in BASE_KNOWN_EXTENSIONS
+        or extension in ["tgz", "tar"]
+        or path.endswith((".tar.gz", ".tar.bz2", ".tar.xz"))
+    ):
+        return None
+    with open(path, "rb") as f:
+        return _get_extraction_protocol_with_magic_number(f)
+
+
 class _IterableFromGenerator(Iterable):
     """Utility class to create an iterable from a generator function, in order to reset the generator when needed."""
 
     def __init__(self, generator: Callable, *args, **kwargs):
         self.generator = generator
         self.args = args
         self.kwargs = kwargs
@@ -80,35 +158,62 @@
     def __iter__(self):
         yield from self.generator(*self.args, **self.kwargs)
 
 
 class ArchiveIterable(_IterableFromGenerator):
     """An iterable of (path, fileobj) from a TAR archive, used by `iter_archive`"""
 
-    @classmethod
-    def _iter_from_fileobj(cls, f) -> Generator[Tuple, None, None]:
+    @staticmethod
+    def _iter_tar(f):
         stream = tarfile.open(fileobj=f, mode="r|*")
         for tarinfo in stream:
             file_path = tarinfo.name
             if not tarinfo.isreg():
                 continue
             if file_path is None:
                 continue
-            if os.path.basename(file_path).startswith(".") or os.path.basename(file_path).startswith("__"):
+            if os.path.basename(file_path).startswith((".", "__")):
                 # skipping hidden files
                 continue
             file_obj = stream.extractfile(tarinfo)
             yield file_path, file_obj
             stream.members = []
         del stream
 
+    @staticmethod
+    def _iter_zip(f):
+        zipf = zipfile.ZipFile(f)
+        for member in zipf.infolist():
+            file_path = member.filename
+            if member.is_dir():
+                continue
+            if file_path is None:
+                continue
+            if os.path.basename(file_path).startswith((".", "__")):
+                # skipping hidden files
+                continue
+            file_obj = zipf.open(member)
+            yield file_path, file_obj
+
+    @classmethod
+    def _iter_from_fileobj(cls, f) -> Generator[Tuple, None, None]:
+        compression = _get_extraction_protocol_with_magic_number(f)
+        if compression == "zip":
+            yield from cls._iter_zip(f)
+        else:
+            yield from cls._iter_tar(f)
+
     @classmethod
     def _iter_from_path(cls, urlpath: str) -> Generator[Tuple, None, None]:
+        compression = _get_extraction_protocol(urlpath)
         with open(urlpath, "rb") as f:
-            yield from cls._iter_from_fileobj(f)
+            if compression == "zip":
+                yield from cls._iter_zip(f)
+            else:
+                yield from cls._iter_tar(f)
 
     @classmethod
     def from_buf(cls, fileobj) -> "ArchiveIterable":
         return cls(cls._iter_from_fileobj, fileobj)
 
     @classmethod
     def from_path(cls, urlpath_or_buf) -> "ArchiveIterable":
```

### Comparing `datasets-2.8.0/src/datasets/download/mock_download_manager.py` & `datasets-2.9.0/src/datasets/download/mock_download_manager.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/download/streaming_download_manager.py` & `datasets-2.9.0/src/datasets/download/streaming_download_manager.py`

 * *Files 1% similar despite different names*

```diff
@@ -2,14 +2,15 @@
 import io
 import os
 import posixpath
 import re
 import tarfile
 import time
 import xml.dom.minidom
+import zipfile
 from asyncio import TimeoutError
 from io import BytesIO
 from itertools import chain
 from pathlib import Path, PurePosixPath
 from typing import Callable, Generator, Iterable, List, Optional, Tuple, Union
 from xml.etree import ElementTree as ET
 
@@ -135,14 +136,44 @@
     # if we end up at the root of the protocol, we get for example a = 'http:'
     # so we have to fix it by adding the '//' that was removed:
     if a.endswith(":"):
         a += "//"
     return "::".join([a] + b)
 
 
+def xexists(urlpath: str, use_auth_token: Optional[Union[str, bool]] = None):
+    """Extend `os.path.exists` function to support both local and remote files.
+
+    Args:
+        urlpath (`str`): URL path.
+        use_auth_token (`bool` or `str`, *optional*): Whether to use token or token to authenticate on the
+            Hugging Face Hub for private remote files.
+
+    Returns:
+        `bool`
+    """
+
+    main_hop, *rest_hops = _as_str(urlpath).split("::")
+    if is_local_path(main_hop):
+        return os.path.exists(main_hop)
+    else:
+        if not rest_hops and (main_hop.startswith("http://") or main_hop.startswith("https://")):
+            main_hop, http_kwargs = _prepare_http_url_kwargs(main_hop, use_auth_token=use_auth_token)
+            storage_options = http_kwargs
+        elif rest_hops and (rest_hops[0].startswith("http://") or rest_hops[0].startswith("https://")):
+            url = rest_hops[0]
+            url, http_kwargs = _prepare_http_url_kwargs(url, use_auth_token=use_auth_token)
+            storage_options = {"https": http_kwargs}
+            urlpath = "::".join([main_hop, url, *rest_hops[1:]])
+        else:
+            storage_options = None
+        fs, *_ = fsspec.get_fs_token_paths(urlpath, storage_options=storage_options)
+        return fs.exists(main_hop)
+
+
 def xbasename(a):
     """
     This function extends os.path.basename to support the "::" hop separator. It supports both paths and urls.
 
     A shorthand, particularly useful where you have multiple hops, is to “chain” the URLs with the special separator "::".
     This is used to access files inside a zip file over http for example.
 
@@ -331,67 +362,73 @@
 
 
 def _add_retries_to_file_obj_read_method(file_obj):
     read = file_obj.read
     max_retries = config.STREAMING_READ_MAX_RETRIES
 
     def read_with_retries(*args, **kwargs):
+        disconnect_err = None
         for retry in range(1, max_retries + 1):
             try:
                 out = read(*args, **kwargs)
                 break
-            except (ClientError, TimeoutError):
+            except (ClientError, TimeoutError) as err:
+                disconnect_err = err
                 logger.warning(
                     f"Got disconnected from remote data host. Retrying in {config.STREAMING_READ_RETRY_INTERVAL}sec [{retry}/{max_retries}]"
                 )
                 time.sleep(config.STREAMING_READ_RETRY_INTERVAL)
         else:
-            raise ConnectionError("Server Disconnected")
+            raise ConnectionError("Server Disconnected") from disconnect_err
         return out
 
     file_obj.read = read_with_retries
 
 
+def _get_path_extension(path: str) -> str:
+    # Get extension: https://foo.bar/train.json.gz -> gz
+    extension = path.split(".")[-1]
+    # Remove query params ("dl=1", "raw=true"): gz?dl=1 -> gz
+    # Remove shards infos (".txt_1", ".txt-00000-of-00100"): txt_1 -> txt
+    for symb in "?-_":
+        extension = extension.split(symb)[0]
+    return extension
+
+
 def _get_extraction_protocol_with_magic_number(f) -> Optional[str]:
     """read the magic number from a file-like object and return the compression protocol"""
+    # Check if the file object is seekable even before reading the magic number (to avoid https://bugs.python.org/issue26440)
+    try:
+        f.seek(0)
+    except (AttributeError, io.UnsupportedOperation):
+        return None
     magic_number = f.read(MAGIC_NUMBER_MAX_LENGTH)
     f.seek(0)
     for i in range(MAGIC_NUMBER_MAX_LENGTH):
         compression = MAGIC_NUMBER_TO_COMPRESSION_PROTOCOL.get(magic_number[: MAGIC_NUMBER_MAX_LENGTH - i])
-        if compression is not None:  # TODO(QL): raise an error for .tar.gz files as in _get_extraction_protocol
+        if compression is not None:
             return compression
         compression = MAGIC_NUMBER_TO_UNSUPPORTED_COMPRESSION_PROTOCOL.get(magic_number[: MAGIC_NUMBER_MAX_LENGTH - i])
         if compression is not None:
             raise NotImplementedError(f"Compression protocol '{compression}' not implemented.")
 
 
 def _get_extraction_protocol(urlpath: str, use_auth_token: Optional[Union[str, bool]] = None) -> Optional[str]:
     # get inner file: zip://train-00000.json.gz::https://foo.bar/data.zip -> zip://train-00000.json.gz
+    urlpath = str(urlpath)
     path = urlpath.split("::")[0]
-    # Get extension: https://foo.bar/train.json.gz -> gz
-    extension = path.split(".")[-1]
-    # Remove query params ("dl=1", "raw=true"): gz?dl=1 -> gz
-    # Remove shards infos (".txt_1", ".txt-00000-of-00100"): txt_1 -> txt
-    for symb in "?-_":
-        extension = extension.split(symb)[0]
-    if extension in BASE_KNOWN_EXTENSIONS:
+    extension = _get_path_extension(path)
+    if (
+        extension in BASE_KNOWN_EXTENSIONS
+        or extension in ["tgz", "tar"]
+        or path.endswith((".tar.gz", ".tar.bz2", ".tar.xz"))
+    ):
         return None
-    elif extension in ["tgz", "tar"] or path.endswith(".tar.gz"):
-        raise NotImplementedError(
-            f"Extraction protocol for TAR archives like '{urlpath}' is not implemented in streaming mode. "
-            f"Please use `dl_manager.iter_archive` instead.\n\n"
-            f"Example usage:\n\n"
-            f"\turl = dl_manager.download(url)\n"
-            f"\ttar_archive_iterator = dl_manager.iter_archive(url)\n\n"
-            f"\tfor filename, file in tar_archive_iterator:\n"
-            f"\t\t..."
-        )
     elif extension in COMPRESSION_EXTENSION_TO_PROTOCOL:
         return COMPRESSION_EXTENSION_TO_PROTOCOL[extension]
-
     if is_remote_url(urlpath):
         # get headers and cookies for authentication on the HF Hub and for Google Drive
         urlpath, kwargs = _prepare_http_url_kwargs(urlpath, use_auth_token=use_auth_token)
     else:
         urlpath, kwargs = urlpath, {}
     with fsspec.open(urlpath, **kwargs) as f:
         return _get_extraction_protocol_with_magic_number(f)
@@ -584,14 +621,26 @@
         if is_local_path(main_hop):
             return main_hop
         path_as_posix = path_str.replace("\\", "/")
         path_as_posix = SINGLE_SLASH_AFTER_PROTOCOL_PATTERN.sub("://", path_as_posix)
         path_as_posix += "//" if path_as_posix.endswith(":") else ""  # Add slashes to root of the protocol
         return path_as_posix
 
+    def exists(self, use_auth_token: Optional[Union[str, bool]] = None):
+        """Extend `pathlib.Path.exists` method to support both local and remote files.
+
+        Args:
+            use_auth_token (`bool` or `str`, *optional*): Whether to use token or token to authenticate on the
+                Hugging Face Hub for private remote files.
+
+        Returns:
+            `bool`
+        """
+        return xexists(str(self), use_auth_token=use_auth_token)
+
     def glob(self, pattern, use_auth_token: Optional[Union[str, bool]] = None):
         """Glob function for argument of type :obj:`~pathlib.Path` that supports both local paths end remote URLs.
 
         Args:
             pattern (`str`): Pattern that resulting paths must match.
             use_auth_token (`bool` or `str`, *optional*): Whether to use token or token to authenticate on the
                 Hugging Face Hub for private remote files.
@@ -723,18 +772,30 @@
     else:
         filepath_or_buffer = str(filepath_or_buffer)
         if kwargs.get("compression", "infer") == "infer":
             kwargs["compression"] = _get_extraction_protocol(filepath_or_buffer, use_auth_token=use_auth_token)
         return pd.read_csv(xopen(filepath_or_buffer, "rb", use_auth_token=use_auth_token), **kwargs)
 
 
-def xpandas_read_excel(filepath_or_buffer, **kwargs):
+def xpandas_read_excel(filepath_or_buffer, use_auth_token: Optional[Union[str, bool]] = None, **kwargs):
     import pandas as pd
 
-    return pd.read_excel(BytesIO(filepath_or_buffer.read()), **kwargs)
+    if hasattr(filepath_or_buffer, "read"):
+        try:
+            return pd.read_excel(filepath_or_buffer, **kwargs)
+        except ValueError:  # Cannot seek streaming HTTP file
+            return pd.read_excel(BytesIO(filepath_or_buffer.read()), **kwargs)
+    else:
+        filepath_or_buffer = str(filepath_or_buffer)
+        try:
+            return pd.read_excel(xopen(filepath_or_buffer, "rb", use_auth_token=use_auth_token), **kwargs)
+        except ValueError:  # Cannot seek streaming HTTP file
+            return pd.read_excel(
+                BytesIO(xopen(filepath_or_buffer, "rb", use_auth_token=use_auth_token).read()), **kwargs
+            )
 
 
 def xsio_loadmat(filepath_or_buffer, use_auth_token: Optional[Union[str, bool]] = None, **kwargs):
     import scipy.io as sio
 
     if hasattr(filepath_or_buffer, "read"):
         return sio.loadmat(filepath_or_buffer, **kwargs)
@@ -791,16 +852,16 @@
     def __iter__(self):
         yield from self.generator(*self.args, **self.kwargs)
 
 
 class ArchiveIterable(_IterableFromGenerator):
     """An iterable of (path, fileobj) from a TAR archive, used by `iter_archive`"""
 
-    @classmethod
-    def _iter_from_fileobj(cls, f) -> Generator[Tuple, None, None]:
+    @staticmethod
+    def _iter_tar(f):
         stream = tarfile.open(fileobj=f, mode="r|*")
         for tarinfo in stream:
             file_path = tarinfo.name
             if not tarinfo.isreg():
                 continue
             if file_path is None:
                 continue
@@ -808,20 +869,47 @@
                 # skipping hidden files
                 continue
             file_obj = stream.extractfile(tarinfo)
             yield file_path, file_obj
             stream.members = []
         del stream
 
+    @staticmethod
+    def _iter_zip(f):
+        zipf = zipfile.ZipFile(f)
+        for member in zipf.infolist():
+            file_path = member.filename
+            if member.is_dir():
+                continue
+            if file_path is None:
+                continue
+            if os.path.basename(file_path).startswith((".", "__")):
+                # skipping hidden files
+                continue
+            file_obj = zipf.open(member)
+            yield file_path, file_obj
+
+    @classmethod
+    def _iter_from_fileobj(cls, f) -> Generator[Tuple, None, None]:
+        compression = _get_extraction_protocol_with_magic_number(f)
+        if compression == "zip":
+            yield from cls._iter_zip(f)
+        else:
+            yield from cls._iter_tar(f)
+
     @classmethod
     def _iter_from_urlpath(
         cls, urlpath: str, use_auth_token: Optional[Union[str, bool]] = None
     ) -> Generator[Tuple, None, None]:
+        compression = _get_extraction_protocol(urlpath, use_auth_token=use_auth_token)
         with xopen(urlpath, "rb", use_auth_token=use_auth_token) as f:
-            yield from cls._iter_from_fileobj(f)
+            if compression == "zip":
+                yield from cls._iter_zip(f)
+            else:
+                yield from cls._iter_tar(f)
 
     @classmethod
     def from_buf(cls, fileobj) -> "ArchiveIterable":
         return cls(cls._iter_from_fileobj, fileobj)
 
     @classmethod
     def from_urlpath(cls, urlpath_or_buf, use_auth_token: Optional[Union[str, bool]] = None) -> "ArchiveIterable":
@@ -937,14 +1025,27 @@
         """
         urlpaths = map_nested(self._extract, url_or_urls, map_tuple=True)
         return urlpaths
 
     def _extract(self, urlpath: str) -> str:
         urlpath = str(urlpath)
         protocol = _get_extraction_protocol(urlpath, use_auth_token=self.download_config.use_auth_token)
+        # get inner file: zip://train-00000.json.gz::https://foo.bar/data.zip -> zip://train-00000.json.gz
+        path = urlpath.split("::")[0]
+        extension = _get_path_extension(path)
+        if extension in ["tgz", "tar"] or path.endswith((".tar.gz", ".tar.bz2", ".tar.xz")):
+            raise NotImplementedError(
+                f"Extraction protocol for TAR archives like '{urlpath}' is not implemented in streaming mode. "
+                f"Please use `dl_manager.iter_archive` instead.\n\n"
+                f"Example usage:\n\n"
+                f"\turl = dl_manager.download(url)\n"
+                f"\ttar_archive_iterator = dl_manager.iter_archive(url)\n\n"
+                f"\tfor filename, file in tar_archive_iterator:\n"
+                f"\t\t..."
+            )
         if protocol is None:
             # no extraction
             return urlpath
         elif protocol in SINGLE_FILE_COMPRESSION_PROTOCOLS:
             # there is one single file which is the uncompressed file
             inner_file = os.path.basename(urlpath.split("::")[0])
             inner_file = inner_file[: inner_file.rindex(".")] if "." in inner_file else inner_file
```

### Comparing `datasets-2.8.0/src/datasets/features/audio.py` & `datasets-2.9.0/src/datasets/features/audio.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/features/features.py` & `datasets-2.9.0/src/datasets/features/features.py`

 * *Files 1% similar despite different names*

```diff
@@ -15,14 +15,15 @@
 # Lint as: python3
 """ This class handle features definition in datasets and some utilities to display table type."""
 import copy
 import json
 import re
 import sys
 from collections.abc import Iterable, Mapping
+from collections.abc import Sequence as SequenceABC
 from dataclasses import InitVar, dataclass, field, fields
 from functools import reduce, wraps
 from operator import mul
 from typing import Any, ClassVar, Dict, List, Optional
 from typing import Sequence as Sequence_
 from typing import Tuple, Union
 
@@ -291,54 +292,62 @@
     if config.JAX_AVAILABLE and "jax" in sys.modules:
         import jax.numpy as jnp
 
     if config.PIL_AVAILABLE and "PIL" in sys.modules:
         import PIL.Image
 
     if isinstance(obj, np.ndarray):
-        if not only_1d_for_numpy or obj.ndim == 1:
+        if obj.ndim == 0:
+            return obj[()], True
+        elif not only_1d_for_numpy or obj.ndim == 1:
             return obj, False
         else:
             return (
                 [
                     _cast_to_python_objects(
                         x, only_1d_for_numpy=only_1d_for_numpy, optimize_list_casting=optimize_list_casting
                     )[0]
                     for x in obj
                 ],
                 True,
             )
     elif config.TORCH_AVAILABLE and "torch" in sys.modules and isinstance(obj, torch.Tensor):
-        if not only_1d_for_numpy or obj.ndim == 1:
+        if obj.ndim == 0:
+            return obj.detach().cpu().numpy()[()], True
+        elif not only_1d_for_numpy or obj.ndim == 1:
             return obj.detach().cpu().numpy(), True
         else:
             return (
                 [
                     _cast_to_python_objects(
                         x, only_1d_for_numpy=only_1d_for_numpy, optimize_list_casting=optimize_list_casting
                     )[0]
                     for x in obj.detach().cpu().numpy()
                 ],
                 True,
             )
     elif config.TF_AVAILABLE and "tensorflow" in sys.modules and isinstance(obj, tf.Tensor):
-        if not only_1d_for_numpy or obj.ndim == 1:
+        if obj.ndim == 0:
+            return obj.numpy()[()], True
+        elif not only_1d_for_numpy or obj.ndim == 1:
             return obj.numpy(), True
         else:
             return (
                 [
                     _cast_to_python_objects(
                         x, only_1d_for_numpy=only_1d_for_numpy, optimize_list_casting=optimize_list_casting
                     )[0]
                     for x in obj.numpy()
                 ],
                 True,
             )
     elif config.JAX_AVAILABLE and "jax" in sys.modules and isinstance(obj, jnp.ndarray):
-        if not only_1d_for_numpy or obj.ndim == 1:
+        if obj.ndim == 0:
+            return np.asarray(obj)[()], True
+        elif not only_1d_for_numpy or obj.ndim == 1:
             return np.asarray(obj), True
         else:
             return (
                 [
                     _cast_to_python_objects(
                         x, only_1d_for_numpy=only_1d_for_numpy, optimize_list_casting=optimize_list_casting
                     )[0]
@@ -940,14 +949,16 @@
         if self.names is None:
             if self.names_file is not None:
                 self.names = self._load_names_from_file(self.names_file)
             elif self.num_classes is not None:
                 self.names = [str(i) for i in range(self.num_classes)]
             else:
                 raise ValueError("Please provide either num_classes, names or names_file.")
+        elif not isinstance(self.names, SequenceABC):
+            raise TypeError(f"Please provide names as a list, is {type(self.names)}")
         # Set self.num_classes
         if self.num_classes is None:
             self.num_classes = len(self.names)
         elif self.num_classes != len(self.names):
             raise ValueError(
                 "ClassLabel number of names do not match the defined num_classes. "
                 f"Got {len(self.names)} names VS {self.num_classes} num_classes"
```

### Comparing `datasets-2.8.0/src/datasets/features/image.py` & `datasets-2.9.0/src/datasets/features/image.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,8 +1,10 @@
 import os
+import sys
+import warnings
 from dataclasses import dataclass, field
 from io import BytesIO
 from typing import TYPE_CHECKING, Any, ClassVar, Dict, List, Optional, Union
 
 import numpy as np
 import pyarrow as pa
 
@@ -16,14 +18,32 @@
 if TYPE_CHECKING:
     import PIL.Image
 
     from .features import FeatureType
 
 
 _IMAGE_COMPRESSION_FORMATS: Optional[List[str]] = None
+_NATIVE_BYTEORDER = "<" if sys.byteorder == "little" else ">"
+# Origin: https://github.com/python-pillow/Pillow/blob/698951e19e19972aeed56df686868f1329981c12/src/PIL/Image.py#L3126 minus "|i1" which values are not preserved correctly when saving and loading an image
+_VALID_IMAGE_ARRAY_DTPYES = [
+    np.dtype("|b1"),
+    np.dtype("|u1"),
+    np.dtype("<u2"),
+    np.dtype(">u2"),
+    np.dtype("<i2"),
+    np.dtype(">i2"),
+    np.dtype("<u4"),
+    np.dtype(">u4"),
+    np.dtype("<i4"),
+    np.dtype(">i4"),
+    np.dtype("<f4"),
+    np.dtype(">f4"),
+    np.dtype("<f8"),
+    np.dtype(">f8"),
+]
 
 
 @dataclass
 class Image:
     """Image [`Feature`] to read image data from an image file.
 
     Input: The Image feature accepts as input:
@@ -85,19 +105,18 @@
 
         if isinstance(value, list):
             value = np.array(value)
 
         if isinstance(value, str):
             return {"path": value, "bytes": None}
         elif isinstance(value, np.ndarray):
-            # convert the image array to png bytes
-            image = PIL.Image.fromarray(value.astype(np.uint8))
-            return {"path": None, "bytes": image_to_bytes(image)}
+            # convert the image array to PNG/TIFF bytes
+            return encode_np_array(value)
         elif isinstance(value, PIL.Image.Image):
-            # convert the PIL image to bytes (default format is png)
+            # convert the PIL image to bytes (default format is PNG/TIFF)
             return encode_pil_image(value)
         elif value.get("path") is not None and os.path.isfile(value["path"]):
             # we set "bytes": None to not duplicate the data if they're already available locally
             return {"bytes": None, "path": value.get("path")}
         elif value.get("bytes") is not None or value.get("path") is not None:
             # store the image bytes, and path is used to infer the image format using the file extension
             return {"bytes": value.get("bytes"), "path": value.get("path")}
@@ -184,19 +203,14 @@
             storage (`Union[pa.StringArray, pa.StructArray, pa.ListArray]`):
                 PyArrow array to cast.
 
         Returns:
             `pa.StructArray`: Array in the Image arrow storage type, that is
                 `pa.struct({"bytes": pa.binary(), "path": pa.string()})`.
         """
-        if config.PIL_AVAILABLE:
-            import PIL.Image
-        else:
-            raise ImportError("To support encoding images, please install 'Pillow'.")
-
         if pa.types.is_string(storage.type):
             bytes_array = pa.array([None] * len(storage), type=pa.binary())
             storage = pa.StructArray.from_arrays([bytes_array, storage], ["bytes", "path"], mask=storage.is_null())
         elif pa.types.is_struct(storage.type):
             if storage.type.get_field_index("bytes") >= 0:
                 bytes_array = storage.field("bytes")
             else:
@@ -204,18 +218,15 @@
             if storage.type.get_field_index("path") >= 0:
                 path_array = storage.field("path")
             else:
                 path_array = pa.array([None] * len(storage), type=pa.string())
             storage = pa.StructArray.from_arrays([bytes_array, path_array], ["bytes", "path"], mask=storage.is_null())
         elif pa.types.is_list(storage.type):
             bytes_array = pa.array(
-                [
-                    image_to_bytes(PIL.Image.fromarray(np.array(arr, np.uint8))) if arr is not None else None
-                    for arr in storage.to_pylist()
-                ],
+                [encode_np_array(np.array(arr))["bytes"] if arr is not None else None for arr in storage.to_pylist()],
                 type=pa.binary(),
             )
             path_array = pa.array([None] * len(storage), type=pa.string())
             storage = pa.StructArray.from_arrays(
                 [bytes_array, path_array], ["bytes", "path"], mask=bytes_array.is_null()
             )
         return array_cast(storage, self.pa_type)
@@ -263,48 +274,90 @@
     if _IMAGE_COMPRESSION_FORMATS is None:
         PIL.Image.init()
         _IMAGE_COMPRESSION_FORMATS = list(set(PIL.Image.OPEN.keys()) & set(PIL.Image.SAVE.keys()))
     return _IMAGE_COMPRESSION_FORMATS
 
 
 def image_to_bytes(image: "PIL.Image.Image") -> bytes:
-    """Convert a PIL Image object to bytes using native compression if possible, otherwise use PNG compression."""
+    """Convert a PIL Image object to bytes using native compression if possible, otherwise use PNG/TIFF compression."""
     buffer = BytesIO()
-    format = image.format if image.format in list_image_compression_formats() else "PNG"
+    if image.format in list_image_compression_formats():
+        format = image.format
+    else:
+        format = "PNG" if image.mode in ["1", "L", "LA", "RGB", "RGBA"] else "TIFF"
     image.save(buffer, format=format)
     return buffer.getvalue()
 
 
 def encode_pil_image(image: "PIL.Image.Image") -> dict:
     if hasattr(image, "filename") and image.filename != "":
         return {"path": image.filename, "bytes": None}
     else:
         return {"path": None, "bytes": image_to_bytes(image)}
 
 
+def encode_np_array(array: np.ndarray) -> dict:
+    if config.PIL_AVAILABLE:
+        import PIL.Image
+    else:
+        raise ImportError("To support encoding images, please install 'Pillow'.")
+
+    dtype = array.dtype
+    dtype_byteorder = dtype.byteorder if dtype.byteorder != "=" else _NATIVE_BYTEORDER
+    dtype_kind = dtype.kind
+    dtype_itemsize = dtype.itemsize
+
+    dest_dtype = None
+
+    # Multi-channel array case (only np.dtype("|u1") is allowed)
+    if array.shape[2:]:
+        dest_dtype = np.dtype("|u1")
+        if dtype_kind not in ["u", "i"]:
+            raise TypeError(
+                f"Unsupported array dtype {dtype} for image encoding. Only {dest_dtype} is supported for multi-channel arrays."
+            )
+        if dtype is not dest_dtype:
+            warnings.warn(f"Downcasting array dtype {dtype} to {dest_dtype} to be compatible with 'Pillow'")
+    # Exact match
+    elif dtype in _VALID_IMAGE_ARRAY_DTPYES:
+        dest_dtype = dtype
+    else:  # Downcast the type within the kind (np.can_cast(from_type, to_type, casting="same_kind") doesn't behave as expected, so do it manually)
+        while dtype_itemsize >= 1:
+            dest_dtype_str = dtype_byteorder + dtype_kind + str(dtype_itemsize)
+            dest_dtype = np.dtype(dest_dtype_str)
+            if dest_dtype in _VALID_IMAGE_ARRAY_DTPYES:
+                warnings.warn(f"Downcasting array dtype {dtype} to {dest_dtype} to be compatible with 'Pillow'")
+                break
+            else:
+                dtype_itemsize //= 2
+
+    if dest_dtype is None:
+        raise TypeError(
+            f"Cannot convert dtype {dtype} to a valid image dtype. Valid image dtypes: {_VALID_IMAGE_ARRAY_DTPYES}"
+        )
+    image = PIL.Image.fromarray(array.astype(dest_dtype))
+    return {"path": None, "bytes": image_to_bytes(image)}
+
+
 def objects_to_list_of_image_dicts(
     objs: Union[List[str], List[dict], List[np.ndarray], List["PIL.Image.Image"]]
 ) -> List[dict]:
     """Encode a list of objects into a format suitable for creating an extension array of type `ImageExtensionType`."""
     if config.PIL_AVAILABLE:
         import PIL.Image
     else:
         raise ImportError("To support encoding images, please install 'Pillow'.")
 
     if objs:
         _, obj = first_non_null_value(objs)
         if isinstance(obj, str):
             return [{"path": obj, "bytes": None} if obj is not None else None for obj in objs]
         if isinstance(obj, np.ndarray):
-            return [
-                {"path": None, "bytes": image_to_bytes(PIL.Image.fromarray(obj.astype(np.uint8)))}
-                if obj is not None
-                else None
-                for obj in objs
-            ]
+            obj_to_image_dict_func = no_op_if_value_is_null(encode_np_array)
+            return [obj_to_image_dict_func(obj) for obj in objs]
         elif isinstance(obj, PIL.Image.Image):
             obj_to_image_dict_func = no_op_if_value_is_null(encode_pil_image)
             return [obj_to_image_dict_func(obj) for obj in objs]
         else:
             return objs
     else:
         return objs
```

### Comparing `datasets-2.8.0/src/datasets/features/translation.py` & `datasets-2.9.0/src/datasets/features/translation.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/filesystems/__init__.py` & `datasets-2.9.0/src/datasets/filesystems/__init__.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/filesystems/compression.py` & `datasets-2.9.0/src/datasets/filesystems/compression.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/filesystems/hffilesystem.py` & `datasets-2.9.0/src/datasets/filesystems/hffilesystem.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/filesystems/s3filesystem.py` & `datasets-2.9.0/src/datasets/filesystems/s3filesystem.py`

 * *Files 3% similar despite different names*

```diff
@@ -91,23 +91,23 @@
     Loading dataset from S3 using `S3Filesystem` and [`load_from_disk`].
 
     ```py
     >>> from datasets import load_from_disk
     >>> from datasets.filesystems import S3Filesystem
 
     >>> s3 = S3FileSystem(key=aws_access_key_id, secret=aws_secret_access_key)  # doctest: +SKIP
-    >>> dataset = load_from_disk('s3://my-private-datasets/imdb/train', fs=s3)  # doctest: +SKIP
+    >>> dataset = load_from_disk('s3://my-private-datasets/imdb/train', storage_options=s3.storage_options)  # doctest: +SKIP
     >>> print(len(dataset))
     25000
     ```
 
     Saving dataset to S3 using `S3Filesystem` and [`Dataset.save_to_disk`].
 
     ```py
     >>> from datasets import load_dataset
     >>> from datasets.filesystems import S3Filesystem
 
     >>> dataset = load_dataset("imdb")
     >>> s3 = S3FileSystem(key=aws_access_key_id, secret=aws_secret_access_key)  # doctest: +SKIP
-    >>> dataset.save_to_disk('s3://my-private-datasets/imdb/train', fs=s3)  # doctest: +SKIP
+    >>> dataset.save_to_disk('s3://my-private-datasets/imdb/train', storage_options=s3.storage_options)  # doctest: +SKIP
     ```
     """
```

### Comparing `datasets-2.8.0/src/datasets/fingerprint.py` & `datasets-2.9.0/src/datasets/fingerprint.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/formatting/__init__.py` & `datasets-2.9.0/src/datasets/formatting/__init__.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/formatting/formatting.py` & `datasets-2.9.0/src/datasets/formatting/formatting.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/formatting/jax_formatter.py` & `datasets-2.9.0/src/datasets/formatting/jax_formatter.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/formatting/np_formatter.py` & `datasets-2.9.0/src/datasets/formatting/np_formatter.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/formatting/tf_formatter.py` & `datasets-2.9.0/src/datasets/formatting/tf_formatter.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/formatting/torch_formatter.py` & `datasets-2.9.0/src/datasets/formatting/torch_formatter.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/info.py` & `datasets-2.9.0/src/datasets/info.py`

 * *Files 2% similar despite different names*

```diff
@@ -29,19 +29,20 @@
 """
 
 import copy
 import dataclasses
 import json
 import os
 import posixpath
+import warnings
 from dataclasses import dataclass
 from pathlib import Path
 from typing import ClassVar, Dict, List, Optional, Union
 
-from fsspec.implementations.local import LocalFileSystem
+import fsspec
 
 from . import config
 from .features import Features, Value
 from .filesystems import is_remote_filesystem
 from .splits import SplitDict
 from .tasks import TaskTemplate, task_template_from_dict
 from .utils import Version
@@ -204,36 +205,58 @@
         if self.task_templates is not None:
             self.task_templates = list(self.task_templates)
             if self.features is not None:
                 self.task_templates = [
                     template.align_with_features(self.features) for template in (self.task_templates)
                 ]
 
-    def write_to_directory(self, dataset_info_dir, pretty_print=False, fs=None):
+    def write_to_directory(
+        self, dataset_info_dir, pretty_print=False, fs="deprecated", storage_options: Optional[dict] = None
+    ):
         """Write `DatasetInfo` and license (if present) as JSON files to `dataset_info_dir`.
 
         Args:
             dataset_info_dir (`str`):
                 Destination directory.
             pretty_print (`bool`, defaults to `False`):
                 If `True`, the JSON will be pretty-printed with the indent level of 4.
-            fs (`fsspec.spec.AbstractFileSystem`, *optional*, defaults to `None`):
+            fs (`fsspec.spec.AbstractFileSystem`, *optional*):
                 Instance of the remote filesystem used to download the files from.
 
-                <Added version="2.5.0"/>
+                <Deprecated version="2.9.0">
+
+                `fs` was deprecated in version 2.9.0 and will be removed in 3.0.0.
+                Please use `storage_options` instead, e.g. `storage_options=fs.storage_options`.
+
+                </Deprecated>
+
+            storage_options (`dict`, *optional*):
+                Key/value pairs to be passed on to the file-system backend, if any.
+
+                <Added version="2.9.0"/>
 
         Example:
 
         ```py
         >>> from datasets import load_dataset
         >>> ds = load_dataset("rotten_tomatoes", split="validation")
         >>> ds.info.write_to_directory("/path/to/directory/")
         ```
         """
-        fs = fs or LocalFileSystem()
+        if fs != "deprecated":
+            warnings.warn(
+                "'fs' was deprecated in favor of 'storage_options' in version 2.9.0 and will be removed in 3.0.0.\n"
+                "You can remove this warning by passing 'storage_options=fs.storage_options' instead.",
+                FutureWarning,
+            )
+            storage_options = fs.storage_options
+
+        fs_token_paths = fsspec.get_fs_token_paths(dataset_info_dir, storage_options=storage_options)
+        fs: fsspec.AbstractFileSystem = fs_token_paths[0]
+
         is_local = not is_remote_filesystem(fs)
         path_join = os.path.join if is_local else posixpath.join
 
         with fs.open(path_join(dataset_info_dir, config.DATASET_INFO_FILENAME), "wb") as f:
             self._dump_info(f, pretty_print=pretty_print)
         if self.license:
             with fs.open(path_join(dataset_info_dir, config.LICENSE_FILENAME), "wb") as f:
@@ -274,39 +297,61 @@
             license=license,
             features=features,
             supervised_keys=supervised_keys,
             task_templates=task_templates,
         )
 
     @classmethod
-    def from_directory(cls, dataset_info_dir: str, fs=None) -> "DatasetInfo":
+    def from_directory(
+        cls, dataset_info_dir: str, fs="deprecated", storage_options: Optional[dict] = None
+    ) -> "DatasetInfo":
         """Create [`DatasetInfo`] from the JSON file in `dataset_info_dir`.
 
         This function updates all the dynamically generated fields (num_examples,
         hash, time of creation,...) of the [`DatasetInfo`].
 
         This will overwrite all previous metadata.
 
         Args:
             dataset_info_dir (`str`):
                 The directory containing the metadata file. This
                 should be the root directory of a specific dataset version.
-            fs (`fsspec.spec.AbstractFileSystem`, *optional*, defaults to `None`):
+            fs (`fsspec.spec.AbstractFileSystem`, *optional*):
                 Instance of the remote filesystem used to download the files from.
 
-                <Added version="2.5.0"/>
+                <Deprecated version="2.9.0">
+
+                `fs` was deprecated in version 2.9.0 and will be removed in 3.0.0.
+                Please use `storage_options` instead, e.g. `storage_options=fs.storage_options`.
+
+                </Deprecated>
+
+            storage_options (`dict`, *optional*):
+                Key/value pairs to be passed on to the file-system backend, if any.
+
+                <Added version="2.9.0"/>
 
         Example:
 
         ```py
         >>> from datasets import DatasetInfo
         >>> ds_info = DatasetInfo.from_directory("/path/to/directory/")
         ```
         """
-        fs = fs or LocalFileSystem()
+        if fs != "deprecated":
+            warnings.warn(
+                "'fs' was deprecated in favor of 'storage_options' in version 2.9.0 and will be removed in 3.0.0.\n"
+                "You can remove this warning by passing 'storage_options=fs.storage_options' instead.",
+                FutureWarning,
+            )
+            storage_options = fs.storage_options
+
+        fs_token_paths = fsspec.get_fs_token_paths(dataset_info_dir, storage_options=storage_options)
+        fs: fsspec.AbstractFileSystem = fs_token_paths[0]
+
         logger.info(f"Loading Dataset info from {dataset_info_dir}")
         if not dataset_info_dir:
             raise ValueError("Calling DatasetInfo.from_directory() with undefined dataset_info_dir.")
 
         is_local = not is_remote_filesystem(fs)
         path_join = os.path.join if is_local else posixpath.join
```

### Comparing `datasets-2.8.0/src/datasets/inspect.py` & `datasets-2.9.0/src/datasets/inspect.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/io/abc.py` & `datasets-2.9.0/src/datasets/io/abc.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/io/csv.py` & `datasets-2.9.0/src/datasets/io/csv.py`

 * *Files 2% similar despite different names*

```diff
@@ -45,24 +45,22 @@
         if self.streaming:
             dataset = self.builder.as_streaming_dataset(split=self.split)
         # Build regular (map-style) dataset
         else:
             download_config = None
             download_mode = None
             ignore_verifications = False
-            use_auth_token = None
             base_path = None
 
             self.builder.download_and_prepare(
                 download_config=download_config,
                 download_mode=download_mode,
                 ignore_verifications=ignore_verifications,
                 # try_from_hf_gcs=try_from_hf_gcs,
                 base_path=base_path,
-                use_auth_token=use_auth_token,
                 num_proc=self.num_proc,
             )
             dataset = self.builder.as_dataset(
                 split=self.split, ignore_verifications=ignore_verifications, in_memory=self.keep_in_memory
             )
         return dataset
```

### Comparing `datasets-2.8.0/src/datasets/io/generator.py` & `datasets-2.9.0/src/datasets/io/generator.py`

 * *Files 6% similar despite different names*

```diff
@@ -38,23 +38,21 @@
         if self.streaming:
             dataset = self.builder.as_streaming_dataset(split="train")
         # Build regular (map-style) dataset
         else:
             download_config = None
             download_mode = None
             ignore_verifications = False
-            use_auth_token = None
             base_path = None
 
             self.builder.download_and_prepare(
                 download_config=download_config,
                 download_mode=download_mode,
                 ignore_verifications=ignore_verifications,
                 # try_from_hf_gcs=try_from_hf_gcs,
                 base_path=base_path,
-                use_auth_token=use_auth_token,
                 num_proc=self.num_proc,
             )
             dataset = self.builder.as_dataset(
                 split="train", ignore_verifications=ignore_verifications, in_memory=self.keep_in_memory
             )
         return dataset
```

### Comparing `datasets-2.8.0/src/datasets/io/json.py` & `datasets-2.9.0/src/datasets/io/json.py`

 * *Files 2% similar despite different names*

```diff
@@ -50,24 +50,22 @@
         if self.streaming:
             dataset = self.builder.as_streaming_dataset(split=self.split)
         # Build regular (map-style) dataset
         else:
             download_config = None
             download_mode = None
             ignore_verifications = False
-            use_auth_token = None
             base_path = None
 
             self.builder.download_and_prepare(
                 download_config=download_config,
                 download_mode=download_mode,
                 ignore_verifications=ignore_verifications,
                 # try_from_hf_gcs=try_from_hf_gcs,
                 base_path=base_path,
-                use_auth_token=use_auth_token,
                 num_proc=self.num_proc,
             )
             dataset = self.builder.as_dataset(
                 split=self.split, ignore_verifications=ignore_verifications, in_memory=self.keep_in_memory
             )
         return dataset
```

### Comparing `datasets-2.8.0/src/datasets/io/parquet.py` & `datasets-2.9.0/src/datasets/io/parquet.py`

 * *Files 4% similar despite different names*

```diff
@@ -4,14 +4,15 @@
 import pyarrow as pa
 import pyarrow.parquet as pq
 
 from .. import Dataset, Features, NamedSplit, config
 from ..formatting import query_table
 from ..packaged_modules import _PACKAGED_DATASETS_MODULES
 from ..packaged_modules.parquet.parquet import Parquet
+from ..utils import logging
 from ..utils.typing import NestedDataStructureLike, PathLike
 from .abc import AbstractDatasetReader
 
 
 class ParquetDatasetReader(AbstractDatasetReader):
     def __init__(
         self,
@@ -49,24 +50,22 @@
         if self.streaming:
             dataset = self.builder.as_streaming_dataset(split=self.split)
         # Build regular (map-style) dataset
         else:
             download_config = None
             download_mode = None
             ignore_verifications = False
-            use_auth_token = None
             base_path = None
 
             self.builder.download_and_prepare(
                 download_config=download_config,
                 download_mode=download_mode,
                 ignore_verifications=ignore_verifications,
                 # try_from_hf_gcs=try_from_hf_gcs,
                 base_path=base_path,
-                use_auth_token=use_auth_token,
                 num_proc=self.num_proc,
             )
             dataset = self.builder.as_dataset(
                 split=self.split, ignore_verifications=ignore_verifications, in_memory=self.keep_in_memory
             )
         return dataset
 
@@ -100,15 +99,20 @@
         Caller is responsible for opening and closing the handle.
         """
         written = 0
         _ = parquet_writer_kwargs.pop("path_or_buf", None)
         schema = pa.schema(self.dataset.features.type)
         writer = pq.ParquetWriter(file_obj, schema=schema, **parquet_writer_kwargs)
 
-        for offset in range(0, len(self.dataset), batch_size):
+        for offset in logging.tqdm(
+            range(0, len(self.dataset), batch_size),
+            unit="ba",
+            disable=not logging.is_progress_bar_enabled(),
+            desc="Creating parquet from Arrow format",
+        ):
             batch = query_table(
                 table=self.dataset._data,
                 key=slice(offset, offset + batch_size),
                 indices=self.dataset._indices if self.dataset._indices is not None else None,
             )
             writer.write_table(batch)
             written += batch.nbytes
```

### Comparing `datasets-2.8.0/src/datasets/io/sql.py` & `datasets-2.9.0/src/datasets/io/sql.py`

 * *Files 2% similar despite different names*

```diff
@@ -33,24 +33,22 @@
             **kwargs,
         )
 
     def read(self):
         download_config = None
         download_mode = None
         ignore_verifications = False
-        use_auth_token = None
         base_path = None
 
         self.builder.download_and_prepare(
             download_config=download_config,
             download_mode=download_mode,
             ignore_verifications=ignore_verifications,
             # try_from_hf_gcs=try_from_hf_gcs,
             base_path=base_path,
-            use_auth_token=use_auth_token,
         )
 
         # Build dataset for splits
         dataset = self.builder.as_dataset(
             split="train", ignore_verifications=ignore_verifications, in_memory=self.keep_in_memory
         )
         return dataset
```

### Comparing `datasets-2.8.0/src/datasets/io/text.py` & `datasets-2.9.0/src/datasets/io/text.py`

 * *Files 9% similar despite different names*

```diff
@@ -41,23 +41,21 @@
         if self.streaming:
             dataset = self.builder.as_streaming_dataset(split=self.split)
         # Build regular (map-style) dataset
         else:
             download_config = None
             download_mode = None
             ignore_verifications = False
-            use_auth_token = None
             base_path = None
 
             self.builder.download_and_prepare(
                 download_config=download_config,
                 download_mode=download_mode,
                 ignore_verifications=ignore_verifications,
                 # try_from_hf_gcs=try_from_hf_gcs,
                 base_path=base_path,
-                use_auth_token=use_auth_token,
                 num_proc=self.num_proc,
             )
             dataset = self.builder.as_dataset(
                 split=self.split, ignore_verifications=ignore_verifications, in_memory=self.keep_in_memory
             )
         return dataset
```

### Comparing `datasets-2.8.0/src/datasets/iterable_dataset.py` & `datasets-2.9.0/src/datasets/iterable_dataset.py`

 * *Files 3% similar despite different names*

```diff
@@ -16,15 +16,15 @@
 from .features.features import FeatureType, _align_features, _check_if_features_can_be_aligned
 from .filesystems import _reset_fsspec_lock
 from .formatting import PythonFormatter, get_format_type_from_alias
 from .info import DatasetInfo
 from .splits import NamedSplit
 from .table import table_cast
 from .utils.logging import get_logger
-from .utils.sharding import _number_of_shards_in_gen_kwargs, _shuffle_gen_kwargs, _split_gen_kwargs
+from .utils.sharding import _merge_gen_kwargs, _number_of_shards_in_gen_kwargs, _shuffle_gen_kwargs, _split_gen_kwargs
 
 
 logger = get_logger(__name__)
 
 
 def _infer_features_from_batch(batch: Dict[str, list], try_features: Optional[Features] = None) -> Features:
     pa_table = pa.Table.from_pydict(batch)
@@ -91,15 +91,15 @@
     def shuffle_data_sources(self, generator: np.random.Generator) -> "_BaseExamplesIterable":
         """
         Either shuffle the shards/sources of the dataset, or propagate the shuffling to the underlying iterable.
         If the order of the shards must stay fixed (when using .skip or .take for example), then this method returns self.
         """
         raise NotImplementedError(f"{type(self)} doesn't implement shuffle_data_sources yet")
 
-    def shard_data_sources(self, shard_idx: int) -> "_BaseExamplesIterable":
+    def shard_data_sources(self, shard_indices: List[int]) -> "_BaseExamplesIterable":
         """Either keep only the requested shard, or propagate the request to the underlying iterable."""
         raise NotImplementedError(f"{type(self)} doesn't implement shard_data_sources yet")
 
     @property
     def n_shards(self) -> int:
         raise NotImplementedError(f"{type(self)} doesn't implement n_shards yet")
 
@@ -109,45 +109,75 @@
         self.generate_examples_fn = generate_examples_fn
         self.kwargs = kwargs
 
     def __iter__(self):
         yield from self.generate_examples_fn(**self.kwargs)
 
     def shuffle_data_sources(self, generator: np.random.Generator) -> "ExamplesIterable":
-        return ShardShuffledExamplesIterable(self.generate_examples_fn, self.kwargs, generator)
+        return ShuffledDataSourcesExamplesIterable(self.generate_examples_fn, self.kwargs, generator)
 
-    def shard_data_sources(self, shard_idx: int) -> "ExamplesIterable":
+    def shard_data_sources(self, shard_indices: List[int]) -> "ExamplesIterable":
         """Keep only the requested shard."""
-        kwargs_with_requested_data_source = _split_gen_kwargs(self.kwargs, max_num_jobs=self.n_shards)[shard_idx]
-        return ExamplesIterable(self.generate_examples_fn, kwargs_with_requested_data_source)
+        gen_kwargs_list = _split_gen_kwargs(self.kwargs, max_num_jobs=self.n_shards)
+        requested_gen_kwargs = _merge_gen_kwargs([gen_kwargs_list[i] for i in shard_indices])
+        return ExamplesIterable(self.generate_examples_fn, requested_gen_kwargs)
 
     @property
     def n_shards(self) -> int:
         return _number_of_shards_in_gen_kwargs(self.kwargs)
 
 
-class ShardShuffledExamplesIterable(ExamplesIterable):
+class ShuffledDataSourcesExamplesIterable(ExamplesIterable):
     def __init__(self, generate_examples_fn: Callable, kwargs: dict, generator: np.random.Generator):
         super().__init__(generate_examples_fn, kwargs)
         self.generator = deepcopy(generator)
 
     def __iter__(self):
         """Shuffle the kwargs order to shuffle shards"""
         rng = deepcopy(self.generator)
         kwargs_with_shuffled_shards = _shuffle_gen_kwargs(rng, self.kwargs)
         yield from self.generate_examples_fn(**kwargs_with_shuffled_shards)
 
-    def shard_data_sources(self, shard_idx: int) -> "ExamplesIterable":
+    def shard_data_sources(self, shard_indices: List[int]) -> "ExamplesIterable":
         """Keep only the requested shard."""
         rng = deepcopy(self.generator)
         kwargs_with_shuffled_shards = _shuffle_gen_kwargs(rng, self.kwargs)
-        kwargs_with_requested_data_source = _split_gen_kwargs(kwargs_with_shuffled_shards, max_num_jobs=self.n_shards)[
-            shard_idx
-        ]
-        return ExamplesIterable(self.generate_examples_fn, kwargs_with_requested_data_source)
+        return ExamplesIterable(self.generate_examples_fn, kwargs_with_shuffled_shards).shard_data_sources(
+            shard_indices
+        )
+
+
+class StepExamplesIterable(_BaseExamplesIterable):
+    def __init__(self, ex_iterable: _BaseExamplesIterable, step: int, offset: int):
+        self.ex_iterable = ex_iterable
+        self.step = step
+        self.offset = offset
+
+    def __iter__(self):
+        ex_iterator = iter(self.ex_iterable)
+        while True:
+            batch = list(islice(ex_iterator, self.step))
+            if len(batch) > self.offset:
+                yield batch[self.offset]
+            else:
+                break
+
+    def shuffle_data_sources(self, generator: np.random.Generator) -> "StepExamplesIterable":
+        return StepExamplesIterable(
+            self.ex_iterable.shuffle_data_sources(generator), step=self.step, offset=self.offset
+        )
+
+    def shard_data_sources(self, shard_indices: List[int]) -> "StepExamplesIterable":
+        return StepExamplesIterable(
+            self.ex_iterable.shard_data_sources(shard_indices), step=self.step, offset=self.offset
+        )
+
+    @property
+    def n_shards(self) -> int:
+        return self.ex_iterable.n_shards
 
 
 class CyclingMultiSourcesExamplesIterable(_BaseExamplesIterable):
     def __init__(
         self, ex_iterables: List[_BaseExamplesIterable], stopping_strategy: Optional[str] = "first_exhausted"
     ):
         self.ex_iterables = ex_iterables
@@ -719,14 +749,20 @@
 
 
 @dataclass
 class ShufflingConfig:
     generator: np.random.Generator
 
 
+@dataclass
+class DistributedConfig:
+    rank: int
+    world_size: int
+
+
 def _maybe_add_torch_iterable_dataset_parent_class(cls):
     """Add torch.utils.data.IterableDataset as a parent class if 'torch' is available"""
     if config.TORCH_AVAILABLE:
         import torch.utils.data
 
         if torch.utils.data.IterableDataset not in cls.__bases__:
             cls.__bases__ += (torch.utils.data.IterableDataset,)
@@ -738,116 +774,151 @@
     def __init__(
         self,
         ex_iterable: _BaseExamplesIterable,
         info: Optional[DatasetInfo] = None,
         split: Optional[NamedSplit] = None,
         format_type: Optional[str] = None,
         shuffling: Optional[ShufflingConfig] = None,
+        distributed: Optional[DistributedConfig] = None,
         token_per_repo_id: Optional[Dict[str, Union[str, bool, None]]] = None,
     ):
         info = info.copy() if info is not None else DatasetInfo()
         DatasetInfoMixin.__init__(self, info=info, split=split)
 
         self._ex_iterable = ex_iterable
         self._format_type = format_type
         self._shuffling = shuffling
+        self._distributed = distributed
         self._epoch = 0
         self._token_per_repo_id: Dict[str, Union[str, bool, None]] = token_per_repo_id or {}
         _maybe_add_torch_iterable_dataset_parent_class(self.__class__)
 
     def __getstate__(self):
         return self.__dict__
 
     def __setstate__(self, d):
         self.__dict__ = d
         # Re-add torch iterable dataset as a parent class, since dynamically added parent classes are not kept when pickling
         _maybe_add_torch_iterable_dataset_parent_class(self.__class__)
 
     def _head(self, n=5):
-        return _examples_to_batch([x for key, x in islice(self._iter(), n)])
+        return _examples_to_batch(list(self.take(n)))
 
     def _effective_generator(self):
         if self._shuffling and self._epoch == 0:
             return self._shuffling.generator
         elif self._shuffling:
             # Create effective seed using self._epoch (we subtract in order to avoir overflow in long_scalars)
             effective_seed = deepcopy(self._shuffling.generator).integers(0, 1 << 63) - self._epoch
             effective_seed = (1 << 63) + effective_seed if effective_seed < 0 else effective_seed
             return np.random.default_rng(effective_seed)
         else:
             raise ValueError("This dataset is not shuffled")
 
     @property
     def n_shards(self) -> int:
+        if self._distributed and self._ex_iterable.n_shards % self._distributed.world_size == 0:
+            return self._ex_iterable.n_shards // self._distributed.world_size
         return self._ex_iterable.n_shards
 
-    def _iter(self):
-        if self._shuffling:
-            ex_iterable = self._ex_iterable.shuffle_data_sources(self._effective_generator())
+    def _iter_pytorch(self, ex_iterable: _BaseExamplesIterable):
+        # fix for fsspec when using multiprocess
+        _reset_fsspec_lock()
+        # check if there aren't too many workers
+        import torch.utils.data
+
+        worker_info = torch.utils.data.get_worker_info()
+        if self._is_main_process() and ex_iterable.n_shards < worker_info.num_workers:
+            logger.warning(
+                f"Too many dataloader workers: {worker_info.num_workers} (max is dataset.n_shards={ex_iterable.n_shards}). "
+                f"Stopping {worker_info.num_workers - ex_iterable.n_shards} dataloader workers."
+            )
+            logger.warning(
+                f"To parallelize data loading, we give each process some shards (or data sources) to process. "
+                f"Therefore it's unnecessary to have a number of workers greater than dataset.n_shards={ex_iterable.n_shards}. "
+                f"To enable more parallelism, please split the dataset in more files than {ex_iterable.n_shards}."
+            )
+        # split workload
+        shards_indices = list(range(worker_info.id, ex_iterable.n_shards, worker_info.num_workers))
+        _log_prefix = f"node#{self._distributed.rank} " if self._distributed else ""
+        if shards_indices:
+            logger.debug(
+                f"{_log_prefix}dataloader worker#{worker_info.id}, ': Starting to iterate over {len(shards_indices)}/{ex_iterable.n_shards} shards."
+            )
+            for key, example in ex_iterable.shard_data_sources(shards_indices):
+                if self.features:
+                    yield _apply_feature_types_on_example(
+                        example, self.features, token_per_repo_id=self._token_per_repo_id
+                    )
+                else:
+                    yield example
+            logger.debug(
+                f"{_log_prefix}dataloader worker#{worker_info.id}, ': Finished iterating over {len(shards_indices)}/{ex_iterable.n_shards} shards."
+            )
         else:
-            ex_iterable = self._ex_iterable
-        yield from ex_iterable
+            logger.debug(
+                f"{_log_prefix}dataloader worker#{worker_info.id}, ': Stopping... Number of dataset shards < num_workers ({ex_iterable.n_shards}<{worker_info.num_workers})."
+            )
+
+    def _is_main_process(self):
+        if self._distributed and self._distributed.rank > 0:
+            return False
+        if "torch" in sys.modules:
+            import torch.utils.data
+
+            worker_info = torch.utils.data.get_worker_info()
+            if worker_info is not None and worker_info.id > 0:
+                return False
+        return True
 
-    def _iter_shard(self, shard_idx: int):
+    def _prepare_ex_iterable_for_iteration(self) -> _BaseExamplesIterable:
         if self._shuffling:
             ex_iterable = self._ex_iterable.shuffle_data_sources(self._effective_generator())
         else:
             ex_iterable = self._ex_iterable
-        yield from ex_iterable.shard_data_sources(shard_idx)
 
-    def _iter_pytorch(self, worker_info):
-        # fix for fsspec when using multprocess
-        _reset_fsspec_lock()
-        if worker_info is None:  # single-process data loading, return the full iterator
-            yield from IterableDataset.__iter__(self)
-        else:  # in a worker process
-            # check if there aren't too many workers
-            if worker_info.id == 0 and self.n_shards < worker_info.num_workers:
-                logger.warning(
-                    f"Too many dataloader workers: {worker_info.num_workers} (max is dataset.n_shards={self.n_shards}). "
-                    f"Stopping dataloader workers [{self.n_shards}...{worker_info.num_workers -1}]."
-                )
-                logger.warning(
-                    f"To parallelize data loading, we give each process some shards (or data sources) to process. "
-                    f"Therefore it's unnecessary to have a number of workers greater than dataset.n_shards={self.n_shards}."
-                    f"To enable more parallelism, please split the dataset in more files than {self.n_shards}."
-                )
-            # split workload
-            shards_indices = list(range(worker_info.id, self.n_shards, worker_info.num_workers))
-            if shards_indices:
-                logger.debug(
-                    f"dataloader worker#{worker_info.id}, ': Starting to iterate over {len(shards_indices)}/{self.n_shards} shards."
-                )
-                for shard_idx in shards_indices:
-                    for key, example in self._iter_shard(shard_idx):
-                        if self.features:
-                            yield _apply_feature_types_on_example(
-                                example, self.features, token_per_repo_id=self._token_per_repo_id
-                            )
-                        else:
-                            yield example
-                logger.debug(
-                    f"dataloader worker#{worker_info.id}, ': Finished iterating over {len(shards_indices)}/{self.n_shards} shards."
-                )
+        if self._distributed:
+            rank = self._distributed.rank
+            world_size = self._distributed.world_size
+            if ex_iterable.n_shards % world_size == 0:
+                if self._is_main_process():
+                    n_shards_per_node = ex_iterable.n_shards // world_size
+                    plural = "s" if n_shards_per_node > 1 else ""
+                    logger.warning(
+                        f"Assigning {n_shards_per_node} shard{plural} (or data source{plural}) of the dataset to each node."
+                    )
+                shards_indices = list(range(rank, ex_iterable.n_shards, world_size))
+                ex_iterable = ex_iterable.shard_data_sources(shards_indices)
             else:
-                logger.debug(
-                    f"dataloader worker#{worker_info.id}, ': Stopping... Number of dataset shards < num_workers ({self.n_shards}<{worker_info.num_workers})."
-                )
+                if self._is_main_process():
+                    logger.warning(
+                        f"Assigning 1 out of {world_size} examples of the dataset to each node. The others are skipped during the iteration."
+                    )
+                    logger.info(
+                        f"It is more optimized to distribute the dataset shards (or data sources) across nodes. "
+                        f"You can do that by using a dataset with number of shards that is a factor of world_size={world_size}. "
+                        f"The current dataset has {ex_iterable.n_shards} which is not a factor of {world_size}"
+                    )
+                ex_iterable = StepExamplesIterable(ex_iterable, step=world_size, offset=rank)
+
+        return ex_iterable
 
     def __iter__(self):
+        ex_iterable = self._prepare_ex_iterable_for_iteration()
+
         if "torch" in sys.modules:
             import torch.utils.data
 
             worker_info = torch.utils.data.get_worker_info()
             if isinstance(self, torch.utils.data.IterableDataset) and worker_info is not None:
                 # We're a torch.utils.data.IterableDataset in a PyTorch worker process
-                yield from self._iter_pytorch(worker_info)
+                yield from self._iter_pytorch(ex_iterable)
                 return
 
-        for key, example in self._iter():
+        for key, example in ex_iterable:
             if self.features:
                 # `IterableDataset` automatically fills missing columns with None.
                 # This is done with `_apply_feature_types_on_example`.
                 yield _apply_feature_types_on_example(
                     example, self.features, token_per_repo_id=self._token_per_repo_id
                 )
             else:
@@ -857,15 +928,15 @@
         """Iterate through the batches of size `batch_size`.
 
         Args:
             batch_size (:obj:`int`): size of each batch to yield.
             drop_last_batch (:obj:`bool`, default `False`): Whether a last batch smaller than the batch_size should be
                 dropped
         """
-        iterator = self._iter()
+        iterator = iter(self._prepare_ex_iterable_for_iteration())
         for key, example in iterator:
             # If batched, first build the batch
             examples = [example] + [example for key, example in islice(iterator, batch_size - 1)]
             if drop_last_batch and len(examples) < batch_size:  # ignore last batch
                 return
             batch = _examples_to_batch(examples)
             if self.features:
@@ -876,15 +947,15 @@
                 yield batch
 
     @staticmethod
     def from_generator(
         generator: Callable,
         features: Optional[Features] = None,
         gen_kwargs: Optional[dict] = None,
-    ):
+    ) -> "IterableDataset":
         """Create an Iterable Dataset from a generator.
 
         Args:
             generator (`Callable`):
                 A generator function that `yields` examples.
             features (`Features`, *optional*):
                 Dataset features.
@@ -949,14 +1020,15 @@
         # TODO(QL): add pandas, numpy and tf formats
         return IterableDataset(
             ex_iterable=self._ex_iterable,
             info=self._info.copy(),
             split=self._split,
             format_type=type,
             shuffling=copy.deepcopy(self._shuffling),
+            distributed=copy.deepcopy(self._distributed),
             token_per_repo_id=self._token_per_repo_id,
         )
 
     def map(
         self,
         function: Optional[Callable] = None,
         with_indices: bool = False,
@@ -1060,14 +1132,15 @@
         info.features = features
         return IterableDataset(
             ex_iterable=ex_iterable,
             info=info,
             split=self._split,
             format_type=self._format_type,
             shuffling=copy.deepcopy(self._shuffling),
+            distributed=copy.deepcopy(self._distributed),
             token_per_repo_id=self._token_per_repo_id,
         )
 
     def filter(
         self,
         function: Optional[Callable] = None,
         with_indices=False,
@@ -1132,14 +1205,15 @@
         )
         return IterableDataset(
             ex_iterable=ex_iterable,
             info=info,
             split=self._split,
             format_type=self._format_type,
             shuffling=copy.deepcopy(self._shuffling),
+            distributed=copy.deepcopy(self._distributed),
             token_per_repo_id=self._token_per_repo_id,
         )
 
     def shuffle(
         self, seed=None, generator: Optional[np.random.Generator] = None, buffer_size: int = 1000
     ) -> "IterableDataset":
         """
@@ -1198,14 +1272,15 @@
             ex_iterable=BufferShuffledExamplesIterable(
                 self._ex_iterable, buffer_size=buffer_size, generator=generator
             ).shuffle_data_sources(generator),
             info=self._info.copy(),
             split=self._split,
             format_type=self._format_type,
             shuffling=shuffling,
+            distributed=copy.deepcopy(self._distributed),
             token_per_repo_id=self._token_per_repo_id,
         )
 
     def set_epoch(self, epoch: int):
         self._epoch = epoch
 
     def skip(self, n) -> "IterableDataset":
@@ -1239,14 +1314,15 @@
         ex_iterable = SkipExamplesIterable(self._ex_iterable, n)
         return IterableDataset(
             ex_iterable=ex_iterable,
             info=self._info.copy(),
             split=self._split,
             format_type=self._format_type,
             shuffling=copy.deepcopy(self._shuffling),
+            distributed=copy.deepcopy(self._distributed),
             token_per_repo_id=self._token_per_repo_id,
         )
 
     def take(self, n) -> "IterableDataset":
         """
         Create a new [`IterableDataset`] with only the first `n` elements.
 
@@ -1270,14 +1346,15 @@
         ex_iterable = TakeExamplesIterable(self._ex_iterable, n)
         return IterableDataset(
             ex_iterable=ex_iterable,
             info=self._info.copy(),
             split=self._split,
             format_type=self._format_type,
             shuffling=copy.deepcopy(self._shuffling),
+            distributed=copy.deepcopy(self._distributed),
             token_per_repo_id=self._token_per_repo_id,
         )
 
     def add_column(self, name: str, column: Union[list, np.array]) -> "IterableDataset":
         """Add column to Dataset.
 
         Args:
@@ -1460,14 +1537,15 @@
             info.task_templates = None
         return IterableDataset(
             ex_iterable=self._ex_iterable,
             info=info,
             split=self._split,
             format_type=self._format_type,
             shuffling=copy.deepcopy(self._shuffling),
+            distributed=copy.deepcopy(self._distributed),
             token_per_repo_id=self._token_per_repo_id,
         )
 
     def cast(
         self,
         features: Features,
     ) -> "IterableDataset":
@@ -1510,14 +1588,27 @@
             info.task_templates = None
         return IterableDataset(
             ex_iterable=self._ex_iterable,
             info=info,
             split=self._split,
             format_type=self._format_type,
             shuffling=copy.deepcopy(self._shuffling),
+            distributed=copy.deepcopy(self._distributed),
+            token_per_repo_id=self._token_per_repo_id,
+        )
+
+    def _step(self, step: int, offset: int) -> "IterableDataset":
+        ex_iterable = StepExamplesIterable(self._ex_iterable, step=step, offset=offset)
+        return IterableDataset(
+            ex_iterable=ex_iterable,
+            info=self._info.copy(),
+            split=self._split,
+            format_type=self._format_type,
+            shuffling=copy.deepcopy(self._shuffling),
+            distributed=copy.deepcopy(self._distributed),
             token_per_repo_id=self._token_per_repo_id,
         )
 
     def _resolve_features(self):
         if self.features is not None:
             return self
         elif isinstance(self._ex_iterable, TypedExamplesIterable):
@@ -1528,14 +1619,15 @@
         info.features = features
         return IterableDataset(
             ex_iterable=self._ex_iterable,
             info=info,
             split=self._split,
             format_type=self._format_type,
             shuffling=copy.deepcopy(self._shuffling),
+            distributed=copy.deepcopy(self._distributed),
             token_per_repo_id=self._token_per_repo_id,
         )
 
 
 def _concatenate_iterable_datasets(
     dsets: List[IterableDataset],
     info: Optional[DatasetInfo] = None,
@@ -1658,7 +1750,41 @@
     info.features = features
     # Get all the auth tokens per repository - in case the datasets come from different private repositories
     token_per_repo_id = {
         repo_id: token for dataset in datasets for repo_id, token in dataset._token_per_repo_id.items()
     }
     # Return new daset
     return IterableDataset(ex_iterable=ex_iterable, info=info, split=split, token_per_repo_id=token_per_repo_id)
+
+
+def _split_by_node_iterable_dataset(dataset: IterableDataset, rank: int, world_size: int) -> IterableDataset:
+    """
+    Split an iterable dataset for the node at rank `rank` in a pool of nodes of size `world_size`.
+
+    If the dataset has a number of shards that is a factor of `world_size` (i.e. if `dataset.n_shards % world_size == 0`),
+    then the shards are evenly assigned across the nodes, which is the most optimized.
+    Otherwise, each node keeps 1 example out of `world_size`, skipping the other examples.
+
+    Args:
+        dataset ([`IterableDataset`]):
+            The iterable dataset to split by node.
+        rank (`int`):
+            Rank of the current node.
+        world_size (`int`):
+            Total number of nodes.
+
+    Returns:
+        [`IterableDataset`]: The iterable dataset to be used on the node at rank `rank`.
+    """
+    if dataset._distributed:
+        world_size = world_size * dataset._distributed.world_size
+        rank = world_size * dataset._distributed.rank + rank
+    distributed = DistributedConfig(rank=rank, world_size=world_size)
+    return IterableDataset(
+        ex_iterable=dataset._ex_iterable,
+        info=dataset._info.copy(),
+        split=dataset._split,
+        format_type=dataset._format_type,
+        shuffling=copy.deepcopy(dataset._shuffling),
+        distributed=distributed,
+        token_per_repo_id=dataset._token_per_repo_id,
+    )
```

### Comparing `datasets-2.8.0/src/datasets/keyhash.py` & `datasets-2.9.0/src/datasets/keyhash.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/load.py` & `datasets-2.9.0/src/datasets/load.py`

 * *Files 1% similar despite different names*

```diff
@@ -15,14 +15,15 @@
 # Lint as: python3
 """Access datasets."""
 import filecmp
 import importlib
 import inspect
 import json
 import os
+import posixpath
 import shutil
 import time
 import warnings
 from collections import Counter
 from dataclasses import dataclass
 from pathlib import Path
 from typing import Dict, List, Mapping, Optional, Sequence, Tuple, Type, Union
@@ -1630,15 +1631,15 @@
         download_mode ([`DownloadMode`], defaults to `REUSE_DATASET_IF_EXISTS`):
             Download/generate mode.
         ignore_verifications (`bool`, defaults to `False`):
             Ignore the verifications of the downloaded/processed dataset information (checksums/size/splits/...).
         keep_in_memory (`bool`, defaults to `None`):
             Whether to copy the dataset in-memory. If `None`, the dataset
             will not be copied in-memory unless explicitly enabled by setting `datasets.config.IN_MEMORY_MAX_SIZE` to
-            nonzero. See more details in the [improve performance](./cache#improve-performance) section.
+            nonzero. See more details in the [improve performance](../cache#improve-performance) section.
         save_infos (`bool`, defaults to `False`):
             Save the dataset information (checksums/size/splits/...).
         revision ([`Version`] or `str`, *optional*):
             Version of the dataset script to load.
             As datasets have their own git repository on the Datasets Hub, the default version "main" corresponds to their "main" branch.
             You can specify a different version than the default "main" by using a commit SHA or a git tag of the dataset repository.
         use_auth_token (`str` or `bool`, *optional*):
@@ -1772,54 +1773,82 @@
         ds = ds.prepare_for_task(task)
     if save_infos:
         builder_instance._save_infos()
 
     return ds
 
 
-def load_from_disk(dataset_path: str, fs=None, keep_in_memory: Optional[bool] = None) -> Union[Dataset, DatasetDict]:
+def load_from_disk(
+    dataset_path: str, fs="deprecated", keep_in_memory: Optional[bool] = None, storage_options: Optional[dict] = None
+) -> Union[Dataset, DatasetDict]:
     """
     Loads a dataset that was previously saved using [`~Dataset.save_to_disk`] from a dataset directory, or
     from a filesystem using either [`~datasets.filesystems.S3FileSystem`] or any implementation of
     `fsspec.spec.AbstractFileSystem`.
 
     Args:
         dataset_path (`str`):
             Path (e.g. `"dataset/train"`) or remote URI (e.g.
             `"s3://my-bucket/dataset/train"`) of the [`Dataset`] or [`DatasetDict`] directory where the dataset will be
             loaded from.
-        fs (`~filesystems.S3FileSystem` or `fsspec.spec.AbstractFileSystem`, *optional*, defaults to `None`):
+        fs (`~filesystems.S3FileSystem` or `fsspec.spec.AbstractFileSystem`, *optional*):
             Instance of the remote filesystem used to download the files from.
+
+            <Deprecated version="2.9.0">
+
+            `fs` was deprecated in version 2.9.0 and will be removed in 3.0.0.
+            Please use `storage_options` instead, e.g. `storage_options=fs.storage_options`.
+
+            </Deprecated>
+
         keep_in_memory (`bool`, defaults to `None`):
             Whether to copy the dataset in-memory. If `None`, the dataset
             will not be copied in-memory unless explicitly enabled by setting `datasets.config.IN_MEMORY_MAX_SIZE` to
-            nonzero. See more details in the [improve performance](./cache#improve-performance) section.
+            nonzero. See more details in the [improve performance](../cache#improve-performance) section.
+
+        storage_options (`dict`, *optional*):
+            Key/value pairs to be passed on to the file-system backend, if any.
+
+            <Added version="2.9.0"/>
 
     Returns:
         [`Dataset`] or [`DatasetDict`]:
         - If `dataset_path` is a path of a dataset directory: the dataset requested.
         - If `dataset_path` is a path of a dataset dict directory, a [`DatasetDict`] with each split.
 
     Example:
 
     ```py
     >>> from datasets import load_from_disk
     >>> ds = load_from_disk('path/to/dataset/directory')
     ```
     """
+    if fs != "deprecated":
+        warnings.warn(
+            "'fs' was deprecated in favor of 'storage_options' in version 2.9.0 and will be removed in 3.0.0.\n"
+            "You can remove this warning by passing 'storage_options=fs.storage_options' instead.",
+            FutureWarning,
+        )
+        storage_options = fs.storage_options
+
+    fs_token_paths = fsspec.get_fs_token_paths(dataset_path, storage_options=storage_options)
+    fs: fsspec.AbstractFileSystem = fs_token_paths[0]
+
     # gets filesystem from dataset, either s3:// or file:// and adjusted dataset_path
     if is_remote_filesystem(fs):
         dest_dataset_path = extract_path_from_uri(dataset_path)
+        path_join = posixpath.join
     else:
         fs = fsspec.filesystem("file")
         dest_dataset_path = dataset_path
+        path_join = os.path.join
 
     if not fs.exists(dest_dataset_path):
         raise FileNotFoundError(f"Directory {dataset_path} not found")
-    if fs.isfile(Path(dest_dataset_path, config.DATASET_INFO_FILENAME).as_posix()):
-        return Dataset.load_from_disk(dataset_path, fs, keep_in_memory=keep_in_memory)
-    elif fs.isfile(Path(dest_dataset_path, config.DATASETDICT_JSON_FILENAME).as_posix()):
-        return DatasetDict.load_from_disk(dataset_path, fs, keep_in_memory=keep_in_memory)
+    if fs.isfile(path_join(dest_dataset_path, config.DATASET_INFO_FILENAME)):
+        return Dataset.load_from_disk(dataset_path, keep_in_memory=keep_in_memory, storage_options=storage_options)
+    elif fs.isfile(path_join(dest_dataset_path, config.DATASETDICT_JSON_FILENAME)):
+        return DatasetDict.load_from_disk(dataset_path, keep_in_memory=keep_in_memory, storage_options=storage_options)
     else:
         raise FileNotFoundError(
             f"Directory {dataset_path} is neither a dataset directory nor a dataset dict directory."
         )
```

### Comparing `datasets-2.8.0/src/datasets/metric.py` & `datasets-2.9.0/src/datasets/metric.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/naming.py` & `datasets-2.9.0/src/datasets/naming.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/packaged_modules/__init__.py` & `datasets-2.9.0/src/datasets/packaged_modules/__init__.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/packaged_modules/audiofolder/audiofolder.py` & `datasets-2.9.0/src/datasets/packaged_modules/audiofolder/audiofolder.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/packaged_modules/csv/csv.py` & `datasets-2.9.0/src/datasets/packaged_modules/csv/csv.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/packaged_modules/folder_based_builder/folder_based_builder.py` & `datasets-2.9.0/src/datasets/packaged_modules/folder_based_builder/folder_based_builder.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/packaged_modules/generator/generator.py` & `datasets-2.9.0/src/datasets/packaged_modules/generator/generator.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/packaged_modules/imagefolder/imagefolder.py` & `datasets-2.9.0/src/datasets/packaged_modules/imagefolder/imagefolder.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/packaged_modules/json/json.py` & `datasets-2.9.0/src/datasets/packaged_modules/json/json.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/packaged_modules/pandas/pandas.py` & `datasets-2.9.0/src/datasets/packaged_modules/pandas/pandas.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/packaged_modules/parquet/parquet.py` & `datasets-2.9.0/src/datasets/packaged_modules/parquet/parquet.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/packaged_modules/sql/sql.py` & `datasets-2.9.0/src/datasets/packaged_modules/sql/sql.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/packaged_modules/text/text.py` & `datasets-2.9.0/src/datasets/packaged_modules/text/text.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/search.py` & `datasets-2.9.0/src/datasets/search.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/splits.py` & `datasets-2.9.0/src/datasets/splits.py`

 * *Files 0% similar despite different names*

```diff
@@ -80,15 +80,15 @@
 
 
 class SplitBase(metaclass=abc.ABCMeta):
     # pylint: disable=line-too-long
     """Abstract base class for Split compositionality.
 
     See the
-    [guide on splits](./loading#slice-splits)
+    [guide on splits](../loading#slice-splits)
     for more information.
 
     There are three parts to the composition:
         1) The splits are composed (defined, merged, split,...) together before
              calling the `.as_dataset()` function. This is done with the `__add__`,
              `__getitem__`, which return a tree of `SplitBase` (whose leaf
              are the `NamedSplit` objects)
@@ -258,15 +258,15 @@
 
 
 class PercentSlice(metaclass=PercentSliceMeta):
     # pylint: disable=line-too-long
     """Syntactic sugar for defining slice subsplits: `datasets.percent[75:-5]`.
 
     See the
-    [guide on splits](./loading#slice-splits)
+    [guide on splits](../loading#slice-splits)
     for more information.
     """
     # pylint: enable=line-too-long
     pass
 
 
 percent = PercentSlice  # pylint: disable=invalid-name
@@ -415,15 +415,15 @@
       model architecture, etc.).
     - `TEST`: the testing data. This is the data to report metrics on. Typically
       you do not want to use this during model iteration as you may overfit to it.
     - `ALL`: the union of all defined dataset splits.
 
     All splits, including compositions inherit from `datasets.SplitBase`.
 
-    See the [guide](./load_hub#splits) on splits for more information.
+    See the [guide](../load_hub#splits) on splits for more information.
 
     Example:
 
     ```py
     >>> datasets.SplitGenerator(
     ...     name=datasets.Split.TRAIN,
     ...     gen_kwargs={"split_key": "train", "files": dl_manager.download_and extract(url)},
```

### Comparing `datasets-2.8.0/src/datasets/streaming.py` & `datasets-2.9.0/src/datasets/streaming.py`

 * *Files 2% similar despite different names*

```diff
@@ -3,14 +3,15 @@
 from functools import wraps
 from typing import TYPE_CHECKING, Optional, Union
 
 from .download.streaming_download_manager import (
     xbasename,
     xdirname,
     xet_parse,
+    xexists,
     xgetsize,
     xglob,
     xgzip_open,
     xisdir,
     xisfile,
     xjoin,
     xlistdir,
@@ -80,22 +81,23 @@
     patch_submodule(module, "os.path.join", xjoin).start()
     patch_submodule(module, "os.path.dirname", xdirname).start()
     patch_submodule(module, "os.path.basename", xbasename).start()
     patch_submodule(module, "os.path.relpath", xrelpath).start()
     patch_submodule(module, "os.path.split", xsplit).start()
     patch_submodule(module, "os.path.splitext", xsplitext).start()
     # allow checks on paths
+    patch_submodule(module, "os.path.exists", wrap_auth(xexists)).start()
     patch_submodule(module, "os.path.isdir", wrap_auth(xisdir)).start()
     patch_submodule(module, "os.path.isfile", wrap_auth(xisfile)).start()
     patch_submodule(module, "os.path.getsize", wrap_auth(xgetsize)).start()
     patch_submodule(module, "pathlib.Path", xPath).start()
     # file readers
     patch_submodule(module, "gzip.open", wrap_auth(xgzip_open)).start()
     patch_submodule(module, "pandas.read_csv", wrap_auth(xpandas_read_csv), attrs=["__version__"]).start()
-    patch_submodule(module, "pandas.read_excel", xpandas_read_excel, attrs=["__version__"]).start()
+    patch_submodule(module, "pandas.read_excel", wrap_auth(xpandas_read_excel), attrs=["__version__"]).start()
     patch_submodule(module, "scipy.io.loadmat", wrap_auth(xsio_loadmat), attrs=["__version__"]).start()
     patch_submodule(module, "xml.etree.ElementTree.parse", wrap_auth(xet_parse)).start()
     patch_submodule(module, "xml.dom.minidom.parse", wrap_auth(xxml_dom_minidom_parse)).start()
     module._patched_for_streaming = True
 
 
 def extend_dataset_builder_for_streaming(builder: "DatasetBuilder"):
```

### Comparing `datasets-2.8.0/src/datasets/table.py` & `datasets-2.9.0/src/datasets/table.py`

 * *Files 1% similar despite different names*

```diff
@@ -1441,44 +1441,74 @@
             axis (`{0, 1}`, defaults to `0`, meaning over rows):
                 Axis to concatenate over, where `0` means over rows (vertically) and `1` means over columns
                 (horizontally).
 
                 <Added version="1.6.0"/>
         """
 
-        def to_blocks(table):
+        def to_blocks(table: Union[pa.Table, Table]) -> List[List[TableBlock]]:
             if isinstance(table, pa.Table):
                 return [[InMemoryTable(table)]]
             elif isinstance(table, ConcatenationTable):
                 return copy.deepcopy(table.blocks)
             else:
                 return [[table]]
 
-        def _split_like(blocks_to_split, blocks_like):
-            splits = []
-            offset = 0
-            for block_row in blocks_like:
-                length = block_row[0].num_rows
-                splits.append((offset, length))
-                offset += length
-            return [
-                [block.slice(offset=split[0], length=split[1]) for block in blocks_to_split[0]] for split in splits
-            ]
+        def _slice_row_block(row_block: List[TableBlock], length: int) -> Tuple[List[TableBlock], List[TableBlock]]:
+            sliced = [table.slice(0, length) for table in row_block]
+            remainder = [table.slice(length, len(row_block[0]) - length) for table in row_block]
+            return sliced, remainder
 
-        def _extend_blocks(result, blocks: List[List[TableBlock]], axis: int = 0):
+        def _split_both_like(
+            result: List[List[TableBlock]], blocks: List[List[TableBlock]]
+        ) -> Tuple[List[List[TableBlock]], List[List[TableBlock]]]:
+            """
+            Make sure each row_block contain the same num_rows to be able to concatenate them on axis=1.
+
+            To do so, we modify both blocks sets to have the same row_blocks boundaries.
+            For example, if `result` has 2 row_blocks of 3 rows and `blocks` has 3 row_blocks of 2 rows,
+            we modify both to have 4 row_blocks of size 2, 1, 1 and 2:
+
+                    [ x   x   x | x   x   x ]
+                +   [ y   y | y   y | y   y ]
+                -----------------------------
+                =   [ x   x | x | x | x   x ]
+                    [ y   y | y | y | y   y ]
+
+            """
+            result, blocks = list(result), list(blocks)
+            new_result, new_blocks = [], []
+            while result and blocks:
+                # we slice the longest row block to save two row blocks of same length
+                # and we replace the long row block by its remainder if necessary
+                if len(result[0][0]) > len(blocks[0][0]):
+                    new_blocks.append(blocks[0])
+                    sliced, result[0] = _slice_row_block(result[0], len(blocks.pop(0)[0]))
+                    new_result.append(sliced)
+                elif len(result[0][0]) < len(blocks[0][0]):
+                    new_result.append(result[0])
+                    sliced, blocks[0] = _slice_row_block(blocks[0], len(result.pop(0)[0]))
+                    new_blocks.append(sliced)
+                else:
+                    new_result.append(result.pop(0))
+                    new_blocks.append(blocks.pop(0))
+            if result or blocks:
+                raise ValueError("Failed to concatenate on axis=1 because tables don't have the same number of rows")
+            return new_result, new_blocks
+
+        def _extend_blocks(
+            result: List[List[TableBlock]], blocks: List[List[TableBlock]], axis: int = 0
+        ) -> List[List[TableBlock]]:
             if axis == 0:
                 result.extend(blocks)
             elif axis == 1:
-                if len(result) == 1 and len(blocks) > 1:
-                    result = _split_like(result, blocks)  # Split result
-                elif len(blocks) == 1 and len(result) > 1:
-                    blocks = _split_like(blocks, result)  # Split blocks
-                # TODO: This assumes each block_row has the same num_rows
-                for i, row_blocks in enumerate(blocks):
-                    result[i].extend(row_blocks)
+                # We make sure each row_block have the same num_rows
+                result, blocks = _split_both_like(result, blocks)
+                for i, row_block in enumerate(blocks):
+                    result[i].extend(row_block)
             return result
 
         blocks = to_blocks(tables[0])
         for table in tables[1:]:
             table_blocks = to_blocks(table)
             blocks = _extend_blocks(blocks, table_blocks, axis=axis)
         return cls.from_blocks(blocks)
```

### Comparing `datasets-2.8.0/src/datasets/tasks/__init__.py` & `datasets-2.9.0/src/datasets/tasks/__init__.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/tasks/audio_classificiation.py` & `datasets-2.9.0/src/datasets/tasks/audio_classificiation.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/tasks/automatic_speech_recognition.py` & `datasets-2.9.0/src/datasets/tasks/automatic_speech_recognition.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/tasks/base.py` & `datasets-2.9.0/src/datasets/tasks/base.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/tasks/image_classification.py` & `datasets-2.9.0/src/datasets/tasks/image_classification.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/tasks/language_modeling.py` & `datasets-2.9.0/src/datasets/tasks/language_modeling.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/tasks/question_answering.py` & `datasets-2.9.0/src/datasets/tasks/question_answering.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/tasks/summarization.py` & `datasets-2.9.0/src/datasets/tasks/summarization.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/tasks/text_classification.py` & `datasets-2.9.0/src/datasets/tasks/text_classification.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/__init__.py` & `datasets-2.9.0/src/datasets/utils/__init__.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/_hf_hub_fixes.py` & `datasets-2.9.0/src/datasets/utils/_hf_hub_fixes.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/beam_utils.py` & `datasets-2.9.0/src/datasets/utils/beam_utils.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/deprecation_utils.py` & `datasets-2.9.0/src/datasets/utils/deprecation_utils.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/extract.py` & `datasets-2.9.0/src/datasets/utils/extract.py`

 * *Files 0% similar despite different names*

```diff
@@ -80,15 +80,15 @@
 
 class TarExtractor(BaseExtractor):
     @classmethod
     def is_extractable(cls, path: Union[Path, str], **kwargs) -> bool:
         return tarfile.is_tarfile(path)
 
     @staticmethod
-    def safemembers(members):
+    def safemembers(members, output_path):
         """
         Fix for CVE-2007-4559
         Desc:
             Directory traversal vulnerability in the (1) extract and (2) extractall functions in the tarfile
             module in Python allows user-assisted remote attackers to overwrite arbitrary files via a .. (dot dot)
             sequence in filenames in a TAR archive, a related issue to CVE-2001-1267.
         See: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-4559
@@ -103,31 +103,31 @@
             return not resolved(os.path.join(base, path)).startswith(base)
 
         def badlink(info, base: str) -> bool:
             # Links are interpreted relative to the directory containing the link
             tip = resolved(os.path.join(base, os.path.dirname(info.name)))
             return badpath(info.linkname, base=tip)
 
-        base = resolved(".")
+        base = resolved(output_path)
 
         for finfo in members:
             if badpath(finfo.name, base):
                 logger.error(f"Extraction of {finfo.name} is blocked (illegal path)")
             elif finfo.issym() and badlink(finfo, base):
-                logger.error(f"Extraction of {finfo.name} is blocked: Hard link to {finfo.linkname}")
-            elif finfo.islnk() and badlink(finfo, base):
                 logger.error(f"Extraction of {finfo.name} is blocked: Symlink to {finfo.linkname}")
+            elif finfo.islnk() and badlink(finfo, base):
+                logger.error(f"Extraction of {finfo.name} is blocked: Hard link to {finfo.linkname}")
             else:
                 yield finfo
 
     @staticmethod
     def extract(input_path: Union[Path, str], output_path: Union[Path, str]) -> None:
         os.makedirs(output_path, exist_ok=True)
         tar_file = tarfile.open(input_path)
-        tar_file.extractall(output_path, members=TarExtractor.safemembers(tar_file))
+        tar_file.extractall(output_path, members=TarExtractor.safemembers(tar_file, output_path))
         tar_file.close()
 
 
 class GzipExtractor(MagicNumberBaseExtractor):
     magic_number = b"\x1F\x8B"
 
     @staticmethod
```

### Comparing `datasets-2.8.0/src/datasets/utils/file_utils.py` & `datasets-2.9.0/src/datasets/utils/file_utils.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/filelock.py` & `datasets-2.9.0/src/datasets/utils/filelock.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/info_utils.py` & `datasets-2.9.0/src/datasets/utils/info_utils.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/logging.py` & `datasets-2.9.0/src/datasets/utils/logging.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/metadata.py` & `datasets-2.9.0/src/datasets/utils/metadata.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/patching.py` & `datasets-2.9.0/src/datasets/utils/patching.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/py_utils.py` & `datasets-2.9.0/src/datasets/utils/py_utils.py`

 * *Files 1% similar despite different names*

```diff
@@ -638,18 +638,15 @@
             elif (obj_type.__module__, obj_type.__name__) == ("torch", "Tensor"):
                 try:
                     import torch
 
                     @pklregister(obj_type)
                     def _save_tensor(pickler, obj):
                         dill_log(pickler, f"To: {obj}")
-                        if obj.requires_grad:
-                            args = (obj.detach().cpu().numpy(),)
-                        else:
-                            args = (obj.cpu().numpy(),)
+                        args = (obj.detach().cpu().numpy(),)
                         pickler.save_reduce(torch.from_numpy, args, obj=obj)
                         dill_log(pickler, "# To")
                         return
 
                 except ImportError:
                     pass
             elif obj_type.__module__.startswith("spacy.lang") and any(
```

### Comparing `datasets-2.8.0/src/datasets/utils/readme.py` & `datasets-2.9.0/src/datasets/utils/readme.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/resources/languages.json` & `datasets-2.9.0/src/datasets/utils/resources/languages.json`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/resources/readme_structure.yaml` & `datasets-2.9.0/src/datasets/utils/resources/readme_structure.yaml`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/sharding.py` & `datasets-2.9.0/src/datasets/utils/sharding.py`

 * *Files 4% similar despite different names*

```diff
@@ -64,14 +64,23 @@
                 else value
                 for key, value in gen_kwargs.items()
             }
             for group_idx in range(len(shard_indices_per_group))
         ]
 
 
+def _merge_gen_kwargs(gen_kwargs_list: List[dict]) -> dict:
+    return {
+        key: [value for gen_kwargs in gen_kwargs_list for value in gen_kwargs[key]]
+        if isinstance(gen_kwargs_list[0][key], list)
+        else gen_kwargs_list[0][key]
+        for key in gen_kwargs_list[0]
+    }
+
+
 def _shuffle_gen_kwargs(rng: np.random.Generator, gen_kwargs: dict) -> dict:
     """Return a shuffled copy of the input gen_kwargs"""
     # We must shuffle all the lists, and lists of the same size must have the same shuffling.
     # This way entangled lists of (shard, shard_metadata) are still in the right order.
 
     # First, let's generate the shuffled indices per list size
     list_sizes = set(len(value) for value in gen_kwargs.values() if isinstance(value, list))
```

### Comparing `datasets-2.8.0/src/datasets/utils/stratify.py` & `datasets-2.9.0/src/datasets/utils/stratify.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets/utils/version.py` & `datasets-2.9.0/src/datasets/utils/version.py`

 * *Files identical despite different names*

### Comparing `datasets-2.8.0/src/datasets.egg-info/PKG-INFO` & `datasets-2.9.0/src/datasets.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: datasets
-Version: 2.8.0
+Version: 2.9.0
 Summary: HuggingFace community-driven open-source library of datasets
 Home-page: https://github.com/huggingface/datasets
 Author: HuggingFace Inc.
 Author-email: thomas@huggingface.co
 License: Apache 2.0
 Download-URL: https://github.com/huggingface/datasets/tags
 Description: <p align="center">
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-Metadata-Version: 2.1 Name: datasets Version: 2.8.0 Summary: HuggingFace
+Metadata-Version: 2.1 Name: datasets Version: 2.9.0 Summary: HuggingFace
 community-driven open-source library of datasets Home-page: https://github.com/
 huggingface/datasets Author: HuggingFace Inc. Author-email:
 thomas@huggingface.co License: Apache 2.0 Download-URL: https://github.com/
 huggingface/datasets/tags Description:
 
 [https://raw.githubusercontent.com/huggingface/datasets/main/docs/source/imgs/
                             datasets_logo_name.jpg]
```

### Comparing `datasets-2.8.0/src/datasets.egg-info/SOURCES.txt` & `datasets-2.9.0/src/datasets.egg-info/SOURCES.txt`

 * *Files 1% similar despite different names*

```diff
@@ -8,14 +8,15 @@
 src/datasets/arrow_reader.py
 src/datasets/arrow_writer.py
 src/datasets/builder.py
 src/datasets/combine.py
 src/datasets/config.py
 src/datasets/data_files.py
 src/datasets/dataset_dict.py
+src/datasets/distributed.py
 src/datasets/fingerprint.py
 src/datasets/info.py
 src/datasets/inspect.py
 src/datasets/iterable_dataset.py
 src/datasets/keyhash.py
 src/datasets/load.py
 src/datasets/metric.py
```

### Comparing `datasets-2.8.0/src/datasets.egg-info/requires.txt` & `datasets-2.9.0/src/datasets.egg-info/requires.txt`

 * *Files 8% similar despite different names*

```diff
@@ -13,15 +13,15 @@
 responses<0.19
 pyyaml>=5.1
 
 [:python_version < "3.8"]
 importlib_metadata
 
 [apache-beam]
-apache-beam>=2.26.0
+apache-beam<2.44.0,>=2.26.0
 
 [audio]
 librosa
 
 [benchmarks]
 numpy==1.18.5
 tensorflow==2.3.0
@@ -48,15 +48,15 @@
 black~=22.0
 flake8>=3.8.3
 isort>=5.0.0
 pyyaml>=5.3.1
 s3fs
 
 [dev:python_version < "3.8"]
-apache-beam>=2.26.0
+apache-beam<2.44.0,>=2.26.0
 s3fs>=2021.11.1
 
 [dev:sys_platform != "darwin" or platform_machine != "arm64"]
 tensorflow!=2.6.0,!=2.6.1,>=2.3
 
 [dev:sys_platform == "darwin" and platform_machine == "arm64"]
 tensorflow-macos
@@ -125,15 +125,15 @@
 soundfile
 transformers
 zstandard
 Pillow>=6.2.1
 librosa
 
 [tests:python_version < "3.8"]
-apache-beam>=2.26.0
+apache-beam<2.44.0,>=2.26.0
 s3fs>=2021.11.1
 
 [tests:sys_platform != "darwin" or platform_machine != "arm64"]
 tensorflow!=2.6.0,!=2.6.1,>=2.3
 
 [tests:sys_platform == "darwin" and platform_machine == "arm64"]
 tensorflow-macos
```

